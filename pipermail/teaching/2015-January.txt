From yminsky at janestreet.com  Thu Jan 22 00:00:13 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Wed, 21 Jan 2015 19:00:13 -0500
Subject: [Teaching] Getting OCaml set up on a mac
Message-ID: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>

I was just chatting with Greg about this, and I wanted to broaden the
question out: how should a teacher set up a mac environment using
opam?  Ideally, it would be nice if we could give people a pretty
simple script that would get them editor configs, tools like merlin
and ocp-indent, and a set of libraries at fixed versions that won't
change for the whole semester.

Does anyone have a demo of such a thing set up?  Louis, how is your
opam-in-a-box work coming along, and is it at a point where people can
start using it?

y

From anil at recoil.org  Thu Jan 22 00:04:15 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 22 Jan 2015 00:04:15 +0000
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
Message-ID: <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>

On 22 Jan 2015, at 00:00, Yaron Minsky <yminsky at janestreet.com> wrote:
> 
> I was just chatting with Greg about this, and I wanted to broaden the
> question out: how should a teacher set up a mac environment using
> opam?  Ideally, it would be nice if we could give people a pretty
> simple script that would get them editor configs, tools like merlin
> and ocp-indent, and a set of libraries at fixed versions that won't
> change for the whole semester.
> 
> Does anyone have a demo of such a thing set up?  Louis, how is your
> opam-in-a-box work coming along, and is it at a point where people can
> start using it?

It's not merged into OPAM yet, but see the user-setup.0.1 package that does
just this:

https://github.com/ocaml/opam-repository/pull/3428

Description:
> OPAM User Setup helper to configure various editors and tools for OCaml
> 
> This package, currently in alpha, attempts to help initial setup for new OCaml
> users by automating the tedious task of adjusting editor and tool configuration.
> 
> It will run after the installation of ocp-indent, merlin or similar tools and
> adjust the configuration for your available editors accordingly. It won't suit
> advanced users who prefer to do such things by hand anyway.
> 


-anil

From yminsky at janestreet.com  Thu Jan 22 00:05:53 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Wed, 21 Jan 2015 19:05:53 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
Message-ID: <CACLX4jTyNsfnCLSMCAannjsXz9A9gCDr=XV=uyNr=UcqFcBHOA@mail.gmail.com>

That seems great.  Can we get it merged in soon?  School in the US is
starting up very very soon, and I suspect a number of different
schools would find this very useful.

y

On Wed, Jan 21, 2015 at 7:04 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
> On 22 Jan 2015, at 00:00, Yaron Minsky <yminsky at janestreet.com> wrote:
>>
>> I was just chatting with Greg about this, and I wanted to broaden the
>> question out: how should a teacher set up a mac environment using
>> opam?  Ideally, it would be nice if we could give people a pretty
>> simple script that would get them editor configs, tools like merlin
>> and ocp-indent, and a set of libraries at fixed versions that won't
>> change for the whole semester.
>>
>> Does anyone have a demo of such a thing set up?  Louis, how is your
>> opam-in-a-box work coming along, and is it at a point where people can
>> start using it?
>
> It's not merged into OPAM yet, but see the user-setup.0.1 package that does
> just this:
>
> https://github.com/ocaml/opam-repository/pull/3428
>
> Description:
>> OPAM User Setup helper to configure various editors and tools for OCaml
>>
>> This package, currently in alpha, attempts to help initial setup for new OCaml
>> users by automating the tedious task of adjusting editor and tool configuration.
>>
>> It will run after the installation of ocp-indent, merlin or similar tools and
>> adjust the configuration for your available editors accordingly. It won't suit
>> advanced users who prefer to do such things by hand anyway.
>>
>
>
> -anil

From anil at recoil.org  Thu Jan 22 09:16:14 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 22 Jan 2015 09:16:14 +0000
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jTyNsfnCLSMCAannjsXz9A9gCDr=XV=uyNr=UcqFcBHOA@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
 <CACLX4jTyNsfnCLSMCAannjsXz9A9gCDr=XV=uyNr=UcqFcBHOA@mail.gmail.com>
Message-ID: <C43C1A35-D437-4F3C-BCB9-DD13DBF5C31A@recoil.org>

Now merged.  There's a failure in the OPAM 1.1 compatibility case,
and I suspect a lot of students will have the latest Ubuntu and run
into this problem (14.10 has a broken OPAM out of the box due to an 
upstream packaging mismatch).

However, feedback from those trying it on OPAM 1.2 via:

   opam update
   opam install user-setup

would be appreciated.

Anil

> On 22 Jan 2015, at 00:05, Yaron Minsky <yminsky at janestreet.com> wrote:
> 
> That seems great.  Can we get it merged in soon?  School in the US is
> starting up very very soon, and I suspect a number of different
> schools would find this very useful.
> 
> y
> 
> On Wed, Jan 21, 2015 at 7:04 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>> On 22 Jan 2015, at 00:00, Yaron Minsky <yminsky at janestreet.com> wrote:
>>> 
>>> I was just chatting with Greg about this, and I wanted to broaden the
>>> question out: how should a teacher set up a mac environment using
>>> opam?  Ideally, it would be nice if we could give people a pretty
>>> simple script that would get them editor configs, tools like merlin
>>> and ocp-indent, and a set of libraries at fixed versions that won't
>>> change for the whole semester.
>>> 
>>> Does anyone have a demo of such a thing set up?  Louis, how is your
>>> opam-in-a-box work coming along, and is it at a point where people can
>>> start using it?
>> 
>> It's not merged into OPAM yet, but see the user-setup.0.1 package that does
>> just this:
>> 
>> https://github.com/ocaml/opam-repository/pull/3428
>> 
>> Description:
>>> OPAM User Setup helper to configure various editors and tools for OCaml
>>> 
>>> This package, currently in alpha, attempts to help initial setup for new OCaml
>>> users by automating the tedious task of adjusting editor and tool configuration.
>>> 
>>> It will run after the installation of ocp-indent, merlin or similar tools and
>>> adjust the configuration for your available editors accordingly. It won't suit
>>> advanced users who prefer to do such things by hand anyway.
>>> 
>> 
>> 
>> -anil
> 


From yminsky at janestreet.com  Thu Jan 22 15:25:23 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Thu, 22 Jan 2015 10:25:23 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <C43C1A35-D437-4F3C-BCB9-DD13DBF5C31A@recoil.org>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
 <CACLX4jTyNsfnCLSMCAannjsXz9A9gCDr=XV=uyNr=UcqFcBHOA@mail.gmail.com>
 <C43C1A35-D437-4F3C-BCB9-DD13DBF5C31A@recoil.org>
Message-ID: <CACLX4jQ3O8Q_waaPyKZzNbn4Rnchc08CGeMp49iRHxyi_8nyDQ@mail.gmail.com>

I'm going to try all of this in fresh-and-shiny mode on my mac.  I'll
report my results back.

y

On Thu, Jan 22, 2015 at 4:16 AM, Anil Madhavapeddy <anil at recoil.org> wrote:
> Now merged.  There's a failure in the OPAM 1.1 compatibility case,
> and I suspect a lot of students will have the latest Ubuntu and run
> into this problem (14.10 has a broken OPAM out of the box due to an
> upstream packaging mismatch).
>
> However, feedback from those trying it on OPAM 1.2 via:
>
>    opam update
>    opam install user-setup
>
> would be appreciated.
>
> Anil
>
>> On 22 Jan 2015, at 00:05, Yaron Minsky <yminsky at janestreet.com> wrote:
>>
>> That seems great.  Can we get it merged in soon?  School in the US is
>> starting up very very soon, and I suspect a number of different
>> schools would find this very useful.
>>
>> y
>>
>> On Wed, Jan 21, 2015 at 7:04 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>>> On 22 Jan 2015, at 00:00, Yaron Minsky <yminsky at janestreet.com> wrote:
>>>>
>>>> I was just chatting with Greg about this, and I wanted to broaden the
>>>> question out: how should a teacher set up a mac environment using
>>>> opam?  Ideally, it would be nice if we could give people a pretty
>>>> simple script that would get them editor configs, tools like merlin
>>>> and ocp-indent, and a set of libraries at fixed versions that won't
>>>> change for the whole semester.
>>>>
>>>> Does anyone have a demo of such a thing set up?  Louis, how is your
>>>> opam-in-a-box work coming along, and is it at a point where people can
>>>> start using it?
>>>
>>> It's not merged into OPAM yet, but see the user-setup.0.1 package that does
>>> just this:
>>>
>>> https://github.com/ocaml/opam-repository/pull/3428
>>>
>>> Description:
>>>> OPAM User Setup helper to configure various editors and tools for OCaml
>>>>
>>>> This package, currently in alpha, attempts to help initial setup for new OCaml
>>>> users by automating the tedious task of adjusting editor and tool configuration.
>>>>
>>>> It will run after the installation of ocp-indent, merlin or similar tools and
>>>> adjust the configuration for your available editors accordingly. It won't suit
>>>> advanced users who prefer to do such things by hand anyway.
>>>>
>>>
>>>
>>> -anil
>>
>

From greg at eecs.harvard.edu  Thu Jan 22 15:54:35 2015
From: greg at eecs.harvard.edu (Greg Morrisett)
Date: Thu, 22 Jan 2015 10:54:35 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <C43C1A35-D437-4F3C-BCB9-DD13DBF5C31A@recoil.org>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
 <CACLX4jTyNsfnCLSMCAannjsXz9A9gCDr=XV=uyNr=UcqFcBHOA@mail.gmail.com>
 <C43C1A35-D437-4F3C-BCB9-DD13DBF5C31A@recoil.org>
Message-ID: <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>

Okay, I just followed these steps:
> 
>   opam update
>   opam install user-setup

and it seems to be hanging.  Is there a log file or
other config information that I can send you to help
figure this out?

-Greg


From yminsky at janestreet.com  Thu Jan 22 15:56:15 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Thu, 22 Jan 2015 10:56:15 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
 <CACLX4jTyNsfnCLSMCAannjsXz9A9gCDr=XV=uyNr=UcqFcBHOA@mail.gmail.com>
 <C43C1A35-D437-4F3C-BCB9-DD13DBF5C31A@recoil.org>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
Message-ID: <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>

It installed cleanly for me, but it doesn't quite work.  I installed
user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
went through, but when I open a .ml file, it shows up in lisp mode,
not tuareg.

y

On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
> Okay, I just followed these steps:
>>
>>   opam update
>>   opam install user-setup
>
> and it seems to be hanging.  Is there a log file or
> other config information that I can send you to help
> figure this out?
>
> -Greg
>

From andrei at ci.ufpb.br  Thu Jan 22 19:56:51 2015
From: andrei at ci.ufpb.br (=?UTF-8?Q?Andrei_de_Ara=C3=BAjo_Formiga?=)
Date: Thu, 22 Jan 2015 16:56:51 -0300
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
Message-ID: <CAHj6FmDi+sYEywi379+_vG-8p3Q-jbjgjkqAhRimGPc0+bs=YQ@mail.gmail.com>

user-setup seems interesting but I think for a new user it's important
to also have good guides on how to use ocp-indent and merlin. A video
would probably be even better, showing a workflow for coding OCaml
with merlin.

2015-01-21 21:04 GMT-03:00 Anil Madhavapeddy <anil at recoil.org>:
> It's not merged into OPAM yet, but see the user-setup.0.1 package that does
> just this:
>
> https://github.com/ocaml/opam-repository/pull/3428
>
> Description:
>> OPAM User Setup helper to configure various editors and tools for OCaml
>>
>> This package, currently in alpha, attempts to help initial setup for new OCaml
>> users by automating the tedious task of adjusting editor and tool configuration.
>>
>> It will run after the installation of ocp-indent, merlin or similar tools and
>> adjust the configuration for your available editors accordingly. It won't suit
>> advanced users who prefer to do such things by hand anyway.
>>
>
>
> -anil
> _______________________________________________
> Teaching mailing list
> Teaching at lists.ocaml.org
> http://lists.ocaml.org/listinfo/teaching

From greg at eecs.harvard.edu  Thu Jan 22 19:58:59 2015
From: greg at eecs.harvard.edu (Greg Morrisett)
Date: Thu, 22 Jan 2015 14:58:59 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CAHj6FmDi+sYEywi379+_vG-8p3Q-jbjgjkqAhRimGPc0+bs=YQ@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
 <CAHj6FmDi+sYEywi379+_vG-8p3Q-jbjgjkqAhRimGPc0+bs=YQ@mail.gmail.com>
Message-ID: <DF36B7BB-A0C1-4168-AF50-309F71C89D87@eecs.harvard.edu>


> On Jan 22, 2015, at 2:56 PM, Andrei de Ara?jo Formiga <andrei at ci.ufpb.br> wrote:
> 
> user-setup seems interesting but I think for a new user it's important
> to also have good guides on how to use ocp-indent and merlin. A video
> would probably be even better, showing a workflow for coding OCaml
> with merlin.

That is a fantastic idea?

-Greg

From yminsky at janestreet.com  Thu Jan 22 20:43:22 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Thu, 22 Jan 2015 15:43:22 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <DF36B7BB-A0C1-4168-AF50-309F71C89D87@eecs.harvard.edu>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
 <CAHj6FmDi+sYEywi379+_vG-8p3Q-jbjgjkqAhRimGPc0+bs=YQ@mail.gmail.com>
 <DF36B7BB-A0C1-4168-AF50-309F71C89D87@eecs.harvard.edu>
Message-ID: <CACLX4jTTtM0Q9PHaSxDi5-T11bokrMMLd1Kr1thkpemky9Zx+A@mail.gmail.com>

That would be great.  Anyone know how to put together a decent screencast?

y

On Thu, Jan 22, 2015 at 2:58 PM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
>
>> On Jan 22, 2015, at 2:56 PM, Andrei de Ara?jo Formiga <andrei at ci.ufpb.br> wrote:
>>
>> user-setup seems interesting but I think for a new user it's important
>> to also have good guides on how to use ocp-indent and merlin. A video
>> would probably be even better, showing a workflow for coding OCaml
>> with merlin.
>
> That is a fantastic idea?
>
> -Greg
> _______________________________________________
> Teaching mailing list
> Teaching at lists.ocaml.org
> http://lists.ocaml.org/listinfo/teaching

From greg at eecs.harvard.edu  Thu Jan 22 20:53:45 2015
From: greg at eecs.harvard.edu (Greg Morrisett)
Date: Thu, 22 Jan 2015 15:53:45 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jTTtM0Q9PHaSxDi5-T11bokrMMLd1Kr1thkpemky9Zx+A@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
 <CAHj6FmDi+sYEywi379+_vG-8p3Q-jbjgjkqAhRimGPc0+bs=YQ@mail.gmail.com>
 <DF36B7BB-A0C1-4168-AF50-309F71C89D87@eecs.harvard.edu>
 <CACLX4jTTtM0Q9PHaSxDi5-T11bokrMMLd1Kr1thkpemky9Zx+A@mail.gmail.com>
Message-ID: <DF92542C-8BCD-4CF4-97CA-0090B29733F1@eecs.harvard.edu>

The CS50 people do a good job here, and I?ve hired some
of those people to work on my class this year.  So they
may be able to do this.  

-Greg

> On Jan 22, 2015, at 3:43 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
> 
> That would be great.  Anyone know how to put together a decent screencast?
> 
> y
> 
> On Thu, Jan 22, 2015 at 2:58 PM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
>> 
>>> On Jan 22, 2015, at 2:56 PM, Andrei de Ara?jo Formiga <andrei at ci.ufpb.br> wrote:
>>> 
>>> user-setup seems interesting but I think for a new user it's important
>>> to also have good guides on how to use ocp-indent and merlin. A video
>>> would probably be even better, showing a workflow for coding OCaml
>>> with merlin.
>> 
>> That is a fantastic idea?
>> 
>> -Greg
>> _______________________________________________
>> Teaching mailing list
>> Teaching at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/teaching


From yminsky at janestreet.com  Fri Jan 23 00:52:34 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Thu, 22 Jan 2015 19:52:34 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <DF92542C-8BCD-4CF4-97CA-0090B29733F1@eecs.harvard.edu>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <ECF0E4E8-593D-44A5-B5D2-DBA9131821B8@recoil.org>
 <CAHj6FmDi+sYEywi379+_vG-8p3Q-jbjgjkqAhRimGPc0+bs=YQ@mail.gmail.com>
 <DF36B7BB-A0C1-4168-AF50-309F71C89D87@eecs.harvard.edu>
 <CACLX4jTTtM0Q9PHaSxDi5-T11bokrMMLd1Kr1thkpemky9Zx+A@mail.gmail.com>
 <DF92542C-8BCD-4CF4-97CA-0090B29733F1@eecs.harvard.edu>
Message-ID: <CACLX4jTWNG27yPwNTZpVcUy36BvH6SVHRGeGS6idtB8TxMgi=Q@mail.gmail.com>

That sounds excellent. And if it's good by you, we can take the
results and put them on OCaml.org after the dust settles.

y

On Thu, Jan 22, 2015 at 3:53 PM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
> The CS50 people do a good job here, and I?ve hired some
> of those people to work on my class this year.  So they
> may be able to do this.
>
> -Greg
>
>> On Jan 22, 2015, at 3:43 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>>
>> That would be great.  Anyone know how to put together a decent screencast?
>>
>> y
>>
>> On Thu, Jan 22, 2015 at 2:58 PM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
>>>
>>>> On Jan 22, 2015, at 2:56 PM, Andrei de Ara?jo Formiga <andrei at ci.ufpb.br> wrote:
>>>>
>>>> user-setup seems interesting but I think for a new user it's important
>>>> to also have good guides on how to use ocp-indent and merlin. A video
>>>> would probably be even better, showing a workflow for coding OCaml
>>>> with merlin.
>>>
>>> That is a fantastic idea?
>>>
>>> -Greg
>>> _______________________________________________
>>> Teaching mailing list
>>> Teaching at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/teaching
>

From louis.gesbert at ocamlpro.com  Fri Jan 23 01:25:14 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 23 Jan 2015 10:25:14 +0900
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
Message-ID: <6106071.p2W8OPbTpf@agaric>

Thanks for the feedback. It's probably still a bit rough at the moment but the config-updating engine is there, and polishing configuration itself from there should be straight-forward (and never-ending).

The idea, with this and the "depext" package is to have a setup that can be limited to:

    PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp cryptokit menhir"
    opam init -a
    opam install depext
    opam depext $PACKAGES
    opam install $PACKAGES

and results in a ready-to-go environment. This is in particular targetted at VM setup, of course.

> - Yaron Minsky, 22/01/2015 10:56 -
> It installed cleanly for me, but it doesn't quite work.  I installed
> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
> went through, but when I open a .ml file, it shows up in lisp mode,
> not tuareg.

Seems it doesn't handle the opam-installed tuareg package well at the moment, should be fixed in a moment.

> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
> > Okay, I just followed these steps:
> >>
> >>   opam update
> >>   opam install user-setup
> >
> > and it seems to be hanging.  Is there a log file or
> > other config information that I can send you to help
> > figure this out?

Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it quickly.


Best,
Louis

From yminsky at janestreet.com  Fri Jan 23 01:42:38 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Thu, 22 Jan 2015 20:42:38 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <6106071.p2W8OPbTpf@agaric>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
Message-ID: <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>

On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
<louis.gesbert at ocamlpro.com> wrote:
> Thanks for the feedback. It's probably still a bit rough at the moment but the config-updating engine is there, and polishing configuration itself from there should be straight-forward (and never-ending).

Indeed.  Now I think is the time to really focus on getting it
working, because this is the beginning of the semester, and so now is
the most valuable time to have something working cleanly.

It would be good to know what we have there now.  It seems like a
minimum should be:

- tuareg
- merlin
- ocp-indent
- utop

all read to go in emacs.  Getting vim and sublime text support would
be lovely too, but I think less critical.  What does user-setup
already support?

> The idea, with this and the "depext" package is to have a setup that can be limited to:
>
>     PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp cryptokit menhir"
>     opam init -a
>     opam install depext
>     opam depext $PACKAGES
>     opam install $PACKAGES
>
> and results in a ready-to-go environment. This is in particular targetted at VM setup, of course.

Interesting. Concretely, what would would depext do in this context?
I did a fresh install of a number of packages on my mac, and I didn't
need much else, but I may have already had the dependencies in place
via brew.

y

>> - Yaron Minsky, 22/01/2015 10:56 -
>> It installed cleanly for me, but it doesn't quite work.  I installed
>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
>> went through, but when I open a .ml file, it shows up in lisp mode,
>> not tuareg.
>
> Seems it doesn't handle the opam-installed tuareg package well at the moment, should be fixed in a moment.
>
>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
>> > Okay, I just followed these steps:
>> >>
>> >>   opam update
>> >>   opam install user-setup
>> >
>> > and it seems to be hanging.  Is there a log file or
>> > other config information that I can send you to help
>> > figure this out?
>
> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it quickly.

Greg, it's also probably a good idea to encourage your students to
upgrade to the latest opam if they're on a mac.  Homebrew is pretty
lightweight, and has opam 1.2.0.

y

From yminsky at janestreet.com  Fri Jan 23 02:58:10 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Thu, 22 Jan 2015 21:58:10 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
Message-ID: <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>

In the meantime, I've attached a dot-emacs and dot-merlin files that I
think work nicely on a mac.  The one thing you need to do is to add
this line to your .profile file:

   eval `opam config env`

The dot emacs depends on this being in place for figuring out where to
find all the executables stashed in the .opam directory.

The pre-reqs for this to work is getting tuareg downloaded and in the
proper path (right now, I assume ~/.elisp/tuareg-mode), and installing
some opam packages:

   opam install core async merlin utop ocp-indent

This should give you merlin, ocp-indent, tuareg, and utop support, all
nicely integrated.  Note that the .merlin file needs to go in the
directory where you're editing code (and really, in every directory
where you're editing code.)  And the .merlin assumes that you're using
ocamlbuild (or corebuild) and so are putting your build artifacts in
_build.

I'm hoping this is helpful.

y

On Thu, Jan 22, 2015 at 8:42 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
> On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
> <louis.gesbert at ocamlpro.com> wrote:
>> Thanks for the feedback. It's probably still a bit rough at the moment but the config-updating engine is there, and polishing configuration itself from there should be straight-forward (and never-ending).
>
> Indeed.  Now I think is the time to really focus on getting it
> working, because this is the beginning of the semester, and so now is
> the most valuable time to have something working cleanly.
>
> It would be good to know what we have there now.  It seems like a
> minimum should be:
>
> - tuareg
> - merlin
> - ocp-indent
> - utop
>
> all read to go in emacs.  Getting vim and sublime text support would
> be lovely too, but I think less critical.  What does user-setup
> already support?
>
>> The idea, with this and the "depext" package is to have a setup that can be limited to:
>>
>>     PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp cryptokit menhir"
>>     opam init -a
>>     opam install depext
>>     opam depext $PACKAGES
>>     opam install $PACKAGES
>>
>> and results in a ready-to-go environment. This is in particular targetted at VM setup, of course.
>
> Interesting. Concretely, what would would depext do in this context?
> I did a fresh install of a number of packages on my mac, and I didn't
> need much else, but I may have already had the dependencies in place
> via brew.
>
> y
>
>>> - Yaron Minsky, 22/01/2015 10:56 -
>>> It installed cleanly for me, but it doesn't quite work.  I installed
>>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
>>> went through, but when I open a .ml file, it shows up in lisp mode,
>>> not tuareg.
>>
>> Seems it doesn't handle the opam-installed tuareg package well at the moment, should be fixed in a moment.
>>
>>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
>>> > Okay, I just followed these steps:
>>> >>
>>> >>   opam update
>>> >>   opam install user-setup
>>> >
>>> > and it seems to be hanging.  Is there a log file or
>>> > other config information that I can send you to help
>>> > figure this out?
>>
>> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it quickly.
>
> Greg, it's also probably a good idea to encourage your students to
> upgrade to the latest opam if they're on a mac.  Homebrew is pretty
> lightweight, and has opam 1.2.0.
>
> y
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dot-emacs
Type: application/octet-stream
Size: 2481 bytes
Desc: not available
URL: <http://lists.ocaml.org/pipermail/teaching/attachments/20150122/0e0c317d/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dot-merlin
Type: application/octet-stream
Size: 85 bytes
Desc: not available
URL: <http://lists.ocaml.org/pipermail/teaching/attachments/20150122/0e0c317d/attachment-0001.obj>

From louis.gesbert at ocamlpro.com  Fri Jan 23 03:03:15 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 23 Jan 2015 12:03:15 +0900
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
Message-ID: <2231981.IuY7GEgYg7@agaric>

Just released 0.2 which should fix both issues (opam tuareg mode and stalling with vim)

> It would be good to know what we have there now.  It seems like a
> minimum should be:
> 
> - tuareg
> - merlin
> - ocp-indent
> - utop
> 
> all read to go in emacs.  Getting vim and sublime text support would
> be lovely too, but I think less critical.  What does user-setup
> already support?

Needs more testing, but we do have those ; vim support also, but it's more lightly tested.
I didn't figure how to configure Sublime yet.

> Interesting. Concretely, what would would depext do in this context?
> I did a fresh install of a number of packages on my mac, and I didn't
> need much else, but I may have already had the dependencies in place
> via brew.

Not sure, but you can use `opam depext -l` to simply show the currently required external packages.

The one that bites most often on .deb distributions is the lack of m4, which is required by ocamlfind. It gets much more complicated as soon as you want to install e.g. gtk stuff, of course (ocaml-top...).

Best,
Louis

From yminsky at janestreet.com  Fri Jan 23 03:21:24 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Thu, 22 Jan 2015 22:21:24 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <2231981.IuY7GEgYg7@agaric>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <2231981.IuY7GEgYg7@agaric>
Message-ID: <CACLX4jTZfc6R=v+7WmquHyJ-=WgAjQwQiNXhHJQfwsQ+=zqzQw@mail.gmail.com>

Does depext do anything on a mac?  On redhat? Or is it Debian only?
On Jan 22, 2015 10:03 PM, "Louis Gesbert" <louis.gesbert at ocamlpro.com>
wrote:

> Just released 0.2 which should fix both issues (opam tuareg mode and
> stalling with vim)
>
> > It would be good to know what we have there now.  It seems like a
> > minimum should be:
> >
> > - tuareg
> > - merlin
> > - ocp-indent
> > - utop
> >
> > all read to go in emacs.  Getting vim and sublime text support would
> > be lovely too, but I think less critical.  What does user-setup
> > already support?
>
> Needs more testing, but we do have those ; vim support also, but it's more
> lightly tested.
> I didn't figure how to configure Sublime yet.
>
> > Interesting. Concretely, what would would depext do in this context?
> > I did a fresh install of a number of packages on my mac, and I didn't
> > need much else, but I may have already had the dependencies in place
> > via brew.
>
> Not sure, but you can use `opam depext -l` to simply show the currently
> required external packages.
>
> The one that bites most often on .deb distributions is the lack of m4,
> which is required by ocamlfind. It gets much more complicated as soon as
> you want to install e.g. gtk stuff, of course (ocaml-top...).
>
> Best,
> Louis
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/teaching/attachments/20150122/79258f05/attachment.html>

From yminsky at janestreet.com  Fri Jan 23 03:33:04 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Thu, 22 Jan 2015 22:33:04 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jTZfc6R=v+7WmquHyJ-=WgAjQwQiNXhHJQfwsQ+=zqzQw@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <2231981.IuY7GEgYg7@agaric>
 <CACLX4jTZfc6R=v+7WmquHyJ-=WgAjQwQiNXhHJQfwsQ+=zqzQw@mail.gmail.com>
Message-ID: <CACLX4jR0QdDxdGNCJRPHuj0pBEok5mV5JrjO1qp9Mjg8wxg14A@mail.gmail.com>

Also, I can't seem to install depext, but the reason doesn't make sense:

Kalessin:~ yminsky2$ opam install depext
[ERROR] depext is not available because your system doesn't comply
with opam-version >= "4.02".
Kalessin:~ yminsky2$ opam --version
1.2.0

I'm running the latest opam available from homebrew.

y

On Thu, Jan 22, 2015 at 10:21 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
> Does depext do anything on a mac?  On redhat? Or is it Debian only?
>
> On Jan 22, 2015 10:03 PM, "Louis Gesbert" <louis.gesbert at ocamlpro.com>
> wrote:
>>
>> Just released 0.2 which should fix both issues (opam tuareg mode and
>> stalling with vim)
>>
>> > It would be good to know what we have there now.  It seems like a
>> > minimum should be:
>> >
>> > - tuareg
>> > - merlin
>> > - ocp-indent
>> > - utop
>> >
>> > all read to go in emacs.  Getting vim and sublime text support would
>> > be lovely too, but I think less critical.  What does user-setup
>> > already support?
>>
>> Needs more testing, but we do have those ; vim support also, but it's more
>> lightly tested.
>> I didn't figure how to configure Sublime yet.
>>
>> > Interesting. Concretely, what would would depext do in this context?
>> > I did a fresh install of a number of packages on my mac, and I didn't
>> > need much else, but I may have already had the dependencies in place
>> > via brew.
>>
>> Not sure, but you can use `opam depext -l` to simply show the currently
>> required external packages.
>>
>> The one that bites most often on .deb distributions is the lack of m4,
>> which is required by ocamlfind. It gets much more complicated as soon as you
>> want to install e.g. gtk stuff, of course (ocaml-top...).
>>
>> Best,
>> Louis

From anil at recoil.org  Fri Jan 23 05:39:18 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 23 Jan 2015 06:39:18 +0100
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jR0QdDxdGNCJRPHuj0pBEok5mV5JrjO1qp9Mjg8wxg14A@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <2231981.IuY7GEgYg7@agaric>
 <CACLX4jTZfc6R=v+7WmquHyJ-=WgAjQwQiNXhHJQfwsQ+=zqzQw@mail.gmail.com>
 <CACLX4jR0QdDxdGNCJRPHuj0pBEok5mV5JrjO1qp9Mjg8wxg14A@mail.gmail.com>
Message-ID: <FFA5EE35-1AC7-42B8-800E-B2A38EF41274@recoil.org>

Fixed; there was a minor typo in the `opam` file for the package;
https://github.com/ocaml/opam-repository/pull/3441

-a

> On 23 Jan 2015, at 04:33, Yaron Minsky <yminsky at janestreet.com> wrote:
> 
> Also, I can't seem to install depext, but the reason doesn't make sense:
> 
> Kalessin:~ yminsky2$ opam install depext
> [ERROR] depext is not available because your system doesn't comply
> with opam-version >= "4.02".
> Kalessin:~ yminsky2$ opam --version
> 1.2.0
> 
> I'm running the latest opam available from homebrew.
> 
> y
> 
> On Thu, Jan 22, 2015 at 10:21 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>> Does depext do anything on a mac?  On redhat? Or is it Debian only?
>> 
>> On Jan 22, 2015 10:03 PM, "Louis Gesbert" <louis.gesbert at ocamlpro.com>
>> wrote:
>>> 
>>> Just released 0.2 which should fix both issues (opam tuareg mode and
>>> stalling with vim)
>>> 
>>>> It would be good to know what we have there now.  It seems like a
>>>> minimum should be:
>>>> 
>>>> - tuareg
>>>> - merlin
>>>> - ocp-indent
>>>> - utop
>>>> 
>>>> all read to go in emacs.  Getting vim and sublime text support would
>>>> be lovely too, but I think less critical.  What does user-setup
>>>> already support?
>>> 
>>> Needs more testing, but we do have those ; vim support also, but it's more
>>> lightly tested.
>>> I didn't figure how to configure Sublime yet.
>>> 
>>>> Interesting. Concretely, what would would depext do in this context?
>>>> I did a fresh install of a number of packages on my mac, and I didn't
>>>> need much else, but I may have already had the dependencies in place
>>>> via brew.
>>> 
>>> Not sure, but you can use `opam depext -l` to simply show the currently
>>> required external packages.
>>> 
>>> The one that bites most often on .deb distributions is the lack of m4,
>>> which is required by ocamlfind. It gets much more complicated as soon as you
>>> want to install e.g. gtk stuff, of course (ocaml-top...).
>>> 
>>> Best,
>>> Louis
> 


From greg at eecs.harvard.edu  Fri Jan 23 16:07:41 2015
From: greg at eecs.harvard.edu (Greg Morrisett)
Date: Fri, 23 Jan 2015 11:07:41 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
Message-ID: <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>

Thanks.  

Your dot-emacs and dot-merlin work (with tuareg-2.0.8 which
is what opam installs now.)

However, font lock mode doesn?t automatically trigger on either
emacs or aquamacs, in spite of the fact that I added:

  (global-font-lock-mode t)

If I add a hook to try to explicitly turn on font-lock:

  (add-hook 'tuareg-mode-hook 'font-lock-fontify-buffer t)

then I get the error:

  Warning: Bug in tuareg-mode: it forgets to call `run-mode-hooks'
  File mode specification error: (void-function tuareg-syntax-propertize)

-Greg

> On Jan 22, 2015, at 9:58 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
> 
> In the meantime, I've attached a dot-emacs and dot-merlin files that I
> think work nicely on a mac.  The one thing you need to do is to add
> this line to your .profile file:
> 
>   eval `opam config env`
> 
> The dot emacs depends on this being in place for figuring out where to
> find all the executables stashed in the .opam directory.
> 
> The pre-reqs for this to work is getting tuareg downloaded and in the
> proper path (right now, I assume ~/.elisp/tuareg-mode), and installing
> some opam packages:
> 
>   opam install core async merlin utop ocp-indent
> 
> This should give you merlin, ocp-indent, tuareg, and utop support, all
> nicely integrated.  Note that the .merlin file needs to go in the
> directory where you're editing code (and really, in every directory
> where you're editing code.)  And the .merlin assumes that you're using
> ocamlbuild (or corebuild) and so are putting your build artifacts in
> _build.
> 
> I'm hoping this is helpful.
> 
> y
> 
> On Thu, Jan 22, 2015 at 8:42 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>> On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
>> <louis.gesbert at ocamlpro.com> wrote:
>>> Thanks for the feedback. It's probably still a bit rough at the moment but the config-updating engine is there, and polishing configuration itself from there should be straight-forward (and never-ending).
>> 
>> Indeed.  Now I think is the time to really focus on getting it
>> working, because this is the beginning of the semester, and so now is
>> the most valuable time to have something working cleanly.
>> 
>> It would be good to know what we have there now.  It seems like a
>> minimum should be:
>> 
>> - tuareg
>> - merlin
>> - ocp-indent
>> - utop
>> 
>> all read to go in emacs.  Getting vim and sublime text support would
>> be lovely too, but I think less critical.  What does user-setup
>> already support?
>> 
>>> The idea, with this and the "depext" package is to have a setup that can be limited to:
>>> 
>>>    PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp cryptokit menhir"
>>>    opam init -a
>>>    opam install depext
>>>    opam depext $PACKAGES
>>>    opam install $PACKAGES
>>> 
>>> and results in a ready-to-go environment. This is in particular targetted at VM setup, of course.
>> 
>> Interesting. Concretely, what would would depext do in this context?
>> I did a fresh install of a number of packages on my mac, and I didn't
>> need much else, but I may have already had the dependencies in place
>> via brew.
>> 
>> y
>> 
>>>> - Yaron Minsky, 22/01/2015 10:56 -
>>>> It installed cleanly for me, but it doesn't quite work.  I installed
>>>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
>>>> went through, but when I open a .ml file, it shows up in lisp mode,
>>>> not tuareg.
>>> 
>>> Seems it doesn't handle the opam-installed tuareg package well at the moment, should be fixed in a moment.
>>> 
>>>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
>>>>> Okay, I just followed these steps:
>>>>>> 
>>>>>>  opam update
>>>>>>  opam install user-setup
>>>>> 
>>>>> and it seems to be hanging.  Is there a log file or
>>>>> other config information that I can send you to help
>>>>> figure this out?
>>> 
>>> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it quickly.
>> 
>> Greg, it's also probably a good idea to encourage your students to
>> upgrade to the latest opam if they're on a mac.  Homebrew is pretty
>> lightweight, and has opam 1.2.0.
>> 
>> y
> <dot-emacs><dot-merlin>


From yminsky at janestreet.com  Fri Jan 23 23:35:10 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Fri, 23 Jan 2015 18:35:10 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
 <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
Message-ID: <CACLX4jQdAEiPMPWDFH7yJSk3+rUq96Zaf0d6KX0CUJ0t=e6Jgw@mail.gmail.com>

That's odd. I'll look at this this weekend.

y
On Jan 23, 2015 11:07 AM, "Greg Morrisett" <greg at eecs.harvard.edu> wrote:

> Thanks.
>
> Your dot-emacs and dot-merlin work (with tuareg-2.0.8 which
> is what opam installs now.)
>
> However, font lock mode doesn?t automatically trigger on either
> emacs or aquamacs, in spite of the fact that I added:
>
>   (global-font-lock-mode t)
>
> If I add a hook to try to explicitly turn on font-lock:
>
>   (add-hook 'tuareg-mode-hook 'font-lock-fontify-buffer t)
>
> then I get the error:
>
>   Warning: Bug in tuareg-mode: it forgets to call `run-mode-hooks'
>   File mode specification error: (void-function tuareg-syntax-propertize)
>
> -Greg
>
> > On Jan 22, 2015, at 9:58 PM, Yaron Minsky <yminsky at janestreet.com>
> wrote:
> >
> > In the meantime, I've attached a dot-emacs and dot-merlin files that I
> > think work nicely on a mac.  The one thing you need to do is to add
> > this line to your .profile file:
> >
> >   eval `opam config env`
> >
> > The dot emacs depends on this being in place for figuring out where to
> > find all the executables stashed in the .opam directory.
> >
> > The pre-reqs for this to work is getting tuareg downloaded and in the
> > proper path (right now, I assume ~/.elisp/tuareg-mode), and installing
> > some opam packages:
> >
> >   opam install core async merlin utop ocp-indent
> >
> > This should give you merlin, ocp-indent, tuareg, and utop support, all
> > nicely integrated.  Note that the .merlin file needs to go in the
> > directory where you're editing code (and really, in every directory
> > where you're editing code.)  And the .merlin assumes that you're using
> > ocamlbuild (or corebuild) and so are putting your build artifacts in
> > _build.
> >
> > I'm hoping this is helpful.
> >
> > y
> >
> > On Thu, Jan 22, 2015 at 8:42 PM, Yaron Minsky <yminsky at janestreet.com>
> wrote:
> >> On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
> >> <louis.gesbert at ocamlpro.com> wrote:
> >>> Thanks for the feedback. It's probably still a bit rough at the moment
> but the config-updating engine is there, and polishing configuration itself
> from there should be straight-forward (and never-ending).
> >>
> >> Indeed.  Now I think is the time to really focus on getting it
> >> working, because this is the beginning of the semester, and so now is
> >> the most valuable time to have something working cleanly.
> >>
> >> It would be good to know what we have there now.  It seems like a
> >> minimum should be:
> >>
> >> - tuareg
> >> - merlin
> >> - ocp-indent
> >> - utop
> >>
> >> all read to go in emacs.  Getting vim and sublime text support would
> >> be lovely too, but I think less critical.  What does user-setup
> >> already support?
> >>
> >>> The idea, with this and the "depext" package is to have a setup that
> can be limited to:
> >>>
> >>>    PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis
> ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp
> cryptokit menhir"
> >>>    opam init -a
> >>>    opam install depext
> >>>    opam depext $PACKAGES
> >>>    opam install $PACKAGES
> >>>
> >>> and results in a ready-to-go environment. This is in particular
> targetted at VM setup, of course.
> >>
> >> Interesting. Concretely, what would would depext do in this context?
> >> I did a fresh install of a number of packages on my mac, and I didn't
> >> need much else, but I may have already had the dependencies in place
> >> via brew.
> >>
> >> y
> >>
> >>>> - Yaron Minsky, 22/01/2015 10:56 -
> >>>> It installed cleanly for me, but it doesn't quite work.  I installed
> >>>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
> >>>> went through, but when I open a .ml file, it shows up in lisp mode,
> >>>> not tuareg.
> >>>
> >>> Seems it doesn't handle the opam-installed tuareg package well at the
> moment, should be fixed in a moment.
> >>>
> >>>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett <
> greg at eecs.harvard.edu> wrote:
> >>>>> Okay, I just followed these steps:
> >>>>>>
> >>>>>>  opam update
> >>>>>>  opam install user-setup
> >>>>>
> >>>>> and it seems to be hanging.  Is there a log file or
> >>>>> other config information that I can send you to help
> >>>>> figure this out?
> >>>
> >>> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it
> quickly.
> >>
> >> Greg, it's also probably a good idea to encourage your students to
> >> upgrade to the latest opam if they're on a mac.  Homebrew is pretty
> >> lightweight, and has opam 1.2.0.
> >>
> >> y
> > <dot-emacs><dot-merlin>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/teaching/attachments/20150123/5af150ca/attachment.html>

From yminsky at janestreet.com  Sat Jan 24 01:48:38 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Fri, 23 Jan 2015 20:48:38 -0500
Subject: [Teaching] Getting opam's user-setup working cleanly
Message-ID: <CACLX4jRiQP4_-dDcke7XjZwq38j4g=0crqc-vohuFsY8P1e8PQ@mail.gmail.com>

Hmm.  I'm still not able to get user-setup to work cleanly on my mac,
though depext does install now, and I think correctly determines that
there are no packages it needs to install.

But here are the messages I get from emacs:

Loading paren...done
Loading tuareg-site-file...done
For information about GNU Emacs and the GNU system, type C-h C-a.
Making completion list...
Starting merlin instance: default (binary=ocamlmerlin).
File mode specification error: (file-error "Searching for program" "no
such file or directory" "ocamlmerlin")

So it can't seem to find merlin.

I'm also a little troubled by the hard-coding of paths in the .emacs.
Once nice thing about the dot-emacs file I shared with Greg is that it
auto-updates where it points on every opam switch, without even
needing to restart emacs, I believe.  It would be nice to have this
for merlin, though I admit perhaps not with tuareg.

I tend to think that until we get this sorted, teachers should use
manually put together dot-emacs files like the ones I emailed out.

y

On Fri, Jan 23, 2015 at 12:39 AM, Anil Madhavapeddy <anil at recoil.org> wrote:
> Fixed; there was a minor typo in the `opam` file for the package;
> https://github.com/ocaml/opam-repository/pull/3441
>
> -a
>
>> On 23 Jan 2015, at 04:33, Yaron Minsky <yminsky at janestreet.com> wrote:
>>
>> Also, I can't seem to install depext, but the reason doesn't make sense:
>>
>> Kalessin:~ yminsky2$ opam install depext
>> [ERROR] depext is not available because your system doesn't comply
>> with opam-version >= "4.02".
>> Kalessin:~ yminsky2$ opam --version
>> 1.2.0
>>
>> I'm running the latest opam available from homebrew.
>>
>> y
>>
>> On Thu, Jan 22, 2015 at 10:21 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>>> Does depext do anything on a mac?  On redhat? Or is it Debian only?
>>>
>>> On Jan 22, 2015 10:03 PM, "Louis Gesbert" <louis.gesbert at ocamlpro.com>
>>> wrote:
>>>>
>>>> Just released 0.2 which should fix both issues (opam tuareg mode and
>>>> stalling with vim)
>>>>
>>>>> It would be good to know what we have there now.  It seems like a
>>>>> minimum should be:
>>>>>
>>>>> - tuareg
>>>>> - merlin
>>>>> - ocp-indent
>>>>> - utop
>>>>>
>>>>> all read to go in emacs.  Getting vim and sublime text support would
>>>>> be lovely too, but I think less critical.  What does user-setup
>>>>> already support?
>>>>
>>>> Needs more testing, but we do have those ; vim support also, but it's more
>>>> lightly tested.
>>>> I didn't figure how to configure Sublime yet.
>>>>
>>>>> Interesting. Concretely, what would would depext do in this context?
>>>>> I did a fresh install of a number of packages on my mac, and I didn't
>>>>> need much else, but I may have already had the dependencies in place
>>>>> via brew.
>>>>
>>>> Not sure, but you can use `opam depext -l` to simply show the currently
>>>> required external packages.
>>>>
>>>> The one that bites most often on .deb distributions is the lack of m4,
>>>> which is required by ocamlfind. It gets much more complicated as soon as you
>>>> want to install e.g. gtk stuff, of course (ocaml-top...).
>>>>
>>>> Best,
>>>> Louis
>>
>

From yminsky at janestreet.com  Sat Jan 24 01:54:41 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Fri, 23 Jan 2015 20:54:41 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jQdAEiPMPWDFH7yJSk3+rUq96Zaf0d6KX0CUJ0t=e6Jgw@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
 <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
 <CACLX4jQdAEiPMPWDFH7yJSk3+rUq96Zaf0d6KX0CUJ0t=e6Jgw@mail.gmail.com>
Message-ID: <CACLX4jT-o2XvHHe-LRgZMFQ-vw86tKyj5biq=7mnmtD-6yG66w@mail.gmail.com>

Hmm.  Really can't replicate the problem --- font-lock works fine for
me.  Greg, can you email out your full .emacs?  And double-check the
version of emacs your running?

y

On Fri, Jan 23, 2015 at 6:35 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
> That's odd. I'll look at this this weekend.
>
> y
>
> On Jan 23, 2015 11:07 AM, "Greg Morrisett" <greg at eecs.harvard.edu> wrote:
>>
>> Thanks.
>>
>> Your dot-emacs and dot-merlin work (with tuareg-2.0.8 which
>> is what opam installs now.)
>>
>> However, font lock mode doesn?t automatically trigger on either
>> emacs or aquamacs, in spite of the fact that I added:
>>
>>   (global-font-lock-mode t)
>>
>> If I add a hook to try to explicitly turn on font-lock:
>>
>>   (add-hook 'tuareg-mode-hook 'font-lock-fontify-buffer t)
>>
>> then I get the error:
>>
>>   Warning: Bug in tuareg-mode: it forgets to call `run-mode-hooks'
>>   File mode specification error: (void-function tuareg-syntax-propertize)
>>
>> -Greg
>>
>> > On Jan 22, 2015, at 9:58 PM, Yaron Minsky <yminsky at janestreet.com>
>> > wrote:
>> >
>> > In the meantime, I've attached a dot-emacs and dot-merlin files that I
>> > think work nicely on a mac.  The one thing you need to do is to add
>> > this line to your .profile file:
>> >
>> >   eval `opam config env`
>> >
>> > The dot emacs depends on this being in place for figuring out where to
>> > find all the executables stashed in the .opam directory.
>> >
>> > The pre-reqs for this to work is getting tuareg downloaded and in the
>> > proper path (right now, I assume ~/.elisp/tuareg-mode), and installing
>> > some opam packages:
>> >
>> >   opam install core async merlin utop ocp-indent
>> >
>> > This should give you merlin, ocp-indent, tuareg, and utop support, all
>> > nicely integrated.  Note that the .merlin file needs to go in the
>> > directory where you're editing code (and really, in every directory
>> > where you're editing code.)  And the .merlin assumes that you're using
>> > ocamlbuild (or corebuild) and so are putting your build artifacts in
>> > _build.
>> >
>> > I'm hoping this is helpful.
>> >
>> > y
>> >
>> > On Thu, Jan 22, 2015 at 8:42 PM, Yaron Minsky <yminsky at janestreet.com>
>> > wrote:
>> >> On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
>> >> <louis.gesbert at ocamlpro.com> wrote:
>> >>> Thanks for the feedback. It's probably still a bit rough at the moment
>> >>> but the config-updating engine is there, and polishing configuration itself
>> >>> from there should be straight-forward (and never-ending).
>> >>
>> >> Indeed.  Now I think is the time to really focus on getting it
>> >> working, because this is the beginning of the semester, and so now is
>> >> the most valuable time to have something working cleanly.
>> >>
>> >> It would be good to know what we have there now.  It seems like a
>> >> minimum should be:
>> >>
>> >> - tuareg
>> >> - merlin
>> >> - ocp-indent
>> >> - utop
>> >>
>> >> all read to go in emacs.  Getting vim and sublime text support would
>> >> be lovely too, but I think less critical.  What does user-setup
>> >> already support?
>> >>
>> >>> The idea, with this and the "depext" package is to have a setup that
>> >>> can be limited to:
>> >>>
>> >>>    PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis
>> >>> ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp
>> >>> cryptokit menhir"
>> >>>    opam init -a
>> >>>    opam install depext
>> >>>    opam depext $PACKAGES
>> >>>    opam install $PACKAGES
>> >>>
>> >>> and results in a ready-to-go environment. This is in particular
>> >>> targetted at VM setup, of course.
>> >>
>> >> Interesting. Concretely, what would would depext do in this context?
>> >> I did a fresh install of a number of packages on my mac, and I didn't
>> >> need much else, but I may have already had the dependencies in place
>> >> via brew.
>> >>
>> >> y
>> >>
>> >>>> - Yaron Minsky, 22/01/2015 10:56 -
>> >>>> It installed cleanly for me, but it doesn't quite work.  I installed
>> >>>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
>> >>>> went through, but when I open a .ml file, it shows up in lisp mode,
>> >>>> not tuareg.
>> >>>
>> >>> Seems it doesn't handle the opam-installed tuareg package well at the
>> >>> moment, should be fixed in a moment.
>> >>>
>> >>>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett
>> >>>> <greg at eecs.harvard.edu> wrote:
>> >>>>> Okay, I just followed these steps:
>> >>>>>>
>> >>>>>>  opam update
>> >>>>>>  opam install user-setup
>> >>>>>
>> >>>>> and it seems to be hanging.  Is there a log file or
>> >>>>> other config information that I can send you to help
>> >>>>> figure this out?
>> >>>
>> >>> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it
>> >>> quickly.
>> >>
>> >> Greg, it's also probably a good idea to encourage your students to
>> >> upgrade to the latest opam if they're on a mac.  Homebrew is pretty
>> >> lightweight, and has opam 1.2.0.
>> >>
>> >> y
>> > <dot-emacs><dot-merlin>
>>
>

From Christophe.Troestler at umons.ac.be  Sat Jan 24 02:33:54 2015
From: Christophe.Troestler at umons.ac.be (Christophe Troestler)
Date: Sat, 24 Jan 2015 03:33:54 +0100
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
References: <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
 <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
Message-ID: <20150124.033354.1262855974022040641.Christophe.Troestler@umons.ac.be>

On Fri, 23 Jan 2015 11:07:41 -0500, Greg Morrisett wrote:
> 
> Thanks.  
> 
> Your dot-emacs and dot-merlin work (with tuareg-2.0.8 which
> is what opam installs now.)
> 
> However, font lock mode doesn?t automatically trigger on either
> emacs or aquamacs, in spite of the fact that I added:
> 
>   (global-font-lock-mode t)
> 
> If I add a hook to try to explicitly turn on font-lock:
> 
>   (add-hook 'tuareg-mode-hook 'font-lock-fontify-buffer t)

(That should not be needed.)

> then I get the error:
> 
>   Warning: Bug in tuareg-mode: it forgets to call `run-mode-hooks'
>   File mode specification error: (void-function tuareg-syntax-propertize)

For this, may you try the HEAD of Tuareg
<https://github.com/ocaml/tuareg/> and report back?  Thanks.

Best,
C.

From louis.gesbert at ocamlpro.com  Sat Jan 24 03:02:02 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Sat, 24 Jan 2015 12:02:02 +0900
Subject: [Teaching] Getting opam's user-setup working cleanly
In-Reply-To: <CACLX4jRiQP4_-dDcke7XjZwq38j4g=0crqc-vohuFsY8P1e8PQ@mail.gmail.com>
References: <CACLX4jRiQP4_-dDcke7XjZwq38j4g=0crqc-vohuFsY8P1e8PQ@mail.gmail.com>
Message-ID: <2064150.77YCDucXMf@agaric>

user-setup doesn't handle yet the Mac-specific issue of Emacs load-paths, so that's probably what is bitting you here; I'll port the related code from your .emacs; getting a means to test on these ASAP.


On hardcoding the paths, I'm still not certain it is the best option, but I had a few reasons for doing so (open for discussion, obviously, this is still a prototype):

* user-setup configures editors depending on what is installed in the current switch ; it may not make sense in other switches.

* some tools are generally useful (tuareg, ocp-indent) and installing them in one switch should be enough. There is a clear distinction though for compiler-version dependent tools (merlin, ocp-index).

* this is not focused on advanced users with multiple switches, etc. and it makes the configuration simpler to understand and edit.

* this approach is guaranteed to be available for all editors.

The alternatives would be (i) using packages supplied within the editor's ecosystems, when available (see the detailed discussion at [1]), which should clearly handle locations dynamically -- I think that best serves advanced users but has a purpose distinct enough to justify both approaches ; and (ii) dynamically generating configuration at editor run time (like ocp-edit does for emacs: it reads its own configuration and outputs elisp code that is evaluated at run time)

Note that we still hit a consistency issue with this approach if installing user-setup in multiple switches. This also raises the question of handling "global" or "multi-switch" packages in OPAM.


On the feature of dynamically adapting to the latest `opam switch` in emacs, it could be achieved by running all external commands through `opam config exec -- <command>`. It doesn't extend to running different elisp files depending on the switch though, and you'd still need to manually update PATH etc. if you're running builds within emacs, similar to `eval $(opam config env)`. I do this using:

    (defun opam-env ()
      (interactive nil)
      (dolist (var (car (read-from-string (shell-command-to-string "opam config env --sexp"))))
        (setenv (car var) (cadr var))))

opam-user-setup will set this statically, locally on caml/tuareg buffers, which may indeed not be the best idea.

Thanks for the feedback, it'll help make this usable quick
Louis

> - Yaron Minsky, 23/01/2015 20:48 -
> Hmm.  I'm still not able to get user-setup to work cleanly on my mac,
> though depext does install now, and I think correctly determines that
> there are no packages it needs to install.
> 
> But here are the messages I get from emacs:
> 
> Loading paren...done
> Loading tuareg-site-file...done
> For information about GNU Emacs and the GNU system, type C-h C-a.
> Making completion list...
> Starting merlin instance: default (binary=ocamlmerlin).
> File mode specification error: (file-error "Searching for program" "no
> such file or directory" "ocamlmerlin")
> 
> So it can't seem to find merlin.
> 
> I'm also a little troubled by the hard-coding of paths in the .emacs.
> Once nice thing about the dot-emacs file I shared with Greg is that it
> auto-updates where it points on every opam switch, without even
> needing to restart emacs, I believe.  It would be nice to have this
> for merlin, though I admit perhaps not with tuareg.
> 
> I tend to think that until we get this sorted, teachers should use
> manually put together dot-emacs files like the ones I emailed out.
> 
> y
> 
> On Fri, Jan 23, 2015 at 12:39 AM, Anil Madhavapeddy <anil at recoil.org> wrote:
> > Fixed; there was a minor typo in the `opam` file for the package;
> > https://github.com/ocaml/opam-repository/pull/3441
> >
> > -a
> >
> >> On 23 Jan 2015, at 04:33, Yaron Minsky <yminsky at janestreet.com> wrote:
> >>
> >> Also, I can't seem to install depext, but the reason doesn't make sense:
> >>
> >> Kalessin:~ yminsky2$ opam install depext
> >> [ERROR] depext is not available because your system doesn't comply
> >> with opam-version >= "4.02".
> >> Kalessin:~ yminsky2$ opam --version
> >> 1.2.0
> >>
> >> I'm running the latest opam available from homebrew.
> >>
> >> y
> >>
> >> On Thu, Jan 22, 2015 at 10:21 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
> >>> Does depext do anything on a mac?  On redhat? Or is it Debian only?
> >>>
> >>> On Jan 22, 2015 10:03 PM, "Louis Gesbert" <louis.gesbert at ocamlpro.com>
> >>> wrote:
> >>>>
> >>>> Just released 0.2 which should fix both issues (opam tuareg mode and
> >>>> stalling with vim)
> >>>>
> >>>>> It would be good to know what we have there now.  It seems like a
> >>>>> minimum should be:
> >>>>>
> >>>>> - tuareg
> >>>>> - merlin
> >>>>> - ocp-indent
> >>>>> - utop
> >>>>>
> >>>>> all read to go in emacs.  Getting vim and sublime text support would
> >>>>> be lovely too, but I think less critical.  What does user-setup
> >>>>> already support?
> >>>>
> >>>> Needs more testing, but we do have those ; vim support also, but it's more
> >>>> lightly tested.
> >>>> I didn't figure how to configure Sublime yet.
> >>>>
> >>>>> Interesting. Concretely, what would would depext do in this context?
> >>>>> I did a fresh install of a number of packages on my mac, and I didn't
> >>>>> need much else, but I may have already had the dependencies in place
> >>>>> via brew.
> >>>>
> >>>> Not sure, but you can use `opam depext -l` to simply show the currently
> >>>> required external packages.
> >>>>
> >>>> The one that bites most often on .deb distributions is the lack of m4,
> >>>> which is required by ocamlfind. It gets much more complicated as soon as you
> >>>> want to install e.g. gtk stuff, of course (ocaml-top...).
> >>>>
> >>>> Best,
> >>>> Louis
> >>
> >

From yminsky at janestreet.com  Sat Jan 24 03:05:00 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Fri, 23 Jan 2015 22:05:00 -0500
Subject: [Teaching] Getting opam's user-setup working cleanly
In-Reply-To: <2064150.77YCDucXMf@agaric>
References: <CACLX4jRiQP4_-dDcke7XjZwq38j4g=0crqc-vohuFsY8P1e8PQ@mail.gmail.com>
 <2064150.77YCDucXMf@agaric>
Message-ID: <CACLX4jRODcAS3Pc26T0JXoQdc5R6oPjxyr0gQCPThGSCqrfWDw@mail.gmail.com>

My apologies.  I just put up a post about all this on the platform
list, so I've now split the discussion.  How about we move the
conversation over there.  I think we probably shouldn't come back to
the teaching list until we've resolved some more of these questions
anyway.

On Fri, Jan 23, 2015 at 10:02 PM, Louis Gesbert
<louis.gesbert at ocamlpro.com> wrote:
> user-setup doesn't handle yet the Mac-specific issue of Emacs load-paths, so that's probably what is bitting you here; I'll port the related code from your .emacs; getting a means to test on these ASAP.
>
>
> On hardcoding the paths, I'm still not certain it is the best option, but I had a few reasons for doing so (open for discussion, obviously, this is still a prototype):
>
> * user-setup configures editors depending on what is installed in the current switch ; it may not make sense in other switches.
>
> * some tools are generally useful (tuareg, ocp-indent) and installing them in one switch should be enough. There is a clear distinction though for compiler-version dependent tools (merlin, ocp-index).
>
> * this is not focused on advanced users with multiple switches, etc. and it makes the configuration simpler to understand and edit.
>
> * this approach is guaranteed to be available for all editors.
>
> The alternatives would be (i) using packages supplied within the editor's ecosystems, when available (see the detailed discussion at [1]), which should clearly handle locations dynamically -- I think that best serves advanced users but has a purpose distinct enough to justify both approaches ; and (ii) dynamically generating configuration at editor run time (like ocp-edit does for emacs: it reads its own configuration and outputs elisp code that is evaluated at run time)
>
> Note that we still hit a consistency issue with this approach if installing user-setup in multiple switches. This also raises the question of handling "global" or "multi-switch" packages in OPAM.
>
>
> On the feature of dynamically adapting to the latest `opam switch` in emacs, it could be achieved by running all external commands through `opam config exec -- <command>`. It doesn't extend to running different elisp files depending on the switch though, and you'd still need to manually update PATH etc. if you're running builds within emacs, similar to `eval $(opam config env)`. I do this using:
>
>     (defun opam-env ()
>       (interactive nil)
>       (dolist (var (car (read-from-string (shell-command-to-string "opam config env --sexp"))))
>         (setenv (car var) (cadr var))))
>
> opam-user-setup will set this statically, locally on caml/tuareg buffers, which may indeed not be the best idea.
>
> Thanks for the feedback, it'll help make this usable quick
> Louis
>
>> - Yaron Minsky, 23/01/2015 20:48 -
>> Hmm.  I'm still not able to get user-setup to work cleanly on my mac,
>> though depext does install now, and I think correctly determines that
>> there are no packages it needs to install.
>>
>> But here are the messages I get from emacs:
>>
>> Loading paren...done
>> Loading tuareg-site-file...done
>> For information about GNU Emacs and the GNU system, type C-h C-a.
>> Making completion list...
>> Starting merlin instance: default (binary=ocamlmerlin).
>> File mode specification error: (file-error "Searching for program" "no
>> such file or directory" "ocamlmerlin")
>>
>> So it can't seem to find merlin.
>>
>> I'm also a little troubled by the hard-coding of paths in the .emacs.
>> Once nice thing about the dot-emacs file I shared with Greg is that it
>> auto-updates where it points on every opam switch, without even
>> needing to restart emacs, I believe.  It would be nice to have this
>> for merlin, though I admit perhaps not with tuareg.
>>
>> I tend to think that until we get this sorted, teachers should use
>> manually put together dot-emacs files like the ones I emailed out.
>>
>> y
>>
>> On Fri, Jan 23, 2015 at 12:39 AM, Anil Madhavapeddy <anil at recoil.org> wrote:
>> > Fixed; there was a minor typo in the `opam` file for the package;
>> > https://github.com/ocaml/opam-repository/pull/3441
>> >
>> > -a
>> >
>> >> On 23 Jan 2015, at 04:33, Yaron Minsky <yminsky at janestreet.com> wrote:
>> >>
>> >> Also, I can't seem to install depext, but the reason doesn't make sense:
>> >>
>> >> Kalessin:~ yminsky2$ opam install depext
>> >> [ERROR] depext is not available because your system doesn't comply
>> >> with opam-version >= "4.02".
>> >> Kalessin:~ yminsky2$ opam --version
>> >> 1.2.0
>> >>
>> >> I'm running the latest opam available from homebrew.
>> >>
>> >> y
>> >>
>> >> On Thu, Jan 22, 2015 at 10:21 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>> >>> Does depext do anything on a mac?  On redhat? Or is it Debian only?
>> >>>
>> >>> On Jan 22, 2015 10:03 PM, "Louis Gesbert" <louis.gesbert at ocamlpro.com>
>> >>> wrote:
>> >>>>
>> >>>> Just released 0.2 which should fix both issues (opam tuareg mode and
>> >>>> stalling with vim)
>> >>>>
>> >>>>> It would be good to know what we have there now.  It seems like a
>> >>>>> minimum should be:
>> >>>>>
>> >>>>> - tuareg
>> >>>>> - merlin
>> >>>>> - ocp-indent
>> >>>>> - utop
>> >>>>>
>> >>>>> all read to go in emacs.  Getting vim and sublime text support would
>> >>>>> be lovely too, but I think less critical.  What does user-setup
>> >>>>> already support?
>> >>>>
>> >>>> Needs more testing, but we do have those ; vim support also, but it's more
>> >>>> lightly tested.
>> >>>> I didn't figure how to configure Sublime yet.
>> >>>>
>> >>>>> Interesting. Concretely, what would would depext do in this context?
>> >>>>> I did a fresh install of a number of packages on my mac, and I didn't
>> >>>>> need much else, but I may have already had the dependencies in place
>> >>>>> via brew.
>> >>>>
>> >>>> Not sure, but you can use `opam depext -l` to simply show the currently
>> >>>> required external packages.
>> >>>>
>> >>>> The one that bites most often on .deb distributions is the lack of m4,
>> >>>> which is required by ocamlfind. It gets much more complicated as soon as you
>> >>>> want to install e.g. gtk stuff, of course (ocaml-top...).
>> >>>>
>> >>>> Best,
>> >>>> Louis
>> >>
>> >

From greg at eecs.harvard.edu  Mon Jan 26 15:00:07 2015
From: greg at eecs.harvard.edu (Greg Morrisett)
Date: Mon, 26 Jan 2015 10:00:07 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jT-o2XvHHe-LRgZMFQ-vw86tKyj5biq=7mnmtD-6yG66w@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
 <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
 <CACLX4jQdAEiPMPWDFH7yJSk3+rUq96Zaf0d6KX0CUJ0t=e6Jgw@mail.gmail.com>
 <CACLX4jT-o2XvHHe-LRgZMFQ-vw86tKyj5biq=7mnmtD-6yG66w@mail.gmail.com>
Message-ID: <1F49C854-EAA5-48EE-82A6-F693D6C0EE74@eecs.harvard.edu>

The emacs version is 24.4.1.  The .emacs file is the one you sent
me.  When I fire this up, font-lock-mode is enabled, but nothing
is colorized when I load a .ml file.  If I explicitly font-lock-
fontify-buffer, and then type anything, I get the error message:

  Symbol?s function definition is void:  tuareg-syntax-propertize

I?m going to try the most recent head of tuareg to see if this
fixes the problem.

(NB:  same behavior under latest Aquamacs.)  

-Greg

> On Jan 23, 2015, at 8:54 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
> 
> Hmm.  Really can't replicate the problem --- font-lock works fine for
> me.  Greg, can you email out your full .emacs?  And double-check the
> version of emacs your running?
> 
> y
> 
> On Fri, Jan 23, 2015 at 6:35 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>> That's odd. I'll look at this this weekend.
>> 
>> y
>> 
>> On Jan 23, 2015 11:07 AM, "Greg Morrisett" <greg at eecs.harvard.edu> wrote:
>>> 
>>> Thanks.
>>> 
>>> Your dot-emacs and dot-merlin work (with tuareg-2.0.8 which
>>> is what opam installs now.)
>>> 
>>> However, font lock mode doesn?t automatically trigger on either
>>> emacs or aquamacs, in spite of the fact that I added:
>>> 
>>>  (global-font-lock-mode t)
>>> 
>>> If I add a hook to try to explicitly turn on font-lock:
>>> 
>>>  (add-hook 'tuareg-mode-hook 'font-lock-fontify-buffer t)
>>> 
>>> then I get the error:
>>> 
>>>  Warning: Bug in tuareg-mode: it forgets to call `run-mode-hooks'
>>>  File mode specification error: (void-function tuareg-syntax-propertize)
>>> 
>>> -Greg
>>> 
>>>> On Jan 22, 2015, at 9:58 PM, Yaron Minsky <yminsky at janestreet.com>
>>>> wrote:
>>>> 
>>>> In the meantime, I've attached a dot-emacs and dot-merlin files that I
>>>> think work nicely on a mac.  The one thing you need to do is to add
>>>> this line to your .profile file:
>>>> 
>>>>  eval `opam config env`
>>>> 
>>>> The dot emacs depends on this being in place for figuring out where to
>>>> find all the executables stashed in the .opam directory.
>>>> 
>>>> The pre-reqs for this to work is getting tuareg downloaded and in the
>>>> proper path (right now, I assume ~/.elisp/tuareg-mode), and installing
>>>> some opam packages:
>>>> 
>>>>  opam install core async merlin utop ocp-indent
>>>> 
>>>> This should give you merlin, ocp-indent, tuareg, and utop support, all
>>>> nicely integrated.  Note that the .merlin file needs to go in the
>>>> directory where you're editing code (and really, in every directory
>>>> where you're editing code.)  And the .merlin assumes that you're using
>>>> ocamlbuild (or corebuild) and so are putting your build artifacts in
>>>> _build.
>>>> 
>>>> I'm hoping this is helpful.
>>>> 
>>>> y
>>>> 
>>>> On Thu, Jan 22, 2015 at 8:42 PM, Yaron Minsky <yminsky at janestreet.com>
>>>> wrote:
>>>>> On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
>>>>> <louis.gesbert at ocamlpro.com> wrote:
>>>>>> Thanks for the feedback. It's probably still a bit rough at the moment
>>>>>> but the config-updating engine is there, and polishing configuration itself
>>>>>> from there should be straight-forward (and never-ending).
>>>>> 
>>>>> Indeed.  Now I think is the time to really focus on getting it
>>>>> working, because this is the beginning of the semester, and so now is
>>>>> the most valuable time to have something working cleanly.
>>>>> 
>>>>> It would be good to know what we have there now.  It seems like a
>>>>> minimum should be:
>>>>> 
>>>>> - tuareg
>>>>> - merlin
>>>>> - ocp-indent
>>>>> - utop
>>>>> 
>>>>> all read to go in emacs.  Getting vim and sublime text support would
>>>>> be lovely too, but I think less critical.  What does user-setup
>>>>> already support?
>>>>> 
>>>>>> The idea, with this and the "depext" package is to have a setup that
>>>>>> can be limited to:
>>>>>> 
>>>>>>   PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis
>>>>>> ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp
>>>>>> cryptokit menhir"
>>>>>>   opam init -a
>>>>>>   opam install depext
>>>>>>   opam depext $PACKAGES
>>>>>>   opam install $PACKAGES
>>>>>> 
>>>>>> and results in a ready-to-go environment. This is in particular
>>>>>> targetted at VM setup, of course.
>>>>> 
>>>>> Interesting. Concretely, what would would depext do in this context?
>>>>> I did a fresh install of a number of packages on my mac, and I didn't
>>>>> need much else, but I may have already had the dependencies in place
>>>>> via brew.
>>>>> 
>>>>> y
>>>>> 
>>>>>>> - Yaron Minsky, 22/01/2015 10:56 -
>>>>>>> It installed cleanly for me, but it doesn't quite work.  I installed
>>>>>>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
>>>>>>> went through, but when I open a .ml file, it shows up in lisp mode,
>>>>>>> not tuareg.
>>>>>> 
>>>>>> Seems it doesn't handle the opam-installed tuareg package well at the
>>>>>> moment, should be fixed in a moment.
>>>>>> 
>>>>>>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett
>>>>>>> <greg at eecs.harvard.edu> wrote:
>>>>>>>> Okay, I just followed these steps:
>>>>>>>>> 
>>>>>>>>> opam update
>>>>>>>>> opam install user-setup
>>>>>>>> 
>>>>>>>> and it seems to be hanging.  Is there a log file or
>>>>>>>> other config information that I can send you to help
>>>>>>>> figure this out?
>>>>>> 
>>>>>> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it
>>>>>> quickly.
>>>>> 
>>>>> Greg, it's also probably a good idea to encourage your students to
>>>>> upgrade to the latest opam if they're on a mac.  Homebrew is pretty
>>>>> lightweight, and has opam 1.2.0.
>>>>> 
>>>>> y
>>>> <dot-emacs><dot-merlin>
>>> 
>> 


From greg at eecs.harvard.edu  Mon Jan 26 15:02:07 2015
From: greg at eecs.harvard.edu (Greg Morrisett)
Date: Mon, 26 Jan 2015 10:02:07 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <1F49C854-EAA5-48EE-82A6-F693D6C0EE74@eecs.harvard.edu>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
 <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
 <CACLX4jQdAEiPMPWDFH7yJSk3+rUq96Zaf0d6KX0CUJ0t=e6Jgw@mail.gmail.com>
 <CACLX4jT-o2XvHHe-LRgZMFQ-vw86tKyj5biq=7mnmtD-6yG66w@mail.gmail.com>
 <1F49C854-EAA5-48EE-82A6-F693D6C0EE74@eecs.harvard.edu>
Message-ID: <B3450099-DD35-40D0-9EB6-8FB15DFBAD52@eecs.harvard.edu>

One possible difference is that I?m using MacPorts instead of 
Homebrew.  But I?m not sure why that would cause these problems.
I explicitly downloaded the latest (binary) versions of both
emacs and aquamacs.

-Greg

> On Jan 26, 2015, at 10:00 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
> 
> The emacs version is 24.4.1.  The .emacs file is the one you sent
> me.  When I fire this up, font-lock-mode is enabled, but nothing
> is colorized when I load a .ml file.  If I explicitly font-lock-
> fontify-buffer, and then type anything, I get the error message:
> 
>  Symbol?s function definition is void:  tuareg-syntax-propertize
> 
> I?m going to try the most recent head of tuareg to see if this
> fixes the problem.
> 
> (NB:  same behavior under latest Aquamacs.)  
> 
> -Greg
> 
>> On Jan 23, 2015, at 8:54 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>> 
>> Hmm.  Really can't replicate the problem --- font-lock works fine for
>> me.  Greg, can you email out your full .emacs?  And double-check the
>> version of emacs your running?
>> 
>> y
>> 
>> On Fri, Jan 23, 2015 at 6:35 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>>> That's odd. I'll look at this this weekend.
>>> 
>>> y
>>> 
>>> On Jan 23, 2015 11:07 AM, "Greg Morrisett" <greg at eecs.harvard.edu> wrote:
>>>> 
>>>> Thanks.
>>>> 
>>>> Your dot-emacs and dot-merlin work (with tuareg-2.0.8 which
>>>> is what opam installs now.)
>>>> 
>>>> However, font lock mode doesn?t automatically trigger on either
>>>> emacs or aquamacs, in spite of the fact that I added:
>>>> 
>>>> (global-font-lock-mode t)
>>>> 
>>>> If I add a hook to try to explicitly turn on font-lock:
>>>> 
>>>> (add-hook 'tuareg-mode-hook 'font-lock-fontify-buffer t)
>>>> 
>>>> then I get the error:
>>>> 
>>>> Warning: Bug in tuareg-mode: it forgets to call `run-mode-hooks'
>>>> File mode specification error: (void-function tuareg-syntax-propertize)
>>>> 
>>>> -Greg
>>>> 
>>>>> On Jan 22, 2015, at 9:58 PM, Yaron Minsky <yminsky at janestreet.com>
>>>>> wrote:
>>>>> 
>>>>> In the meantime, I've attached a dot-emacs and dot-merlin files that I
>>>>> think work nicely on a mac.  The one thing you need to do is to add
>>>>> this line to your .profile file:
>>>>> 
>>>>> eval `opam config env`
>>>>> 
>>>>> The dot emacs depends on this being in place for figuring out where to
>>>>> find all the executables stashed in the .opam directory.
>>>>> 
>>>>> The pre-reqs for this to work is getting tuareg downloaded and in the
>>>>> proper path (right now, I assume ~/.elisp/tuareg-mode), and installing
>>>>> some opam packages:
>>>>> 
>>>>> opam install core async merlin utop ocp-indent
>>>>> 
>>>>> This should give you merlin, ocp-indent, tuareg, and utop support, all
>>>>> nicely integrated.  Note that the .merlin file needs to go in the
>>>>> directory where you're editing code (and really, in every directory
>>>>> where you're editing code.)  And the .merlin assumes that you're using
>>>>> ocamlbuild (or corebuild) and so are putting your build artifacts in
>>>>> _build.
>>>>> 
>>>>> I'm hoping this is helpful.
>>>>> 
>>>>> y
>>>>> 
>>>>> On Thu, Jan 22, 2015 at 8:42 PM, Yaron Minsky <yminsky at janestreet.com>
>>>>> wrote:
>>>>>> On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
>>>>>> <louis.gesbert at ocamlpro.com> wrote:
>>>>>>> Thanks for the feedback. It's probably still a bit rough at the moment
>>>>>>> but the config-updating engine is there, and polishing configuration itself
>>>>>>> from there should be straight-forward (and never-ending).
>>>>>> 
>>>>>> Indeed.  Now I think is the time to really focus on getting it
>>>>>> working, because this is the beginning of the semester, and so now is
>>>>>> the most valuable time to have something working cleanly.
>>>>>> 
>>>>>> It would be good to know what we have there now.  It seems like a
>>>>>> minimum should be:
>>>>>> 
>>>>>> - tuareg
>>>>>> - merlin
>>>>>> - ocp-indent
>>>>>> - utop
>>>>>> 
>>>>>> all read to go in emacs.  Getting vim and sublime text support would
>>>>>> be lovely too, but I think less critical.  What does user-setup
>>>>>> already support?
>>>>>> 
>>>>>>> The idea, with this and the "depext" package is to have a setup that
>>>>>>> can be limited to:
>>>>>>> 
>>>>>>>  PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis
>>>>>>> ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp
>>>>>>> cryptokit menhir"
>>>>>>>  opam init -a
>>>>>>>  opam install depext
>>>>>>>  opam depext $PACKAGES
>>>>>>>  opam install $PACKAGES
>>>>>>> 
>>>>>>> and results in a ready-to-go environment. This is in particular
>>>>>>> targetted at VM setup, of course.
>>>>>> 
>>>>>> Interesting. Concretely, what would would depext do in this context?
>>>>>> I did a fresh install of a number of packages on my mac, and I didn't
>>>>>> need much else, but I may have already had the dependencies in place
>>>>>> via brew.
>>>>>> 
>>>>>> y
>>>>>> 
>>>>>>>> - Yaron Minsky, 22/01/2015 10:56 -
>>>>>>>> It installed cleanly for me, but it doesn't quite work.  I installed
>>>>>>>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
>>>>>>>> went through, but when I open a .ml file, it shows up in lisp mode,
>>>>>>>> not tuareg.
>>>>>>> 
>>>>>>> Seems it doesn't handle the opam-installed tuareg package well at the
>>>>>>> moment, should be fixed in a moment.
>>>>>>> 
>>>>>>>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett
>>>>>>>> <greg at eecs.harvard.edu> wrote:
>>>>>>>>> Okay, I just followed these steps:
>>>>>>>>>> 
>>>>>>>>>> opam update
>>>>>>>>>> opam install user-setup
>>>>>>>>> 
>>>>>>>>> and it seems to be hanging.  Is there a log file or
>>>>>>>>> other config information that I can send you to help
>>>>>>>>> figure this out?
>>>>>>> 
>>>>>>> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it
>>>>>>> quickly.
>>>>>> 
>>>>>> Greg, it's also probably a good idea to encourage your students to
>>>>>> upgrade to the latest opam if they're on a mac.  Homebrew is pretty
>>>>>> lightweight, and has opam 1.2.0.
>>>>>> 
>>>>>> y
>>>>> <dot-emacs><dot-merlin>
>>>> 
>>> 
> 
> _______________________________________________
> Teaching mailing list
> Teaching at lists.ocaml.org
> http://lists.ocaml.org/listinfo/teaching


From yminsky at janestreet.com  Mon Jan 26 15:31:36 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Mon, 26 Jan 2015 10:31:36 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <B3450099-DD35-40D0-9EB6-8FB15DFBAD52@eecs.harvard.edu>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
 <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
 <CACLX4jQdAEiPMPWDFH7yJSk3+rUq96Zaf0d6KX0CUJ0t=e6Jgw@mail.gmail.com>
 <CACLX4jT-o2XvHHe-LRgZMFQ-vw86tKyj5biq=7mnmtD-6yG66w@mail.gmail.com>
 <1F49C854-EAA5-48EE-82A6-F693D6C0EE74@eecs.harvard.edu>
 <B3450099-DD35-40D0-9EB6-8FB15DFBAD52@eecs.harvard.edu>
Message-ID: <CACLX4jRmJ6CMVyuKd9Jx_Fus4yOtGT-3FBjvnap4S1WqJ+knvg@mail.gmail.com>

And the version of Tuareg is the one from opam?  Did you try
Christophe's suggestion of getting the HEAD release?

y

On Mon, Jan 26, 2015 at 10:02 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
> One possible difference is that I?m using MacPorts instead of
> Homebrew.  But I?m not sure why that would cause these problems.
> I explicitly downloaded the latest (binary) versions of both
> emacs and aquamacs.
>
> -Greg
>
>> On Jan 26, 2015, at 10:00 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
>>
>> The emacs version is 24.4.1.  The .emacs file is the one you sent
>> me.  When I fire this up, font-lock-mode is enabled, but nothing
>> is colorized when I load a .ml file.  If I explicitly font-lock-
>> fontify-buffer, and then type anything, I get the error message:
>>
>>  Symbol?s function definition is void:  tuareg-syntax-propertize
>>
>> I?m going to try the most recent head of tuareg to see if this
>> fixes the problem.
>>
>> (NB:  same behavior under latest Aquamacs.)
>>
>> -Greg
>>
>>> On Jan 23, 2015, at 8:54 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>>>
>>> Hmm.  Really can't replicate the problem --- font-lock works fine for
>>> me.  Greg, can you email out your full .emacs?  And double-check the
>>> version of emacs your running?
>>>
>>> y
>>>
>>> On Fri, Jan 23, 2015 at 6:35 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>>>> That's odd. I'll look at this this weekend.
>>>>
>>>> y
>>>>
>>>> On Jan 23, 2015 11:07 AM, "Greg Morrisett" <greg at eecs.harvard.edu> wrote:
>>>>>
>>>>> Thanks.
>>>>>
>>>>> Your dot-emacs and dot-merlin work (with tuareg-2.0.8 which
>>>>> is what opam installs now.)
>>>>>
>>>>> However, font lock mode doesn?t automatically trigger on either
>>>>> emacs or aquamacs, in spite of the fact that I added:
>>>>>
>>>>> (global-font-lock-mode t)
>>>>>
>>>>> If I add a hook to try to explicitly turn on font-lock:
>>>>>
>>>>> (add-hook 'tuareg-mode-hook 'font-lock-fontify-buffer t)
>>>>>
>>>>> then I get the error:
>>>>>
>>>>> Warning: Bug in tuareg-mode: it forgets to call `run-mode-hooks'
>>>>> File mode specification error: (void-function tuareg-syntax-propertize)
>>>>>
>>>>> -Greg
>>>>>
>>>>>> On Jan 22, 2015, at 9:58 PM, Yaron Minsky <yminsky at janestreet.com>
>>>>>> wrote:
>>>>>>
>>>>>> In the meantime, I've attached a dot-emacs and dot-merlin files that I
>>>>>> think work nicely on a mac.  The one thing you need to do is to add
>>>>>> this line to your .profile file:
>>>>>>
>>>>>> eval `opam config env`
>>>>>>
>>>>>> The dot emacs depends on this being in place for figuring out where to
>>>>>> find all the executables stashed in the .opam directory.
>>>>>>
>>>>>> The pre-reqs for this to work is getting tuareg downloaded and in the
>>>>>> proper path (right now, I assume ~/.elisp/tuareg-mode), and installing
>>>>>> some opam packages:
>>>>>>
>>>>>> opam install core async merlin utop ocp-indent
>>>>>>
>>>>>> This should give you merlin, ocp-indent, tuareg, and utop support, all
>>>>>> nicely integrated.  Note that the .merlin file needs to go in the
>>>>>> directory where you're editing code (and really, in every directory
>>>>>> where you're editing code.)  And the .merlin assumes that you're using
>>>>>> ocamlbuild (or corebuild) and so are putting your build artifacts in
>>>>>> _build.
>>>>>>
>>>>>> I'm hoping this is helpful.
>>>>>>
>>>>>> y
>>>>>>
>>>>>> On Thu, Jan 22, 2015 at 8:42 PM, Yaron Minsky <yminsky at janestreet.com>
>>>>>> wrote:
>>>>>>> On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
>>>>>>> <louis.gesbert at ocamlpro.com> wrote:
>>>>>>>> Thanks for the feedback. It's probably still a bit rough at the moment
>>>>>>>> but the config-updating engine is there, and polishing configuration itself
>>>>>>>> from there should be straight-forward (and never-ending).
>>>>>>>
>>>>>>> Indeed.  Now I think is the time to really focus on getting it
>>>>>>> working, because this is the beginning of the semester, and so now is
>>>>>>> the most valuable time to have something working cleanly.
>>>>>>>
>>>>>>> It would be good to know what we have there now.  It seems like a
>>>>>>> minimum should be:
>>>>>>>
>>>>>>> - tuareg
>>>>>>> - merlin
>>>>>>> - ocp-indent
>>>>>>> - utop
>>>>>>>
>>>>>>> all read to go in emacs.  Getting vim and sublime text support would
>>>>>>> be lovely too, but I think less critical.  What does user-setup
>>>>>>> already support?
>>>>>>>
>>>>>>>> The idea, with this and the "depext" package is to have a setup that
>>>>>>>> can be limited to:
>>>>>>>>
>>>>>>>>  PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis
>>>>>>>> ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp
>>>>>>>> cryptokit menhir"
>>>>>>>>  opam init -a
>>>>>>>>  opam install depext
>>>>>>>>  opam depext $PACKAGES
>>>>>>>>  opam install $PACKAGES
>>>>>>>>
>>>>>>>> and results in a ready-to-go environment. This is in particular
>>>>>>>> targetted at VM setup, of course.
>>>>>>>
>>>>>>> Interesting. Concretely, what would would depext do in this context?
>>>>>>> I did a fresh install of a number of packages on my mac, and I didn't
>>>>>>> need much else, but I may have already had the dependencies in place
>>>>>>> via brew.
>>>>>>>
>>>>>>> y
>>>>>>>
>>>>>>>>> - Yaron Minsky, 22/01/2015 10:56 -
>>>>>>>>> It installed cleanly for me, but it doesn't quite work.  I installed
>>>>>>>>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
>>>>>>>>> went through, but when I open a .ml file, it shows up in lisp mode,
>>>>>>>>> not tuareg.
>>>>>>>>
>>>>>>>> Seems it doesn't handle the opam-installed tuareg package well at the
>>>>>>>> moment, should be fixed in a moment.
>>>>>>>>
>>>>>>>>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett
>>>>>>>>> <greg at eecs.harvard.edu> wrote:
>>>>>>>>>> Okay, I just followed these steps:
>>>>>>>>>>>
>>>>>>>>>>> opam update
>>>>>>>>>>> opam install user-setup
>>>>>>>>>>
>>>>>>>>>> and it seems to be hanging.  Is there a log file or
>>>>>>>>>> other config information that I can send you to help
>>>>>>>>>> figure this out?
>>>>>>>>
>>>>>>>> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it
>>>>>>>> quickly.
>>>>>>>
>>>>>>> Greg, it's also probably a good idea to encourage your students to
>>>>>>> upgrade to the latest opam if they're on a mac.  Homebrew is pretty
>>>>>>> lightweight, and has opam 1.2.0.
>>>>>>>
>>>>>>> y
>>>>>> <dot-emacs><dot-merlin>
>>>>>
>>>>
>>
>> _______________________________________________
>> Teaching mailing list
>> Teaching at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/teaching
>

From greg at eecs.harvard.edu  Mon Jan 26 16:07:32 2015
From: greg at eecs.harvard.edu (Greg Morrisett)
Date: Mon, 26 Jan 2015 11:07:32 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jRmJ6CMVyuKd9Jx_Fus4yOtGT-3FBjvnap4S1WqJ+knvg@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
 <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
 <CACLX4jQdAEiPMPWDFH7yJSk3+rUq96Zaf0d6KX0CUJ0t=e6Jgw@mail.gmail.com>
 <CACLX4jT-o2XvHHe-LRgZMFQ-vw86tKyj5biq=7mnmtD-6yG66w@mail.gmail.com>
 <1F49C854-EAA5-48EE-82A6-F693D6C0EE74@eecs.harvard.edu>
 <B3450099-DD35-40D0-9EB6-8FB15DFBAD52@eecs.harvard.edu>
 <CACLX4jRmJ6CMVyuKd9Jx_Fus4yOtGT-3FBjvnap4S1WqJ+knvg@mail.gmail.com>
Message-ID: <BB086E41-47FB-4B87-A89C-F6EBA91DB65B@eecs.harvard.edu>


> On Jan 26, 2015, at 10:31 AM, Yaron Minsky <yminsky at janestreet.com> wrote:
> 
> And the version of Tuareg is the one from opam?  Did you try
> Christophe's suggestion of getting the HEAD release?

It?s 2.0.8 which is the one that opam installed for me.  I will
try the HEAD release when I get a chance.

-Greg


From greg at eecs.harvard.edu  Tue Jan 27 14:31:56 2015
From: greg at eecs.harvard.edu (Greg Morrisett)
Date: Tue, 27 Jan 2015 09:31:56 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <CACLX4jRmJ6CMVyuKd9Jx_Fus4yOtGT-3FBjvnap4S1WqJ+knvg@mail.gmail.com>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
 <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
 <CACLX4jQdAEiPMPWDFH7yJSk3+rUq96Zaf0d6KX0CUJ0t=e6Jgw@mail.gmail.com>
 <CACLX4jT-o2XvHHe-LRgZMFQ-vw86tKyj5biq=7mnmtD-6yG66w@mail.gmail.com>
 <1F49C854-EAA5-48EE-82A6-F693D6C0EE74@eecs.harvard.edu>
 <B3450099-DD35-40D0-9EB6-8FB15DFBAD52@eecs.harvard.edu>
 <CACLX4jRmJ6CMVyuKd9Jx_Fus4yOtGT-3FBjvnap4S1WqJ+knvg@mail.gmail.com>
Message-ID: <3F99B037-1D91-41A1-B715-F6BBF664A2C6@eecs.harvard.edu>

Thanks to Kenichi Asai, I?ve gotten this fixed.  The issue is that
the .elc files weren?t wiped out from the previous buggy version
of tuareg.  Deleting those fixed the problem.  

-Greg

> On Jan 26, 2015, at 10:31 AM, Yaron Minsky <yminsky at janestreet.com> wrote:
> 
> And the version of Tuareg is the one from opam?  Did you try
> Christophe's suggestion of getting the HEAD release?
> 
> y
> 
> On Mon, Jan 26, 2015 at 10:02 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
>> One possible difference is that I?m using MacPorts instead of
>> Homebrew.  But I?m not sure why that would cause these problems.
>> I explicitly downloaded the latest (binary) versions of both
>> emacs and aquamacs.
>> 
>> -Greg
>> 
>>> On Jan 26, 2015, at 10:00 AM, Greg Morrisett <greg at eecs.harvard.edu> wrote:
>>> 
>>> The emacs version is 24.4.1.  The .emacs file is the one you sent
>>> me.  When I fire this up, font-lock-mode is enabled, but nothing
>>> is colorized when I load a .ml file.  If I explicitly font-lock-
>>> fontify-buffer, and then type anything, I get the error message:
>>> 
>>> Symbol?s function definition is void:  tuareg-syntax-propertize
>>> 
>>> I?m going to try the most recent head of tuareg to see if this
>>> fixes the problem.
>>> 
>>> (NB:  same behavior under latest Aquamacs.)
>>> 
>>> -Greg
>>> 
>>>> On Jan 23, 2015, at 8:54 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>>>> 
>>>> Hmm.  Really can't replicate the problem --- font-lock works fine for
>>>> me.  Greg, can you email out your full .emacs?  And double-check the
>>>> version of emacs your running?
>>>> 
>>>> y
>>>> 
>>>> On Fri, Jan 23, 2015 at 6:35 PM, Yaron Minsky <yminsky at janestreet.com> wrote:
>>>>> That's odd. I'll look at this this weekend.
>>>>> 
>>>>> y
>>>>> 
>>>>> On Jan 23, 2015 11:07 AM, "Greg Morrisett" <greg at eecs.harvard.edu> wrote:
>>>>>> 
>>>>>> Thanks.
>>>>>> 
>>>>>> Your dot-emacs and dot-merlin work (with tuareg-2.0.8 which
>>>>>> is what opam installs now.)
>>>>>> 
>>>>>> However, font lock mode doesn?t automatically trigger on either
>>>>>> emacs or aquamacs, in spite of the fact that I added:
>>>>>> 
>>>>>> (global-font-lock-mode t)
>>>>>> 
>>>>>> If I add a hook to try to explicitly turn on font-lock:
>>>>>> 
>>>>>> (add-hook 'tuareg-mode-hook 'font-lock-fontify-buffer t)
>>>>>> 
>>>>>> then I get the error:
>>>>>> 
>>>>>> Warning: Bug in tuareg-mode: it forgets to call `run-mode-hooks'
>>>>>> File mode specification error: (void-function tuareg-syntax-propertize)
>>>>>> 
>>>>>> -Greg
>>>>>> 
>>>>>>> On Jan 22, 2015, at 9:58 PM, Yaron Minsky <yminsky at janestreet.com>
>>>>>>> wrote:
>>>>>>> 
>>>>>>> In the meantime, I've attached a dot-emacs and dot-merlin files that I
>>>>>>> think work nicely on a mac.  The one thing you need to do is to add
>>>>>>> this line to your .profile file:
>>>>>>> 
>>>>>>> eval `opam config env`
>>>>>>> 
>>>>>>> The dot emacs depends on this being in place for figuring out where to
>>>>>>> find all the executables stashed in the .opam directory.
>>>>>>> 
>>>>>>> The pre-reqs for this to work is getting tuareg downloaded and in the
>>>>>>> proper path (right now, I assume ~/.elisp/tuareg-mode), and installing
>>>>>>> some opam packages:
>>>>>>> 
>>>>>>> opam install core async merlin utop ocp-indent
>>>>>>> 
>>>>>>> This should give you merlin, ocp-indent, tuareg, and utop support, all
>>>>>>> nicely integrated.  Note that the .merlin file needs to go in the
>>>>>>> directory where you're editing code (and really, in every directory
>>>>>>> where you're editing code.)  And the .merlin assumes that you're using
>>>>>>> ocamlbuild (or corebuild) and so are putting your build artifacts in
>>>>>>> _build.
>>>>>>> 
>>>>>>> I'm hoping this is helpful.
>>>>>>> 
>>>>>>> y
>>>>>>> 
>>>>>>> On Thu, Jan 22, 2015 at 8:42 PM, Yaron Minsky <yminsky at janestreet.com>
>>>>>>> wrote:
>>>>>>>> On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
>>>>>>>> <louis.gesbert at ocamlpro.com> wrote:
>>>>>>>>> Thanks for the feedback. It's probably still a bit rough at the moment
>>>>>>>>> but the config-updating engine is there, and polishing configuration itself
>>>>>>>>> from there should be straight-forward (and never-ending).
>>>>>>>> 
>>>>>>>> Indeed.  Now I think is the time to really focus on getting it
>>>>>>>> working, because this is the beginning of the semester, and so now is
>>>>>>>> the most valuable time to have something working cleanly.
>>>>>>>> 
>>>>>>>> It would be good to know what we have there now.  It seems like a
>>>>>>>> minimum should be:
>>>>>>>> 
>>>>>>>> - tuareg
>>>>>>>> - merlin
>>>>>>>> - ocp-indent
>>>>>>>> - utop
>>>>>>>> 
>>>>>>>> all read to go in emacs.  Getting vim and sublime text support would
>>>>>>>> be lovely too, but I think less critical.  What does user-setup
>>>>>>>> already support?
>>>>>>>> 
>>>>>>>>> The idea, with this and the "depext" package is to have a setup that
>>>>>>>>> can be limited to:
>>>>>>>>> 
>>>>>>>>> PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis
>>>>>>>>> ocp-indent ocp-index ssl core_extended async js_of_ocaml core_bench cohttp
>>>>>>>>> cryptokit menhir"
>>>>>>>>> opam init -a
>>>>>>>>> opam install depext
>>>>>>>>> opam depext $PACKAGES
>>>>>>>>> opam install $PACKAGES
>>>>>>>>> 
>>>>>>>>> and results in a ready-to-go environment. This is in particular
>>>>>>>>> targetted at VM setup, of course.
>>>>>>>> 
>>>>>>>> Interesting. Concretely, what would would depext do in this context?
>>>>>>>> I did a fresh install of a number of packages on my mac, and I didn't
>>>>>>>> need much else, but I may have already had the dependencies in place
>>>>>>>> via brew.
>>>>>>>> 
>>>>>>>> y
>>>>>>>> 
>>>>>>>>>> - Yaron Minsky, 22/01/2015 10:56 -
>>>>>>>>>> It installed cleanly for me, but it doesn't quite work.  I installed
>>>>>>>>>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.  It all
>>>>>>>>>> went through, but when I open a .ml file, it shows up in lisp mode,
>>>>>>>>>> not tuareg.
>>>>>>>>> 
>>>>>>>>> Seems it doesn't handle the opam-installed tuareg package well at the
>>>>>>>>> moment, should be fixed in a moment.
>>>>>>>>> 
>>>>>>>>>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett
>>>>>>>>>> <greg at eecs.harvard.edu> wrote:
>>>>>>>>>>> Okay, I just followed these steps:
>>>>>>>>>>>> 
>>>>>>>>>>>> opam update
>>>>>>>>>>>> opam install user-setup
>>>>>>>>>>> 
>>>>>>>>>>> and it seems to be hanging.  Is there a log file or
>>>>>>>>>>> other config information that I can send you to help
>>>>>>>>>>> figure this out?
>>>>>>>>> 
>>>>>>>>> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix it
>>>>>>>>> quickly.
>>>>>>>> 
>>>>>>>> Greg, it's also probably a good idea to encourage your students to
>>>>>>>> upgrade to the latest opam if they're on a mac.  Homebrew is pretty
>>>>>>>> lightweight, and has opam 1.2.0.
>>>>>>>> 
>>>>>>>> y
>>>>>>> <dot-emacs><dot-merlin>
>>>>>> 
>>>>> 
>>> 
>>> _______________________________________________
>>> Teaching mailing list
>>> Teaching at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/teaching
>> 


From yminsky at janestreet.com  Tue Jan 27 14:47:34 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Tue, 27 Jan 2015 09:47:34 -0500
Subject: [Teaching] Getting OCaml set up on a mac
In-Reply-To: <3F99B037-1D91-41A1-B715-F6BBF664A2C6@eecs.harvard.edu>
References: <CACLX4jS3MXYh_TiLXOzeNOPAQ3keLJypf5N_qXUJM15YF+9NFA@mail.gmail.com>
 <08D08B62-9F0D-470C-A414-9B5D8D38D957@eecs.harvard.edu>
 <CACLX4jS6hingQ9fsfLS5ttdcQUTGE4U3ijUe0uo+Qif+swufzQ@mail.gmail.com>
 <6106071.p2W8OPbTpf@agaric>
 <CACLX4jR9p4nU32JZY9M9qxF8E_MKKmjBZy34HK-eGEGdDdB9ag@mail.gmail.com>
 <CACLX4jR55_qg+5NEmpam9c=kpOZmEAORtvb2K9P0rvnD3DE5zQ@mail.gmail.com>
 <F729D1F8-6130-4FBE-A949-87A565E5EAA8@eecs.harvard.edu>
 <CACLX4jQdAEiPMPWDFH7yJSk3+rUq96Zaf0d6KX0CUJ0t=e6Jgw@mail.gmail.com>
 <CACLX4jT-o2XvHHe-LRgZMFQ-vw86tKyj5biq=7mnmtD-6yG66w@mail.gmail.com>
 <1F49C854-EAA5-48EE-82A6-F693D6C0EE74@eecs.harvard.edu>
 <B3450099-DD35-40D0-9EB6-8FB15DFBAD52@eecs.harvard.edu>
 <CACLX4jRmJ6CMVyuKd9Jx_Fus4yOtGT-3FBjvnap4S1WqJ+knvg@mail.gmail.com>
 <3F99B037-1D91-41A1-B715-F6BBF664A2C6@eecs.harvard.edu>
Message-ID: <CACLX4jQpKk60hBcG8_Wioe_eKHz0QT96_SvZcDq5rsS1Cee8qA@mail.gmail.com>

Lovely.  Hopefully it's smooth sailing from here...

(Famous last word)

y
On Jan 27, 2015 9:31 AM, "Greg Morrisett" <greg at eecs.harvard.edu> wrote:

> Thanks to Kenichi Asai, I?ve gotten this fixed.  The issue is that
> the .elc files weren?t wiped out from the previous buggy version
> of tuareg.  Deleting those fixed the problem.
>
> -Greg
>
> > On Jan 26, 2015, at 10:31 AM, Yaron Minsky <yminsky at janestreet.com>
> wrote:
> >
> > And the version of Tuareg is the one from opam?  Did you try
> > Christophe's suggestion of getting the HEAD release?
> >
> > y
> >
> > On Mon, Jan 26, 2015 at 10:02 AM, Greg Morrisett <greg at eecs.harvard.edu>
> wrote:
> >> One possible difference is that I?m using MacPorts instead of
> >> Homebrew.  But I?m not sure why that would cause these problems.
> >> I explicitly downloaded the latest (binary) versions of both
> >> emacs and aquamacs.
> >>
> >> -Greg
> >>
> >>> On Jan 26, 2015, at 10:00 AM, Greg Morrisett <greg at eecs.harvard.edu>
> wrote:
> >>>
> >>> The emacs version is 24.4.1.  The .emacs file is the one you sent
> >>> me.  When I fire this up, font-lock-mode is enabled, but nothing
> >>> is colorized when I load a .ml file.  If I explicitly font-lock-
> >>> fontify-buffer, and then type anything, I get the error message:
> >>>
> >>> Symbol?s function definition is void:  tuareg-syntax-propertize
> >>>
> >>> I?m going to try the most recent head of tuareg to see if this
> >>> fixes the problem.
> >>>
> >>> (NB:  same behavior under latest Aquamacs.)
> >>>
> >>> -Greg
> >>>
> >>>> On Jan 23, 2015, at 8:54 PM, Yaron Minsky <yminsky at janestreet.com>
> wrote:
> >>>>
> >>>> Hmm.  Really can't replicate the problem --- font-lock works fine for
> >>>> me.  Greg, can you email out your full .emacs?  And double-check the
> >>>> version of emacs your running?
> >>>>
> >>>> y
> >>>>
> >>>> On Fri, Jan 23, 2015 at 6:35 PM, Yaron Minsky <yminsky at janestreet.com>
> wrote:
> >>>>> That's odd. I'll look at this this weekend.
> >>>>>
> >>>>> y
> >>>>>
> >>>>> On Jan 23, 2015 11:07 AM, "Greg Morrisett" <greg at eecs.harvard.edu>
> wrote:
> >>>>>>
> >>>>>> Thanks.
> >>>>>>
> >>>>>> Your dot-emacs and dot-merlin work (with tuareg-2.0.8 which
> >>>>>> is what opam installs now.)
> >>>>>>
> >>>>>> However, font lock mode doesn?t automatically trigger on either
> >>>>>> emacs or aquamacs, in spite of the fact that I added:
> >>>>>>
> >>>>>> (global-font-lock-mode t)
> >>>>>>
> >>>>>> If I add a hook to try to explicitly turn on font-lock:
> >>>>>>
> >>>>>> (add-hook 'tuareg-mode-hook 'font-lock-fontify-buffer t)
> >>>>>>
> >>>>>> then I get the error:
> >>>>>>
> >>>>>> Warning: Bug in tuareg-mode: it forgets to call `run-mode-hooks'
> >>>>>> File mode specification error: (void-function
> tuareg-syntax-propertize)
> >>>>>>
> >>>>>> -Greg
> >>>>>>
> >>>>>>> On Jan 22, 2015, at 9:58 PM, Yaron Minsky <yminsky at janestreet.com>
> >>>>>>> wrote:
> >>>>>>>
> >>>>>>> In the meantime, I've attached a dot-emacs and dot-merlin files
> that I
> >>>>>>> think work nicely on a mac.  The one thing you need to do is to add
> >>>>>>> this line to your .profile file:
> >>>>>>>
> >>>>>>> eval `opam config env`
> >>>>>>>
> >>>>>>> The dot emacs depends on this being in place for figuring out
> where to
> >>>>>>> find all the executables stashed in the .opam directory.
> >>>>>>>
> >>>>>>> The pre-reqs for this to work is getting tuareg downloaded and in
> the
> >>>>>>> proper path (right now, I assume ~/.elisp/tuareg-mode), and
> installing
> >>>>>>> some opam packages:
> >>>>>>>
> >>>>>>> opam install core async merlin utop ocp-indent
> >>>>>>>
> >>>>>>> This should give you merlin, ocp-indent, tuareg, and utop support,
> all
> >>>>>>> nicely integrated.  Note that the .merlin file needs to go in the
> >>>>>>> directory where you're editing code (and really, in every directory
> >>>>>>> where you're editing code.)  And the .merlin assumes that you're
> using
> >>>>>>> ocamlbuild (or corebuild) and so are putting your build artifacts
> in
> >>>>>>> _build.
> >>>>>>>
> >>>>>>> I'm hoping this is helpful.
> >>>>>>>
> >>>>>>> y
> >>>>>>>
> >>>>>>> On Thu, Jan 22, 2015 at 8:42 PM, Yaron Minsky <
> yminsky at janestreet.com>
> >>>>>>> wrote:
> >>>>>>>> On Thu, Jan 22, 2015 at 8:25 PM, Louis Gesbert
> >>>>>>>> <louis.gesbert at ocamlpro.com> wrote:
> >>>>>>>>> Thanks for the feedback. It's probably still a bit rough at the
> moment
> >>>>>>>>> but the config-updating engine is there, and polishing
> configuration itself
> >>>>>>>>> from there should be straight-forward (and never-ending).
> >>>>>>>>
> >>>>>>>> Indeed.  Now I think is the time to really focus on getting it
> >>>>>>>> working, because this is the beginning of the semester, and so
> now is
> >>>>>>>> the most valuable time to have something working cleanly.
> >>>>>>>>
> >>>>>>>> It would be good to know what we have there now.  It seems like a
> >>>>>>>> minimum should be:
> >>>>>>>>
> >>>>>>>> - tuareg
> >>>>>>>> - merlin
> >>>>>>>> - ocp-indent
> >>>>>>>> - utop
> >>>>>>>>
> >>>>>>>> all read to go in emacs.  Getting vim and sublime text support
> would
> >>>>>>>> be lovely too, but I think less critical.  What does user-setup
> >>>>>>>> already support?
> >>>>>>>>
> >>>>>>>>> The idea, with this and the "depext" package is to have a setup
> that
> >>>>>>>>> can be limited to:
> >>>>>>>>>
> >>>>>>>>> PACKAGES="user-setup merlin utop cohttp js_of_ocaml oasis
> >>>>>>>>> ocp-indent ocp-index ssl core_extended async js_of_ocaml
> core_bench cohttp
> >>>>>>>>> cryptokit menhir"
> >>>>>>>>> opam init -a
> >>>>>>>>> opam install depext
> >>>>>>>>> opam depext $PACKAGES
> >>>>>>>>> opam install $PACKAGES
> >>>>>>>>>
> >>>>>>>>> and results in a ready-to-go environment. This is in particular
> >>>>>>>>> targetted at VM setup, of course.
> >>>>>>>>
> >>>>>>>> Interesting. Concretely, what would would depext do in this
> context?
> >>>>>>>> I did a fresh install of a number of packages on my mac, and I
> didn't
> >>>>>>>> need much else, but I may have already had the dependencies in
> place
> >>>>>>>> via brew.
> >>>>>>>>
> >>>>>>>> y
> >>>>>>>>
> >>>>>>>>>> - Yaron Minsky, 22/01/2015 10:56 -
> >>>>>>>>>> It installed cleanly for me, but it doesn't quite work.  I
> installed
> >>>>>>>>>> user-setup, merlin, ocp-indent, tuareg, utop, core and async.
> It all
> >>>>>>>>>> went through, but when I open a .ml file, it shows up in lisp
> mode,
> >>>>>>>>>> not tuareg.
> >>>>>>>>>
> >>>>>>>>> Seems it doesn't handle the opam-installed tuareg package well
> at the
> >>>>>>>>> moment, should be fixed in a moment.
> >>>>>>>>>
> >>>>>>>>>> On Thu, Jan 22, 2015 at 10:54 AM, Greg Morrisett
> >>>>>>>>>> <greg at eecs.harvard.edu> wrote:
> >>>>>>>>>>> Okay, I just followed these steps:
> >>>>>>>>>>>>
> >>>>>>>>>>>> opam update
> >>>>>>>>>>>> opam install user-setup
> >>>>>>>>>>>
> >>>>>>>>>>> and it seems to be hanging.  Is there a log file or
> >>>>>>>>>>> other config information that I can send you to help
> >>>>>>>>>>> figure this out?
> >>>>>>>>>
> >>>>>>>>> Thanks. I just managed to reproduce on OPAM 1.1 and hope to fix
> it
> >>>>>>>>> quickly.
> >>>>>>>>
> >>>>>>>> Greg, it's also probably a good idea to encourage your students to
> >>>>>>>> upgrade to the latest opam if they're on a mac.  Homebrew is
> pretty
> >>>>>>>> lightweight, and has opam 1.2.0.
> >>>>>>>>
> >>>>>>>> y
> >>>>>>> <dot-emacs><dot-merlin>
> >>>>>>
> >>>>>
> >>>
> >>> _______________________________________________
> >>> Teaching mailing list
> >>> Teaching at lists.ocaml.org
> >>> http://lists.ocaml.org/listinfo/teaching
> >>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/teaching/attachments/20150127/54395365/attachment-0001.html>

