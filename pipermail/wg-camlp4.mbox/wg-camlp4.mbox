From alain@frisch.fr  Thu Jan 24 14:26:56 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C60713C11A
 for <wg-camlp4@lists.ocaml.org>; Thu, 24 Jan 2013 14:26:56 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.3 from SpamAssassin-3.3.2-1437299 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
 *  0.3 URIBL_RHS_DOB Contains an URI of a new domain (Day Old Bread)
 *      [URIs: lpw25.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:34751
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TyNpV-0001g6-R2 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Thu, 24 Jan 2013 14:31:03 +0000
Received: from [192.168.1.105] ([90.2.82.74]) by mwinf5d07 with ME
 id rqX01k00V1cCdve03qX0Xj; Thu, 24 Jan 2013 15:31:00 +0100
Message-ID: <510145A5.6030807@frisch.fr>
Date: Thu, 24 Jan 2013 15:31:01 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: caml-list <caml-list@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Anil Madhavapeddy <avsm2@cl.cam.ac.uk>
Subject: [wg-camlp4] Working Group: the future of syntax extensions in OCaml,
	after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 24 Jan 2013 14:26:56 -0000

Dear caml-list,

There is a growing opinion that camlp4 is overly complex considering the 
benefits it brings to OCaml developers.  I would personally go as far as 
to say that the future of OCaml and the OCaml community would be 
brighter if camlp4 could be removed from our "basic ecosystem".  In 
particular, most of the current uses of camlp4 to create syntax 
extensions could probably be replaced by the new "-ppx" technology (see 
below) and small extensions to the compilers.

A lot needs to happens for this camlp4-free OCaml ecosystem to become a 
reality and we have to come up with a solid transition plan.  A new 
community-driven working group, chaired by Leo White and me, is being 
set up today to elaborate this plan.  If this topic is of interest to 
you, please join our mailing list:

   http://lists.ocaml.org/listinfo/wg-camlp4


Some of the most important tasks for our new working group will be:

  - Gather information from the community about the use of camlp4.
    (Please consider sharing information about your use of camlp4
    and camlp4-based extensions, even if you don't plan to participate
    to the working group discussions!)

  - Finalize support for -ppx and make technical proposals for
    extensions of the OCaml compilers in order to enable a transition of
    camlp4-based extensions to -ppx (in particular, we need to come up
    with a concrete syntax for generic extension points in the grammar).

  - Write some "canonical" examples of extensions based on -ppx and
    provide information and support to developers of extensions for
    switching from camlp4 to -ppx.

  - Discuss integration of -ppx with existing tools (findlib, build
    systems, etc).

  - Find a solution in the community for the future of camlp4
    (in particular, discuss how / how long / by who it will be
    maintained).

  - Discuss longer-terms plans beyond -ppx, including extra language
    support, to facilitate light syntactic meta-programming for OCaml
    (Leo has some clever ideas!).



The discussion on the mailing list will start in a few days, to give 
some time for interested people to join.  In the meanwhile, Leo has 
written a blog post to get the discussion started:

  http://www.lpw25.net/2013/01/23/camlp4-alternative-part-1.html

You can also read about -ppx:

  http://www.lexifi.com/blog/syntax-extensions-without-camlp4
  http://www.lexifi.com/blog/syntax-extensions-without-camlp4-lets-do-it

Some projects have already started to replace camlp4 by -ppx:

   bisect (supports both camlp4 and ppx since version 1.3)
   sedlex (unicode-friendly lexer generator, successor of ulex)
   omonad (syntax for monadic code, similar to pa_monad)


Many thanks to Anil Madhavapeddy and to OCamlLabs for setting up the 
working group and its mailing list!


Alain

From daniel.buenzli@erratique.ch  Thu Jan 24 15:53:38 2013
Return-Path: <daniel.buenzli@erratique.ch>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8DE273C208
 for <wg-camlp4@lists.ocaml.org>; Thu, 24 Jan 2013 15:53:38 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.0 from SpamAssassin-3.3.2-1437299 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [178.197.234.23 listed in rbl-plus.mail-abuse.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail6.webfaction.com ([74.55.86.74]:44334
 helo=smtp.webfaction.com)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TyPBP-0006jH-Wk (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <daniel.buenzli@erratique.ch>); Thu, 24 Jan 2013 15:57:45 +0000
Received: from [172.20.10.2] (23-234.197-178.cust.bluewin.ch [178.197.234.23])
 by smtp.webfaction.com (Postfix) with ESMTP id 9439F20B1DA7;
 Thu, 24 Jan 2013 15:57:40 +0000 (UTC)
Date: Thu, 24 Jan 2013 16:57:37 +0100
From: =?utf-8?Q?Daniel_B=C3=BCnzli?= <daniel.buenzli@erratique.ch>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <90C5BC201F264C4C902B4E7897660042@erratique.ch>
In-Reply-To: <510145A5.6030807@frisch.fr>
References: <510145A5.6030807@frisch.fr>
X-Mailer: sparrow 1.6.4 (build 1178)
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
Cc: wg-camlp4@lists.ocaml.org, Anil Madhavapeddy <avsm2@cl.cam.ac.uk>,
 caml-list <caml-list@inria.fr>
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 24 Jan 2013 15:53:38 -0000

Le jeudi, 24 janvier 2013 =C3=A0 15:31, Alain =46risch a =C3=A9crit :
> - Gather information from the community about the use of camlp4.
> (Please consider sharing information about your use of camlp4
> and camlp4-based extensions, even if you don't plan to participate
> to the working group discussions=21)

I tried to disable camlp4 to compile OCaml 4.00.1 on a raspberry pi --- t=
akes half the (long) compilation time, and allows you to compile OCaml wi=
thout having to increase the swap size of the default raspbian image to p=
revent the system from crashing during camlp4 compilation...

However one thing I learned is that currently, it's pretty a no go as cam=
lp4 is needed by ocamlfind which means that if you use something like opa=
m to install software you can't install any of the 'required by' packages=
 mentioned on this page =5B1=5D. =20

So it seems that to get rid of camlp4, ocamlfind needs to get rid of caml=
p4, I'd be interested in what Gerd has to say about that (I have no idea =
if camlp4 is used by the tool itself or if it's just needed to provide su=
pport for camlp4). =20

Best,

Daniel

=5B1=5D http://opam.ocamlpro.com/pkg/ocamlfind.1.3.3.html

From info@gerd-stolpmann.de  Thu Jan 24 16:20:19 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 2A0153C208
 for <wg-camlp4@lists.ocaml.org>; Thu, 24 Jan 2013 16:20:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1437299 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.17.8 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.17.8]:53068)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TyPbE-0003C4-YU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Thu, 24 Jan 2013 16:24:25 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-211-172.pools.arcor-ip.net
 [94.219.211.172])
 by mrelayeu.kundenserver.de (node=mrbap1) with ESMTP (Nemesis)
 id 0Lf0ON-1UoWK42GEh-00qJgY; Thu, 24 Jan 2013 17:24:19 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 1EF0DC00CF;
 Thu, 24 Jan 2013 17:24:19 +0100 (CET)
Date: Thu, 24 Jan 2013 17:24:19 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Daniel =?iso-8859-1?q?B=FCnzli?= <daniel.buenzli@erratique.ch>
References: <510145A5.6030807@frisch.fr>
 <90C5BC201F264C4C902B4E7897660042@erratique.ch>
In-Reply-To: <90C5BC201F264C4C902B4E7897660042@erratique.ch> (from
 daniel.buenzli@erratique.ch on Thu Jan 24 16:57:37 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359044659.30715.4@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-15; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:dn38IU15M3b64+Hga+5NXRdkFCxZKDAVPUx3HhO7MFA
 i9JGQh7IHzkaPuhAWKVBjJCfZeZNV6KFPh0rLIc2l1rEamLtx0
 iA06ftNIvt177KgRIw01Ry2vs2J7G6iHWQFik5U6qHII2Dr9Mz
 DCkCZsz0y3J014TgxeCCKY6h7oy7OkamTr3QqRn/inpRTBI7bV
 OybVjGwwbo/e6xhvAZQdsePIdGl9bnVjDbp1smcrVAeXi7QPIk
 eyy/b/EYRWuGT3w1FHTIjCd/3ReerBXFx1R+0JvAsqmAy8oWtc
 mh19bkIWPdCd2mUuzt4RF+P3mNinRfLzcG4Oqp4XXgrvb71a3L
 74xBsJwoOhWEpMa+c+NH6f7PRm8nJXKNoEtzxevH/
Cc: wg-camlp4@lists.ocaml.org, Anil Madhavapeddy <avsm2@cl.cam.ac.uk>,
 caml-list <caml-list@inria.fr>
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 24 Jan 2013 16:20:19 -0000

Am 24.01.2013 16:57:37 schrieb(en) Daniel B=FCnzli:
> Le jeudi, 24 janvier 2013 =E0 15:31, Alain Frisch a =E9crit :
> > - Gather information from the community about the use of camlp4.
> > (Please consider sharing information about your use of camlp4
> > and camlp4-based extensions, even if you don't plan to participate
> > to the working group discussions!)
>=20
> I tried to disable camlp4 to compile OCaml 4.00.1 on a raspberry pi =20
> --- takes half the (long) compilation time, and allows you to compile =20
> OCaml without having to increase the swap size of the default =20
> raspbian image to prevent the system from crashing during camlp4 =20
> compilation...
>=20
> However one thing I learned is that currently, it's pretty a no go as =20
> camlp4 is needed by ocamlfind which means that if you use something =20
> like opam to install software you can't install any of the 'required =20
> by' packages mentioned on this page [1].
>=20
> So it seems that to get rid of camlp4, ocamlfind needs to get rid of =20
> camlp4, I'd be interested in what Gerd has to say about that (I have =20
> no idea if camlp4 is used by the tool itself or if it's just needed =20
> to provide support for camlp4).

It's used in the tool, but only for stream parsing. I could also =20
distribute the already-preprocessed file (and maybe I'll do so in the =20
next release).

Stream parsing is certainly one of the topics to discuss.

Just fyi, findlib was originally developed at a time when camlp4 was =20
separately distributed, and stream parsing was supported by core OCaml =20
w/o camlp4.

Gerd


>=20
> Best,
>=20
> Daniel
>=20
> [1] http://opam.ocamlpro.com/pkg/ocamlfind.1.3.3.html
>=20
> --
> Caml-list mailing list.  Subscription management and archives:
> https://sympa.inria.fr/sympa/arc/caml-list
> Beginner's list: http://groups.yahoo.com/group/ocaml_beginners
> Bug reports: http://caml.inria.fr/bin/caml-bugs
>=20



--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From john.r.harrison@intel.com  Thu Jan 24 22:59:44 2013
Return-Path: <john.r.harrison@intel.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A7B603C208
 for <wg-camlp4@lists.ocaml.org>; Thu, 24 Jan 2013 22:59:44 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.0 from SpamAssassin-3.3.2-1437299 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [143.182.124.21 listed in list.dnswl.dnsbl.ja.net]
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mga03.intel.com ([143.182.124.21]:37794)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TyVpm-00048N-rt (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <john.r.harrison@intel.com>); Thu, 24 Jan 2013 23:03:52 +0000
Received: from azsmga001.ch.intel.com ([10.2.17.19])
 by azsmga101.ch.intel.com with ESMTP; 24 Jan 2013 15:03:48 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="4.84,532,1355126400"; d="scan'208";a="248123929"
Received: from orsmsx104.amr.corp.intel.com ([10.22.225.131])
 by azsmga001.ch.intel.com with ESMTP; 24 Jan 2013 15:03:47 -0800
Received: from orsmsx152.amr.corp.intel.com (10.22.226.39) by
 ORSMSX104.amr.corp.intel.com (10.22.225.131) with Microsoft SMTP Server (TLS)
 id 14.1.355.2; Thu, 24 Jan 2013 15:03:47 -0800
Received: from orsmsx101.amr.corp.intel.com ([169.254.8.209]) by
 ORSMSX152.amr.corp.intel.com ([169.254.8.3]) with mapi id 14.01.0421.002;
 Thu, 24 Jan 2013 15:03:47 -0800
From: "Harrison, John R" <john.r.harrison@intel.com>
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Thread-Topic: My uses of syntax extension
Thread-Index: Ac36hw9VvRbEPFI1SW2kksxiZlzhaA==
Date: Thu, 24 Jan 2013 23:03:47 +0000
Message-ID: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-cr-hashedpuzzle: BLUV BMn2 BhfV BwIM B7aN Dt1t EXkX Eaiv E2Kj FIFW GdfP
 G5se G9Mt H2DL IlrA
 JAOy; 1; dwBnAC0AYwBhAG0AbABwADQAQABsAGkAcwB0AHMALgBvAGMAYQBtAGwALgBvAHIAZwA=;
 Sosha1_v1; 7; {C934C461-5099-4F97-9CE9-6AA92BCE052D};
 agBvAGgAbgAuAHIALgBoAGEAcgByAGkAcwBvAG4AQABpAG4AdABlAGwALgBjAG8AbQA=; Thu,
 24 Jan 2013 23:03:44
 GMT;TQB5ACAAdQBzAGUAcwAgAG8AZgAgAHMAeQBuAHQAYQB4ACAAZQB4AHQAZQBuAHMAaQBvAG4A
x-cr-puzzleid: {C934C461-5099-4F97-9CE9-6AA92BCE052D}
x-originating-ip: [10.22.254.139]
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable
MIME-Version: 1.0
Subject: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 24 Jan 2013 22:59:44 -0000

I'm currently using camlp5 for syntax extensions. I never switched to
the new camlp4. It was introduced with minimal discussion and hardly
any useful documentation, while even things that were trivial in
camlp5 seemed complicated, so I never made the effort.

I think one of my applications (item 2 below) is very unusual, so
perhaps it will be a useful, or at least amusing, outlier in any list
people accumulate of current uses of syntax extension.

1. In the code for my book (http://www.cl.cam.ac.uk/~jrh13/atp/) I use
   items entered in <<quotations>>, which I simply want to treat as a
   string to get passed to my parser. This is essentially trivial in
   camlp5, though I think it is less so in camlp4.

   let quotexpander s =3D
     .... "default_parser \""^(String.escaped s)^"\"";;

   Quotation.add "" (Quotation.ExStr (fun x -> quotexpander));;

2. For the HOL Light prover (http://code.google.com/p/hol-light/),
   backward compatibility with other HOLs (where ML is used not only
   as the implementation language but also as the toplevel) dictates
   that I do various things to make OCaml look like old-style ML:

       * Add some alphanumeric infixes like "o" and "THEN"

       * Use "it" as the default binding for the previous expression
         (actually, I would prefer the toplevel to do this anyway).

       * Use quotations, but within the characters `....` not <<...>>

       * Completely change the OCaml lexical conventions so that
         all-uppercase words like INST and REWRITE_TAC are treated as
         ordinary identifiers.

   The subversion of the lexical conventions is the most tiresome
   aspect. (It also needs to be switchable in order to allow easy
   interfacing with more conventional OCaml code.) In camlp5, I do
   this by copying and editing the existing lexer, which makes it
   very brittle and necessitates frequent changes as camlp5's
   internals evolve. I would very much like a better solution.

John.


From anil@recoil.org  Fri Jan 25 16:30:49 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D08A03C27E
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 16:30:49 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1437901
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:25394
 helo=dark.recoil.org)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with smtp id 1TymEw-00034Q-r1 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Fri, 25 Jan 2013 16:34:59 +0000
Received: (qmail 414 invoked by uid 634); 25 Jan 2013 16:34:53 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from no-dns-yet.demon.co.uk (HELO [192.168.15.151]) (62.49.66.12)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Fri, 25 Jan 2013 16:34:44 +0000
From: Anil Madhavapeddy <anil@recoil.org>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Date: Fri, 25 Jan 2013 16:34:42 +0000
Message-Id: <9A42DC5C-5752-41E6-A7E2-4AC9BC75AA2C@recoil.org>
To: wg-camlp4@lists.ocaml.org
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: Jake Donham <jake@donham.org>
Subject: [wg-camlp4] Feedback to Leo's post from Jake
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 25 Jan 2013 16:30:49 -0000

I summarised some of the Twitter conversation at this URL, which has the =
thread:
http://twitter.theinfo.org/294459288762601472

Jake's last point is perhaps most important: "surveying what exists then =
supporting only common cases is philosophically backward for an =
extension mechanism".

While camlp4 is a powerful extension mechanism, it's perhaps been too =
successful.  Some of the common extensions have been used for years now =
without being integrated back into the core compiler suite, to the point =
that it's almost impossible to write a real application without using =
camlp4.=20

I view the current effort as a selection process for the successful =
extensions from camlp4, and building lightweight alternatives that =
reduce the reliance on the larger mechanism.  This makes the process of =
integrating other tools such as build, IDE integration and documentation =
much easier.  For example, we're currently working on a new ocamldoc =
that generates unified cross-references, and would like to separately =
render type_conv-generated functions to avoid cluttering the output. =
This is easy with annotations+ppx (assuming that type_conv's `with` is =
added to the default grammar).

There's no reason why camlp4 cannot continue to co-exist with some of =
these alternative mechanisms, but our addiction to it really ought to be =
reduced.

Another point he raises is that Leo's blog post "misses important camlp4 =
use cases. e.g. nested quot/antiquot, exts to pattern matching".  Some =
extensions (such as bitstring) are very naturally packaged as camlp4 =
syntax extensions, and not entirely solved by the ppx scheme.  It would =
be good to understand if this is outside of the scope of ppx, or on the =
list to solve.

(And thanks for the comments Jake; as I noted on Twitter, it was his =
fantastic blog series [1] and ICFP tutorial [2] that really unlocked the =
mysteries of camlp4 for me).

[1] http://ambassadortothecomputers.blogspot.co.uk/search/label/camlp4
[2] =
http://nicolaspouillard.fr/talks/cufp-metaprogramming-tutorial-slides.pdf

-anil=

From bobzhang1988@gmail.com  Fri Jan 25 16:44:47 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B45803C27E
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 16:44:47 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1437901 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.210.177 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ia0-f177.google.com ([209.85.210.177]:46219)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TymST-000188-sh (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Fri, 25 Jan 2013 16:48:57 +0000
Received: by mail-ia0-f177.google.com with SMTP id h8so902976iaa.36
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 08:48:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type
 :content-transfer-encoding;
 bh=6JVMZONbERC83c1AHLCUkKD9kVBtKyUMfnrL8iadbPc=;
 b=bsV0pfreUhJYGHb2YfjClGPK+o5XftFFEo4qGl2ye23vQREcSzz2/ZwGRbb3Jdl8a2
 5Xc9ee4PkYbOHjQi5XlSZZ3hud6afNvBn5OXJtgOyOaJrrCrRYnMk26RfctTHGjUVKvM
 UpLdfKJNxbPRGj/tWrM6VSZVL09ENBVtxKKkJzkXCjPIZA/sGFMnOi0dHS4qv5gnleYM
 z1jtGHDQWJkfAN9LQvwdMXY/K1MVaoOlHn0sU4Bo9LDVt9tXSdzln2PxAVI37GrltgqV
 ZLovDFC+o4N8n7N9/g/zhY4RLLldu65BRpdHrVjgum1z6KcYNJbh/QhOcNVl7rLVNsa1
 RfGA==
MIME-Version: 1.0
X-Received: by 10.50.150.136 with SMTP id ui8mr4548970igb.43.1359132532973;
 Fri, 25 Jan 2013 08:48:52 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.64.17.4 with HTTP; Fri, 25 Jan 2013 08:48:52 -0800 (PST)
In-Reply-To: <9A42DC5C-5752-41E6-A7E2-4AC9BC75AA2C@recoil.org>
References: <9A42DC5C-5752-41E6-A7E2-4AC9BC75AA2C@recoil.org>
Date: Fri, 25 Jan 2013 11:48:52 -0500
X-Google-Sender-Auth: 7rq3POGv_DsO2d7KBPFb7i7EVNc
Message-ID: <CANcqPu4P7N1pdtsD=mSQbMxgcM4EwT8THdpREpf3f5zhTRGing@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Anil Madhavapeddy <anil@recoil.org>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org, Jake Donham <jake@donham.org>
Subject: Re: [wg-camlp4] Feedback to Leo's post from Jake
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 25 Jan 2013 16:44:47 -0000

Hi Anil,
   I am just wondering why not expose a simple API on top of  Camlp4
instead of rolling a new mechanism? The advanced users can still have
advanced features.


On Fri, Jan 25, 2013 at 11:34 AM, Anil Madhavapeddy <anil@recoil.org> wrote=
:
> I summarised some of the Twitter conversation at this URL, which has the =
thread:
> http://twitter.theinfo.org/294459288762601472
>
> Jake's last point is perhaps most important: "surveying what exists then =
supporting only common cases is philosophically backward for an extension m=
echanism".
>
> While camlp4 is a powerful extension mechanism, it's perhaps been too suc=
cessful.  Some of the common extensions have been used for years now withou=
t being integrated back into the core compiler suite, to the point that it'=
s almost impossible to write a real application without using camlp4.
>
> I view the current effort as a selection process for the successful exten=
sions from camlp4, and building lightweight alternatives that reduce the re=
liance on the larger mechanism.  This makes the process of integrating othe=
r tools such as build, IDE integration and documentation much easier.  For =
example, we're currently working on a new ocamldoc that generates unified c=
ross-references, and would like to separately render type_conv-generated fu=
nctions to avoid cluttering the output. This is easy with annotations+ppx (=
assuming that type_conv's `with` is added to the default grammar).
>
> There's no reason why camlp4 cannot continue to co-exist with some of the=
se alternative mechanisms, but our addiction to it really ought to be reduc=
ed.
>
> Another point he raises is that Leo's blog post "misses important camlp4 =
use cases. e.g. nested quot/antiquot, exts to pattern matching".  Some exte=
nsions (such as bitstring) are very naturally packaged as camlp4 syntax ext=
ensions, and not entirely solved by the ppx scheme.  It would be good to un=
derstand if this is outside of the scope of ppx, or on the list to solve.
>
> (And thanks for the comments Jake; as I noted on Twitter, it was his fant=
astic blog series [1] and ICFP tutorial [2] that really unlocked the myster=
ies of camlp4 for me).
>
> [1] http://ambassadortothecomputers.blogspot.co.uk/search/label/camlp4
> [2] http://nicolaspouillard.fr/talks/cufp-metaprogramming-tutorial-slides=
.pdf
>
> -anil
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4



--=20
-- Regards, Hongbo

From anil@recoil.org  Fri Jan 25 16:50:28 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id F23623C27E
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 16:50:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1437901
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:46907
 helo=dark.recoil.org)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with smtp id 1TymY0-00040w-qb (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Fri, 25 Jan 2013 16:54:38 +0000
Received: (qmail 2677 invoked by uid 634); 25 Jan 2013 16:54:36 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from no-dns-yet.demon.co.uk (HELO [192.168.15.151]) (62.49.66.12)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Fri, 25 Jan 2013 16:54:27 +0000
Content-Type: text/plain; charset=iso-8859-1
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <CANcqPu4P7N1pdtsD=mSQbMxgcM4EwT8THdpREpf3f5zhTRGing@mail.gmail.com>
Date: Fri, 25 Jan 2013 16:54:28 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <C15E148C-75B6-4155-B41D-DBE0F1BF791D@recoil.org>
References: <9A42DC5C-5752-41E6-A7E2-4AC9BC75AA2C@recoil.org>
 <CANcqPu4P7N1pdtsD=mSQbMxgcM4EwT8THdpREpf3f5zhTRGing@mail.gmail.com>
To: Hongbo Zhang <hongboz@seas.upenn.edu>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org, Jake Donham <jake@donham.org>
Subject: Re: [wg-camlp4] Feedback to Leo's post from Jake
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 25 Jan 2013 16:50:28 -0000

Camlp4 slows down my projects, makes them more complex to build, and =
more prone to hard-to-track failures (due to buggy extensions generating =
invalid AST fragments occasionally).  It also makes it hard to build =
reliable IDE integration when you have to deal with an extensible =
grammar.

I love using it as an extension mechanism, and I hate using it =
day-to-day for every single bit of code that I write.

Alain and Leo are proposing separating extensible grammars from AST =
transformations, which seems sensible to me.  Can you be more specific =
about what you envisage a simple API would look like?

-anil

On 25 Jan 2013, at 16:48, Hongbo Zhang <hongboz@seas.upenn.edu> wrote:

> Hi Anil,
>   I am just wondering why not expose a simple API on top of  Camlp4
> instead of rolling a new mechanism? The advanced users can still have
> advanced features.
>=20
>=20
> On Fri, Jan 25, 2013 at 11:34 AM, Anil Madhavapeddy <anil@recoil.org> =
wrote:
>> I summarised some of the Twitter conversation at this URL, which has =
the thread:
>> http://twitter.theinfo.org/294459288762601472
>>=20
>> Jake's last point is perhaps most important: "surveying what exists =
then supporting only common cases is philosophically backward for an =
extension mechanism".
>>=20
>> While camlp4 is a powerful extension mechanism, it's perhaps been too =
successful.  Some of the common extensions have been used for years now =
without being integrated back into the core compiler suite, to the point =
that it's almost impossible to write a real application without using =
camlp4.
>>=20
>> I view the current effort as a selection process for the successful =
extensions from camlp4, and building lightweight alternatives that =
reduce the reliance on the larger mechanism.  This makes the process of =
integrating other tools such as build, IDE integration and documentation =
much easier.  For example, we're currently working on a new ocamldoc =
that generates unified cross-references, and would like to separately =
render type_conv-generated functions to avoid cluttering the output. =
This is easy with annotations+ppx (assuming that type_conv's `with` is =
added to the default grammar).
>>=20
>> There's no reason why camlp4 cannot continue to co-exist with some of =
these alternative mechanisms, but our addiction to it really ought to be =
reduced.
>>=20
>> Another point he raises is that Leo's blog post "misses important =
camlp4 use cases. e.g. nested quot/antiquot, exts to pattern matching".  =
Some extensions (such as bitstring) are very naturally packaged as =
camlp4 syntax extensions, and not entirely solved by the ppx scheme.  It =
would be good to understand if this is outside of the scope of ppx, or =
on the list to solve.
>>=20
>> (And thanks for the comments Jake; as I noted on Twitter, it was his =
fantastic blog series [1] and ICFP tutorial [2] that really unlocked the =
mysteries of camlp4 for me).
>>=20
>> [1] =
http://ambassadortothecomputers.blogspot.co.uk/search/label/camlp4
>> [2] =
http://nicolaspouillard.fr/talks/cufp-metaprogramming-tutorial-slides.pdf
>>=20
>> -anil
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
>=20
>=20
> --=20
> -- Regards, Hongbo
>=20


From bobzhang1988@gmail.com  Fri Jan 25 17:01:34 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D08D13C27E
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 17:01:34 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1437901 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.176 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ob0-f176.google.com ([209.85.214.176]:34848)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1Tymih-0000ey-qW (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Fri, 25 Jan 2013 17:05:44 +0000
Received: by mail-ob0-f176.google.com with SMTP id v19so680046obq.7
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 09:05:38 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type
 :content-transfer-encoding;
 bh=mSCXOIlaOW9TkspulbnytNLaUOVt79ETy5z1/c5y5C4=;
 b=uCqZa7iBOUwJC31/bBOWkoJwiu/khfGMMZRFEs7gi7xNxx2G/uogZigBOK6VBaPszg
 mSZb56xfmeHH331oEzx9SWx5XuCl4zYkalkPYVOe+ZYSkAC8rHFrr9NhcfK94JVT/wtQ
 Fdhb/5oBqYVmprQU6m1ZTyU7yLbL7SNosSXM1xHnkGrr/c1qCh1LY+mXUnMwXM8Pr9t3
 40eHwikQ0z8wR2gMgsOTmIt6JPJEoXGVHPsx07UqyEALYkCimBbJn6hWM9SUj1EZLdA0
 7IK6chUR1xsEk+8hpGNLt7HNesOzge8kVL9yWqQ40Ila4W4kSevJYfTXJJSe5T4Zj9xt
 wlDA==
MIME-Version: 1.0
X-Received: by 10.50.7.234 with SMTP id m10mr4467429iga.43.1359133538183; Fri,
 25 Jan 2013 09:05:38 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.64.17.4 with HTTP; Fri, 25 Jan 2013 09:05:38 -0800 (PST)
In-Reply-To: <C15E148C-75B6-4155-B41D-DBE0F1BF791D@recoil.org>
References: <9A42DC5C-5752-41E6-A7E2-4AC9BC75AA2C@recoil.org>
 <CANcqPu4P7N1pdtsD=mSQbMxgcM4EwT8THdpREpf3f5zhTRGing@mail.gmail.com>
 <C15E148C-75B6-4155-B41D-DBE0F1BF791D@recoil.org>
Date: Fri, 25 Jan 2013 12:05:38 -0500
X-Google-Sender-Auth: sj3l8_qlNrGo3srZKCCdtzuy8OE
Message-ID: <CANcqPu7YoCXNu-zyq+Lm=iCWnBtKC3Aj9X=9BLj0s1+jWbX0Bg@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Anil Madhavapeddy <anil@recoil.org>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org, Jake Donham <jake@donham.org>
Subject: Re: [wg-camlp4] Feedback to Leo's post from Jake
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 25 Jan 2013 17:01:34 -0000

On Fri, Jan 25, 2013 at 11:54 AM, Anil Madhavapeddy <anil@recoil.org> wrote=
:
> Camlp4 slows down my projects, makes them more complex to build, and more=
 prone to hard-to-track failures (due to buggy extensions generating invali=
d AST fragments occasionally).  It also makes it hard to build reliable IDE=
 integration when you have to deal with an extensible grammar.
That's true, but I have already solved  this problem, Fan(my branch of
p4) can be built under 20s instead of 10 minutes in the trunk. I also
solved the building complexity problem(details to explain later)
>
> I love using it as an extension mechanism, and I hate using it day-to-day=
 for every single bit of code that I write.
>
> Alain and Leo are proposing separating extensible grammars from AST trans=
formations, which seems sensible to me.  Can you be more specific about wha=
t you envisage a simple API would look like?
I also solved this problem, the generic deriving mechanism is built in
Fan(something similar to your work
http://gazagnaire.org/pub/GM10.pdf).

The parsetree is really a not nice ast to do the transformations for
two technical reasons:
    1. It does some syntax desguaring..
           suppose you want to pattern match bigarray syntax, it's
really painful
    2. It mixes records and algebraic data type, I rewrite the camlp4,
I know it would makes
the *Ast lifting* really really hard, so the nested quotation and
antiquotation mechanism  is really hard to implement, let alone the
syntax extension..

For the user, you really don't need to mutate the syntax , we could
provide some plugins for the end user.  I would write a blog to
explain more about this this weekend.

Thanks!



>
> -anil
>
> On 25 Jan 2013, at 16:48, Hongbo Zhang <hongboz@seas.upenn.edu> wrote:
>
>> Hi Anil,
>>   I am just wondering why not expose a simple API on top of  Camlp4
>> instead of rolling a new mechanism? The advanced users can still have
>> advanced features.
>>
>>
>> On Fri, Jan 25, 2013 at 11:34 AM, Anil Madhavapeddy <anil@recoil.org> wr=
ote:
>>> I summarised some of the Twitter conversation at this URL, which has th=
e thread:
>>> http://twitter.theinfo.org/294459288762601472
>>>
>>> Jake's last point is perhaps most important: "surveying what exists the=
n supporting only common cases is philosophically backward for an extension=
 mechanism".
>>>
>>> While camlp4 is a powerful extension mechanism, it's perhaps been too s=
uccessful.  Some of the common extensions have been used for years now with=
out being integrated back into the core compiler suite, to the point that i=
t's almost impossible to write a real application without using camlp4.
>>>
>>> I view the current effort as a selection process for the successful ext=
ensions from camlp4, and building lightweight alternatives that reduce the =
reliance on the larger mechanism.  This makes the process of integrating ot=
her tools such as build, IDE integration and documentation much easier.  Fo=
r example, we're currently working on a new ocamldoc that generates unified=
 cross-references, and would like to separately render type_conv-generated =
functions to avoid cluttering the output. This is easy with annotations+ppx=
 (assuming that type_conv's `with` is added to the default grammar).
>>>
>>> There's no reason why camlp4 cannot continue to co-exist with some of t=
hese alternative mechanisms, but our addiction to it really ought to be red=
uced.
>>>
>>> Another point he raises is that Leo's blog post "misses important camlp=
4 use cases. e.g. nested quot/antiquot, exts to pattern matching".  Some ex=
tensions (such as bitstring) are very naturally packaged as camlp4 syntax e=
xtensions, and not entirely solved by the ppx scheme.  It would be good to =
understand if this is outside of the scope of ppx, or on the list to solve.
>>>
>>> (And thanks for the comments Jake; as I noted on Twitter, it was his fa=
ntastic blog series [1] and ICFP tutorial [2] that really unlocked the myst=
eries of camlp4 for me).
>>>
>>> [1] http://ambassadortothecomputers.blogspot.co.uk/search/label/camlp4
>>> [2] http://nicolaspouillard.fr/talks/cufp-metaprogramming-tutorial-slid=
es.pdf
>>>
>>> -anil
>>> _______________________________________________
>>> wg-camlp4 mailing list
>>> wg-camlp4@lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/wg-camlp4
>>
>>
>>
>> --
>> -- Regards, Hongbo
>>
>



--=20
-- Regards, Hongbo

From alain@frisch.fr  Fri Jan 25 17:22:23 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BB1703C27E
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 17:22:23 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1437901 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:20390
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1Tyn2r-0007BE-nu (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Fri, 25 Jan 2013 17:26:33 +0000
Received: from [192.168.1.105] ([90.2.82.74]) by mwinf5d47 with ME
 id sHST1k00c1cCdve03HST2j; Fri, 25 Jan 2013 18:26:29 +0100
Message-ID: <5102C046.5030207@frisch.fr>
Date: Fri, 25 Jan 2013 18:26:30 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <9A42DC5C-5752-41E6-A7E2-4AC9BC75AA2C@recoil.org>
 <CANcqPu4P7N1pdtsD=mSQbMxgcM4EwT8THdpREpf3f5zhTRGing@mail.gmail.com>
In-Reply-To: <CANcqPu4P7N1pdtsD=mSQbMxgcM4EwT8THdpREpf3f5zhTRGing@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Jake Donham <jake@donham.org>
Subject: Re: [wg-camlp4] Feedback to Leo's post from Jake
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 25 Jan 2013 17:22:23 -0000

On 01/25/2013 05:48 PM, Hongbo Zhang wrote:> Hi Anil,
 >     I am just wondering why not expose a simple API on top of  Camlp4
 > instead of rolling a new mechanism? The advanced users can still have
 > advanced features.

Even if you manage to simplify Camlp4, it will always be a complex 
beast, creating some maintenance overhead for the core team when the 
language evolve or if you need to work with a fork of the language (such 
as MetaOCaml, OCamlDuce, or LexiFi's local version).  As a very concrete 
example, Jacques Garrigue recently proposed a patch (for generative 
functors) which requires a (light) extension to the OCaml syntax.  Of 
course, he did not upgrade Camlp4 (its version of the OCaml AST, its N 
parsers, and the mapping to the regular OCaml AST) yet.  So you cannot 
try this patch on your whole project if it depends on any camlp4-based 
tool.  This is very sad, isn't it?  Projects which rely on -ppx (like 
Bisect, sedlex, omonad) work perfectly ok with Jacques'  patch and 
nobody had to suffer to make this happen.

Why should we build something simple on top of something complicated 
when it is rather easy to build the simple solution directly?  This 
seems much more robust and future proof to me.  Those who enjoy the 
extra complexity (or actually need it) can indeed continue to work on 
and use camlp4/camlp5/fan.  This is not incompatible with -ppx at all. 
But the day ocamlfind, lwt, js_of_ocaml, type_conv and other 
"infrastructure" tools will work without camlp4, I will feel much more 
comfortable relying on them.

Also, I have reasons to believe that -ppx based tools will interact 
nicely with each other, better than camlp4 ones (I think about the
unfortunate incompatibility between deriving and type_conv). I claim 
that camlp4's model of independent extensions being allowed to tweak the 
concrete syntax as they want by mutating grammar rules is a design 
mistake with unfortunate consequences.  I have other technical concerns 
with camlp4 and I will try to summarize them in a blog post, so as to 
keep this mailing list more focused to pushing alternatives to camlp4 
(rather than justifying why this is a good idea to do so).

On 01/25/2013 05:34 PM, Anil Madhavapeddy wrote:
 >  Some extensions (such as bitstring) are very naturally packaged as
 > camlp4 syntax extensions, and not entirely solved by the ppx scheme. 
  > It would be good to understand if this is outside of the scope of
 > ppx, or on the list to solve.


This does not look very different from Sedlex ( 
http://www.lexifi.com/sedlex ), which encodes regular expressions as 
normal patterns.   And adding quotations in pattern position would make 
it possible to use any concrete syntax.


Alain


From anil@recoil.org  Fri Jan 25 18:03:47 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8CD093C27E
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 18:03:47 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1437901
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:9871
 helo=dark.recoil.org)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with smtp id 1Tyngx-0000b8-sa (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Fri, 25 Jan 2013 18:07:57 +0000
Received: (qmail 30239 invoked by uid 634); 25 Jan 2013 18:07:55 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from no-dns-yet.demon.co.uk (HELO [192.168.15.151]) (62.49.66.12)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Fri, 25 Jan 2013 18:07:46 +0000
Content-Type: text/plain; charset=iso-8859-1
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <5102C046.5030207@frisch.fr>
Date: Fri, 25 Jan 2013 18:07:50 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <95CBF314-2F17-4A55-9F3E-DD5E4995F283@recoil.org>
References: <9A42DC5C-5752-41E6-A7E2-4AC9BC75AA2C@recoil.org>
 <CANcqPu4P7N1pdtsD=mSQbMxgcM4EwT8THdpREpf3f5zhTRGing@mail.gmail.com>
 <5102C046.5030207@frisch.fr>
To: Alain Frisch <alain@frisch.fr>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org, Jake Donham <jake@donham.org>
Subject: Re: [wg-camlp4] Feedback to Leo's post from Jake
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 25 Jan 2013 18:03:47 -0000

On 25 Jan 2013, at 17:26, Alain Frisch <alain@frisch.fr> wrote:

> This does not look very different from Sedlex ( =
http://www.lexifi.com/sedlex ), which encodes regular expressions as =
normal patterns. And adding quotations in pattern position would make it =
possible to use any concrete syntax.

That makes sense to me; I'll look at sedlex in more detail next week. =
Another=20
extension which we've developed and depend on very heavily is a quick =
way to
map C structures to OCaml:

  https://github.com/mirage/ocaml-cstruct

cstruct pcap_header {
  uint32_t magic_number;   (* magic number *)
  uint16_t version_major;  (* major version number *)
  uint16_t version_minor;  (* minor version number *)
  uint32_t thiszone;       (* GMT to local correction *)
  uint32_t sigfigs;        (* accuracy of timestamps *)
  uint32_t snaplen;        (* max length of captured packets, in octets =
*)
  uint32_t network         (* data link type *)
} as little_endian


Will generate accessor functions for each field for a Bigarray.  This =
sounds=20
like it'll just be a quotation in the ppx world, so slightly more =
syntactically
heavy (but I think that's an acceptable cost).

-anil=

From yminsky@janestreet.com  Fri Jan 25 18:12:19 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7F0CE3C27E
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 18:12:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1437901 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:48186
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1Tynp6-0000zI-YZ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Fri, 25 Jan 2013 18:16:29 +0000
Received: from tot-smtp.delacy.com ([172.27.22.35] helo=tot-is-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1Tynom-0007t4-FW
 for wg-camlp4@lists.ocaml.org; Fri, 25 Jan 2013 13:16:00 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-is-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1Tynol-0003ea-4N
 for wg-camlp4@lists.ocaml.org; Fri, 25 Jan 2013 13:15:59 -0500
Received: from mail-bk0-f70.google.com ([209.85.214.70])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1Tynol-0004MV-05
 for wg-camlp4@lists.ocaml.org; Fri, 25 Jan 2013 13:15:59 -0500
Received: by mail-bk0-f70.google.com with SMTP id ji2so694972bkc.1
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 10:15:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type;
 bh=1FDVodZLO6I+rvN1Onm8XECy60Wu19v66Ok2wpGjwL8=;
 b=ShjwUIyLJphMG/Id8W+n9+G3sAQXlUs/BRODVnjtS5YvzuU+z6FeU7JJb5/2k2Bmvv
 5rIlxXjpjXLnFOP7lzSBgHtbKIZ1HwLWBIobNEcqBTud+WVRFDmvWx+1MFlN8sMZEyb2
 0x9qxuG7AXw32D1mf2MXREKEbgpGlqnKDvaZo=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type:x-gm-message-state;
 bh=1FDVodZLO6I+rvN1Onm8XECy60Wu19v66Ok2wpGjwL8=;
 b=P6M8qA8QqZuV76JVozQhbLdHpCyxEHjnyBWvSbVp5gdLG+XTyu43ZN++TI8sbo4Q9v
 fhlLEh17BN8+G2vqCzRiO5Lj/ehDwvACTPBrdfeowcu6JdcetnHNUnUa2fPcXtFHcvL1
 Okp7dalD/H1EYAABNijFkiVfiLsm+FXA9awMVKLKSSINp2BeJ3UUqhr0iB5kf3e89lz/
 AKe6bYCy/schNbw9H+NfOA/hxhBBh9QK3TRhWqdvKZOVFltA9Sqj8tz4kT4OC8lIHvoy
 ziXvDAZi2GrlacqmJkr4r4WIKn5GZhiFaspHhh14IcyvOF6XozWTcuy+4EwUEgEHG5qm
 c8NQ==
X-Received: by 10.14.178.196 with SMTP id f44mr20543169eem.14.1359137758349;
 Fri, 25 Jan 2013 10:15:58 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.14.178.196 with SMTP id f44mr20543140eem.14.1359137758163;
 Fri, 25 Jan 2013 10:15:58 -0800 (PST)
Received: by 10.223.141.66 with HTTP; Fri, 25 Jan 2013 10:15:58 -0800 (PST)
In-Reply-To: <5102C046.5030207@frisch.fr>
References: <9A42DC5C-5752-41E6-A7E2-4AC9BC75AA2C@recoil.org>
 <CANcqPu4P7N1pdtsD=mSQbMxgcM4EwT8THdpREpf3f5zhTRGing@mail.gmail.com>
 <5102C046.5030207@frisch.fr>
Date: Fri, 25 Jan 2013 13:15:58 -0500
Message-ID: <CACLX4jRTb6+-VLmWW76+KV-GSZq=o0sMnJKQ3PHD1qnKRwL6nA@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: Alain Frisch <alain@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQnqZ3PZaImM78cRvGg/SLUwAa+QKlhWB9vARN6YTAKHwJByjD1bYNNUSDVjm1KBy6+/xVoRUzXNzX1f+2fQBd9VKIA4JmeSGTACJvqSPckfU/SV6ktBpPuZV6N2PfTqyujOqQEOIMNLr+rh7d8mX/AHmL32yQ==
Cc: wg-camlp4@lists.ocaml.org, Jake Donham <jake@donham.org>
Subject: Re: [wg-camlp4] Feedback to Leo's post from Jake
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 25 Jan 2013 18:12:19 -0000

I very much agree with Alain on this.  Having a simple core seems
essential, from a number of viewpoints.  Implementation complexity
alone seems to demand it.

Moreover, I would argue that we should move past the question of
whether to build a simpler thing, and focus more on what that simple
thing should look like.  Once we have a clearer idea about that, we
can circle back and make sure we think like the end result is good
enough to justify the change.

y

On Fri, Jan 25, 2013 at 12:26 PM, Alain Frisch <alain@frisch.fr> wrote:
> On 01/25/2013 05:48 PM, Hongbo Zhang wrote:> Hi Anil,
>
>>     I am just wondering why not expose a simple API on top of  Camlp4
>> instead of rolling a new mechanism? The advanced users can still have
>> advanced features.
>
> Even if you manage to simplify Camlp4, it will always be a complex beast,
> creating some maintenance overhead for the core team when the language
> evolve or if you need to work with a fork of the language (such as
> MetaOCaml, OCamlDuce, or LexiFi's local version).  As a very concrete
> example, Jacques Garrigue recently proposed a patch (for generative
> functors) which requires a (light) extension to the OCaml syntax.  Of
> course, he did not upgrade Camlp4 (its version of the OCaml AST, its N
> parsers, and the mapping to the regular OCaml AST) yet.  So you cannot try
> this patch on your whole project if it depends on any camlp4-based tool.
> This is very sad, isn't it?  Projects which rely on -ppx (like Bisect,
> sedlex, omonad) work perfectly ok with Jacques'  patch and nobody had to
> suffer to make this happen.
>
> Why should we build something simple on top of something complicated when it
> is rather easy to build the simple solution directly?  This seems much more
> robust and future proof to me.  Those who enjoy the extra complexity (or
> actually need it) can indeed continue to work on and use camlp4/camlp5/fan.
> This is not incompatible with -ppx at all. But the day ocamlfind, lwt,
> js_of_ocaml, type_conv and other "infrastructure" tools will work without
> camlp4, I will feel much more comfortable relying on them.
>
> Also, I have reasons to believe that -ppx based tools will interact nicely
> with each other, better than camlp4 ones (I think about the
> unfortunate incompatibility between deriving and type_conv). I claim that
> camlp4's model of independent extensions being allowed to tweak the concrete
> syntax as they want by mutating grammar rules is a design mistake with
> unfortunate consequences.  I have other technical concerns with camlp4 and I
> will try to summarize them in a blog post, so as to keep this mailing list
> more focused to pushing alternatives to camlp4 (rather than justifying why
> this is a good idea to do so).
>
>
> On 01/25/2013 05:34 PM, Anil Madhavapeddy wrote:
>>  Some extensions (such as bitstring) are very naturally packaged as
>> camlp4 syntax extensions, and not entirely solved by the ppx scheme.  > It
>> would be good to understand if this is outside of the scope of
>> ppx, or on the list to solve.
>
>
> This does not look very different from Sedlex ( http://www.lexifi.com/sedlex
> ), which encodes regular expressions as normal patterns.   And adding
> quotations in pattern position would make it possible to use any concrete
> syntax.
>
>
> Alain
>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From edwin+ml-ocaml@etorok.net  Fri Jan 25 19:34:08 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 981E23C27E
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 19:34:08 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1437901 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:52491)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1Typ6P-0006aC-oe (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Fri, 25 Jan 2013 19:38:19 +0000
Received: from [IPv6:2a02:2f02:1022:6458:1e6f:65ff:fe23:db0d] (unknown
 [IPv6:2a02:2f02:1022:6458:1e6f:65ff:fe23:db0d])
 by mail.etorok.net (Postfix) with ESMTPSA id 2FEB646B5
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 20:38:17 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359142697;
 bh=6eo3T8zLRhTuuMjwnX4MstAInlhkIXmhraLZOF9StVo=;
 h=Message-ID:Date:From:MIME-Version:To:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=X+XDoilPIa+VGyz2Z7qpSrZCM1WOZRK4S/9aB49t+aJCHjO1MYSCDp+z+JtEYNmyl
 UzDNWLG2kxHNUq2Op1cQQEdcH800n+Hk6opIM4Y+8zjWWeqP5yBJDdoMUKH2bs2TPC
 Q1kN0sVFLPBlU1aZK6eCWBIz0AH3Z+5sGDqTidE4=
Message-ID: <5102DF28.90802@etorok.net>
Date: Fri, 25 Jan 2013 21:38:16 +0200
From: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
In-Reply-To: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 25 Jan 2013 19:34:08 -0000

Hi,

Here are my uses of camlp4:

* camlp4o     - for better syntax errors (see http://caml.inria.fr/mantis/view.php?id=5068). This is a time-saver during development
* js_of_ocaml - (blogpost says its not really needed if a different operator would be used)
* bisect      - haven't figured how to use ppx from oasis/ocamlfind, The camlp4 one is as simple as:
	$(SETUP) -build -tag pkg_bisect -tag pkg_str -tag syntax_camlp4o -tag syntax_bisect_pp $(BUILDFLAGS)

camlp4 syntax extensions needed to build libraries that I use:
lwt, tyxml (needs camlp4of), camlp4.macro

Syntax extensions I considered using but never got around to:
pa-monad (didn't really need it), bitstring

Also when initially learning OCaml I have used the revised syntax (camlp4r) quite heavily.
Nowadays I write everything in the original syntax.
While I wouldn't miss the revised syntax, I do think that its much easier to first learn the revised syntax so it'd be nice
if the camlp4 replacement provided that as well.

Best regards,	
--Edwin






From lukstafi@gmail.com  Fri Jan 25 20:48:17 2013
Return-Path: <lukstafi@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7C5DE3C27E
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 20:48:17 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1437901 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.177 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (lukstafi[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f177.google.com ([209.85.220.177]:48867)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1TyqGB-0001ji-oH (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <lukstafi@gmail.com>); Fri, 25 Jan 2013 20:52:28 +0000
Received: by mail-vc0-f177.google.com with SMTP id m18so600414vcm.8
 for <wg-camlp4@lists.ocaml.org>; Fri, 25 Jan 2013 12:52:27 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:content-type;
 bh=RnPl6pV5HNhgQ+lWWfzAwtS4sI0e1R8yQwKIbCzRwlE=;
 b=GHuhbzetZXnXmtaJA7JdCMA232eL2yb8KuvqKcTM86x/ZnygMoatOcwcFujpKQ0XgL
 MFd8AAJOLP6RAyWkQvvtnBlvjHQTzGgDzlqvnGXnW2snaRuHjKaaDBp4dCXuzMsN/71E
 uS8LF6EZInAiDEWJH/zRvp92bthiRLWdYv+ity/0DLGgo7/ICGFMyO5Wyq7Cr39jqW9f
 8ErBnCH6SfJ/e28HLIzO7t5gNZ8wjBr01fZ82RpMv6A8A1wvxGCqixjCcOCNvYnV9Yz/
 b1ffPNklliqg6U7FFqbLFCNpYDLSFzytm6OMPRDw5JjuQHiXoGRREkn2/54VFaQFMrbn
 QZKg==
X-Received: by 10.52.174.201 with SMTP id bu9mr33619vdc.45.1359147146836; Fri,
 25 Jan 2013 12:52:26 -0800 (PST)
MIME-Version: 1.0
Received: by 10.58.46.80 with HTTP; Fri, 25 Jan 2013 12:52:06 -0800 (PST)
In-Reply-To: <5102DF28.90802@etorok.net>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net>
From: Lukasz Stafiniak <lukstafi@gmail.com>
Date: Fri, 25 Jan 2013 21:52:06 +0100
Message-ID: <CAJMfKEW1Ls0mVOnx2SHJOyaPFLiULgEDsQiF0OUn+QxTuzCO=Q@mail.gmail.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 25 Jan 2013 20:48:17 -0000

My uses of camlp4:
- "let try n = expr in expr with handlers"
- LOGging
- recently, matrix access/assignment like in bigarrays but for
built-in arrays (long ago I also played with matlab-like notation)
- js_of_ocaml
- list comprehensions and pa_monad, but for educational purposes so far.

From alain@frisch.fr  Mon Jan 28 10:53:11 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id DC0753C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 10:53:11 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:47477
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TzmP4-0003Mo-pv (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 10:57:30 +0000
Received: from [192.168.1.105] ([90.2.82.74]) by mwinf5d25 with ME
 id tNxU1k00f1cCdve03NxUJC; Mon, 28 Jan 2013 11:57:29 +0100
Message-ID: <51065998.9090009@frisch.fr>
Date: Mon, 28 Jan 2013 11:57:28 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: "Harrison, John R" <john.r.harrison@intel.com>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
In-Reply-To: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 10:53:11 -0000

Hi John,

Thanks for sharing this information!

On 01/25/2013 12:03 AM, Harrison, John R wrote:
> 1. In the code for my book (http://www.cl.cam.ac.uk/~jrh13/atp/) I use
>     items entered in <<quotations>>, which I simply want to treat as a
>     string to get passed to my parser. This is essentially trivial in
>     camlp5, though I think it is less so in camlp4.
>
>     let quotexpander s =
>       .... "default_parser \""^(String.escaped s)^"\"";;
>
>     Quotation.add "" (Quotation.ExStr (fun x -> quotexpander));;

It is planned to extend OCaml grammar directly with generic quotations 
(in place of expressions, patterns, etc).  The type-checker would fail 
on them, but -ppx filters will have a chance to rewrite them to 
something the compiler understands.  It is not completely clear yet 
which syntax (delimiters, lexing rules) will be chosen, though. 
Delimiters will probably be different from Camlp4, to make it possible 
to combine Camlp4 and -ppx.

*If* you don't care too much about having to escape some characters in 
the content of the quotations, a poor-man version is to rely on standard 
strings.  For instance, a -ppx filter can detect the construction:

   !"....."

(i.e. the bang character followed by a string literal) and rewrites it 
to whatever it wants.  But given your example (where the quotation 
expands to a simple function call on the string literal), I assume that 
you use quotations precisely for them lexical properties.  Is that right?

> 2. For the HOL Light prover (http://code.google.com/p/hol-light/),
>     backward compatibility with other HOLs (where ML is used not only
>     as the implementation language but also as the toplevel) dictates
>     that I do various things to make OCaml look like old-style ML:
>
>         * Add some alphanumeric infixes like "o" and "THEN"
>
>         * Use "it" as the default binding for the previous expression
>           (actually, I would prefer the toplevel to do this anyway).
>
>         * Use quotations, but within the characters `....` not <<...>>
>
>         * Completely change the OCaml lexical conventions so that
>           all-uppercase words like INST and REWRITE_TAC are treated as
>           ordinary identifiers.
>
>     The subversion of the lexical conventions is the most tiresome
>     aspect. (It also needs to be switchable in order to allow easy
>     interfacing with more conventional OCaml code.) In camlp5, I do
>     this by copying and editing the existing lexer, which makes it
>     very brittle and necessitates frequent changes as camlp5's
>     internals evolve. I would very much like a better solution.


This is really about proposing a concrete syntax (even lexical 
conventions) different from regular OCaml, a little bit in the same vein 
as camlp4's revised syntax.  I believe this is better left outside the 
scope of -ppx, which is about providing syntactic facilities (code 
generation, macros, etc) rather than changing the concrete syntax.

To support fully custom syntax, the "-pp" flag will always be available. 
  You can implement a custom parser with 
camlp4/camlp5/ocamlyacc/menhir/etc and then use -ppx rewriters on the 
result, if needed (so that your users will be able to use all the nice 
-ppx rewriter even if your concrete syntax is quite different from 
OCaml).  In a sense, -ppx improve the situation here, because I suspect 
that changing OCaml's grammar means destroying/shadowing some rules in 
Camlp'4 OCaml grammar, and those rules might be relied upon by "syntax 
extensions".  With -ppx, we would have a stricter separation between the 
concrete syntax, and additional syntactic tools (-ppx).

Btw, did you consider forking OCaml's lexer/parser instead of relying on 
camlp5 plus hacks for the lexical part?


Alain

From alain@frisch.fr  Mon Jan 28 12:00:12 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3FA473C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 12:00:12 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:16791
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TznRu-00008k-RF (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 12:04:31 +0000
Received: from [192.168.1.105] ([90.2.82.74]) by mwinf5d35 with ME
 id tQ4U1k01J1cCdve03Q4Vyw; Mon, 28 Jan 2013 13:04:30 +0100
Message-ID: <5106694C.3020703@frisch.fr>
Date: Mon, 28 Jan 2013 13:04:28 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net>
In-Reply-To: <5102DF28.90802@etorok.net>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 12:00:12 -0000

On 01/25/2013 08:38 PM, Trk Edwin wrote:
> * camlp4o     - for better syntax errors (see http://caml.inria.fr/mantis/view.php?id=5068). This is a time-saver during development

Interesting.  It would certainly be useful to improve OCaml syntax error 
messages.  There has been some improvements recently, with the addition 
of some explicit error rules, but more work (or maybe a different 
approach as the one you suggest in the note of this ticket) would be needed.

Of course, nothing will prevent you from continuing using camlp4 instead 
of the official OCaml parser, as a "local convenience" (code you might 
distribute will not depend on camlp4, at least if you don't start 
relying on differences between camlp4's ocaml parser and the official one).

> * js_of_ocaml - (blogpost says its not really needed if a different operator would be used)

Indeed, it was our first use of -ppx here at LexiFi.  Some version of it 
can be found there:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/experimental/frisch/js_syntax.ml?revision=12932&view=markup

Basically, instead of introducing new syntax (o ## m) to access, say, a 
Javascript property, we ask the user to write:

   JVS.(o.m)

In the scope of a local-open on the pseudo JVS module name, we interpret 
a few syntactic constructs as meaning something else.  We did the 
minimum work required to allow us playing with js_of_ocaml as part of an 
internship exploratory project.  Hopefully, the js_of_ocaml folks will 
pick up on that and provide all the required syntactic support, 
including for the creation of JS objects and so on.  (We could for 
instance use the following syntax: JVS.(object ... end).)

Note that we have reused the compact syntax for local opens in order to 
define a special "scope" where some constructions are interpreted 
differently.  Maybe we should keep two different kinds of node in the 
Parsetree to distinguish "let open M in e" from "M.(e)".  Or maybe we 
should introduce explicitly another kind of "named scope" to the OCaml 
grammar, to be interpreted by -ppx rewriters  (and this could be 
available not only for expressions, but also for other entities like 
patterns, types, etc).  Or maybe we can find a nice syntax for 
"attributes" which could be used for this kind of purposes.  Or is the 
solution based on piggy-backing the syntax for local opens just fine? 
Comments are welcome!


> * bisect      - haven't figured how to use ppx from oasis/ocamlfind, The camlp4 one is as simple as:
> 	$(SETUP) -build -tag pkg_bisect -tag pkg_str -tag syntax_camlp4o -tag syntax_bisect_pp $(BUILDFLAGS)

We use the -ppx version of Bisect here.  This is probably not supported 
by ocamlfind right now.  We simply add the following command-line options:

  * for compiling:
     -ppx ..../bisect_ppx$(EXE)	

  * for linking:
     -I <path_to_bisect>  bisect.cma (or .cmxa)


> camlp4 syntax extensions needed to build libraries that I use:
> lwt, tyxml (needs camlp4of), camlp4.macro

tyxml: my understanding is that support for quotations (with 
anti-quotations in them?) would be enough.

camlp4.macro:  does this refer to pa_macro?  It seems that this is more 
about conditional compilation than proper macro expansion.  I suspect 
that conditional compilation is used rarely enough in OCaml project, so 
that a slightly more verbose syntax would not a big deal.  Do you confirm?

See 
http://www.lexifi.com/blog/syntax-extensions-without-camlp4-lets-do-it 
for a -ppx based version of conditional compilation.  The syntax is:

   include IFDEF(SYMBOL)(struct
      ... (* structure items in case SYMBOL is defined *)
   end)(struct
      ... (* structure items in case SYMBOL is not defined *)
   end)



For lwt: this project (and similar ones) might justify some special 
extensions to the concrete grammar.  There are basically two approaches 
are:  either support "let-fix" operators directly in the OCaml or just 
extend the syntax and let -ppx rewriters to the job.  There are several 
variations around the first solution, but we could for instance allow 
defining let-fix operators like:

   let (let***) x f = ...

and then use them as:

  let*** x = e1 in e2

which would be just sugar for:

   (let***) e1 (fun x -> e2)

(here I've assumed that let-fix operators are made of the characters 
"l", "e", "t" followed by an non-empty sequence of "operator" characters.)

The second approach is simply to extend the parser to accept

   let*** x = e1 in e2

and represent this explicitly in the Parsetree (a -ppx rewriter will 
then have to be used to rewrite that to something the type-checker accepts).

Both approaches can be combined: a default behavior for let-fix 
operators, but with an explicit representation in the Parsetree, 
allowing -ppx rewriters to provide a different interpretation. 
Typically, lwt has a notion of parallel binding, which would probably 
require some custom support (-ppx).


> Syntax extensions I considered using but never got around to:
> pa-monad (didn't really need it), bitstring

pa-monad: Wojciech Meyer announced omonad, a -ppx version of pa_monad.

bitstring: see my comment in another post.  Conceptually, this is quite 
similar to Sedlex.  The question is whether we can come up with a 
reasonable syntax (either with standard patterns, or maybe with pattern 
quotations?).

> Also when initially learning OCaml I have used the revised syntax (camlp4r) quite heavily.
> Nowadays I write everything in the original syntax.
> While I wouldn't miss the revised syntax, I do think that its much easier to first learn the revised syntax so it'd be nice
> if the camlp4 replacement provided that as well.

See the other post.  -ppx is really aimed at "syntax extensions"
which are more about code generation (type-conv, sedlex, ...) or code 
manipulation (conditional compilation, ...) than actual changes to the 
concrete syntax.  When the concrete syntax is the main objective, I can 
see two different cases:

   - Small local syntactic additions, like the one implemented by 
pa_lwt: we should think about generic extension points in the official 
parser to support them (together with -ppx rewriters).  Or even direct 
support in the compiler when it makes sense (e.g. direct support for 
local opens is much better than pa_openin).

   - More pervasive changes to the whole language grammar (like the 
revised syntax):  this is really what -pp is good at, and I personally 
don't have plans to propose an alternative for these cases.  It's good 
that you can experiment with parsers written with any technology.  That 
said, while I can admit that alternative syntaxes are interesting for 
experiments or educational purposes, I believe that released source code 
(libraries, applications) should stick to the official syntax, to avoid 
fragmentation of the community and issues with editors/IDE.



Alain

From alain@frisch.fr  Mon Jan 28 12:10:53 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 552D63C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 12:10:53 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:55135
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TzncC-0002wf-rY (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 12:15:12 +0000
Received: from [192.168.1.105] ([90.2.82.74]) by mwinf5d35 with ME
 id tQF61k0101cCdve03QF79W; Mon, 28 Jan 2013 13:15:08 +0100
Message-ID: <51066BCA.1020201@frisch.fr>
Date: Mon, 28 Jan 2013 13:15:06 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gerd Stolpmann <info@gerd-stolpmann.de>
References: <510145A5.6030807@frisch.fr>
 <90C5BC201F264C4C902B4E7897660042@erratique.ch> <1359044659.30715.4@samsung>
In-Reply-To: <1359044659.30715.4@samsung>
Content-Type: text/plain; charset=ISO-8859-15; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Anil Madhavapeddy <avsm2@cl.cam.ac.uk>,
 caml-list <caml-list@inria.fr>
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 12:10:53 -0000

On 01/24/2013 05:24 PM, Gerd Stolpmann wrote:
> It's used in the tool, but only for stream parsing. I could also
> distribute the already-preprocessed file (and maybe I'll do so in the
> next release).
>
> Stream parsing is certainly one of the topics to discuss.

I've no idea how widely stream parsing is used.  Has anyone some 
intuition about this?

Stream parsers probably fall in the same category as bitstring or sedlex 
(custom notions of pattern matching).  It seems that stream parsers 
(which I'm not familiar with) require to be able to write expressions 
within "left-hand sides", which might require special support.  Or maybe 
the whole left-hand sides should just be quotations.

Anyway, for a basic infrastructure tool such as ocamlfind, I'd probably 
advocate for a "manual" solution which works out of the box with a basic 
OCaml installation (ocamlyacc or manual top-down parser).  Gerd: does 
that sound reasonable to you?


Alain


From edwin+ml-ocaml@etorok.net  Mon Jan 28 13:02:30 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9C4383C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 13:02:30 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.7 from SpamAssassin-3.3.2-1439040 
 *  1.1 DKIM_ADSP_ALL No valid author signature, domain signs all mail
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:40052)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TzoQB-0001LR-qi (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Mon, 28 Jan 2013 13:06:49 +0000
Received: from [IPv6:2a02:2f02:1022:a066:1e6f:65ff:fe23:db0d] (unknown
 [IPv6:2a02:2f02:1022:a066:1e6f:65ff:fe23:db0d])
 by mail.etorok.net (Postfix) with ESMTPSA id 8D29346BA;
 Mon, 28 Jan 2013 14:06:46 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359378406;
 bh=q6T9HN4AmBlcQGhaVCYnErxnEyeLiKfU0yTK45ddtdE=;
 h=Message-ID:Date:From:MIME-Version:To:CC:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=GKtWY5/4F44In5ZXZKEGaNh19sorPYv5482pTD8TwNci8AcOpSsyZKsvjm6ldS7QM
 8aK1zWVTZviSn4ukwPHvTihvjSbh3T6SqGrm51mfCWYPvwWhfQkWhninBk3pA/ST4S
 qP6BqiAMQ5gwcGTdNTi/UbVnMcx6DHdbQrdYguBE=
Message-ID: <510677E4.2000500@etorok.net>
Date: Mon, 28 Jan 2013 15:06:44 +0200
From: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: Alain Frisch <alain@frisch.fr>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
In-Reply-To: <5106694C.3020703@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 13:02:30 -0000

On 01/28/2013 02:04 PM, Alain Frisch wrote:
> On 01/25/2013 08:38 PM, T=F6r=F6k Edwin wrote:
>> * camlp4o     - for better syntax errors (see http://caml.inria.fr/man=
tis/view.php?id=3D5068). This is a time-saver during development
>=20
> Interesting.  It would certainly be useful to improve OCaml syntax erro=
r messages.  There has been some improvements recently, with the addition=
 of some explicit error rules, but more work (or maybe a
> different approach as the one you suggest in the note of this ticket) w=
ould be needed.
>=20
> Of course, nothing will prevent you from continuing using camlp4 instea=
d of the official OCaml parser, as a "local convenience" (code you might =
distribute will not depend on camlp4, at least if you
> don't start relying on differences between camlp4's ocaml parser and th=
e official one).
>=20
>> * js_of_ocaml - (blogpost says its not really needed if a different op=
erator would be used)
>=20
> Indeed, it was our first use of -ppx here at LexiFi.  Some version of i=
t can be found there:
>=20
> http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/experimental/frisch=
/js_syntax.ml?revision=3D12932&view=3Dmarkup
>=20
> Basically, instead of introducing new syntax (o ## m) to access, say, a=
 Javascript property, we ask the user to write:
>=20
>   JVS.(o.m)
>=20
> In the scope of a local-open on the pseudo JVS module name, we interpre=
t a few syntactic constructs as meaning something else.  We did the minim=
um work required to allow us playing with js_of_ocaml as
> part of an internship exploratory project.  Hopefully, the js_of_ocaml =
folks will pick up on that and provide all the required syntactic support=
, including for the creation of JS objects and so on.=20
> (We could for instance use the following syntax: JVS.(object ... end).)
>=20
> Note that we have reused the compact syntax for local opens in order to=
 define a special "scope" where some constructions are interpreted differ=
ently.  Maybe we should keep two different kinds of node
> in the Parsetree to distinguish "let open M in e" from "M.(e)".  Or may=
be we should introduce explicitly another kind of "named scope" to the OC=
aml grammar, to be interpreted by -ppx rewriters  (and
> this could be available not only for expressions, but also for other en=
tities like patterns, types, etc).  Or maybe we can find a nice syntax fo=
r "attributes" which could be used for this kind of
> purposes.  Or is the solution based on piggy-backing the syntax for loc=
al opens just fine? Comments are welcome!
>=20
>=20
>> * bisect      - haven't figured how to use ppx from oasis/ocamlfind, T=
he camlp4 one is as simple as:
>>     $(SETUP) -build -tag pkg_bisect -tag pkg_str -tag syntax_camlp4o -=
tag syntax_bisect_pp $(BUILDFLAGS)
>=20
> We use the -ppx version of Bisect here.  This is probably not supported=
 by ocamlfind right now.  We simply add the following command-line option=
s:
>=20
>  * for compiling:
>     -ppx ..../bisect_ppx$(EXE)  =20
>=20
>  * for linking:
>     -I <path_to_bisect>  bisect.cma (or .cmxa)
>=20
>=20
>> camlp4 syntax extensions needed to build libraries that I use:
>> lwt, tyxml (needs camlp4of), camlp4.macro
>=20
> tyxml: my understanding is that support for quotations (with anti-quota=
tions in them?) would be enough.
>=20
> camlp4.macro:  does this refer to pa_macro?  It seems that this is more=
 about conditional compilation than proper macro expansion.  I suspect th=
at conditional compilation is used rarely enough in
> OCaml project, so that a slightly more verbose syntax would not a big d=
eal.  Do you confirm?
>=20
> See http://www.lexifi.com/blog/syntax-extensions-without-camlp4-lets-do=
-it for a -ppx based version of conditional compilation.  The syntax is:
>=20
>   include IFDEF(SYMBOL)(struct
>      ... (* structure items in case SYMBOL is defined *)
>   end)(struct
>      ... (* structure items in case SYMBOL is not defined *)
>   end)
>=20

This is for ocamlnet and ounit, I don't use it in my code.

Backward compatibility would be appreciated, especially for something as =
simple as IFDEF.
Otherwise if a library switches to use the new ppx-based tool, it will no=
 longer build with OCaml 3.12.1 + the camlp4 based syntax.
In fact the uses of IFDEF are quite simple, and maybe a tool that uses th=
e lexer from compiler-libs and performs a lex-time ifdef replacement woul=
d work.

Alternatively whenever a new ppx-based tool is released that requires a n=
ew syntax, its camlp4-based complement should be updated to support the n=
ew syntax as well.
But that is probably a lot of work for little benefit.

>=20
>=20
> For lwt: this project (and similar ones) might justify some special ext=
ensions to the concrete grammar.  There are basically two approaches are:=
  either support "let-fix" operators directly in the
> OCaml or just extend the syntax and let -ppx rewriters to the job.  The=
re are several variations around the first solution, but we could for ins=
tance allow defining let-fix operators like:
>=20
>   let (let***) x f =3D ...
>=20
> and then use them as:
>=20
>  let*** x =3D e1 in e2
>=20
> which would be just sugar for:
>=20
>   (let***) e1 (fun x -> e2)
>=20
> (here I've assumed that let-fix operators are made of the characters "l=
", "e", "t" followed by an non-empty sequence of "operator" characters.)
>=20
> The second approach is simply to extend the parser to accept
>=20
>   let*** x =3D e1 in e2
>=20
> and represent this explicitly in the Parsetree (a -ppx rewriter will th=
en have to be used to rewrite that to something the type-checker accepts)=
.
>=20
> Both approaches can be combined: a default behavior for let-fix operato=
rs, but with an explicit representation in the Parsetree, allowing -ppx r=
ewriters to provide a different interpretation.
> Typically, lwt has a notion of parallel binding, which would probably r=
equire some custom support (-ppx).

Thinking about backward compatibility again perhaps there should be more =
transformation phases:
 -ppl Parser.token -> Parser.token, this can transform 'lwt' into 'let***=
' (or whatever ppx expects) for backwards compat
 -ppx Parsetree -> Parsetree as currently

Also it'd be nice to have:
 -ppt Typedtree -> Typedtree for type-level transformations

>=20
>=20
>> Syntax extensions I considered using but never got around to:
>> pa-monad (didn't really need it), bitstring
>=20
> pa-monad: Wojciech Meyer announced omonad, a -ppx version of pa_monad.
>=20
> bitstring: see my comment in another post.  Conceptually, this is quite=
 similar to Sedlex.  The question is whether we can come up with a reason=
able syntax (either with standard patterns, or maybe
> with pattern quotations?).
>=20
>> Also when initially learning OCaml I have used the revised syntax (cam=
lp4r) quite heavily.
>> Nowadays I write everything in the original syntax.
>> While I wouldn't miss the revised syntax, I do think that its much eas=
ier to first learn the revised syntax so it'd be nice
>> if the camlp4 replacement provided that as well.
>=20
> See the other post.  -ppx is really aimed at "syntax extensions"
> which are more about code generation (type-conv, sedlex, ...) or code m=
anipulation (conditional compilation, ...) than actual changes to the con=
crete syntax.  When the concrete syntax is the main
> objective, I can see two different cases:
>=20
>   - Small local syntactic additions, like the one implemented by pa_lwt=
: we should think about generic extension points in the official parser t=
o support them (together with -ppx rewriters).  Or even
> direct support in the compiler when it makes sense (e.g. direct support=
 for local opens is much better than pa_openin).
>=20
>   - More pervasive changes to the whole language grammar (like the revi=
sed syntax):  this is really what -pp is good at, and I personally don't =
have plans to propose an alternative for these cases.=20
> It's good that you can experiment with parsers written with any technol=
ogy.  That said, while I can admit that alternative syntaxes are interest=
ing for experiments or educational purposes, I believe
> that released source code (libraries, applications) should stick to the=
 official syntax, to avoid fragmentation of the community and issues with=
 editors/IDE.
>=20

Will have to think about this more.

--Edwin

From yminsky@janestreet.com  Mon Jan 28 14:02:02 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B338B3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 14:02:02 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.6 from SpamAssassin-3.3.2-1439040 
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:39130
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TzpLk-0007Qt-Xm (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Mon, 28 Jan 2013 14:06:22 +0000
Received: from tot-smtp.delacy.com ([172.27.22.35] helo=tot-is-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1TzpLQ-0005gu-Vf
 for wg-camlp4@lists.ocaml.org; Mon, 28 Jan 2013 09:05:56 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-is-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1TzpLP-0001j3-HQ
 for wg-camlp4@lists.ocaml.org; Mon, 28 Jan 2013 09:05:55 -0500
Received: from mail-fa0-f70.google.com ([209.85.161.70])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1TzpLP-0002h6-DX
 for wg-camlp4@lists.ocaml.org; Mon, 28 Jan 2013 09:05:55 -0500
Received: by mail-fa0-f70.google.com with SMTP id t1so3234665fae.5
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 06:05:54 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:date:message-id:subject:from:to
 :content-type; bh=gin8iwaETYRgBvrTn9MOWpNcRt2zoTZuqKuhdctMfOE=;
 b=O+LZ3jwzzLAXaI3QNZ6fsK0dqKtbnNAZzu9+qDlgvEpNcAto0SJHqvuQ5LujRbLx1p
 ti3dPMNGDWTRG4J6mfvcaXY543Srddx0ocIvnVeJVr0mhPDx110FG44gaBFHwtcnihUZ
 ODd4+MmvYsY13z4t0B/h3Fkl+4gKF9MtxIp8g=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:date:message-id:subject:from:to
 :content-type:x-gm-message-state;
 bh=gin8iwaETYRgBvrTn9MOWpNcRt2zoTZuqKuhdctMfOE=;
 b=O8inSgQ4CyqZyicP4cYJc7t6JuQWQZewEHdPOEr999tSaOTRndU4PwnXJVN5MAzgSX
 JlVlpzzcTiPIGoE5ZrjexGJHQtxryRumXx7kVZtYQxCNrRXCSMEkWPVdR8zLmBfjHg3u
 Jl54RdZY3uc5d9QNyTr9YxHl7dOIvTQbEf9tpLaeLztJdHkOPCOtffABXipDGDt0M+Uy
 TphWqRx219KZwWGfsjTAvTBFOVDCXwipFyrYWygKFgib+9i3mgWp1NrGKM93AwLVEB2J
 R6lssK+Lqi0wj2GzVcIqcumfHlw63vYIBafetD2G6rXNylGTy4bBD65pgSQJcCSimmhC
 jvUw==
X-Received: by 10.14.225.72 with SMTP id y48mr51516468eep.46.1359381954801;
 Mon, 28 Jan 2013 06:05:54 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.14.225.72 with SMTP id y48mr51516440eep.46.1359381954596;
 Mon, 28 Jan 2013 06:05:54 -0800 (PST)
Received: by 10.223.141.66 with HTTP; Mon, 28 Jan 2013 06:05:54 -0800 (PST)
Date: Mon, 28 Jan 2013 09:05:54 -0500
Message-ID: <CACLX4jT7wpUhO5EO69o_9yLyQaeuhCKn29HM6mGqRPH_tM3zmw@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQlT3isv28HmFBbx/lW4mZkbv2+mIS64CIF4UxKHufdfVOUjZGkZDw/fD6gDa7JgsODPE71IrN1HMTSE9af/enhzIEOkYUoYq8kBsMPjyTpmGTNNLC9L4LUIUfiOO4nFqRTak8/K+08w1BC3pp1A0UgQcY88Bw==
Subject: [wg-camlp4] Planning for the different syntax extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 14:02:02 -0000

I'm wondering if it would be worth putting up a page on a wiki
somewhere where we can organize our understanding of how different
syntax extensions could be handled in a -ppx world?  It might be nice
to have this include code-examples of ways in which syntax would have
to change to make these work.

Beyond that, what problems do we need to solve on this WG?  My mental
to-do list is something like:

- Reach a consensus that a -ppx based solution is a good way to
  replace camlp4 as a required part of the OCaml toolchain.

- Enumerate the major current syntax extensions, and for each one,
  determine how this could be handled in a -ppx world

- Figure out what additional syntax (annotations and the like) would
  need to be supported to make -ppx be able to handle the vast
  majority of uses.

- Settle on a proposed concrete syntax for the above.

Is that roughly what we should be aiming to do?

y

From anil@recoil.org  Mon Jan 28 14:04:03 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 754CB3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 14:04:03 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:5755
 helo=dark.recoil.org)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with smtp id 1TzpNm-0000ky-R4 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Mon, 28 Jan 2013 14:08:22 +0000
Received: (qmail 24121 invoked by uid 634); 28 Jan 2013 14:08:22 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from volstagg-0.srg.cl.cam.ac.uk (HELO [10.0.0.83]) (128.232.32.232)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Mon, 28 Jan 2013 14:08:21 +0000
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <CAJMfKEW1Ls0mVOnx2SHJOyaPFLiULgEDsQiF0OUn+QxTuzCO=Q@mail.gmail.com>
Date: Mon, 28 Jan 2013 14:08:21 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <8602D292-ED4F-48C1-9FC2-F5757763C738@recoil.org>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net>
 <CAJMfKEW1Ls0mVOnx2SHJOyaPFLiULgEDsQiF0OUn+QxTuzCO=Q@mail.gmail.com>
To: Lukasz Stafiniak <lukstafi@gmail.com>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 14:04:03 -0000

On 25 Jan 2013, at 20:52, Lukasz Stafiniak <lukstafi@gmail.com> wrote:

> My uses of camlp4:
> - "let try n =3D expr in expr with handlers"
> - LOGging
> - recently, matrix access/assignment like in bigarrays but for
> built-in arrays (long ago I also played with matlab-like notation)
> - js_of_ocaml
> - list comprehensions and pa_monad, but for educational purposes so =
far.

Could you expand on the logging and matrix ones (are they online =
anywhere?)

I'm interested in a universal logging extension that makes it easier to =
introduce lazy logging statements through code, but the existing ones =
are all a bit tied to their frameworks (e.g. Lwt_log).

Is the matrix access one just a variant of x.{4}.{5}, or does it do =
something cunning to reshape 2D arrays as well?

cheers,
Anil


From romain.bardou@inria.fr  Mon Jan 28 14:28:36 2013
Return-Path: <romain.bardou@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 97C433C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 14:28:36 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [178.32.228.2 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mo2.mail-out.ovh.net ([178.32.228.2]:58578)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1TzplX-000790-o5 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <romain.bardou@inria.fr>); Mon, 28 Jan 2013 14:32:56 +0000
Received: from mail436.ha.ovh.net (b6.ovh.net [213.186.33.56])
 by mo2.mail-out.ovh.net (Postfix) with SMTP id 3A5DDDC1B34
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:42:50 +0100 (CET)
Received: from b0.ovh.net (HELO queueout) (213.186.33.50)
 by b0.ovh.net with SMTP; 28 Jan 2013 16:33:14 +0200
Received: from dhcp-rocq-57.inria.fr (HELO ?128.93.62.57?)
 (romain%bardou.fr@128.93.62.57)
 by ns0.ovh.net with SMTP; 28 Jan 2013 16:33:12 +0200
Message-ID: <51068C15.30402@inria.fr>
Date: Mon, 28 Jan 2013 15:32:53 +0100
From: Romain Bardou <romain.bardou@inria.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.11) Gecko/20121122 Icedove/10.0.11
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
X-Ovh-Mailout: 178.32.228.2 (mo2.mail-out.ovh.net)
Content-Type: text/plain; charset=windows-1252; format=flowed
X-Ovh-Tracer-Id: 10099322165258652268
X-Ovh-Remote: 128.93.62.57 (dhcp-rocq-57.inria.fr)
X-Ovh-Local: 213.186.33.20 (ns0.ovh.net)
X-OVH-SPAMSTATE: OK
X-OVH-SPAMSCORE: 0
X-OVH-SPAMCAUSE: gggruggvucftvghtrhhoucdtuddrfeehledrkeegucetufdoteggodetrfcurfhrohhfihhlvgemucfqggfjnecuuegrihhlohhuthemuceftddtnecu
X-Spam-Check: DONE|U 0.500018/N
X-VR-SPAMSTATE: OK
X-VR-SPAMSCORE: 0
X-VR-SPAMCAUSE: gggruggvucftvghtrhhoucdtuddrfeehledrkeegucetufdoteggodetrfcurfhrohhfihhlvgemucfqggfjnecuuegrihhlohhuthemuceftddtnecu
Content-Transfer-Encoding: quoted-printable
Subject: [wg-camlp4] My experience with syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 14:28:36 -0000

Hello,

Here is my experience with syntax extension, if it can help you. I know=20
the goal of -ppx is not syntax extension but more AST rewriting, but well=
.

- When I was younger I wished for some easy way to add constructs such=20
as foreach or stuff like that. Now I'm more for stability, reliability,=20
uniformity, simplicity, anything which ensures my project will compile=20
easily everywhere (even by, let's say, an impatient non-programmer on=20
Windows). And I'm more used to functional programming idioms which make=20
those syntax extensions irrelevant.

- I tried CamlP5 (when it was still CamlP4), had some fun, then CamlP4=20
arrived with no documentation and lost me.

- I don't use any preprocessor at all nowadays. I think changing the=20
syntax does not ease the compilation process nor the maintenance process=20
(hard to read a non-standard syntax 6 months later =97 and lack of suppor=
t=20
from emacs). I've always found other ways.

- The ones I have felt the most need for are local open =97 which is now=20
part of the language =97 and Lwt-like syntax, especially for let-like=20
constructions =97 which seems to be considered by this working group as a=
=20
potential candidate for official support in some way.

- I'm the author of Melt, which is a preprocessor. But I consider Melt=20
to be a domain-specific language which happens to be friendly to OCaml=20
users, not an OCaml extension. I did not use CamlP4, because I lacked=20
the expertise =97 as a result, error messages are terribly located.

- I think the Melt preprocessor could be rewritten as an AST rewriter=20
using -ppx. This would probably be for the best, except for the special=20
approach of quotations from Melt=85 Which is actually rather important th=
ough.

- I understand the OCaml AST quite well, and to me -ppx sounds simple=20
and accessible.

- I use custom operators such as "let (++) =3D" when it's reasonable.

- I don't like the external, "meta" annotations (-pp in Makefile,=20
mainly), which are required to compile a program which uses a=20
preprocessor. Custom operators are great in that regard: they are a way=20
to provide features which look like syntax extensions but which are=20
actually part of the language.

- I would really like a way to specify, in a .ml file itself, that the=20
file must be preprocessed using some given tool. This would remove the=20
need to change the build process, and would make it clear to the reader=20
of the file that it *must* be read with the extension in mind. This may=20
not be easy for generic extenders such as CamlP4 but for a tool such as=20
-ppx whose purpose is actually to use the official syntax, I think it=20
should be discussed. If an extension is optional, for instance if it=20
only adds debugging information, then it makes sense to use -ppx as an=20
optional compilation flag.

- (somehow related, but not really) I found the recent changes to how=20
tuareg indents my code very annoying, especially when my code has a lot=20
of parentheses. Syntax extensions which allow me to have less=20
parentheses have bonus points from me.

Overall, I'm very much in favor of -ppx + generic annotations entry=20
points in official OCaml + official integration of largely recognized=20
extensions. I would consider using your proposal, but probably never Caml=
P4.

Cheers,

--=20
Romain Bardou

From alain@frisch.fr  Mon Jan 28 14:29:32 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7D6733C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 14:29:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:22508
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1TzpmR-0007UY-nM (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 14:33:51 +0000
Received: from [192.168.1.105] ([90.2.82.74]) by mwinf5d35 with ME
 id tSZp1k00H1cCdve03SZpcB; Mon, 28 Jan 2013 15:33:50 +0100
Message-ID: <51068C4C.8090801@frisch.fr>
Date: Mon, 28 Jan 2013 15:33:48 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net>
In-Reply-To: <510677E4.2000500@etorok.net>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 14:29:32 -0000

On 01/28/2013 02:06 PM, Trk Edwin wrote:
> Backward compatibility would be appreciated, especially for something as simple as IFDEF.
 >...
> Thinking about backward compatibility again perhaps there should be more transformation phases:

Backward compatibility is an important topic, since the goal of this 
working group is to propose a migration plan.

My personal view is that we should not complexify our "target" (-ppx) 
only to support backward compatibility.  Clearly, -ppx will require some 
user-visible changes, since it is no longer an option to change the 
concrete syntax.  To take a concrete example, what should a project like 
js_of_ocaml do, once they have a fully functional -ppx version?
An option could be to keep maintaining their camlp4 extension in 
parallel, but extend it to support for the syntax chosen for the -ppx 
version.  The only benefit of it is that users stuck with older versions 
of ocaml can still move smoothly to the new syntax, so as to be ready to 
get rid of camlp4 at some point.  Other users don't need that: they can 
rewrite their project progressively (e.g. module per module) using both 
the camlp4 syntax extension and the -ppx rewriter, and then stop using 
camlp4 when everything has been rewritten.  Is it worth the effort to 
adapt the camlp4 extension to match the new syntax?  It's probably up to 
each project maintainer to decide (considering that supporting several 
versions of camlp4 is also quite challenging).  Who is really stuck with 
old versions of ocaml (and still wanting and able to use new versions of 
packages)?

> Also it'd be nice to have:
>   -ppt Typedtree -> Typedtree for type-level transformations

I don't believe this is a viable option.  Producing Typedtree without 
breaking invariants of the type system (and the type soundness) is 
extremely challenging.  I'd be more comfortable with supporting a 
"Typedtree -> Parsetree" pass, where you'd only need to be able to use 
information from the typedtree so as to produce fragments of code which 
are then type-checked again.  You don't need to fully understand 
everything in the Typedtree to do that, and the type-checker acts as a 
safety net.

OCamlPro worked on a project called "OCaml Templates" doing exactly 
that, but I don't know the status of this project.  (Someone from 
OCamlPro to comment?)


Alain



From alain@frisch.fr  Mon Jan 28 14:41:17 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BF7A93C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 14:41:17 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:49799
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1Tzpxk-0006kb-rK (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 14:45:37 +0000
Received: from [192.168.1.105] ([90.2.82.74]) by mwinf5d35 with ME
 id tSlX1k00b1cCdve03SlXyV; Mon, 28 Jan 2013 15:45:32 +0100
Message-ID: <51068F0A.3000103@frisch.fr>
Date: Mon, 28 Jan 2013 15:45:30 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Yaron Minsky <yminsky@janestreet.com>
References: <CACLX4jT7wpUhO5EO69o_9yLyQaeuhCKn29HM6mGqRPH_tM3zmw@mail.gmail.com>
In-Reply-To: <CACLX4jT7wpUhO5EO69o_9yLyQaeuhCKn29HM6mGqRPH_tM3zmw@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Planning for the different syntax extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 14:41:17 -0000

On 01/28/2013 03:05 PM, Yaron Minsky wrote:
> I'm wondering if it would be worth putting up a page on a wiki
> somewhere where we can organize our understanding of how different
> syntax extensions could be handled in a -ppx world?  It might be nice
> to have this include code-examples of ways in which syntax would have
> to change to make these work.

I like this suggestion, but I propose to wait a little bit.  We can 
discuss on this mailing list about possible -ppx replacement for 
different camlp4 extensions, and then collect the information later, 
when some consensus is reached.

> Beyond that, what problems do we need to solve on this WG?  My mental
> to-do list is something like:
>
> - Reach a consensus that a -ppx based solution is a good way to
>    replace camlp4 as a required part of the OCaml toolchain.
>
> - Enumerate the major current syntax extensions, and for each one,
>    determine how this could be handled in a -ppx world
>
> - Figure out what additional syntax (annotations and the like) would
>    need to be supported to make -ppx be able to handle the vast
>    majority of uses.
>
> - Settle on a proposed concrete syntax for the above.
>
> Is that roughly what we should be aiming to do?

Yes.  See also the list of tasks in the email where I announced the 
creation of this working group ( 
http://lists.ocaml.org/pipermail/wg-camlp4/2013-January/000000.html ). 
The first important task, for me, is to get an idea of the most 
important uses of camlp4 and refine the intended scope of -ppx.

Alain

From bobzhang1988@gmail.com  Mon Jan 28 14:43:01 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 2E70E3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 14:43:01 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.48 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f48.google.com ([209.85.212.48]:52567)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TzpzT-00081W-r7 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 28 Jan 2013 14:47:20 +0000
Received: by mail-vb0-f48.google.com with SMTP id fc21so1860465vbb.35
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 06:47:18 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type
 :content-transfer-encoding;
 bh=TKifY/VxWtwMPoWGviap4YmSmfZZPw4Zy7Jzzx0dSZE=;
 b=qTms0rM5aVi2CMQ6J7RA3zqGg6/o2IqWy0/wT6upUxGpn3X0cF+T6tGtawGHEr8lIX
 9EG0nrCUnEbKVfgksQL9MsR4dk5Rx1QQ/ImxffiA11UDr0Q131aYOAQn28kIStXvrkOR
 xAkb0UaiUcjBTqqfPx6chEiEQdbbKjZ1ZwHi9ks4v6E+NnojtUpdjQ+k9TfQ7pMBvG3h
 ECr/GbgZz1ALsqCK67akcNDiY67IiaPCRF0pAkkhQE02AZlJwuOcIM88Y6TQLHamF41B
 hcYf9yTZ7uJaCrTZmU7LHX94n7vxg9JAyzvzI2VMRsYjtgQXlXV4AVSVej4uU8frhVVd
 z9gg==
MIME-Version: 1.0
X-Received: by 10.220.108.2 with SMTP id d2mr14900166vcp.60.1359384438671;
 Mon, 28 Jan 2013 06:47:18 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 28 Jan 2013 06:47:18 -0800 (PST)
In-Reply-To: <51068C4C.8090801@frisch.fr>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
Date: Mon, 28 Jan 2013 09:47:18 -0500
X-Google-Sender-Auth: K91_etdvAErgDQYEp1BXq0X6q5Q
Message-ID: <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 14:43:01 -0000

Hi Alain,
   Is there any chance to see your current work to decide how hard it
would be to adapt p4 to your new syntax?
  Btw: do you have a clear idea how to implement ast lifting in ppx(
the meta filter in p4) which is an essential part in
quasi-quotation?(the stream parsers have non-trivial optimizations
which depends on it )
On Mon, Jan 28, 2013 at 9:33 AM, Alain Frisch <alain@frisch.fr> wrote:
> On 01/28/2013 02:06 PM, T=F6r=F6k Edwin wrote:
>>
>> Backward compatibility would be appreciated, especially for something as
>> simple as IFDEF.
>
>>...
>
>> Thinking about backward compatibility again perhaps there should be more
>> transformation phases:
>
>
> Backward compatibility is an important topic, since the goal of this work=
ing
> group is to propose a migration plan.
>
> My personal view is that we should not complexify our "target" (-ppx) onl=
y
> to support backward compatibility.  Clearly, -ppx will require some
> user-visible changes, since it is no longer an option to change the concr=
ete
> syntax.  To take a concrete example, what should a project like js_of_oca=
ml
> do, once they have a fully functional -ppx version?
> An option could be to keep maintaining their camlp4 extension in parallel=
,
> but extend it to support for the syntax chosen for the -ppx version.  The
> only benefit of it is that users stuck with older versions of ocaml can
> still move smoothly to the new syntax, so as to be ready to get rid of
> camlp4 at some point.  Other users don't need that: they can rewrite thei=
r
> project progressively (e.g. module per module) using both the camlp4 synt=
ax
> extension and the -ppx rewriter, and then stop using camlp4 when everythi=
ng
> has been rewritten.  Is it worth the effort to adapt the camlp4 extension=
 to
> match the new syntax?  It's probably up to each project maintainer to dec=
ide
> (considering that supporting several versions of camlp4 is also quite
> challenging).  Who is really stuck with old versions of ocaml (and still
> wanting and able to use new versions of packages)?
>
>
>> Also it'd be nice to have:
>>   -ppt Typedtree -> Typedtree for type-level transformations
>
>
> I don't believe this is a viable option.  Producing Typedtree without
> breaking invariants of the type system (and the type soundness) is extrem=
ely
> challenging.  I'd be more comfortable with supporting a "Typedtree ->
> Parsetree" pass, where you'd only need to be able to use information from
> the typedtree so as to produce fragments of code which are then type-chec=
ked
> again.  You don't need to fully understand everything in the Typedtree to=
 do
> that, and the type-checker acts as a safety net.
>
> OCamlPro worked on a project called "OCaml Templates" doing exactly that,
> but I don't know the status of this project.  (Someone from OCamlPro to
> comment?)
>
>
> Alain
>
>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4



--=20
-- Regards, Hongbo

From alain@frisch.fr  Mon Jan 28 14:59:14 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 153AB3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 14:59:14 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:47184
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TzqFA-00088Q-rf (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 15:03:33 +0000
Received: from [192.168.1.105] ([90.2.82.74]) by mwinf5d35 with ME
 id tT3W1k00l1cCdve03T3WWP; Mon, 28 Jan 2013 16:03:32 +0100
Message-ID: <51069340.7050308@frisch.fr>
Date: Mon, 28 Jan 2013 16:03:28 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
In-Reply-To: <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 14:59:14 -0000

On 01/28/2013 03:47 PM, Hongbo Zhang wrote:
> Hi Alain,
>     Is there any chance to see your current work to decide how hard it
> would be to adapt p4 to your new syntax?

Which current work are you referring to?  The stuff about conditional 
compilation implemented on top of -ppx is there:

https://www.lexifi.com/blog/syntax-extensions-without-camlp4-lets-do-it

(I've just adapted the code to the current version of Ast_mapper.)

>    Btw: do you have a clear idea how to implement ast lifting in ppx(
> the meta filter in p4) which is an essential part in
> quasi-quotation?(the stream parsers have non-trivial optimizations
> which depends on it )

Unfortunately, I'm not sure to know what quasi-quotations are (compared 
to just "quotations" in camlp4 parlance).

Can you elaborate on which kinds of non-trivial optimizations in stream 
parser depend on ast lifting?  Compilers have implemented optimizations 
based on AST rewriting for decades without going meta, and I suspect 
that can probably be done for stream parser optimizations as well, but I 
might be proven wrong.


Alain

From darioteixeira@yahoo.com  Mon Jan 28 15:06:45 2013
Return-Path: <darioteixeira@yahoo.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6C21F3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:06:45 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.4 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [98.138.91.214 listed in list.dnswl.dnsbl.ja.net]
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [195.23.39.152 listed in rbl-plus.mail-abuse.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (darioteixeira[at]yahoo.com)
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from nm26-vm2.bullet.mail.ne1.yahoo.com ([98.138.91.214]:22671)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TzqMP-0006V3-Wk (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <darioteixeira@yahoo.com>); Mon, 28 Jan 2013 15:11:05 +0000
Received: from [98.138.90.57] by nm26.bullet.mail.ne1.yahoo.com with NNFMP;
 28 Jan 2013 15:11:00 -0000
Received: from [98.138.87.3] by tm10.bullet.mail.ne1.yahoo.com with NNFMP;
 28 Jan 2013 15:10:59 -0000
Received: from [127.0.0.1] by omp1003.mail.ne1.yahoo.com with NNFMP;
 28 Jan 2013 15:10:59 -0000
X-Yahoo-Newman-Property: ymail-3
X-Yahoo-Newman-Id: 975066.61249.bm@omp1003.mail.ne1.yahoo.com
Received: (qmail 66079 invoked by uid 60001); 28 Jan 2013 15:10:59 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024;
 t=1359385859; bh=HBYFxr6swrJtHbKBJRoA3kRIt4P6ZZ3dLJnTG0UPcmA=;
 h=X-YMail-OSG:Received:X-Rocket-MIMEInfo:X-Mailer:Message-ID:Date:From:Reply-To:Subject:To:MIME-Version:Content-Type:Content-Transfer-Encoding;
 b=IK/uuuyLi6lgwkLppS3Vys7FtIIc3rvS0LoJDlSQDYQpIPc00lnXrkSyHhGGQtLVP0fnN31FGY98Cn6wrsXCNSzAeKbLZrvWh7YKAlZNg5Jr5mwLuHMk8foog/kll4FSTiFQAKHIrD6CAgunN7glPoATG1hwZdhCxtkwd2TL+Pw=
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=s1024; d=yahoo.com;
 h=X-YMail-OSG:Received:X-Rocket-MIMEInfo:X-Mailer:Message-ID:Date:From:Reply-To:Subject:To:MIME-Version:Content-Type:Content-Transfer-Encoding;
 b=ZXR0lp24cFfLhaY8R3bGEzKHJkJ96UmXxtnhrO3sgSos9tTi9lsBxrB8MnXmnEUhqNyol2oKWnsdhRlnyPjNuFPDCq36gpPxUv8w/+aaNNoTjjQqmhPIcD9gsfNFnyIRO7QlZT9UNh2H1vKz1IJv6M9ZdnL/mP5IDRYq29xIRDs=
 ; 
X-YMail-OSG: B6H4gX0VM1m26yv8wI_5lwRW3KUX2b7xmZgwZN7jKEzdHU.
 FRjNngLsbggLiykEtyavYkbMD95DzJAHZs_LpuoOpbtDg53pO2tDJ1LFC1FU
 0TuXCT8T88cZs6DX4Cv8GHNfgpsHCNjgaHXR9IQxREgyX7t7.vZSaoe7LTlY
 oF8wenVAKiu_pEuGqj5_ARrBhzUqhngO4GNW3gpv1qxf5beVDxKMjrLbFCKB
 FX835QUWcu_BtE3GyRSz41vT7phekQY2Fwrg_PeHrWIlIq9GhH2I.WWt.IUd
 dW.pre7tDI1BXAr9Xqyf12mthxJgk_WPB.Ta.7bXAzJVxTSG5Uc8VqPr1xHB
 tYl2wTuJ4I550m45Gd0O48WzjX9gsaGyKpkMIN8xGMWi3uiWlLoAnCHrjL9P
 9ZV3lfp3z8JeK03.kmkmfsQUKdMsAeLzDH6DXi59fej4Zx8Z9YIAK7M4eZfd
 xmxs1Kpo.YvxfoXyc6KCohCucS4MjcCFAJvSpkED0L59xYudH.XB4V7xId92
 pg..jvQ--
Received: from [195.23.39.152] by web120406.mail.ne1.yahoo.com via HTTP;
 Mon, 28 Jan 2013 07:10:59 PST
X-Rocket-MIMEInfo: 001.001,
 SGksCgoKQW5vdGhlciBzeW50YXggZXh0ZW5zaW9uIHRvIGNvbnNpZGVyIGlzIFBHJ09DYW1sJ3MuwqAgVGhvdWdoIGl0IHNlZW1zIGxpa2UKaXQgY2FuIGVhc2lseSBiZSBhZGFwdGVkIHRvIHRoZSBwcHggc3lzdGVtLCBpdCBkb2VzIHJhaXNlIGFuIGlzc3VlIHdoaWNoIEkKdGhpbmsgb3VnaHQgdG8gYmUgZGlzY3Vzc2VkLgoKSGVyZSdzIGhvdyBjb2RlIG1ha2luZyB1c2Ugb2YgZW1iZWRkZWQgU1FMIGluIFBHJ09DYW1sIGN1cnJlbnRseSBsb29rcyBsaWtlOgoodGhlIGRiaCBwYXJhbWV0ZXIgaXMgdGhlIGQBMAEBAQE-
X-Mailer: YahooMailWebService/0.8.131.499
Message-ID: <1359385859.58820.YahooMailNeo@web120406.mail.ne1.yahoo.com>
Date: Mon, 28 Jan 2013 07:10:59 -0800 (PST)
From: Dario Teixeira <darioteixeira@yahoo.com>
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
Subject: [wg-camlp4] PG'OCaml and syntax proliferation
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
Reply-To: Dario Teixeira <darioteixeira@yahoo.com>
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:06:45 -0000

Hi,=0A=0A=0AAnother syntax extension to consider is PG'OCaml's.=A0 Though i=
t seems like=0Ait can easily be adapted to the ppx system, it does raise an=
 issue which I=0Athink ought to be discussed.=0A=0AHere's how code making u=
se of embedded SQL in PG'OCaml currently looks like:=0A(the dbh parameter i=
s the database handle)=0A=0A=A0 let fetch_users dbh =3D=0A=A0=A0=A0=A0=A0=
=A0=A0 PGSQL(dbh) "select id, name from users"=0A=0AThis is syntactally inc=
orrect, of course.=A0 Therefore, any adaptation to the=0Appx system will ne=
cessarily be backwards-incompatible with existing code=0A(not a big problem=
 for me personally, but others may disagree).=A0 As for=0Athe new syntax, s=
everal possibilities exist.=A0 A straightforward one would=0Abe to lowercas=
e the "PGSQL" token; embedded SQL statements would thus take=0Athe form of =
fake function calls:=0A=0A=A0 let fetch_users dbh =3D=0A=A0=A0=A0=A0=A0=A0=
=A0 pgsql(dbh) "select id, name from users"=0A=0AAnother possiblity would b=
e for the SQL statements to be arguments to a fake=0Avariant type construct=
or:=0A=0A=A0 let fetch_users dbh =3D=0A=A0=A0=A0=A0=A0=A0=A0 PGSQL (dbh, "s=
elect id, name from users")=0A=0AI could go on.=A0 Anyway, regardless of ch=
oice, one issue comes to mind.=0APresently, code using the PG'OCaml syntax =
extension is conspicuous by its=0Asyntactic incorrectness.=A0 Therefore, so=
meone unfamiliar with PG'OCaml who=0Ahappened to be looking at code using t=
he syntax extension would immediately=0Asuspect something camlp4ish was goi=
ng on.=A0 With ppx, this signaling would=0Ago away.=A0 This could make code=
 harder to read if several syntax extensions=0Aare simultaneously used, par=
ticularly if syntax extensions become more=0Apopular because ppx makes it s=
o much easier to write them.=0A=0AOne solution is for the community to adop=
t conventions that make syntax=0Aextensions stand out to the naked eye (syn=
tax highlighters in Vim or Emacs=0Acould also take advantage of these conve=
ntions).=A0 For example: the fake variant=0Aconstructor could be instead a =
fake PV constructor ending in "'" (prime).=0AIt should not be hard for edit=
ors to highlight this code in a special way:=0A=0A=A0 let fetch_users dbh =
=3D=0A=A0=A0=A0=A0=A0=A0=A0 `PGSQL' (dbh, "select id, name from users")=0A=
=0AWhat do you think?=0A=0ABest regards,=0ADario Teixeira=0A

From bobzhang1988@gmail.com  Mon Jan 28 15:10:04 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id DD9953C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:10:04 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.177 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f177.google.com ([209.85.220.177]:42889)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TzqPd-0007wC-SY (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 28 Jan 2013 15:14:24 +0000
Received: by mail-vc0-f177.google.com with SMTP id m18so1927784vcm.36
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 07:14:21 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=Bg63zv4M2Rt2z5OPoCbwND4aDO05zMYG5Xq1HN+sUzs=;
 b=drx7o3hFVWpJRRVJeNVcFb012G0awpreuGX2In3+psx98J+twfHvZJjoaGKeXURs3l
 oCEvVAwrQ0pcFnJ1bGroW3dbswpBSqRr5yI10DodZjtMCIBA9erLRub0NjEGjiPco0z0
 eZHdZhPy38LFZRwaGYX/qQKIhuYjHKLQhGQR3UFILEY1vfXpx91+aKSuguJQPyl/Jtw1
 49fciBmf80TTkQNTCTclCPhK85ZK91zUOS46G+YT+Fng8QNHq92g1Y8H5ROWX1nHxBFT
 IIBAlaNQHrnBGwMPOSZn3EnwaAdWe32CACu3O3OBTHrwI6/+7nvY0x6EPmCPI2CRjYsm
 UHBQ==
MIME-Version: 1.0
X-Received: by 10.220.150.83 with SMTP id x19mr15112839vcv.25.1359386060988;
 Mon, 28 Jan 2013 07:14:20 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 28 Jan 2013 07:14:20 -0800 (PST)
In-Reply-To: <51069340.7050308@frisch.fr>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <51069340.7050308@frisch.fr>
Date: Mon, 28 Jan 2013 10:14:20 -0500
X-Google-Sender-Auth: UGiSElZ5BNxDgropVYX-fxHQyiU
Message-ID: <CANcqPu6Oin5CuHLX51fW1yfpBv_NkfX3iV7A4RT9v_B8=+3RBw@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:10:04 -0000

On Mon, Jan 28, 2013 at 10:03 AM, Alain Frisch <alain@frisch.fr> wrote:

> Unfortunately, I'm not sure to know what quasi-quotations are (compared to
> just "quotations" in camlp4 parlance).
>
> Can you elaborate on which kinds of non-trivial optimizations in stream
> parser depend on ast lifting?
http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/camlp4/Camlp4Parsers/Camlp4OCamlRevisedParserParser.ml?view=markup

 Compilers have implemented optimizations
> based on AST rewriting for decades without going meta, and I suspect that
> can probably be done for stream parser optimizations as well, but I might be
> proven wrong.
That's true, but some domain specific optimizations are not implemented in
the compiler(and should not be).


let's keep it simple, suppose in the normal parsing phase
let a = 3  --> will be translated to an normal Parsetree A
<:str_item< let a = 3>> ---> will be translated to a Parsetree B
encoding the Parsetree A, is this the quotation you mean? if so, would
you mind elaborating a bit how to implement it?
>

>
> Alain



-- 
-- Regards, Hongbo

From xavier.clerc@inria.fr  Mon Jan 28 15:13:22 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 100DB3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:13:22 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.5 from SpamAssassin-3.3.2-1439040 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:30483)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TzqSi-000127-Y5 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Mon, 28 Jan 2013 15:17:41 +0000
X-IronPort-AV: E=Sophos;i="4.84,551,1355094000"; 
   d="scan'208";a="253031"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail3-relais-sop.national.inria.fr with ESMTP; 28 Jan 2013 16:19:16 +0100
Date: Mon, 28 Jan 2013 16:17:21 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: wg-camlp4@lists.ocaml.org
Message-ID: <70951260.390480.1359386241331.JavaMail.root@inria.fr>
In-Reply-To: <1740380178.366565.1359385127796.JavaMail.root@inria.fr>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [81.194.27.158]
X-Mailer: Zimbra 7.2.0_GA_2669 (ZimbraWebClient - SAF3 (Mac)/7.2.0_GA_2669)
Subject: [wg-camlp4] Camlp4 uses
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:13:22 -0000

Dear list,

As requested, here are my current uses of camlp4:
  1- in Bisect (code coverage tool), camlp4 is used
     to "inject" code;
  2- in Bolt (logging tool), camlp4 is used to provide
     a new "LOG ... LEVEL ..." expression (such expressions
     can be stripped at compile-time);
  3- in Mascot (style tool), camlp4 is used to get either
     a stream of lexical tokens or an AST, both being used
     to detect code smells;
  4- in Barista (library for handling of Java class files),
     camlp4 is used to provide @"..." and @'...' constructs
     akin to "..." and '...' ones except based upon UTF8;
  5- in Barista, camlp4 is also used to succinctly declare
     exceptions (*).


As previously stated by Alain, case 1 has already been
"ported" to ppx, with minimal effort. Case 4 seems easy
to support through ppx, and case 2 could as well modulo
a slight change in syntax (in the very same spirit as
what has been said about js_of_ocaml).

Case 3 may appear as a perfect fit for ppx, but indeed
it is quite pleasant to write some code smell in OCaml
syntax (through quotations), rather than by matching
against a bare AST. The latter becomes very verbose,
and very hard to read/maintain to say the least.

Case 5 may be adapted to ppx, at the cost of a syntax
change, which is not a big problem as the objective is
only to avoid writing boilerplate code.

At the end of the day, the only thing I am missing in
the current version of ppx is a quotation mechanism.
It is convenient to rely on such a mechanism in order
to easily either generate code, or match against code
patterns.


My two cents,

Xavier Clerc


(*) a small example should be self-explanatory:
  BARISTA_ERROR =
  | O -> "o"
  | A of (x : int) -> Printf.sprintf "%d" x
  | B of (y : float) * (z : string) * (t : char)-> Printf.sprintf "%f %S %C" y z t
being rewritten to:
  type error =
    | O
    | A of int
    | B of float * string * char
  exception Exception of error
  let fail e = raise (Exception e)
  let string_of_error e =
    match e with
    | O -> "o"
    | A x -> Printf.sprintf "%d" x
    | B ((y, z, t)) -> Printf.sprintf "%f %S %C" y z t
  let () =
    Printexc.register_printer
      (function | Exception e -> Some (string_of_error e) | _ -> None)



From edwin+ml-ocaml@etorok.net  Mon Jan 28 15:18:11 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 75AC73C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:18:11 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.7 from SpamAssassin-3.3.2-1439040 
 *  1.1 DKIM_ADSP_ALL No valid author signature, domain signs all mail
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:55801)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TzqXW-0003YE-QP (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Mon, 28 Jan 2013 15:22:31 +0000
Received: from [IPv6:2a02:2f02:1022:a066:1e6f:65ff:fe23:db0d] (unknown
 [IPv6:2a02:2f02:1022:a066:1e6f:65ff:fe23:db0d])
 by mail.etorok.net (Postfix) with ESMTPSA id E6D5046B5;
 Mon, 28 Jan 2013 16:22:28 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359386549;
 bh=6Gz/c0mP7ibx+2G6E/VTn0RLRUypaytsorsb6x6/56w=;
 h=Message-ID:Date:From:MIME-Version:To:CC:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=KYuWh+J/Ux01L0RaBpKvbY+3Uo1I7BD8+2XFTdk00WlN5q8pPP5OZdJUrAbrM78JI
 OS9v0VwkN3rnKhxt3s6y+BcS8PQN+sKYZBJq8J7yheOE6VcH7r0r/I6ZZ6cwQ0krZT
 Q1WR8JpTDRvnDT9earnWpZ9PBIPrqzJeIsKqbLiE=
Message-ID: <510697B4.3020804@etorok.net>
Date: Mon, 28 Jan 2013 17:22:28 +0200
From: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: Alain Frisch <alain@frisch.fr>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
In-Reply-To: <51068C4C.8090801@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:18:11 -0000

On 01/28/2013 04:33 PM, Alain Frisch wrote:
> On 01/28/2013 02:06 PM, T=F6r=F6k Edwin wrote:
>> Backward compatibility would be appreciated, especially for something =
as simple as IFDEF.
>>...
>> Thinking about backward compatibility again perhaps there should be mo=
re transformation phases:
>=20
> Backward compatibility is an important topic, since the goal of this wo=
rking group is to propose a migration plan.
>=20
> My personal view is that we should not complexify our "target" (-ppx) o=
nly to support backward compatibility.  Clearly, -ppx will require some u=
ser-visible changes, since it is no longer an option to
> change the concrete syntax.  To take a concrete example, what should a =
project like js_of_ocaml do, once they have a fully functional -ppx versi=
on?
> An option could be to keep maintaining their camlp4 extension in parall=
el, but extend it to support for the syntax chosen for the -ppx version. =
 The only benefit of it is that users stuck with older
> versions of ocaml can still move smoothly to the new syntax, so as to b=
e ready to get rid of camlp4 at some point.  Other users don't need that:=
 they can rewrite their project progressively (e.g.
> module per module) using both the camlp4 syntax extension and the -ppx =
rewriter, and then stop using camlp4 when everything has been rewritten. =
 Is it worth the effort to adapt the camlp4 extension to
> match the new syntax?  It's probably up to each project maintainer to d=
ecide (considering that supporting several versions of camlp4 is also qui=
te challenging).

Maybe the simplest solution to maintaining backwards compatibility is to =
ship pre-processed source code (using -ppx version) in release tarballs o=
f libraries,
but that isn't without problems either:
+ you don't need to have 4.00.1 to build newer versions of libraries
+ you can switch to the -ppx syntax in your library
+ building the library doesn't require building/running the syntax extens=
ion
- you need a simple way to do this, i.e. oasis/OCamlMakefile/etc. should =
be updated to support this transparently
- ppx's output has to be converted to source code again, and that must be=
 backwards compatible with older OCaml versions
- ppx transformations have to be architecture independent
- without an automated way to test the above it could easily break

>  Who is really stuck with old versions
> of ocaml (and still wanting and able to use new versions of packages)?

My use-case would be: I write an application that I want to be buildable =
at least with OCaml 3.12.1 and 4.00.1 (3.11.2 support would be nice, but =
not required).
The end-user doesn't have to be aware of what OCaml is, I just want them =
to run my application on their OS without having to build a compiler to d=
o that.

Of course I can stick to the last version of a library that supports both=
 (if they introduce an incompatibility) but then I'd have to backport
bugfixes to a private branch on my own. If it comes to that I'd rather fi=
gure a way to distribute preprocessed OCaml source code for the libraries=
 that I use.

>=20
>> Also it'd be nice to have:
>>   -ppt Typedtree -> Typedtree for type-level transformations
>=20
> I don't believe this is a viable option.  Producing Typedtree without b=
reaking invariants of the type system (and the type soundness) is extreme=
ly challenging.  I'd be more comfortable with supporting
> a "Typedtree -> Parsetree" pass, where you'd only need to be able to us=
e information from the typedtree so as to produce fragments of code which=
 are then type-checked again.  You don't need to fully
> understand everything in the Typedtree to do that, and the type-checker=
 acts as a safety net.
> OCamlPro worked on a project called "OCaml Templates" doing exactly tha=
t, but I don't know the status of this project.  (Someone from OCamlPro t=
o comment?)

That'd work too, although the -ppx based tool could do all that on its ow=
n. There wouldn't be any compiler changes required (i.e. no -ppt), just a=
 library
like astmapper to simplify this task.

In fact my -ppl proposal is not really needed either, it could be just a =
library and the tool: a -pp based tool.

The tool would be invoked by -pp:
load all plugins
read source
use OCaml's lexer from compiler-libs to create tokens
apply any token mappers from the plugins
create the parsedtree using compiler-libs again
apply any astmappers from the plugins
run any ppx astmappers given on cmdline
create the typedtree using compiler-libs
apply and typedtree -> parsetree mappers from the plugins
output the ast

This would then be an almost drop-in replacement for camlp4, except that =
syntax extensions (plugins here) will depend on compiler-libs instead of =
camlp4,
and of course you would have similar limitations as -ppx, except you can =
modify the tokenstream as well.
I haven't checked how ocamlfind invokes camlp4 exactly, but it might be p=
ossible to reuse its camlp4 support for this.

Best regards,
--Edwin

From david.waern@gmail.com  Mon Jan 28 15:28:33 2013
Return-Path: <david.waern@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0153F3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:28:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.216.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (david.waern[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-qc0-f173.google.com ([209.85.216.173]:40518)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TzqhY-0000EE-WZ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <david.waern@gmail.com>); Mon, 28 Jan 2013 15:32:52 +0000
Received: by mail-qc0-f173.google.com with SMTP id b12so1341687qca.18
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 07:32:51 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:date:message-id:subject:from:to
 :content-type; bh=NB2kYCQPBahBFDuAI3qL9f3ka4KM4GFiHZOTDN2rwls=;
 b=tSHSjnc96G8P90VgDky5nT+lH1yNDpc2dKXL7T/5HGHADgvgcL9wl+bsFDHQaaq34E
 8Gp/WT1rbN5O7w7JgFjHHeD38UjVdXEpDBWylO3YgcK3jNqQzVQW/YAS/gm1Sq6Zd0Oz
 oXeEssomGWCI2cJl2eEdvcorXcycBppKiHv+lW+e436VGR5YL86wX9TBMxdD+nRxnJ1t
 e35Z7eM+2JUmI62MbJUatjguXuAxP7jjMbj0lkDhtN5uqwZrEaj6Xj4A2zh7MJ5meO7y
 gaXNaKrOA98ad5vUsQMa4ePmWJXwWIVmMEh0YWpUGBV8UcW5AJE9x6+Lur6Wu+dtrbO0
 tDZg==
MIME-Version: 1.0
X-Received: by 10.229.177.14 with SMTP id bg14mr816742qcb.51.1359387171349;
 Mon, 28 Jan 2013 07:32:51 -0800 (PST)
Received: by 10.49.117.7 with HTTP; Mon, 28 Jan 2013 07:32:50 -0800 (PST)
Date: Mon, 28 Jan 2013 16:32:50 +0100
Message-ID: <CAN8ZjBHgN0U0DxQQv7j86KtEYo+8aAM8x4H4S-vsCzmpJvPQ7g@mail.gmail.com>
From: David Waern <david.waern@gmail.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:28:33 -0000

Lukasz Stafiniak wrote:

> My uses of camlp4:
> - "let try n = expr in expr with handlers"

Could you explain what this means? Is the handler installed around the
first expression here only?

Thanks,
David

From alain.frisch@lexifi.com  Mon Jan 28 15:21:26 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 51E593C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:21:26 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:29269
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1Tzqaf-0008SE-no (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 28 Jan 2013 15:25:45 +0000
Received: from [192.168.1.105] ([90.2.82.74]) by mwinf5d35 with ME
 id tTRk1k00b1cCdve03TRkCu; Mon, 28 Jan 2013 16:25:45 +0100
Message-ID: <51069877.5070307@lexifi.com>
Date: Mon, 28 Jan 2013 16:25:43 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
X-Mailman-Approved-At: Mon, 28 Jan 2013 15:29:13 +0000
Subject: [wg-camlp4] Improvements to the OCaml Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:21:26 -0000

Dear all,

Another useful topic for discussion related to -ppx are improvements to 
the OCaml Parsetree itself.  Of course, since the Parsetree is "going 
public" with -ppx, it make sense to improve it before too much code 
depend on it.

Let me list of few points I have in mind:

  - Get rid of some tuples / n-ary constructors in favor of proper 
record types (self-documented, more future proof).  Similarly, prefer 
explicit constructors to "bool" flags (although if we use more records, 
this is less of a problem).

  - Get rid of weird encodings in favor of more explicit representation. 
For instance, Pexp_when: guard expressions should be explicitly put next 
to patterns (or maybe allowed within the pattern algebra with some 
type-error if they are not at the toplevel).  Also, I'm not sure about 
the special "Pexp_assertfalse" node.  Do you have another examples?

  - Be more liberal about where Ptyp_poly must/might appear (the 
type-checker currently expect some dummy Ptyp_poly wrapper in some 
places, and the parser know that).

  - Avoid doing too much desugaring in the parser.  For instance, we 
should probably distinguish between "let open M in e" and "M.(e)" in the 
Parsetree.  Where to stop exactly, I'm not sure.  For instance, I don't 
have a clear opinion on whether record field punning should be handled 
purely in the parser or reflected in the Parsetree.  What do people here 
think?

  - This needs to be discussed, but what about remove those Ptyp_, 
Pexp_, ...., prefixes everywhere?  And similarly for record fields 
(ptype_, ...). Now that we have type-based disambiguation of 
constructors/labels, we don't really need those prefixes and they 
increase the verbosity of AST rewriters.  Some experimentation is 
needed, though.


Don't hesitate to comment on those points and add more!


Alain

From lpw25@hermes.cam.ac.uk  Mon Jan 28 15:38:59 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5B0013C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:38:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:33442)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1Tzqre-0005PT-Rf (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 15:43:18 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1Tzqre-0000b1-GO (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 15:43:18 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 28 Jan 2013 15:43:18 +0000
Date: 28 Jan 2013 15:43:18 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Hongbo Zhang <hongboz@seas.upenn.edu>
Message-ID: <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:38:59 -0000


>  Btw: do you have a clear idea how to implement ast lifting in ppx(
>the meta filter in p4) which is an essential part in
>quasi-quotation?(the stream parsers have non-trivial optimizations
>which depends on it )

I don't think that it is necessery for how I think we should implement 
anti-quotations.

If you consider some quotation with an anti-quotation like:

let body x = 
<:html < <body attr=$x$> Hello, World <\body> >>

When the quotation's parser sees the first "$" it knows it has found an 
anti-quotation. What it then needs to do is ask an OCaml parser to try to 
parse an expression with all the text up until the next unnested "$". With 
a bit of care we can provide this ability with the main compiler's parser 
(which can be linked to through comper-libs).

The quotation parser will then have an parsetree node of type expression. 
Since it is building a parsetree expression to replace the quotation, the 
parsetree node of the antiquotation can be included within this expression 
directly.


From romain.bardou@inria.fr  Mon Jan 28 15:39:58 2013
Return-Path: <romain.bardou@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 89EFC3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:39:58 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [188.165.52.147 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from 8.mo2.mail-out.ovh.net ([188.165.52.147]:53082
 helo=mo2.mail-out.ovh.net)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TzqsV-0005tv-Z6 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <romain.bardou@inria.fr>); Mon, 28 Jan 2013 15:44:18 +0000
Received: from mail436.ha.ovh.net (b6.ovh.net [213.186.33.56])
 by mo2.mail-out.ovh.net (Postfix) with SMTP id 03A01DC1E78
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:53:46 +0100 (CET)
Received: from b0.ovh.net (HELO queueout) (213.186.33.50)
 by b0.ovh.net with SMTP; 28 Jan 2013 17:44:09 +0200
Received: from dhcp-rocq-57.inria.fr (HELO ?128.93.62.57?)
 (romain%bardou.fr@128.93.62.57)
 by ns0.ovh.net with SMTP; 28 Jan 2013 17:44:08 +0200
Message-ID: <51069CB5.6000706@inria.fr>
Date: Mon, 28 Jan 2013 16:43:49 +0100
From: Romain Bardou <romain.bardou@inria.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.11) Gecko/20121122 Icedove/10.0.11
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
X-Ovh-Mailout: 178.32.228.2 (mo2.mail-out.ovh.net)
References: <51069877.5070307@lexifi.com>
In-Reply-To: <51069877.5070307@lexifi.com>
Content-Type: text/plain; charset=windows-1252; format=flowed
X-Ovh-Tracer-Id: 11297279666995038828
X-Ovh-Remote: 128.93.62.57 (dhcp-rocq-57.inria.fr)
X-Ovh-Local: 213.186.33.20 (ns0.ovh.net)
X-OVH-SPAMSTATE: OK
X-OVH-SPAMSCORE: 0
X-OVH-SPAMCAUSE: gggruggvucftvghtrhhoucdtuddrfeehledrkeegucetufdoteggodetrfcurfhrohhfihhlvgemucfqggfjnecuuegrihhlohhuthemuceftddtnecu
X-Spam-Check: DONE|U 0.518882/N
X-VR-SPAMSTATE: OK
X-VR-SPAMSCORE: 0
X-VR-SPAMCAUSE: gggruggvucftvghtrhhoucdtuddrfeehledrkeegucetufdoteggodetrfcurfhrohhfihhlvgemucfqggfjnecuuegrihhlohhuthemuceftddtnecu
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] Improvements to the OCaml Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:39:58 -0000

Le 28/01/2013 16:25, Alain Frisch a =E9crit :
> Dear all,
>
> Another useful topic for discussion related to -ppx are improvements to
> the OCaml Parsetree itself. Of course, since the Parsetree is "going
> public" with -ppx, it make sense to improve it before too much code
> depend on it.
>
> Let me list of few points I have in mind:
>
> - Get rid of some tuples / n-ary constructors in favor of proper record
> types (self-documented, more future proof). Similarly, prefer explicit
> constructors to "bool" flags (although if we use more records, this is
> less of a problem).

Good.

> - Get rid of weird encodings in favor of more explicit representation.
> For instance, Pexp_when: guard expressions should be explicitly put nex=
t
> to patterns (or maybe allowed within the pattern algebra with some
> type-error if they are not at the toplevel). Also, I'm not sure about
> the special "Pexp_assertfalse" node. Do you have another examples?

About assert false as a special node: I think it should stay like this.

It may add a case to treat, but the treatment will usually be trivial.=20
If it is not, then it will probably be an instance of the assert case,=20
in which case you can just call the assert case with <<false>> as an=20
argument. Else it means that you have a very different treatment for=20
false and in this case, you=92re glad that they are separate.

Moreover, this case really is a special case as it is typed differently.=20
I think it is better if the parse tree reflects this, so that the=20
programmer is conscious of this when transforming assertions.

> - Be more liberal about where Ptyp_poly must/might appear (the
> type-checker currently expect some dummy Ptyp_poly wrapper in some
> places, and the parser know that).
>
> - Avoid doing too much desugaring in the parser. For instance, we shoul=
d
> probably distinguish between "let open M in e" and "M.(e)" in the
> Parsetree. Where to stop exactly, I'm not sure. For instance, I don't
> have a clear opinion on whether record field punning should be handled
> purely in the parser or reflected in the Parsetree. What do people here
> think?

That=92s a tricky one!!

> - This needs to be discussed, but what about remove those Ptyp_, Pexp_,
> ...., prefixes everywhere? And similarly for record fields (ptype_,
> ...). Now that we have type-based disambiguation of constructors/labels=
,
> we don't really need those prefixes and they increase the verbosity of
> AST rewriters. Some experimentation is needed, though.

I think it would probably be better if it is actually possible, yes.

--=20
Romain Bardou


From fabrissimo@gmail.com  Mon Jan 28 15:40:36 2013
Return-Path: <fabrissimo@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0B1A93C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:40:36 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.53 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (fabrissimo[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f53.google.com ([74.125.82.53]:54335)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TzqtD-0003y2-q0 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <fabrissimo@gmail.com>); Mon, 28 Jan 2013 15:44:55 +0000
Received: by mail-wg0-f53.google.com with SMTP id fn15so1765452wgb.8
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 07:44:54 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:date:x-google-sender-auth:message-id
 :subject:from:to:content-type:content-transfer-encoding;
 bh=UXqN3E7Zq4RlpKbbpQ/227/J0CoxbWvcNrFdC4e8Nvg=;
 b=tmx5sovN+8bTY2mgZJnCjOdQ5jzgMlz7A/0N9qitZfUmDxXVq5lbzFL9YjAC03BdcK
 c5rvzLbVkkrQZDnxqIQYW0Itl5mIx5TtLK2UICn35galh9r+6b6lfZZPsNKBtM4ZeXDL
 JvjIqfokxiWIZjmGs+3hURTDxuq78BNXIzjhjQKKzl6wFJ/iqR2xGdYUBkcSMXx+v+ct
 UDAGDvmi6p3aTx/pj+2BQ49mZ8VdXZlUCscXxTCZqb3zpc/CSNu6hHqEJ0xVpfo2BGZR
 VLFlrtuKLoQ3EPS2uxJldf4BWRCqjNmFQihk4U68s/5l6B5JxOPk5xegcbmjw2GPxSsG
 FU4g==
MIME-Version: 1.0
X-Received: by 10.194.108.101 with SMTP id hj5mr22226419wjb.6.1359387891904;
 Mon, 28 Jan 2013 07:44:51 -0800 (PST)
Sender: fabrissimo@gmail.com
Received: by 10.216.106.69 with HTTP; Mon, 28 Jan 2013 07:44:51 -0800 (PST)
Date: Mon, 28 Jan 2013 16:44:51 +0100
X-Google-Sender-Auth: JHr44iZ0QFhG65kn13gL-bNx7v8
Message-ID: <CAHvkLrNC4XmDbUBdoEfJGER+K_Bza_2evgBWyzqxBUBQoY=K2w@mail.gmail.com>
From: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
To: Alain Frisch <alain@frisch.fr>, wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:40:36 -0000

> From: Alain Frisch <alain@frisch.fr>
>> Also it'd be nice to have:
>>  -ppt Typedtree -> Typedtree for type-level transformations
>
> I don't believe this is a viable option.  Producing Typedtree without bre=
aking invariants of the type system (and the type soundness) is extremely c=
hallenging.  I'd be more comfortable with supporting a "Typedtree -> Parset=
ree" pass, where you'd only need to be able to use information from the typ=
edtree so as to produce fragments of code which are then type-checked again=
.  You don't need to fully understand everything in the Typedtree to do tha=
t, and the type-checker acts as a safety net.
>
> OCamlPro worked on a project called "OCaml Templates" doing exactly that,=
 but I don't know the status of this project.  (Someone from OCamlPro to co=
mment?)

What I did was to add a new quotation <:PARSER_NAME<STRING>> to the
syntax for expressions (and <#PARSER_NAME<STRING>> for toplevel
statements). Then, a new node would be produced in the parsetree,
containing both the PARSER_NAME and the STRING.

During typing, when the typer would find this node, it would try to
find a parser called PARSER_NAME in a database of parsers (loaded by
dynamic linking), use it to parse STRING and generate a parsetree from
it (sometimes, it would return a parsetree containing other quoted
nodes), that would be given to the typer immediatly.

One interesting thing is that the typer calls the parser with an Env.t
argument, i.e. the typing environment at the quotation, that can be
used to find the types of identifiers.

For example:

<@string_of<t>>

would be parsed by a parser "string_of", that would locate "t" among
types in the current environment, and generate a function to print it
in a string. The difference with "type_conv" is that the definition of
the type is exact, i.e. not a syntactic approximation.

Also, <:type_of<x>> can be used to return a type representation of the
type of variable "x" in the current env.

--Fabrice

From bobzhang1988@gmail.com  Mon Jan 28 15:45:52 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 73DB83C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:45:52 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.47 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f47.google.com ([209.85.212.47]:49503)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1TzqyI-0004Tr-ox (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 28 Jan 2013 15:50:12 +0000
Received: by mail-vb0-f47.google.com with SMTP id e21so1915987vbm.34
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 07:50:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=/wFgl6YcRPqZux0KMXLDQfQJ3uvLmSEmTZuIAkEj3Sw=;
 b=oPx0pMdYUCQKQdK+7tDC+fA1Xqx4oVEqEiUXXMRd4cv+Pms2jjCfiLt+89qcn+DhDg
 GEPJVJbkCeRu9RaaRODRnd44aAAJiImD0DdkNTAo556ziXk7KY1l0EwK9A14JXrb/t9Q
 atV4Zx9wBHhJf0Ox0+HhLXu/f8e4lDTuU8TroO4sVc7sIVF36VaF7DywQpb/TK1o8l3w
 gkA1XIm+5ZwuvDK4jM81Argi+346YyxzbTm3SW9pJT6R74OzplMVKuUVCBdmf40JiMlD
 y9E3BPK0KWGusqxOdRD2WwojNQTmBckrDurnFhDPgV8ncmjreZxR8lL+eh5ZsTTRpxfI
 E+dQ==
MIME-Version: 1.0
X-Received: by 10.52.36.206 with SMTP id s14mr13384876vdj.93.1359388207227;
 Mon, 28 Jan 2013 07:50:07 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 28 Jan 2013 07:50:07 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
Date: Mon, 28 Jan 2013 10:50:07 -0500
X-Google-Sender-Auth: 1ta9egi6y6RxV2wfN7-J9vOToeo
Message-ID: <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:45:52 -0000

On Mon, Jan 28, 2013 at 10:43 AM, Leo White <lpw25@cam.ac.uk> wrote:

> I don't think that it is necessery for how I think we should implement
> anti-quotations.
>
> If you consider some quotation with an anti-quotation like:
>
> let body x = <:html < <body attr=$x$> Hello, World <\body> >>
>
The html example is trivial to implement in ppx, I agree.

Here is not the parser problem, it's the staging  problem when you
generalize it to the quotation "str_item" or "expr". Using the
built-in parser does not help here.



-- 
-- Regards, Hongbo

From alain@frisch.fr  Mon Jan 28 15:50:11 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7846C3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:50:11 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:30509
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1Tzr2U-00024d-RO (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 15:54:31 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tTuV1k00y3lHbAL03TuV94; Mon, 28 Jan 2013 16:54:30 +0100
Message-ID: <51069F34.6000007@frisch.fr>
Date: Mon, 28 Jan 2013 16:54:28 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Dario Teixeira <darioteixeira@yahoo.com>
References: <1359385859.58820.YahooMailNeo@web120406.mail.ne1.yahoo.com>
In-Reply-To: <1359385859.58820.YahooMailNeo@web120406.mail.ne1.yahoo.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] PG'OCaml and syntax proliferation
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:50:11 -0000

On 01/28/2013 04:10 PM, Dario Teixeira wrote:
>    let fetch_users dbh =
>          PGSQL(dbh) "select id, name from users"
>
> This is syntactally incorrect, of course.

I've written Caml code for 17 years, and it was not clear to me that 
this is syntactically incorrect, I had to try...

As an alternative but close enough syntax, I suggest:

(PGSQL dbh) "select id, name from users"

or:

(PGSQL) dbg "select id, name from users"

Since a constructor never evaluates to a function, it remains clear 
enough that these two forms are special.

> I could go on.  Anyway, regardless of choice, one issue comes to mind.
> Presently, code using the PG'OCaml syntax extension is conspicuous by its
> syntactic incorrectness.    Therefore, someone unfamiliar with
 > PG'OCaml who happened to be looking at code using the syntax
 > extension would immediately suspect something camlp4ish was going on.

Good point.

What do you think of the proposals above?  They are "trivially" wrong 
OCaml code, although not on a strictly syntactic criterion (but a simple 
local typing criterion is close enough).

>    let fetch_users dbh =
>          `PGSQL' (dbh, "select id, name from users")

This is also an option.  I agree that it's a good idea to reach some 
consensus about such guidelines (and I know it will be difficult, as for 
any syntactic choice!).



Alain

From bobzhang1988@gmail.com  Mon Jan 28 15:50:40 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AD2BB3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:50:40 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.171 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f171.google.com ([209.85.220.171]:36575)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1Tzr2x-0002Ym-Xa (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 28 Jan 2013 15:55:00 +0000
Received: by mail-vc0-f171.google.com with SMTP id p1so1961091vcq.2
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 07:54:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=zVQBjgqVd7lQQUBccMa5GUCSyFYcrQWfL6srBGkH79c=;
 b=s8qtfvxNlW/FeXLwmoG7NckN5klfE4YP9kMka+aTCOaRXqdbW9HrRQGofvcmEQC+7e
 Zq3olpfahhThJLos4dNRPCrFxIs6TMBj7q/uNRe95l5W0UIzwhd169Dmp9LaydDtkGO1
 zv1NGc6nL28uzpz5SiCOGuHnJgI1i7B2xjzkE2bHF8nHobfT5s+87TwweVqJt80Ayypg
 9uam6uBR8LIEv9+pywbt7WNiVacwwMnLFdISurBA73Kvp2ub6MEXiYnmp8jr9L8Y0kK0
 9jlTSjIXB/oXgkI9p9Er4ooCoPl94CGJFn7i0VCDaKkjvaPEy8YcuuONA8vKRSoDfZmM
 1UHQ==
MIME-Version: 1.0
X-Received: by 10.52.67.79 with SMTP id l15mr13509507vdt.128.1359388498688;
 Mon, 28 Jan 2013 07:54:58 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 28 Jan 2013 07:54:58 -0800 (PST)
In-Reply-To: <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
Date: Mon, 28 Jan 2013 10:54:58 -0500
X-Google-Sender-Auth: ESJDvCK25p7ItmQmO4nJNpNxN1M
Message-ID: <CANcqPu4AJztShx43vFEgd0KSEWofjKx+b6gcvxGXmL8o_3Aeew@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:50:40 -0000

This paper may help you understand how quasi-quotation is implemented
http://ipaper.googlecode.com/git-history/969fbd798753dc0b10ea9efe5af7773ff10f728a/Miscs/why-its-nice-to-be-quoted.pdf
The problem is unlike Haskell, we don't have a nice generic
programming ability in ocaml(The Scrap your bolierpolate approach in
Haskell)

On Mon, Jan 28, 2013 at 10:50 AM, Hongbo Zhang <hongboz@seas.upenn.edu> wrote:
> On Mon, Jan 28, 2013 at 10:43 AM, Leo White <lpw25@cam.ac.uk> wrote:
>
>> I don't think that it is necessery for how I think we should implement
>> anti-quotations.
>>
>> If you consider some quotation with an anti-quotation like:
>>
>> let body x = <:html < <body attr=$x$> Hello, World <\body> >>
>>
> The html example is trivial to implement in ppx, I agree.
>
> Here is not the parser problem, it's the staging  problem when you
> generalize it to the quotation "str_item" or "expr". Using the
> built-in parser does not help here.
>
>
>
> --
> -- Regards, Hongbo



-- 
-- Regards, Hongbo

From fabrissimo@gmail.com  Mon Jan 28 15:54:39 2013
Return-Path: <fabrissimo@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 40A9D3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 15:54:39 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.179 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (fabrissimo[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f179.google.com ([74.125.82.179]:44562)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1Tzr6n-0000XN-pa (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <fabrissimo@gmail.com>); Mon, 28 Jan 2013 15:58:58 +0000
Received: by mail-we0-f179.google.com with SMTP id x43so1612288wey.24
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 07:58:57 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=dEj8HOTb6YictsJOoVugzr/+SQhskv9ypHRj0+iXiTs=;
 b=l7+j4jsewcjvNUZBLRQ1ihbJQ44ivzM82L/qnpWGW2UEL2iI6ronXdCUg5j2IElFAN
 owBOryfiOv24wB7bmafSmwTsOYj1FtqaGYiRVQhTwaKRpuBc0uZRRZdHQYufATQWBobf
 GYAnuQGMffWQ+LOVr4aQ39ZuHGEcEMGiHE99jjCZ3sV8Rneqinqq8gGdivyB+51h/4GM
 Zz7GrvlSLogX846KuhPVMMAPaZnorTWwRv74CuEpEq4bbREsS2G6SMX+epCJgeV6yU2D
 5y/kQfpxQbhgBBqhwT3M9Aul5X6aaS7vZZevqdKayzBxCZHav9EfMNkquVo8UydZwBoO
 4ebg==
MIME-Version: 1.0
X-Received: by 10.180.102.170 with SMTP id fp10mr10604187wib.13.1359388737710; 
 Mon, 28 Jan 2013 07:58:57 -0800 (PST)
Sender: fabrissimo@gmail.com
Received: by 10.216.106.69 with HTTP; Mon, 28 Jan 2013 07:58:57 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
Date: Mon, 28 Jan 2013 16:58:57 +0100
X-Google-Sender-Auth: mMg_jxBroeV98bfONHOsdzX3RsM
Message-ID: <CAHvkLrPuDdadx7o43cKuW35Z1rZ_20MD+phrAXCx2Jwga=TPHA@mail.gmail.com>
From: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 15:54:39 -0000

On Mon, Jan 28, 2013 at 4:43 PM, Leo White <lpw25@cam.ac.uk> wrote:
>
>>  Btw: do you have a clear idea how to implement ast lifting in ppx(
>> the meta filter in p4) which is an essential part in
>> quasi-quotation?(the stream parsers have non-trivial optimizations
>> which depends on it )
>
>
> I don't think that it is necessery for how I think we should implement
> anti-quotations.
>
> If you consider some quotation with an anti-quotation like:
>
> let body x = <:html < <body attr=$x$> Hello, World <\body> >>

In my ocaml-templates approach, the "html" parser would just receive a
string "<body attr=$x$> Hello, World <\body>", and call its parser,
that would have to understand anti-quotations, by returning a node
Pquotation("ocaml", "x") telling the typer that it should call the
ocaml parser on the string "x"...

--Fabrice

From lukstafi@gmail.com  Mon Jan 28 16:18:17 2013
Return-Path: <lukstafi@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A2A423C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:18:17 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (lukstafi[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f173.google.com ([209.85.128.173]:49305)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TzrTg-0007ho-Xn (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <lukstafi@gmail.com>); Mon, 28 Jan 2013 16:22:37 +0000
Received: by mail-ve0-f173.google.com with SMTP id oz10so843917veb.32
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 08:22:35 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=IzHA0JMyTMI3nG7L7D+hMOXfGnyeCzh+00FIOn1TD4w=;
 b=sCFlPogDyR2gyg0p5Db8T8w/BQ0+uz9G1IS3qRfRg1BeM78OngBgNIRWdXRgcMPxOy
 s6RFzET4CaoOYZa1la5+oC+hpVyYelWTb8GXvaVeb8uOSIrLbVXJbsPc9oBIieZyoD9x
 096NKrD2RUP96UNrfN5xIHyuo8Wfa+z3PcujhhkgsIaxyZs7X2U7gQwN2xjzzC2Ptg5h
 zrzTCKguvEWo142DNO6qMPXGsnXkQr/7bkHQLc/+L6cW5iYM1D7xSKtn6UO+hg+vIS1v
 CFH7TkXqIQ9KtkXtGtOjtzPruIZvkfLTbXVKzc4EV39Nko+5SXGA0B5VHz4cplfhpJWX
 JOcQ==
X-Received: by 10.52.90.140 with SMTP id bw12mr9300305vdb.50.1359390155644;
 Mon, 28 Jan 2013 08:22:35 -0800 (PST)
MIME-Version: 1.0
Received: by 10.58.46.80 with HTTP; Mon, 28 Jan 2013 08:22:15 -0800 (PST)
In-Reply-To: <8602D292-ED4F-48C1-9FC2-F5757763C738@recoil.org>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net>
 <CAJMfKEW1Ls0mVOnx2SHJOyaPFLiULgEDsQiF0OUn+QxTuzCO=Q@mail.gmail.com>
 <8602D292-ED4F-48C1-9FC2-F5757763C738@recoil.org>
From: Lukasz Stafiniak <lukstafi@gmail.com>
Date: Mon, 28 Jan 2013 17:22:15 +0100
Message-ID: <CAJMfKEW8CaPsmTnALo85LMkH5oNQH09HNaS7dJaU_ruiywzprA@mail.gmail.com>
To: Anil Madhavapeddy <anil@recoil.org>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:18:17 -0000

I forgot to mention that we also use optional compilation "IFDEF" / "ELSE".

On Mon, Jan 28, 2013 at 3:08 PM, Anil Madhavapeddy <anil@recoil.org> wrote:
> On 25 Jan 2013, at 20:52, Lukasz Stafiniak <lukstafi@gmail.com> wrote:
>
>> My uses of camlp4:
>> - "let try n = expr in expr with handlers"
>> - LOGging
>> - recently, matrix access/assignment like in bigarrays but for
>> built-in arrays (long ago I also played with matlab-like notation)
>> - js_of_ocaml
>> - list comprehensions and pa_monad, but for educational purposes so far.
>
> Could you expand on the logging and matrix ones (are they online anywhere?)
>
> I'm interested in a universal logging extension that makes it easier to introduce lazy logging statements through code, but the existing ones are all a bit tied to their frameworks (e.g. Lwt_log).

http://sourceforge.net/p/toss/code-0/1821/tree/trunk/Toss/caml_extensions/pa_log.ml

> Is the matrix access one just a variant of x.{4}.{5}, or does it do something cunning to reshape 2D arrays as well?

The syntax is x.(4,5) and it currently translates into x.(4).(5); it
might be reasonable to use flat arrays but the main purpose is
readability.

http://sourceforge.net/p/toss/code-0/1821/tree/trunk/Toss/caml_extensions/pa_matrix.ml

From lpw25@hermes.cam.ac.uk  Mon Jan 28 16:22:27 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 535C13C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:22:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:48078)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1TzrXh-0001O5-RG (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 16:26:45 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1TzrXh-00079P-Dr (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 16:26:45 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 28 Jan 2013 16:26:45 +0000
Date: 28 Jan 2013 16:26:45 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
Message-ID: <Prayer.1.3.5.1301281626450.32043@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CAHvkLrPuDdadx7o43cKuW35Z1rZ_20MD+phrAXCx2Jwga=TPHA@mail.gmail.com>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CAHvkLrPuDdadx7o43cKuW35Z1rZ_20MD+phrAXCx2Jwga=TPHA@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:22:27 -0000


>In my ocaml-templates approach, the "html" parser would just receive a
>string "<body attr=$x$> Hello, World <\body>", and call its parser,
>that would have to understand anti-quotations, by returning a node
>Pquotation("ocaml", "x") telling the typer that it should call the
>ocaml parser on the string "x"...

The problem with this method is that it does not support nested 
anti-quotations, or any other occurrence of the closing delimiter (the 
second "$") within the expression. You don't know whether "x" is the 
expression that needs to be parsed without asking the OCaml parser.


From lukstafi@gmail.com  Mon Jan 28 16:25:14 2013
Return-Path: <lukstafi@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7CCC13C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:25:14 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (lukstafi[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f173.google.com ([209.85.220.173]:58400)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TzraP-0002JD-X8 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <lukstafi@gmail.com>); Mon, 28 Jan 2013 16:29:34 +0000
Received: by mail-vc0-f173.google.com with SMTP id fy7so1979217vcb.18
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 08:29:32 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=k8C95ubfFMC812ViGyGkh2+Bi6yYDGH+A35ISuMl5wQ=;
 b=RrrKd9axAq/7qaNLM7Yrc9PvmOrzDR+WNXlwT8RR7uu8+qciWdH7oScIRPZB3xf1mx
 gnpeFxnJIInB9fdIblj0aXwSMDLycjxAhCtKye/rCX88qzPsxWmSfr5nyKgGhw4Nh5CY
 tLkyX70yd2EeyKWKWVAqxZCE9EK8sTDIxt320NU9EX8C4FHTM/yosMGq4n3HMUsyL3L/
 HWaz+YoK/St+f3GZoGDnniw0Ga4kMolDXsOMS5ucES7rD3D4UgYk8Uo8FMfVBTLjK1m1
 M9RxpCbEB5b1XurJoLklYehfJJMUgk9rKSMibTSiXgZIqGVJi/QTVzci8lFqDxbKIw6j
 5aMA==
X-Received: by 10.52.180.200 with SMTP id dq8mr13414895vdc.71.1359390572590;
 Mon, 28 Jan 2013 08:29:32 -0800 (PST)
MIME-Version: 1.0
Received: by 10.58.46.80 with HTTP; Mon, 28 Jan 2013 08:29:12 -0800 (PST)
In-Reply-To: <CAN8ZjBHgN0U0DxQQv7j86KtEYo+8aAM8x4H4S-vsCzmpJvPQ7g@mail.gmail.com>
References: <CAN8ZjBHgN0U0DxQQv7j86KtEYo+8aAM8x4H4S-vsCzmpJvPQ7g@mail.gmail.com>
From: Lukasz Stafiniak <lukstafi@gmail.com>
Date: Mon, 28 Jan 2013 17:29:12 +0100
Message-ID: <CAJMfKEUTHbibNMbUEDFfR=BAUDP06c8GD2dDsQNos2RVHO8_KQ@mail.gmail.com>
To: David Waern <david.waern@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:25:14 -0000

On Mon, Jan 28, 2013 at 4:32 PM, David Waern <david.waern@gmail.com> wrote:
> Lukasz Stafiniak wrote:
>
>> My uses of camlp4:
>> - "let try n = expr in expr with handlers"
>
> Could you explain what this means? Is the handler installed around the
> first expression here only?

Yes.

http://sourceforge.net/p/toss/code-0/1821/tree/trunk/Toss/caml_extensions/pa_let_try.ml
http://research.microsoft.com/en-us/um/people/akenn/sml/ExceptionalSyntax.pdf

From lpw25@hermes.cam.ac.uk  Mon Jan 28 16:27:17 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9F3653C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:27:17 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:46998)
 by ppsw-43.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:25)
 with esmtpa (EXTERNAL:lpw25) id 1TzrcP-00087T-mt (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 16:31:37 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1TzrcP-0007sD-4j (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 16:31:37 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 28 Jan 2013 16:31:37 +0000
Date: 28 Jan 2013 16:31:37 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Hongbo Zhang <hongboz@seas.upenn.edu>
Message-ID: <Prayer.1.3.5.1301281631370.32043@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CANcqPu4AJztShx43vFEgd0KSEWofjKx+b6gcvxGXmL8o_3Aeew@mail.gmail.com>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
 <CANcqPu4AJztShx43vFEgd0KSEWofjKx+b6gcvxGXmL8o_3Aeew@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:27:17 -0000

> This paper may help you understand how quasi-quotation is implemented 
> http://ipaper.googlecode.com/git-history/969fbd798753dc0b10ea9efe5af7773ff10f728a/Miscs/why-its-nice-to-be-quoted.pdf

You only need the meta filter if you implement quotations using "option 1" 
(see Section 3.1 of the paper). "Option 2", which is what I described in my 
last post, works perfectly well without it.


From alain@frisch.fr  Mon Jan 28 16:38:02 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4BF103C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:38:02 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:57207
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1Tzrmn-0000NO-Pz (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 16:42:22 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tUiL1k00A3lHbAL03UiLXf; Mon, 28 Jan 2013 17:42:20 +0100
Message-ID: <5106AA6A.8090006@frisch.fr>
Date: Mon, 28 Jan 2013 17:42:18 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Xavier Clerc <xavier.clerc@inria.fr>
References: <70951260.390480.1359386241331.JavaMail.root@inria.fr>
In-Reply-To: <70951260.390480.1359386241331.JavaMail.root@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: [wg-camlp4] Matching on concrete syntax (was: Re:  Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:38:02 -0000

On 01/28/2013 04:17 PM, Xavier Clerc wrote:
>    3- in Mascot (style tool), camlp4 is used to get either
>       a stream of lexical tokens or an AST, both being used
>       to detect code smells;
...
> Case 3 may appear as a perfect fit for ppx, but indeed
> it is quite pleasant to write some code smell in OCaml
> syntax (through quotations), rather than by matching
> against a bare AST. The latter becomes very verbose,
> and very hard to read/maintain to say the least.

I've the intuition that matching AST with patterns in a concrete syntax 
is a source of never lasting problems.  But it seems you disagree, so 
I'm very much interested in your experience!

Let me explain my point.

First, the parsing (concrete syntax -> AST) has some built-in 
ambiguities and resolution mechanism that the programmer does not even 
need to be aware of.  For instance, I cannot tell how a pattern like "p1 
| p2 | p3" or an expression "e1 || e2 || e3" is parsed without looking 
at the parser (or most probably, playing with -dparsetree).  Is the 
pattern parsed like "(p1 | p2) | p3" or "p1 | (p2 | p3)"?  The problem 
is that you might need to know such information if you write AST 
transformation/matching with concrete syntax.

Second, you need some special extra "concrete" syntax to be able to 
specify whether you care or not about some features.  For instance, you 
need to be able to write a pattern which matches a recursive let 
binding, or non-recursive let binding, or any kind of let binding 
(recursive or not).  In the latter case, you probably want to be able to 
extract the recursive flag for later use.  You need to introduce some 
syntax for that.  Similarly, we need some expert knowledge and specific 
syntax to know exactly what your "free variables" stand for: you need to 
be able to say that you want to match an arbitrary constructor or a 
constructor with no module prefix.  This is the source for a lot of 
complexity related to anti-quotations in camlp4, in my opinion.

Third, working on concrete syntax gives a false feeling that you don't 
need to master the abstract syntax, but this is wrong.  You need to know 
if "M.(e)" and "let open M in e" map to the same AST or not, if record 
punning is implemented in the parser or if is represented in the AST 
(exercise: define a "code smell rule" to detect missed punning 
opportunity, i.e. an instance of a record field "l = l"), etc.

Fourth, working with concrete syntax requires to master a new 
sub-language (with quotations, anti-quotations), which is far from 
trivial, and which looks like the real OCaml syntax but is not really 
the same.  There is a learning curve here, which should not be neglected.


At the end of the day, I find it both simpler and more robust to work on 
abstract syntax, even if this is marginally more verbose.  Some actions 
can reduce the syntactic overhead of working with abstract syntax: 
cleaning up the Parsetree (and removing prefixes) and improvements to 
our beloved host language itself (such as 
http://caml.inria.fr/mantis/view.php?id=5667 or even more ambitious 
extensions).  I'd rather see time invested in such improvements than on 
providing support for working with (almost-)concrete syntax.  But YMMV, 
and I'm very much interested to hear about the opinion and experience of 
other people on this topic.  (And of course, once quotations are 
supported, nothing prevent some -ppx rewriter to provide support for 
concrete-syntax matching, to be used for compiling other -ppx rewriters...)



Alain

From fabrissimo@gmail.com  Mon Jan 28 16:40:32 2013
Return-Path: <fabrissimo@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E70C33C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:40:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.51 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (fabrissimo[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f51.google.com ([209.85.214.51]:45527)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1TzrpC-0005vy-pS (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <fabrissimo@gmail.com>); Mon, 28 Jan 2013 16:44:52 +0000
Received: by mail-bk0-f51.google.com with SMTP id ik5so1487654bkc.10
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 08:44:50 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:message-id:date:from:user-agent:mime-version:to
 :cc:subject:references:in-reply-to:content-type;
 bh=Y1ltQCMteOG9aoPAPVrjp08u4tv4t7NIxTyRdhgyyps=;
 b=VyVmzMn7DZrEVK2eAcDX5qEbLTmRtA28mEtXY/DRa9evfwyGWMtHdc5D7J7GZf27tq
 ascfeJiBWVnfs5+UFwVnmnLtarGpJQL5axdceSxCWw/wB5QdIoZ0ZH5srr2CCg5JPAwe
 P4RiuoTuCWPxte5c5Tkb25b5O9/l7ncW/Hg03lRMHibpfZY5R9MEOLAN9T4sjsV27wCX
 6h+x1QFSQCaXSk4qgk8yWCdlwqxemytr33332UK90Ke1xKWpj2dCOavRYqsetdh785pI
 9YkBr540utNONGFOZlDafDfrCSVAQW62/itJ0Q2APLp/RP+dIrVYK42BC6+Vc1TEkvgk
 MEeA==
X-Received: by 10.204.149.10 with SMTP id r10mr4102823bkv.67.1359391490634;
 Mon, 28 Jan 2013 08:44:50 -0800 (PST)
Received: from ?IPv6:2001:660:3013:3:8546:e754:4748:552a?
 ([2001:660:3013:3:8546:e754:4748:552a])
 by mx.google.com with ESMTPS id n1sm6787127bkv.14.2013.01.28.08.44.49
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Mon, 28 Jan 2013 08:44:50 -0800 (PST)
Sender: Fabrice Le Fessant <fabrissimo@gmail.com>
Message-ID: <5106AB01.8050603@inria.fr>
Date: Mon, 28 Jan 2013 17:44:49 +0100
From: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:17.0) Gecko/20130106 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CAHvkLrPuDdadx7o43cKuW35Z1rZ_20MD+phrAXCx2Jwga=TPHA@mail.gmail.com>
 <Prayer.1.3.5.1301281626450.32043@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301281626450.32043@hermes-1.csi.cam.ac.uk>
Content-Type: multipart/mixed; boundary="------------020900000000030100080307"
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:40:33 -0000

This is a multi-part message in MIME format.
--------------020900000000030100080307
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

On 01/28/2013 05:26 PM, Leo White wrote:
>
>> In my ocaml-templates approach, the "html" parser would just receive a
>> string "<body attr=$x$> Hello, World <\body>", and call its parser,
>> that would have to understand anti-quotations, by returning a node
>> Pquotation("ocaml", "x") telling the typer that it should call the
>> ocaml parser on the string "x"...
>
> The problem with this method is that it does not support nested
> anti-quotations, or any other occurrence of the closing delimiter (the
> second "$") within the expression. You don't know whether "x" is the
> expression that needs to be parsed without asking the OCaml parser.

Of course. For that, anyway, you need a "standard" of quotations and 
anti-quotations, i.e. all parsers must obey the rule that 
anti-quotations are between $...$ and quotations between <:XXX< ... >>.
Then, you don't need to know the syntax within the (anti-)quotations, 
you can delegate parsing at the time the parsetree is needed.

--Fabrice

--------------020900000000030100080307
Content-Type: text/x-vcard; charset=utf-8;
 name="fabrice_le_fessant.vcf"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment;
 filename="fabrice_le_fessant.vcf"

begin:vcard
fn:Fabrice LE FESSANT
n:LE FESSANT;Fabrice
org:INRIA Saclay -- Ile-de-France;P2P & OCaml
adr;quoted-printable:;;Parc Orsay Universit=C3=A9 ;Orsay CEDEX;;91893;France
email;internet:fabrice.le_fessant@inria.fr
title;quoted-printable:Charg=C3=A9 de Recherche
tel;work:+33 1 74 85 42 14
tel;fax:+33 1 74 85 42 49 
url:http://fabrice.lefessant.net/
version:2.1
end:vcard


--------------020900000000030100080307--

From anil@recoil.org  Mon Jan 28 16:41:07 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5035F3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:41:07 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:10825
 helo=dark.recoil.org)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with smtp id 1Tzrpm-0001kj-RU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Mon, 28 Jan 2013 16:45:27 +0000
Received: (qmail 5321 invoked by uid 634); 28 Jan 2013 16:45:26 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from dhcp-128-232-157-19.eduroam.csx.cam.ac.uk (HELO
 dhcp-128-232-157-19.eduroam.csx.cam.ac.uk) (128.232.157.19)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Mon, 28 Jan 2013 16:45:24 +0000
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <CACLX4jT7wpUhO5EO69o_9yLyQaeuhCKn29HM6mGqRPH_tM3zmw@mail.gmail.com>
Date: Mon, 28 Jan 2013 16:45:19 +0000
Content-Transfer-Encoding: 7bit
Message-Id: <38DF26ED-18E2-4258-BCDD-37F8FB803AF9@recoil.org>
References: <CACLX4jT7wpUhO5EO69o_9yLyQaeuhCKn29HM6mGqRPH_tM3zmw@mail.gmail.com>
To: Yaron Minsky <yminsky@janestreet.com>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Planning for the different syntax extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:41:07 -0000

On 28 Jan 2013, at 14:05, Yaron Minsky <yminsky@janestreet.com> wrote:

> I'm wondering if it would be worth putting up a page on a wiki
> somewhere where we can organize our understanding of how different
> syntax extensions could be handled in a -ppx world?  It might be nice
> to have this include code-examples of ways in which syntax would have
> to change to make these work.

I've been Doing Some Science (tm) via a bulk build of OPAM where we
replace all the camlp4 binaries with wrapper scripts that redirect
their command lines to a log directory.  This lets us grab a full
list of pa_*.cma files that are built, and then manually classify
them.  That should help populate the wiki when it's time to set it up.

The (incomplete) list of .cma files used in the build so far is below.
Some of these are clearly just support libraries (bigarray), and others
are from the compiler libs, but there's a good number that I haven't
seen before.  I'll update this list tomorrow when the bulk build is 
complete.

--
bigarray.cma
bin_prot.cma
bitstring.cma
bitstring_persistent.cma
comparelib.cma
cstruct-syntax.cma
fieldslib.cma
lwt-syntax.cma
lwt-syntax-log.cma
lwt-syntax-options.cma
netaccel.cma
netstring.cma
netstring-pcre.cma
netsys.cma
netsys_oothr.cma
nums.cma
odn.cma
optcomp.cma
oUnit.cma
pa_bin_prot.cma
pa_compare.cma
pa_deriving.cma
pa_dyntype.cma
pa_fields_conv.cma
../pa_meta_conv.cma
pa_odn.cma
pa_orakuda.cma
pa_ounit.cma
../../pa/pa_meta_conv.cma
pa_pipebang.cma
parsing/grammar.cma
pa_sexp_conv.cma
pa_type_conv.cma
pa_ulex.cma
pa_variants_conv.cma
pcre.cma
pxp_pp.cma
sexplib.cma
src/pa_do.cma
src/pa_do_nums.cma
src/pa_infix.cma
str.cma
syntax/pa_cow.cma
../syntax/pa_deriving.cma
unix.cma
variantslib.cma
xstrp4.cma


From alain@frisch.fr  Mon Jan 28 16:47:17 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9762B3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:47:17 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:19702
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1Tzrvk-0004el-Sl (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 16:51:37 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tUrb1k0153lHbAL03Urcqs; Mon, 28 Jan 2013 17:51:36 +0100
Message-ID: <5106AC96.60906@frisch.fr>
Date: Mon, 28 Jan 2013 17:51:34 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CAHvkLrPuDdadx7o43cKuW35Z1rZ_20MD+phrAXCx2Jwga=TPHA@mail.gmail.com>
 <Prayer.1.3.5.1301281626450.32043@hermes-1.csi.cam.ac.uk>
 <5106AB01.8050603@inria.fr>
In-Reply-To: <5106AB01.8050603@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:47:17 -0000

On 01/28/2013 05:44 PM, Fabrice Le Fessant wrote:
> On 01/28/2013 05:26 PM, Leo White wrote:
>>
>>> In my ocaml-templates approach, the "html" parser would just receive a
>>> string "<body attr=$x$> Hello, World <\body>", and call its parser,
>>> that would have to understand anti-quotations, by returning a node
>>> Pquotation("ocaml", "x") telling the typer that it should call the
>>> ocaml parser on the string "x"...
>>
>> The problem with this method is that it does not support nested
>> anti-quotations, or any other occurrence of the closing delimiter (the
>> second "$") within the expression. You don't know whether "x" is the
>> expression that needs to be parsed without asking the OCaml parser.
>
> Of course. For that, anyway, you need a "standard" of quotations and
> anti-quotations, i.e. all parsers must obey the rule that
> anti-quotations are between $...$ and quotations between <:XXX< ... >>.
> Then, you don't need to know the syntax within the (anti-)quotations,
> you can delegate parsing at the time the parsetree is needed.

We need to be careful about lexical conventions: do we lex strings and 
comments as the standard lexer within quotations, for instance?  Do we 
provide a mechanism to escape the closing delimiters?

-- Alain

From lpw25@hermes.cam.ac.uk  Mon Jan 28 16:56:37 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 802093C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:56:37 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:44683)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1Tzs4n-0008JT-WN (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 17:00:57 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1Tzs4n-0003iC-0W (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 17:00:57 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 28 Jan 2013 17:00:56 +0000
Date: 28 Jan 2013 17:00:56 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301281700560.32043@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5106AC96.60906@frisch.fr>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CAHvkLrPuDdadx7o43cKuW35Z1rZ_20MD+phrAXCx2Jwga=TPHA@mail.gmail.com>
 <Prayer.1.3.5.1301281626450.32043@hermes-1.csi.cam.ac.uk>
 <5106AB01.8050603@inria.fr> <5106AC96.60906@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:56:37 -0000

On Jan 28 2013, Alain Frisch wrote:

>On 01/28/2013 05:44 PM, Fabrice Le Fessant wrote:
>> On 01/28/2013 05:26 PM, Leo White wrote:
>>>
>>>> In my ocaml-templates approach, the "html" parser would just receive a
>>>> string "<body attr=$x$> Hello, World <\body>", and call its parser,
>>>> that would have to understand anti-quotations, by returning a node
>>>> Pquotation("ocaml", "x") telling the typer that it should call the
>>>> ocaml parser on the string "x"...
>>>
>>> The problem with this method is that it does not support nested
>>> anti-quotations, or any other occurrence of the closing delimiter (the
>>> second "$") within the expression. You don't know whether "x" is the
>>> expression that needs to be parsed without asking the OCaml parser.
>>
>> Of course. For that, anyway, you need a "standard" of quotations and
>> anti-quotations, i.e. all parsers must obey the rule that
>> anti-quotations are between $...$ and quotations between <:XXX< ... >>.
>> Then, you don't need to know the syntax within the (anti-)quotations,
>> you can delegate parsing at the time the parsetree is needed.
>
>We need to be careful about lexical conventions: do we lex strings and 
>comments as the standard lexer within quotations, for instance?  Do we 
>provide a mechanism to escape the closing delimiters?

I don't think that we should lex anything other than the closing delimeter, 
that is, after all, the idea of a quotation.

Rather than providing an escape mechanism, it would be easier to provide 
multiple options for the delimers. For instance we could allow <:foo ?< 
(where ? is any character) to be matched by >?>, this makes it easy to 
avoid clashes.

We could also allow <:foo ?{  ... }?>, <:foo ?( ... )?> etc.

From fabrissimo@gmail.com  Mon Jan 28 16:57:07 2013
Return-Path: <fabrissimo@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 235DD3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 16:57:07 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1439040 
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (fabrissimo[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.49 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f49.google.com ([209.85.214.49]:49753)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1Tzs55-000767-se (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <fabrissimo@gmail.com>); Mon, 28 Jan 2013 17:01:16 +0000
Received: by mail-bk0-f49.google.com with SMTP id w11so1492011bku.22
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 09:01:15 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:message-id:date:from:user-agent:mime-version:to
 :cc:subject:references:in-reply-to:content-type;
 bh=RyM1Lwj5IekPO9XIpIc+ShJQz/YwmJw3FmlCG6NJ+0I=;
 b=BRMW3fZAUOyWXQ57VhJpKQxOI6EIqtRJyUBthALrk0tFcDvHOX+/oztmmaOjidTQuq
 frUJKS+0Q/rokvjsM5x4K39kczQIX/WoafAOvRTk02z3lRixlzDIA0EXSrb0OrO9TtgO
 +MIJmqJMzflWSdUPRUEkkbbB66AWNuBX1A4Kvj/6yTyNMQtpxIvrp5852NB9MUzwsppz
 F8f9v0EaO759E3TmsXXYH4G1O1eoHxRIc0yi1CFIOlVRBpI3YDrdgBmeLn6KzebinZHm
 lUIkyiN1GzDlKf7D2RqlFXBEFweHe0U7NzSiEdf3JegN+E9jtQPzzgpaAM5xROxHj2D2
 5dEA==
X-Received: by 10.204.4.201 with SMTP id 9mr2709554bks.39.1359392475649;
 Mon, 28 Jan 2013 09:01:15 -0800 (PST)
Received: from ?IPv6:2001:660:3013:3:8546:e754:4748:552a?
 ([2001:660:3013:3:8546:e754:4748:552a])
 by mx.google.com with ESMTPS id hu20sm6529637bkc.12.2013.01.28.09.01.14
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Mon, 28 Jan 2013 09:01:14 -0800 (PST)
Sender: Fabrice Le Fessant <fabrissimo@gmail.com>
Message-ID: <5106AEDA.4050305@inria.fr>
Date: Mon, 28 Jan 2013 18:01:14 +0100
From: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:17.0) Gecko/20130106 Thunderbird/17.0.2
MIME-Version: 1.0
To: Alain Frisch <alain@frisch.fr>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CAHvkLrPuDdadx7o43cKuW35Z1rZ_20MD+phrAXCx2Jwga=TPHA@mail.gmail.com>
 <Prayer.1.3.5.1301281626450.32043@hermes-1.csi.cam.ac.uk>
 <5106AB01.8050603@inria.fr> <5106AC96.60906@frisch.fr>
In-Reply-To: <5106AC96.60906@frisch.fr>
Content-Type: multipart/mixed; boundary="------------040305050502040400090601"
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 16:57:07 -0000

This is a multi-part message in MIME format.
--------------040305050502040400090601
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

On 01/28/2013 05:51 PM, Alain Frisch wrote:
> On 01/28/2013 05:44 PM, Fabrice Le Fessant wrote:
>> Of course. For that, anyway, you need a "standard" of quotations and
>> anti-quotations, i.e. all parsers must obey the rule that
>> anti-quotations are between $...$ and quotations between <:XXX< ... >>.
>> Then, you don't need to know the syntax within the (anti-)quotations,
>> you can delegate parsing at the time the parsetree is needed.
>
> We need to be careful about lexical conventions: do we lex strings and
> comments as the standard lexer within quotations, for instance?  Do we
> provide a mechanism to escape the closing delimiters?

You would probably want to have "$$" => "$" to escape it, and
something similar for "<:" and ">>".

I think you have two sets of alternative levels, i.e. "even" and "odd" 
levels, $...$ can only appear in "even" levels, and <:...<...>> in "odd" 
levels, so you only need to escape delimiters in the levels where they 
can appear, no ?

--Fabrice

--------------040305050502040400090601
Content-Type: text/x-vcard; charset=utf-8;
 name="fabrice_le_fessant.vcf"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment;
 filename="fabrice_le_fessant.vcf"

begin:vcard
fn:Fabrice LE FESSANT
n:LE FESSANT;Fabrice
org:INRIA Saclay -- Ile-de-France;P2P & OCaml
adr;quoted-printable:;;Parc Orsay Universit=C3=A9 ;Orsay CEDEX;;91893;France
email;internet:fabrice.le_fessant@inria.fr
title;quoted-printable:Charg=C3=A9 de Recherche
tel;work:+33 1 74 85 42 14
tel;fax:+33 1 74 85 42 49 
url:http://fabrice.lefessant.net/
version:2.1
end:vcard


--------------040305050502040400090601--

From lpw25@hermes.cam.ac.uk  Mon Jan 28 17:02:42 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B89323C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 17:02:42 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:48542)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1TzsAg-0001A4-qr (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 17:07:02 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1TzsAg-0004Zq-Bf (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 17:07:02 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 28 Jan 2013 17:07:02 +0000
Date: 28 Jan 2013 17:07:02 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
Message-ID: <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5106AEDA.4050305@inria.fr>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CAHvkLrPuDdadx7o43cKuW35Z1rZ_20MD+phrAXCx2Jwga=TPHA@mail.gmail.com>
 <Prayer.1.3.5.1301281626450.32043@hermes-1.csi.cam.ac.uk>
 <5106AB01.8050603@inria.fr> <5106AC96.60906@frisch.fr>
 <5106AEDA.4050305@inria.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 17:02:42 -0000

>You would probably want to have "$$" => "$" to escape it, and
>something similar for "<:" and ">>".
>
>I think you have two sets of alternative levels, i.e. "even" and "odd" 
>levels, $...$ can only appear in "even" levels, and <:...<...>> in "odd" 
>levels, so you only need to escape delimiters in the levels where they 
>can appear, no ?

I think it would be better to leave parsing anti-quotations to the 
quotations themselves, rather than forcing everyone to use $...$. For many 
situations $...$ is much more heavyweight syntax than necessary.


From david.waern@gmail.com  Mon Jan 28 17:09:16 2013
Return-Path: <david.waern@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id CF58E3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 17:09:16 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.54 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (david.waern[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-qe0-f54.google.com ([209.85.128.54]:52104)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TzsH1-0003aJ-s9 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <david.waern@gmail.com>); Mon, 28 Jan 2013 17:13:36 +0000
Received: by mail-qe0-f54.google.com with SMTP id 1so948445qeb.27
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 09:13:35 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=w+M58n+C2JTOoZOwHBNEdbaoyZ9H/2rRvCHzbfB3XeU=;
 b=v7CeRkB0KkIThidOqzBb5qjjzSQYpx489LaW+zp4LmqEgUvKbUUBypGnFMiFC+l9j7
 QwoEM+DvFvXFHL5I1Ji3RwoaZEn1iP+PhXun2xx7j5xXBQd8YC7IojeKnwPjHfhQQ+ED
 w4rZ1cC6HOs70U8UIyawnvgAHb6oHM6dDUpJ6bVkzmKU5HqltceqG/K7sGmIpMAxOjsz
 m4E394scJ6uAb7bMsnmvCNb55xyrwaKXBN79eAgOOdM2MDvFcQso+Eslv6Cpj7WMrKpU
 9cImId79EHKfzfuOgmOkCSDZnSX2ZkQdqP31dF8qqBjyW5rrVzOZqUH4SN1ltivkwrzt
 1ilA==
MIME-Version: 1.0
X-Received: by 10.229.105.220 with SMTP id u28mr3954684qco.111.1359393215078; 
 Mon, 28 Jan 2013 09:13:35 -0800 (PST)
Received: by 10.49.117.7 with HTTP; Mon, 28 Jan 2013 09:13:34 -0800 (PST)
In-Reply-To: <CAJMfKEUTHbibNMbUEDFfR=BAUDP06c8GD2dDsQNos2RVHO8_KQ@mail.gmail.com>
References: <CAN8ZjBHgN0U0DxQQv7j86KtEYo+8aAM8x4H4S-vsCzmpJvPQ7g@mail.gmail.com>
 <CAJMfKEUTHbibNMbUEDFfR=BAUDP06c8GD2dDsQNos2RVHO8_KQ@mail.gmail.com>
Date: Mon, 28 Jan 2013 18:13:34 +0100
Message-ID: <CAN8ZjBEV57pAUD4Urfr19+NQK2yiuo2gVvV7Ef2bp4t2E7iDfA@mail.gmail.com>
From: David Waern <david.waern@gmail.com>
To: Lukasz Stafiniak <lukstafi@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 17:09:16 -0000

2013/1/28 Lukasz Stafiniak <lukstafi@gmail.com>:
> On Mon, Jan 28, 2013 at 4:32 PM, David Waern <david.waern@gmail.com> wrote:
>> Lukasz Stafiniak wrote:
>>
>>> My uses of camlp4:
>>> - "let try n = expr in expr with handlers"
>>
>> Could you explain what this means? Is the handler installed around the
>> first expression here only?
>
> Yes.
>
> http://sourceforge.net/p/toss/code-0/1821/tree/trunk/Toss/caml_extensions/pa_let_try.ml
> http://research.microsoft.com/en-us/um/people/akenn/sml/ExceptionalSyntax.pdf

OK. I've also wanted similar syntax, but I've noticed that if Alain's
"static exceptions" [1] proposal is accepted then encoding such things
using existing OCaml syntax becomes a bit lighter:

try raise (`Cont expr) with
| `Cont n -> expr
| handlers

[1]: http://www.lexifi.com/blog/static-exceptions

David

From virgile.prevosto@gmail.com  Mon Jan 28 17:14:45 2013
Return-Path: <virgile.prevosto@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4FF763C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 17:14:45 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.44 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (virgile.prevosto[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f44.google.com ([74.125.82.44]:50692)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TzsMK-0008Q4-Ri (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <virgile.prevosto@gmail.com>); Mon, 28 Jan 2013 17:19:05 +0000
Received: by mail-wg0-f44.google.com with SMTP id dr12so1260465wgb.35
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 09:19:04 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:content-type;
 bh=2wURGlw7L0LhFPJzBHFtmQ+SU5icWlpU9dtVBFLJvSA=;
 b=gUg5sPprhyeGVaCdOsv1Cib5Tg+zQ3NNvPI5Aj6GVPOA5iK0h3Thz07Hh/9h0Za1+m
 rP9K55HlhgX46DH7vnM4ngaSvumMhQbWUm/zcJ8RZCTAAascpUz8/UphzxTrvNYfQD5R
 q+3dqMeKvboWDCwPVSuXG3YfNvqPxqYtQ5PeZ+yxIRVjgfqN1o3SIESqaEZ46aH4crUL
 De3NSIxQdrB+kWdEUvKI7IrcTENMTomIKHiyol8s7F2K1NjiZ9D5FMKFlZUFlP/AMrIL
 ppz/AkqTjFD0vHw2Q6WoWjoER7yrW6p45j4oebt1K9l4fDP659lAenbLnHswjuHFAY7W
 +ARQ==
MIME-Version: 1.0
X-Received: by 10.194.94.37 with SMTP id cz5mr13959247wjb.49.1359393532810;
 Mon, 28 Jan 2013 09:18:52 -0800 (PST)
Sender: virgile.prevosto@gmail.com
Received: by 10.194.177.199 with HTTP; Mon, 28 Jan 2013 09:18:52 -0800 (PST)
In-Reply-To: <51066BCA.1020201@frisch.fr>
References: <510145A5.6030807@frisch.fr>
 <90C5BC201F264C4C902B4E7897660042@erratique.ch>
 <1359044659.30715.4@samsung> <51066BCA.1020201@frisch.fr>
Date: Mon, 28 Jan 2013 18:18:52 +0100
X-Google-Sender-Auth: 3kugjp6XfBkio0DJgQXE3ikoG-E
Message-ID: <CA+yPOVhXtvV5dESJK8=fH2AM6cU2mp0Y2CMDHpKRBDBxybh0Jw@mail.gmail.com>
From: Virgile Prevosto <virgile.prevosto@m4x.org>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 17:14:45 -0000

Hello,

2013/1/28 Alain Frisch <alain@frisch.fr>:

>> Stream parsing is certainly one of the topics to discuss.
>
>
> I've no idea how widely stream parsing is used.  Has anyone some intuition
> about this?
>

Well, it's about the only camlp4 "extension" that I'm using. It's
quite convenient for parsing things that are too complex for regexps
but do not require a full-blown menhir/ocamlyacc grammar. And like
Gerd, I'd find it a bit sad if a feature that once belonged to core
OCaml syntax was to disappear.

Best regards,
-- 
E tutto per oggi, a la prossima volta
Virgile

From bobzhang1988@gmail.com  Mon Jan 28 17:18:30 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 669013C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 17:18:30 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.52 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f52.google.com ([209.85.212.52]:62824)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TzsPx-0007Vd-q4 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 28 Jan 2013 17:22:50 +0000
Received: by mail-vb0-f52.google.com with SMTP id fa15so2027761vbb.11
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 09:22:48 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=Q8qFdgdurJAY8QKsXS9bOQuF6Ut6QFhtnRMANQIY/yM=;
 b=rw140B/fTACjBnXAk/791sCCj2NKpbr8yJil/vy6LUsSulHkxtdGSNHBWu1YEKPcYn
 QsXACWPXW0PZjURCoXNOEQJxIujhix9VrxeSwf/b/H0EoOHsJGwmSHdcy67R5rE3oAjp
 5fLnF/vd8FQfrPGqqwfL7CeicT9ofc6FcJhBZ6I49mS7j6qh9czICnEf/QPROTc8xiGk
 ki6CTfbXUCYnJ4VWP/xIdd/dZ0/a1AyRebMiMzIxj2zynvLuo7dv6GmzK3GPYYc2Cvwq
 iFH2fMP+or1V/136eWYl9xx79nSF/GHNTvxMT77PpwOEE2ai/eKZs/LufR+EIexa8uF+
 ERRA==
MIME-Version: 1.0
X-Received: by 10.220.150.84 with SMTP id x20mr15716525vcv.73.1359393768461;
 Mon, 28 Jan 2013 09:22:48 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 28 Jan 2013 09:22:48 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301281631370.32043@hermes-1.csi.cam.ac.uk>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
 <CANcqPu4AJztShx43vFEgd0KSEWofjKx+b6gcvxGXmL8o_3Aeew@mail.gmail.com>
 <Prayer.1.3.5.1301281631370.32043@hermes-1.csi.cam.ac.uk>
Date: Mon, 28 Jan 2013 12:22:48 -0500
X-Google-Sender-Auth: fX4t9t939XB2KTKOUaZw15NYXTQ
Message-ID: <CANcqPu4p03SE-11rcPpnFP7GcAp2PoPsz3-GQEsLp61ZC4GEpg@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=f46d043c7c08add3ad04d45c86ce
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 17:18:30 -0000

--f46d043c7c08add3ad04d45c86ce
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

I suggest that you might think twice before you think it's a viable option
---------------------------
2. *Copy and paste, creating two new versions of the parser. *One
version will directly return Haskell abstract syntax for a Haskell
pattern, and the other will return Haskell abstract syntax for an
expression.
*This is potentially a maintenance nightmare.*
Furthermore, we lose a lot of the bene=EF=AC=81ts of the type checker:
a value of type TH.ExpQ is Haskell abstract syntax for an
expression, but knowing this tells us nothing about the type of
the Haskell expression represented by the abstract syntax. This
expression could be an Integer, a String or have any other
type=E2=80=94we know only that it is syntactically correct, not that it is
type correct.

On Mon, Jan 28, 2013 at 11:31 AM, Leo White <lpw25@cam.ac.uk> wrote:
>> This paper may help you understand how quasi-quotation is implemented
>>
http://ipaper.googlecode.com/git-history/969fbd798753dc0b10ea9efe5af7773ff1=
0f728a/Miscs/why-its-nice-to-be-quoted.pdf
>
>
> You only need the meta filter if you implement quotations using "option 1=
"
> (see Section 3.1 of the paper). "Option 2", which is what I described in
my
> last post, works perfectly well without it.
>



--=20
-- Regards, Hongbo

--f46d043c7c08add3ad04d45c86ce
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div>I suggest that you might think twice before you think it&#39;s a viabl=
e option</div>---------------------------<br>2. <b>Copy and paste, creating=
 two new versions of the parser. </b>One<br>version will directly return Ha=
skell abstract syntax for a Haskell<br>
pattern, and the other will return Haskell abstract syntax for an expressio=
n. <br><b>This is potentially a maintenance nightmare.</b><br>Furthermore, =
we lose a lot of the bene=EF=AC=81ts of the type checker:<br>a value of typ=
e TH.ExpQ is Haskell abstract syntax for an<br>
expression, but knowing this tells us nothing about the type of<br>the Hask=
ell expression represented by the abstract syntax. This<br>expression could=
 be an Integer, a String or have any other<br>type=E2=80=94we know only tha=
t it is syntactically correct, not that it is<br>
type correct.<br><br>On Mon, Jan 28, 2013 at 11:31 AM, Leo White &lt;<a hre=
f=3D"mailto:lpw25@cam.ac.uk">lpw25@cam.ac.uk</a>&gt; wrote:<br>&gt;&gt; Thi=
s paper may help you understand how quasi-quotation is implemented<br>&gt;&=
gt; <a href=3D"http://ipaper.googlecode.com/git-history/969fbd798753dc0b10e=
a9efe5af7773ff10f728a/Miscs/why-its-nice-to-be-quoted.pdf">http://ipaper.go=
oglecode.com/git-history/969fbd798753dc0b10ea9efe5af7773ff10f728a/Miscs/why=
-its-nice-to-be-quoted.pdf</a><br>
&gt;<br>&gt;<br>&gt; You only need the meta filter if you implement quotati=
ons using &quot;option 1&quot;<br>&gt; (see Section 3.1 of the paper). &quo=
t;Option 2&quot;, which is what I described in my<br>&gt; last post, works =
perfectly well without it.<br>
&gt;<br><br><br><br>-- <br>-- Regards, Hongbo

--f46d043c7c08add3ad04d45c86ce--

From alain@frisch.fr  Mon Jan 28 17:50:46 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 895033C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 17:50:46 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:48260
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1TzsvA-0004Ru-ZP (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 17:55:06 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tVv31k01B3lHbAL03Vv499; Mon, 28 Jan 2013 18:55:04 +0100
Message-ID: <5106BB76.6030804@frisch.fr>
Date: Mon, 28 Jan 2013 18:55:02 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: David Waern <david.waern@gmail.com>
References: <CAN8ZjBHgN0U0DxQQv7j86KtEYo+8aAM8x4H4S-vsCzmpJvPQ7g@mail.gmail.com>
 <CAJMfKEUTHbibNMbUEDFfR=BAUDP06c8GD2dDsQNos2RVHO8_KQ@mail.gmail.com>
 <CAN8ZjBEV57pAUD4Urfr19+NQK2yiuo2gVvV7Ef2bp4t2E7iDfA@mail.gmail.com>
In-Reply-To: <CAN8ZjBEV57pAUD4Urfr19+NQK2yiuo2gVvV7Ef2bp4t2E7iDfA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 17:50:46 -0000

On 01/28/2013 06:13 PM, David Waern wrote:
> OK. I've also wanted similar syntax, but I've noticed that if Alain's
> "static exceptions" [1] proposal is accepted then encoding such things
> using existing OCaml syntax becomes a bit lighter:
>
> try raise (`Cont expr) with
> | `Cont n -> expr
> | handlers

As a side note, this encoding with static exceptions is also much more 
efficient (no allocation required to escape from the exception handler).

Still, this is a good example.  One might indeed want to use a dedicated 
syntax for this common idiom.  My preference would be for extending the 
official language to support it directly.  If one thinks it is generally 
useful, why not put it in the language itself?  It is not difficult to 
extend OCaml to support it directly.

If the proposal is rejected but we have let-fix operators, one can 
decide to have a -ppx rewriter detecting and rewriting the following form:

let? x = try e1 with p -> e2 in
e3


-- Alain

From lukstafi@gmail.com  Mon Jan 28 18:08:39 2013
Return-Path: <lukstafi@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6CF313C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 18:08:39 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.177 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (lukstafi[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f177.google.com ([209.85.220.177]:43758)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TztCU-00046l-Sd (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <lukstafi@gmail.com>); Mon, 28 Jan 2013 18:12:59 +0000
Received: by mail-vc0-f177.google.com with SMTP id m18so2033193vcm.8
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 10:12:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=jrkbX6hXfw8z55Gxt/8FsBasIUPkJ46fjxWHBdwDB6Y=;
 b=J/POXXJj9cqR4c5OHV+43sIuUbl5qh1OqebD9C1xZNioMMlmrLUgN7pLNjRAzmd09x
 wpdhbfFDraONmWE3lEldkz1fkkfs/jGomPM2J8M4QH9nMr3m1iH8KxviWRWlh/gu8Ka2
 rlYAuJX841AdX/SGbBoT8wTCuSQC7ahREPw55DTzFNuGrfAqGNs93RGTcCyLHPL8bXux
 Nmxgnr5Y+zX6ldmnKeqDOZhhv8WQi+kVEVB4FCD1BsEwAsL6ynoDzIWTYuxnPequq4AY
 NPCVCC+WI9eKRDl+lt1H28tW7OmMu85DF0px1aCvCLrS64h7AoFg3Cn099mFy/ack9Vz
 4pwA==
X-Received: by 10.220.157.18 with SMTP id z18mr15898355vcw.72.1359396778169;
 Mon, 28 Jan 2013 10:12:58 -0800 (PST)
MIME-Version: 1.0
Received: by 10.58.46.80 with HTTP; Mon, 28 Jan 2013 10:12:38 -0800 (PST)
In-Reply-To: <5106BB76.6030804@frisch.fr>
References: <CAN8ZjBHgN0U0DxQQv7j86KtEYo+8aAM8x4H4S-vsCzmpJvPQ7g@mail.gmail.com>
 <CAJMfKEUTHbibNMbUEDFfR=BAUDP06c8GD2dDsQNos2RVHO8_KQ@mail.gmail.com>
 <CAN8ZjBEV57pAUD4Urfr19+NQK2yiuo2gVvV7Ef2bp4t2E7iDfA@mail.gmail.com>
 <5106BB76.6030804@frisch.fr>
From: Lukasz Stafiniak <lukstafi@gmail.com>
Date: Mon, 28 Jan 2013 19:12:38 +0100
Message-ID: <CAJMfKEXv5sPxcEiZKVfptTAqiVKpMwnU6FY4Ge56CBxWHo2sVg@mail.gmail.com>
To: Alain Frisch <alain@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 18:08:39 -0000

On Mon, Jan 28, 2013 at 6:55 PM, Alain Frisch <alain@frisch.fr> wrote:
>
> As a side note, this encoding with static exceptions is also much more
> efficient (no allocation required to escape from the exception handler).
>
> Still, this is a good example.  One might indeed want to use a dedicated
> syntax for this common idiom.  My preference would be for extending the
> official language to support it directly.  If one thinks it is generally
> useful, why not put it in the language itself?  It is not difficult to
> extend OCaml to support it directly.
>
> If the proposal is rejected but we have let-fix operators, one can decide to
> have a -ppx rewriter detecting and rewriting the following form:
>
> let? x = try e1 with p -> e2 in
> e3

In discussion on ocaml-batteries list, a syntax like the above was in
a tie with the syntax I prefer (and which is used in tutorials about
camlp4/camlp5)...

From alain@frisch.fr  Mon Jan 28 18:19:04 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D21953C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 18:19:04 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:16787
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TztMa-0007wc-Qn (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 18:23:24 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tWPP1k0103lHbAL03WPPj3; Mon, 28 Jan 2013 19:23:24 +0100
Message-ID: <5106C219.3090401@frisch.fr>
Date: Mon, 28 Jan 2013 19:23:21 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Virgile Prevosto <virgile.prevosto@m4x.org>
References: <510145A5.6030807@frisch.fr>
 <90C5BC201F264C4C902B4E7897660042@erratique.ch> <1359044659.30715.4@samsung>
 <51066BCA.1020201@frisch.fr>
 <CA+yPOVhXtvV5dESJK8=fH2AM6cU2mp0Y2CMDHpKRBDBxybh0Jw@mail.gmail.com>
In-Reply-To: <CA+yPOVhXtvV5dESJK8=fH2AM6cU2mp0Y2CMDHpKRBDBxybh0Jw@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 18:19:04 -0000

On 01/28/2013 06:18 PM, Virgile Prevosto wrote:
> Well, it's about the only camlp4 "extension" that I'm using. It's
> quite convenient for parsing things that are too complex for regexps
> but do not require a full-blown menhir/ocamlyacc grammar. And like
> Gerd, I'd find it a bit sad if a feature that once belonged to core
> OCaml syntax was to disappear.

A general point here: the goal here is not to kill camlp4 and associated 
extensions, but rather to free the basic OCaml ecosystem from its 
dependency to camlp4 in a reasonable time frame.  For instance, I find 
it quite important that ocamlfind could be compiled/maintained without 
camlp4 (if only to make it usable with MetaOCaml, LexiFi's variant of 
OCaml, or the next cool experimental patch to OCaml, etc), and if it's 
easier to rewrite its parser with ocamlyacc or as a manual recursive 
descent one than to develop a replacement for camlp4's stream parsing 
extension, I believe it is a good idea to go this way.  Of course, Gerd 
has to decide!  Even if someone finally decides to write the stream 
parsing stuff based on -ppx, it make sense to me that ocamlfind has a 
minimal number of external dependencies, so it would not be a waste of 
time anyway.

Is anyone else using stream parsers?

Alain

From lpw25@hermes.cam.ac.uk  Mon Jan 28 18:21:20 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D7B2B3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 18:21:20 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:42220)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1TztOm-0005AB-qP (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 18:25:40 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1TztOm-00072O-7E (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 18:25:40 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 28 Jan 2013 18:25:40 +0000
Date: 28 Jan 2013 18:25:40 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Hongbo Zhang <hongboz@seas.upenn.edu>
Message-ID: <Prayer.1.3.5.1301281825400.19837@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CANcqPu4p03SE-11rcPpnFP7GcAp2PoPsz3-GQEsLp61ZC4GEpg@mail.gmail.com>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
 <CANcqPu4AJztShx43vFEgd0KSEWofjKx+b6gcvxGXmL8o_3Aeew@mail.gmail.com>
 <Prayer.1.3.5.1301281631370.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4p03SE-11rcPpnFP7GcAp2PoPsz3-GQEsLp61ZC4GEpg@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 18:21:20 -0000


>I suggest that you might think twice before you think it's a viable option
>---------------------------
>2. *Copy and paste, creating two new versions of the parser. *One
>version will directly return Haskell abstract syntax for a Haskell
>pattern, and the other will return Haskell abstract syntax for an
>expression.
>*This is potentially a maintenance nightmare.*

This part is referring to needing two parsing functions: one for the when=
=20
the quotation is used as a pattern and one for when it is used as an=20
expression. I don't think that needing two parsing functions is really a=20
"maintenance nightmare". Also, with GADTs they don't need to be two=20
separate functions anyway.

>Furthermore, we lose a lot of the bene=EF=AC=81ts of the type checker:
>a value of type TH.ExpQ is Haskell abstract syntax for an
>expression, but knowing this tells us nothing about the type of
>the Haskell expression represented by the abstract syntax. This
>expression could be an Integer, a String or have any other
>type=E2=80=94we know only that it is syntactically correct, not that it is
>type correct.

This is a fair criticism: parsing to a value and then converting that into=
=20
an AST fragment may catch some potential errors in a parser. However, this=
=20
safety could also be obtained by creating the value and the AST in=20
parallel, and simply discarding the data structure when parsing is=20
finished. This may not be as "neat" as deriving the AST from the value, but=
=20
it is also requires no special support.




From yminsky@janestreet.com  Mon Jan 28 18:25:27 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D5A5C3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 18:25:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.6 from SpamAssassin-3.3.2-1439040 
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:39673
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1TztSf-0006UY-rE (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Mon, 28 Jan 2013 18:29:47 +0000
Received: from tot-smtp.delacy.com ([172.27.22.35] helo=tot-is-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1TztSM-0002Ev-7J
 for wg-camlp4@lists.ocaml.org; Mon, 28 Jan 2013 13:29:22 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-is-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1TztSK-0000g8-PJ
 for wg-camlp4@lists.ocaml.org; Mon, 28 Jan 2013 13:29:20 -0500
Received: from mail-bk0-f71.google.com ([209.85.214.71])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1TztSK-00020k-Kq
 for wg-camlp4@lists.ocaml.org; Mon, 28 Jan 2013 13:29:20 -0500
Received: by mail-bk0-f71.google.com with SMTP id jk13so3306505bkc.10
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 10:29:20 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:date:message-id:subject:from:to
 :content-type; bh=gcsEuv3RaMFt6asOD0h2g3a7cgnbvM4ZN0KS7Q+1hb0=;
 b=bo95n+KH+m5QLXAN2UNnszBNIg08y9jaLq2sfG7l/kphO2LbP+KO5LcAhGhZfn2xMn
 tCNdf1JJeS8sBicDceSb+DWiBPTuSR11PQHZX9pB8gwiB4G7TrvoTvfU86/4ubpYWG6m
 Pm8MyPXOnXEyLMnNuZCzglURQOnj7h/z4qIlo=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:date:message-id:subject:from:to
 :content-type:x-gm-message-state;
 bh=gcsEuv3RaMFt6asOD0h2g3a7cgnbvM4ZN0KS7Q+1hb0=;
 b=bC148HU6KKj3kRPJCfIrvU97aRsINOVBBcn8hLl+DlSWAqoscAiwOnlIEtnDaG6TBM
 0AYPa5SbEK3fC1wbHe5HEjMzh4O4oKZwuE6mtFIiWKClGcqzbqZsQPGkeXKrxXHEPDlY
 8Tybc6GCzyhmAHGrSPCuaf/71Lqi7vJVXo4AUHkC1HNrG1wuq54Nu9kqSWSoOQgvYv6J
 ymvGVMe/tytFtIApSpsp3wgzOKXnCb2KaHnOXrTiFHwkwqQqGyCG/8kXysozPAE+PAz8
 CQnMa7KrQylc6vJ8eAQzOUiCV2ASVLe3rULPwhuxCUJHl0WXFu1F+MetauTE9sTzg87z
 3MaQ==
X-Received: by 10.14.2.196 with SMTP id 44mr53788458eef.25.1359397760012;
 Mon, 28 Jan 2013 10:29:20 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.14.2.196 with SMTP id 44mr53788433eef.25.1359397759820; Mon,
 28 Jan 2013 10:29:19 -0800 (PST)
Received: by 10.223.141.66 with HTTP; Mon, 28 Jan 2013 10:29:19 -0800 (PST)
Date: Mon, 28 Jan 2013 13:29:19 -0500
Message-ID: <CACLX4jRa6rp1LxiUPA7fgq4pUdEJBBq5y1JRgj7J_jvsELfg4A@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQmGGGAHXF+KpBJCFqdZEImLRa1mTG0SqYnCXjUxh7FVzhvkbFbCmzTe4Y7ROSOdlPArrZL7rhLztuvRKOTueGRx8XMPmW0k0/b98UbodS/Zn5KeaxQCBgHa/KxHKvA1I7HVKCyuGTVeFEL5Y9M2mziO3pIaDA==
Subject: [wg-camlp4] How Jane Street uses camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 18:25:27 -0000

Let me rattle a few off:

- type-conv style extensions.

  These include bin-prot, sexplib, fieldslib, variantslib, pa_compare...

  A few things to note about these:

  - generators may take argument, like [type t = ... with
    typehash(abstract)]. The generator is one that specifies how to
    parse the arguments (although they have to be well
    parenthesized). In the examples I can think of, either a few
    identifiers are accepted or, in a couple of cases, arbitrary
    expressions are accepted.
  - there can be generators (with optional argument too) on record
    field:

         type t =
           { a : int with default(2), sexp_drop_if(fun x -> x = 2);
           } with sexp

  - We also have some that rely only on quotations. The inside of
    quotations are usually types, sometimes expressions.

- pa_ounit: this gives a lightweight syntax for unit-testing.  You can
  write:

      TEST = <some expression>

  and it does a bunch of camlp4 magic, including capturing the text
  and location of the expression, as part of reporting a unit test
  failure effectively.  A test that runs the code is registered, but
  the actual code isn't run except when unit tests are run.

  You can also do:

      TEST_MODULE = struct ... end

  to create a whole module that won't be instantiated except within
  the running of a unit test.

- pa_nonrec: this is a small extension that adds the ability to
  define a type non-recursively.  Thus, you can write:

      type t
      module M = struct type nonrec t = t list end

  rather than the more annoying:

      type t
      module M = struct type z = t type t = z list end

- pa_pipebang: this converts

     <expr1> |! <expr2>

  into

    <expr2> (expr1)

  which is faster than a naively implemented |! operator

- pa_here: this converts the string _here_ to a source-code location.

- pa_custom_printf: If you put ! before a format string, it allows the
  use of a spec like "%{<Module>}" in the format string.  For example,
  using "%{Time}" wraps [Time.to_string] around the appropriate
  argument.

  It also allows different formats for a given type:
  "%{<Module>.<identifier>}" wraps <Module>.Format.<identifier> around
  the appropriate argument.  For example, "%{Float.pretty}" would wrap
  [Float.Format.pretty] around the appropriate argument.

From bobzhang1988@gmail.com  Mon Jan 28 18:58:40 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A3E153C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 18:58:40 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.45 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f45.google.com ([209.85.212.45]:44423)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1Tztyq-0002pJ-Sn (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 28 Jan 2013 19:03:00 +0000
Received: by mail-vb0-f45.google.com with SMTP id p1so2086313vbi.32
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 11:02:56 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=MAuTpXNrCod4k1EcFZBAtswW/6ZiKO6qDKLgr5dQgo4=;
 b=jh+eHxGGYl2lZ27aSxBmToxf66MYXkJUNwyMwBgJ9wp2umN7AyJ+y2/RCGuyzl9rGf
 9P/IyF0QsIRd7TfXsG0zXJ63elqA8T981dFkwDxl4Gr3GJK9gIhacVWby5RHA/C+cuk1
 UDRhYce1O5T4ixD5mZ53YZ7k9mAntliv4K9K1vWJDQB/MYwPNQNUocjrHp7O4O+4u3qH
 EnVtH99St0f35Do16SWyz4MVA2BSbt9jJxHjkbp7mQYbeMmh0pk87FqAVlUvRTXSIum2
 nteHoZhdytKXi7RK/gWN+5t4qn7O5kTA4K9JLCoEXGSvSwSU8GCQjkNI044MxdFOH/jm
 2h9w==
MIME-Version: 1.0
X-Received: by 10.52.98.98 with SMTP id eh2mr14007607vdb.64.1359399776248;
 Mon, 28 Jan 2013 11:02:56 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 28 Jan 2013 11:02:55 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301281825400.19837@hermes-1.csi.cam.ac.uk>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
 <CANcqPu4AJztShx43vFEgd0KSEWofjKx+b6gcvxGXmL8o_3Aeew@mail.gmail.com>
 <Prayer.1.3.5.1301281631370.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4p03SE-11rcPpnFP7GcAp2PoPsz3-GQEsLp61ZC4GEpg@mail.gmail.com>
 <Prayer.1.3.5.1301281825400.19837@hermes-1.csi.cam.ac.uk>
Date: Mon, 28 Jan 2013 14:02:55 -0500
X-Google-Sender-Auth: Nl8f1b6M2rXPiliiCcVwbiD4QsY
Message-ID: <CANcqPu42_eJhD-WkQBzAXq9xdTnp9u_tnxVopCUHnDZcmb9DyA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=20cf307f380ac565bc04d45decff
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 18:58:40 -0000

--20cf307f380ac565bc04d45decff
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

3 parsers actually.
The original parser, the parser to patt, the parser to expr.
Besides, every user has to maintain 3 parsers if they want to use the
quotation, not only the compiler maintainer.
I would be happy to see a prototype work before other changes

On Mon, Jan 28, 2013 at 1:25 PM, Leo White <lpw25@cam.ac.uk> wrote:

>
>  I suggest that you might think twice before you think it's a viable opti=
on
>> ---------------------------
>> 2. *Copy and paste, creating two new versions of the parser. *One
>>
>> version will directly return Haskell abstract syntax for a Haskell
>> pattern, and the other will return Haskell abstract syntax for an
>> expression.
>> *This is potentially a maintenance nightmare.*
>>
>
> This part is referring to needing two parsing functions: one for the when
> the quotation is used as a pattern and one for when it is used as an
> expression. I don't think that needing two parsing functions is really a
> "maintenance nightmare". Also, with GADTs they don't need to be two
> separate functions anyway.
>
>
>  Furthermore, we lose a lot of the bene=EF=AC=81ts of the type checker:
>> a value of type TH.ExpQ is Haskell abstract syntax for an
>> expression, but knowing this tells us nothing about the type of
>> the Haskell expression represented by the abstract syntax. This
>> expression could be an Integer, a String or have any other
>> type=E2=80=94we know only that it is syntactically correct, not that it =
is
>> type correct.
>>
>
> This is a fair criticism: parsing to a value and then converting that int=
o
> an AST fragment may catch some potential errors in a parser. However, thi=
s
> safety could also be obtained by creating the value and the AST in
> parallel, and simply discarding the data structure when parsing is
> finished. This may not be as "neat" as deriving the AST from the value, b=
ut
> it is also requires no special support.
>
>
>
>


--=20
-- Regards, Hongbo

--20cf307f380ac565bc04d45decff
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

3 parsers actually.<div>The original parser, the parser to patt, the parser=
 to expr.</div><div>Besides, every user has to maintain 3 parsers if they w=
ant to use the quotation, not only the compiler maintainer.=C2=A0</div><div=
>I would be happy to see a prototype work before other changes<br>
<br><div class=3D"gmail_quote">On Mon, Jan 28, 2013 at 1:25 PM, Leo White <=
span dir=3D"ltr">&lt;<a href=3D"mailto:lpw25@cam.ac.uk" target=3D"_blank">l=
pw25@cam.ac.uk</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" s=
tyle=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">
I suggest that you might think twice before you think it&#39;s a viable opt=
ion<br>
---------------------------<br></div>
2. *Copy and paste, creating two new versions of the parser. *One<div class=
=3D"im"><br>
version will directly return Haskell abstract syntax for a Haskell<br>
pattern, and the other will return Haskell abstract syntax for an<br>
expression.<br></div>
*This is potentially a maintenance nightmare.*<br>
</blockquote>
<br>
This part is referring to needing two parsing functions: one for the when t=
he quotation is used as a pattern and one for when it is used as an express=
ion. I don&#39;t think that needing two parsing functions is really a &quot=
;maintenance nightmare&quot;. Also, with GADTs they don&#39;t need to be tw=
o separate functions anyway.<div class=3D"im">
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Furthermore, we lose a lot of the bene=EF=AC=81ts of the type checker:<br>
a value of type TH.ExpQ is Haskell abstract syntax for an<br>
expression, but knowing this tells us nothing about the type of<br>
the Haskell expression represented by the abstract syntax. This<br>
expression could be an Integer, a String or have any other<br>
type=E2=80=94we know only that it is syntactically correct, not that it is<=
br>
type correct.<br>
</blockquote>
<br></div>
This is a fair criticism: parsing to a value and then converting that into =
an AST fragment may catch some potential errors in a parser. However, this =
safety could also be obtained by creating the value and the AST in parallel=
, and simply discarding the data structure when parsing is finished. This m=
ay not be as &quot;neat&quot; as deriving the AST from the value, but it is=
 also requires no special support.<br>

<br>
<br>
<br>
</blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regards, =
Hongbo
</div>

--20cf307f380ac565bc04d45decff--

From info@gerd-stolpmann.de  Mon Jan 28 20:17:03 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3ACF23C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 20:17:03 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.17.10 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.17.10]:62731)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1TzvCk-0004v0-o0 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Mon, 28 Jan 2013 20:21:23 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-211-172.pools.arcor-ip.net
 [94.219.211.172])
 by mrelayeu.kundenserver.de (node=mrbap0) with ESMTP (Nemesis)
 id 0MbaU9-1UGcZo47cL-00JBG9; Mon, 28 Jan 2013 21:21:22 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 91633C00CF;
 Mon, 28 Jan 2013 21:21:21 +0100 (CET)
Date: Mon, 28 Jan 2013 21:21:20 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Alain Frisch <alain@frisch.fr>
In-Reply-To: <51069F34.6000007@frisch.fr> (from alain@frisch.fr on Mon Jan
 28 16:54:28 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359404480.10634.6@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:EGdE8i67WCvs2TprF6Via62WDGpk1NCnjarytryH9h2
 Y8slobm6xH8fOF40zbd3aST4a0qmuICwBv5UnyQpPkDwhGt8NP
 X9CoPXE0SmJ3iUziVvodP0kon7bzNOBlt+bp5MbP1hh2c+A4x0
 gyOC03t/ku2vid8dltSDUULy6b2upfQ2fQYZXO+/HQh+HtNXRX
 ybQSAlbESl10krdgtth0yCc32WeJs7FctIG/Z1lT0OEOATGzKo
 H72aAFj40cR+rP/NPUrakKiloGwpdTWpk3p/G5TEqCRA53eYyC
 aXDS2oS2zbznZ2sFWrBnUQoUgLcaqInn2QMWX20S8sOUhO9x9Y
 SrvelpxW+x/oRe8/LzHjzM3E00CzjrIk9nsB/mPi0
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] PG'OCaml and syntax proliferation
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 20:17:03 -0000

Am 28.01.2013 16:54:28 schrieb(en) Alain Frisch:
> On 01/28/2013 04:10 PM, Dario Teixeira wrote:
>>    let fetch_users dbh =3D
>>          PGSQL(dbh) "select id, name from users"
>>=20
>> This is syntactally incorrect, of course.
>=20
> I've written Caml code for 17 years, and it was not clear to me that =20
> this is syntactically incorrect, I had to try...
>=20
> As an alternative but close enough syntax, I suggest:
>=20
> (PGSQL dbh) "select id, name from users"
>=20
> or:
>=20
> (PGSQL) dbg "select id, name from users"
>=20
> Since a constructor never evaluates to a function, it remains clear =20
> enough that these two forms are special.
>=20
>> I could go on.  Anyway, regardless of choice, one issue comes to =20
>> mind.
>> Presently, code using the PG'OCaml syntax extension is conspicuous =20
>> by its
>> syntactic incorrectness.    Therefore, someone unfamiliar with
> > PG'OCaml who happened to be looking at code using the syntax
> > extension would immediately suspect something camlp4ish was going =20
> on.
>=20
> Good point.
>=20
> What do you think of the proposals above?  They are "trivially" wrong =20
> OCaml code, although not on a strictly syntactic criterion (but a =20
> simple local typing criterion is close enough).
>=20
>>    let fetch_users dbh =3D
>>          `PGSQL' (dbh, "select id, name from users")
>=20
> This is also an option.  I agree that it's a good idea to reach some =20
> consensus about such guidelines (and I know it will be difficult, as =20
> for any syntactic choice!).

I think there are actually two points:

  - whether we want special extensions to the Parsetree for
    preprocessing
  - whether we want special notations for these extensions
    (good for tools, bad for my mind because OCaml is already
    so overloaded with notations)

The second point is not obligatory if you choose to implement the =20
first. For example, an extension could register PGSQL as extension =20
token. Extension tokens would be handled as a separate type of token by =20
the parser. We would then allow

   <exttoken> <expr>+

in expressions and

   <exttoken> <pattern>+

in patterns. We could also define more grammar extensions on type, =20
structure and signature level. This way we could "relax" the OCaml =20
grammar a bit, without introducing too much new syntactical ideas.

Gerd


>=20
>=20
>=20
> Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20


--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From info@gerd-stolpmann.de  Mon Jan 28 20:24:13 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 729FC3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 20:24:13 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.171 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.171]:57733)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1TzvJg-0006zZ-p2 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Mon, 28 Jan 2013 20:28:33 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-211-172.pools.arcor-ip.net
 [94.219.211.172])
 by mrelayeu.kundenserver.de (node=mreu2) with ESMTP (Nemesis)
 id 0MIRr9-1U0jSc3hpX-0043vz; Mon, 28 Jan 2013 21:28:30 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 88606C00CF;
 Mon, 28 Jan 2013 21:28:29 +0100 (CET)
Date: Mon, 28 Jan 2013 21:28:27 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Leo White <lpw25@cam.ac.uk>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk> (from
 lpw25@cam.ac.uk on Mon Jan 28 18:07:02 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359404907.10634.7@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:Y/TXyUZo2+50Ed8qZWotHcfkUEG0D2u73DyEndtEqdP
 VdY2ifrsPRxYG5etngtPC2WyghiD3m6Gp4bG7Dn/MplE2r9APM
 RwVPWyDytoFCMIWZTRFNpqkM8RjXWA+EbOY2vfCGudencL1u5F
 hJjNIEIMxAaj8zNggLludru6brdyVRK1XTY5YW33ZGvrokxSM9
 FgvecjHFI5PSeM4tdiQUp3X8WmjkWo94QTTQEAYZ+F2WF3IGba
 P1Su5Ej6IuHXkMzcAOiZpV6CJlpsbP0qNaCM1o2g9suAXeBnt+
 o5feI/9wX2l46/DmVUYEc7QF0NY1aRalN30EHiUfx4Ho4fEWFp
 8wv8V+cll/0aVUigDOBI=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 20:24:13 -0000

Am 28.01.2013 18:07:02 schrieb(en) Leo White:
>> You would probably want to have "$$" =3D> "$" to escape it, and
>> something similar for "<:" and ">>".
>>=20
>> I think you have two sets of alternative levels, i.e. "even" and =20
>> "odd" levels, $...$ can only appear in "even" levels, and =20
>> <:...<...>> in "odd" levels, so you only need to escape delimiters =20
>> in the levels where they can appear, no ?
>=20
> I think it would be better to leave parsing anti-quotations to the =20
> quotations themselves, rather than forcing everyone to use $...$. For =20
> many situations $...$ is much more heavyweight syntax than necessary.

Typographically, $ is a mistake.

Look for something lighter, and it is probably application-dependent =20
what the best alternative is. E.g. for my XML preprocessor =20
(http://projects.camlcity.org/projects/dl/pxp-1.2.3/doc/manual/html/ref/Int=
ro_preprocessor.html) =20
I used (: ... :) for anti-quotations.

I second Leo's idea to leave it to the preprocessor.

Gerd


> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20


--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From lpw25@hermes.cam.ac.uk  Mon Jan 28 20:56:52 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 921AF3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 20:56:52 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:44778)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1TzvpI-0001Co-qo (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 21:01:12 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1TzvpI-0008JW-B4 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 28 Jan 2013 21:01:12 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 28 Jan 2013 21:01:12 +0000
Date: 28 Jan 2013 21:01:12 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Hongbo Zhang <hongboz@seas.upenn.edu>
Message-ID: <Prayer.1.3.5.1301282101120.21455@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CANcqPu42_eJhD-WkQBzAXq9xdTnp9u_tnxVopCUHnDZcmb9DyA@mail.gmail.com>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
 <CANcqPu4AJztShx43vFEgd0KSEWofjKx+b6gcvxGXmL8o_3Aeew@mail.gmail.com>
 <Prayer.1.3.5.1301281631370.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4p03SE-11rcPpnFP7GcAp2PoPsz3-GQEsLp61ZC4GEpg@mail.gmail.com>
 <Prayer.1.3.5.1301281825400.19837@hermes-1.csi.cam.ac.uk>
 <CANcqPu42_eJhD-WkQBzAXq9xdTnp9u_tnxVopCUHnDZcmb9DyA@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 20:56:52 -0000

>3 parsers actually.
>The original parser, the parser to patt, the parser to expr.

The original parser isn't necessary for the quotation, and of course the 
other two parsers are only both needed if you want the quotation to work as 
both a pattern and an expression.

Anyway, my point is that you do not *need* to implement quotations by 
parsing to a value and then converting to an AST fragment, in fact it is 
often easier not to.

That is not to say that some people might not want to implement their 
quotations by parsing to a value and then converting to an AST fragment. In 
fact, if they want to use an external parser (over which they have little 
control) to parse their quotations then they may have to do it that way.

For these cases I think there are three options:

1. They can implement conversion functions by hand.

2. They could use some kind of type-conv style extension to automatically 
produce the conversion functions. I'm sure such an extension would be 
welcomed by other extension authors.

3. If/when some kind of run-time type representation is added to the 
language, it could be used to create a generic conversion function.


From alain@frisch.fr  Mon Jan 28 20:58:10 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 59C373C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 20:58:10 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:47437)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1TzvqX-0008Eq-oQ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 28 Jan 2013 21:02:30 +0000
Received: from [192.168.0.10] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 2A7FFA6294;
 Mon, 28 Jan 2013 22:02:24 +0100 (CET)
Message-ID: <5106E75F.10100@frisch.fr>
Date: Mon, 28 Jan 2013 22:02:23 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gerd Stolpmann <info@gerd-stolpmann.de>
References: <1359404480.10634.6@samsung>
In-Reply-To: <1359404480.10634.6@samsung>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] PG'OCaml and syntax proliferation
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 20:58:10 -0000

On 1/28/2013 9:21 PM, Gerd Stolpmann wrote:
> The second point is not obligatory if you choose to implement the first.
> For example, an extension could register PGSQL as extension token.
> Extension tokens would be handled as a separate type of token by the
> parser.

-ppx is about letting external processes rewrite already parsed ASTs. 
This does not sound compatible with this approach, unless I missed your 
point.

Alain

From info@gerd-stolpmann.de  Mon Jan 28 21:08:01 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 89F823C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 21:08:01 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.171 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.171]:61200)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1Tzw04-0007lQ-Ys (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Mon, 28 Jan 2013 21:12:21 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-211-172.pools.arcor-ip.net
 [94.219.211.172])
 by mrelayeu.kundenserver.de (node=mreu3) with ESMTP (Nemesis)
 id 0MBvDX-1U7KVl48k3-00An4S; Mon, 28 Jan 2013 22:12:15 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 934C5C00CF;
 Mon, 28 Jan 2013 22:12:14 +0100 (CET)
Date: Mon, 28 Jan 2013 22:12:13 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Alain Frisch <alain@frisch.fr>
In-Reply-To: <51066BCA.1020201@frisch.fr> (from alain@frisch.fr on Mon Jan
 28 13:15:06 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359407533.10634.8@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:5BYfJZJbroc7AAzTmd0NX0Kpij7ZsSUEWJP2yRpw4uY
 YEIFLBbls0e/t2Iyfbk60haLwUESX0RnG+r4Zo4rs4EDlz477r
 0oRPXdOBgB++sSfcIOcHIy57T7+2ew3lusCElto9Ju5d5yLEpg
 5YSD3F5LKiR9F50JNpSaPXGqdTmdimSvSzraOvXbeH64dCScXU
 cvBocdReIKWdp5WfMsdw3irWLUI4l40E7fcQDxfjpiQiust2bA
 3hz/81qy6tzgCY+LHJ1of65FnVYyppRE0PIRfMbXVHFIy0fPO0
 bq6vd0TP4fshTlbvwlkOrtvAbviJMEFcd/drMqwKMVyKwSAcZl
 fQ/fYUoC5OqXc5DML3ss=
Cc: wg-camlp4@lists.ocaml.org, Anil Madhavapeddy <avsm2@cl.cam.ac.uk>
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 21:08:01 -0000

Am 28.01.2013 13:15:06 schrieb(en) Alain Frisch:
> On 01/24/2013 05:24 PM, Gerd Stolpmann wrote:
>> It's used in the tool, but only for stream parsing. I could also
>> distribute the already-preprocessed file (and maybe I'll do so in the
>> next release).
>>=20
>> Stream parsing is certainly one of the topics to discuss.
>=20
> I've no idea how widely stream parsing is used.  Has anyone some =20
> intuition about this?
>=20
> Stream parsers probably fall in the same category as bitstring or =20
> sedlex (custom notions of pattern matching).  It seems that stream =20
> parsers (which I'm not familiar with) require to be able to write =20
> expressions within "left-hand sides", which might require special =20
> support.  Or maybe the whole left-hand sides should just be =20
> quotations.
>=20
> Anyway, for a basic infrastructure tool such as ocamlfind, I'd =20
> probably advocate for a "manual" solution which works out of the box =20
> with a basic OCaml installation (ocamlyacc or manual top-down =20
> parser).  Gerd: does that sound reasonable to you?

Of course. META is easy enough to parse with any tool.

But I'd also like to fight for stream parsers a bit. In general, they =20
are a nice way to write top-down parsers. Like for all top-down =20
parsers, the class of acceptable grammars is not very powerful (less =20
than LALR(1)), but you can easily add things that are nearly impossible =20
with bottom-up parsers, like stores or contextuality, and you can =20
locally escape from the parsing discipline entirely. Sometimes it is a =20
perfect match.

 From an old OCaml manual:

expr ::=3D ...
         | [< >]
         | [< stream-component {; stream-component} >]
         | parser [pattern] stream-matching
         | match expr with parser [pattern] stream-matching

stream-component ::=3D =E2=80=99 expr
                    | expr
stream-matching ::=3D stream-pattern [pattern] -> expr
                     { | stream-pattern [pattern] -> expr}
stream-pattern ::=3D [< >]
                   | [< stream-pat-comp {; stream-pat-comp [?? expr]} >]
stream-pat-comp ::=3D =E2=80=99 pattern [when expr]
                   | pattern =3D expr
                   | ident

Doing this with -ppx is certainly a challenge.

Some ideas:

  - [< >]: Maybe we should simply add several types of brackets to
    the grammar. Syntax as for list, but reserved for extensions.

  - 'expr: This is like a tag. Maybe use I(expr) instead, where "I"
    means "item".

  - pattern =3D expr: I guess this is what Alain sees as difficulty.
    As quotation it would look strange. What we need here is something
    in the Parsetree that allows us to include expressions into patterns
    (which would look like a "computed pattern"). Maybe `(expr) inside
    patterns. Or another notation...

Gerd


>=20
>=20
> Alain
>=20
>=20


--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From info@gerd-stolpmann.de  Mon Jan 28 21:14:36 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A5C573C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 21:14:36 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.171 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.171]:65487)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1Tzw6S-00046u-mc (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Mon, 28 Jan 2013 21:18:57 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-211-172.pools.arcor-ip.net
 [94.219.211.172])
 by mrelayeu.kundenserver.de (node=mreu4) with ESMTP (Nemesis)
 id 0LaNTf-1UiZyS0xBP-00mJby; Mon, 28 Jan 2013 22:18:55 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id E1A8CC00CF;
 Mon, 28 Jan 2013 22:18:54 +0100 (CET)
Date: Mon, 28 Jan 2013 22:18:53 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Alain Frisch <alain@frisch.fr>
In-Reply-To: <5106E75F.10100@frisch.fr> (from alain@frisch.fr on Mon Jan 28
 22:02:23 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359407933.10634.9@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:/UsafFjBriKf7UCGQr2fcscmRRJEz57c9v56eT5P9SF
 59gPFXAu5iku43Guw0/XRkXnbz960/G6jA7PEi9XknXxp+dYdn
 T7YbIJTE0aBZLO5g7UYlc8hOAMWdQSLaQsmUdd0FHOpGhss6ZK
 6gzXhhdyPsAK7EvASzt8E8jKzsyTWySp8D7lP1o/JLb9GmTBcx
 +X+BVbjCu2oytonnEPKA/VG8L7Y5pPAIuIHz28W5wiBVywAjaw
 1n/tXXY3HUCjtAupl+GNQrprJnVes1L3vGsu3NUQuzkkenePqw
 lSUShMjU3yQkyzOSmTgFwb00EikBhdwhX7VQCR5V8Mvas50Ryf
 BcKvYdmTRWLJ9UJY419U=
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] PG'OCaml and syntax proliferation
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 21:14:36 -0000

Am 28.01.2013 22:02:23 schrieb(en) Alain Frisch:
> On 1/28/2013 9:21 PM, Gerd Stolpmann wrote:
>> The second point is not obligatory if you choose to implement the =20
>> first.
>> For example, an extension could register PGSQL as extension token.
>> Extension tokens would be handled as a separate type of token by the
>> parser.
>=20
> -ppx is about letting external processes rewrite already parsed ASTs. =20
> This does not sound compatible with this approach, unless I missed =20
> your point.

Right. Even a simple registration of a string is not possible - unless =20
you add another command-line switch, or, going further, have =20
configuration files.

Maybe something we should keep as an option. I fear that a completely =20
static syntax might be too tight.

Gerd


> Alain
>=20


--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From bobzhang1988@gmail.com  Mon Jan 28 21:19:00 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id CAB6E3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 21:19:00 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.179 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f179.google.com ([209.85.128.179]:59458)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TzwAi-0001c4-Qr (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 28 Jan 2013 21:23:21 +0000
Received: by mail-ve0-f179.google.com with SMTP id cz10so941914veb.38
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 13:23:19 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=3swoaJD/3zYSr/KlJc6RoMmQjfwWc2LG3V+mYFxYI5E=;
 b=qNyI+JU1URJqUjNM+QfhUaPitvAQ1eEvrVxwNF/3X/WBiVk2ba1fStGiJ+L8DCIIRP
 Nrc3EweAJuQ5eBBF7STQNf4yc4JCJDwO1N6fCnzQUp6jybqPI9inQAxOXlxHPBZ3/ThI
 hCFPQ8xUZJYR4spJNye/9vzkaMAX93ZfFMRV/RSev2SqzkLP3lNkNpqCUmkBwjxiEyjt
 8Ase453UUpQ1vDYKeYjYI//5WH1C98WWtEMSnPYRebKAWjcMwPVUVjdqY3zpJtBKjwWy
 EjaI+c9Y+/ynHjVCcKhixRNbH4DoQRTsWpYndGL2DC+XscTPRSMTvyJBIfdF0t12WUU9
 z6uA==
MIME-Version: 1.0
X-Received: by 10.220.150.83 with SMTP id x19mr16391085vcv.25.1359408199635;
 Mon, 28 Jan 2013 13:23:19 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 28 Jan 2013 13:23:19 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301282101120.21455@hermes-1.csi.cam.ac.uk>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
 <CANcqPu4AJztShx43vFEgd0KSEWofjKx+b6gcvxGXmL8o_3Aeew@mail.gmail.com>
 <Prayer.1.3.5.1301281631370.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4p03SE-11rcPpnFP7GcAp2PoPsz3-GQEsLp61ZC4GEpg@mail.gmail.com>
 <Prayer.1.3.5.1301281825400.19837@hermes-1.csi.cam.ac.uk>
 <CANcqPu42_eJhD-WkQBzAXq9xdTnp9u_tnxVopCUHnDZcmb9DyA@mail.gmail.com>
 <Prayer.1.3.5.1301282101120.21455@hermes-1.csi.cam.ac.uk>
Date: Mon, 28 Jan 2013 16:23:19 -0500
X-Google-Sender-Auth: UaLRbC17gTWH-zyEJTIaHXK92D4
Message-ID: <CANcqPu6nAf79hXpuDZpH6ePsbDh_zLm6dBmZ--BZuCAj5nS9Bg@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=f46d0434bf9cd8144304d45fe2a2
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 21:19:00 -0000

--f46d0434bf9cd8144304d45fe2a2
Content-Type: text/plain; charset=ISO-8859-1

After you doing all those stuff,  I am worried that you may find you just
re-implemented a new P4.

*I agree that the complexity of extensible parser should be removed,
 there's a compromise here.*

The ppx* shares the same Intermediate Ast*(It could be improved with more
meaningful tags names)  with camlp4 but uses the built in parser.

The benefit lies in two aspects:
    1. You get the automatically meta filter, quasi-quotation is for free
    2. The camlp4 can works well with ppx, the change is incremental, most
existing library still works under both cases

Introducing an Intermediate Ast also gives you some freedom, the parsetree
does a lot of syntax desguaring(to name a few, range patterns, bigarray,
string access, array access), you may change
the representation of parsetree, but that introduces complexity in other
cases, so my suggestion is that we can separate extensible parser part from
camlp4, that's absolutely doable, then we share the same intermediate Ast

On Mon, Jan 28, 2013 at 4:01 PM, Leo White <lpw25@cam.ac.uk> wrote:

> 3 parsers actually.
>> The original parser, the parser to patt, the parser to expr.
>>
>
> The original parser isn't necessary for the quotation, and of course the
> other two parsers are only both needed if you want the quotation to work as
> both a pattern and an expression.
>
> Anyway, my point is that you do not *need* to implement quotations by
> parsing to a value and then converting to an AST fragment, in fact it is
> often easier not to.
>
> That is not to say that some people might not want to implement their
> quotations by parsing to a value and then converting to an AST fragment. In
> fact, if they want to use an external parser (over which they have little
> control) to parse their quotations then they may have to do it that way.
>
> For these cases I think there are three options:
>
> 1. They can implement conversion functions by hand.
>
> 2. They could use some kind of type-conv style extension to automatically
> produce the conversion functions. I'm sure such an extension would be
> welcomed by other extension authors.
>
> 3. If/when some kind of run-time type representation is added to the
> language, it could be used to create a generic conversion function.
>
>


-- 
-- Regards, Hongbo

--f46d0434bf9cd8144304d45fe2a2
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div><br></div>After you doing all those stuff, =A0I am worried that you ma=
y find you just re-implemented a new P4.<div><br></div><div><b>I agree that=
 the complexity of extensible parser should be removed, =A0there&#39;s a co=
mpromise here.</b></div>
<div><br></div><div>The ppx<b> shares the same Intermediate Ast</b>(It coul=
d be improved with more meaningful tags names) =A0with camlp4 but uses the =
built in parser.</div><div><br></div><div>The benefit lies in two aspects:<=
/div>
<div>=A0 =A0 1. You get the automatically meta filter, quasi-quotation is f=
or free</div><div>=A0 =A0 2. The camlp4 can works well with ppx, the change=
 is incremental, most existing library still works under both cases=A0</div=
><div>
<br></div><div>Introducing an Intermediate Ast also gives you some freedom,=
 the parsetree does a lot of syntax desguaring(to name a few, range pattern=
s, bigarray, string access, array access), you may change<br>the representa=
tion of parsetree, but that introduces complexity in other cases, so my sug=
gestion is that we can separate extensible parser part from camlp4, that&#3=
9;s absolutely doable, then we share the same intermediate Ast</div>
<div><br><div class=3D"gmail_quote">On Mon, Jan 28, 2013 at 4:01 PM, Leo Wh=
ite <span dir=3D"ltr">&lt;<a href=3D"mailto:lpw25@cam.ac.uk" target=3D"_bla=
nk">lpw25@cam.ac.uk</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quo=
te" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"=
>
<div class=3D"im"><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .=
8ex;border-left:1px #ccc solid;padding-left:1ex">
3 parsers actually.<br>
The original parser, the parser to patt, the parser to expr.<br>
</blockquote>
<br></div>
The original parser isn&#39;t necessary for the quotation, and of course th=
e other two parsers are only both needed if you want the quotation to work =
as both a pattern and an expression.<br>
<br>
Anyway, my point is that you do not *need* to implement quotations by parsi=
ng to a value and then converting to an AST fragment, in fact it is often e=
asier not to.<br>
<br>
That is not to say that some people might not want to implement their quota=
tions by parsing to a value and then converting to an AST fragment. In fact=
, if they want to use an external parser (over which they have little contr=
ol) to parse their quotations then they may have to do it that way.<br>

<br>
For these cases I think there are three options:<br>
<br>
1. They can implement conversion functions by hand.<br>
<br>
2. They could use some kind of type-conv style extension to automatically p=
roduce the conversion functions. I&#39;m sure such an extension would be we=
lcomed by other extension authors.<br>
<br>
3. If/when some kind of run-time type representation is added to the langua=
ge, it could be used to create a generic conversion function.<br>
<br>
</blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regards, =
Hongbo
</div>

--f46d0434bf9cd8144304d45fe2a2--

From bobzhang1988@gmail.com  Mon Jan 28 21:25:46 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A67043C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 21:25:46 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.172 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f172.google.com ([209.85.128.172]:62462)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TzwHE-0003jY-Qy (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 28 Jan 2013 21:30:05 +0000
Received: by mail-ve0-f172.google.com with SMTP id 15so1671402vea.31
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 13:30:03 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=PNNfmobPt6u5Ke75JFoiVO+eKWaOA+CZ1S5FnuP0TxU=;
 b=zzRaMm0IT0juc+i9Poij0koiAbhgdw0DtTC1bZisCeoGBv2vLuqY4THAKrzJxkV1ZG
 /XnHv0LR5vmlpVXdG0UjuVtju38B+JRtLwyELgE+vT+Ery0udchpTE3i83t+OSr/eFQc
 F5/MvnQxCT0rqYneBt8vkZmwmD8txqJ6Abr/MyVGpy4oizOiYFj/BxyuXQyRN8K5ZWit
 YL3pZ+DmOAtUIeybGN4q1SRwyC3+UE/drzty0ShzaR5ahJTP9HqpfrI9LYkRdtnmJugn
 kOZ7JqjPo5apT/KmDMwj/AUXkhEBGF6qZ4G4UrjVaMlc1/0+4JwzAScgeoX8PjKv+U5a
 WELQ==
MIME-Version: 1.0
X-Received: by 10.220.153.143 with SMTP id k15mr12203037vcw.33.1359408603633; 
 Mon, 28 Jan 2013 13:30:03 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 28 Jan 2013 13:30:03 -0800 (PST)
In-Reply-To: <1359407533.10634.8@samsung>
References: <51066BCA.1020201@frisch.fr>
	<1359407533.10634.8@samsung>
Date: Mon, 28 Jan 2013 16:30:03 -0500
X-Google-Sender-Auth: 6fRrE612OjfWZrEbku_EdwS0-zM
Message-ID: <CANcqPu4MXqeyr3Usu1GL0Fmj6X1eUOjgozRoo4kLiwB-WtbAww@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Gerd Stolpmann <info@gerd-stolpmann.de>
Content-Type: multipart/alternative; boundary=f46d043d6771ec96ef04d45ffa87
Cc: wg-camlp4@lists.ocaml.org, Anil Madhavapeddy <avsm2@cl.cam.ac.uk>
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 21:25:46 -0000

--f46d043d6771ec96ef04d45ffa87
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

IIRC, the stream parser is in the old caml, but it is removed later since
Daniel write it in camlp4 with domain specific optimizations

On Mon, Jan 28, 2013 at 4:12 PM, Gerd Stolpmann <info@gerd-stolpmann.de>wro=
te:

> Am 28.01.2013 13:15:06 schrieb(en) Alain Frisch:
>
>  On 01/24/2013 05:24 PM, Gerd Stolpmann wrote:
>>
>>> It's used in the tool, but only for stream parsing. I could also
>>> distribute the already-preprocessed file (and maybe I'll do so in the
>>> next release).
>>>
>>> Stream parsing is certainly one of the topics to discuss.
>>>
>>
>> I've no idea how widely stream parsing is used.  Has anyone some
>> intuition about this?
>>
>> Stream parsers probably fall in the same category as bitstring or sedlex
>> (custom notions of pattern matching).  It seems that stream parsers (whi=
ch
>> I'm not familiar with) require to be able to write expressions within
>> "left-hand sides", which might require special support.  Or maybe the wh=
ole
>> left-hand sides should just be quotations.
>>
>> Anyway, for a basic infrastructure tool such as ocamlfind, I'd probably
>> advocate for a "manual" solution which works out of the box with a basic
>> OCaml installation (ocamlyacc or manual top-down parser).  Gerd: does th=
at
>> sound reasonable to you?
>>
>
> Of course. META is easy enough to parse with any tool.
>
> But I'd also like to fight for stream parsers a bit. In general, they are
> a nice way to write top-down parsers. Like for all top-down parsers, the
> class of acceptable grammars is not very powerful (less than LALR(1)), bu=
t
> you can easily add things that are nearly impossible with bottom-up
> parsers, like stores or contextuality, and you can locally escape from th=
e
> parsing discipline entirely. Sometimes it is a perfect match.
>
> From an old OCaml manual:
>
> expr ::=3D ...
>         | [< >]
>         | [< stream-component {; stream-component} >]
>         | parser [pattern] stream-matching
>         | match expr with parser [pattern] stream-matching
>
> stream-component ::=3D =92 expr
>                    | expr
> stream-matching ::=3D stream-pattern [pattern] -> expr
>                     { | stream-pattern [pattern] -> expr}
> stream-pattern ::=3D [< >]
>                   | [< stream-pat-comp {; stream-pat-comp [?? expr]} >]
> stream-pat-comp ::=3D =92 pattern [when expr]
>                   | pattern =3D expr
>                   | ident
>
> Doing this with -ppx is certainly a challenge.
>
> Some ideas:
>
>  - [< >]: Maybe we should simply add several types of brackets to
>    the grammar. Syntax as for list, but reserved for extensions.
>
>  - 'expr: This is like a tag. Maybe use I(expr) instead, where "I"
>    means "item".
>
>  - pattern =3D expr: I guess this is what Alain sees as difficulty.
>    As quotation it would look strange. What we need here is something
>    in the Parsetree that allows us to include expressions into patterns
>    (which would look like a "computed pattern"). Maybe `(expr) inside
>    patterns. Or another notation...
>
> Gerd
>
>
>
>>
>> Alain
>>
>>
>>
>
> --
> ------------------------------**------------------------------
> Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
> Creator of GODI and camlcity.org.
> Contact details:        http://www.camlcity.org/**contact.html<http://www=
.camlcity.org/contact.html>
> Company homepage:       http://www.gerd-stolpmann.de
> ------------------------------**------------------------------
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listin=
fo/wg-camlp4>
>



--=20
-- Regards, Hongbo

--f46d043d6771ec96ef04d45ffa87
Content-Type: text/html; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

IIRC, the stream parser is in the old caml, but it is removed later since D=
aniel write it in camlp4 with domain specific optimizations<br><br><div cla=
ss=3D"gmail_quote">On Mon, Jan 28, 2013 at 4:12 PM, Gerd Stolpmann <span di=
r=3D"ltr">&lt;<a href=3D"mailto:info@gerd-stolpmann.de" target=3D"_blank">i=
nfo@gerd-stolpmann.de</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">Am 28.01.2013 13:15:06 schrieb(en) Alain Fri=
sch:<div class=3D"im"><br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
On 01/24/2013 05:24 PM, Gerd Stolpmann wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
It&#39;s used in the tool, but only for stream parsing. I could also<br>
distribute the already-preprocessed file (and maybe I&#39;ll do so in the<b=
r>
next release).<br>
<br>
Stream parsing is certainly one of the topics to discuss.<br>
</blockquote>
<br>
I&#39;ve no idea how widely stream parsing is used. =A0Has anyone some intu=
ition about this?<br>
<br>
Stream parsers probably fall in the same category as bitstring or sedlex (c=
ustom notions of pattern matching). =A0It seems that stream parsers (which =
I&#39;m not familiar with) require to be able to write expressions within &=
quot;left-hand sides&quot;, which might require special support. =A0Or mayb=
e the whole left-hand sides should just be quotations.<br>

<br>
Anyway, for a basic infrastructure tool such as ocamlfind, I&#39;d probably=
 advocate for a &quot;manual&quot; solution which works out of the box with=
 a basic OCaml installation (ocamlyacc or manual top-down parser). =A0Gerd:=
 does that sound reasonable to you?<br>

</blockquote>
<br></div>
Of course. META is easy enough to parse with any tool.<br>
<br>
But I&#39;d also like to fight for stream parsers a bit. In general, they a=
re a nice way to write top-down parsers. Like for all top-down parsers, the=
 class of acceptable grammars is not very powerful (less than LALR(1)), but=
 you can easily add things that are nearly impossible with bottom-up parser=
s, like stores or contextuality, and you can locally escape from the parsin=
g discipline entirely. Sometimes it is a perfect match.<br>

<br>
>From an old OCaml manual:<br>
<br>
expr ::=3D ...<br>
=A0 =A0 =A0 =A0 | [&lt; &gt;]<br>
=A0 =A0 =A0 =A0 | [&lt; stream-component {; stream-component} &gt;]<br>
=A0 =A0 =A0 =A0 | parser [pattern] stream-matching<br>
=A0 =A0 =A0 =A0 | match expr with parser [pattern] stream-matching<br>
<br>
stream-component ::=3D =92 expr<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0| expr<br>
stream-matching ::=3D stream-pattern [pattern] -&gt; expr<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 { | stream-pattern [pattern] -&gt; =
expr}<br>
stream-pattern ::=3D [&lt; &gt;]<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 | [&lt; stream-pat-comp {; stream-pat-c=
omp [?? expr]} &gt;]<br>
stream-pat-comp ::=3D =92 pattern [when expr]<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 | pattern =3D expr<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 | ident<br>
<br>
Doing this with -ppx is certainly a challenge.<br>
<br>
Some ideas:<br>
<br>
=A0- [&lt; &gt;]: Maybe we should simply add several types of brackets to<b=
r>
=A0 =A0the grammar. Syntax as for list, but reserved for extensions.<br>
<br>
=A0- &#39;expr: This is like a tag. Maybe use I(expr) instead, where &quot;=
I&quot;<br>
=A0 =A0means &quot;item&quot;.<br>
<br>
=A0- pattern =3D expr: I guess this is what Alain sees as difficulty.<br>
=A0 =A0As quotation it would look strange. What we need here is something<b=
r>
=A0 =A0in the Parsetree that allows us to include expressions into patterns=
<br>
=A0 =A0(which would look like a &quot;computed pattern&quot;). Maybe `(expr=
) inside<br>
=A0 =A0patterns. Or another notation...<br>
<br>
Gerd<br>
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
<br>
<br>
Alain<br>
<br>
<br><span class=3D"HOEnZb"><font color=3D"#888888">
</font></span></blockquote><span class=3D"HOEnZb"><font color=3D"#888888">
<br>
<br>
-- <br>
------------------------------<u></u>------------------------------<br>
Gerd Stolpmann, Darmstadt, Germany =A0 =A0<a href=3D"mailto:gerd@gerd-stolp=
mann.de" target=3D"_blank">gerd@gerd-stolpmann.de</a><br>
Creator of GODI and <a href=3D"http://camlcity.org" target=3D"_blank">camlc=
ity.org</a>.<br>
Contact details: =A0 =A0 =A0 =A0<a href=3D"http://www.camlcity.org/contact.=
html" target=3D"_blank">http://www.camlcity.org/<u></u>contact.html</a><br>
Company homepage: =A0 =A0 =A0 <a href=3D"http://www.gerd-stolpmann.de" targ=
et=3D"_blank">http://www.gerd-stolpmann.de</a><br>
------------------------------<u></u>------------------------------</font><=
/span><div class=3D"HOEnZb"><div class=3D"h5"><br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo

--f46d043d6771ec96ef04d45ffa87--

From bobzhang1988@gmail.com  Mon Jan 28 21:37:07 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 2F5FC3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 21:37:07 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439040 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.51 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f51.google.com ([209.85.212.51]:41071)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1TzwSE-0004EJ-nl (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 28 Jan 2013 21:41:27 +0000
Received: by mail-vb0-f51.google.com with SMTP id fq11so2155885vbb.24
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 13:41:25 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=dScyZ731ZbH3kvEDA+2hE+0xbvhtbAAv6/59w75a5LE=;
 b=BPWIy+aA30fVENLsA79TIupsnj2gPTjHqGvJmVtKqcsN1A0vv3uCv1Hlzh55QgmZqL
 FjaNUoiBsbET5OkzU4gLv1BV1jNdNZaL380ScXvsKigTcZ4hvZu6CRnjLN5ZxOGBCafe
 ZSAXKPUMYJd7lYuzsQcr+Eb2xpDyCfFab8z0ZATY4sdxvo5iQLOrG+IjPgeRPxy7IW9m
 WKPyZyBc+Jx7m4OeJf4OcY7zHNmhtGLzCKRzLuccTNdMipdWUpTs2Cz0X8Pk9dBtpSGR
 0IerwTIgazqx1yBrX38xj3HIiCxcLo3o6JxutE6PoPWGVMPJrYELylmv7m0nyeHUlsS2
 2Apw==
MIME-Version: 1.0
X-Received: by 10.52.21.175 with SMTP id w15mr9014204vde.100.1359409285658;
 Mon, 28 Jan 2013 13:41:25 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 28 Jan 2013 13:41:25 -0800 (PST)
In-Reply-To: <5106BB76.6030804@frisch.fr>
References: <CAN8ZjBHgN0U0DxQQv7j86KtEYo+8aAM8x4H4S-vsCzmpJvPQ7g@mail.gmail.com>
 <CAJMfKEUTHbibNMbUEDFfR=BAUDP06c8GD2dDsQNos2RVHO8_KQ@mail.gmail.com>
 <CAN8ZjBEV57pAUD4Urfr19+NQK2yiuo2gVvV7Ef2bp4t2E7iDfA@mail.gmail.com>
 <5106BB76.6030804@frisch.fr>
Date: Mon, 28 Jan 2013 16:41:25 -0500
X-Google-Sender-Auth: 4-pcEkEbTQXpXeZ7y_LzmyarnqM
Message-ID: <CANcqPu6CDf6w8YUTPsMfJeQKmYwK-tE2djHPh-4Y5TBZWx9zqA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain@frisch.fr>
Content-Type: multipart/alternative; boundary=20cf307c9bba93794804d4602339
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 21:37:07 -0000

--20cf307c9bba93794804d4602339
Content-Type: text/plain; charset=ISO-8859-1

On Mon, Jan 28, 2013 at 12:55 PM, Alain Frisch <alain@frisch.fr> wrote:

> On 01/28/2013 06:13 PM, David Waern wrote:
>
>> OK. I've also wanted similar syntax, but I've noticed that if Alain's
>> "static exceptions" [1] proposal is accepted then encoding such things
>> using existing OCaml syntax becomes a bit lighter:
>>
>> try raise (`Cont expr) with
>> | `Cont n -> expr
>> | handlers
>>
>
> As a side note, this encoding with static exceptions is also much more
> efficient (no allocation required to escape from the exception handler).
>
> I second this suggestion , this is so useful that I can not live without it

> Still, this is a good example.  One might indeed want to use a dedicated
> syntax for this common idiom.  My preference would be for extending the
> official language to support it directly.  If one thinks it is generally
> useful, why not put it in the language itself?  It is not difficult to
> extend OCaml to support it directly.
>
> If the proposal is rejected but we have let-fix operators, one can decide
> to have a -ppx rewriter detecting and rewriting the following form:
>
> let? x = try e1 with p -> e2 in
> e3
>
>
> -- Alain
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>



-- 
-- Regards, Hongbo

--20cf307c9bba93794804d4602339
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Mon, Jan 28, 2013 at 12:55 PM, Alain =
Frisch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain@frisch.fr" target=3D"_=
blank">alain@frisch.fr</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_=
quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1=
ex">
<div class=3D"im">On 01/28/2013 06:13 PM, David Waern wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
OK. I&#39;ve also wanted similar syntax, but I&#39;ve noticed that if Alain=
&#39;s<br>
&quot;static exceptions&quot; [1] proposal is accepted then encoding such t=
hings<br>
using existing OCaml syntax becomes a bit lighter:<br>
<br>
try raise (`Cont expr) with<br>
| `Cont n -&gt; expr<br>
| handlers<br>
</blockquote>
<br></div>
As a side note, this encoding with static exceptions is also much more effi=
cient (no allocation required to escape from the exception handler).<br>
<br></blockquote><div>I second this suggestion , this is so useful that I c=
an not live without it</div><blockquote class=3D"gmail_quote" style=3D"marg=
in:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
Still, this is a good example. =A0One might indeed want to use a dedicated =
syntax for this common idiom. =A0My preference would be for extending the o=
fficial language to support it directly. =A0If one thinks it is generally u=
seful, why not put it in the language itself? =A0It is not difficult to ext=
end OCaml to support it directly.<br>

<br>
If the proposal is rejected but we have let-fix operators, one can decide t=
o have a -ppx rewriter detecting and rewriting the following form:<br>
<br>
let? x =3D try e1 with p -&gt; e2 in<br>
e3<span class=3D"HOEnZb"><font color=3D"#888888"><br>
<br>
<br>
-- Alain</font></span><div class=3D"HOEnZb"><div class=3D"h5"><br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo

--20cf307c9bba93794804d4602339--

From info@gerd-stolpmann.de  Mon Jan 28 21:51:32 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0625C3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 28 Jan 2013 21:51:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439040 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.171 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.171]:55243)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1TzwgB-0004q6-RM (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Mon, 28 Jan 2013 21:55:52 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-211-172.pools.arcor-ip.net
 [94.219.211.172])
 by mrelayeu.kundenserver.de (node=mreu2) with ESMTP (Nemesis)
 id 0LgL5M-1Ul3b71YDE-00nuNB; Mon, 28 Jan 2013 22:55:49 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id F2DC7C00CF;
 Mon, 28 Jan 2013 22:55:48 +0100 (CET)
Date: Mon, 28 Jan 2013 22:55:47 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Alain Frisch <alain@frisch.fr>
In-Reply-To: <5106694C.3020703@frisch.fr> (from alain@frisch.fr on Mon Jan
 28 13:04:28 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359410147.10634.10@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:6C0XRJBQflYYUuZwV0nZOxq8s4ogJi6Im7D6TJqS8gQ
 Nw9StOnEMbrFLuV6kimJ60ta59Iir7wVpNxKxhUwvlkX2pANJE
 3oF96CDQMD+M6LoySB+SYR0uoah/6j46AW7h4iMA9wOLqOlcfK
 rGZUe6OuSsYiIzgrWO7i/if35HpIKHFpLNBPNZVVi/ZY1mJXcK
 q2hPjN4GCkwBN7dx47BIOdpoPtcls0Fs+oB8OQjq+CZhy/p6/L
 Wt4uKlc8R1ANVzx1gwXHeyQ2sDKyh6Kk3yImBZTiBgZrl2d+xD
 GQE340WzQp8GJub8hnJRQUc0YYunnuqpiKcVp+MdWdwnm9s/Ec
 b+iU4LvTYdNrXknouWig=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 28 Jan 2013 21:51:32 -0000

Am 28.01.2013 13:04:28 schrieb(en) Alain Frisch:
> camlp4.macro:  does this refer to pa_macro?  It seems that this is =20
> more about conditional compilation than proper macro expansion.  I =20
> suspect that conditional compilation is used rarely enough in OCaml =20
> project, so that a slightly more verbose syntax would not a big =20
> deal.  Do you confirm?
>=20
> See =20
> http://www.lexifi.com/blog/syntax-extensions-without-camlp4-lets-do-it =20
> for a -ppx based version of conditional compilation.  The syntax is:
>=20
>   include IFDEF(SYMBOL)(struct
>      ... (* structure items in case SYMBOL is defined *)
>   end)(struct
>      ... (* structure items in case SYMBOL is not defined *)
>   end)

Conditional compilation is not always on the level of structures.

Here is a recent code snippet from me:

   let func =3D
     IFDEF SAFE THEN
       ctx.functions_7.(func_idx)
     ELSE
       Array.unsafe_get ctx.functions_7 func_idx
     ENDIF in

i.e. just a fine-grained version of -unsafe. Of course, I can use =20
(local) structures here as well, but the whole point is to speed the =20
code up once you are sure the code is SAFE.

Macros - in the general sense - would be better handled on the level of =20
tokens. That said, we could also do this by a normal -pp preprocessor =20
(these are run _before_ -ppx, right?).

Gerd
--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From alain@frisch.fr  Tue Jan 29 07:40:30 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BC6083C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 07:40:30 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:60971)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U05sA-0001gv-ST (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 29 Jan 2013 07:44:52 +0000
Received: from [192.168.0.10] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id AB8A2A60E8;
 Tue, 29 Jan 2013 08:44:45 +0100 (CET)
Message-ID: <51077DEC.5060109@frisch.fr>
Date: Tue, 29 Jan 2013 08:44:44 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gerd Stolpmann <info@gerd-stolpmann.de>
References: <1359407533.10634.8@samsung>
In-Reply-To: <1359407533.10634.8@samsung>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org, Anil Madhavapeddy <avsm2@cl.cam.ac.uk>
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 07:40:30 -0000

On 1/28/2013 10:12 PM, Gerd Stolpmann wrote:
> But I'd also like to fight for stream parsers a bit. In general, they
> are a nice way to write top-down parsers. Like for all top-down parsers=
,
> the class of acceptable grammars is not very powerful (less than
> LALR(1)), but you can easily add things that are nearly impossible with
> bottom-up parsers, like stores or contextuality, and you can locally
> escape from the parsing discipline entirely. Sometimes it is a perfect
> match.

In my experience with top-down parsers, a manually written recursive=20
descent with pattern matching on (normal) lists of tokens, plus a few=20
"combinators", works also fine.

>  From an old OCaml manual:
>
>...
 >
>
> stream-component ::=3D =E2=80=99 expr
>                     | expr
> stream-matching ::=3D stream-pattern [pattern] -> expr
>                      { | stream-pattern [pattern] -> expr}
> stream-pattern ::=3D [< >]
>                    | [< stream-pat-comp {; stream-pat-comp [?? expr]} >=
]
> stream-pat-comp ::=3D =E2=80=99 pattern [when expr]
>                    | pattern =3D expr
>                    | ident

Let me throw a crazy idea: maybe we could merge the grammar for patterns=20
and expressions, and let the type checker reject bad patterns and bad=20
expressions from this more admissible class.  This would give plenty of=20
space for extensions.

A quick inspection of Parsetree shows that the following syntactic forms=20
are available for patterns but not expressions:

  - Alias pattern:  p as x
  - "open record" flag: { l1=3Dp1; _ }
  - or pattern: p1 | p2
  - type pattern: #t
  - range patterns: c1..c2 (currently desugared by the Parser)

It seems possible to enrich the class of parsed expressions with those=20
cases without introducing conflicts (to be checked...).

Assuming it is indeed technically possible, do you think it would be a=20
good idea to merge the syntactic categories of patterns and expressions?


Alain


>
> Doing this with -ppx is certainly a challenge.
>
> Some ideas:
>
>   - [< >]: Maybe we should simply add several types of brackets to
>     the grammar. Syntax as for list, but reserved for extensions.
>
>   - 'expr: This is like a tag. Maybe use I(expr) instead, where "I"
>     means "item".
>
>   - pattern =3D expr: I guess this is what Alain sees as difficulty.
>     As quotation it would look strange. What we need here is something
>     in the Parsetree that allows us to include expressions into pattern=
s
>     (which would look like a "computed pattern"). Maybe `(expr) inside
>     patterns. Or another notation...
>
> Gerd
>
>
>>
>>
>> Alain
>>
>>
>
>


From alain@frisch.fr  Tue Jan 29 09:00:49 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A844C3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 09:00:49 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:42742
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U077u-00011J-so (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 29 Jan 2013 09:05:11 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d12 with ME
 id tl581k01Q3lHbAL03l59W2; Tue, 29 Jan 2013 10:05:09 +0100
Message-ID: <510790C5.8000705@frisch.fr>
Date: Tue, 29 Jan 2013 10:05:09 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <BD6BC2F330F5FB42AE6C31E84D7B76D7617B452F@ORSMSX101.amr.corp.intel.com>
 <5102DF28.90802@etorok.net> <5106694C.3020703@frisch.fr>
 <510677E4.2000500@etorok.net> <51068C4C.8090801@frisch.fr>
 <CANcqPu4nEpjESUyA8pqVkjpoTkk9sm8zx+R_+sqvQg1krTmwRQ@mail.gmail.com>
 <Prayer.1.3.5.1301281543180.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Dn=fMOx7WTeCxujbVeDdU0O6nVWrTy7eKxUQDk74zdA@mail.gmail.com>
 <CANcqPu4AJztShx43vFEgd0KSEWofjKx+b6gcvxGXmL8o_3Aeew@mail.gmail.com>
 <Prayer.1.3.5.1301281631370.32043@hermes-1.csi.cam.ac.uk>
 <CANcqPu4p03SE-11rcPpnFP7GcAp2PoPsz3-GQEsLp61ZC4GEpg@mail.gmail.com>
 <Prayer.1.3.5.1301281825400.19837@hermes-1.csi.cam.ac.uk>
 <CANcqPu42_eJhD-WkQBzAXq9xdTnp9u_tnxVopCUHnDZcmb9DyA@mail.gmail.com>
 <Prayer.1.3.5.1301282101120.21455@hermes-1.csi.cam.ac.uk>
 <CANcqPu6nAf79hXpuDZpH6ePsbDh_zLm6dBmZ--BZuCAj5nS9Bg@mail.gmail.com>
In-Reply-To: <CANcqPu6nAf79hXpuDZpH6ePsbDh_zLm6dBmZ--BZuCAj5nS9Bg@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 09:00:49 -0000

I've given it some thought, but I'm not convinced that it really make 
sense to introduce an extra intermediate representation of source code, 
between the parser and the input of the type-checker.  Let's look at 
where the Parsetree representation is actually used:

- Producers:

    the official parser
    ast_mapper and ppx rewriters
    camlp4
    untypeast

- Consumers:

    the type checker
    ast_mapper and ppx rewriters
    depend (could be rewritten to use ast_mapper)
    ocamlprof (could be rewritten to use ast_mapper)

(I've omitted more exotic consumers: pprintast, eqparsetree, addlabels)

The only important producer is the official parser and the only 
important consumer is the type checker, so I don't see clearly the 
benefits of introducing an extra representation in between.  The 
Parsetree could be improved, in particular to do less desugaring in the 
parser itself, but I don't see why we could not do it.  It would not 
increase the complexity of the type checker significantly.

Do you see "big" issues with the Parsetree, which could not be solved 
without the introduction of a different representation?

Alain



On 01/28/2013 10:23 PM, Hongbo Zhang wrote:
>
> After you doing all those stuff,  I am worried that you may find you
> just re-implemented a new P4.
>
> *I agree that the complexity of extensible parser should be removed,
>   there's a compromise here.*
>
> The ppx*shares the same Intermediate Ast*(It could be improved with more
> meaningful tags names)  with camlp4 but uses the built in parser.
>
> The benefit lies in two aspects:
>      1. You get the automatically meta filter, quasi-quotation is for free
>      2. The camlp4 can works well with ppx, the change is incremental,
> most existing library still works under both cases
>
> Introducing an Intermediate Ast also gives you some freedom, the
> parsetree does a lot of syntax desguaring(to name a few, range patterns,
> bigarray, string access, array access), you may change
> the representation of parsetree, but that introduces complexity in other
> cases, so my suggestion is that we can separate extensible parser part
> from camlp4, that's absolutely doable, then we share the same
> intermediate Ast
>
> On Mon, Jan 28, 2013 at 4:01 PM, Leo White <lpw25@cam.ac.uk
> <mailto:lpw25@cam.ac.uk>> wrote:
>
>         3 parsers actually.
>         The original parser, the parser to patt, the parser to expr.
>
>
>     The original parser isn't necessary for the quotation, and of course
>     the other two parsers are only both needed if you want the quotation
>     to work as both a pattern and an expression.
>
>     Anyway, my point is that you do not *need* to implement quotations
>     by parsing to a value and then converting to an AST fragment, in
>     fact it is often easier not to.
>
>     That is not to say that some people might not want to implement
>     their quotations by parsing to a value and then converting to an AST
>     fragment. In fact, if they want to use an external parser (over
>     which they have little control) to parse their quotations then they
>     may have to do it that way.
>
>     For these cases I think there are three options:
>
>     1. They can implement conversion functions by hand.
>
>     2. They could use some kind of type-conv style extension to
>     automatically produce the conversion functions. I'm sure such an
>     extension would be welcomed by other extension authors.
>
>     3. If/when some kind of run-time type representation is added to the
>     language, it could be used to create a generic conversion function.
>
>
>
>
> --
> -- Regards, Hongbo


From yallop@gmail.com  Tue Jan 29 09:01:08 2013
Return-Path: <yallop@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B7D223C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 09:01:08 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.171 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (yallop[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f171.google.com ([74.125.82.171]:59709)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U078E-00037R-QO (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yallop@gmail.com>); Tue, 29 Jan 2013 09:05:30 +0000
Received: by mail-we0-f171.google.com with SMTP id u54so136800wey.16
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 01:05:29 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=OEJxpLYdWZCoOH2uusr8Llt4ffEDGXV5c9+y7a5bGpg=;
 b=HPzLSL02BYwMF65J+fD5E9vosBXFR9iLd9XbEKf+FJEx4lXFxD+JD0Is9fmayJrN0C
 E6uBpZpZo4KXXufnk/tjnCGXK2v3E8Gv7DYJ3UqhS8gXa4YKlqE7wiZY70/t4P8iF1Sz
 rIYhcA9Yg8TIFSlaEqKbt38HKLhWYuOK32LnvMrd7AzlU9Bg5Um2t8xFuaEjdeJurQhV
 tSEXCYA2LQ8uFSKFdLLvBpCsMb94Eqw91YXldZIj1u2WtZ3MoW9NjDDY7/TPngp1Upip
 pcz1fh9vsOb+MOE6Yj1DZpZ+XLDSK5yX0OtTUcJh4ReGec/xMI3CebobAObTDwBOUNa0
 1c9g==
MIME-Version: 1.0
X-Received: by 10.180.80.170 with SMTP id s10mr966422wix.27.1359450329878;
 Tue, 29 Jan 2013 01:05:29 -0800 (PST)
Received: by 10.217.39.129 with HTTP; Tue, 29 Jan 2013 01:05:29 -0800 (PST)
In-Reply-To: <51077DEC.5060109@frisch.fr>
References: <1359407533.10634.8@samsung>
	<51077DEC.5060109@frisch.fr>
Date: Tue, 29 Jan 2013 09:05:29 +0000
Message-ID: <CAAxsn=FMoKcLqd6C=GEAQoxc+fMut7qMOCGQ4BzhLsKmdQKdfg@mail.gmail.com>
From: Jeremy Yallop <yallop@gmail.com>
To: Alain Frisch <alain@frisch.fr>
Content-Type: text/plain; charset=UTF-8
Cc: wg-camlp4@lists.ocaml.org, Anil Madhavapeddy <avsm2@cl.cam.ac.uk>
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 09:01:08 -0000

On 29 January 2013 07:44, Alain Frisch <alain@frisch.fr> wrote:
> Let me throw a crazy idea: maybe we could merge the grammar for patterns and
> expressions, and let the type checker reject bad patterns and bad
> expressions from this more admissible class.  This would give plenty of
> space for extensions.

Indeed, this opens up lots of possibilities.  For example, consider
the binding form introduced by omonad:

    perform (
       patt <-- expr1;
       expr2
   )

which is desugared to

   bind expr1 (function patt -> expr2
                      | _    -> fail "...")

At the moment the "new" syntax is handled by parsing 'patt' as an
expression and then translating it to a pattern in the AST
transformer:

    https://github.com/danmey/omonad/blob/master/src/ppx_monad.ml#L115-L134

This works pretty well, except for the few pattern forms that don't
look like expressions.  If patterns were parsed as expresssions then
there wouldn't be any such gaps, and the introduction of the new
binding form would be more convincing.

Other campl4 extensions such as Richard Jones' bitstring (Erlang-style
matching over bits) and Martin Jambon's micmatch (pattern matching for
regular expressions) could also be implemented as AST transformers if
the grammars were merged.

> Assuming it is indeed technically possible, do you think it would be a good
> idea to merge the syntactic categories of patterns and expressions?

I think it would be a good idea.  It'd also eliminate a few dozen
productions from the grammar, which is probably no bad thing.

From puyo@doomeer.com  Tue Jan 29 09:29:14 2013
Return-Path: <puyo@doomeer.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D41833C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 09:29:14 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [87.98.179.142 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from 17.mo1.mail-out.ovh.net ([87.98.179.142]:34710
 helo=mo1.mail-out.ovh.net)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U07ZL-0004jp-mR (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <puyo@doomeer.com>); Tue, 29 Jan 2013 09:33:36 +0000
Received: from mail26.ha.ovh.net (b9.ovh.net [213.186.33.59])
 by mo1.mail-out.ovh.net (Postfix) with SMTP id 43073FFAA30
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 10:47:49 +0100 (CET)
Received: from b0.ovh.net (HELO queueout) (213.186.33.50)
 by b0.ovh.net with SMTP; 29 Jan 2013 11:33:09 +0200
Received: from dhcp-rocq-57.inria.fr (HELO ?128.93.62.57?)
 (romain%bardou.fr@128.93.62.57)
 by ns0.ovh.net with SMTP; 29 Jan 2013 11:33:08 +0200
Message-ID: <51079753.5090908@doomeer.com>
Date: Tue, 29 Jan 2013 10:33:07 +0100
From: DooMeeR <puyo@doomeer.com>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.11) Gecko/20121122 Icedove/10.0.11
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
X-Ovh-Mailout: 178.32.228.1 (mo1.mail-out.ovh.net)
References: <1359407533.10634.8@samsung> <51077DEC.5060109@frisch.fr>
In-Reply-To: <51077DEC.5060109@frisch.fr>
Content-Type: text/plain; charset=UTF-8; format=flowed
X-Ovh-Tracer-Id: 10904340598758524268
X-Ovh-Remote: 128.93.62.57 (dhcp-rocq-57.inria.fr)
X-Ovh-Local: 213.186.33.20 (ns0.ovh.net)
X-OVH-SPAMSTATE: OK
X-OVH-SPAMSCORE: 0
X-OVH-SPAMCAUSE: gggruggvucftvghtrhhoucdtuddrfeehledrkeeiucetufdoteggodetrfcurfhrohhfihhlvgemucfqggfjnecuuegrihhlohhuthemuceftddtnecu
X-Spam-Check: DONE|U 0.500211/N
X-VR-SPAMSTATE: OK
X-VR-SPAMSCORE: 0
X-VR-SPAMCAUSE: gggruggvucftvghtrhhoucdtuddrfeehledrkeeiucetufdoteggodetrfcurfhrohhfihhlvgemucfqggfjnecuuegrihhlohhuthemuceftddtnecu
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 09:29:14 -0000

> Assuming it is indeed technically possible, do you think it would be a
> good idea to merge the syntactic categories of patterns and expressions=
?

Not only would it be useful for -ppx, it would probably help to produce=20
better error messages as well. A message like "you cannot use { f =3D =E2=
=80=A6; _=20
} in expressions, this is only for patterns" is a bit better than "parse=20
error"=E2=80=A6

Not that we cannot do that already with additional rules in the parser,=20
but after a merge, the type-checker would kind of be forced to handle=20
these cases. (Unless it uses a catch-all.)

Cheers,

--=20
Romain Bardou

From fabrissimo@gmail.com  Tue Jan 29 10:15:33 2013
Return-Path: <fabrissimo@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 88D293C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 10:15:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.50 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (fabrissimo[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f50.google.com ([209.85.214.50]:50841)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U08IE-00030p-S8 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <fabrissimo@gmail.com>); Tue, 29 Jan 2013 10:19:55 +0000
Received: by mail-bk0-f50.google.com with SMTP id jg9so144064bkc.37
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 02:19:54 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:message-id:date:from:user-agent:mime-version:to
 :cc:subject:references:in-reply-to:content-type;
 bh=C+yMOtmKRxW0HtC/vyBDkdyba/RLry6Uy5HNG/iMHmk=;
 b=wcYOXAYxk6mCMUGg4LNvXZKqNf1JBlnP6JQwS7SrWwM0SzSToIlW3JvskV+gOY3FYM
 mNAwnYK1F/+ieZSjqJdxUXCQhuJMRYlQ/3Jxfv3PznPi5xGL7yIXvp8Xj5rttyxu9u11
 I6uICmH7OGn0shxaVeuxscP8MiL6C571xRBth51D2R/vvyrmA39WnqDH7PqMBF6O6dzk
 +o3p/CG1WznBdNnQ+JxYTEiYZS1OS/9f1k7j6hZ7TYf7Yx7tcTydxvhk4LL7KiBeS8C+
 rrcODHTxJzqJGZ9Lls3pNN2WjZTeYWEGHZo81aQdYjOT/enGeGzHTOSI+82dln6RfEuz
 Gl9w==
X-Received: by 10.204.147.81 with SMTP id k17mr169901bkv.70.1359454794390;
 Tue, 29 Jan 2013 02:19:54 -0800 (PST)
Received: from ?IPv6:2001:660:3013:3:3ce5:7e24:3bb3:dcfe?
 ([2001:660:3013:3:3ce5:7e24:3bb3:dcfe])
 by mx.google.com with ESMTPS id v8sm8427561bku.6.2013.01.29.02.19.53
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Tue, 29 Jan 2013 02:19:53 -0800 (PST)
Sender: Fabrice Le Fessant <fabrissimo@gmail.com>
Message-ID: <5107A248.8050809@inria.fr>
Date: Tue, 29 Jan 2013 11:19:52 +0100
From: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:17.0) Gecko/20130106 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gerd Stolpmann <info@gerd-stolpmann.de>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung>
In-Reply-To: <1359404907.10634.7@samsung>
Content-Type: multipart/mixed; boundary="------------050902040603080204020106"
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 10:15:33 -0000

This is a multi-part message in MIME format.
--------------050902040603080204020106
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

On 01/28/2013 09:28 PM, Gerd Stolpmann wrote:
> Typographically, $ is a mistake.

Of course, such a convention can provide different sets of delimiters, 
which use would depend on the delimiters used to introduce them.

For example, <$ ... $> would make $ the delimiter, while <? ... ?> would 
make ? the delimiter (just an idea).

> I second Leo's idea to leave it to the preprocessor.

I would strongly argue for a convention that has to be obeyed by all 
preprocessors. If you leave it to the preprocessor, you will have to 
call the preprocessor during the parsing, not during the typing, i.e. 
you won't have access to the typing environment while expanding macros. 
Consequently, your objectives were to be strictly more powerful, but 
your system would actually be strictly less powerful.

--Fabrice

--------------050902040603080204020106
Content-Type: text/x-vcard; charset=utf-8;
 name="fabrice_le_fessant.vcf"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment;
 filename="fabrice_le_fessant.vcf"

begin:vcard
fn:Fabrice LE FESSANT
n:LE FESSANT;Fabrice
org:INRIA Saclay -- Ile-de-France;P2P & OCaml
adr;quoted-printable:;;Parc Orsay Universit=C3=A9 ;Orsay CEDEX;;91893;France
email;internet:fabrice.le_fessant@inria.fr
title;quoted-printable:Charg=C3=A9 de Recherche
tel;work:+33 1 74 85 42 14
tel;fax:+33 1 74 85 42 49 
url:http://fabrice.lefessant.net/
version:2.1
end:vcard


--------------050902040603080204020106--

From alain@frisch.fr  Tue Jan 29 10:40:56 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 295B73C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 10:40:56 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:44814
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U08gn-0006k7-Rl (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 29 Jan 2013 10:45:18 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tmlG1k00k3lHbAL03mlGZf; Tue, 29 Jan 2013 11:45:17 +0100
Message-ID: <5107A83D.2060809@frisch.fr>
Date: Tue, 29 Jan 2013 11:45:17 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
In-Reply-To: <5107A248.8050809@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 10:40:56 -0000

On 01/29/2013 11:19 AM, Fabrice Le Fessant wrote:
> I would strongly argue for a convention that has to be obeyed by all
> preprocessors. If you leave it to the preprocessor, you will have to
> call the preprocessor during the parsing, not during the typing, i.e.
> you won't have access to the typing environment while expanding macros.

If we extend the grammar with quotations, they can be rewritten by -ppx 
filters.  This is useful, and not incompatible with OCaml Templates 
(which can interpret remaining quotations, not rewritten by -ppx).  Many 
current uses of quotations really don't need access to typing 
information, and there are advantages in doing the expansion during 
parsing, not type-checking:

  - ocamldep can run the -ppx filters in order to get a precise idea of 
dependencies, after expansion has occurred.

  - OCaml Templates requires to load expanders in the same process as 
the type-checker, but this would force to use Dynlink in the compiler 
(or re-link statically you compilers with your expanders).  Dynlink in 
native code is not available on all platform.

  - An expansion done by a -ppx rewriter can benefit from other 
rewriters applied afterwards.  It is not clear if we should apply the 
-ppx rewriters to each fragment produced by OCaml Templates.


I'm not arguing against OCaml Templates, which has very interesting 
usage scenarios, but it should be thought as an addition to expanders 
implemented with -ppx, for those cases where type information is 
actually required and the downsides mentioned above are not problematic. 
  Of course, we should share the same quotation syntax.


Alain

From lpw25@hermes.cam.ac.uk  Tue Jan 29 10:42:33 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id CA66A3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 10:42:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:48043)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U08iN-0005no-qt (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 10:46:55 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U08iN-0006oE-Ax (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 10:46:55 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 29 Jan 2013 10:46:55 +0000
Date: 29 Jan 2013 10:46:55 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
Message-ID: <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5107A248.8050809@inria.fr>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 10:42:33 -0000

>> I second Leo's idea to leave it to the preprocessor.
>
>I would strongly argue for a convention that has to be obeyed by all 
>preprocessors. If you leave it to the preprocessor, you will have to 
>call the preprocessor during the parsing, not during the typing, i.e. 
>you won't have access to the typing environment while expanding macros. 
>Consequently, your objectives were to be strictly more powerful, but 
>your system would actually be strictly less powerful.

There is no reson that you cannot expand the preprocessor during typing. As 
I said in a previous post, all we need to provide is a function that will 
parse an expression upto the next unnested occurence of "$" or whatever the 
preprocessor is using to mark the end of its antiquotations. Preprocessors 
can then simply use this facility to handle their antiquotations 
themselves.


From gabriel.scherer@gmail.com  Tue Jan 29 10:49:15 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B7D1F3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 10:49:15 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.50 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f50.google.com ([209.85.214.50]:56399)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U08oq-0002QV-Rl (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Tue, 29 Jan 2013 10:53:38 +0000
Received: by mail-bk0-f50.google.com with SMTP id jg9so163387bkc.9
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 02:53:36 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:from:date:message-id:subject:to
 :content-type; bh=Nc9WLI8vC6pGvLtJPQJD7J9IZ/jwoYv8nyQ/lJrWIc8=;
 b=RoNoVsPDZ55CYiCRPeYcEoQvXcpuu072MhODyME4EjSUEIR5wzkyFCbzbt3Q7rsYvy
 4PfFU3fFUGFuPnTwa20DDfuebYDvBTo67rQ+P9TDZJd1ZE9CVWx9BFd3b7bOJr0sDeUi
 B3Qm/PlGrkybLzKsyaC+fZWaZ5RzbpW1oUzJF+BBf5gpVFCYnm2KyfpATIuHp48PUDM3
 axHFz95/o1/PS7FCrj7cxeQBYsHoIPlcG/APuvTb9u9x1JunEdQJCNfgTVQE4+yYz/ER
 /vwT9yKgOBblfVPG+EI1QFPk8ANZ3fo/dbvMyoMD6kE8iNR3GzfysjIpFaeAneWlwAD3
 RHbA==
X-Received: by 10.204.147.147 with SMTP id l19mr190679bkv.91.1359456816226;
 Tue, 29 Jan 2013 02:53:36 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.236.134 with HTTP; Tue, 29 Jan 2013 02:52:56 -0800 (PST)
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Tue, 29 Jan 2013 11:52:56 +0100
Message-ID: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: text/plain; charset=ISO-8859-1
Subject: [wg-camlp4] Against the use of syntactically-valid OCaml code for
 syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 10:49:15 -0000

Dear wg-camlp4 list,

I have been reading the list discussion and find it very interesting
so far. One point that I am worried about is the seemingly consensual
idea that the way to integrate syntax extensions in a post-camlp4
world is to massage them into syntactically correct OCaml code, to be
parsed by the existing parser and later processed by a -ppx filter.

I think this is a terrible idea. Code with a special semantics should
have a special syntax. Otherwise, how is the user supposed to guess
which syntactically correct code follows the expected OCaml semantics,
and which is in fact to be understood in the context of a specific
syntax extension?

Camlp4 quotations are a generic way to embed foreign pieces of syntax
into an OCaml parstree in a safe, explicit, modular and composable
way. I understand that it is annoying to be forced to "quote" code
that is "mostly valid OCaml code" (eg. encoding type-conv with
continuations would give something as <:type-conv< type foo = ... with
... >>, while we would like to preserve the type declaration and
localize the extension to the "with" part). Sometimes, a full
quotation syntax is also too heavy to make sense in the precise
context (eg. regexp patterns in ulex/xstr/whatever). I think we should
cluster the existing perversions into a small amount of cases that we
add to the existing OCaml syntax (eg. overloadable string literals for
unicode support, xstr and PG'OCaml), as a *different* syntax from what
is currently accepted and well-defined.

(When I say "syntactically valid" this is to be taken relatively to
the future OCaml language: I would be ok with forbidding some
currently accepted corner cases to reuse them for extension purposes.)

This coincides with Fabrice's opinion to agree on a common syntax for
quotations/extensions among extensions. Discipline and robustness at
the cost of generality, that is (imho) the meaningful direction an
out-of-camlp4 work should take. I understand the temptation to express
arbitrary things in the limited (but already useful) -ppx framework as
it stands now, but I think we should resist it.

So that would be my answer: *reject* reuse of syntactically valid code
for extension purposes, and isolate a *few* common cases of extensions
that deserve new extension points to be added to the standard parser
(arbitrary quotations being the maximally expressive, but also
heaviest, tool in this framework, into which all non-otherwise-handled
extension needs would fallback). The question of tool support (Tuareg
indentation, etc.) is solved by updating tools to support those few
extension points, no masquerade new semantics under old syntax.

What do you think of embeddings of syntax extension into syntactically
valid syntax ?

On Mon, Jan 28, 2013 at 4:10 PM, Dario Teixeira <darioteixeira@yahoo.com> wrote:
> Hi,
>
>
> Another syntax extension to consider is PG'OCaml's.  Though it seems like
> it can easily be adapted to the ppx system, it does raise an issue which I
> think ought to be discussed.
>
> Here's how code making use of embedded SQL in PG'OCaml currently looks like:
> (the dbh parameter is the database handle)
>
>   let fetch_users dbh =
>         PGSQL(dbh) "select id, name from users"
>
> This is syntactally incorrect, of course.  Therefore, any adaptation to the
> ppx system will necessarily be backwards-incompatible with existing code
> (not a big problem for me personally, but others may disagree).  As for
> the new syntax, several possibilities exist.  A straightforward one would
> be to lowercase the "PGSQL" token; embedded SQL statements would thus take
> the form of fake function calls:
>
>   let fetch_users dbh =
>         pgsql(dbh) "select id, name from users"
>
> Another possiblity would be for the SQL statements to be arguments to a fake
> variant type constructor:
>
>   let fetch_users dbh =
>         PGSQL (dbh, "select id, name from users")
>
> I could go on.  Anyway, regardless of choice, one issue comes to mind.
> Presently, code using the PG'OCaml syntax extension is conspicuous by its
> syntactic incorrectness.  Therefore, someone unfamiliar with PG'OCaml who
> happened to be looking at code using the syntax extension would immediately
> suspect something camlp4ish was going on.  With ppx, this signaling would
> go away.  This could make code harder to read if several syntax extensions
> are simultaneously used, particularly if syntax extensions become more
> popular because ppx makes it so much easier to write them.
>
> One solution is for the community to adopt conventions that make syntax
> extensions stand out to the naked eye (syntax highlighters in Vim or Emacs
> could also take advantage of these conventions).  For example: the fake variant
> constructor could be instead a fake PV constructor ending in "'" (prime).
> It should not be hard for editors to highlight this code in a special way:
>
>   let fetch_users dbh =
>         `PGSQL' (dbh, "select id, name from users")
>
> What do you think?
>
> Best regards,
> Dario Teixeira
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From lpw25@hermes.cam.ac.uk  Tue Jan 29 11:11:12 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1340E3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 11:11:12 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:55995)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U09A6-0002nJ-qN (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 11:15:34 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U09A6-0002cg-6k (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 11:15:34 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 29 Jan 2013 11:15:34 +0000
Date: 29 Jan 2013 11:15:34 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Message-ID: <Prayer.1.3.5.1301291115340.19279@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 11:11:12 -0000

I would just like to say that I mostly agree with Gabriel. Where possible I 
think we should try to choose syntaxes that are obviously syntax 
extensions.

For example, I don't think that:

let rec expr =
  <:parser <
      If; x = expr; Then; y = expr; Else; z = expr -> "if"
    | Let; Ident x; Equal; x = expr; In; y = expr -> "let" >>

is really worse than

let rec expr =
  parser
    [< 'If; x = expr; 'Then; y = expr; 'Else; z = expr >] -> "if"
  | [< 'Let; 'Ident x; 'Equal; x = expr; 'In; y = expr >] -> "let"

and it makes it very clear that it is using an extension.

In some cases it seems sensible to use an obviously wrong syntax (e.g. 
!"asdf"), but in general I think we should try to use new syntax for 
extensions.

In particular I think that the following forms can cover many cases:

* Camlp4-style quotations: <:foo < arg >> 

* Some kind of quotation that looks like a type constructor and is quietly 
  ignored by the main compiler. I personally like the syntax "%foo" and 
  "%bar(arg)".

* Type-conv style annotations: type t = int with foo, bar(arg) 

* Allowing let and maybe some other keywords to be suffixed by some symbols 
  (e.g. let*)

* Allowing top-level style directives in ml files (e.g. "#ifdef ;;").


From info@gerd-stolpmann.de  Tue Jan 29 11:23:02 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 02E5C3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 11:23:02 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.17.9 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.17.9]:49192)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U09LX-0002aG-nd (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Tue, 29 Jan 2013 11:27:24 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-218-231.pools.arcor-ip.net
 [94.219.218.231])
 by mrelayeu.kundenserver.de (node=mrbap3) with ESMTP (Nemesis)
 id 0MK1VF-1TymR53hxd-001P7j; Tue, 29 Jan 2013 12:27:23 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 877B1C00D0;
 Tue, 29 Jan 2013 12:27:22 +0100 (CET)
Date: Tue, 29 Jan 2013 12:27:21 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
In-Reply-To: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 (from gabriel.scherer@gmail.com on Tue Jan 29 11:52:56 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359458841.10634.11@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:u6DbS0qmH6vqR2mVJtq6Ln/iL2q3Yp/bG8wH4kNrA2k
 FD02YEZrxYWmkDHjDxBaSP7LjrA1LBo3e8xwqT2y9rXeHTXs+N
 B1dAro9J9LT7Tt+nI9IeTt+pN+B1+mekhtqLX262qSiTYWsS2T
 LhxXY1Nam8yq8Oce++QFIuAS+1pQqALmdHpMDrr2Y30lfQXwfg
 DfluqxXzb/3xfF1F3B+Z4dbu/+Heka/OjP7OVoz1jhQrlKcFlJ
 9ygZVu+hG1MaBL43YnidHvG/B0UtTyd8gNGkom3oYMr9RvfE/X
 jHS1qT3JIL9eSFo2nsdNDsZali8228KLL4gwbTjb4tEUxxBmSb
 CtQphgaC9HU2XLmg/rlSG+1um5USVN7q+xpKJt3XD
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 11:23:02 -0000

So that would go into the direction of marking _all_ extensions, even =20
those that reuse the OCaml syntax. That would pick up the idea of =20
having special tokens to initiate extension phrases, e.g. (just picking =20
a notation)

<PGSQL> pat-or-expr

This would definitely make life easier in the tool universe. Basically, =20
this means we'd have only a few ways of extension:

  - a lightweight one starting with an extension token, and always
    reusing existing syntax (for various points in the syntax)
  - a heavyweight one: quotations

I have the feeling that we could focus in this direction, but it is too =20
early to say whether it is sufficient. Anyway, I don't see how we can =20
forbid to transform any OCaml syntax with the ppx mechanism. Once the =20
Parsetree is accessible, it is accessible for everything. So, it would =20
be convention only to stay away from inline (unmarked) extensions.

Gerd

Am 29.01.2013 11:52:56 schrieb(en) Gabriel Scherer:
> Dear wg-camlp4 list,
>=20
> I have been reading the list discussion and find it very interesting
> so far. One point that I am worried about is the seemingly consensual
> idea that the way to integrate syntax extensions in a post-camlp4
> world is to massage them into syntactically correct OCaml code, to be
> parsed by the existing parser and later processed by a -ppx filter.
>=20
> I think this is a terrible idea. Code with a special semantics should
> have a special syntax. Otherwise, how is the user supposed to guess
> which syntactically correct code follows the expected OCaml semantics,
> and which is in fact to be understood in the context of a specific
> syntax extension?
>=20
> Camlp4 quotations are a generic way to embed foreign pieces of syntax
> into an OCaml parstree in a safe, explicit, modular and composable
> way. I understand that it is annoying to be forced to "quote" code
> that is "mostly valid OCaml code" (eg. encoding type-conv with
> continuations would give something as <:type-conv< type foo =3D ... with
> ... >>, while we would like to preserve the type declaration and
> localize the extension to the "with" part). Sometimes, a full
> quotation syntax is also too heavy to make sense in the precise
> context (eg. regexp patterns in ulex/xstr/whatever). I think we should
> cluster the existing perversions into a small amount of cases that we
> add to the existing OCaml syntax (eg. overloadable string literals for
> unicode support, xstr and PG'OCaml), as a *different* syntax from what
> is currently accepted and well-defined.
>=20
> (When I say "syntactically valid" this is to be taken relatively to
> the future OCaml language: I would be ok with forbidding some
> currently accepted corner cases to reuse them for extension purposes.)
>=20
> This coincides with Fabrice's opinion to agree on a common syntax for
> quotations/extensions among extensions. Discipline and robustness at
> the cost of generality, that is (imho) the meaningful direction an
> out-of-camlp4 work should take. I understand the temptation to express
> arbitrary things in the limited (but already useful) -ppx framework as
> it stands now, but I think we should resist it.
>=20
> So that would be my answer: *reject* reuse of syntactically valid code
> for extension purposes, and isolate a *few* common cases of extensions
> that deserve new extension points to be added to the standard parser
> (arbitrary quotations being the maximally expressive, but also
> heaviest, tool in this framework, into which all non-otherwise-handled
> extension needs would fallback). The question of tool support (Tuareg
> indentation, etc.) is solved by updating tools to support those few
> extension points, no masquerade new semantics under old syntax.
>=20
> What do you think of embeddings of syntax extension into syntactically
> valid syntax ?
>=20
> On Mon, Jan 28, 2013 at 4:10 PM, Dario Teixeira =20
> <darioteixeira@yahoo.com> wrote:
> > Hi,
> >
> >
> > Another syntax extension to consider is PG'OCaml's.  Though it =20
> seems like
> > it can easily be adapted to the ppx system, it does raise an issue =20
> which I
> > think ought to be discussed.
> >
> > Here's how code making use of embedded SQL in PG'OCaml currently =20
> looks like:
> > (the dbh parameter is the database handle)
> >
> >   let fetch_users dbh =3D
> >         PGSQL(dbh) "select id, name from users"
> >
> > This is syntactally incorrect, of course.  Therefore, any =20
> adaptation to the
> > ppx system will necessarily be backwards-incompatible with existing =20
> code
> > (not a big problem for me personally, but others may disagree).  As =20
> for
> > the new syntax, several possibilities exist.  A straightforward one =20
> would
> > be to lowercase the "PGSQL" token; embedded SQL statements would =20
> thus take
> > the form of fake function calls:
> >
> >   let fetch_users dbh =3D
> >         pgsql(dbh) "select id, name from users"
> >
> > Another possiblity would be for the SQL statements to be arguments =20
> to a fake
> > variant type constructor:
> >
> >   let fetch_users dbh =3D
> >         PGSQL (dbh, "select id, name from users")
> >
> > I could go on.  Anyway, regardless of choice, one issue comes to =20
> mind.
> > Presently, code using the PG'OCaml syntax extension is conspicuous =20
> by its
> > syntactic incorrectness.  Therefore, someone unfamiliar with =20
> PG'OCaml who
> > happened to be looking at code using the syntax extension would =20
> immediately
> > suspect something camlp4ish was going on.  With ppx, this signaling =20
> would
> > go away.  This could make code harder to read if several syntax =20
> extensions
> > are simultaneously used, particularly if syntax extensions become =20
> more
> > popular because ppx makes it so much easier to write them.
> >
> > One solution is for the community to adopt conventions that make =20
> syntax
> > extensions stand out to the naked eye (syntax highlighters in Vim =20
> or Emacs
> > could also take advantage of these conventions).  For example: the =20
> fake variant
> > constructor could be instead a fake PV constructor ending in "'" =20
> (prime).
> > It should not be hard for editors to highlight this code in a =20
> special way:
> >
> >   let fetch_users dbh =3D
> >         `PGSQL' (dbh, "select id, name from users")
> >
> > What do you think?
> >
> > Best regards,
> > Dario Teixeira
> >
> > _______________________________________________
> > wg-camlp4 mailing list
> > wg-camlp4@lists.ocaml.org
> > http://lists.ocaml.org/listinfo/wg-camlp4
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
>=20



--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From alain@frisch.fr  Tue Jan 29 11:33:11 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 199293C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 11:33:11 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:56873
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U09VM-00060o-sp (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 29 Jan 2013 11:37:33 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tndX1k00m3lHbAL03ndYh4; Tue, 29 Jan 2013 12:37:32 +0100
Message-ID: <5107B47D.5080300@frisch.fr>
Date: Tue, 29 Jan 2013 12:37:33 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gerd Stolpmann <info@gerd-stolpmann.de>
References: <1359410147.10634.10@samsung>
In-Reply-To: <1359410147.10634.10@samsung>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 11:33:11 -0000

On 01/28/2013 10:55 PM, Gerd Stolpmann wrote:
> Here is a recent code snippet from me:
>
>    let func =
>      IFDEF SAFE THEN
>        ctx.functions_7.(func_idx)
>      ELSE
>        Array.unsafe_get ctx.functions_7 func_idx
>      ENDIF in
>
> i.e. just a fine-grained version of -unsafe. Of course, I can use
> (local) structures here as well, but the whole point is to speed the
> code up once you are sure the code is SAFE.

Yes, we can come up with a syntax for conditional compilation an 
expressions as well.  For instance:

   if DEF(SYMBOL) then e1 else e2

> Macros - in the general sense - would be better handled on the level of
> tokens. That said, we could also do this by a normal -pp preprocessor
> (these are run _before_ -ppx, right?).

Yes, but be careful that -pp preprocessors cannot be chained (they map 
concrete syntax to abstract one).

-- Alain


From alain@frisch.fr  Tue Jan 29 12:17:27 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7D4A33C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 12:17:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:26580
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0ACD-0003Mr-rD (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 29 Jan 2013 12:21:49 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id toMo1k01D3lHbAL03oMpiM; Tue, 29 Jan 2013 13:21:49 +0100
Message-ID: <5107BEDF.6040907@frisch.fr>
Date: Tue, 29 Jan 2013 13:21:51 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
In-Reply-To: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 12:17:27 -0000

On 01/29/2013 11:52 AM, Gabriel Scherer wrote:
> Code with a special semantics should
> have a special syntax.

I agree, for most cases, although I don't think this should be a hard 
constraint.  Generic extension points are parts of the plan!

It is a good objective to make clear that an extension is used, but it 
is also quite important to keep good support from editors (coloring, 
indentation, parentheses matching), which is quite contradictory with 
the notion of quotation.  Also, relying on already parsed fragments 
discourage the creation of sub-languages with ad hoc grammar, and this 
is good (in particular, users don't need to learn new precedence rules).

I propose to start discussing the addition of attributes to most 
syntactic categories (expressions, type expressions, patterns, type 
declarations, module expressions, structure/signature items, etc).  I 
suggest to adopt "expressions" as the (default) nature of attribute's 
content, because the syntax for expressions is quite flexible.  We need 
some syntax to attach such an attribute to various syntactic categories. 
  It might be a good idea to support both prefix and postfix attributes. 
  Personally I don't care too much about the choice of syntax, and I'm 
very bad at picking good syntax.  Good proposal are welcome!  To avoid 
ambiguities, one might need to use different syntaxes for attributes on 
structure/signature items and other components.

To illustrate the idea, though, let's assume the following syntax:

   postfix:    .... (% e)
   prefix:     (@ e) ....

on structure/signature items:

   postfix:    .... (%% e)
   prefix:     (@@ e) ....


So one could write:

  (@PGSQL) dbh "select id, name from users"

  type t = { a : int (% default(2), sexp_drop_if (fun x -> x = 2)) }

  type f = {foo:int} (%sexp)

  let () = (@TEST) expr

  module M = (@ifdef SYMBOL)(struct ... end)(struct ... end)

  (@@nonrec) type t = ...


   val foo: int -> int  (%% DEPRECATED)


Alain


From fabrissimo@gmail.com  Tue Jan 29 12:29:20 2013
Return-Path: <fabrissimo@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C28E03C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 12:29:20 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.45 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (fabrissimo[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f45.google.com ([209.85.214.45]:48349)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0ANh-0001jf-SR (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <fabrissimo@gmail.com>); Tue, 29 Jan 2013 12:33:42 +0000
Received: by mail-bk0-f45.google.com with SMTP id i18so222801bkv.32
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 04:33:41 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:message-id:date:from:user-agent:mime-version:to
 :cc:subject:references:in-reply-to:content-type;
 bh=6qbCmaONNZpfL/6BVPuv+CviI0LsFWzelCj6fRynekc=;
 b=O+ZP1f519oNsqHN+rP09HeEgrQGvudhaisvG69TbX/L4p6AFGKLr8NMdPPNFdvAmBq
 xLlfgkygG2AJGLGf28V6Mgtw2XK9iQvPdLBcMQDtqzoDg6VuaAPm05oKs3Pu0E+i1fgZ
 MxT6cie/+3Dl0nGPBMfyDmloz9CjrLW8nazd86uGjiMLtoL+1fMAPgLf024LhrIYGUpi
 HNkyAkFNBWPs3DIRztqgf2dwUkKgJvE9nmEBe+s+uXV9uAwLdOl76fqodhxZunsJA73Z
 Cyt/qxkVTXaxISigPrCuJsY1nMs7quNPqTPR9mEJx1X+xzY0EZcd9+HGBnzJorhFtaVe
 9THw==
X-Received: by 10.204.147.217 with SMTP id m25mr298532bkv.17.1359462821482;
 Tue, 29 Jan 2013 04:33:41 -0800 (PST)
Received: from ?IPv6:2001:660:3013:3:3ce5:7e24:3bb3:dcfe?
 ([2001:660:3013:3:3ce5:7e24:3bb3:dcfe])
 by mx.google.com with ESMTPS id ho6sm8861776bkc.0.2013.01.29.04.33.39
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Tue, 29 Jan 2013 04:33:40 -0800 (PST)
Sender: Fabrice Le Fessant <fabrissimo@gmail.com>
Message-ID: <5107C1A3.1010800@inria.fr>
Date: Tue, 29 Jan 2013 13:33:39 +0100
From: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:17.0) Gecko/20130106 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
Content-Type: multipart/mixed; boundary="------------070805060700090007060207"
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 12:29:20 -0000

This is a multi-part message in MIME format.
--------------070805060700090007060207
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

On 01/29/2013 11:47 AM, Leo White wrote:
>>> I second Leo's idea to leave it to the preprocessor.
>>
>> I would strongly argue for a convention that has to be obeyed by all
>> preprocessors. If you leave it to the preprocessor, you will have to
>> call the preprocessor during the parsing, not during the typing, i.e.
>> you won't have access to the typing environment while expanding
>> macros. Consequently, your objectives were to be strictly more
>> powerful, but your system would actually be strictly less powerful.
>
> There is no reson that you cannot expand the preprocessor during typing.
> As I said in a previous post, all we need to provide is a function that
> will parse an expression upto the next unnested occurence of "$" or
> whatever the preprocessor is using to mark the end of its
> antiquotations. Preprocessors can then simply use this facility to
> handle their antiquotations themselves.

Ok, there are two debates here : one is about the implementation, the 
other one is about the accessibility.

 From the implementation point-of-view, you have to know all the parsers 
at parsing time, because you need the function to recognize their 
antiquotations. In my implementation of ocaml-templates, there was a 
parser to load new parsers (<:dynlink<pa_to_string>>). These new parsers 
would be loaded while parsing the string inside the quotation, i.e. 
during typing, not during parsing. In your case, you would not be able 
to do that, unless you provide natively this mechanism to load parsers 
dring parsing.

 From the accessibility point-of-view, having a convention for 
quotations/anti-quotations is both simpler for users (they can 
understand more of what is happening even if they don't know the syntax 
extensions, because anti-quotations are always written in the same way), 
and for developers (they don't need to provide a function to recognize 
their own anti-quotations, and actually, they don't even need to think 
about which delimiters to use for their syntax).

During such debates, I always think about Ruby's "convention over 
configuration", and why some languages are widely adopted while they are 
actually less powerful than OCaml (and Camlp4 is very powerful...).

--Fabrice


--------------070805060700090007060207
Content-Type: text/x-vcard; charset=utf-8;
 name="fabrice_le_fessant.vcf"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment;
 filename="fabrice_le_fessant.vcf"

begin:vcard
fn:Fabrice LE FESSANT
n:LE FESSANT;Fabrice
org:INRIA Saclay -- Ile-de-France;P2P & OCaml
adr;quoted-printable:;;Parc Orsay Universit=C3=A9 ;Orsay CEDEX;;91893;France
email;internet:fabrice.le_fessant@inria.fr
title;quoted-printable:Charg=C3=A9 de Recherche
tel;work:+33 1 74 85 42 14
tel;fax:+33 1 74 85 42 49 
url:http://fabrice.lefessant.net/
version:2.1
end:vcard


--------------070805060700090007060207--

From info@gerd-stolpmann.de  Tue Jan 29 12:52:42 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 339843C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 12:52:42 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.17.9 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.17.9]:54308)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0AkJ-0003ky-sb (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Tue, 29 Jan 2013 12:57:04 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-218-231.pools.arcor-ip.net
 [94.219.218.231])
 by mrelayeu.kundenserver.de (node=mreu3) with ESMTP (Nemesis)
 id 0MZbAH-1UIWyP3daH-00LG7t; Tue, 29 Jan 2013 13:57:01 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 6DBC5C00D0;
 Tue, 29 Jan 2013 13:57:00 +0100 (CET)
Date: Tue, 29 Jan 2013 13:56:59 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
In-Reply-To: <5107C1A3.1010800@inria.fr> (from Fabrice.Le_fessant@inria.fr
 on Tue Jan 29 13:33:39 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359464219.10634.12@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:9yO087EXoUvb3ROZLAnFDEsPRG5klC7pc5Gt6g+aPx8
 FsGBZjkRbLdBKt3ZlY50F2v8rzNqn80cYJwr7JvN7+QikB7D4E
 qeBO/nkICdcri3MR0CuQYSaybwXsPBMgvgcc8obI/Jg3DKZDMB
 r2JQd+/M+z+E1chl/dPb9YLk/H8SnI9B9lJTA+wO/WbLDsRfwA
 gqLvk4WccDRI6jZSYVhrD0P+klMo7vVpRUyXFdjk7aDp4eIhWR
 BX7zgLrP7L3vi3et5qpnwCo63sdSTKeIHRHMjQEid4NXkm1aZ/
 8ygaZyeOHfDBc2gDF7QG4Jd/WfCZWEiA5xsH4CXZX/7Uoo/kLa
 g4Vk3EoNnHkX13iuf2uo=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 12:52:42 -0000

Am 29.01.2013 13:33:39 schrieb(en) Fabrice Le Fessant:
> From the accessibility point-of-view, having a convention for =20
> quotations/anti-quotations is both simpler for users (they can =20
> understand more of what is happening even if they don't know the =20
> syntax extensions, because anti-quotations are always written in the =20
> same way), and for developers (they don't need to provide a function =20
> to recognize their own anti-quotations, and actually, they don't even =20
> need to think about which delimiters to use for their syntax).

Regarding developers: no, I don't agree. I think it is too restrictive, =20
and you would then force the developers to work around limitations, =20
making it more complicated than just calling a sub parser.

So far I see it, quotations are about totally foreign syntax, and this =20
already applies to the level of tokens. This also means that strings, =20
comments, etc. may be defined in a totally different way than in OCaml. =20
The lexical conventions may be very different. E.g. if I want to run =20
shell commands as quotation, I'm probably not happy with $ as =20
antiquotation delimiter, and also I'd like to recognize the delimiters =20
only in some contexts, and in other contexts they should be ignored =20
(e.g., continuing the shell example, inside single quotes). I'm citing =20
shell as example, especially because it has weird lexical rules.

Of course, this means that it is more difficult (or even impossible) =20
for tools to recognize anti-quotations. I'd pay this price - =20
antiquotations are often only short expressions.

Btw, we can still meet in the middle - just provide some utility =20
functions to find the preferred anti-quotation style, and many =20
developers will use them. This would not make it impossible to deviate =20
from that rule if there is good reason.

Gerd


>=20
> During such debates, I always think about Ruby's "convention over =20
> configuration", and why some languages are widely adopted while they =20
> are actually less powerful than OCaml (and Camlp4 is very =20
> powerful...).
>=20
> --Fabrice
>=20


--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From lpw25@hermes.cam.ac.uk  Tue Jan 29 13:12:57 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id EC48A3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 13:12:57 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:45358)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0B3v-0004iK-SA (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 13:17:19 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0B3v-0003SY-NB (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 13:17:19 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 29 Jan 2013 13:17:19 +0000
Date: 29 Jan 2013 13:17:19 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Fabrice Le Fessant <Fabrice.Le_fessant@inria.fr>
Message-ID: <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5107C1A3.1010800@inria.fr>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 13:12:58 -0000

> From the implementation point-of-view, you have to know all the parsers 
>at parsing time, because you need the function to recognize their 
>antiquotations.

I don't think that this is the case. I think that with a bit of care you 
can provide a function like:

anti-expr: (char Stream.t -> bool) -> char Stream.t -> Parsetree.expression

where the first argument is a predicate that tests for the end of the 
anti-quotation.

This function could be used by an extension whether it is expanded before 
or during type-checking.

> From the accessibility point-of-view, having a convention for 
>quotations/anti-quotations is both simpler for users (they can 
>understand more of what is happening even if they don't know the syntax 
>extensions, because anti-quotations are always written in the same way)

This seems to assume that quotations are for a sub-language that is nothing 
like OCaml, and so anti-quotations should be clearly marked. However, 
quotations should also be used in for extensions that are, as Gabriel put 
it, "mostly valid OCaml code". In these cases "anti-quotations" actually 
make up the majority of the text, and forcing an unnecessary heavyweight 
syntax for them will make these quotations very unwieldy.

For example (a quotation for Haskell's arrow notation):

<:proc < x -> 
           y <- f -< x + 1;
           g -< 2 * y;
           t <- h -< x * (x + y);
           return -< t + y >>

is definitely preferable to:

<:proc < $x$ -> 
           y <- $f$ -< $x + 1$;
           $g$ -< $2 * y$;
           t <- $h$ -< $x * (x + y)$;
           $return$ -< $t + y$ >>


From wojciech.meyer@gmail.com  Tue Jan 29 13:18:40 2013
Return-Path: <wojciech.meyer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id ACD463C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 13:18:40 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.219.53 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (wojciech.meyer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-oa0-f53.google.com ([209.85.219.53]:56370)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0B9S-0007q0-pE (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <wojciech.meyer@gmail.com>); Tue, 29 Jan 2013 13:23:03 +0000
Received: by mail-oa0-f53.google.com with SMTP id l20so395113oag.26
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 05:23:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=fa5Hj5XfpNYuW4oCK/GmrEfq4/1kAFHW+IMMjs5PAIg=;
 b=E0+tLV1DsfG1062vDFWcD/lb3X6LbdwEVxukfDg8dQUCrA1fku9W6rjgvS1MXUdsIy
 2ZVfzyFVGlJfc/1KyfUGP+HUKUjcmn3IO5KMZDPJeHlDZJ0DJGdBgLT24BytowFiB0KG
 NKqHlOlZtzhc+MmRgpT5nHVhXEYtO+j12whl7hbKAaSY0lVuIAKeq5A4RXpdfmG4y1Ay
 JRu7CpRjh/q2LPWuDqylo/hDSTbAXlggI8sjBYAauJ/AmxHs6AAxQfFR3rRGyzPIQiZ4
 jHafmj5sOJcK6JbjAuAf7yv4s0WhL29+zZthQOloBUVyURfuWzU7EzfeGq5u6CvKdKVQ
 OlcA==
MIME-Version: 1.0
X-Received: by 10.182.88.3 with SMTP id bc3mr726129obb.8.1359465782037; Tue,
 29 Jan 2013 05:23:02 -0800 (PST)
Received: by 10.182.221.71 with HTTP; Tue, 29 Jan 2013 05:23:01 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
Date: Tue, 29 Jan 2013 13:23:01 +0000
Message-ID: <CAOg1smCnyC=2=VywQqJsMMTgPdfTOJkXdrYS0OPWuQyr4yHdyg@mail.gmail.com>
From: Wojciech Meyer <wojciech.meyer@gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 13:18:40 -0000

> For example (a quotation for Haskell's arrow notation):
>
> <:proc < x ->           y <- f -< x + 1;
>           g -< 2 * y;
>           t <- h -< x * (x + y);
>           return -< t + y >>
>
> is definitely preferable to:
>
> <:proc < $x$ ->           y <- $f$ -< $x + 1$;
>           $g$ -< $2 * y$;
>           t <- $h$ -< $x * (x + y)$;
>           $return$ -< $t + y$ >>
>

FWIW: You can generate the second from former, by making a pass over the AST.

-Wojciech

From alain@frisch.fr  Tue Jan 29 13:33:13 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0884D3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 13:33:13 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:58789
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0BNX-0005OV-mp (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 29 Jan 2013 13:37:35 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tpda1k0073lHbAL03pdaCp; Tue, 29 Jan 2013 14:37:34 +0100
Message-ID: <5107D0A1.9000409@frisch.fr>
Date: Tue, 29 Jan 2013 14:37:37 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 13:33:13 -0000

On 01/29/2013 02:17 PM, Leo White wrote:
> However, quotations should also be used in for extensions that are, as
> Gabriel put it, "mostly valid OCaml code". In these cases
> "anti-quotations" actually make up the majority of the text, and forcing
> an unnecessary heavyweight syntax for them will make these quotations
> very unwieldy.
>
> For example (a quotation for Haskell's arrow notation):
>
> <:proc < x ->           y <- f -< x + 1;
>            g -< 2 * y;
>            t <- h -< x * (x + y);
>            return -< t + y >>

I don't like this use of quotations for "mostly valid OCaml code": you 
loose all support from your editor, who has no way to recognize valid 
fragments of OCaml code inside the quotation.  For those case, I'd 
rather use a special marker (an attribute or something else) to identify 
a syntactic scope under which some existing constructions are re-used 
with a different meaning.  As long as the special marker is visible 
enough, I think it is fine to do so.  For instance, js_of_ocaml could 
support code like:

   (@js) (o.property)
   (@js) (o # method foobar)


I find quotations very well suited to embed fragments of existing 
foreign languages (XML, shell) while keeping their own syntax, including 
lexical conventions.  But in those cases, anti-quotations are often 
quite trivial (simple identifiers, field projection, simple function calls).


Alain

From lpw25@hermes.cam.ac.uk  Tue Jan 29 13:53:41 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D64B33C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 13:53:41 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:48010)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0BhM-0004g3-qN (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 13:58:04 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0BhM-0000sc-6m (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 13:58:04 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 29 Jan 2013 13:58:04 +0000
Date: 29 Jan 2013 13:58:04 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301291358040.22588@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5107D0A1.9000409@frisch.fr>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
 <5107D0A1.9000409@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 13:53:41 -0000

>I don't like this use of quotations for "mostly valid OCaml code": you 
>loose all support from your editor, who has no way to recognize valid 
>fragments of OCaml code inside the quotation.  For those case, I'd 
>rather use a special marker (an attribute or something else) to identify 
>a syntactic scope under which some existing constructions are re-used 
>with a different meaning.  

Perhaps arrow notation was a bad example. I hadn't noticed that it is 
probably already a valid AST. I was thinking of those extensions that are 
mostly valid but not quite.

You could also allow anti-quotations to be surrounded by optional 
delimiters to indicate to their text editor that the contents should be 
highlighted. However, I would rather the syntax was easy for people to read 
than for tools to read.

> As long as the special marker is visible 
>enough, I think it is fine to do so.  For instance, js_of_ocaml could 
>support code like:
>
>   (@js) (o.property)
>   (@js) (o # method foobar)
>

I agree this is a good example of when a quotation is unnecessary. 


From yallop@gmail.com  Tue Jan 29 13:56:25 2013
Return-Path: <yallop@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4600B3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 13:56:25 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.172 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (yallop[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f172.google.com ([209.85.212.172]:40671)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0Bjz-0003p6-XY (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yallop@gmail.com>); Tue, 29 Jan 2013 14:00:47 +0000
Received: by mail-wi0-f172.google.com with SMTP id o1so2470268wic.5
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 06:00:47 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=2jRAy3Z8QEuGBxx/VtcK+JbwUWuxUomepsuM/MqX/UQ=;
 b=Cz1xaOrDxP/AXUsGBAvcY8bx/FLIjewSSxW3VXnEEdZwd22PT48iB2rUY8EHdiPqB/
 RixIdUc4IKveFgqn62QyowdX/47qvk1/E9zoQCjBfYky8Nav7RQiVhJ2+f5hBoJWyc46
 NFke0TPXqdI2ROfABsyvNDk3d/MVTUSbHL2q1TMoDIWJuPCkxc7olAOOWbtdw51OnQJZ
 /fw/pvFLzGA1K+IZerRkkPA26y4kkWRdq0QAQWq5YRsSzuMytHa8bLDLeBRuahxSKxzQ
 bJxKUJQAlZUFHmM9/E3swhiNVHIS1iIyqFIPT0sQ7LK14Cbk/mRZvs/0/igfX3NeBLCS
 78oA==
MIME-Version: 1.0
X-Received: by 10.194.90.116 with SMTP id bv20mr2606487wjb.33.1359468047218;
 Tue, 29 Jan 2013 06:00:47 -0800 (PST)
Received: by 10.217.39.129 with HTTP; Tue, 29 Jan 2013 06:00:46 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
Date: Tue, 29 Jan 2013 14:00:46 +0000
Message-ID: <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
From: Jeremy Yallop <yallop@gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=UTF-8
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 13:56:25 -0000

On 29 January 2013 13:17, Leo White <lpw25@cam.ac.uk> wrote:
> quotations should also be used in for extensions that are, as Gabriel put
> it, "mostly valid OCaml code".

I'd like to offer an opposing view: quotations are for use in
metaprogramming, and should not appear in user code (including code
that makes use of syntax extensions) at all.

Quotations turn code into values that can be processed by user code.
The idea of a quotation is to prevent code being evaluated
immediately, instead making it available to the quoting program as a
manipulable value.  I don't think that's what we're aiming for here;
instead, we're aiming to make it easier to hook syntax transformers
into the compiler.

Perhaps some examples will make the distinction clearer.

Here's a Campl4 quotation that builds an AST fragment:

      let x = <:expr< y + 1 >>

The value bound to x is now available for use in the program in which
the quotation appears.  You can analyse it, embed it in a larger AST,
print it, etc.

Here's a MetaOCaml quotation that builds a code value:

      let x = .< y + 1 >.

Again, the value bound to x is now available for use in the program in
which the quotation appears.  You can compile it, include it in a
larger piece of code, etc.

Here's a string quotation:

      let x = " y + 1 "

Once again, the value bound to x is available for use in the program
in which the quotation appears.  You can tokenize it, print it, etc.

In each case above, omitting the quotation delimiters would cause
immediate evaluation of the quoted code.  The reason for quoting is to
prevent evaluation and make the code available as a value instead.

Now consider the arrow notation example:

      let g = <:proc< x -> y <- f -< x + 1;
                           return -< y + 2 >>

Here the aim is quite different: we don't want to prevent immediate
evaluation; instead, we want to transform the syntax *for* immediate
evaluation.  We don't want g to be bound to some user-manipulable
representation of the code.  Instead, we want the *implementation* to
consume the desugared notation, type check it and bind the result of
evaluating it to g.  The distinction between user-consumable and
implementation-consumable code is obscured if we use quotations for
both in the source language.  Both quotations and syntax extensions
are useful, but let's use different notations for them.  For example,
using Alain's proposal, we might write the following for the arrow
notation fragment:

      let g = (@proc) x => (y <= f =< x + 1;
                            return =< y + 2)

Jeremy

From lpw25@hermes.cam.ac.uk  Tue Jan 29 14:13:10 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id DA0DA3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 14:13:10 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:37117)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0C0D-0005x7-Qe (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 14:17:33 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0C0D-0003zK-7Y (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 14:17:33 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 29 Jan 2013 14:17:33 +0000
Date: 29 Jan 2013 14:17:33 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Jeremy Yallop <yallop@gmail.com>
Message-ID: <Prayer.1.3.5.1301291417330.22588@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 14:13:10 -0000


>In each case above, omitting the quotation delimiters would cause
>immediate evaluation of the quoted code.  The reason for quoting is to
>prevent evaluation and make the code available as a value instead.

I think this a pretty dubious claim for both the camlp4 quotation and the 
string. In both cases those are simply extra syntax for representing 
values. For instance I could replace the camlp4 quotation with ordinary 
OCaml constructors. They do not delay execution because they are never 
executed.

>Now consider the arrow notation example:
>
>      let g = <:proc< x -> y <- f -< x + 1;
>                           return -< y + 2 >>
>
>Here the aim is quite different: we don't want to prevent immediate
>evaluation; instead, we want to transform the syntax *for* immediate
>evaluation.  We don't want g to be bound to some user-manipulable
>representation of the code.  Instead, we want the *implementation* to
>consume the desugared notation, type check it and bind the result of
>evaluating it to g.

You are making an arbitrary distinction between functions and other values.

let g x = <:proc< x -> y <- f -< x + 1;
                       return -< y + 2 >>

provides a value (in this case a function) to be used by the program just 
as

let blah = <:expr < let f = foo >>

provides a value to be used by the program.



From wojciech.meyer@gmail.com  Tue Jan 29 14:13:19 2013
Return-Path: <wojciech.meyer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1D6FC3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 14:13:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.180 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (wojciech.meyer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ob0-f180.google.com ([209.85.214.180]:39538)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0C0L-0005yb-q3 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <wojciech.meyer@gmail.com>); Tue, 29 Jan 2013 14:17:41 +0000
Received: by mail-ob0-f180.google.com with SMTP id ef5so436591obb.39
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 06:17:40 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=iNku5sF7qZzi19eN9AKfba/PqM0UGBDLlB4ZEO7MZrU=;
 b=eDk9XPp3z7YqYDydVlZ06jXoy8MAj/aVGb3fCC1vO1IDhwKSWydSTnfEQElUWtBPa7
 w+qrMR3AYmRdg/HyT6MtTVB2DGsVQlJ1S3a89TYo7R2yk6gEv5D+uwZ07rCOH1/zoJTD
 y6PfX5XQrC66LsJ1gEVHHr1LnnKiQJX7k/wDSYqLoGjqxwJV7o5NCUKegVMsDExMTQGO
 xN4kcPowIpGW9vr6uy7FY5uvesLg4SPNOkKXJj/7OXMJQU83XJI9UNPwi/0Wfq/ZKosS
 Neo1/6K7fZ4vSeVC0ZG8WLxtnU6ZQIh1FcdvTmu6dDEmqcAdklkqXVtma2FU1yBEmHcv
 D7fA==
MIME-Version: 1.0
X-Received: by 10.60.32.71 with SMTP id g7mr810773oei.96.1359469060326; Tue,
 29 Jan 2013 06:17:40 -0800 (PST)
Received: by 10.182.221.71 with HTTP; Tue, 29 Jan 2013 06:17:40 -0800 (PST)
In-Reply-To: <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
Date: Tue, 29 Jan 2013 14:17:40 +0000
Message-ID: <CAOg1smDk1CMDRhYCjcAJ8Lb=dugpyg_gwMO3cnTVyjsj08xj4Q@mail.gmail.com>
From: Wojciech Meyer <wojciech.meyer@gmail.com>
To: Jeremy Yallop <yallop@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 14:13:19 -0000

On Tue, Jan 29, 2013 at 2:00 PM, Jeremy Yallop <yallop@gmail.com> wrote:
> Here the aim is quite different: we don't want to prevent immediate
> evaluation; instead, we want to transform the syntax *for* immediate
> evaluation.  We don't want g to be bound to some user-manipulable
> representation of the code.  Instead, we want the *implementation* to
> consume the desugared notation, type check it and bind the result of
> evaluating it to g.  The distinction between user-consumable and
> implementation-consumable code is obscured if we use quotations for
> both in the source language.  Both quotations and syntax extensions
> are useful, but let's use different notations for them.  For example,
> using Alain's proposal, we might write the following for the arrow
> notation fragment:
>
>       let g = (@proc) x => (y <= f =< x + 1;
>                             return =< y + 2)
>

I tend to head our general perception, that we should have different
syntax for introducing lightweight extensions to the language (list
comprehensions, monads, arrows etc.) but as well full blown quotes
that have separate parser or even lexer. As implicitly mentioned by
Jeremy, the line that distinguish these two should be:
- if we treat the code inside the delimiters as first class value or not?
- if the quasi-quotes are needed?

These two give an indication which machinery too choose, but it might
be not clear in the begining for the users however?

-Wojciech

From info@gerd-stolpmann.de  Tue Jan 29 14:14:54 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7DB7D3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 14:14:54 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.171 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.171]:55524)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0C1s-0003fy-Wr (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Tue, 29 Jan 2013 14:19:17 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-218-231.pools.arcor-ip.net
 [94.219.218.231])
 by mrelayeu.kundenserver.de (node=mrbap2) with ESMTP (Nemesis)
 id 0M7m6a-1UvAN11JdQ-00vcZj; Tue, 29 Jan 2013 15:19:15 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id E7019C00D0;
 Tue, 29 Jan 2013 15:19:14 +0100 (CET)
Date: Tue, 29 Jan 2013 15:19:13 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Jeremy Yallop <yallop@gmail.com>
In-Reply-To: <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
 (from yallop@gmail.com on Tue Jan 29 15:00:46 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359469153.10634.13@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:gaRNcZfud8c7F/3bzZKohmP5fs1EhkhtKR4nPsWSIP0
 5D5Bg2NyVb4lHxWZgpd4dRIGzuAxHhJoF42RN7rBoU0pSkd51/
 4ya5JgxrEQbpD70IfmvHvRRGcZzTWj7cnkecHiezVjz8rn5ZNj
 dGa4GkQ62XL/4Rwfh5tPs5evL7dtE1cSW+yGesivCohcvVe8CU
 2gWajGJxJ4aVcxvBWd0dImLPmvV34pt4QD62x0I1BaPi/nFhFr
 1JkqTB7edeXacTMP6yi69KcXUBOx9VaTCs+lKemDdOV1gmxjYA
 DjC+nb+JHj+Xr6gNJbi/Am1GxZG/FmFc4afe34ziZdW7SUoRuZ
 x6Qi0vhr96TqVPpK0BKjmr+tOkcz7OuyGMSA+n1Hd
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 14:14:54 -0000

Am 29.01.2013 15:00:46 schrieb(en) Jeremy Yallop:
> On 29 January 2013 13:17, Leo White <lpw25@cam.ac.uk> wrote:
> > quotations should also be used in for extensions that are, as =20
> Gabriel put
> > it, "mostly valid OCaml code".
>=20
> I'd like to offer an opposing view: quotations are for use in
> metaprogramming, and should not appear in user code (including code
> that makes use of syntax extensions) at all.
>=20
> Quotations turn code into values that can be processed by user code.
> The idea of a quotation is to prevent code being evaluated
> immediately, instead making it available to the quoting program as a
> manipulable value.  I don't think that's what we're aiming for here;
> instead, we're aiming to make it easier to hook syntax transformers
> into the compiler.

I don't think you can really separate this if it comes to really =20
foreign syntax. I need to parse it anyway, and of course I get then a =20
manipulable value. I can easily provide e.g.

   <:sql< ... >>

and

   <:sqltree< ... >>

at the same time (the latter would just return the parsed syntax tree, =20
whereas the former would directly execute the foreign expression).

Object level and meta level are only separated by one "exec" call.

If your intention is to reserve the quotation notation for the meta =20
level, I don't see the benefit.

Gerd

> Perhaps some examples will make the distinction clearer.
>=20
> Here's a Campl4 quotation that builds an AST fragment:
>=20
>       let x =3D <:expr< y + 1 >>
>=20
> The value bound to x is now available for use in the program in which
> the quotation appears.  You can analyse it, embed it in a larger AST,
> print it, etc.
>=20
> Here's a MetaOCaml quotation that builds a code value:
>=20
>       let x =3D .< y + 1 >.
>=20
> Again, the value bound to x is now available for use in the program in
> which the quotation appears.  You can compile it, include it in a
> larger piece of code, etc.
>=20
> Here's a string quotation:
>=20
>       let x =3D " y + 1 "
>=20
> Once again, the value bound to x is available for use in the program
> in which the quotation appears.  You can tokenize it, print it, etc.
>=20
> In each case above, omitting the quotation delimiters would cause
> immediate evaluation of the quoted code.  The reason for quoting is to
> prevent evaluation and make the code available as a value instead.
>=20
> Now consider the arrow notation example:
>=20
>       let g =3D <:proc< x -> y <- f -< x + 1;
>                            return -< y + 2 >>
>=20
> Here the aim is quite different: we don't want to prevent immediate
> evaluation; instead, we want to transform the syntax *for* immediate
> evaluation.  We don't want g to be bound to some user-manipulable
> representation of the code.  Instead, we want the *implementation* to
> consume the desugared notation, type check it and bind the result of
> evaluating it to g.  The distinction between user-consumable and
> implementation-consumable code is obscured if we use quotations for
> both in the source language.  Both quotations and syntax extensions
> are useful, but let's use different notations for them.  For example,
> using Alain's proposal, we might write the following for the arrow
> notation fragment:
>=20
>       let g =3D (@proc) x =3D> (y <=3D f =3D< x + 1;
>                             return =3D< y + 2)
>=20
> Jeremy
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
>=20



--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From lpw25@hermes.cam.ac.uk  Tue Jan 29 14:17:05 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9E5093C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 14:17:05 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:38277)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0C40-0007rV-QZ (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 14:21:28 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0C40-0004YH-6p (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 14:21:28 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 29 Jan 2013 14:21:28 +0000
Date: 29 Jan 2013 14:21:28 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Leo White <lpw25@cam.ac.uk>
Message-ID: <Prayer.1.3.5.1301291421280.22588@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301291417330.22588@hermes-1.csi.cam.ac.uk>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
 <Prayer.1.3.5.1301291417330.22588@hermes-1.csi.cam.ac.uk>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 14:17:05 -0000

I just realized that I had slightly misunderstood Jeremy's point in my 
previous post.

It seems that you are suggesting that quotations should only be used to 
surround code that is already syntactically correct.

This ignores most of the existing uses of quotations (both camlp4 and 
string).


From yallop@gmail.com  Tue Jan 29 14:23:44 2013
Return-Path: <yallop@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 21A213C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 14:23:44 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (yallop[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f173.google.com ([74.125.82.173]:56998)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0CAQ-0003we-nr (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yallop@gmail.com>); Tue, 29 Jan 2013 14:28:06 +0000
Received: by mail-we0-f173.google.com with SMTP id r5so339167wey.18
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 06:28:06 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=t3TosaVzD1PjitZInqsSYGDYDsYLr12zb4tGaoE6ov0=;
 b=xiwKVNk7QBUgJj8ph+gK965PpqKz70WV/71FrQfIiegibKavdi3hKEo5DefOJcS145
 J+VOQpNtzihoeo0amxiWLSpIzWIWlcSZdqJodaXiE/bgnwOYbKicVhIy03mpzmpFzro0
 lRSX5CAWmUdfoQiiRtYwIf8kydKeVJkl6prbu4aOFU9TydvPFdCalyo7JJBdKcWHIpEo
 sj/GIEoLHc1HGYniGWnOVZsrHEiRL2wcCS6DQXHb8gbzQfUZVySGbmdAn6dzoickc+hH
 K2TeyeQwdrmL06dGVog+SpP0lwy4BEudG9sEZe6Is5a5da/WM2P3u5xYvtrAHEBjHLE7
 9uMw==
MIME-Version: 1.0
X-Received: by 10.180.80.170 with SMTP id s10mr2900974wix.27.1359469686157;
 Tue, 29 Jan 2013 06:28:06 -0800 (PST)
Received: by 10.217.39.129 with HTTP; Tue, 29 Jan 2013 06:28:05 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301291417330.22588@hermes-1.csi.cam.ac.uk>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
 <Prayer.1.3.5.1301291417330.22588@hermes-1.csi.cam.ac.uk>
Date: Tue, 29 Jan 2013 14:28:05 +0000
Message-ID: <CAAxsn=Eg9m2cEf+Vgrf7vL81Rn598mvUcfBhsGQmcFoBRT5D4A@mail.gmail.com>
From: Jeremy Yallop <yallop@gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=UTF-8
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 14:23:44 -0000

On 29 January 2013 14:17, Leo White <lpw25@cam.ac.uk> wrote:
> You are making an arbitrary distinction between functions and other values.

Actually, this has nothing at all to do with functions.

The "tl;dr" is: syntax extensions are about notation, while quotations
are about distinguishing using and mentioning.

From lpw25@hermes.cam.ac.uk  Tue Jan 29 14:43:15 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 88CAD3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 14:43:15 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:32861)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0CTK-0000QF-Wj (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 14:47:38 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0CTK-0008Sz-3n (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 14:47:38 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 29 Jan 2013 14:47:38 +0000
Date: 29 Jan 2013 14:47:38 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Jeremy Yallop <yallop@gmail.com>
Message-ID: <Prayer.1.3.5.1301291447380.22588@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CAAxsn=Eg9m2cEf+Vgrf7vL81Rn598mvUcfBhsGQmcFoBRT5D4A@mail.gmail.com>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
 <Prayer.1.3.5.1301291417330.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=Eg9m2cEf+Vgrf7vL81Rn598mvUcfBhsGQmcFoBRT5D4A@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 14:43:15 -0000

On Jan 29 2013, Jeremy Yallop wrote:

>On 29 January 2013 14:17, Leo White <lpw25@cam.ac.uk> wrote:
>> You are making an arbitrary distinction between functions and other 
>> values.
>
>Actually, this has nothing at all to do with functions.
>
>The "tl;dr" is: syntax extensions are about notation, while quotations
>are about distinguishing using and mentioning.
>

The difference between using and mentioning is fairly philosophical. 

As far as I'm concerned <:expr < 3 + 4 >> is simply a syntactic short hand 
for something like AstPlus(AstConstInt 3, AstConstInt 4). That fact that 
these constructors in some way refer to another thing is not particularly 
relevant.

My point about functions was that you seemed to be defining "using" as 
executing, which is obviously only possible for a quotation that represents 
OCaml functions.


From jun.furuse@gmail.com  Tue Jan 29 14:59:30 2013
Return-Path: <jun.furuse@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 58A913C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 14:59:30 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.42 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (jun.furuse[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f42.google.com ([74.125.82.42]:54244)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0Cj2-0003u8-md (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <jun.furuse@gmail.com>); Tue, 29 Jan 2013 15:03:53 +0000
Received: by mail-wg0-f42.google.com with SMTP id 12so2061187wgh.5
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 07:03:51 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:date:message-id:subject:from:to
 :content-type; bh=0kNsLqVFXclshPqICvvpvEnKsQ1IzWF58DIB/4o0Wo8=;
 b=tGO3M2l5Nh00iIA84/GrNqZlrYfuQ/9UghjmFgkn6m70V5gUeD7VVn5RzXpBhTWko/
 20FYOyya92jAOMi3nRoupVjvchx3xYr+TqrYd7KyLFYHMzmQJMQtazdRXvCkROV6RIDl
 9Hxtqvz1tL7HwzfYsKAMsBNS9r3wn+LuTVQO66rAZldSNSY2oUnh/FAE0F+i22ON5dJy
 O5MKRXVPA7JXT4Dr4cY7Kq65QohRWbgPpw1VwtwobRC9HQgTnPKxKJmm/pfNf3pwkv8H
 4yaX2V/nUCYqLaJOOm4L+FuUob+zmg5BuP+ZBJQd0vKIzT3pNa9cQK4JtZp2pLTkB40q
 vUfg==
MIME-Version: 1.0
X-Received: by 10.180.88.40 with SMTP id bd8mr2913430wib.33.1359471821814;
 Tue, 29 Jan 2013 07:03:41 -0800 (PST)
Received: by 10.194.19.170 with HTTP; Tue, 29 Jan 2013 07:03:41 -0800 (PST)
Date: Tue, 29 Jan 2013 23:03:41 +0800
Message-ID: <CAAoLEWsqBqOtXxWXafUV1GTSv1Xp21DMJwjyGLPPmd4JX_0cmg@mail.gmail.com>
From: Jun Furuse <jun.furuse@gmail.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: multipart/alternative; boundary=f46d04428f12057a0104d46eb3da
Subject: [wg-camlp4] My P4 uses
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 14:59:30 -0000

--f46d04428f12057a0104d46eb3da
Content-Type: text/plain; charset=ISO-8859-1

Hi,

Here are the things I do with CamlP4. Lots are just simple variants of
the already reported things, though.

pa_monad for "perform" notation
===================================

URL: https://bitbucket.org/camlspotter/pa_monad_custom

I modified the original pa_monad so that I can write I/O code easily inside
perform:

    perform
      ...;
      let () = prerr_endline "debug" in     (* Writing  let () = ... in  is
boring *)
      ...;

    peform
      ...;
      \ prerr_endline "debug";          (* It is not unit monad, but a
simple unit *)
      ...;

Here \ behaves like a prefix operator with very low power,
less than function application.
I wish -ppx could provide an easy way to handle those operators with
custom connectivity configurations, including pa_monad's <--.

Code generations from data type definitions
======================================================

I have bunch of type_conv based pa modules, such as meta_conv, and other
iterator/visitor/mapper generators. I believe they can be easily ported
from
type_conv to -ppx, if we could do for sexplib.

Record like syntax
======================================================

URL: https://bitbucket.org/camlspotter/ocaml-pure-polyrecord

I introduced record like syntax for pure polymorphic records
(they are not objects so they can be marshalled). The syntax is like:

    let r = {| x = 1; y = "hello"; |}

    let x = r..x

So this is a variant of js_of_ocaml's javascript object syntax.

Perl/Python/Shell like string literals
======================================================

URL: https://bitbucket.org/camlspotter/orakuda

ORakuda provides some scripting language like string literals like:

    $/^(.*)\.mli$/                                   (* Regexp. See \ is
not doubled. *)
    $s/template/replace/g
    let myname = "Jun" in $"My name is $myname and my age is %d" 42
 (* printf *)
    let dir = Sys.getenv "HOME" in $`ls $dir`

It is very useful to write quick one time OCaml scripts, however, it
requires
a patch to CamlP4 to modify its lexer. CamlP4 can actually replace its
lexer, but
it is not integrated into pa_*.cmo framework.

So without the patch, the above must be written:

    <:m<^(.*)\.mli$>>
    <:s<template/replace/g>>
    let myname = "Jun" in <:qq<My name is $myname and my age is %d>> 42
    let dir = Sys.getenv "HOME" in <:qx<ls $dir>>

It is a bit cumbersome to type <:< >> around, but still they are useful to
me.
Note that $ is NOT used as anti-quotation for these quotes.
So I think fixing anti-quotation symbol to some character like $
uniformly is a bad idea.

I do not expect -ppx is going to handle lexer hacks like $/.../, however,
I hope it could be simple enough to write a patch to support $/.../. :-)

Partial evaluation
======================================================

In Planck LL parser library, I wrote a small pa module to partial-evaluate
monadic binds for optimzation. This is purely a program transformation,
so there should be no problem to do the same thing in -ppx.

--f46d04428f12057a0104d46eb3da
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div>Hi,</div><div><br></div><div>Here are the things I do=
 with CamlP4. Lots are just simple variants of</div><div>the already report=
ed things, though.</div><div><br></div><div>pa_monad for &quot;perform&quot=
; notation</div>
<div>=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</div><div><br></div><div>URL: <a href=
=3D"https://bitbucket.org/camlspotter/pa_monad_custom">https://bitbucket.or=
g/camlspotter/pa_monad_custom</a></div><div><br></div><div>I modified the o=
riginal pa_monad so that I can write I/O code easily inside perform:</div>
<div><br></div><div>=A0 =A0 perform</div><div>=A0 =A0 =A0 ...;</div><div>=
=A0 =A0 =A0 let () =3D prerr_endline &quot;debug&quot; in =A0 =A0 (* Writin=
g =A0let () =3D ... in =A0is boring *)</div><div>=A0 =A0 =A0 ...;</div><div=
>=A0</div><div>=A0 =A0 peform</div><div>
=A0 =A0 =A0 ...;</div><div>=A0 =A0 =A0 \ prerr_endline &quot;debug&quot;; =
=A0 =A0 =A0 =A0 =A0(* It is not unit monad, but a simple unit *)</div><div>=
=A0 =A0 =A0 ...;</div><div><br></div><div>Here \ behaves like a prefix oper=
ator with very low power,=A0</div>
<div>less than function application.=A0</div><div>I wish -ppx could provide=
 an easy way to handle those operators with</div><div>custom connectivity c=
onfigurations, including pa_monad&#39;s &lt;--.</div><div><br></div><div>
Code generations from data type definitions</div><div>=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</div><di=
v><br></div><div>I have bunch of type_conv based pa modules, such as meta_c=
onv, and other=A0</div><div>iterator/visitor/mapper generators. I believe t=
hey can be easily ported from=A0</div>
<div>type_conv to -ppx, if we could do for sexplib.</div><div><br></div><di=
v>Record like syntax</div><div>=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</div><div><br></div><div>URL:=
 <a href=3D"https://bitbucket.org/camlspotter/ocaml-pure-polyrecord">https:=
//bitbucket.org/camlspotter/ocaml-pure-polyrecord</a></div>
<div><br></div><div>I introduced record like syntax for pure polymorphic re=
cords</div><div>(they are not objects so they can be marshalled). The synta=
x is like:</div><div><br></div><div>=A0 =A0 let r =3D {| x =3D 1; y =3D &qu=
ot;hello&quot;; |}</div>
<div><br></div><div>=A0 =A0 let x =3D r..x</div><div><br></div><div>So this=
 is a variant of js_of_ocaml&#39;s javascript object syntax.</div><div><br>=
</div><div>Perl/Python/Shell like string literals</div><div>=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</d=
iv>
<div><br></div><div>URL: <a href=3D"https://bitbucket.org/camlspotter/oraku=
da">https://bitbucket.org/camlspotter/orakuda</a></div><div><br></div><div>=
ORakuda provides some scripting language like string literals like:</div>
<div><br></div><div>=A0 =A0 $/^(.*)\.mli$/ =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 (* Regexp. See \ is not doubled. *)</di=
v><div>=A0 =A0 $s/template/replace/g</div><div>=A0 =A0 let myname =3D &quot=
;Jun&quot; in $&quot;My name is $myname and my age is %d&quot; 42 =A0 =A0 =
=A0 =A0 =A0(* printf *)</div>
<div>=A0 =A0 let dir =3D Sys.getenv &quot;HOME&quot; in $`ls $dir`</div><di=
v><br></div><div>It is very useful to write quick one time OCaml scripts, h=
owever, it requires=A0</div><div>a patch to CamlP4 to modify its lexer. Cam=
lP4 can actually replace its lexer, but</div>
<div>it is not integrated into pa_*.cmo framework.</div><div><br></div><div=
>So without the patch, the above must be written:</div><div><br></div><div>=
=A0 =A0 &lt;:m&lt;^(.*)\.mli$&gt;&gt;</div><div>=A0 =A0 &lt;:s&lt;template/=
replace/g&gt;&gt;</div>
<div>=A0 =A0 let myname =3D &quot;Jun&quot; in &lt;:qq&lt;My name is $mynam=
e and my age is %d&gt;&gt; 42</div><div>=A0 =A0 let dir =3D Sys.getenv &quo=
t;HOME&quot; in &lt;:qx&lt;ls $dir&gt;&gt;</div><div><br></div><div>It is a=
 bit cumbersome to type &lt;:&lt; &gt;&gt; around, but still they are usefu=
l to me.</div>
<div>Note that $ is NOT used as anti-quotation for these quotes.</div><div>=
So I think fixing anti-quotation symbol to some character like $</div><div>=
uniformly is a bad idea.</div><div><br></div><div>I do not expect -ppx is g=
oing to handle lexer hacks like $/.../, however,</div>
<div>I hope it could be simple enough to write a patch to support $/.../. :=
-)</div><div><br></div><div>Partial evaluation</div><div>=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</div>=
<div><br></div><div>In Planck LL parser library, I wrote a small pa module =
to partial-evaluate</div>
<div>monadic binds for optimzation. This is purely a program transformation=
,=A0</div><div>so there should be no problem to do the same thing in -ppx.<=
/div><div><br></div></div>

--f46d04428f12057a0104d46eb3da--

From yallop@gmail.com  Tue Jan 29 15:23:10 2013
Return-Path: <yallop@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 00D9B3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 15:23:09 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.41 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (yallop[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f41.google.com ([74.125.82.41]:45745)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0D5v-0006D4-pN (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yallop@gmail.com>); Tue, 29 Jan 2013 15:27:32 +0000
Received: by mail-wg0-f41.google.com with SMTP id ds1so2079993wgb.4
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 07:27:31 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=yyYSq3cz8Dp0qQGO/028rB4aABJ01KIYLEgv8ZPoE+E=;
 b=ijy/9Twqd7lTHrfNIo/ET74FkzZylIjEdnF4ud2bpI83L2silfJyB1pDvCZC6lCHfj
 NEhg2AHLNMfzWc5s/g1Ej7+h9X61TOaVgflNoiAyUvLf+UIK+fFgVuJZkkvz4VoKM1rc
 mJPOoTM+xZP7SQdKRGNU0RiZQWlJE2ezoygukAd7gmNSK2Z/nEUNSYe39nk3m+xt2r+f
 SEEgTNYHi33qicz60U1fSm/ds7vFnmrWOvrwL6awAoYMJNjQtLvzbMGOdWPw2403l2LQ
 rwMScOnHjEZvv9tnhf3e8ymxV6kCjFWPWVkZZFFpZAC8uiX1r9KqFsOOGQPLZs/1Zr3V
 t/zA==
MIME-Version: 1.0
X-Received: by 10.194.90.116 with SMTP id bv20mr3134329wjb.33.1359473251733;
 Tue, 29 Jan 2013 07:27:31 -0800 (PST)
Received: by 10.217.39.129 with HTTP; Tue, 29 Jan 2013 07:27:31 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301291447380.22588@hermes-1.csi.cam.ac.uk>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
 <Prayer.1.3.5.1301291417330.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=Eg9m2cEf+Vgrf7vL81Rn598mvUcfBhsGQmcFoBRT5D4A@mail.gmail.com>
 <Prayer.1.3.5.1301291447380.22588@hermes-1.csi.cam.ac.uk>
Date: Tue, 29 Jan 2013 15:27:31 +0000
Message-ID: <CAAxsn=G-V+qGz-Frjjrgb_ADkaNHV_PUwKLDr1=bMpAzddOpmQ@mail.gmail.com>
From: Jeremy Yallop <yallop@gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=UTF-8
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 15:23:10 -0000

On 29 January 2013 14:47, Leo White <lpw25@cam.ac.uk> wrote:
> As far as I'm concerned <:expr < 3 + 4 >> is simply a syntactic short hand
> for something like AstPlus(AstConstInt 3, AstConstInt 4).

Yes.  That's exactly why quotations belong in programs that process
ASTs (e.g. in compilers or metaprograms), not in programs that only
process the result of evaluating ASTs (i.e. in user code).  User code
doesn't typically deal with AstPlus and AstConstInt, but it might well
need to add numbers.

> My point about functions was that you seemed to be defining "using" as
> executing, which is obviously only possible for a quotation that represents
> OCaml functions.

Actuially, that's not what I mean by "using".  Evaluating is indeed a
form of using, but evaluating function syntax creates a function
value; it doesn't call the function.  Quoting prevents evaluation for
functions, just as for everything else, so when you quote function
syntax you get some kind of code representation rather than a function
value.  There's really nothing special about functions here.

From xavier.clerc@inria.fr  Tue Jan 29 15:33:01 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6067B3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 15:33:01 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.5 from SpamAssassin-3.3.2-1439302 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:2585)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0DFT-00022A-qJ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Tue, 29 Jan 2013 15:37:24 +0000
X-IronPort-AV: E=Sophos;i="4.84,561,1355094000"; 
   d="scan'208";a="385483"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail3-relais-sop.national.inria.fr with ESMTP; 29 Jan 2013 16:37:18 +0100
Date: Tue, 29 Jan 2013 16:37:22 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
In-Reply-To: <5106AA6A.8090006@frisch.fr>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [128.93.135.218]
X-Mailer: Zimbra 7.2.0_GA_2669 (ZimbraWebClient - SAF3 (Mac)/7.2.0_GA_2669)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 15:33:01 -0000



----- Mail original -----
> On 01/28/2013 04:17 PM, Xavier Clerc wrote:
> >    3- in Mascot (style tool), camlp4 is used to get either
> >       a stream of lexical tokens or an AST, both being used
> >       to detect code smells;
> ...
> > Case 3 may appear as a perfect fit for ppx, but indeed
> > it is quite pleasant to write some code smell in OCaml
> > syntax (through quotations), rather than by matching
> > against a bare AST. The latter becomes very verbose,
> > and very hard to read/maintain to say the least.
> 
> I've the intuition that matching AST with patterns in a concrete
> syntax
> is a source of never lasting problems.  But it seems you disagree, so
> I'm very much interested in your experience!
> 
> Let me explain my point.
> 
> First, the parsing (concrete syntax -> AST) has some built-in
> ambiguities and resolution mechanism that the programmer does not
> even
> need to be aware of.  For instance, I cannot tell how a pattern like
> "p1
> | p2 | p3" or an expression "e1 || e2 || e3" is parsed without
> | looking
> at the parser (or most probably, playing with -dparsetree).  Is the
> pattern parsed like "(p1 | p2) | p3" or "p1 | (p2 | p3)"?  The
> problem
> is that you might need to know such information if you write AST
> transformation/matching with concrete syntax.
> 
> Second, you need some special extra "concrete" syntax to be able to
> specify whether you care or not about some features.  For instance,
> you
> need to be able to write a pattern which matches a recursive let
> binding, or non-recursive let binding, or any kind of let binding
> (recursive or not).  In the latter case, you probably want to be able
> to
> extract the recursive flag for later use.  You need to introduce some
> syntax for that.  Similarly, we need some expert knowledge and
> specific
> syntax to know exactly what your "free variables" stand for: you need
> to
> be able to say that you want to match an arbitrary constructor or a
> constructor with no module prefix.  This is the source for a lot of
> complexity related to anti-quotations in camlp4, in my opinion.
> 
> Third, working on concrete syntax gives a false feeling that you
> don't
> need to master the abstract syntax, but this is wrong.  You need to
> know
> if "M.(e)" and "let open M in e" map to the same AST or not, if
> record
> punning is implemented in the parser or if is represented in the AST
> (exercise: define a "code smell rule" to detect missed punning
> opportunity, i.e. an instance of a record field "l = l"), etc.
> 
> Fourth, working with concrete syntax requires to master a new
> sub-language (with quotations, anti-quotations), which is far from
> trivial, and which looks like the real OCaml syntax but is not really
> the same.  There is a learning curve here, which should not be
> neglected.
> 
> 
> At the end of the day, I find it both simpler and more robust to work
> on
> abstract syntax, even if this is marginally more verbose.  Some
> actions
> can reduce the syntactic overhead of working with abstract syntax:
> cleaning up the Parsetree (and removing prefixes) and improvements to
> our beloved host language itself (such as
> http://caml.inria.fr/mantis/view.php?id=5667 or even more ambitious
> extensions).  I'd rather see time invested in such improvements than
> on
> providing support for working with (almost-)concrete syntax.  But
> YMMV,
> and I'm very much interested to hear about the opinion and experience
> of
> other people on this topic.  (And of course, once quotations are
> supported, nothing prevent some -ppx rewriter to provide support for
> concrete-syntax matching, to be used for compiling other -ppx
> rewriters...)


Well Alain, I basically agree about the different points you raise.
They closely describe my experience in writing Mascot!
As of today, most checks are written by matching against AST bits,
because as you pointed out it is a tad safer. However, during development,
it was a time-saver to be able to easily express and experiment new
ideas by manipulating "bits of the actual language". Camlp4 was kind
enough to translate them for me into AST code which I had to check.

When expressing a complex pattern, I think this turns out to be really
useful. I even keep some of these patterns in a (non-public) directory
for development. As you said, the release version has to be polished by
checking some ambiguities.

To sum up, I totally agree on "robustness" but not quite on "easiness".


Regards,

Xavier

From lpw25@hermes.cam.ac.uk  Tue Jan 29 15:43:26 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0D1773C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 15:43:26 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:52151)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0DPY-0002TY-Yk (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 15:47:48 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0DPY-0000Vx-Nw (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 15:47:48 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 29 Jan 2013 15:47:48 +0000
Date: 29 Jan 2013 15:47:48 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Jeremy Yallop <yallop@gmail.com>
Message-ID: <Prayer.1.3.5.1301291547480.23651@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CAAxsn=G-V+qGz-Frjjrgb_ADkaNHV_PUwKLDr1=bMpAzddOpmQ@mail.gmail.com>
References: <5106AEDA.4050305@inria.fr>
 <Prayer.1.3.5.1301281707020.32043@hermes-1.csi.cam.ac.uk>
 <1359404907.10634.7@samsung> <5107A248.8050809@inria.fr>
 <Prayer.1.3.5.1301291046550.19279@hermes-1.csi.cam.ac.uk>
 <5107C1A3.1010800@inria.fr>
 <Prayer.1.3.5.1301291317190.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=EUjsGSEfiPRZehZwT-uqiuoL_w3P32B9uAzB9WyQMHXw@mail.gmail.com>
 <Prayer.1.3.5.1301291417330.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=Eg9m2cEf+Vgrf7vL81Rn598mvUcfBhsGQmcFoBRT5D4A@mail.gmail.com>
 <Prayer.1.3.5.1301291447380.22588@hermes-1.csi.cam.ac.uk>
 <CAAxsn=G-V+qGz-Frjjrgb_ADkaNHV_PUwKLDr1=bMpAzddOpmQ@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 15:43:26 -0000

>On 29 January 2013 14:47, Leo White <lpw25@cam.ac.uk> wrote:
>> As far as I'm concerned <:expr < 3 + 4 >> is simply a syntactic short 
>> hand for something like AstPlus(AstConstInt 3, AstConstInt 4).
>
>Yes.  That's exactly why quotations belong in programs that process
>ASTs (e.g. in compilers or metaprograms), not in programs that only
>process the result of evaluating ASTs (i.e. in user code).  User code
>doesn't typically deal with AstPlus and AstConstInt, but it might well
>need to add numbers.

But user code does deal with the results of other quotations, like HTML and 
SQL quotations. I don't see a real difference between using a quotation to 
define some constructors representing HTML and using a quotation to define 
a function. Just because the function will at some point get called.

I think this all comes from the confluence of the word quotation as in a 
string quotation (e.g. "a string"), which is something that must be lexed 
separately from the rest of the language, and the use of ' (or "quote") in 
lisp to delay evaluation. MetaOCaml's quotations are an example of this 
second type.

You want to reserve the camlp4 quotation syntax for use as the second kind 
of quotation. However, both the camlp4 tutorial 
(http://caml.inria.fr/pub/docs/tutorial-camlp4/tutorial004.html) and many 
of the common uses of camlp4 quotations treat them as the first kind.


From info@gerd-stolpmann.de  Tue Jan 29 15:51:50 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A9D6E3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 15:51:50 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.171 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.171]:56638)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0DXg-00023g-rL (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Tue, 29 Jan 2013 15:56:13 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-218-231.pools.arcor-ip.net
 [94.219.218.231])
 by mrelayeu.kundenserver.de (node=mrbap2) with ESMTP (Nemesis)
 id 0Ltm1V-1UyCat2XYr-010trW; Tue, 29 Jan 2013 16:56:10 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 428E1C00D0;
 Tue, 29 Jan 2013 16:56:10 +0100 (CET)
Date: Tue, 29 Jan 2013 16:56:09 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Jeremy Yallop <yallop@gmail.com>
In-Reply-To: <CAAxsn=G-V+qGz-Frjjrgb_ADkaNHV_PUwKLDr1=bMpAzddOpmQ@mail.gmail.com>
 (from yallop@gmail.com on Tue Jan 29 16:27:31 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359474969.10634.14@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:u3emgeR3c6FuMTHwJHam+AI1F4NSkDuZbkrUiD64zIX
 1XJkOL5eswr0eddZNqebyvn2hkYE+mhNCsbMYpWgRUKVE6Aa7p
 b4puDgmhvsOoX08jJXJ2MdYdKh9Vu4l8wtHqQLERzfSZvr6WOo
 18ylyra/wExaD1LuSAwfMOynMG8mJkUf0yc8TTBCYBQqDM8eMT
 mKX7CvLrmRgo3Ah/av8UVS/ES7X5eie6vfPiPltR2+f6yNWKC3
 4FOevHgSCgrRmxZiTAq0kbiGWU88lwJsg3e3g3uLs8tNaXO7Fz
 JpLXvhkRzqdUEFjfdNp+6NMbvqLNTLRPg13opxUXHBgafudwyd
 M8NH86zgg1H43N3138CCXvikE8g8zI2Av78iLmT5u
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My uses of syntax extension
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 15:51:50 -0000

I've the impression that Jeremy's point is just that we call it the =20
wrong way. We shouldn't say "quotation" when we mean an escape clause =20
(escaping from the normal syntax). I mean the term "quotation" got only =20
popular because the first use of this notation were Camlp4 quotations =20
(which are real quotations). But I've the feeling most people here just =20
want to keep the notation without implying anything - hence my =20
suggestion to rename it for avoiding any confusion.

Gerd


Am 29.01.2013 16:27:31 schrieb(en) Jeremy Yallop:
> On 29 January 2013 14:47, Leo White <lpw25@cam.ac.uk> wrote:
> > As far as I'm concerned <:expr < 3 + 4 >> is simply a syntactic =20
> short hand
> > for something like AstPlus(AstConstInt 3, AstConstInt 4).
>=20
> Yes.  That's exactly why quotations belong in programs that process
> ASTs (e.g. in compilers or metaprograms), not in programs that only
> process the result of evaluating ASTs (i.e. in user code).  User code
> doesn't typically deal with AstPlus and AstConstInt, but it might well
> need to add numbers.
>=20
> > My point about functions was that you seemed to be defining "using" =20
> as
> > executing, which is obviously only possible for a quotation that =20
> represents
> > OCaml functions.
>=20
> Actuially, that's not what I mean by "using".  Evaluating is indeed a
> form of using, but evaluating function syntax creates a function
> value; it doesn't call the function.  Quoting prevents evaluation for
> functions, just as for everything else, so when you quote function
> syntax you get some kind of code representation rather than a function
> value.  There's really nothing special about functions here.
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
>=20



--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From alain@frisch.fr  Tue Jan 29 16:18:11 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7604E3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 16:18:11 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:38854
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0DxB-0007gN-Se (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 29 Jan 2013 16:22:34 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tsNY1k01D3lHbAL03sNZ48; Tue, 29 Jan 2013 17:22:33 +0100
Message-ID: <5107F74E.8010603@frisch.fr>
Date: Tue, 29 Jan 2013 17:22:38 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Xavier Clerc <xavier.clerc@inria.fr>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
In-Reply-To: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 16:18:11 -0000

On 01/29/2013 04:37 PM, Xavier Clerc wrote:
> However, during development,
> it was a time-saver to be able to easily express and experiment new
> ideas by manipulating "bits of the actual language". Camlp4 was kind
> enough to translate them for me into AST code which I had to check.

What about having a tool (either stand-alone or part of the compilers) 
which dumps the Parsetree representation of some code fragment in as 
textual OCaml values (probably without locations)?

So you can type your "model" as source code and obtain quickly the 
Parsetree representation, copy/paste it into a nice pattern and replace 
some parts with variables.

Alain


From xavier.clerc@inria.fr  Tue Jan 29 16:26:23 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 751D43C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 16:26:23 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.5 from SpamAssassin-3.3.2-1439302 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.83 listed in list.dnswl.dnsbl.ja.net]
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail2-relais-roc.national.inria.fr ([192.134.164.83]:33889)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0E57-00076z-WS (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Tue, 29 Jan 2013 16:30:46 +0000
X-IronPort-AV: E=Sophos;i="4.84,561,1355094000"; 
   d="scan'208";a="509198"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail2-relais-roc.national.inria.fr with ESMTP; 29 Jan 2013 17:30:44 +0100
Date: Tue, 29 Jan 2013 17:30:44 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <39365578.998998.1359477044777.JavaMail.root@inria.fr>
In-Reply-To: <5107F74E.8010603@frisch.fr>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [128.93.135.218]
X-Mailer: Zimbra 7.2.0_GA_2669 (ZimbraWebClient - SAF3 (Mac)/7.2.0_GA_2669)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 16:26:23 -0000



----- Mail original -----
> On 01/29/2013 04:37 PM, Xavier Clerc wrote:
> > However, during development,
> > it was a time-saver to be able to easily express and experiment new
> > ideas by manipulating "bits of the actual language". Camlp4 was
> > kind
> > enough to translate them for me into AST code which I had to check.
> 
> What about having a tool (either stand-alone or part of the
> compilers)
> which dumps the Parsetree representation of some code fragment in as
> textual OCaml values (probably without locations)?
> 
> So you can type your "model" as source code and obtain quickly the
> Parsetree representation, copy/paste it into a nice pattern and
> replace
> some parts with variables.

Yes, such a tool would do the trick.

I juste realized that it would probably not be very different
from the "-dsource" option you added to compilers...


Regards,

Xavier

From alain@frisch.fr  Tue Jan 29 16:29:29 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id F39C53C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 16:29:28 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439302 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:51709
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0E87-0004ix-RS (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 29 Jan 2013 16:33:51 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d53 with ME
 id tsZq1k00w3lHbAL03sZqfV; Tue, 29 Jan 2013 17:33:51 +0100
Message-ID: <5107F9F3.1010700@frisch.fr>
Date: Tue, 29 Jan 2013 17:33:55 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Xavier Clerc <xavier.clerc@inria.fr>
References: <39365578.998998.1359477044777.JavaMail.root@inria.fr>
In-Reply-To: <39365578.998998.1359477044777.JavaMail.root@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 16:29:29 -0000

On 01/29/2013 05:30 PM, Xavier Clerc wrote:
> I juste realized that it would probably not be very different
> from the "-dsource" option you added to compilers...

This would be the lifted version of -dsource.  -dsource displays a 
source code which would be parsed to the same Parsetree (modulo 
locations).  Here we are talking about displaying code which would 
*evaluate* to the same Parsetree (if it had quotations).


-- Alain

From xavier.clerc@inria.fr  Tue Jan 29 16:33:06 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 235A23C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 16:33:06 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.5 from SpamAssassin-3.3.2-1439302 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.83 listed in list.dnswl.dnsbl.ja.net]
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail2-relais-roc.national.inria.fr ([192.134.164.83]:43401)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0EBc-0001af-YW (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Tue, 29 Jan 2013 16:37:29 +0000
X-IronPort-AV: E=Sophos;i="4.84,561,1355094000"; 
   d="scan'208";a="510411"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail2-relais-roc.national.inria.fr with ESMTP; 29 Jan 2013 17:37:28 +0100
Date: Tue, 29 Jan 2013 17:37:28 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <1123543212.1001007.1359477448410.JavaMail.root@inria.fr>
In-Reply-To: <5107F9F3.1010700@frisch.fr>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [128.93.135.218]
X-Mailer: Zimbra 7.2.0_GA_2669 (ZimbraWebClient - SAF3 (Mac)/7.2.0_GA_2669)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 16:33:06 -0000



----- Mail original -----
> On 01/29/2013 05:30 PM, Xavier Clerc wrote:
> > I juste realized that it would probably not be very different
> > from the "-dsource" option you added to compilers...
> 
> This would be the lifted version of -dsource.  -dsource displays a
> source code which would be parsed to the same Parsetree (modulo
> locations).  Here we are talking about displaying code which would
> *evaluate* to the same Parsetree (if it had quotations).

Yes, of course.


Xavier Clerc

From lpw25@hermes.cam.ac.uk  Tue Jan 29 18:11:58 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4BD133C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 18:11:58 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:46264)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0FjJ-0004Nu-q3 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 18:16:21 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0FjJ-0005AD-3q (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 29 Jan 2013 18:16:21 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 29 Jan 2013 18:16:21 +0000
Date: 29 Jan 2013 18:16:21 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5107BEDF.6040907@frisch.fr>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 18:11:58 -0000

>I propose to start discussing the addition of attributes to most 
>syntactic categories (expressions, type expressions, patterns, type 
>declarations, module expressions, structure/signature items, etc).  I 
>suggest to adopt "expressions" as the (default) nature of attribute's 
>content, because the syntax for expressions is quite flexible.  We need 
>some syntax to attach such an attribute to various syntactic categories. 
>  It might be a good idea to support both prefix and postfix attributes. 
>  Personally I don't care too much about the choice of syntax, and I'm 
>very bad at picking good syntax.  Good proposal are welcome! 

How about allowing {: foo }, {% foo }, {@ foo },
 <: foo < bar >>, <% foo < bar >>  and <@ foo < bar >> ?

The idea is that "{" means it is a valid OCaml expression as oppossed to 
"<" which means it is an unlexed string.

":" means that it is an expression/pattern/type on its own and the 
type-checker should raise an error if it still exists after all 
preprocessing is done.

"%" means it is a postfix attribute that can safely be ignored by the 
type-checker.

"@" means it is a prefix attribute that can safely be ignored by the type 
checker.

This seems fairly systematic and covers many possible use cases.


From gabriel.scherer@gmail.com  Tue Jan 29 18:49:53 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1CE7B3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 18:49:53 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.50 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f50.google.com ([209.85.214.50]:63953)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0GJz-0006g1-pH (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Tue, 29 Jan 2013 18:54:16 +0000
Received: by mail-bk0-f50.google.com with SMTP id jg9so458900bkc.37
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 10:54:15 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=Uir84VuuGSZXJXK5QxEK13mcQKYlg+3vyUYQmGdMT/g=;
 b=yqR/ZapXd86k30UzTEBxV+RRjhuMYgzKPgBN1COLfLIPT3QY431PpH4ARN6woM4LKG
 5Oz3BAoA6KT/sjKTj+UUMSwbrcOIa8N9Uv17GefuMW/XCDmBjoGQJMvSEZHi8oJF/9Y5
 UWpE8kFICAj6WrBZYu2jMlnPFxtg9XK39+uqqC8icp2B/Fbp+2KJHkkSFi2gzlrLom8E
 HP/H39xSbk563z9UYxgHNUFkXumIf91r7eyvYMR/OQngrdOfzLa0l66MSRfDhCqz8C3j
 Ip1mCbCP0Jtficcas0Dc7qd8DbBvk4dr2O0WgWatKmgsZoVIoCCvYFo5IZc0NY+f43iB
 +BJg==
X-Received: by 10.204.4.200 with SMTP id 8mr636417bks.94.1359485655550; Tue,
 29 Jan 2013 10:54:15 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.236.134 with HTTP; Tue, 29 Jan 2013 10:53:34 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
 <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Tue, 29 Jan 2013 19:53:34 +0100
Message-ID: <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 18:49:53 -0000

I was going to suggest a related idea, having two syntaxes for "should
be tool-handled as valid OCaml code inside" and "should be
tool-handled as strings".

I'm not sure the idea of having "postfix" and "prefix" annotations
makes sense for all grammar rules (and mixing them with a modality of
"external or ocaml-syntax" feels like conflating separate concerns).
I'd rather consider where annotation may happen for grammar rules
individually. For example, in the case of "let p = e1 in e2", I'm
quite sure we may want to annotate either the whole expression or
specifically the declaration, and while I see how prefix and postfix
both make sense for the whole expression, I'm not sure they would both
make sense to annotate the binding, and considering only those cases
could lead them to being dropped.

Still in this case 'let p = e1 in e2', how should we distinguish:
- an annotation on the expressions 'e1' and 'e2'
- an annotation on the pattern 'p' (possibly seen as an expressions)
- an annotation on the binding itself
- an annotation on the expression as a whole?

In the case of embeddings of external syntaxes, it seems to be enough
to be able to embed into the expression and pattern syntactic classes
only (and not bindings in this example). I think annotations are
fairly different beasts.

On Tue, Jan 29, 2013 at 7:16 PM, Leo White <lpw25@cam.ac.uk> wrote:
>> I propose to start discussing the addition of attributes to most syntactic
>> categories (expressions, type expressions, patterns, type declarations,
>> module expressions, structure/signature items, etc).  I suggest to adopt
>> "expressions" as the (default) nature of attribute's content, because the
>> syntax for expressions is quite flexible.  We need some syntax to attach
>> such an attribute to various syntactic categories.  It might be a good idea
>> to support both prefix and postfix attributes.  Personally I don't care too
>> much about the choice of syntax, and I'm very bad at picking good syntax.
>> Good proposal are welcome!
>
>
> How about allowing {: foo }, {% foo }, {@ foo },
> <: foo < bar >>, <% foo < bar >>  and <@ foo < bar >> ?
>
> The idea is that "{" means it is a valid OCaml expression as opposed to "<"
> which means it is an unlexed string.
>
> ":" means that it is an expression/pattern/type on its own and the
> type-checker should raise an error if it still exists after all
> preprocessing is done.
>
> "%" means it is a postfix attribute that can safely be ignored by the
> type-checker.
>
> "@" means it is a prefix attribute that can safely be ignored by the type
> checker.
>
> This seems fairly systematic and covers many possible use cases.
>

From bobzhang1988@gmail.com  Tue Jan 29 19:00:59 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 07DD13C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 19:00:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.1 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.180 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 *  1.5 TVD_PH_BODY_META TVD_PH_BODY_META
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f180.google.com ([209.85.220.180]:39751)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0GUi-0002hX-ro (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Tue, 29 Jan 2013 19:05:22 +0000
Received: by mail-vc0-f180.google.com with SMTP id fo13so500672vcb.11
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 11:05:20 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:date:x-google-sender-auth:message-id
 :subject:from:to:content-type;
 bh=YDcQup6Z38BeRrgSmupGSewL60CTiAEdoxVR8sfpqLI=;
 b=WqSTiauTcohgkB4OoZG68DP7qwKgVBifAPIeAu3wgotJ+eHiO7/cVV95RkshM60zqg
 psOKs43QmasywUNznG0ihoR8wq1Yf4jxYFGaf8ZiwC+1HNH9QlI5KGo0453l2QhDkcFS
 6kw1JNUHFM6t0Jjag8fzcdmBDJUEUSHuqH3FB8rQiebSIi8dhOXMBEWVtwOER2EcEpb1
 z8Pr3m0DUYy38IvqSNYaIpOLFLoPb0wumZXoS9rdscON3JXuoXbeP9VRxayQHNHzU+un
 I4QWtzCbTNIwxuZ5zX3fKWB7ZRaPIIj/HLcE1BeNj36kaZXIUjnpMiW1vH7HSxjUVaU6
 qNUQ==
MIME-Version: 1.0
X-Received: by 10.220.150.83 with SMTP id x19mr2231500vcv.25.1359486319847;
 Tue, 29 Jan 2013 11:05:19 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Tue, 29 Jan 2013 11:05:19 -0800 (PST)
Date: Tue, 29 Jan 2013 14:05:19 -0500
X-Google-Sender-Auth: S-zdUIYzzIQSiClKHaZPoJlf5Lw
Message-ID: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: wg-camlp4@lists.ocaml.org, caml-devel <caml-devel@yquem.inria.fr>
Content-Type: multipart/alternative; boundary=f46d0434bf9c2bea9804d4721319
Subject: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 19:00:59 -0000

--f46d0434bf9c2bea9804d4721319
Content-Type: text/plain; charset=ISO-8859-1

Dear wg-camp4 users,

    So far,  the discussion is really interesting and quite helpful, but I
want to talk about the meta-programming *from the point of the view of
implementation side,* features are easy to propose, but maybe only the
compiler/library writers know how hard to implement, I do appreciate that
you can sit dow and read the long email, I am also starting to blog(
http://hongboz.wordpress.com/) about how to do syntactic meta programming
(SMP) in a right way.
   I rewrite the whole camlP4(named Fan) from scratch, building the
quotation kit and throw away the crappy grammar parser, so plz believe me *that
I do understand the whole technology stack of camlP4*, if we could reach
some consensus, I would be happy to handle over the maintaining of  Fan,
Fan does not loose any feature compared with camlP4, in fact it has more
interesting featrues.

   Let's begin with some easy, not too technical parts which has a
significant effect on user experience though:
   1. Performance
          Performance does matter, it's a shame that  the most time spent
in compiling the ocaml compiler is dedicated to camlP4, but it is an
engineering problem, currently compiling Fan only takes less than 20s, and
it can be improved further
   2. Building issues
        The design of having side effects by dynamic loading is generically
a bad idea, in Fan* the dynamic loading only register some functionality
the Fan support,* it *does not have any other side effec*t, each file
stands alone says which (ppx , or filters, or syntax) it want to use with a
good default option. so the building is always something like '-pp fan
pluging1 plugin2 plugin3', *the order of pulgings does not matter*,
also, l*oading
all the plugins you have does not have any side effect, even better, you
can do the static linking all the plugins you collected, the building
process is simplified.  *
* * 3. Grammar Extension (*Language namespace*)
*       *I concur that grammar extension arbitrarily is a bad idea, and I
agree with Gabrier that so far only the quotation(Here  quotation means
delimited DSL, quosi-quotation means Lisp style macros) is modular,
composable, and  I also agree with Gabrier -ppx* should not be used to do
syntax overriding (this should not be called syntax extension
actually), *that's
a terrible idea to do syntax overriding, since the user never understand
what's going on underly without reading the Makefile. So here some my
suggestion is that some really conevenient syntax extesion, i.e, (let try..
in) should be merged to the built in parser. quotations does not bring too
much heavy syntax (imho). In Fan, we proposed the concept of a hierarchical
language name space, since once quotation is heavily used, it's really easy
to introduce conflict, *the language namespace querying is exactly like
java package namespace,* you can import, close import to save some typing.
    Here is a taste

 -----------------------------------------------------------------------------------------------
     {:.Fan.Lang.Meta.expr| a + b |} ------>
      `App (`App ((`Id (`Lid "+")), (`Id (`Lid "a")))), (`Id (`Lid "b")))
     {:.Fan.Lang.Meta.N.expr| a + b |}  ----->
      `App
    (_loc,
      (`App
         (_loc, (`Id (_loc, (`Lid (_loc, "+")))),
           (`Id (_loc, (`Lid (_loc, "a")))))),
      (`Id (_loc, (`Lid (_loc, "b")))))
 -----------------------------------------------------------------------------------------------
 the .Fan.Lang.Meta.expr the first '.' means it's from the absolute
namespace,  the *N.expr shares exactly the same syntax without location*,
though

   4. Portable to diffierrent compiler extensions(like LexiFi's fork of
ocaml)
       I am pretty sure it's pretty easy to do in Fan, only Ast2pt (dumping
the intemediate Ast into Parsetree) part need to be changed to diffierent
compilers.

----------------------------------------------------------------------------------------------------------------
Now let's talk about some internal parts of SMP.
Quasi-Quotation is the essential part of SMP,  I am surprised so far that
the discussion *silently ignores the quasi-quotation,* Leo's answer of
writing   three parsers is neither satisfying nor practical(imho).

Camlp4 is mainly composed of two parts, one is the extensible parser and *the
other significant part is Ast Lifting*. Since we all agree that extensible
parser increases the complexity too much, let's simply ignore that part.

The Ast Lifting are tightly coupled *with the design of the Abstract Syntax
Tree.*  People complain about that Camlp4 Ast is hard to learn and using
quasi-quotation to do the pattern match is a bad idea.

Let me explain the topic a bit:
    Camlp4Ast is hard to learn, I agree, it has some alien names that
nobody understand what it  means, quosi-quotation *is definitely a great
idea* to boom the meta-programming, but my experience here is *for very
very small Ast fragment, using the Abstract Syntax Tree directly,* otherwise
Quasi-quotation is a life saver to do the meta programming.
   Luckily the quotation kit has nothing to do with the parser part, it's
simply several functions(I did some simplify a bit) which turns a normal
runtime
value into an Ast node generically, *such kind functions are neither easy
to write nor easy to read*, *the idea case is that it should be generated
once for all, and all the data types in normal ocaml* *should be derived
automatically*(some ADT with functions can not be derived). *I bet it's
mostly likely a nightmare if we maintain 3 parsers for the ocaml grammar
while two other parsers dumping to a meta-level*

   So, how to make Ast Lifting easier,
        The first guideline is *"Don't mixing with records", *
*         *Once you encoding AST with records, you have to encode the
records in the meta level which increases the complexity without bringing
any new features, *it's simply not worthwhile.*
*
*
*       * The second guideline is "Don't do *any *syntax desugaring" ,
syntax desguaring makes the semantics of syntax meta programming a bit
weird. Syntax desguaring happens everywhere in Parsetree, think about the
list literals, it uses the syntax desuaring, if you don't use any syntax
desugaring, for example, you want to match the bigarray access, you simply
needed to match `Bigarray(..)' instead of

Pexp_apply
        ({pexp_desc=Pexp_ident
                     {txt= Ldot (Ldot (Lident "Bigarray", array),
("get"|"set" as gs)) ;_};_},
         label_exprs)
----------------------------
       The third guideline is to* *make it *as uniform as possible*
*       *This not only helps the user, but *it helps the meta-programming
over types to derive some utility types. *Take a look at my Ast encoding in
Fan https://github.com/bobzhang/Fan/blob/master/src/Ast.ml (it needs to be
polished, plz don't panic when you see variants I use here)
*      *The initial Ast has locations and ant support, but* here we derive
3 other Asts thanks to my very regular design*.* AstN is the Ast without
locations*, the locations are important, but it is simply not too much
helpful when you only do the code generation, but it complicates the
expanded code a lot), *AstA is the Ast without antiquotations(simply remove
the ant branch), *it is a subtype of Ast(thanks to the choice we use
variants here), *AstNA is the Ast without neither locations nor
antiquotations*), it is a subtype of AstN.  *In practice, I found the Ast
without locations is particular helpful when you only do the code
generation, it simplifies this part significantly. The beautif**ul part is
that  all the four Ast share the same grammar with the same quosiquotatoin
mechanism, as I showed .Fan.Lang.N.expr and .Fan.Lang.expr*
    I don't know how many parsers you have to maintain to reach such a goal
or it's never going to happen.
    Using variants to encode the intermediate ast has a lots of other
benefits, but I don't want to cover it in such a short mail.

   So,* my proposal is that the community design an Intermediate Ast
together, and write a built-in parser to such Intermediate Ast then dump to
Parsetree, but I am for that Parsetree still needs to be cleaned a bit but
not too much change .  *I do appreciate you can take something away from
Fan, I think the Parsetree is* not the ideal part* to do SMP, HTH

-- 
-- Regards, Hongbo

--f46d0434bf9c2bea9804d4721319
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Dear wg-camp4 users,<div><br></div><div>=A0 =A0 So far, =A0the discussion i=
s really interesting and quite helpful, but I want to talk about the meta-p=
rogramming <b>from the point of the view of implementation side,</b> featur=
es are easy to propose, but maybe only the compiler/library writers know ho=
w hard to implement, I do appreciate that you can sit dow and read the long=
 email, I am also starting to blog(<a href=3D"http://hongboz.wordpress.com/=
">http://hongboz.wordpress.com/</a>) about how to do syntactic meta program=
ming (SMP) in a right way.</div>
<div>=A0 =A0I rewrite the whole camlP4(named Fan) from scratch, building th=
e quotation kit and throw away the crappy grammar parser, so plz believe me=
 <b>that I do understand the whole technology stack of camlP4</b>, if we co=
uld reach some consensus, I would be happy to handle over the maintaining o=
f =A0Fan, Fan does not loose any feature compared with camlP4, in fact it h=
as more interesting featrues.</div>
<div><br></div><div>=A0 =A0Let&#39;s begin with some easy, not too technica=
l parts which has a significant effect on user experience though:</div><div=
>=A0 =A01. Performance</div><div>=A0 =A0 =A0 =A0 =A0 Performance does matte=
r, it&#39;s a shame that =A0the most time spent in compiling the ocaml comp=
iler is dedicated to camlP4, but it is an engineering problem, currently co=
mpiling Fan only takes less than 20s, and it can be improved further</div>
<div>=A0 =A02. Building issues</div><div>=A0 =A0 =A0 =A0 The design of havi=
ng side effects by dynamic loading is generically a bad idea, in Fan<b> the=
 dynamic loading only register some functionality the Fan support,</b> it <=
b>does not have any other side effec</b>t, each file stands alone says whic=
h (ppx , or filters, or syntax) it want to use with a good default option. =
so the building is always something like &#39;-pp fan pluging1 plugin2 plug=
in3&#39;, <b>the order of pulgings does not matter</b>, also, l<b>oading al=
l the plugins you have does not have any side effect, even better, you can =
do the static linking all the plugins you collected, the building process i=
s simplified. =A0</b></div>
<div><b>=A0</b> 3. Grammar Extension (<b>Language namespace</b>)</div><div>=
<b>=A0 =A0 =A0 =A0</b>I concur that grammar extension arbitrarily is a bad =
idea, and I agree with Gabrier that so far only the quotation(Here =A0quota=
tion means delimited DSL, quosi-quotation means Lisp style macros) is modul=
ar, composable, and =A0I also agree with Gabrier -ppx<b> should not be used=
 to do syntax overriding (this should not be called syntax extension actual=
ly), </b>that&#39;s a terrible idea to do syntax overriding, since the user=
 never understand what&#39;s going on underly without reading the Makefile.=
 So here some my suggestion is that some really conevenient syntax extesion=
, i.e, (let try.. in) should be merged to the built in parser. quotations d=
oes not bring too much heavy syntax (imho). In Fan, we proposed the concept=
 of a hierarchical language name space, since once quotation is heavily use=
d, it&#39;s really easy to introduce conflict, <b>the language namespace qu=
erying is exactly like java package namespace,</b> you can import, close im=
port to save some typing.</div>
<div>=A0 =A0 Here is a taste</div><div>=A0 =A0-----------------------------=
------------------------------------------------------------------</div><di=
v>=A0 =A0 =A0{:.Fan.Lang.Meta.expr| a + b |} ------&gt;=A0</div><div>=A0 =
=A0 =A0=A0<span style=3D"background-color:rgb(255,255,255);color:rgb(34,34,=
34);font-family:arial,sans-serif;font-size:12.800000190734863px">`App (`App=
 ((`Id (`Lid &quot;+&quot;)), (`Id (`Lid &quot;a&quot;)))), (`Id (`Lid &quo=
t;b&quot;)))</span></div>
<div>=A0 =A0 =A0{:.Fan.Lang.Meta.N.expr| a + b |} =A0-----&gt;</div><div>=
=A0 =A0 =A0=A0<span style=3D"background-color:rgb(255,255,255);color:rgb(34=
,34,34);font-family:arial,sans-serif;font-size:12.800000190734863px">`App</=
span></div><div style=3D"color:rgb(34,34,34);font-family:arial,sans-serif;f=
ont-size:12.800000190734863px;background-color:rgb(255,255,255)">
=A0 =A0 (_loc,</div><div style=3D"color:rgb(34,34,34);font-family:arial,san=
s-serif;font-size:12.800000190734863px;background-color:rgb(255,255,255)">=
=A0 =A0 =A0 (`App</div><div style=3D"color:rgb(34,34,34);font-family:arial,=
sans-serif;font-size:12.800000190734863px;background-color:rgb(255,255,255)=
">
=A0 =A0 =A0 =A0 =A0(_loc, (`Id (_loc, (`Lid (_loc, &quot;+&quot;)))),</div>=
<div style=3D"color:rgb(34,34,34);font-family:arial,sans-serif;font-size:12=
.800000190734863px;background-color:rgb(255,255,255)">=A0 =A0 =A0 =A0 =A0 =
=A0(`Id (_loc, (`Lid (_loc, &quot;a&quot;)))))),</div>
<div><span style=3D"background-color:rgb(255,255,255);color:rgb(34,34,34);f=
ont-family:arial,sans-serif;font-size:12.800000190734863px">=A0 =A0 =A0 (`I=
d (_loc, (`Lid (_loc, &quot;b&quot;)))))</span>=A0</div><div><div>=A0------=
---------------------------------------------------------------------------=
--------------</div>
<div>=A0the .Fan.Lang.Meta.expr the first &#39;.&#39; means it&#39;s from t=
he absolute namespace, =A0the=A0<b>N.expr shares exactly the same syntax wi=
thout location</b>, though</div></div><div><br></div><div>=A0 =A04. Portabl=
e to diffierrent compiler extensions(like LexiFi&#39;s fork of ocaml)</div>
<div>=A0 =A0 =A0 =A0I am pretty sure it&#39;s pretty easy to do in Fan, onl=
y Ast2pt (dumping the intemediate Ast into Parsetree) part need to be chang=
ed to diffierent compilers.<br clear=3D"all"><div><br></div><div>----------=
---------------------------------------------------------------------------=
---------------------------</div>
<div>Now let&#39;s talk about some internal parts of SMP.</div><div>Quasi-Q=
uotation is the essential part of SMP, =A0I am surprised so far that the di=
scussion <b>silently ignores the quasi-quotation,</b> Leo&#39;s answer of w=
riting =A0 three parsers is neither satisfying nor practical(imho).=A0</div=
>
<div><br></div><div>Camlp4 is mainly composed of two parts, one is the exte=
nsible parser and <b>the other significant part is Ast Lifting</b>. Since w=
e all agree that extensible parser increases the complexity too much, let&#=
39;s simply ignore that part.</div>
<div><br></div><div>The Ast Lifting are tightly coupled <b>with the design =
of the Abstract Syntax Tree.</b>=A0 People complain about that Camlp4 Ast i=
s hard to learn and using quasi-quotation to do the pattern match is a bad =
idea.</div>
<div><br></div><div>Let me explain the topic a bit:</div><div>=A0 =A0 Camlp=
4Ast is hard to learn, I agree, it has some alien names that nobody underst=
and what it =A0means, quosi-quotation <b>is definitely a great idea</b> to =
boom the meta-programming, but my experience here is <b>for very very small=
 Ast fragment, using the Abstract Syntax Tree directly,</b>=A0otherwise Qua=
si-quotation is a life saver to do the meta programming.</div>
<div>=A0 =A0Luckily the quotation kit has nothing to do with the parser par=
t, it&#39;s simply several functions(I did some simplify a bit) which turns=
 a normal runtime =A0</div><div>value into an Ast node generically, <b>such=
 kind functions are neither easy to write nor easy to read</b>, <b>the idea=
 case is that it should be generated once for all, and all the data types i=
n normal ocaml</b> <b>should be derived automatically</b>(some ADT with fun=
ctions can not be derived). <b>I bet it&#39;s mostly likely a nightmare if =
we maintain 3 parsers for the ocaml grammar while two other parsers dumping=
 to a meta-level</b></div>
<div>=A0=A0</div><div>=A0 =A0So, how to make Ast Lifting easier,=A0</div><d=
iv>=A0 =A0 =A0 =A0 The first guideline is <b>&quot;Don&#39;t mixing with re=
cords&quot;,=A0</b></div><div><b>=A0 =A0 =A0 =A0 =A0</b>Once you encoding A=
ST with records, you have to encode the records in the meta level which inc=
reases the complexity without bringing any new features, <b>it&#39;s simply=
 not worthwhile.</b></div>
<div><b><br></b></div><div><b>=A0 =A0 =A0 =A0</b>=A0The second guideline is=
 &quot;Don&#39;t do <b>any </b>syntax desugaring&quot; , syntax desguaring =
makes the semantics of syntax meta programming a bit weird. Syntax desguari=
ng happens everywhere in Parsetree, think about the list literals, it uses =
the syntax desuaring, if you don&#39;t use any syntax desugaring, for examp=
le, you want to match the bigarray access, you simply needed to match `Biga=
rray(..)&#39; instead of=A0</div>
<div><div><br></div><div>Pexp_apply</div><div>=A0 =A0 =A0 =A0 ({pexp_desc=
=3DPexp_ident</div><div>=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0{txt=3D =
Ldot (Ldot (Lident &quot;Bigarray&quot;, array), (&quot;get&quot;|&quot;set=
&quot; as gs)) ;_};_},</div><div>
=A0 =A0 =A0 =A0 =A0label_exprs)</div></div><div>---------------------------=
-</div><div>=A0 =A0 =A0 =A0The third guideline is to<b> </b>make it <b>as u=
niform as possible</b></div><div><b>=A0 =A0 =A0 =A0</b>This not only helps =
the user, but <b>it helps the meta-programming over types to derive some ut=
ility types. </b>Take a look at my Ast encoding in Fan=A0<a href=3D"https:/=
/github.com/bobzhang/Fan/blob/master/src/Ast.ml">https://github.com/bobzhan=
g/Fan/blob/master/src/Ast.ml</a> (it needs to be polished, plz don&#39;t pa=
nic when you see variants I use here)</div>
<div><b>=A0 =A0 =A0 </b>The initial Ast has locations and ant support, but<=
b> here we derive 3 other Asts thanks to my very regular design</b>.<b> Ast=
N is the Ast without locations</b>, the locations are important, but it is =
simply not too much helpful when you only do the code generation, but it co=
mplicates the expanded code a lot), <b>AstA is the Ast without antiquotatio=
ns(simply remove the ant branch), </b>it is a subtype of Ast(thanks to the =
choice we use variants here), <b>AstNA is the Ast without neither locations=
 nor antiquotations</b>), it is a subtype of AstN. =A0<b>In practice, I fou=
nd the Ast without locations is particular helpful when you only do the cod=
e generation, it simplifies this part significantly.<i><u> The beautif</u><=
/i></b><u><b><i>u</i></b><i style=3D"font-weight:bold">l part is that =A0al=
l the four Ast share the same grammar with the same quosiquotatoin mechanis=
m, as I showed .Fan.Lang.N.expr and .Fan.Lang.expr</i></u></div>
<div>=A0 =A0 I don&#39;t know how many parsers you have to maintain to reac=
h such a goal or it&#39;s never going to happen.</div><div>=A0 =A0 Using va=
riants to encode the intermediate ast has a lots of other benefits, but I d=
on&#39;t want to cover it in such a short mail.</div>
<div><br></div><div>=A0 =A0So,<b> my proposal is that the community design =
an Intermediate Ast together, and write a built-in parser to such Intermedi=
ate Ast then dump to Parsetree, but I am for that Parsetree still needs to =
be cleaned a bit but not too much change . =A0</b>I do appreciate you can t=
ake something away from Fan, I think the Parsetree is<b> not the ideal part=
</b> to do SMP, HTH</div>
<div><div><br></div>-- <br>-- Regards, Hongbo

</div></div>

--f46d0434bf9c2bea9804d4721319--

From wojciech.meyer@gmail.com  Tue Jan 29 22:46:06 2013
Return-Path: <wojciech.meyer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 304FA3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 22:46:06 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.177 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (wojciech.meyer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f177.google.com ([209.85.212.177]:35160)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0K0b-0001v4-RZ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <wojciech.meyer@gmail.com>); Tue, 29 Jan 2013 22:50:30 +0000
Received: by mail-wi0-f177.google.com with SMTP id hm14so970916wib.4
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 14:50:29 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:from:to:subject:date:message-id:mime-version
 :content-type; bh=GbNiORtWDfUTDjOB+ysKb13ABRUA16bEU7xUW2+JvcE=;
 b=HMKX771oZi5NewMuen7F7NzM+RP4jnxT5EKrcNPEp8mApeMWZJ1yvHN7xkSr7TaMtx
 z9toXoXX/4ZiMPxASB31/1zNwkRS3YsHqfRVeIy259BGryR7m+1gLH0kIYtgnjTOWx/6
 yujyXt6V2OM2ac+FaH2EcdWaKDAAwBCxy2ZA3ZvQStdmqJ+cN17O0mAzfbyo2Q4NqRyJ
 3C6vX3VA39wDlaPa/CTGCV8Npb7VO+E4FH/mQMoSFK852cT+XBTHAps7s5gIkGGOFmQ4
 6fyOupaj+zw3bmO5uPTZBKkH83z3C6/+DDqQajF5jv6yo4V+DzQRFUoIeLaln0/kVY3e
 Rd3g==
X-Received: by 10.180.93.133 with SMTP id cu5mr5245056wib.32.1359499829241;
 Tue, 29 Jan 2013 14:50:29 -0800 (PST)
Received: from spec-desktop.danmey.org
 (cpc1-cmbg12-0-0-cust201.5-4.cable.virginmedia.com. [86.9.116.202])
 by mx.google.com with ESMTPS id do1sm6333474wib.7.2013.01.29.14.50.27
 (version=TLSv1.1 cipher=RC4-SHA bits=128/128);
 Tue, 29 Jan 2013 14:50:28 -0800 (PST)
From: Wojciech Meyer <wojciech.meyer@gmail.com>
To: "wg-camlp4\@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Date: Tue, 29 Jan 2013 22:50:40 +0000
Message-ID: <wftxpz38ov.fsf@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain
Subject: [wg-camlp4] Mix-fix notation
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 29 Jan 2013 22:46:06 -0000

Dear list,

I'd like to take an opportunity to discuss possibility of a mix-fix
notation as a part of the core language.

For those who've never heard about mix-fix notation, it's a notation
belonging to class of light syntactical abstractions that allows to
encode bigger range of embedded DSLs than user defined infix operators
purely using usual functional abstractions - and not meta programming in
particular. Essentially, it's a super-class of infix operators where any
numbers of arguments denoted by special placeholders can be separated by
any number of tokens.

Mix-fix notation has successfully been used by some modern dependently
typed functional languages like Agda, or in some way is used to extend
the syntax in Coq via. Notation to implement for instance monads.

On this occasion, I'd like also discuss changes to the language
involving possibility of relaxing infix operators, and extending them
(like in Caml-light) with user defined precedence. With these
relaxations it might appear that the language will become more
expressive.

Also, I'd like to focus on reusing mix-fix syntax to provide
meta-programming facilities - in particular defining new grammar entry
points using mix-fix.

So the mixfix notation in OCaml might look like this:

let _>>=_ m f = (* here a bind operator for a monad! *)

or if we are fancy for these technique in extending the syntax:

syntax _<--_-<_ pat e1 e2 = (* here is a code generator for an arrow! *)

Surely OCaml is strictly evaluated so all the usual tricks that can be
used in a language where evaluation strategy or order does not matter,
will not work, however it opens brand new doors for making combinator
based libraries. Also, it's very convenient and safe syntax for defining
grammar rules, instead of using BNF or even PEG and extending the
grammar by changing the rules in place.

I agree it would be a serious change to the language, therefore I
welcome an open discussion. Perhaps in extreme variant such change would
require writing a custom parser and lexer, and would render the OCaml
syntax incompatible, but having discussions about the quotations
mechanism, essentially embedding a DSL inside Caml, I'd like to shift
focus on safe and still expressive various applications of mix-fix and
possibility of providing such an abstraction to the OCaml world.

All the best,

-Wojciech

From bobzhang1988@gmail.com  Wed Jan 30 02:29:41 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1337A3C05E
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 02:29:41 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.1 from SpamAssassin-3.3.2-1439302 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.46 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 *  1.5 TVD_PH_BODY_META TVD_PH_BODY_META
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f46.google.com ([209.85.212.46]:49431)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0NUx-0007tA-SA (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Wed, 30 Jan 2013 02:34:05 +0000
Received: by mail-vb0-f46.google.com with SMTP id b13so723117vby.5
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 18:34:03 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:content-type;
 bh=/RSmEp03N+Yfb3WCV3uYz/Ni4yTt2pKiWl5ZKwr0xLk=;
 b=iej796I4649m8F9Y3p0MtF1EgE97L2gbupC2j1gHMDUqIlekuMcpkadtvXnfK/N/Cx
 YhOoIXhrjX2p6HVTXO+n43hJ9gTQwfWXV9Md5eQn+iRCiVjfKCBgI/POzeAxhhkZ98Oq
 2lcbHaiuFaJKqqG/Ae/ZyqIARyQaotjkyZWcItti+omV4MOFi9mcFXqkIDiCJe2Q5rae
 XEXB/oRtjeGoqMqmbZ1Emwv0rtymtcKf7qQ+oTD243lgyiaYrYxoUhyUznmNf94vqXVh
 2op4zIXkkq7jujFF+bxILwhFb0NrDJz73YmZZiWzb3Cgv4+5cuI079ANFMba+SS4b4yT
 67Eg==
MIME-Version: 1.0
X-Received: by 10.220.156.75 with SMTP id v11mr3542551vcw.1.1359513242845;
 Tue, 29 Jan 2013 18:34:02 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Tue, 29 Jan 2013 18:34:02 -0800 (PST)
In-Reply-To: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
Date: Tue, 29 Jan 2013 21:34:02 -0500
X-Google-Sender-Auth: vGBdrVccqWQi4cg40hVAJ27RhTM
Message-ID: <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: wg-camlp4@lists.ocaml.org
Content-Type: multipart/alternative; boundary=f46d043c7c86e8414c04d4785767
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 02:29:41 -0000

--f46d043c7c86e8414c04d4785767
Content-Type: text/plain; charset=ISO-8859-1

Quotations(Deliminated  DSL) works reasonably well instead of ppx, here is
my version of ulex in Fan(an improvement compared with ulex or sedlex is t*hat
it works well on toplevel*).

let rec token enc =  {:lex|
   "<utf8>" -> begin enc := Ulexing.Utf8; token enc lexbuf end
  | "<latin1>" -> begin enc := Ulexing.Latin1; token enc lexbuf end
  | xml_letter+ -> Printf.sprintf "word(%s)" (Ulexing.utf8_lexeme lexbuf)
  | number -> "number"
  | eof -> exit 0
  | [1234-1246] -> "bla"
  | "(" ->  begin
      Ulexing.rollback lexbuf; (* Puts the lexeme back into the buffer *)
      {| "(" [^ '(']* ")" -> Ulexing.utf8_lexeme lexbuf |} lexbuf
      (* Note the use of an inline lexer *)
  end
  | "(*" -> begin comment lexbuf; "comment" end
  | ' ' -> "whitespace"
  | _ -> "???" |}
and comment = {:lex|
   "*)" -> ()
  | eof -> failwith "comment"
  | _ -> let _lexeme = Ulexing.lexeme lexbuf in
    comment lexbuf |}
On Tue, Jan 29, 2013 at 2:05 PM, Hongbo Zhang <hongboz@seas.upenn.edu>wrote:

> Dear wg-camp4 users,
>
>     So far,  the discussion is really interesting and quite helpful, but I
> want to talk about the meta-programming *from the point of the view of
> implementation side,* features are easy to propose, but maybe only the
> compiler/library writers know how hard to implement, I do appreciate that
> you can sit dow and read the long email, I am also starting to blog(
> http://hongboz.wordpress.com/) about how to do syntactic meta programming
> (SMP) in a right way.
>    I rewrite the whole camlP4(named Fan) from scratch, building the
> quotation kit and throw away the crappy grammar parser, so plz believe me
> *that I do understand the whole technology stack of camlP4*, if we could
> reach some consensus, I would be happy to handle over the maintaining of
>  Fan, Fan does not loose any feature compared with camlP4, in fact it has
> more interesting featrues.
>
>    Let's begin with some easy, not too technical parts which has a
> significant effect on user experience though:
>    1. Performance
>           Performance does matter, it's a shame that  the most time spent
> in compiling the ocaml compiler is dedicated to camlP4, but it is an
> engineering problem, currently compiling Fan only takes less than 20s, and
> it can be improved further
>    2. Building issues
>         The design of having side effects by dynamic loading is
> generically a bad idea, in Fan* the dynamic loading only register some
> functionality the Fan support,* it *does not have any other side effec*t,
> each file stands alone says which (ppx , or filters, or syntax) it want to
> use with a good default option. so the building is always something like
> '-pp fan pluging1 plugin2 plugin3', *the order of pulgings does not matter
> *, also, l*oading all the plugins you have does not have any side effect,
> even better, you can do the static linking all the plugins you collected,
> the building process is simplified.  *
> * * 3. Grammar Extension (*Language namespace*)
> *       *I concur that grammar extension arbitrarily is a bad idea, and I
> agree with Gabrier that so far only the quotation(Here  quotation means
> delimited DSL, quosi-quotation means Lisp style macros) is modular,
> composable, and  I also agree with Gabrier -ppx* should not be used to do
> syntax overriding (this should not be called syntax extension actually), *that's
> a terrible idea to do syntax overriding, since the user never understand
> what's going on underly without reading the Makefile. So here some my
> suggestion is that some really conevenient syntax extesion, i.e, (let try..
> in) should be merged to the built in parser. quotations does not bring too
> much heavy syntax (imho). In Fan, we proposed the concept of a hierarchical
> language name space, since once quotation is heavily used, it's really easy
> to introduce conflict, *the language namespace querying is exactly like
> java package namespace,* you can import, close import to save some typing.
>     Here is a taste
>
>  -----------------------------------------------------------------------------------------------
>      {:.Fan.Lang.Meta.expr| a + b |} ------>
>       `App (`App ((`Id (`Lid "+")), (`Id (`Lid "a")))), (`Id (`Lid "b")))
>      {:.Fan.Lang.Meta.N.expr| a + b |}  ----->
>       `App
>     (_loc,
>       (`App
>          (_loc, (`Id (_loc, (`Lid (_loc, "+")))),
>            (`Id (_loc, (`Lid (_loc, "a")))))),
>       (`Id (_loc, (`Lid (_loc, "b")))))
>
>  -----------------------------------------------------------------------------------------------
>  the .Fan.Lang.Meta.expr the first '.' means it's from the absolute
> namespace,  the *N.expr shares exactly the same syntax without location*,
> though
>
>    4. Portable to diffierrent compiler extensions(like LexiFi's fork of
> ocaml)
>        I am pretty sure it's pretty easy to do in Fan, only Ast2pt
> (dumping the intemediate Ast into Parsetree) part need to be changed to
> diffierent compilers.
>
>
> ----------------------------------------------------------------------------------------------------------------
> Now let's talk about some internal parts of SMP.
> Quasi-Quotation is the essential part of SMP,  I am surprised so far that
> the discussion *silently ignores the quasi-quotation,* Leo's answer of
> writing   three parsers is neither satisfying nor practical(imho).
>
> Camlp4 is mainly composed of two parts, one is the extensible parser and *the
> other significant part is Ast Lifting*. Since we all agree that
> extensible parser increases the complexity too much, let's simply ignore
> that part.
>
> The Ast Lifting are tightly coupled *with the design of the Abstract
> Syntax Tree.*  People complain about that Camlp4 Ast is hard to learn and
> using quasi-quotation to do the pattern match is a bad idea.
>
> Let me explain the topic a bit:
>     Camlp4Ast is hard to learn, I agree, it has some alien names that
> nobody understand what it  means, quosi-quotation *is definitely a great
> idea* to boom the meta-programming, but my experience here is *for very
> very small Ast fragment, using the Abstract Syntax Tree directly,* otherwise
> Quasi-quotation is a life saver to do the meta programming.
>    Luckily the quotation kit has nothing to do with the parser part, it's
> simply several functions(I did some simplify a bit) which turns a normal
> runtime
> value into an Ast node generically, *such kind functions are neither easy
> to write nor easy to read*, *the idea case is that it should be generated
> once for all, and all the data types in normal ocaml* *should be derived
> automatically*(some ADT with functions can not be derived). *I bet it's
> mostly likely a nightmare if we maintain 3 parsers for the ocaml grammar
> while two other parsers dumping to a meta-level*
>
>    So, how to make Ast Lifting easier,
>         The first guideline is *"Don't mixing with records", *
> *         *Once you encoding AST with records, you have to encode the
> records in the meta level which increases the complexity without bringing
> any new features, *it's simply not worthwhile.*
> *
> *
> *       * The second guideline is "Don't do *any *syntax desugaring" ,
> syntax desguaring makes the semantics of syntax meta programming a bit
> weird. Syntax desguaring happens everywhere in Parsetree, think about the
> list literals, it uses the syntax desuaring, if you don't use any syntax
> desugaring, for example, you want to match the bigarray access, you simply
> needed to match `Bigarray(..)' instead of
>
> Pexp_apply
>         ({pexp_desc=Pexp_ident
>                      {txt= Ldot (Ldot (Lident "Bigarray", array),
> ("get"|"set" as gs)) ;_};_},
>          label_exprs)
> ----------------------------
>        The third guideline is to* *make it *as uniform as possible*
> *       *This not only helps the user, but *it helps the meta-programming
> over types to derive some utility types. *Take a look at my Ast encoding
> in Fan https://github.com/bobzhang/Fan/blob/master/src/Ast.ml (it needs
> to be polished, plz don't panic when you see variants I use here)
> *      *The initial Ast has locations and ant support, but* here we
> derive 3 other Asts thanks to my very regular design*.* AstN is the Ast
> without locations*, the locations are important, but it is simply not too
> much helpful when you only do the code generation, but it complicates the
> expanded code a lot), *AstA is the Ast without antiquotations(simply
> remove the ant branch), *it is a subtype of Ast(thanks to the choice we
> use variants here), *AstNA is the Ast without neither locations nor
> antiquotations*), it is a subtype of AstN.  *In practice, I found the Ast
> without locations is particular helpful when you only do the code
> generation, it simplifies this part significantly. The beautif**ul part
> is that  all the four Ast share the same grammar with the same
> quosiquotatoin mechanism, as I showed .Fan.Lang.N.expr and .Fan.Lang.expr*
>     I don't know how many parsers you have to maintain to reach such a
> goal or it's never going to happen.
>     Using variants to encode the intermediate ast has a lots of other
> benefits, but I don't want to cover it in such a short mail.
>
>    So,* my proposal is that the community design an Intermediate Ast
> together, and write a built-in parser to such Intermediate Ast then dump to
> Parsetree, but I am for that Parsetree still needs to be cleaned a bit but
> not too much change .  *I do appreciate you can take something away from
> Fan, I think the Parsetree is* not the ideal part* to do SMP, HTH
>
> --
> -- Regards, Hongbo
>



-- 
-- Regards, Hongbo

--f46d043c7c86e8414c04d4785767
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br>Quotations(Deliminated =A0DSL) works reasonably well instead of ppx, he=
re is my version of ulex in Fan(an improvement compared with ulex or sedlex=
 is t<b>hat it works well on toplevel</b>).<div><br></div><div><div>let rec=
 token enc =3D =A0{:lex|</div>
<div>=A0 =A0&quot;&lt;utf8&gt;&quot; -&gt; begin enc :=3D Ulexing.Utf8; tok=
en enc lexbuf end</div><div>=A0 | &quot;&lt;latin1&gt;&quot; -&gt; begin en=
c :=3D Ulexing.Latin1; token enc lexbuf end</div><div>=A0 | xml_letter+ -&g=
t; Printf.sprintf &quot;word(%s)&quot; (Ulexing.utf8_lexeme lexbuf)</div>
<div>=A0 | number -&gt; &quot;number&quot;</div><div>=A0 | eof -&gt; exit 0=
</div><div>=A0 | [1234-1246] -&gt; &quot;bla&quot;</div><div>=A0 | &quot;(&=
quot; -&gt; =A0begin</div><div>=A0 =A0 =A0 Ulexing.rollback lexbuf; (* Puts=
 the lexeme back into the buffer *)</div>
<div>=A0 =A0 =A0 {| &quot;(&quot; [^ &#39;(&#39;]* &quot;)&quot; -&gt; Ulex=
ing.utf8_lexeme lexbuf |} lexbuf</div><div>=A0 =A0 =A0 (* Note the use of a=
n inline lexer *)</div><div>=A0 end</div><div>=A0 | &quot;(*&quot; -&gt; be=
gin comment lexbuf; &quot;comment&quot; end</div>
<div>=A0 | &#39; &#39; -&gt; &quot;whitespace&quot;</div><div>=A0 | _ -&gt;=
 &quot;???&quot; |}</div><div>and comment =3D {:lex|</div><div>=A0 =A0&quot=
;*)&quot; -&gt; ()</div><div>=A0 | eof -&gt; failwith &quot;comment&quot;</=
div><div>
=A0 | _ -&gt; let _lexeme =3D Ulexing.lexeme lexbuf in</div><div>=A0 =A0 co=
mment lexbuf |}</div><div class=3D"gmail_quote">On Tue, Jan 29, 2013 at 2:0=
5 PM, Hongbo Zhang <span dir=3D"ltr">&lt;<a href=3D"mailto:hongboz@seas.upe=
nn.edu" target=3D"_blank">hongboz@seas.upenn.edu</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">Dear wg-camp4 users,<div><br></div><div>=A0 =
=A0 So far, =A0the discussion is really interesting and quite helpful, but =
I want to talk about the meta-programming <b>from the point of the view of =
implementation side,</b> features are easy to propose, but maybe only the c=
ompiler/library writers know how hard to implement, I do appreciate that yo=
u can sit dow and read the long email, I am also starting to blog(<a href=
=3D"http://hongboz.wordpress.com/" target=3D"_blank">http://hongboz.wordpre=
ss.com/</a>) about how to do syntactic meta programming (SMP) in a right wa=
y.</div>

<div>=A0 =A0I rewrite the whole camlP4(named Fan) from scratch, building th=
e quotation kit and throw away the crappy grammar parser, so plz believe me=
 <b>that I do understand the whole technology stack of camlP4</b>, if we co=
uld reach some consensus, I would be happy to handle over the maintaining o=
f =A0Fan, Fan does not loose any feature compared with camlP4, in fact it h=
as more interesting featrues.</div>

<div><br></div><div>=A0 =A0Let&#39;s begin with some easy, not too technica=
l parts which has a significant effect on user experience though:</div><div=
>=A0 =A01. Performance</div><div>=A0 =A0 =A0 =A0 =A0 Performance does matte=
r, it&#39;s a shame that =A0the most time spent in compiling the ocaml comp=
iler is dedicated to camlP4, but it is an engineering problem, currently co=
mpiling Fan only takes less than 20s, and it can be improved further</div>

<div>=A0 =A02. Building issues</div><div>=A0 =A0 =A0 =A0 The design of havi=
ng side effects by dynamic loading is generically a bad idea, in Fan<b> the=
 dynamic loading only register some functionality the Fan support,</b> it <=
b>does not have any other side effec</b>t, each file stands alone says whic=
h (ppx , or filters, or syntax) it want to use with a good default option. =
so the building is always something like &#39;-pp fan pluging1 plugin2 plug=
in3&#39;, <b>the order of pulgings does not matter</b>, also, l<b>oading al=
l the plugins you have does not have any side effect, even better, you can =
do the static linking all the plugins you collected, the building process i=
s simplified. =A0</b></div>

<div><b>=A0</b> 3. Grammar Extension (<b>Language namespace</b>)</div><div>=
<b>=A0 =A0 =A0 =A0</b>I concur that grammar extension arbitrarily is a bad =
idea, and I agree with Gabrier that so far only the quotation(Here =A0quota=
tion means delimited DSL, quosi-quotation means Lisp style macros) is modul=
ar, composable, and =A0I also agree with Gabrier -ppx<b> should not be used=
 to do syntax overriding (this should not be called syntax extension actual=
ly), </b>that&#39;s a terrible idea to do syntax overriding, since the user=
 never understand what&#39;s going on underly without reading the Makefile.=
 So here some my suggestion is that some really conevenient syntax extesion=
, i.e, (let try.. in) should be merged to the built in parser. quotations d=
oes not bring too much heavy syntax (imho). In Fan, we proposed the concept=
 of a hierarchical language name space, since once quotation is heavily use=
d, it&#39;s really easy to introduce conflict, <b>the language namespace qu=
erying is exactly like java package namespace,</b> you can import, close im=
port to save some typing.</div>

<div>=A0 =A0 Here is a taste</div><div>=A0 =A0-----------------------------=
------------------------------------------------------------------</div><di=
v>=A0 =A0 =A0{:.Fan.Lang.Meta.expr| a + b |} ------&gt;=A0</div><div>=A0 =
=A0 =A0=A0<span style=3D"color:rgb(34,34,34);font-size:12.800000190734863px=
;font-family:arial,sans-serif">`App (`App ((`Id (`Lid &quot;+&quot;)), (`Id=
 (`Lid &quot;a&quot;)))), (`Id (`Lid &quot;b&quot;)))</span></div>

<div>=A0 =A0 =A0{:.Fan.Lang.Meta.N.expr| a + b |} =A0-----&gt;</div><div>=
=A0 =A0 =A0=A0<span style=3D"color:rgb(34,34,34);font-size:12.8000001907348=
63px;font-family:arial,sans-serif">`App</span></div><div style=3D"color:rgb=
(34,34,34);font-size:12.800000190734863px;font-family:arial,sans-serif">

=A0 =A0 (_loc,</div><div style=3D"color:rgb(34,34,34);font-size:12.80000019=
0734863px;font-family:arial,sans-serif">=A0 =A0 =A0 (`App</div><div style=
=3D"color:rgb(34,34,34);font-size:12.800000190734863px;font-family:arial,sa=
ns-serif">
=A0 =A0 =A0 =A0 =A0(_loc, (`Id (_loc, (`Lid (_loc, &quot;+&quot;)))),</div>=
<div style=3D"color:rgb(34,34,34);font-size:12.800000190734863px;font-famil=
y:arial,sans-serif">=A0 =A0 =A0 =A0 =A0 =A0(`Id (_loc, (`Lid (_loc, &quot;a=
&quot;)))))),</div>

<div><span style=3D"color:rgb(34,34,34);font-size:12.800000190734863px;font=
-family:arial,sans-serif">=A0 =A0 =A0 (`Id (_loc, (`Lid (_loc, &quot;b&quot=
;)))))</span>=A0</div><div><div>=A0----------------------------------------=
-------------------------------------------------------</div>

<div>=A0the .Fan.Lang.Meta.expr the first &#39;.&#39; means it&#39;s from t=
he absolute namespace, =A0the=A0<b>N.expr shares exactly the same syntax wi=
thout location</b>, though</div></div><div><br></div><div>=A0 =A04. Portabl=
e to diffierrent compiler extensions(like LexiFi&#39;s fork of ocaml)</div>

<div>=A0 =A0 =A0 =A0I am pretty sure it&#39;s pretty easy to do in Fan, onl=
y Ast2pt (dumping the intemediate Ast into Parsetree) part need to be chang=
ed to diffierent compilers.<br clear=3D"all"><div><br></div><div>----------=
---------------------------------------------------------------------------=
---------------------------</div>

<div>Now let&#39;s talk about some internal parts of SMP.</div><div>Quasi-Q=
uotation is the essential part of SMP, =A0I am surprised so far that the di=
scussion <b>silently ignores the quasi-quotation,</b> Leo&#39;s answer of w=
riting =A0 three parsers is neither satisfying nor practical(imho).=A0</div=
>

<div><br></div><div>Camlp4 is mainly composed of two parts, one is the exte=
nsible parser and <b>the other significant part is Ast Lifting</b>. Since w=
e all agree that extensible parser increases the complexity too much, let&#=
39;s simply ignore that part.</div>

<div><br></div><div>The Ast Lifting are tightly coupled <b>with the design =
of the Abstract Syntax Tree.</b>=A0 People complain about that Camlp4 Ast i=
s hard to learn and using quasi-quotation to do the pattern match is a bad =
idea.</div>

<div><br></div><div>Let me explain the topic a bit:</div><div>=A0 =A0 Camlp=
4Ast is hard to learn, I agree, it has some alien names that nobody underst=
and what it =A0means, quosi-quotation <b>is definitely a great idea</b> to =
boom the meta-programming, but my experience here is <b>for very very small=
 Ast fragment, using the Abstract Syntax Tree directly,</b>=A0otherwise Qua=
si-quotation is a life saver to do the meta programming.</div>

<div>=A0 =A0Luckily the quotation kit has nothing to do with the parser par=
t, it&#39;s simply several functions(I did some simplify a bit) which turns=
 a normal runtime =A0</div><div>value into an Ast node generically, <b>such=
 kind functions are neither easy to write nor easy to read</b>, <b>the idea=
 case is that it should be generated once for all, and all the data types i=
n normal ocaml</b> <b>should be derived automatically</b>(some ADT with fun=
ctions can not be derived). <b>I bet it&#39;s mostly likely a nightmare if =
we maintain 3 parsers for the ocaml grammar while two other parsers dumping=
 to a meta-level</b></div>

<div>=A0=A0</div><div>=A0 =A0So, how to make Ast Lifting easier,=A0</div><d=
iv>=A0 =A0 =A0 =A0 The first guideline is <b>&quot;Don&#39;t mixing with re=
cords&quot;,=A0</b></div><div><b>=A0 =A0 =A0 =A0 =A0</b>Once you encoding A=
ST with records, you have to encode the records in the meta level which inc=
reases the complexity without bringing any new features, <b>it&#39;s simply=
 not worthwhile.</b></div>

<div><b><br></b></div><div><b>=A0 =A0 =A0 =A0</b>=A0The second guideline is=
 &quot;Don&#39;t do <b>any </b>syntax desugaring&quot; , syntax desguaring =
makes the semantics of syntax meta programming a bit weird. Syntax desguari=
ng happens everywhere in Parsetree, think about the list literals, it uses =
the syntax desuaring, if you don&#39;t use any syntax desugaring, for examp=
le, you want to match the bigarray access, you simply needed to match `Biga=
rray(..)&#39; instead of=A0</div>

<div><div><br></div><div>Pexp_apply</div><div>=A0 =A0 =A0 =A0 ({pexp_desc=
=3DPexp_ident</div><div>=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0{txt=3D =
Ldot (Ldot (Lident &quot;Bigarray&quot;, array), (&quot;get&quot;|&quot;set=
&quot; as gs)) ;_};_},</div><div>

=A0 =A0 =A0 =A0 =A0label_exprs)</div></div><div>---------------------------=
-</div><div>=A0 =A0 =A0 =A0The third guideline is to<b> </b>make it <b>as u=
niform as possible</b></div><div><b>=A0 =A0 =A0 =A0</b>This not only helps =
the user, but <b>it helps the meta-programming over types to derive some ut=
ility types. </b>Take a look at my Ast encoding in Fan=A0<a href=3D"https:/=
/github.com/bobzhang/Fan/blob/master/src/Ast.ml" target=3D"_blank">https://=
github.com/bobzhang/Fan/blob/master/src/Ast.ml</a> (it needs to be polished=
, plz don&#39;t panic when you see variants I use here)</div>

<div><b>=A0 =A0 =A0 </b>The initial Ast has locations and ant support, but<=
b> here we derive 3 other Asts thanks to my very regular design</b>.<b> Ast=
N is the Ast without locations</b>, the locations are important, but it is =
simply not too much helpful when you only do the code generation, but it co=
mplicates the expanded code a lot), <b>AstA is the Ast without antiquotatio=
ns(simply remove the ant branch), </b>it is a subtype of Ast(thanks to the =
choice we use variants here), <b>AstNA is the Ast without neither locations=
 nor antiquotations</b>), it is a subtype of AstN. =A0<b>In practice, I fou=
nd the Ast without locations is particular helpful when you only do the cod=
e generation, it simplifies this part significantly.<i><u> The beautif</u><=
/i></b><u><b><i>u</i></b><i style=3D"font-weight:bold">l part is that =A0al=
l the four Ast share the same grammar with the same quosiquotatoin mechanis=
m, as I showed .Fan.Lang.N.expr and .Fan.Lang.expr</i></u></div>

<div>=A0 =A0 I don&#39;t know how many parsers you have to maintain to reac=
h such a goal or it&#39;s never going to happen.</div><div>=A0 =A0 Using va=
riants to encode the intermediate ast has a lots of other benefits, but I d=
on&#39;t want to cover it in such a short mail.</div>

<div><br></div><div>=A0 =A0So,<b> my proposal is that the community design =
an Intermediate Ast together, and write a built-in parser to such Intermedi=
ate Ast then dump to Parsetree, but I am for that Parsetree still needs to =
be cleaned a bit but not too much change . =A0</b>I do appreciate you can t=
ake something away from Fan, I think the Parsetree is<b> not the ideal part=
</b> to do SMP, HTH</div>
<span class=3D"HOEnZb"><font color=3D"#888888">
<div><div><br></div>-- <br>-- Regards, Hongbo

</div></font></span></div>
</blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regards, =
Hongbo
</div>

--f46d043c7c86e8414c04d4785767--

From alain@frisch.fr  Wed Jan 30 06:13:11 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9C0FD3C05E
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 06:13:11 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:41067)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0QzH-0004ys-s9 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 06:17:36 +0000
Received: from [192.168.0.11] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 25501A622A;
 Wed, 30 Jan 2013 07:17:30 +0100 (CET)
Message-ID: <5108BAFA.5020206@frisch.fr>
Date: Wed, 30 Jan 2013 07:17:30 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
 <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
 <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
In-Reply-To: <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 06:13:11 -0000

On 1/29/2013 7:53 PM, Gabriel Scherer wrote:
> I'm not sure the idea of having "postfix" and "prefix" annotations
> makes sense for all grammar rules (and mixing them with a modality of
> "external or ocaml-syntax" feels like conflating separate concerns).

I agree.  If we have a syntax for embedding arbitrary syntax (basically, 
a new kind of string literals in expressions and patterns, with 
adifferent lexing rules, and rejected by the type-checker), let's say {{ 
... }}, we could use it either as a stand-alone expression

  {{ ... }}

or as an attribute on another expression:

  (@{{ ... }}) e

So I don't think we need to provide parsed and non-parsed variants of 
attributes.

What makes sense is maybe to distinguish attributes which can be dropped 
silently by the compiler (but used by other tools like ocamldoc, for 
instance) and those on which the type-checker needs to fail.  This is 
not strictly necessary if we already have a new kind of expressions on 
which the type-checkers fail, and it does not really bring much security 
because the user could easily use the other syntax of attributes and get 
(probably) simply a type error instead of a "remaining attribute" error.


> I'd rather consider where annotation may happen for grammar rules
> individually. For example, in the case of "let p = e1 in e2", I'm
> quite sure we may want to annotate either the whole expression or
> specifically the declaration, and while I see how prefix and postfix
> both make sense for the whole expression, I'm not sure they would both
> make sense to annotate the binding, and considering only those cases
> could lead them to being dropped.


>
> Still in this case 'let p = e1 in e2', how should we distinguish:
> - an annotation on the expressions 'e1' and 'e2'
> - an annotation on the pattern 'p' (possibly seen as an expressions)
> - an annotation on the binding itself
> - an annotation on the expression as a whole?

We need of course to define priority rules, but I don't see why postfix 
and prefix couldn't make sense for all constructions (maybe with some 
more parentheses):

On the whole expression:
  (@ ..) (let p = e1 in e2)
  (let p = e1 in e2) (% ..)

On the pattern:
  let (@ ..) p = e1 in e2
  let p (% ..) = e1 in e2

On e1:
  let p = (@ ..) e1 in e2
  let p = e1 (% ..) in e2

On e2:
  let p = e1 in (@ ..) e2
  let p = e1 in e2 (% ..)

What's missing is maybe the ability to annotate either the binding 
itself as opposed to the whole expression (more interesting when the 
whole expression has multiple bindings: let p1 = e1 and p2 = e2 and 
...).  But is that really necessary?  One can always use the convention 
that an annotation on the binding would actually need to be put at the 
toplevel of the pattern itself.



Alain

From gabriel.scherer@gmail.com  Wed Jan 30 06:27:33 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E29913C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 06:27:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439791 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.178 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f178.google.com ([209.85.128.178]:44051)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0RDC-0007g0-QR (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Wed, 30 Jan 2013 06:31:58 +0000
Received: by mail-ve0-f178.google.com with SMTP id db10so885604veb.9
 for <wg-camlp4@lists.ocaml.org>; Tue, 29 Jan 2013 22:31:57 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=fiy9u3zP1vI7SDlIGFJfiEA1kP+o1Xd2rTiJrLEuys4=;
 b=Mix7gScxd6Hvpa8lwro3gg1iZTHCvZF+92ke5b3nB7NmkIS0W0wSLD/LEqzlInYYz5
 636zddQrT6120QozwOm4umWkRNqHmOm2orlA4qogUNBJxBeLNvRwasxRVw+wTl7Bd3C3
 Gn87X7DCHtnrGA2TAZSgvrasL+/DFljxUmVXkiuQWjFSjxtpPpospt8n3fEQ7nbizPVr
 egYcjo7hK7OQLe06Vr+ZGSZ4pLnxweB8Zwakz/+tbxp517lxOxcM642ifxXBf9ldzoQY
 8mTM3CchfvXH5n3cZvi8JX1+vRhOx1j3cTS5KBSRfJRjulfiN37oaZSrsxkiR0LCStAf
 Jfzg==
X-Received: by 10.52.89.242 with SMTP id br18mr3491444vdb.22.1359527517576;
 Tue, 29 Jan 2013 22:31:57 -0800 (PST)
MIME-Version: 1.0
Received: by 10.58.190.202 with HTTP; Tue, 29 Jan 2013 22:31:17 -0800 (PST)
In-Reply-To: <5108BAFA.5020206@frisch.fr>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
 <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
 <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
 <5108BAFA.5020206@frisch.fr>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Wed, 30 Jan 2013 07:31:17 +0100
Message-ID: <CAPFanBE+X=M3C+CHWq024zAFLEHnrp1hDT-FNLv3aJN8LontVw@mail.gmail.com>
To: Alain Frisch <alain@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 06:27:34 -0000

> What's missing is maybe the ability to annotate either the binding itself as
> opposed to the whole expression (more interesting when the whole expression
> has multiple bindings: let p1 = e1 and p2 = e2 and ...).  But is that really
> necessary?  One can always use the convention that an annotation on the
> binding would actually need to be put at the toplevel of the pattern itself.

My understanding is that this is precisely what type-conv does:
annotate the type declaration itself, rather than the type expression
or the whole phrase. I'm not sure what kind of annotations are being
considered here, but a pragma-style @ignore_unused_variable for
example should be bound to the declaration itself. Finally, using a
convention to annotate the pattern may give rise to critical pairs /
ambiguities where the semantics of the program depends of whether we
consider the annotation to cover the pattern or the declaration (for
annotations that make sense in both, eg. @profile).

On Wed, Jan 30, 2013 at 7:17 AM, Alain Frisch <alain@frisch.fr> wrote:
> On 1/29/2013 7:53 PM, Gabriel Scherer wrote:
>>
>> I'm not sure the idea of having "postfix" and "prefix" annotations
>> makes sense for all grammar rules (and mixing them with a modality of
>> "external or ocaml-syntax" feels like conflating separate concerns).
>
>
> I agree.  If we have a syntax for embedding arbitrary syntax (basically, a
> new kind of string literals in expressions and patterns, with adifferent
> lexing rules, and rejected by the type-checker), let's say {{ ... }}, we
> could use it either as a stand-alone expression
>
>  {{ ... }}
>
> or as an attribute on another expression:
>
>  (@{{ ... }}) e
>
> So I don't think we need to provide parsed and non-parsed variants of
> attributes.
>
> What makes sense is maybe to distinguish attributes which can be dropped
> silently by the compiler (but used by other tools like ocamldoc, for
> instance) and those on which the type-checker needs to fail.  This is not
> strictly necessary if we already have a new kind of expressions on which the
> type-checkers fail, and it does not really bring much security because the
> user could easily use the other syntax of attributes and get (probably)
> simply a type error instead of a "remaining attribute" error.
>
>
>
>> I'd rather consider where annotation may happen for grammar rules
>> individually. For example, in the case of "let p = e1 in e2", I'm
>> quite sure we may want to annotate either the whole expression or
>> specifically the declaration, and while I see how prefix and postfix
>> both make sense for the whole expression, I'm not sure they would both
>> make sense to annotate the binding, and considering only those cases
>> could lead them to being dropped.
>
>
>
>>
>> Still in this case 'let p = e1 in e2', how should we distinguish:
>> - an annotation on the expressions 'e1' and 'e2'
>> - an annotation on the pattern 'p' (possibly seen as an expressions)
>> - an annotation on the binding itself
>> - an annotation on the expression as a whole?
>
>
> We need of course to define priority rules, but I don't see why postfix and
> prefix couldn't make sense for all constructions (maybe with some more
> parentheses):
>
> On the whole expression:
>  (@ ..) (let p = e1 in e2)
>  (let p = e1 in e2) (% ..)
>
> On the pattern:
>  let (@ ..) p = e1 in e2
>  let p (% ..) = e1 in e2
>
> On e1:
>  let p = (@ ..) e1 in e2
>  let p = e1 (% ..) in e2
>
> On e2:
>  let p = e1 in (@ ..) e2
>  let p = e1 in e2 (% ..)
>
> What's missing is maybe the ability to annotate either the binding itself as
> opposed to the whole expression (more interesting when the whole expression
> has multiple bindings: let p1 = e1 and p2 = e2 and ...).  But is that really
> necessary?  One can always use the convention that an annotation on the
> binding would actually need to be put at the toplevel of the pattern itself.
>
>
>
> Alain

From alain@frisch.fr  Wed Jan 30 08:28:40 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0832D3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 08:28:40 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:58816
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0T6O-0000fm-SG (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 08:33:05 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d18 with ME
 id u8Z21k01g3lHbAL038Z2Cz; Wed, 30 Jan 2013 09:33:04 +0100
Message-ID: <5108DABE.9020601@frisch.fr>
Date: Wed, 30 Jan 2013 09:33:02 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
 <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
 <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
 <5108BAFA.5020206@frisch.fr>
 <CAPFanBE+X=M3C+CHWq024zAFLEHnrp1hDT-FNLv3aJN8LontVw@mail.gmail.com>
In-Reply-To: <CAPFanBE+X=M3C+CHWq024zAFLEHnrp1hDT-FNLv3aJN8LontVw@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 08:28:40 -0000

On 01/30/2013 07:31 AM, Gabriel Scherer wrote:
> My understanding is that this is precisely what type-conv does:
> annotate the type declaration itself, rather than the type expression
> or the whole phrase.

I agree it make sense to allow attaching attributes to various syntactic 
constructions, including those which are not "algebra", and type 
declaration are a good candidate for that.  Note that when I proposed 
attributes, I wrote:

> I propose to start discussing the addition of attributes to most syntactic categories (expressions, type expressions, patterns, type declarations, module expressions, structure/signature items, etc).

I'm not sure we need to allow attributes on specific parts of expression 
kinds (e.g. annotate the "for" itself, or each binding in a "let"). I'm 
not fundamentally opposed to it, but it will add a lot of complexity to 
the Parsetree with no obvious benefit.  This probably needs to be 
discussed on a case-by-case basis.

> Finally, using a
> convention to annotate the pattern may give rise to critical pairs /
> ambiguities where the semantics of the program depends of whether we
> consider the annotation to cover the pattern or the declaration (for
> annotations that make sense in both, eg. @profile).

Yes, but it does not seem difficult to have a different convention for 
something related to the pattern itself and something related to the 
binding, if the same general notion need to apply to both.

Alain

From lpw25@hermes.cam.ac.uk  Wed Jan 30 08:32:22 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BFAE83C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 08:32:22 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:57811)
 by ppsw-43.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0T9z-0008Tz-p4 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 08:36:47 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0T9z-0005Ss-QM (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 08:36:47 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 30 Jan 2013 08:36:47 +0000
Date: 30 Jan 2013 08:36:47 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301300836470.10317@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5108BAFA.5020206@frisch.fr>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
 <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
 <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
 <5108BAFA.5020206@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 08:32:22 -0000

>What makes sense is maybe to distinguish attributes which can be dropped 
>silently by the compiler (but used by other tools like ocamldoc, for 
>instance) and those on which the type-checker needs to fail.  This is 
>not strictly necessary if we already have a new kind of expressions on 
>which the type-checkers fail, and it does not really bring much security 
>because the user could easily use the other syntax of attributes and get 
>(probably) simply a type error instead of a "remaining attribute" error.

An extension could only support {: foo } style attributes (the ones that 
the type-checker fails on), so then there would be no risk of a typo or 
missed ppx option causing a silent fail or an unhelpful error message.

I also think that it will make it easy to read code: If you see {: ... } 
then that will be translated into an expression/patter/..., if you see {% 
... } then you know that the expression it is attached to will be 
translated.

For instance, "foo bar {: ... }" means that foo will be called with bar and 
whatever that attribute becomes as arguments. "foo bar {% ... }" means that 
foo and bar are going to be translated in some way.

And since we're probably supporting <: ... >, I see no harm in supporting 
<% ... > as well, especially if we support {: ... } and {% ... } (or (: ... 
) and (% ... ) if you prefer).


From alain@frisch.fr  Wed Jan 30 09:07:39 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 740FC3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 09:07:39 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:56543
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0Ti8-00067s-qQ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 09:12:04 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d18 with ME
 id u9C31k00B3lHbAL039C3Kk; Wed, 30 Jan 2013 10:12:03 +0100
Message-ID: <5108E3E3.307@frisch.fr>
Date: Wed, 30 Jan 2013 10:12:03 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
In-Reply-To: <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 09:07:39 -0000

On 01/30/2013 03:34 AM, Hongbo Zhang wrote:
> let rec token enc =  {:lex|
>     "<utf8>" -> begin enc := Ulexing.Utf8; token enc lexbuf end
>    | "<latin1>" -> begin enc := Ulexing.Latin1; token enc lexbuf end
>    | xml_letter+ -> Printf.sprintf "word(%s)" (Ulexing.utf8_lexeme lexbuf)
>    | number -> "number"
>    | eof -> exit 0
>    | [1234-1246] -> "bla"
>    | "(" ->  begin
>        Ulexing.rollback lexbuf; (* Puts the lexeme back into the buffer *)
>        {| "(" [^ '(']* ")" -> Ulexing.utf8_lexeme lexbuf |} lexbuf
>        (* Note the use of an inline lexer *)
>    end
>    | "(*" -> begin comment lexbuf; "comment" end
>    | ' ' -> "whitespace"
>    | _ -> "???" |}
> and comment = {:lex|
>     "*)" -> ()
>    | eof -> failwith "comment"
>    | _ -> let _lexeme = Ulexing.lexeme lexbuf in
>      comment lexbuf |}

This looks very bad to me:

1. You loose all support from your editor (indentation, coloring, 
parentheses matching).  Am I the only one who finds this really 
problematic?  With quotations, my emacs looks like notepad... 
Indentation and coloring do find typos on the fly; automatic indentation 
makes it easy to copy/paste code from one context to another one.

2. Quotation "with OCaml code in them" does not combine well with other 
AST rewriters.  If you have a -ppx filter implementing, say, macro 
expansion (in patterns and expressions), would you apply it before or 
after the one expanding the {:lex| ... |} quotations?  Probably both. 
(And won't be able to benefit of macro on patterns for the "regexps".)

3. How do you implement the expander?  Somehow, you need to parse the 
content of the quotation (stored as a string in the AST), which involves 
non trivial stuff, like a parser being able to parse OCaml code mixed 
with something else.  Personally, I don't know how to implement the 
quotation expander with the parsing technologies I'm familiar with.


For me quotations (in position of expression) are useful only for one 
thing: escape from the lexical conventions of OCaml string literals. 
Otherwise, strings are just fine.  There are very few cases where with 
actually matters.  A decent example might be something like Pa_tyxml, 
allowing to write XML code in XML syntax within OCaml sources.  But even 
there, I'm not absolutely sure that quotations are the best solution: 
would it really be so bad to use normal OCaml strings (with an attribute):

   (@xml)"<div>xyz</div>"

or OCaml syntax interpreted specially:

   (@xml)(div "xyz")

instead of the current:

  <:html5< <div>xyz</div> >>


But maybe for some cases (embedding a language with a lot of double 
quoted and backslashes), escaping from the lexical conventions of OCaml 
string literals might really be useful.  This could be actually be the 
case for standard string literals, with no special syntactic processing. 
  So why not simply address this need by allowing an alternative syntax 
for string literals, where no special character is interpreted?  The 
opening delimiter would define the closing delimiter.  For instance:

   {xxx{ ..... }xxx}

(here I've assumed that { } are hard-coded, but xxx could be replaced 
say, by any sequence of identifier/digit/operator characters). In the 
AST, this could be represented as a normal string literal (or maybe we 
should keep the "xxx" annotation, to avoid having to put an extra 
attribute in front of the literal).


I've yet to be convinced that quotations really have other interesting 
uses than escaping from lexical conventions of OCaml string literals...


Alain

From alain@frisch.fr  Wed Jan 30 09:19:34 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 496063C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 09:19:34 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:57378
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0Tte-0001Px-oU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 09:23:59 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d18 with ME
 id u9Py1k0073lHbAL039PyUq; Wed, 30 Jan 2013 10:23:58 +0100
Message-ID: <5108E6AD.7030508@frisch.fr>
Date: Wed, 30 Jan 2013 10:23:57 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
 <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
 <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
 <5108BAFA.5020206@frisch.fr>
 <Prayer.1.3.5.1301300836470.10317@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301300836470.10317@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 09:19:34 -0000

On 01/30/2013 09:36 AM, Leo White wrote:
> An extension could only support {: foo } style attributes (the ones that
> the type-checker fails on), so then there would be no risk of a typo or
> missed ppx option causing a silent fail or an unhelpful error message.

The risk is that the user writes {@ foo} instead of {@ foo}.  This does 
not sound much less probable than the user writing {@ foox} instead of 
{: foo}.  But I will not fight against non-ignorable attributes!

> For instance, "foo bar {: ... }" means that foo will be called with bar
> and whatever that attribute becomes as arguments.

This was not my understanding.  You seem to imply that {: ... } here is 
not really a (postfix) attribute on the expression "foo bar", but that 
it is a stand-alone expression.  So actually, it is not attached on 
anything, it is not an attribute. I'd rather write it:

   foo bar ((@marker) e)

where the @marker attribute is to be detected by the "expander" and e is 
its argument.  If we want to make it clear that "e" will be interpreted 
in a non-trivial way and that (@marker) must be treated (and otherwise 
the type-checker should complain by mentioning it explicitly), we could 
write:

  foo bar ((:marker) e)

(Assuming now that (:...) is in prefix position.)


Alain

From xavier.clerc@inria.fr  Wed Jan 30 09:25:46 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 54F543C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 09:25:46 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.5 from SpamAssassin-3.3.2-1439791 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.83 listed in list.dnswl.dnsbl.ja.net]
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail2-relais-roc.national.inria.fr ([192.134.164.83]:47236)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0Tze-0005wo-Qa (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Wed, 30 Jan 2013 09:30:11 +0000
X-IronPort-AV: E=Sophos;i="4.84,566,1355094000"; 
   d="scan'208";a="608668"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail2-relais-roc.national.inria.fr with ESMTP; 30 Jan 2013 10:30:09 +0100
Date: Wed, 30 Jan 2013 10:27:52 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <1725284723.1172415.1359538069788.JavaMail.root@inria.fr>
In-Reply-To: <5108DABE.9020601@frisch.fr>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [81.194.27.158]
X-Mailer: Zimbra 7.2.0_GA_2669 (ZimbraWebClient - SAF3 (Mac)/7.2.0_GA_2669)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 09:25:46 -0000

----- Mail original -----
> On 01/30/2013 07:31 AM, Gabriel Scherer wrote:
> > My understanding is that this is precisely what type-conv does:
> > annotate the type declaration itself, rather than the type
> > expression
> > or the whole phrase.
> 
> I agree it make sense to allow attaching attributes to various
> syntactic
> constructions, including those which are not "algebra", and type
> declaration are a good candidate for that.  Note that when I proposed
> attributes, I wrote:
> 
> > I propose to start discussing the addition of attributes to most
> > syntactic categories (expressions, type expressions, patterns,
> > type declarations, module expressions, structure/signature items,
> > etc).
> 
> I'm not sure we need to allow attributes on specific parts of
> expression
> kinds (e.g. annotate the "for" itself, or each binding in a "let").
> I'm
> not fundamentally opposed to it, but it will add a lot of complexity
> to
> the Parsetree with no obvious benefit.  This probably needs to be
> discussed on a case-by-case basis.

I have several questions related to attributes, regardless of their
actual syntax. The questions stem from my limited knowledge of their
Java equivalent.

1- should attributes be declared before use ? and if so, should the
contents of attributes be typed? To be concrete, in Java, you are
allowed to annotate something with "@MyAnnot(a=1, b="two")" iff
"MyAnnot" has been declared with fields "a" (of type "int") and "b"
(of type "string").

2- if you declare attributes before use, would it be desirable to
be able to select which syntactic constructs they can annotate ?
To be concrete, you might decide that a "@profile" attribute can
be used with expressions, but not with types.

3- should annotations be stored (e. g. in cmi/cmo/cmx files) in
order for an attribute processor to be able to access attributes
of other modules ?


Personally, I think that declaring attributes with their fields
and types is pretty useful. This protects the user from some
typos and other obvious errors, and avoid boiler-plate code in
the attribute processors.

Do list readers have strong opinions on these questions ?


Xavier Clerc

From lpw25@hermes.cam.ac.uk  Wed Jan 30 09:27:26 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C53F83C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 09:27:26 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:44072)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0U1H-000737-RZ (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 09:31:51 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0U1H-0003fr-Gp (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 09:31:51 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 30 Jan 2013 09:31:51 +0000
Date: 30 Jan 2013 09:31:51 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5108E3E3.307@frisch.fr>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 09:27:26 -0000

I don't really see the difference between:

>   {xxx{ ..... }xxx}

and

>  <:html5< <div>xyz</div> >>

except that the second one forces you to name your quotation which is 
definitely a good thing. It also makes it much easier in the future to add 
something like Fabrice's Templates.

In fact, I would be tempted to suggest that anything like {: ... } might 
also require a name (not for {% ... } as I can think of cases where this 
would be too restrictive).


From lpw25@hermes.cam.ac.uk  Wed Jan 30 09:35:44 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 18FDD3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 09:35:44 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:33826)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0U9I-0000qR-ZQ (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 09:40:09 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0U9I-0004ks-V2 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 09:40:08 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 30 Jan 2013 09:40:08 +0000
Date: 30 Jan 2013 09:40:08 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301300940080.9358@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5108E6AD.7030508@frisch.fr>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
 <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
 <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
 <5108BAFA.5020206@frisch.fr>
 <Prayer.1.3.5.1301300836470.10317@hermes-1.csi.cam.ac.uk>
 <5108E6AD.7030508@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 09:35:44 -0000

>This was not my understanding.  You seem to imply that {: ... } here is 
>not really a (postfix) attribute on the expression "foo bar", but that 
>it is a stand-alone expression.  

Yes, that is the idea. It is also why they must be non-ignorable.

> So actually, it is not attached on 
>anything, it is not an attribute. 

Indeed, but for lack of a better word I'll stick with attribute.

> I'd rather write it:
>
>   foo bar ((@marker) e)

I would prefer it to have its own syntax, because I would like to encourage 
its use. I think that it is easier to read than a normal attribute because 
it clearly declares its scope, and since it cannot be ignored it is also 
safer. I would also like this syntax to be similar to <: ... > since they 
have similar uses.


From alain@frisch.fr  Wed Jan 30 09:40:05 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6DC043C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 09:40:05 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:40587
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0UDW-0002LL-nr (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 09:44:30 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d18 with ME
 id u9kV1k00Y3lHbAL039kV1q; Wed, 30 Jan 2013 10:44:30 +0100
Message-ID: <5108EB7D.2090701@frisch.fr>
Date: Wed, 30 Jan 2013 10:44:29 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Xavier Clerc <xavier.clerc@inria.fr>
References: <1725284723.1172415.1359538069788.JavaMail.root@inria.fr>
In-Reply-To: <1725284723.1172415.1359538069788.JavaMail.root@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 09:40:05 -0000

On 01/30/2013 10:27 AM, Xavier Clerc wrote:
> Personally, I think that declaring attributes with their fields
> and types is pretty useful.

I don't see how to do that without introducing a lot of complexity in 
the system.  Do you mean we should run the OCaml type-checker on 
attribute arguments before they are processed?  Or that we should 
restrict attribute arguments to be pure constant data (records, 
constructors, literals)?  This seems overly restrictive.  It make sense 
to allow full expressions within attributes (e.g. some uses of type-conv 
requires to annotate types with functions), and I don't see how to 
type-check that.


> This protects the user from some
> typos and other obvious errors, and avoid boiler-plate code in
> the attribute processors.

I don't expect a lot of tedious boiler-plate code in the processors 
(OCaml is not so bad at pattern matching, after all) if they need to 
check some "constraints" on their arguments (not really type-checking, 
but rather checking simple things like the fact that they come with a 
string literal argument).


Alain

From xavier.clerc@inria.fr  Wed Jan 30 10:04:59 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 021E63C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 10:04:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.5 from SpamAssassin-3.3.2-1439791 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:45949)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0Ubb-00005B-Sw (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Wed, 30 Jan 2013 10:09:24 +0000
X-IronPort-AV: E=Sophos;i="4.84,567,1355094000"; 
   d="scan'208";a="473435"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail3-relais-sop.national.inria.fr with ESMTP; 30 Jan 2013 11:08:43 +0100
Date: Wed, 30 Jan 2013 11:09:21 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <876180034.10800.1359540560709.JavaMail.root@inria.fr>
In-Reply-To: <5108DABE.9020601@frisch.fr>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [81.194.27.158]
X-Mailer: Zimbra 7.2.0_GA_2669 (ZimbraWebClient - SAF3 (Mac)/7.2.0_GA_2669)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 10:04:59 -0000



----- Mail original -----
> On 01/30/2013 07:31 AM, Gabriel Scherer wrote:
> > My understanding is that this is precisely what type-conv does:
> > annotate the type declaration itself, rather than the type
> > expression
> > or the whole phrase.
> 
> I agree it make sense to allow attaching attributes to various
> syntactic
> constructions, including those which are not "algebra", and type
> declaration are a good candidate for that.  Note that when I proposed
> attributes, I wrote:
> 
> > I propose to start discussing the addition of attributes to most
> > syntactic categories (expressions, type expressions, patterns,
> > type declarations, module expressions, structure/signature items,
> > etc).
> 
> I'm not sure we need to allow attributes on specific parts of
> expression
> kinds (e.g. annotate the "for" itself, or each binding in a "let").
> I'm
> not fundamentally opposed to it, but it will add a lot of complexity
> to
> the Parsetree with no obvious benefit.  This probably needs to be
> discussed on a case-by-case basis.

I have several questions related to attributes, regardless of their
actual syntax. The questions stem from my limited knowledge of their
Java equivalent.

1- should attributes be declared before use ? and if so, should the
contents of attributes be typed? To be concrete, in Java, you are
allowed to annotate something with "@MyAnnot(a=1, b="two")" iff
"MyAnnot" has been declared with fields "a" (of type "int") and "b"
(of type "string").

2- if you declare attributes before use, would it be desirable to
be able to select which syntactic constructs they can annotate ?
To be concrete, you might decide that a "@profile" attribute can
be used with expressions, but not with types.

3- should annotations be stored (e. g. in cmi/cmo/cmx files) in
order for an attribute processor to be able to access attributes
of other modules ?


Personally, I think that declaring attributes with their fields
and types is pretty useful. This protects the user from some
typos and other obvious errors, and avoid boiler-plate code in
the attribute processors.

Do list readers have strong opinions on these questions ?


Xavier Clerc

From xavier.clerc@inria.fr  Wed Jan 30 10:20:22 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 500863C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 10:20:22 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.5 from SpamAssassin-3.3.2-1439791 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.83 listed in list.dnswl.dnsbl.ja.net]
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail2-relais-roc.national.inria.fr ([192.134.164.83]:61428)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0UqV-000760-qS (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Wed, 30 Jan 2013 10:24:47 +0000
X-IronPort-AV: E=Sophos;i="4.84,567,1355094000"; 
   d="scan'208";a="618798"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail2-relais-roc.national.inria.fr with ESMTP; 30 Jan 2013 11:24:47 +0100
Date: Wed, 30 Jan 2013 11:24:02 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <1008548475.13786.1359541398143.JavaMail.root@inria.fr>
In-Reply-To: <5108EB7D.2090701@frisch.fr>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [81.194.27.158]
X-Mailer: Zimbra 7.2.0_GA_2669 (ZimbraWebClient - SAF3 (Mac)/7.2.0_GA_2669)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 10:20:22 -0000



----- Mail original -----
> On 01/30/2013 10:27 AM, Xavier Clerc wrote:
> > Personally, I think that declaring attributes with their fields
> > and types is pretty useful.
> 
> I don't see how to do that without introducing a lot of complexity in
> the system.  Do you mean we should run the OCaml type-checker on
> attribute arguments before they are processed?  Or that we should
> restrict attribute arguments to be pure constant data (records,
> constructors, literals)?  This seems overly restrictive.  It make
> sense
> to allow full expressions within attributes (e.g. some uses of
> type-conv
> requires to annotate types with functions), and I don't see how to
> type-check that.

Java made the choice to restrict to constants.
This is indeed restrictive, but make sure that it is easy to check
whether an annotation is correct, and also to store it for future
use.


> > This protects the user from some
> > typos and other obvious errors, and avoid boiler-plate code in
> > the attribute processors.
> 
> I don't expect a lot of tedious boiler-plate code in the processors
> (OCaml is not so bad at pattern matching, after all) if they need to
> check some "constraints" on their arguments (not really
> type-checking,
> but rather checking simple things like the fact that they come with a
> string literal argument).

Well, there are two things: the boiler-plate code (maybe not such
a big problem in OCaml, as you point out), and the fact that if the
constraints are always checked by the same piece of code, error message
presented to the end-user will be uniform.


Xavier Clerc

From alain@frisch.fr  Wed Jan 30 10:42:14 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D76623C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 10:42:14 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:22509
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0VBe-0006NP-Z3 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 10:46:40 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d32 with ME
 id uAmd1k0153lHbAL03Amdab; Wed, 30 Jan 2013 11:46:38 +0100
Message-ID: <5108FA0D.5010802@frisch.fr>
Date: Wed, 30 Jan 2013 11:46:37 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 10:42:14 -0000

On 01/30/2013 10:31 AM, Leo White wrote:
> I don't really see the difference between:
>
>>   {xxx{ ..... }xxx}
>
> and
>
>>  <:html5< <div>xyz</div> >>

The differences are:

  - The closing delimiter is defined by the opening one, so you don't 
need any escaping convention.  (Imagine you want to write HTML code 
containing ">>".)

  - This is usable for regular strings, independently from any -ppx 
manipulation.  In my experience, I faced quite often situations where it 
would have been convenient to write string literals but without OCaml's 
lexical convention.

For instance, imagine that instead of relying on OCaml patterns for 
writing Sedlex's regular expressions, I wanted to use a more compact 
notation.  I could simply use strings:

  (@sedlex) match lexbuf with
   | "xml_letter+" -> ...
   | ...

And I would probably arrange to reduce the need for using the double 
quote character, allowing to write string literals with single quotes:

  (@sedlex) match lexbuf with
   | "'with'" -> ...
   | ...

But I could as well prefer to allow double quotes, using the alternative 
syntax for string literals:

  (@sedlex) match lexbuf with
   | {{ xml_letter+ }} -> ...
   | {{ "with" }} -> ...
   | ...

if "xxx" is allowed to be empty in {xxx{...}xxx}.  There is no quotation 
to name here, this is implied by the surrounding attribute @sedlex 
(which could be made non-ignorable).

As a side note, whatever syntax we choose for quotations / non-parsed 
strings, we should avoid the one currently used by Camlp4, because for 
some time, people will continue to use both Camlp4 and -ppx rewriters.


Alain

From xavier.clerc@inria.fr  Wed Jan 30 10:58:12 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E05CE3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 10:58:12 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.5 from SpamAssassin-3.3.2-1439791 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:41539)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0VR8-0006hd-mh (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Wed, 30 Jan 2013 11:02:38 +0000
X-IronPort-AV: E=Sophos;i="4.84,567,1355094000"; 
   d="scan'208";a="481285"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail3-relais-sop.national.inria.fr with ESMTP; 30 Jan 2013 12:01:57 +0100
Date: Wed, 30 Jan 2013 12:00:34 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <268527069.23397.1359543612595.JavaMail.root@inria.fr>
In-Reply-To: <5108EB7D.2090701@frisch.fr>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [81.194.27.158]
X-Mailer: Zimbra 7.2.0_GA_2669 (ZimbraWebClient - SAF3 (Mac)/7.2.0_GA_2669)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 10:58:13 -0000



----- Mail original -----
> On 01/30/2013 10:27 AM, Xavier Clerc wrote:
> > Personally, I think that declaring attributes with their fields
> > and types is pretty useful.
> 
> I don't see how to do that without introducing a lot of complexity in
> the system.  Do you mean we should run the OCaml type-checker on
> attribute arguments before they are processed?  Or that we should
> restrict attribute arguments to be pure constant data (records,
> constructors, literals)?  This seems overly restrictive.  It make
> sense
> to allow full expressions within attributes (e.g. some uses of
> type-conv
> requires to annotate types with functions), and I don't see how to
> type-check that.

Java made the choice to restrict to constants.
This is indeed restrictive, but make sure that it is easy to check
whether an annotation is correct, and also to store it for future
use.



> > This protects the user from some
> > typos and other obvious errors, and avoid boiler-plate code in
> > the attribute processors.
> 
> I don't expect a lot of tedious boiler-plate code in the processors
> (OCaml is not so bad at pattern matching, after all) if they need to
> check some "constraints" on their arguments (not really
> type-checking,
> but rather checking simple things like the fact that they come with a
> string literal argument).

Well, there are two things: the boiler-plate code (maybe not such
a big problem in OCaml, as you point out), and the fact that if the
constraints are always checked by the same piece of code, error messages
presented to the end-user will be uniform.


Xavier Clerc

From alain@frisch.fr  Wed Jan 30 11:10:10 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4884C3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 11:10:10 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:23936
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0Vch-0002Sr-Xz (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 11:14:35 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d32 with ME
 id uBEa1k00z3lHbAL03BEbNN; Wed, 30 Jan 2013 12:14:35 +0100
Message-ID: <5109009A.8010400@frisch.fr>
Date: Wed, 30 Jan 2013 12:14:34 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
 <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
 <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
 <5108BAFA.5020206@frisch.fr>
 <Prayer.1.3.5.1301300836470.10317@hermes-1.csi.cam.ac.uk>
 <5108E6AD.7030508@frisch.fr>
 <Prayer.1.3.5.1301300940080.9358@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301300940080.9358@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 11:10:10 -0000

On 01/30/2013 10:40 AM, Leo White wrote:
>> I'd rather write it:
>>
>>   foo bar ((@marker) e)
>
> I would prefer it to have its own syntax, because I would like to
> encourage its use. I think that it is easier to read than a normal
> attribute because it clearly declares its scope

I don't see the point: the scope of an attribute must be quite explicit 
as well (but maybe the current syntax is not clear enough).

-- Alain

From edwin+ml-ocaml@etorok.net  Wed Jan 30 11:15:09 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1B5583C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 11:15:09 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.6 from SpamAssassin-3.3.2-1439791 
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:57855)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0VhV-0001LG-SG (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Wed, 30 Jan 2013 11:19:34 +0000
Received: from [172.30.42.2] (unknown [86.125.225.154])
 by mail.etorok.net (Postfix) with ESMTPSA id 4F45446B5
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 12:19:33 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359544773;
 bh=oBpBbn7WFn/JJwhXOFNE9I9LCearoJGMhby0KNF+jSE=;
 h=Message-ID:Date:From:MIME-Version:To:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=tuepA0pX7DhpNtQ0ekPQOAhCS5gLEQz9vYAV4WDLbjzROouxxoawQb74L1jS9hZcR
 XZREoYKH6RxTOk8RA+ozjJcn1dM1XrwACxTS7u52M38DQmOK3gjAnMRqsNWelkBr1D
 EIi+AH+9USMNnrse05AEVXUE87z5AIRICNZgNAj4=
Message-ID: <510901C2.2050603@etorok.net>
Date: Wed, 30 Jan 2013 13:19:30 +0200
From: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
In-Reply-To: <5108E3E3.307@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Subject: [wg-camlp4] Editor support for syntax extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 11:15:09 -0000

On 01/30/2013 11:12 AM, Alain Frisch wrote:
> On 01/30/2013 03:34 AM, Hongbo Zhang wrote:
>> let rec token enc =  {:lex|
>>     "<utf8>" -> begin enc := Ulexing.Utf8; token enc lexbuf end
>>    | "<latin1>" -> begin enc := Ulexing.Latin1; token enc lexbuf end
>>    | xml_letter+ -> Printf.sprintf "word(%s)" (Ulexing.utf8_lexeme lexbuf)
>>    | number -> "number"
>>    | eof -> exit 0
>>    | [1234-1246] -> "bla"
>>    | "(" ->  begin
>>        Ulexing.rollback lexbuf; (* Puts the lexeme back into the buffer *)
>>        {| "(" [^ '(']* ")" -> Ulexing.utf8_lexeme lexbuf |} lexbuf
>>        (* Note the use of an inline lexer *)
>>    end
>>    | "(*" -> begin comment lexbuf; "comment" end
>>    | ' ' -> "whitespace"
>>    | _ -> "???" |}
>> and comment = {:lex|
>>     "*)" -> ()
>>    | eof -> failwith "comment"
>>    | _ -> let _lexeme = Ulexing.lexeme lexbuf in
>>      comment lexbuf |}
> 
> This looks very bad to me:
> 
> 1. You loose all support from your editor (indentation, coloring, parentheses matching).  Am I the only one who finds this really problematic?  With quotations, my emacs looks like notepad...

I still get syntax highlighting and matching parens in both vim and emacs for the above (although maybe antiquotations would confuse it):
http://www.pasteall.org/pic/show.php?id=44586
http://www.pasteall.org/pic/show.php?id=44587

I do agree that editor support is less reliable once you start using syntax extensions. A common way to define quotations and anti-quotations could probably
help editors cope with syntax extensions better though.

> Indentation and coloring do find typos on the fly; automatic indentation makes it easy to copy/paste code from one context to another one.

Editor support is something that I meant discuss.

1. Auto-completion support.

This already exists for Emacs in the form of Typerex's ocp-complete I think.
It might be possible to adapt it for Vim, for example see how ClangComplete works here for C: http://llvm.org/viewvc/llvm-project/llvm/trunk/utils/vim/vimrc?view=markup.

I'd like to have this idea extended to syntax extensions too, where the syntax extension *itself* provides the possible completions.
For example: a lexer/parser extensions could provide completion based on available tokens, a monadic syntax extensions would provide completion
based on available monad variables, etc.

And of course once you go back to original OCaml syntax inside a quotation it should provide the regular OCaml completions.

2. Syntax highlighting support

Currently each editor has its own syntax highlighting rules, but there are some (corner) cases
where even with no syntax extensions it gets it wrong (ok, maybe I should file bugs about those).

What I had in mind is that (optionally) the Vim syntax highlighter script passes the source code through an external process and gets back
markers for syntax highlighting, and it uses that to override its built-in highlighter:
@1,5-1,17 Keyword
@1,17-3,28 Comment
...

Not sure how hard would it be to write such a Vim (or Emacs) script, and how well it'd work in practice (you probably
wouldn't want to do this for every character the user types, maybe only do this on file load/during idle times/after entering a complete line/saving/etc.).
This is again probably similar to what Typerex already does for the OCaml syntax.

As for the external process, it'd use compiler-libs to parse the source code, run any -ppx/camlp4 extensions on it, take the locations from the original parsetree
and output these syntax markers.

To take your IFDEF example:
    | {pmod_desc = Pmod_apply(
         {pmod_desc = Pmod_apply(
          {pmod_desc = Pmod_apply(
           {pmod_desc = Pmod_ident {txt = Lident "IFDEF"}, pmod_loc = ifdef_loc},
           {pmod_desc = Pmod_ident {txt = Lident sym}}
          )},
          body_def)}, body_not_def)} ->
            self#highlight ifdef_loc `Keyword;
            if getenv sym <> "" then this # module_expr body_def
            else this # module_expr body_not_def
 ....

Then astmapper could have two kinds of outputs:
* by default it outputs the new parsetree
* if there is a '--highlight' command-line it throws away the parsetree and prints instead the highlight marker collected by self#highlight, and then uses default
OCaml highlighting to output markers for parsetree nodes that didn't get self#highlight called.

3. Syntax checking support

Something similar to gcc's -fsyntax-only, but better. Currently you need to compile a fake .cmi or ask for a fake .inferred.mli to get syntax + type errors for the current file,
which is time consuming sometimes.

The above tool could have a flag to also output syntax errors (since it has to parse the source code anyway, and it knows what syntax extensions are used), _and_
it could also try to show type errors based on the current file, and any already existing .cmi files.

4. What syntax extensions to use => define in the source code

This has already been mentioned that the source file could define what syntax extensions it uses, so it works for all build systems (ocamlbuild, makefiles, omake), etc.
It may not even need special support from the compiler: there could be a -ppx that finds these pragmas and loads those other -ppx on its own!

Best regards,
--Edwin







From lpw25@hermes.cam.ac.uk  Wed Jan 30 11:17:30 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B7ACC3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 11:17:30 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:34414)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0Vjn-00015w-q9 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 11:21:55 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0Vjn-0002CK-4J (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 11:21:55 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 30 Jan 2013 11:21:55 +0000
Date: 30 Jan 2013 11:21:55 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5108FA0D.5010802@frisch.fr>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 11:17:30 -0000

>  - The closing delimiter is defined by the opening one, so you don't 
>need any escaping convention.  (Imagine you want to write HTML code 
>containing ">>".)

As I suggested in an earlier post, it is simple to allow this for <: ... >.

>  (@sedlex) match lexbuf with
>   | {{ xml_letter+ }} -> ...
>   | {{ "with" }} -> ...
>   | ...

I suppose that it is sometimes useful to have an unnamed quotation. For 
this I think that camlp4 has "<< ... >>", so we could just allow that.

>As a side note, whatever syntax we choose for quotations / non-parsed 
>strings, we should avoid the one currently used by Camlp4, because for 
>some time, people will continue to use both Camlp4 and -ppx rewriters.

I disagree with this. It is not at all difficult to tell camlp4 to pass 
through unrecognised quotations onto the main compiler (and so to the other 
preprocessors). It would then be simple for quotation extensions to 
seamlessly switch from -pp to -ppx.


From lpw25@hermes.cam.ac.uk  Wed Jan 30 11:39:25 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id ED14A3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 11:39:25 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:38321)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0W51-0007yv-Wj (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 11:43:51 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0W51-0005Ig-4B (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 11:43:51 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 30 Jan 2013 11:43:51 +0000
Date: 30 Jan 2013 11:43:51 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301301143510.2899@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5109009A.8010400@frisch.fr>
References: <CAPFanBEFN6CUZTvVamx+QMOZogm8WtPT8b4bC8qDrajJGv78uA@mail.gmail.com>
 <5107BEDF.6040907@frisch.fr>
 <Prayer.1.3.5.1301291816210.2941@hermes-1.csi.cam.ac.uk>
 <CAPFanBF6cFWUMTpBgLt_cUtKpayW5Pxv3gJ258i0X-jok5irfQ@mail.gmail.com>
 <5108BAFA.5020206@frisch.fr>
 <Prayer.1.3.5.1301300836470.10317@hermes-1.csi.cam.ac.uk>
 <5108E6AD.7030508@frisch.fr>
 <Prayer.1.3.5.1301300940080.9358@hermes-1.csi.cam.ac.uk>
 <5109009A.8010400@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Against the use of syntactically-valid OCaml code
 for syntax extension purposes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 11:39:26 -0000

On Jan 30 2013, Alain Frisch wrote:

>On 01/30/2013 10:40 AM, Leo White wrote:
>>> I'd rather write it:
>>>
>>>   foo bar ((@marker) e)
>>
>> I would prefer it to have its own syntax, because I would like to
>> encourage its use. I think that it is easier to read than a normal
>> attribute because it clearly declares its scope
>
>I don't see the point: the scope of an attribute must be quite explicit 
>as well (but maybe the current syntax is not clear enough).

The point is that there are fundamentally two kinds of extension.

The first kind are things which themselves represent 
expressions/patterns/... . For example:

<:html < <body> ... </body> >> 

{:PGSQL dbh "select id, name from users"}

and the second kind are those that act on an existing 
expression/pattern/... . For example:

val foo: int -> int  {%depreciated}

In the first case, the syntax inside the brackets may look like OCaml but 
it will be translated. In the second kind the expression that the attribute 
is attached to *is* OCaml code. It may be acted on in some way (e.g. placed 
inside some boilerplate) but it fundamentally is OCaml code.

Failure to translate the first kind must raise an error. Failure to 
translate the second kind does not necessarily require an error.

I think that these differences is enough to justify separate (but similar) 
syntaxes. I don't think that everyone using the first kind of extension 
should have to use a syntax more suited to the second kind.



From avsm@dark.recoil.org  Wed Jan 30 12:31:32 2013
Return-Path: <avsm@dark.recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id DAFC23C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 12:31:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:37948
 helo=dark.recoil.org)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with smtp id 1U0WtS-00070n-WT (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <avsm@dark.recoil.org>); Wed, 30 Jan 2013 12:35:58 +0000
Received: (qmail 6067 invoked by uid 10000); 30 Jan 2013 12:35:57 -0000
Date: Wed, 30 Jan 2013 12:35:57 +0000
From: Anil Madhavapeddy <anil@recoil.org>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <20130130123557.GB19728@dark.recoil.org>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <5108E3E3.307@frisch.fr>
User-Agent: Mutt/1.5.21 (2010-09-15)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 12:31:32 -0000

On Wed, Jan 30, 2013 at 10:12:03AM +0100, Alain Frisch wrote:
> 
> 1. You loose all support from your editor (indentation, coloring,
> parentheses matching).  Am I the only one who finds this really
> problematic?  With quotations, my emacs looks like notepad...
> Indentation and coloring do find typos on the fly; automatic
> indentation makes it easy to copy/paste code from one context to
> another one.

Better editor support is the single biggest feature I'd like from the
switch to a more specialised ppx.  I've looked at customising the superb
Cloud9 Javascript editor, and the major blocker is having to run
everything through camlp4 all the time.

-- 
Anil Madhavapeddy                                 http://anil.recoil.org

From bobzhang1988@gmail.com  Wed Jan 30 13:14:01 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E96A83C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 13:14:01 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1439791 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.176 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f176.google.com ([209.85.128.176]:51752)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0XYY-0000W5-Yi (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Wed, 30 Jan 2013 13:18:27 +0000
Received: by mail-ve0-f176.google.com with SMTP id jz10so1050049veb.21
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 05:18:26 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=0cWdOpxTi9KMEmwwY/RzGc9v1F+g2gYlYxC6F3SjJdE=;
 b=VriQH61WzHmd3zZappZjDoDXaRoiyXGwg0pRO/tQJjxRNput9Y8m+Cb7v+hQmYykx8
 6a1w5xMUjGMG77XpQzyURhjGvRgeGawkRMCMWhHJ8ivlZEtbbV7DCCyN0YV2cMNJIjSR
 1mwlXG8aGtXpVt0oqOv0+leyUI0eUs6pamF1PykEcC66BJ1/HV4xCnf6rhKSIdvuEMTW
 W+tVeDOcIdUo0AvTENrl5emY1egSq2tbEdkb5txRRSWbbpOVaskZ2qDxLd8d5k+v8Ryv
 ImVaF7jmb1FtzGegwj274GxXJ/HfPmcNcsVJAMonf7P1xMShDKCxxmwqyOePFR7QE6wr
 +jrg==
MIME-Version: 1.0
X-Received: by 10.52.21.146 with SMTP id v18mr4134644vde.79.1359551905786;
 Wed, 30 Jan 2013 05:18:25 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Wed, 30 Jan 2013 05:18:25 -0800 (PST)
In-Reply-To: <5108E3E3.307@frisch.fr>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
Date: Wed, 30 Jan 2013 08:18:25 -0500
X-Google-Sender-Auth: xZNlZuhAdIN1jmjcDehKLDH-Trc
Message-ID: <CANcqPu4CnjsJcVWTK3N0Q9iEMLWzHWtRM41u6EKRYX2T1we0wQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain@frisch.fr>
Content-Type: multipart/alternative; boundary=20cf307ca38e65ec9b04d48158e6
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 13:14:02 -0000

--20cf307ca38e65ec9b04d48158e6
Content-Type: text/plain; charset=ISO-8859-1

On Wed, Jan 30, 2013 at 4:12 AM, Alain Frisch <alain@frisch.fr> wrote:

> On 01/30/2013 03:34 AM, Hongbo Zhang wrote:
>
>>
>> This looks very bad to me:
>
> 1. You loose all support from your editor (indentation, coloring,
> parentheses matching).  Am I the only one who finds this really
> problematic?  With quotations, my emacs looks like notepad... Indentation
> and coloring do find typos on the fly; automatic indentation makes it easy
> to copy/paste code from one context to another one.
>
Weird, my emacs works pretty well for me, I choose "{| |}" since it's more
friendly to emacs. *On the contrary, quotation is great for IDE
integration, since when you type {:lex||}, the IDE knows the context already
*

>
> 2. Quotation "with OCaml code in them" does not combine well with other
> AST rewriters.  If you have a -ppx filter implementing, say, macro
> expansion (in patterns and expressions), would you apply it before or after
> the one expanding the {:lex| ... |} quotations?  Probably both. (And won't
> be able to benefit of macro on patterns for the "regexps".)
>
Ast Rewriter is *bad *for arbitrary code generation, its neat case is
something like bisect. And Ast Rewriter is not composable at  all, suppose
you have two AST Rewriters A,B ,there are no guarantee that  A.B == B.A, it
just gives you an illusion that it works, probably it silently fails.

>
> 3. How do you implement the expander?  Somehow, you need to parse the
> content of the quotation (stored as a string in the AST), which involves
> non trivial stuff, like a parser being able to parse OCaml code mixed with
> something else.  Personally, I don't know how to implement the quotation
> expander with the parsing technologies I'm familiar with.
>
> when you design your DSL, the left part is pretty easy to parse, when you
see the delimiter "->", invoking an existing parser.

>
> For me quotations (in position of expression) are useful only for one
> thing: escape from the lexical conventions of OCaml string literals.
> Otherwise, strings are just fine.  There are very few cases where with
> actually matters.  A decent example might be something like Pa_tyxml,
> allowing to write XML code in XML syntax within OCaml sources.  But even
> there, I'm not absolutely sure that quotations are the best solution: would
> it really be so bad to use normal OCaml strings (with an attribute):
>
>   (@xml)"<div>xyz</div>"
>
> or OCaml syntax interpreted specially:
>
>   (@xml)(div "xyz")
>
> instead of the current:
>
>  <:html5< <div>xyz</div> >>
>
>
> They all work great for me, but since they all work, why not only
introduce one,* I am happy to see the less ad-hoc rules.*
I did not mention that in Fan, we already support {:|?  ?|} , like Perl you
can supply an extra matching char to handle more complex cases.

Anyway, I think it would great to get the Abstract Syntax right before the
details on concrete syntax.

> But maybe for some cases (embedding a language with a lot of double quoted
> and backslashes), escaping from the lexical conventions of OCaml string
> literals might really be useful.  This could be actually be the case for
> standard string literals, with no special syntactic processing.  So why not
> simply address this need by allowing an alternative syntax for string
> literals, where no special character is interpreted?  The opening delimiter
> would define the closing delimiter.  For instance:
>
>   {xxx{ ..... }xxx}
>
> (here I've assumed that { } are hard-coded, but xxx could be replaced say,
> by any sequence of identifier/digit/operator characters). In the AST, this
> could be represented as a normal string literal (or maybe we should keep
> the "xxx" annotation, to avoid having to put an extra attribute in front of
> the literal).
>
>
> I've yet to be convinced that quotations really have other interesting
> uses than escaping from lexical conventions of OCaml string literals...
>
>
> Alain
>



-- 
-- Regards, Hongbo

--20cf307ca38e65ec9b04d48158e6
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Wed, Jan 30, 2013 at 4:12 AM, Alain F=
risch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain@frisch.fr" target=3D"_b=
lank">alain@frisch.fr</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_q=
uote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1e=
x">
<div class=3D"im">On 01/30/2013 03:34 AM, Hongbo Zhang wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><br></blockquote></div>
This looks very bad to me:<br>
<br>
1. You loose all support from your editor (indentation, coloring, parenthes=
es matching). =A0Am I the only one who finds this really problematic? =A0Wi=
th quotations, my emacs looks like notepad... Indentation and coloring do f=
ind typos on the fly; automatic indentation makes it easy to copy/paste cod=
e from one context to another one.<br>
</blockquote><div>Weird, my emacs works pretty well for me, I choose &quot;=
{| |}&quot; since it&#39;s more friendly to emacs. <b>On the contrary, quot=
ation is great for IDE integration, since when you type {:lex||}, the IDE k=
nows the context already</b></div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
<br>
2. Quotation &quot;with OCaml code in them&quot; does not combine well with=
 other AST rewriters. =A0If you have a -ppx filter implementing, say, macro=
 expansion (in patterns and expressions), would you apply it before or afte=
r the one expanding the {:lex| ... |} quotations? =A0Probably both. (And wo=
n&#39;t be able to benefit of macro on patterns for the &quot;regexps&quot;=
.)<br>
</blockquote><div>Ast Rewriter is <b>bad </b>for arbitrary code generation,=
 its neat case is something like bisect. And Ast Rewriter is not composable=
 at =A0all, suppose you have two AST Rewriters A,B ,there are no guarantee =
that =A0A.B =3D=3D B.A, it just gives you an illusion that it works, probab=
ly it silently fails.</div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
<br>
3. How do you implement the expander? =A0Somehow, you need to parse the con=
tent of the quotation (stored as a string in the AST), which involves non t=
rivial stuff, like a parser being able to parse OCaml code mixed with somet=
hing else. =A0Personally, I don&#39;t know how to implement the quotation e=
xpander with the parsing technologies I&#39;m familiar with.<br>

<br></blockquote><div>when you design your DSL, the left part is pretty eas=
y to parse, when you see the delimiter &quot;-&gt;&quot;, invoking an exist=
ing parser. =A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 =
0 .8ex;border-left:1px #ccc solid;padding-left:1ex">

<br>
For me quotations (in position of expression) are useful only for one thing=
: escape from the lexical conventions of OCaml string literals. Otherwise, =
strings are just fine. =A0There are very few cases where with actually matt=
ers. =A0A decent example might be something like Pa_tyxml, allowing to writ=
e XML code in XML syntax within OCaml sources. =A0But even there, I&#39;m n=
ot absolutely sure that quotations are the best solution: would it really b=
e so bad to use normal OCaml strings (with an attribute):<br>

<br>
=A0 (@xml)&quot;&lt;div&gt;xyz&lt;/div&gt;&quot;<br>
<br>
or OCaml syntax interpreted specially:<br>
<br>
=A0 (@xml)(div &quot;xyz&quot;)<br>
<br>
instead of the current:<br>
<br>
=A0&lt;:html5&lt; &lt;div&gt;xyz&lt;/div&gt; &gt;&gt;<br>
<br>
<br></blockquote><div>They all work great for me, but since they all work, =
why not only introduce one,<b> I am happy to see the less ad-hoc rules.</b>=
</div><div>I did not mention that in Fan, we already support {:|? =A0?|} , =
like Perl you can supply an extra matching char to handle more complex case=
s.</div>
<div><br></div><div>Anyway, I think it would great to get the Abstract Synt=
ax right before the details on concrete syntax.</div><blockquote class=3D"g=
mail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-l=
eft:1ex">

But maybe for some cases (embedding a language with a lot of double quoted =
and backslashes), escaping from the lexical conventions of OCaml string lit=
erals might really be useful. =A0This could be actually be the case for sta=
ndard string literals, with no special syntactic processing. =A0So why not =
simply address this need by allowing an alternative syntax for string liter=
als, where no special character is interpreted? =A0The opening delimiter wo=
uld define the closing delimiter. =A0For instance:<br>

<br>
=A0 {xxx{ ..... }xxx}<br>
<br>
(here I&#39;ve assumed that { } are hard-coded, but xxx could be replaced s=
ay, by any sequence of identifier/digit/operator characters). In the AST, t=
his could be represented as a normal string literal (or maybe we should kee=
p the &quot;xxx&quot; annotation, to avoid having to put an extra attribute=
 in front of the literal).<br>

<br>
<br>
I&#39;ve yet to be convinced that quotations really have other interesting =
uses than escaping from lexical conventions of OCaml string literals...<spa=
n class=3D"HOEnZb"><font color=3D"#888888"><br>
<br>
<br>
Alain<br>
</font></span></blockquote></div><br><br clear=3D"all"><div><br></div>-- <b=
r>-- Regards, Hongbo

--20cf307ca38e65ec9b04d48158e6--

From alain@frisch.fr  Wed Jan 30 14:17:14 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3CF503C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 14:17:14 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:46491
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0YXj-0003H2-QR (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 14:21:40 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d18 with ME
 id uEMQ1k00b3lHbAL03EMVGq; Wed, 30 Jan 2013 15:21:38 +0100
Message-ID: <51092C60.5000003@frisch.fr>
Date: Wed, 30 Jan 2013 15:21:20 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr> <510901C2.2050603@etorok.net>
In-Reply-To: <510901C2.2050603@etorok.net>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Editor support for syntax extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 14:17:14 -0000

On 01/30/2013 12:19 PM, Trk Edwin wrote:
> I still get syntax highlighting and matching parens in both vim and emacs for the above (although maybe antiquotations would confuse it):

Highlighting gets completely wrong as soon as you start e.g. using 
double quotes. And indentation is just impossible if the editor isn't 
aware of the grammar implemented by the extensions.  One could certainly 
try to fix this and introduce more tools, complexity and border cases. 
But I still fail to see the real benefits of allowing very customized 
syntax which would justify such efforts.  The whole point of -ppx versus 
camlp4 is precisely to stop messing up with the concrete syntax: define 
some generic enough extension points, and just work with a fixed 
concrete syntax.  I'd prefer to see dead simple solutions adopted for 
-ppx, and more advanced stuff (based on concrete syntax) left to camlp4/fan.

> 4. What syntax extensions to use => define in the source code
>
> This has already been mentioned that the source file could define what syntax extensions it uses, so it works for all build systems (ocamlbuild, makefiles, omake), etc.
> It may not even need special support from the compiler: there could be a -ppx that finds these pragmas and loads those other -ppx on its own!

I've started something along these lines:

https://github.com/alainfrisch/ppx_drivers

Exactly how this works with ocamlfind needs to be discussed.  I know 
Gerd has some ideas!


Alain

From alain@frisch.fr  Wed Jan 30 14:37:02 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 944713C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 14:37:02 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:51513
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0Yqq-0002Dz-qq (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 14:41:28 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d18 with ME
 id uEhP1k00d3lHbAL03EhPHL; Wed, 30 Jan 2013 15:41:24 +0100
Message-ID: <51093113.1080906@frisch.fr>
Date: Wed, 30 Jan 2013 15:41:23 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 14:37:02 -0000

On 01/30/2013 12:21 PM, Leo White wrote:
>>  - The closing delimiter is defined by the opening one, so you don't
>> need any escaping convention.  (Imagine you want to write HTML code
>> containing ">>".)
>
> As I suggested in an earlier post, it is simple to allow this for <: ... >.
>
>>  (@sedlex) match lexbuf with
>>   | {{ xml_letter+ }} -> ...
>>   | {{ "with" }} -> ...
>>   | ...
>
> I suppose that it is sometimes useful to have an unnamed quotation. For
> this I think that camlp4 has "<< ... >>", so we could just allow that.

The important point is not the fact that the quotation is unnamed, but 
that it's scope is restricted to the smallest fragment which requires a 
custom parser (left-hand side).  I'm fine if those regexps cannot be 
highlighted very cleverly.  But what is important is that the right-hand 
side, which are normal OCaml expressions, are understood as such by the 
editor.  This cannot be the case with Hongbo's proposal of having the 
whole think inside a quotation:

{:lex|
    xml_letter+ -> ...
  | "with" -> ...
|}


So in this example:

   (@sedlex) match lexbuf with
    | {{ xml_letter+ }} -> ...
    | {{ "with" }} -> ...
    | ...

the role of {{...}} is not to introduce something which will expand to 
an expression or a pattern, it's just a way to avoid lexical rules on 
OCaml string literals (so that we don't need to escape the ").  The 
important part is the (@sedlex) attribute, and I wouldn't be shocked to 
use a different syntax to indicate that it really changes the 
interpretation of the underlying expression (the whole match statement), 
as opposed to some piece of information added to that expression.  The 
syntax could be simply changing (@sedlex) to (:sedlex), or maybe to have 
it look more like a delimiter with a clear scope:

  (:sedlex
     match lexbuf with
     | {{ xml_letter+ }} -> ...
     | {{ "with" }} -> ...
     | ...
  )

but the content would still be parsed as an expression, unlike camlp4 
quotations.


>> As a side note, whatever syntax we choose for quotations / non-parsed
>> strings, we should avoid the one currently used by Camlp4, because for
>> some time, people will continue to use both Camlp4 and -ppx rewriters.
>
> I disagree with this. It is not at all difficult to tell camlp4 to pass
> through unrecognised quotations onto the main compiler (and so to the
> other preprocessors). It would then be simple for quotation extensions
> to seamlessly switch from -pp to -ppx.

Ok, why not.  I still believe that real uses of "quotations" should be 
really limited and that most interesting uses of -ppx would not need 
them (or be independent from them, i.e. they should allow regular string 
literals as well).


Alain

From lpw25@hermes.cam.ac.uk  Wed Jan 30 15:07:22 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 505723C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 15:07:22 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:56452)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0ZKF-0002Cc-Sd (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 15:11:47 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0ZKF-0000ig-Py (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 15:11:47 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 30 Jan 2013 15:11:47 +0000
Date: 30 Jan 2013 15:11:47 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
In-Reply-To: <51093113.1080906@frisch.fr>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 15:07:22 -0000

>The 
>syntax could be simply changing (@sedlex) to (:sedlex), or maybe to have 
>it look more like a delimiter with a clear scope:
>
>  (:sedlex
>     match lexbuf with
>     | {{ xml_letter+ }} -> ...
>     | {{ "with" }} -> ...
>     | ...
>  )
>
>but the content would still be parsed as an expression, unlike camlp4 
>quotations.
>

How about we broaden "quotations" (which to avoid confusion I'm going to 
start calling "templates") to allow the following two forms:

* <: lid expr >
* <: lid ?< unlexed-text >?>

(where ? can be any symbol or alpha-numberic character or empty)

The second form would essentially be syntactic sugar for <: lid {{ }} >. It 
is there for convenience and to preserve backward compatibility with 
camlp4.

Notice that they require an identifier. I think that this is a good thing 
because it helps prevent name clashes. It is also probably necessary for 
supporting <:foo < .. >> in the same construct.

Separate from this we also support "attributes" like (@ expr).

This should still allow you to use:

<:sedlex
     match lexbuf with
     | {{ xml_letter+ }} -> ...
     | {{ "with" }} -> ...
     | ...
  >

or even

   (@sedlex) match lexbuf with
    | {{ xml_letter+ }} -> ...
    | {{ "with" }} -> ...
    | ...

if you prefer it.


From alain@frisch.fr  Wed Jan 30 15:31:56 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 891F53C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 15:31:56 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:47438
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0Zi2-0003it-q5 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 15:36:22 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d18 with ME
 id uFcM1k00C3lHbAL03FcMEU; Wed, 30 Jan 2013 16:36:21 +0100
Message-ID: <51093DF5.9080306@frisch.fr>
Date: Wed, 30 Jan 2013 16:36:21 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 15:31:56 -0000

On 01/30/2013 04:11 PM, Leo White wrote:
> How about we broaden "quotations" (which to avoid confusion I'm going to
> start calling "templates") to allow the following two forms:
>
> * <: lid expr >
> * <: lid ?< unlexed-text >?>
>
> (where ? can be any symbol or alpha-numberic character or empty)
>
> The second form would essentially be syntactic sugar for <: lid {{ }} >.
> It is there for convenience and to preserve backward compatibility with
> camlp4.

Do you really mean using a single > as the closing delimiter in the 
first case?  This seems rather bad to me, as it introduces useless 
ambiguity in the grammar. How do you parse:

<:lid 3 > 4 > 5

?

 >> is also a valid binary operator, by the way.

I'd rather drop compatibility with camlp4, and prefer characters which 
are already used as delimiters by OCaml and not binary operators.  If we 
drop compatibility with camlp4, there is no reason to prefer:

  <: lid xx< ... >xx>

over, say:

  (:lid {xx{ ... }xx})

which would often become:

  (:lid {{...}})


Alain

From lpw25@hermes.cam.ac.uk  Wed Jan 30 16:09:28 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E71AB3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 16:09:28 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:38338)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0aIM-0004j1-YN (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 16:13:54 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0aIM-0001U2-Kj (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 30 Jan 2013 16:13:54 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 30 Jan 2013 16:13:54 +0000
Date: 30 Jan 2013 16:13:54 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
In-Reply-To: <51093DF5.9080306@frisch.fr>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 16:09:29 -0000

>Do you really mean using a single > as the closing delimiter in the 
>first case? 

You're right that should really be ">>".

>
> >> is also a valid binary operator, by the way.
>

Yes, but it is also listed as a keyword, so it is probably fine to 
appropriate it.

>I'd rather drop compatibility with camlp4, and prefer characters which 
>are already used as delimiters by OCaml and not binary operators.  If we 
>drop compatibility with camlp4, there is no reason to prefer:
>
>  <: lid xx< ... >xx>
>
>over, say:
>
>  (:lid {xx{ ... }xx})

I think that I prefer <: .. >> in part because it is not already used as a 
delimiter (at least not for expressions). I think that these things should 
stand out. I also think that, if there are no real issues with it, we 
should be compatible with camlp4.


From alain@frisch.fr  Wed Jan 30 17:03:24 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 948573C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 17:03:24 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:25337
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0b8Y-00038U-XS (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 30 Jan 2013 17:07:50 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d18 with ME
 id uH7o1k00Y3lHbAL03H7orl; Wed, 30 Jan 2013 18:07:49 +0100
Message-ID: <51095364.9080001@frisch.fr>
Date: Wed, 30 Jan 2013 18:07:48 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 17:03:24 -0000

On 01/30/2013 05:13 PM, Leo White wrote:
>> Do you really mean using a single > as the closing delimiter in the
>> first case?
>
> You're right that should really be ">>".

Same problem:

let ( >> ) = ( lsr ) in
<< foo >> 2 >>

>> >> is also a valid binary operator, by the way.
>>
>
> Yes, but it is also listed as a keyword, so it is probably fine to
> appropriate it.

The manual says:

""
Note that the following identifiers are keywords of the Camlp4 
extensions and should be avoided for compatibility reasons.

     parser    <<    <:    >>    $     $$    $:
""

 >> and << are really not keywords of OCaml, and I wouldn't be surprised 
they are actually used as operators.  I prefer breaking compatibility 
with camlp4 than with OCaml.


-- Alain

From gabriel.scherer@gmail.com  Wed Jan 30 17:18:09 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E053C3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 17:18:09 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1439791 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.174 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f174.google.com ([209.85.220.174]:53973)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0bMp-0001dy-qL (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Wed, 30 Jan 2013 17:22:36 +0000
Received: by mail-vc0-f174.google.com with SMTP id n11so1134798vch.19
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 09:22:34 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:from:date:message-id:subject:to
 :content-type; bh=x9roOUym9zikASCX0fa29hHbRQRn9nJ2kTMEaYRa/Pw=;
 b=SlOEkaym+JhzH4PDQ6NFsfQnCMcBGP/aQGhDDD6X4hcVVzKIA/2L6eQvY9LY/4XmSR
 2HTpJi+mvyVeJebZLctNDGcZZhdj6d/UI2cIK5TRServ4oflycFEsB/N+g73V0gfdr8U
 rsvZpIrvSRYfF2hwN4WEs0Um8BCUgBKvMiDz0rXdjlVmA91ZKO29Q5UeaIScmgMJPN0h
 ZWBdBPv2RONJzx/NqaV+e09s1Co1xKQH60aAeBMG7RR/yc9iaNH1wAjzgTK59XbxP3yp
 +CxefAKHYPHkMru0zgYyNC9hDYR4fRB7DbORmOPjLW8cYbUlk8qc9SN2cCh4HazQqfZF
 le9Q==
X-Received: by 10.58.214.231 with SMTP id od7mr1203884vec.44.1359566554539;
 Wed, 30 Jan 2013 09:22:34 -0800 (PST)
MIME-Version: 1.0
Received: by 10.58.190.202 with HTTP; Wed, 30 Jan 2013 09:21:54 -0800 (PST)
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Wed, 30 Jan 2013 18:21:54 +0100
Message-ID: <CAPFanBG_UpSjurNeu_y8YcUhhTJStJEhxsuHw5JB7d3g3nKwkA@mail.gmail.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
Subject: [wg-camlp4] A set of synthetic use cases to help discussions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 17:18:10 -0000

One problem with the current debate(s) is that people have fairly
different syntaxes and semantics in mind regarding "syntax
extensions".

I think we should gather somewhere small snippets of "representative"
syntax extensions (for example under their current form, which
includes the Camlp4 syntax extensions but also eg. Lexifi's custom
attributes syntax or the imaginary quotation system of your liking),
so that people could refer to those example and concretely demonstrate
which cases their proposed semantics would capture, and with which
syntax.

I have started to put up some examples on the following wiki page,
mostly by accumulating what has been mentioned during the discussions
so far:

  https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases

I have made up the categories as I collected the examples, so they're
certainly suboptimal.

The page should be open for editing (let me know if the right aren't
set correctly), so that you can update it with new examples if you
think they are representative of some need that wasn't exposed before.
Please remember that the page is there to collect use cases for the
discussion here, rather than contain argumentation/opinion/judgments
itself.

From edwin+ml-ocaml@etorok.net  Wed Jan 30 17:27:48 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A16393C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 17:27:48 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.6 from SpamAssassin-3.3.2-1439791 
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:42483)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0bWA-0005aL-pi (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Wed, 30 Jan 2013 17:32:15 +0000
Received: from [172.30.42.2] (unknown [86.125.225.154])
 by mail.etorok.net (Postfix) with ESMTPSA id 5D6E446B5
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 18:32:13 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359567133;
 bh=Lt137bXPAdjVTxOobSfxCw2ftkbFNGoutGUDwReAYRM=;
 h=Message-ID:Date:From:MIME-Version:To:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=Sl+GXTTeJ/102kWvT0SYEAVe/qTqStpQnzaRpPdloFF9CC7ojRxnp7empDo+yrFMz
 hslBVAIJFREumfU359KFU9eWveKlMT9fuMDL8SunTX+oOg5ldx6G2jNlyIlexcnZLN
 1oWLPdha0ZkkqDzst2B6e5EC4D9xc4SyCwHh6Fks=
Message-ID: <5109591C.8060108@etorok.net>
Date: Wed, 30 Jan 2013 19:32:12 +0200
From: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
In-Reply-To: <51095364.9080001@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 17:27:48 -0000

On 01/30/2013 07:07 PM, Alain Frisch wrote:
> On 01/30/2013 05:13 PM, Leo White wrote:
>>> Do you really mean using a single > as the closing delimiter in the
>>> first case?
>>
>> You're right that should really be ">>".
> 
> Same problem:
> 
> let ( >> ) = ( lsr ) in
> << foo >> 2 >>
> 
>>> >> is also a valid binary operator, by the way.
>>>
>>
>> Yes, but it is also listed as a keyword, so it is probably fine to
>> appropriate it.
> 
> The manual says:
> 
> ""
> Note that the following identifiers are keywords of the Camlp4 extensions and should be avoided for compatibility reasons.
> 
>     parser    <<    <:    >>    $     $$    $:
> ""
> 
>>> and << are really not keywords of OCaml, and I wouldn't be surprised they are actually used as operators.

>> is used by OCamlnet:
http://projects.camlcity.org/projects/dl/ocamlnet-3.5.1/doc/html-main/Uq_engines.Operators.html


--Edwin

From info@gerd-stolpmann.de  Wed Jan 30 18:59:27 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A4F903C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 18:59:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.187 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.187]:51222)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0cwq-0007KF-SO (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Wed, 30 Jan 2013 19:03:54 +0000
Received: from office1.lan.sumadev.de (dslb-084-059-064-232.pools.arcor-ip.net
 [84.59.64.232])
 by mrelayeu.kundenserver.de (node=mreu4) with ESMTP (Nemesis)
 id 0MZK7E-1UH2q23i2u-00KzXi; Wed, 30 Jan 2013 20:03:51 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 7284AC00CF;
 Wed, 30 Jan 2013 20:03:50 +0100 (CET)
Date: Wed, 30 Jan 2013 20:03:49 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: =?iso-8859-1?b?VPZy9ms=?= Edwin <edwin+ml-ocaml@etorok.net>
References: <51095364.9080001@frisch.fr> <5109591C.8060108@etorok.net>
In-Reply-To: <5109591C.8060108@etorok.net> (from edwin+ml-ocaml@etorok.net
 on Wed Jan 30 18:32:12 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359572629.10634.16@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-15; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:APYNeovBd0wdZABMwUFlRz01Ulv+/FQmv3TBoSFi6YJ
 iBxCMilneA1njiMydgdR1M9jwThdWGqv3n+vLmpDwRbv0B8yhR
 +Wxv7S4Yap5d1bzsL5kXHbmheV2ws/pWzxB6fMiK8SXsM3A7kE
 T3oBklFs8OjG7Jm9etka5/KjMs40xpLsdaWNRAmMaLRLN8YSCK
 bZSCrPqB4H/CK3UE5uZ+J+xdgX7n3+avyWtPlHkqC5+4CpO/DE
 vvMxQw1cGQcDmQzo+Y31YC02Fljeoe14xAFhHMZuJQ7AlOR+nO
 3CoPqNdSIEuafmVxmTdWf9xozSPjJTZgFDvTzxVM+9qAEHHptb
 qIfTtNv4EUM1L07dgWVE=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 18:59:27 -0000

Am 30.01.2013 18:32:12 schrieb(en) T=F6r=F6k Edwin:
> On 01/30/2013 07:07 PM, Alain Frisch wrote:
> > On 01/30/2013 05:13 PM, Leo White wrote:
> >>> Do you really mean using a single > as the closing delimiter in =20
> the
> >>> first case?
> >>
> >> You're right that should really be ">>".
> >
> > Same problem:
> >
> > let ( >> ) =3D ( lsr ) in
> > << foo >> 2 >>
> >
> >>> >> is also a valid binary operator, by the way.
> >>>
> >>
> >> Yes, but it is also listed as a keyword, so it is probably fine to
> >> appropriate it.
> >
> > The manual says:
> >
> > ""
> > Note that the following identifiers are keywords of the Camlp4 =20
> extensions and should be avoided for compatibility reasons.
> >
> >     parser    <<    <:    >>    $     $$    $:
> > ""
> >
> >>> and << are really not keywords of OCaml, and I wouldn't be =20
> surprised they are actually used as operators.
>=20
> >> is used by OCamlnet:
> http://projects.camlcity.org/projects/dl/ocamlnet-3.5.1/doc/html-main/Uq_=
engines.Operators.html

I was not aware of the problem when choosing operators - I looked more =20
at precedence and associativity.

I think we shouldn't make the choice dependent on individual cases. =20
Just figure something out that is consistent in itself, good to read, =20
and permits enough freedom.

Gerd


>=20
> --Edwin
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
>=20



--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From info@gerd-stolpmann.de  Wed Jan 30 19:22:51 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1A2C63C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 19:22:51 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.186 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.186]:52299)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0dJU-0000ev-YK (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Wed, 30 Jan 2013 19:27:17 +0000
Received: from office1.lan.sumadev.de (dslb-084-059-064-232.pools.arcor-ip.net
 [84.59.64.232])
 by mrelayeu.kundenserver.de (node=mreu1) with ESMTP (Nemesis)
 id 0LckOB-1Uk6kf2lb5-00jTMN; Wed, 30 Jan 2013 20:27:14 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 4A966C00CF;
 Wed, 30 Jan 2013 20:27:14 +0100 (CET)
Date: Wed, 30 Jan 2013 20:27:13 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Alain Frisch <alain@frisch.fr>
In-Reply-To: <51092C60.5000003@frisch.fr> (from alain@frisch.fr on Wed Jan
 30 15:21:20 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359574033.10634.17@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-15; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:dCLTpTMfYAL+RAoniQa3+aUXRFv+5nph+kBZEnGXd2V
 AA62mKbtQuvWmAxdGg6w+7/HJkY805dlDCCMkmrcd2vQOwtngJ
 AkBc6B6iIPpkVJBL1xp4rB/eK9kiOmTDnL4IZj/ACzy+78CIxX
 zqAPPNk41alvfQtz++GdNPudqKXoTvvznFJQZops90a7rcbetp
 oo9N2L1+h0XDtgvRcqaICxyR8uBk1/jTnkgF6kfk058GpRXnVt
 9SI1jzk8Ha/Icd2vhSNcFW2e+qr8eEXZJYDz/E79C+Mk2IIgS4
 DNxWUp24EGUFb3zlE90MmZ0T83X0Tbw1UL1SvF36tbAlGoupcX
 gtPr9bPlPh9e1+fFWuVw=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Editor support for syntax extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 19:22:51 -0000

Am 30.01.2013 15:21:20 schrieb(en) Alain Frisch:
> On 01/30/2013 12:19 PM, T=F6r=F6k Edwin wrote:
>> I still get syntax highlighting and matching parens in both vim and =20
>> emacs for the above (although maybe antiquotations would confuse it):
>=20
> Highlighting gets completely wrong as soon as you start e.g. using =20
> double quotes. And indentation is just impossible if the editor isn't =20
> aware of the grammar implemented by the extensions.  One could =20
> certainly try to fix this and introduce more tools, complexity and =20
> border cases. But I still fail to see the real benefits of allowing =20
> very customized syntax which would justify such efforts.  The whole =20
> point of -ppx versus camlp4 is precisely to stop messing up with the =20
> concrete syntax: define some generic enough extension points, and =20
> just work with a fixed concrete syntax.  I'd prefer to see dead =20
> simple solutions adopted for -ppx, and more advanced stuff (based on =20
> concrete syntax) left to camlp4/fan.
>=20
>> 4. What syntax extensions to use =3D> define in the source code
>>=20
>> This has already been mentioned that the source file could define =20
>> what syntax extensions it uses, so it works for all build systems =20
>> (ocamlbuild, makefiles, omake), etc.
>> It may not even need special support from the compiler: there could =20
>> be a -ppx that finds these pragmas and loads those other -ppx on its =20
>> own!
>=20
> I've started something along these lines:
>=20
> https://github.com/alainfrisch/ppx_drivers
>=20
> Exactly how this works with ocamlfind needs to be discussed.  I know =20
> Gerd has some ideas!

Well, I had some private discussions with Alain before this list =20
started.

A central point is that the ppx driver and ocamlfind remain separate =20
software projects. You need the ability to use ppx preprocessors =20
without ocamlfind, and the role of ocamlfind is "only" to make it more =20
user-friendly. This should be similar to normal library lookup - where =20
ocamlfind finally generates only a command where many details are =20
filled in.

Alain had the idea to include the names of the preprocessors directly =20
in the source text. He chose the syntax

include PPX(First_ppx_processor)(Second_ppx_processor)

Well, we probably can now select something better, not reusing the =20
"include" notation for something that is not "include". Maybe let's =20
prefer now

(:PPX "first_ppx_preprocessor" "second_ppx_preprocessor")

just to pick the current discussion up. The task of the ppx driver is =20
to interpret these directives, and to run the preprocessors in the =20
right order as subcommands (or, if the platform supports it, as =20
plugins).

Ocamlfind integration: The problem here is that such a directive needs =20
to be forwarded to ocamlfind in order to figure the details out. This =20
would need a relatively tight coupling between the ppx driver and =20
ocamlfind. In order to avoid that the ppx driver calls ocamlfind for =20
every activated preprocessor, the idea is to make the ppx driver a =20
library, maybe with a single function

preprocess : (string -> string) -> in_channel -> out_channel

The string->string function is the lookup function. It takes a string =20
like "first_ppx_preprocessor" and returns the command to run.

So, that enables us to provide two utilities:

  - ocamlppx: This would be part of the OCaml distribution, and would be
    limited in functionality. In particular, it interprets the ppx =20
strings
    directly as commands (identity as lookup function):

    (:PPX "/path/to/my/ppx/executable maybe arguments")

  - ocamlfind ppx: This version provides extended lookup features.
    You would just use

    (:PPX "package-name")

    and it is ocamlfind's task to look the executable up (or, =20
optionally,
    load a plugin, but the details of the mechanism are hidden from the
    simple user).

Gerd


>=20
> Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20


--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From bobzhang1988@gmail.com  Wed Jan 30 19:35:44 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 628043C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 19:35:44 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.5 from SpamAssassin-3.3.2-1439791 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.44 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f44.google.com ([209.85.212.44]:44755)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0dVv-0007v8-mV (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Wed, 30 Jan 2013 19:40:11 +0000
Received: by mail-vb0-f44.google.com with SMTP id fc26so1255279vbb.3
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 11:40:04 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:message-id:date:from:user-agent:mime-version:to:cc
 :subject:references:in-reply-to:content-type
 :content-transfer-encoding;
 bh=GRH1SgxN62dQ2Q6jhGxRToTvdHgeDNxmmaC7mh3bJMA=;
 b=mORCyadyDfnx4rGxTaX8rIalaOxeqlfx5kc69K3Zmtcs8kghHCmQL0czIzG31Tw4yc
 6ya8rVe4uxaTN5lsyVpS+R2PjPoUm4aKdZ2SgXgT1Ml+h4cz0UP42A55XAwhsUTfDW3k
 1YUocvDWuAgumlH92bsbHyeRzzq7m2xpI/zTz9tFv1NeKTU1umWZGEYIS8aS8IgyimXP
 rM9st7w9p9ZzlTbKcLknvYCkad5w536UYeezseYYsIoeIjBWPOvy8EMcDVxyHnK71ne7
 rlYpZZbx78TecQ1tq+J3Rgju8g7B1wl7fKq5fAKMvLVsCpn6RVgjOAcnZQIMk75OT3D0
 2FkQ==
X-Received: by 10.220.140.143 with SMTP id i15mr5846105vcu.15.1359574804749;
 Wed, 30 Jan 2013 11:40:04 -0800 (PST)
Received: from seas1482.wireless-pennnet.upenn.edu
 (seas1482.wireless-pennnet.upenn.edu. [158.130.109.204])
 by mx.google.com with ESMTPS id u5sm2103801vef.0.2013.01.30.11.40.03
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Wed, 30 Jan 2013 11:40:03 -0800 (PST)
Message-ID: <51097713.2090602@gmail.com>
Date: Wed, 30 Jan 2013 14:40:03 -0500
From: Hongbo Zhang <bobzhang1988@gmail.com>
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gerd Stolpmann <info@gerd-stolpmann.de>
References: <1359574033.10634.17@samsung>
In-Reply-To: <1359574033.10634.17@samsung>
Content-Type: text/plain; charset=ISO-8859-15; format=flowed
Content-Transfer-Encoding: 8bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Editor support for syntax extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 19:35:44 -0000

On 1/30/13 2:27 PM, Gerd Stolpmann wrote:
Hi Gerd,
    I think delegating ocamlfind for (ppx/camlp4/fan) is a mistake. IMO 
the right way is that
the file itself tells the preprocessor which syntax or plugin it 
wants(with the good default option),
that's how Fan adopted.
> Am 30.01.2013 15:21:20 schrieb(en) Alain Frisch:
>> On 01/30/2013 12:19 PM, Trk Edwin wrote:
>>> I still get syntax highlighting and matching parens in both vim and 
>>> emacs for the above (although maybe antiquotations would confuse it):
>>
>> Highlighting gets completely wrong as soon as you start e.g. using 
>> double quotes. And indentation is just impossible if the editor isn't 
>> aware of the grammar implemented by the extensions.  One could 
>> certainly try to fix this and introduce more tools, complexity and 
>> border cases. But I still fail to see the real benefits of allowing 
>> very customized syntax which would justify such efforts.  The whole 
>> point of -ppx versus camlp4 is precisely to stop messing up with the 
>> concrete syntax: define some generic enough extension points, and 
>> just work with a fixed concrete syntax.  I'd prefer to see dead 
>> simple solutions adopted for -ppx, and more advanced stuff (based on 
>> concrete syntax) left to camlp4/fan.
>>
>>> 4. What syntax extensions to use => define in the source code
>>>
>>> This has already been mentioned that the source file could define 
>>> what syntax extensions it uses, so it works for all build systems 
>>> (ocamlbuild, makefiles, omake), etc.
>>> It may not even need special support from the compiler: there could 
>>> be a -ppx that finds these pragmas and loads those other -ppx on its 
>>> own!
>>
>> I've started something along these lines:
>>
>> https://github.com/alainfrisch/ppx_drivers
>>
>> Exactly how this works with ocamlfind needs to be discussed.  I know 
>> Gerd has some ideas!
>
> Well, I had some private discussions with Alain before this list started.
>
> A central point is that the ppx driver and ocamlfind remain separate 
> software projects. You need the ability to use ppx preprocessors 
> without ocamlfind, and the role of ocamlfind is "only" to make it more 
> user-friendly. This should be similar to normal library lookup - where 
> ocamlfind finally generates only a command where many details are 
> filled in.
>
> Alain had the idea to include the names of the preprocessors directly 
> in the source text. He chose the syntax
>
> include PPX(First_ppx_processor)(Second_ppx_processor)
>
> Well, we probably can now select something better, not reusing the 
> "include" notation for something that is not "include". Maybe let's 
> prefer now
>
> (:PPX "first_ppx_preprocessor" "second_ppx_preprocessor")
>
> just to pick the current discussion up. The task of the ppx driver is 
> to interpret these directives, and to run the preprocessors in the 
> right order as subcommands (or, if the platform supports it, as plugins).
>
> Ocamlfind integration: The problem here is that such a directive needs 
> to be forwarded to ocamlfind in order to figure the details out. This 
> would need a relatively tight coupling between the ppx driver and 
> ocamlfind. In order to avoid that the ppx driver calls ocamlfind for 
> every activated preprocessor, the idea is to make the ppx driver a 
> library, maybe with a single function
>
> preprocess : (string -> string) -> in_channel -> out_channel
>
> The string->string function is the lookup function. It takes a string 
> like "first_ppx_preprocessor" and returns the command to run.
>
> So, that enables us to provide two utilities:
>
>  - ocamlppx: This would be part of the OCaml distribution, and would be
>    limited in functionality. In particular, it interprets the ppx strings
>    directly as commands (identity as lookup function):
>
>    (:PPX "/path/to/my/ppx/executable maybe arguments")
>
>  - ocamlfind ppx: This version provides extended lookup features.
>    You would just use
>
>    (:PPX "package-name")
>
>    and it is ocamlfind's task to look the executable up (or, optionally,
>    load a plugin, but the details of the mechanism are hidden from the
>    simple user).
>
> Gerd
>
>
>>
>> Alain
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>>
>
>


From info@gerd-stolpmann.de  Wed Jan 30 19:47:45 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id CFB6E3C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 19:47:45 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.171 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.171]:51173)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0dhb-0008Ny-Xe (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Wed, 30 Jan 2013 19:52:12 +0000
Received: from office1.lan.sumadev.de (dslb-084-059-064-232.pools.arcor-ip.net
 [84.59.64.232])
 by mrelayeu.kundenserver.de (node=mreu3) with ESMTP (Nemesis)
 id 0Mf6wH-1UK4EV3ALp-00OXjW; Wed, 30 Jan 2013 20:52:11 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 5AF28C00CF;
 Wed, 30 Jan 2013 20:52:10 +0100 (CET)
Date: Wed, 30 Jan 2013 20:52:09 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Hongbo Zhang <bobzhang1988@gmail.com>
References: <1359574033.10634.17@samsung> <51097713.2090602@gmail.com>
In-Reply-To: <51097713.2090602@gmail.com> (from bobzhang1988@gmail.com on
 Wed Jan 30 20:40:03 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359575529.10634.18@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-15; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:IPbnqLgWuEYKYptx6MifKjxJSMVU88CxKzlDb/EHwrA
 JXjZxuGNLI7IsjNnCf0XmCi0ANdcOI21Ry6mSRVN3711MysZN4
 q1eUx0O/0Dn8vCEO8TNRb8P/kgL1/WKaFjdmtXLJfXn4QdacKR
 waYpRYpLbElu4MZ8jFXZkli2phPHohEWWRIqKAHJokjN8Ks4lC
 l9/cpP795qW4OibPGFmvWbKimIrfuV8kIyqlZaqjG/2PtC6b15
 xSKGs3zPZMuXEliXxAD+dyOkF/sZKdbEbNagzpxbC9EwstRVd8
 KOC+qtijT8WvpFUQqy1HyEeCRqXjx1G6qLB7H8miVSFsul7+U0
 VGm7Zsk1OL7z4ilmSpEk=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Editor support for syntax extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 19:47:45 -0000

Am 30.01.2013 20:40:03 schrieb(en) Hongbo Zhang:
> On 1/30/13 2:27 PM, Gerd Stolpmann wrote:
> Hi Gerd,
>    I think delegating ocamlfind for (ppx/camlp4/fan) is a mistake. =20
> IMO the right way is that
> the file itself tells the preprocessor which syntax or plugin it wants

Ahem, that's what I described. ocamlfind's task is only to figure out =20
the details (especially where the command or plugin is installed).

Gerd

> (with the good default option),
> that's how Fan adopted.
>> Am 30.01.2013 15:21:20 schrieb(en) Alain Frisch:
>>> On 01/30/2013 12:19 PM, T=F6r=F6k Edwin wrote:
>>>> I still get syntax highlighting and matching parens in both vim =20
>>>> and emacs for the above (although maybe antiquotations would =20
>>>> confuse it):
>>>=20
>>> Highlighting gets completely wrong as soon as you start e.g. using =20
>>> double quotes. And indentation is just impossible if the editor =20
>>> isn't aware of the grammar implemented by the extensions.  One =20
>>> could certainly try to fix this and introduce more tools, =20
>>> complexity and border cases. But I still fail to see the real =20
>>> benefits of allowing very customized syntax which would justify =20
>>> such efforts.  The whole point of -ppx versus camlp4 is precisely =20
>>> to stop messing up with the concrete syntax: define some generic =20
>>> enough extension points, and just work with a fixed concrete =20
>>> syntax.  I'd prefer to see dead simple solutions adopted for -ppx, =20
>>> and more advanced stuff (based on concrete syntax) left to =20
>>> camlp4/fan.
>>>=20
>>>> 4. What syntax extensions to use =3D> define in the source code
>>>>=20
>>>> This has already been mentioned that the source file could define =20
>>>> what syntax extensions it uses, so it works for all build systems =20
>>>> (ocamlbuild, makefiles, omake), etc.
>>>> It may not even need special support from the compiler: there =20
>>>> could be a -ppx that finds these pragmas and loads those other =20
>>>> -ppx on its own!
>>>=20
>>> I've started something along these lines:
>>>=20
>>> https://github.com/alainfrisch/ppx_drivers
>>>=20
>>> Exactly how this works with ocamlfind needs to be discussed.  I =20
>>> know Gerd has some ideas!
>>=20
>> Well, I had some private discussions with Alain before this list =20
>> started.
>>=20
>> A central point is that the ppx driver and ocamlfind remain separate =20
>> software projects. You need the ability to use ppx preprocessors =20
>> without ocamlfind, and the role of ocamlfind is "only" to make it =20
>> more user-friendly. This should be similar to normal library lookup =20
>> - where ocamlfind finally generates only a command where many =20
>> details are filled in.
>>=20
>> Alain had the idea to include the names of the preprocessors =20
>> directly in the source text. He chose the syntax
>>=20
>> include PPX(First_ppx_processor)(Second_ppx_processor)
>>=20
>> Well, we probably can now select something better, not reusing the =20
>> "include" notation for something that is not "include". Maybe let's =20
>> prefer now
>>=20
>> (:PPX "first_ppx_preprocessor" "second_ppx_preprocessor")
>>=20
>> just to pick the current discussion up. The task of the ppx driver =20
>> is to interpret these directives, and to run the preprocessors in =20
>> the right order as subcommands (or, if the platform supports it, as =20
>> plugins).
>>=20
>> Ocamlfind integration: The problem here is that such a directive =20
>> needs to be forwarded to ocamlfind in order to figure the details =20
>> out. This would need a relatively tight coupling between the ppx =20
>> driver and ocamlfind. In order to avoid that the ppx driver calls =20
>> ocamlfind for every activated preprocessor, the idea is to make the =20
>> ppx driver a library, maybe with a single function
>>=20
>> preprocess : (string -> string) -> in_channel -> out_channel
>>=20
>> The string->string function is the lookup function. It takes a =20
>> string like "first_ppx_preprocessor" and returns the command to run.
>>=20
>> So, that enables us to provide two utilities:
>>=20
>>  - ocamlppx: This would be part of the OCaml distribution, and would =20
>> be
>>    limited in functionality. In particular, it interprets the ppx =20
>> strings
>>    directly as commands (identity as lookup function):
>>=20
>>    (:PPX "/path/to/my/ppx/executable maybe arguments")
>>=20
>>  - ocamlfind ppx: This version provides extended lookup features.
>>    You would just use
>>=20
>>    (:PPX "package-name")
>>=20
>>    and it is ocamlfind's task to look the executable up (or, =20
>> optionally,
>>    load a plugin, but the details of the mechanism are hidden from =20
>> the
>>    simple user).
>>=20
>> Gerd
>>=20
>>=20
>>>=20
>>> Alain
>>> _______________________________________________
>>> wg-camlp4 mailing list
>>> wg-camlp4@lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/wg-camlp4
>>>=20
>>=20
>>=20
>=20
>=20


--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From anil@recoil.org  Wed Jan 30 20:12:16 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 086E53C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 20:12:16 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:23048
 helo=dark.recoil.org)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with smtp id 1U0e5J-0001lo-p5 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Wed, 30 Jan 2013 20:16:42 +0000
Received: (qmail 11419 invoked by uid 634); 30 Jan 2013 20:16:41 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from volstagg-0.srg.cl.cam.ac.uk (HELO [10.0.0.83]) (128.232.32.232)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Wed, 30 Jan 2013 20:16:41 +0000
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <CAPFanBG_UpSjurNeu_y8YcUhhTJStJEhxsuHw5JB7d3g3nKwkA@mail.gmail.com>
Date: Wed, 30 Jan 2013 20:16:45 +0000
Content-Transfer-Encoding: 7bit
Message-Id: <EA439449-2017-4062-A23B-F43A8869840C@recoil.org>
References: <CAPFanBG_UpSjurNeu_y8YcUhhTJStJEhxsuHw5JB7d3g3nKwkA@mail.gmail.com>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A set of synthetic use cases to help discussions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 20:12:16 -0000

I've started approaching this from the other end by instrumenting OPAM
to log all the camlp4 invocations during a bulk build.

https://github.com/avsm/opam-camlp4-analysis/wiki

has the raw data of all the *.{cma,cmo,cmx} files mentioned during a
build, and the packages.

This data still needs cleanup, but there are definitely some extensions in
there I don't immediately recognise, so it would be useful to update your
(far more structured) list from this.

-anil

On 30 Jan 2013, at 17:21, Gabriel Scherer <gabriel.scherer@gmail.com> wrote:

> One problem with the current debate(s) is that people have fairly
> different syntaxes and semantics in mind regarding "syntax
> extensions".
> 
> I think we should gather somewhere small snippets of "representative"
> syntax extensions (for example under their current form, which
> includes the Camlp4 syntax extensions but also eg. Lexifi's custom
> attributes syntax or the imaginary quotation system of your liking),
> so that people could refer to those example and concretely demonstrate
> which cases their proposed semantics would capture, and with which
> syntax.
> 
> I have started to put up some examples on the following wiki page,
> mostly by accumulating what has been mentioned during the discussions
> so far:
> 
>  https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases
> 
> I have made up the categories as I collected the examples, so they're
> certainly suboptimal.
> 
> The page should be open for editing (let me know if the right aren't
> set correctly), so that you can update it with new examples if you
> think they are representative of some need that wasn't exposed before.
> Please remember that the page is there to collect use cases for the
> discussion here, rather than contain argumentation/opinion/judgments
> itself.
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
> 


From anil@recoil.org  Wed Jan 30 20:13:02 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B2DB33C082
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 20:13:02 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1439791
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:19379
 helo=dark.recoil.org)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with smtp id 1U0e64-0001va-o5 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Wed, 30 Jan 2013 20:17:29 +0000
Received: (qmail 13893 invoked by uid 634); 30 Jan 2013 20:17:28 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from volstagg-0.srg.cl.cam.ac.uk (HELO [10.0.0.83]) (128.232.32.232)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Wed, 30 Jan 2013 20:17:28 +0000
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <EA439449-2017-4062-A23B-F43A8869840C@recoil.org>
Date: Wed, 30 Jan 2013 20:17:34 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <9A1E1B47-A726-4102-BB90-6290538EE96E@recoil.org>
References: <CAPFanBG_UpSjurNeu_y8YcUhhTJStJEhxsuHw5JB7d3g3nKwkA@mail.gmail.com>
 <EA439449-2017-4062-A23B-F43A8869840C@recoil.org>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A set of synthetic use cases to help discussions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 30 Jan 2013 20:13:02 -0000

Incidentally, the raw logs are also in the repository at:
https://github.com/avsm/opam-camlp4-analysis/tree/master/logs

If anyone needs any more detail of the camlp4 invocations.

-anil

On 30 Jan 2013, at 20:16, Anil Madhavapeddy <anil@recoil.org> wrote:

> I've started approaching this from the other end by instrumenting OPAM
> to log all the camlp4 invocations during a bulk build.
>=20
> https://github.com/avsm/opam-camlp4-analysis/wiki
>=20
> has the raw data of all the *.{cma,cmo,cmx} files mentioned during a
> build, and the packages.
>=20
> This data still needs cleanup, but there are definitely some =
extensions in
> there I don't immediately recognise, so it would be useful to update =
your
> (far more structured) list from this.
>=20
> -anil
>=20
> On 30 Jan 2013, at 17:21, Gabriel Scherer <gabriel.scherer@gmail.com> =
wrote:
>=20
>> One problem with the current debate(s) is that people have fairly
>> different syntaxes and semantics in mind regarding "syntax
>> extensions".
>>=20
>> I think we should gather somewhere small snippets of "representative"
>> syntax extensions (for example under their current form, which
>> includes the Camlp4 syntax extensions but also eg. Lexifi's custom
>> attributes syntax or the imaginary quotation system of your liking),
>> so that people could refer to those example and concretely =
demonstrate
>> which cases their proposed semantics would capture, and with which
>> syntax.
>>=20
>> I have started to put up some examples on the following wiki page,
>> mostly by accumulating what has been mentioned during the discussions
>> so far:
>>=20
>> =
https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases=

>>=20
>> I have made up the categories as I collected the examples, so they're
>> certainly suboptimal.
>>=20
>> The page should be open for editing (let me know if the right aren't
>> set correctly), so that you can update it with new examples if you
>> think they are representative of some need that wasn't exposed =
before.
>> Please remember that the page is there to collect use cases for the
>> discussion here, rather than contain argumentation/opinion/judgments
>> itself.
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>>=20
>=20


From bobzhang1988@gmail.com  Thu Jan 31 04:37:05 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 178C63C082
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 04:37:05 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.182 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f182.google.com ([209.85.220.182]:49032)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0lxs-0004TK-RS (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 04:41:33 +0000
Received: by mail-vc0-f182.google.com with SMTP id fl17so1523532vcb.27
 for <wg-camlp4@lists.ocaml.org>; Wed, 30 Jan 2013 20:41:31 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:date:x-google-sender-auth:message-id
 :subject:from:to:content-type;
 bh=XcrAU4i7JvfKdHdY6Rw+kkzeqJ4ffSWDG8n+y7MYXkQ=;
 b=KpPP2Iu0u3VRBqthJ684JUtrpxHnBkoOtcQeEI86tavm4+g9RouIoYjhytZCgHf3cA
 JPFQ7Zhqfj/pH1BHsl5AQwTLlE2TXXAltH1VJXbyaKFku7h/PGP8Wx5ImWxMPY15KpP5
 1T+rGlHLIqAAlpe41OU+orZlCCqWTZBybFfo+hmfH6pOZ0A0SRCgbXmHEwAjUlDBEJep
 3VNRs7ME/TU1UZc6LziFsx/IWQ4iAVdQwNHpyvHUoEuiOq5yLpXX3KohYjSWdX5pwvfO
 rVwr8L2yrZBmR7RtiHX+QnXyQ+5PYmd4sXiFBwiSa1+njEjgSxfNTztMtymfmGawZRAw
 78vA==
MIME-Version: 1.0
X-Received: by 10.58.240.107 with SMTP id vz11mr2733473vec.45.1359607291572;
 Wed, 30 Jan 2013 20:41:31 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Wed, 30 Jan 2013 20:41:31 -0800 (PST)
Date: Wed, 30 Jan 2013 23:41:31 -0500
X-Google-Sender-Auth: qsBSZg70CDhhVR9QFRXNaBYEtRk
Message-ID: <CANcqPu6UrCeWcr2tqRV76LfAsLcC-o4315FJug0b+TJ87BNqHg@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: wg-camlp4@lists.ocaml.org
Content-Type: multipart/alternative; boundary=047d7bacbff0a5f2e704d48e3d24
Subject: [wg-camlp4] Some challenges when ast rewriter is widely used
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 04:37:05 -0000

--047d7bacbff0a5f2e704d48e3d24
Content-Type: text/plain; charset=ISO-8859-1

Dear all,

    I summarized some possible pitfalls people may encounter here(Ast
Rewriter is also freely available
in Fan but used only in some areas similar to  *bisect*):

* *   1. composition semantics unclear
        suppose we have three plugins A, B, C  which does the Ast rewriting.
        What's the difference between the composition A.B.C  and B.C.A?
        Suppose A a very naive plugin to remove all the unsafe expression,
but B happens to
        introduces an unsafe expression? What should we expect here?

    2. compiling performance downgrading
       so far, Ast Rewriter is always doing global ast transformation which
does a lot of un-necessary transformation,
       suppose you have a series of plugins which does global
transformation ? Maybe it could be improved, but I don't
       see a clever way to fuse plugins.

    3. inconsistent semantics between compiling and toplevel module
        we could also do the Ast transformation in the toplevel, but the
semantics is a bit different, this is also due to the fact
        that we are doing global transformation

    4. upgrading compatibility
        I suggest introducing an Intermediate Ast (for lots of good reasons
I ever mentioned), if we *expose* too much compiler
        API, any change will break all existing plugins. Even though you
use some nice utility like ast_mapper, people
        still use the Constructor name explicitly.
-- 
-- Regards, Hongbo

--047d7bacbff0a5f2e704d48e3d24
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br clear=3D"all"><div>Dear all,</div><div><br></div><div>=A0 =A0 I summari=
zed some possible pitfalls people may encounter here(Ast Rewriter is also f=
reely available=A0</div><div>in Fan but used only in some areas similar to =
=A0<b>bisect</b>):</div>
<div>=A0 =A0=A0</div><div><i>=A0</i> =A0 1. composition semantics unclear</=
div><div>=A0 =A0 =A0 =A0 suppose we have three plugins A, B, C =A0which doe=
s the Ast rewriting.</div><div>=A0 =A0 =A0 =A0 What&#39;s the difference be=
tween the composition A.B.C =A0and B.C.A?</div>
<div>=A0 =A0 =A0 =A0 Suppose A a very naive plugin to remove all the unsafe=
 expression, but B happens to=A0</div><div>=A0 =A0 =A0 =A0 introduces an un=
safe expression? What should we expect here?</div><div>=A0 =A0 =A0 =A0=A0</=
div><div>=A0 =A0 2. compiling performance downgrading</div>
<div>=A0 =A0 =A0 =A0so far, Ast Rewriter is always doing global ast transfo=
rmation which does a lot of un-necessary transformation,=A0</div><div>=A0 =
=A0 =A0 =A0suppose you have a series of plugins which does global transform=
ation ? Maybe it could be improved, but I don&#39;t</div>
<div>=A0 =A0 =A0 =A0see a clever way to fuse plugins.</div><div><br></div><=
div>=A0 =A0 3. inconsistent semantics between compiling and toplevel module=
=A0</div><div>=A0 =A0 =A0 =A0 we could also do the Ast transformation in th=
e toplevel, but the semantics is a bit different, this is also due to the f=
act</div>
<div>=A0 =A0 =A0 =A0 that we are doing global transformation</div><div>=A0 =
=A0 =A0 =A0</div><div>=A0 =A0 4. upgrading compatibility=A0</div><div>=A0 =
=A0 =A0 =A0 I suggest introducing an Intermediate Ast (for lots of good rea=
sons I ever mentioned), if we *expose* too much compiler</div>
<div>=A0 =A0 =A0 =A0 API, any change will break all existing plugins. Even =
though you use some nice utility like ast_mapper, people</div><div>=A0 =A0 =
=A0 =A0 still use the Constructor name explicitly. =A0=A0</div>-- <br>-- Re=
gards, Hongbo

--047d7bacbff0a5f2e704d48e3d24--

From alain@frisch.fr  Thu Jan 31 08:48:08 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 517443C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 08:48:08 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440304 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:33493
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0psp-0001Mm-s8 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Thu, 31 Jan 2013 08:52:36 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d04 with ME
 id uYsa1k00P3lHbAL03Ysael; Thu, 31 Jan 2013 09:52:35 +0100
Message-ID: <510A30D2.8080209@frisch.fr>
Date: Thu, 31 Jan 2013 09:52:34 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr> <5109591C.8060108@etorok.net>
In-Reply-To: <5109591C.8060108@etorok.net>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 08:48:08 -0000

On 01/30/2013 06:32 PM, Trk Edwin wrote:
>>> is used by OCamlnet:
> http://projects.camlcity.org/projects/dl/ocamlnet-3.5.1/doc/html-main/Uq_engines.Operators.html

  >>=  and =<< are used by Lwt.

I've given it some thought and I don't really buy the argument about a 
smooth transition from camlp4 to -ppx based on implementing exactly the 
same syntax for a given "extension" implemented with both systems and 
then switching from one implementation to another.  First, because few 
Camlp4 extensions are purely implemented with quotations; those who 
actually modify the grammar will require changes to the user side 
anyway.  Second, I strongly believe that -ppx should put less emphasis 
on quotations / unparsed strings, so even things which are currently 
implemented with camlp4 quotations would probably benefit from a switch 
to parsed stuff (attributes or others).  Third, because changing a set 
of delimiters to something else, if really needed, is not too difficult 
to automate.

Alain

From lpw25@hermes.cam.ac.uk  Thu Jan 31 11:44:06 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1F1853C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 11:44:06 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:51625)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0sd7-0001G2-WT (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 11:48:33 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0sd7-0000Iw-1S (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 11:48:33 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 31 Jan 2013 11:48:32 +0000
Date: 31 Jan 2013 11:48:32 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
In-Reply-To: <51095364.9080001@frisch.fr>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 11:44:06 -0000

> >> and << are really not keywords of OCaml, and I wouldn't be surprised 
>they are actually used as operators.  I prefer breaking compatibility 
>with camlp4 than with OCaml.

Thinking about it "<:" is not entirely unproblematic. Since "[<" is a 
single token, [<:foo< .. >>] would be awkward for the lexer.

Even if we abandon the camlp4 syntax for quotations, I still think that 
{:lid {x{ string }x}} is too heavy and inflexible for traditional 
quotations. For example, a JSON quotation would look like:

{:json {<{ {"streetAddress": "21 2nd Street"} }>}}

So I propose the we include 3 template forms:

{: lid expr }
{: lid x< string >x}            (where x is an optional symbol character)
{: lid x| string |x}            (where x is an optional symbol character)

these should be flexible enough to provide a light syntax for all the 
traditional quotations that I know of.

The JSON one can then be:

{:json < {"streetAddress": "21 2nd Street"} >}

As a side-note, I think that we should use {: .. } rather than (: .. ) 
because it stands out more. If you remove the ":" ( lid expr ) is still a 
valid expression but { lid expr } isn't.


From alain@frisch.fr  Thu Jan 31 12:23:51 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D46A43C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 12:23:51 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440304 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:43725
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0tFc-0005nN-Wm (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Thu, 31 Jan 2013 12:28:20 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d30 with ME
 id ucUK1k00G3lHbAL03cUKVD; Thu, 31 Jan 2013 13:28:19 +0100
Message-ID: <510A6362.8070504@frisch.fr>
Date: Thu, 31 Jan 2013 13:28:18 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 12:23:51 -0000

On 01/31/2013 12:48 PM, Leo White wrote:
>> >> and << are really not keywords of OCaml, and I wouldn't be
>> surprised they are actually used as operators.  I prefer breaking
>> compatibility with camlp4 than with OCaml.
>
> Thinking about it "<:" is not entirely unproblematic. Since "[<" is a
> single token, [<:foo< .. >>] would be awkward for the lexer.
>
> Even if we abandon the camlp4 syntax for quotations

Hurrah :-)

>, I still think that
> {:lid {x{ string }x}} is too heavy and inflexible for traditional
> quotations. For example, a JSON quotation would look like:
>
> {:json {<{ {"streetAddress": "21 2nd Street"} }>}}

I would write this:

(:json {{ {"streetAddress": "21 2nd Street"} }})

And if we keep the "end marker" in the AST, this could be:

{json{ {"streetAddress": "21 2nd Street"} }json}


But maybe we should take a step back, and really ask ourselves why we 
should use concrete JSON syntax here.  Other possibilities:


1. Write the JSON AST directly as regular OCaml code:

  Json.(M["streetAdress", S "21 2snd Street"])

  (assuming module Json export constructors M and S.)

2. Use "parsed" OCaml syntax, with some -ppx filter mapping it to JSON AST:

  (:json { streetAddress: "21 2snd Street" })

(which would expand to the version above)


3. Use a JSON parser (if we don't need "anti-quotations"):

   parse_json "{\"streetAddress\": \"21 2nd Street\"}"

   or:

   parse_json {{ {"streetAddress: "21 2nd Street"} }}


 From all the uses of Camlp4 I've seen listed since the beginning of 
this discussion, I can imagine using at some point almost each of them, 
except those which are basically "just" about quoting fragments of 
external languages in their native syntax.  I just don't see the real 
benefits.

It would be useful to get feedback from users: do people actually use 
pa_tyxml, pa_json, etc, and do they consider this is really better than 
proposed alternatives?


Alain

From lpw25@hermes.cam.ac.uk  Thu Jan 31 12:38:19 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 10D563C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 12:38:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:50977)
 by ppsw-43.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0tTb-0001cN-o2 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 12:42:47 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0tTb-00085s-FO (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 12:42:47 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 31 Jan 2013 12:42:47 +0000
Date: 31 Jan 2013 12:42:47 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
In-Reply-To: <510A6362.8070504@frisch.fr>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 12:38:19 -0000


>> {:json {<{ {"streetAddress": "21 2nd Street"} }>}}
>
>I would write this:
>
>(:json {{ {"streetAddress": "21 2nd Street"} }})
>

My original example included a "}}" in the JSON itself, I removed it by 
accident when shortening the example.


From gabriel.scherer@gmail.com  Thu Jan 31 12:41:13 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4FC5F3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 12:41:13 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.45 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f45.google.com ([209.85.214.45]:33827)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0tWO-0005aG-ZQ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 31 Jan 2013 12:45:42 +0000
Received: by mail-bk0-f45.google.com with SMTP id i18so1309917bkv.4
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 04:45:40 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:from:date:message-id:subject:to:cc
 :content-type; bh=rW04OGwoJ0pkvN4mOgb7R6kes7Xda4Xo50tf4Bj3z1c=;
 b=gBSNWE7dioI/p2P3ItalVHeCxnNPbkFeim/cYujw1ATpwKIB+nVXego8q6DTuT2e6F
 CCEGcQmfX0nKrnpXFcv8LLPk07Bw0Hijik8pwkYqCocRVGk6EZpEgixm4TjPN9zd0K5h
 7b28PxLx1ZxOG98/gEOn97RENRNBt3XuR7aJBSu3+dV2ljBIFTSf4dO899kMRgjxVpIP
 PL7wolskwv2j9/t60i3bTNlJGRztOpq+6lXhO2frjX/JjRudqd9CQWucJAMam2/6QE/g
 sOLAJsTjZynfpV3Rnwx60ntUlwiFsq0yJ60XEZBtKglnxH9VZYySTXV6+FzgVyvfH5qr
 HXxQ==
X-Received: by 10.204.9.16 with SMTP id j16mr2243020bkj.53.1359636340463; Thu,
 31 Jan 2013 04:45:40 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.236.134 with HTTP; Thu, 31 Jan 2013 04:44:59 -0800 (PST)
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 31 Jan 2013 13:44:59 +0100
Message-ID: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
Cc: Alain Frisch <alain@frisch.fr>
Subject: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 12:41:13 -0000

> From all the uses of Camlp4 I've seen listed since the beginning of this
> discussion, I can imagine using at some point almost each of them, except
> those which are basically "just" about quoting fragments of external
> languages in their native syntax.  I just don't see the real benefits.
>
> It would be useful to get feedback from users: do people actually use
> pa_tyxml, pa_json, etc, and do they consider this is really better than
> proposed alternatives?
>
>
> Alain

The point of quoting foreign languages is to translate them into a
form that exercize the OCaml type-checker to produce rich typing
information. With (parse_json "...") you have no static typing
information on the parsed value, while with a quotation you can expect
to get, say, a (< streetAdress : string > Json.t) expression.
Supporting antiquotations there allows you to write those foreign
values in a composable way, eg. using <:json< { streetAddress: $addr$
} >> with (addr : string Json.t).

This is essentially a nice concrete syntax on top of the typed
combinators (point 1. in your message quoted below); indeed, good
extensions should embed as few domain knowledge as possible and defer
that to the pure-ocaml library providing the combinators. That is not
always possible, however, when you want to express rich binding
structures in a typed way (for example the support of GROUP BY in a
finely-typed way in Macaque relies on clever Camlp4 expansion
strategies.

Furthermore, the bare approach of using combinators directly is not
always desirable in situations where you want the code to be used by
non-domain-experts. "Templates" in web programming are an entire
cottage industry made of preprocessing HTML-looking quasiquotations,
to help the role separation between designers and programmers. More
generally, if there is a widely accepted domain-specific notation,
your domain-specific library should have a way to support it (so that
you can, for example, call over SQL tuning experts to comment on the
performance optimization of the database queries embedded in your
OCaml code).

This is maybe less visible for non-programmable data description
languages such as JSON, but I suspect this still holds. For example,
if you distribute a protocol library built on top of JSON and bridging
over many programming languages, you want the same maintainer to be
able to quickly reflect changes to the protocol schema over all
implements. This is vastly easier if they respect the domain-specific
syntax instead of each having an embedding following the concrete
syntax of the corresponding language.

On Thu, Jan 31, 2013 at 1:28 PM, Alain Frisch <alain@frisch.fr> wrote:
> On 01/31/2013 12:48 PM, Leo White wrote:
>>>
>>> >> and << are really not keywords of OCaml, and I wouldn't be
>>> surprised they are actually used as operators.  I prefer breaking
>>> compatibility with camlp4 than with OCaml.
>>
>>
>> Thinking about it "<:" is not entirely unproblematic. Since "[<" is a
>> single token, [<:foo< .. >>] would be awkward for the lexer.
>>
>> Even if we abandon the camlp4 syntax for quotations
>
>
> Hurrah :-)
>
>
>> , I still think that
>> {:lid {x{ string }x}} is too heavy and inflexible for traditional
>> quotations. For example, a JSON quotation would look like:
>>
>> {:json {<{ {"streetAddress": "21 2nd Street"} }>}}
>
>
> I would write this:
>
> (:json {{ {"streetAddress": "21 2nd Street"} }})
>
> And if we keep the "end marker" in the AST, this could be:
>
> {json{ {"streetAddress": "21 2nd Street"} }json}
>
>
> But maybe we should take a step back, and really ask ourselves why we should
> use concrete JSON syntax here.  Other possibilities:
>
>
> 1. Write the JSON AST directly as regular OCaml code:
>
>  Json.(M["streetAdress", S "21 2snd Street"])
>
>  (assuming module Json export constructors M and S.)
>
> 2. Use "parsed" OCaml syntax, with some -ppx filter mapping it to JSON AST:
>
>  (:json { streetAddress: "21 2snd Street" })
>
> (which would expand to the version above)
>
>
> 3. Use a JSON parser (if we don't need "anti-quotations"):
>
>   parse_json "{\"streetAddress\": \"21 2nd Street\"}"
>
>   or:
>
>   parse_json {{ {"streetAddress: "21 2nd Street"} }}
>
>
> From all the uses of Camlp4 I've seen listed since the beginning of this
> discussion, I can imagine using at some point almost each of them, except
> those which are basically "just" about quoting fragments of external
> languages in their native syntax.  I just don't see the real benefits.
>
> It would be useful to get feedback from users: do people actually use
> pa_tyxml, pa_json, etc, and do they consider this is really better than
> proposed alternatives?
>
>
> Alain
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From bobzhang1988@gmail.com  Thu Jan 31 12:42:32 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8BC633C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 12:42:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.47 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f47.google.com ([209.85.212.47]:37663)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0tXg-0006ke-sE (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 12:47:01 +0000
Received: by mail-vb0-f47.google.com with SMTP id e21so1686023vbm.6
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 04:47:00 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=BvYiCdAxLEcL1yGvEY+CJKG2J1Y2qoJKTCxvMl4kw68=;
 b=Fa2ae3sli/UrBTAJL64mJ9CKOfi6AE1tpJH4+TUvFWU9JoW93KRrgLBkE6PccGkna3
 yCrz+DzZQCq1xFOW7JACKaoIy91wdP/y9H/nCENnH6ONIHNMzmiVoOx2dAuuDRVBMge4
 jQY/6cfUGKx1eyV36JF1Z1rZcxGbXwVo7qr2tTombXq7pV4HMMNbwHOlbZLhahqDtsY0
 7hzDt5sZO2n9Ewa0+79AiZ2fJ3hcV/htTYjihR/ZRXAQq9tRSvDrB3hDISq0OB+S7TpN
 m8QuWokeF851wMHICeuQHO2EFnZhPFi0lf2S3Xr+W+A5RHJZJDxNxHsHbdsOkTP70ji8
 YxeQ==
MIME-Version: 1.0
X-Received: by 10.52.21.175 with SMTP id w15mr6879695vde.100.1359636420146;
 Thu, 31 Jan 2013 04:47:00 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Thu, 31 Jan 2013 04:46:59 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
Date: Thu, 31 Jan 2013 07:46:59 -0500
X-Google-Sender-Auth: i1R3FzSIPpnPxTFdVfE3RmlAz-s
Message-ID: <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=20cf307c9bbad8b64804d495050a
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 12:42:32 -0000

--20cf307c9bbad8b64804d495050a
Content-Type: text/plain; charset=ISO-8859-1

why should we introduce so many  concrete syntax notation here?

In Fan,
{:json| ... |}
if "|}" is used inside,* the user (optionally) can introduce a new
separator following "|" immediately*
{:json|/ ... /|}

On Thu, Jan 31, 2013 at 7:42 AM, Leo White <lpw25@cam.ac.uk> wrote:

>
>  {:json {<{ {"streetAddress": "21 2nd Street"} }>}}
>>>
>>
>> I would write this:
>>
>> (:json {{ {"streetAddress": "21 2nd Street"} }})
>>
>>
> My original example included a "}}" in the JSON itself, I removed it by
> accident when shortening the example.
>
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>



-- 
-- Regards, Hongbo

--20cf307c9bbad8b64804d495050a
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

why should we introduce so many =A0concrete syntax notation here?<div><br><=
/div><div>In Fan,<br><div>{:json| ... |}</div><div>if &quot;|}&quot; is use=
d inside,<b> the user (optionally) can introduce a new separator following =
&quot;|&quot; immediately</b></div>
<div>{:json|/ ... /|} =A0<br><br><div class=3D"gmail_quote">On Thu, Jan 31,=
 2013 at 7:42 AM, Leo White <span dir=3D"ltr">&lt;<a href=3D"mailto:lpw25@c=
am.ac.uk" target=3D"_blank">lpw25@cam.ac.uk</a>&gt;</span> wrote:<br><block=
quote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc=
 solid;padding-left:1ex">
<div class=3D"im"><br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><blockquote class=3D"gmail_quote" style=3D"m=
argin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
{:json {&lt;{ {&quot;streetAddress&quot;: &quot;21 2nd Street&quot;} }&gt;}=
}<br>
</blockquote>
<br>
I would write this:<br>
<br>
(:json {{ {&quot;streetAddress&quot;: &quot;21 2nd Street&quot;} }})<br>
<br>
</blockquote>
<br></div>
My original example included a &quot;}}&quot; in the JSON itself, I removed=
 it by accident when shortening the example.<div class=3D"HOEnZb"><div clas=
s=3D"h5"><br>
<br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo
</div></div>

--20cf307c9bbad8b64804d495050a--

From alain.frisch@lexifi.com  Thu Jan 31 12:50:06 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 92E9C3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 12:50:06 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440304 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:49799
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0tf1-0007Eh-n8 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 31 Jan 2013 12:54:35 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d30 with ME
 id ucua1k00R3lHbAL03cua1z; Thu, 31 Jan 2013 13:54:34 +0100
Message-ID: <510A6989.80706@lexifi.com>
Date: Thu, 31 Jan 2013 13:54:33 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <CANcqPu4CnjsJcVWTK3N0Q9iEMLWzHWtRM41u6EKRYX2T1we0wQ@mail.gmail.com>
In-Reply-To: <CANcqPu4CnjsJcVWTK3N0Q9iEMLWzHWtRM41u6EKRYX2T1we0wQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 12:50:06 -0000

On 01/30/2013 02:18 PM, Hongbo Zhang wrote:
> Ast Rewriter is *bad *for arbitrary code generation, its neat case is
> something like bisect.

One of the most widely used kind of Camlp4 extensions today is about 
code generation based on type declarations (plus some annotations),  la 
type-conv or deriving.  This seems to be a perfect match for AST 
rewriters plus attributes.  Don't you agree?

> And Ast Rewriter is not composable at  all,
> suppose you have two AST Rewriters A,B ,there are no guarantee that  A.B
> == B.A, it just gives you an illusion that it works, probably it
> silently fails.

I don't agree.  A and B are functions from AST to AST, so there is a 
very nice notion of composition: the composition of functions.  It is 
true that A.B and B.A don't have the same behavior but at least, I can 
understand what A.B and B.A will do as soon as I know how A and B behave 
individually, without having to know anything about their implementation.

This is very different from camlp4's model of letting extensions patch a 
common grammar in place, by removing rules and injecting new ones which 
can (partially) hide existing ones.  The order in which those updates to 
the grammar are applied also matters, and it is impossible to know how 
the combination of two extension behaves without knowing precisely how 
they are implemented.

I know you have projects to provide a cleaner functional API for 
grammars, but I don't see how modifications of the concrete syntax can 
be combined, in full generality, in a predictable way.  It seems you 
also have plans to get rid of the ability to modify the concrete syntax. 
  This sounds very reasonable to me.

>     3. How do you implement the expander?  Somehow, you need to parse
>     the content of the quotation (stored as a string in the AST), which
>     involves non trivial stuff, like a parser being able to parse OCaml
>     code mixed with something else.  Personally, I don't know how to
>     implement the quotation expander with the parsing technologies I'm
>     familiar with.
>
> when you design your DSL, the left part is pretty easy to parse, when
> you see the delimiter "->", invoking an existing parser.

So you need to:

  - Write a custom parser for left parts (regexps), which stops at "->".
To write this parser, you need to use ocamlyacc, menhir, or another 
tool. (And probably plug the official OCaml lexer?)
  - Call the official(?) OCaml parser on its "expr" entry and hope that 
it stops exactly when it encounters the next "|" (does this really work?).
  - Adapt the locations returned by this parser, or be careful to 
initialize the lexbuf with locations that match exactly the concrete 
location of the corresponding part in the original source code.

This seems much more complex than the current implementation of sedlex 
(or a variant of it where regexps would be written with some concrete 
syntax), for no obvious benefit.


Alain



From bobzhang1988@gmail.com  Thu Jan 31 13:02:57 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1A2CB3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:02:57 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.45 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f45.google.com ([209.85.212.45]:35632)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0trR-0006do-XV (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 13:07:26 +0000
Received: by mail-vb0-f45.google.com with SMTP id p1so1719679vbi.4
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 05:07:24 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=+pdxqJAHm5tZLLJzXymnag9kxZrdBB/ImWGVoAITbSI=;
 b=A6CVWtYuG/eD2tTtYc1dUdzaYsjyqMAoVUZPiAJHamr3SfQYuDDlUKJDOsQAi9cIeU
 kFqdKOztyHIqzkgzTNBqj+tCWM8z3A2uMss6qbUJYy2Xsfx0gCp2a/F6qF/RfDyUbKfi
 r7HuU1EJOAGsZQ6Bgm3f3t/tL949ou49IVixQ6pJOM//EmkozeggbVXWic2HKZa/dz7A
 Vu1mtzFsgkJADZwIZ18WwmvS3HEJqX7oMBiq23xAw0IWHMCgldobLh0j61TXfk/JGtcm
 FuVQU4QEL85oA6LGPC2j3DWgSnbMvBlGBKYLZGo9SgOKqmmzxyBKvt713MNoFyy1mULC
 +DCw==
MIME-Version: 1.0
X-Received: by 10.52.98.98 with SMTP id eh2mr6919872vdb.64.1359637644584; Thu,
 31 Jan 2013 05:07:24 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Thu, 31 Jan 2013 05:07:24 -0800 (PST)
In-Reply-To: <510A6989.80706@lexifi.com>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <CANcqPu4CnjsJcVWTK3N0Q9iEMLWzHWtRM41u6EKRYX2T1we0wQ@mail.gmail.com>
 <510A6989.80706@lexifi.com>
Date: Thu, 31 Jan 2013 08:07:24 -0500
X-Google-Sender-Auth: ZQ7PsiVc8F9VlsNKsgusw2QwfpQ
Message-ID: <CANcqPu6pHKxgbXoqLBVJ-ZCsOMu46PbHZrW-jNNdWpJTfK8t5A@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=20cf307f380ad4280704d4954e5a
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:02:57 -0000

--20cf307f380ad4280704d4954e5a
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

On Thu, Jan 31, 2013 at 7:54 AM, Alain Frisch <alain.frisch@lexifi.com>wrot=
e:

> On 01/30/2013 02:18 PM, Hongbo Zhang wrote:
>
>> Ast Rewriter is *bad *for arbitrary code generation, its neat case is
>> something like bisect.
>>
>
> One of the most widely used kind of Camlp4 extensions today is about code
> generation based on type declarations (plus some annotations), =E0 la
> type-conv or deriving.  This seems to be a perfect match for AST rewriter=
s
> plus attributes.  Don't you agree?

This could have a even better solution (not global Ast rewriting) in Fan
without introducing any global Ast rewriting.
{:ocaml|
type t =3D A of int
|}
{:derive|(Print,Eq,Meata,...)|}


>
>  And Ast Rewriter is not composable at  all,
>> suppose you have two AST Rewriters A,B ,there are no guarantee that  A.B
>> =3D=3D B.A, it just gives you an illusion that it works, probably it
>> silently fails.
>>
>
> I don't agree.  A and B are functions from AST to AST, so there is a very
> nice notion of composition: the composition of functions.  It is true tha=
t
> A.B and B.A don't have the same behavior but at least, I can understand
> what A.B and B.A will do as soon as I know how A and B behave individuall=
y,
> without having to know anything about their implementation.
>
> For any nontrivial Ast Rewriter, I totally get lost, maybe I am dumb and
you use objects here(ast_mapper) suppose both ast_mapper try to inject some
bindings at the beginning, what do you expect here? Besides, there's no
reason that Ast Rewriter should be pure, once is impure, how shall I reason
the program?

> I know you have projects to provide a cleaner functional API for grammars=
,
> but I don't see how modifications of the concrete syntax can be combined,
> in full generality, in a predictable way.  It seems you also have plans t=
o
> get rid of the ability to modify the concrete syntax.  This sounds very
> reasonable to me.
>
> We have provided purely functional grammars API which helps a lot to limi=
t
the scope of the syntax extension*, if people don't like it, just not
expose it, or write another frontend with fixed grammar.* But we do have a
lot of things that Ast Rewriter does not provide, quasiquotation(which I
think is a *fundamental* difference from ppx), quotation(delimited DSL),
ast rewriter(the same as ppx), type hook(the example I gave before), lexer
hook, and lots other stuff

>
>      3. How do you implement the expander?  Somehow, you need to parse
>>     the content of the quotation (stored as a string in the AST), which
>>     involves non trivial stuff, like a parser being able to parse OCaml
>>     code mixed with something else.  Personally, I don't know how to
>>     implement the quotation expander with the parsing technologies I'm
>>     familiar with.
>>
>> when you design your DSL, the left part is pretty easy to parse, when
>> you see the delimiter "->", invoking an existing parser.
>>
>
> So you need to:
>
>  - Write a custom parser for left parts (regexps), which stops at "->".
> To write this parser, you need to use ocamlyacc, menhir, or another tool.
> (And probably plug the official OCaml lexer?)
>  - Call the official(?) OCaml parser on its "expr" entry and hope that it
> stops exactly when it encounters the next "|" (does this really work?).
>  - Adapt the locations returned by this parser, or be careful to
> initialize the lexbuf with locations that match exactly the concrete
> location of the corresponding part in the original source code.
>
> This is *already implemented in Fan within tens of lines of code,* you
are much more experienced than me, so I bet you definitely could parse it!
(I don't consider tens of lines of code is complex.. ) my taste shows that
its notation is much more elegant than sedlex (imho)

> This seems much more complex than the current implementation of sedlex (o=
r
> a variant of it where regexps would be written with some concrete syntax)=
,
> for no obvious benefit.
>
>
> Alain
>
>
>


--=20
-- Regards, Hongbo

--20cf307f380ad4280704d4954e5a
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Thu, Jan 31, 2013 at 7:54 AM, Alain F=
risch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain.frisch@lexifi.com" targ=
et=3D"_blank">alain.frisch@lexifi.com</a>&gt;</span> wrote:<br><blockquote =
class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid=
;padding-left:1ex">
On 01/30/2013 02:18 PM, Hongbo Zhang wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Ast Rewriter is *bad *for arbitrary code generation, its neat case is<br>
something like bisect.<br>
</blockquote>
<br>
One of the most widely used kind of Camlp4 extensions today is about code g=
eneration based on type declarations (plus some annotations), =E0 la type-c=
onv or deriving. =A0This seems to be a perfect match for AST rewriters plus=
 attributes. =A0Don&#39;t you agree?</blockquote>
<div>This could have a even better solution (not global Ast rewriting) in F=
an without introducing any global Ast rewriting.</div><div>{:ocaml|</div><d=
iv>type t =3D A of int</div><div>|}</div><div>{:derive|(Print,Eq,Meata,...)=
|}</div>
<div><br></div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex=
;border-left:1px #ccc solid;padding-left:1ex"><div class=3D"im"><br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
And Ast Rewriter is not composable at =A0all,<br>
suppose you have two AST Rewriters A,B ,there are no guarantee that =A0A.B<=
br>
=3D=3D B.A, it just gives you an illusion that it works, probably it<br>
silently fails.<br>
</blockquote>
<br></div>
I don&#39;t agree. =A0A and B are functions from AST to AST, so there is a =
very nice notion of composition: the composition of functions. =A0It is tru=
e that A.B and B.A don&#39;t have the same behavior but at least, I can und=
erstand what A.B and B.A will do as soon as I know how A and B behave indiv=
idually, without having to know anything about their implementation.<br>

<br></blockquote><div>For any nontrivial Ast Rewriter, I totally get lost, =
maybe I am dumb and you use objects here(ast_mapper) suppose both ast_mappe=
r try to inject some bindings at the beginning, what do you expect here? Be=
sides, there&#39;s no reason that Ast Rewriter should be pure, once is impu=
re, how shall I reason the program? =A0</div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
I know you have projects to provide a cleaner functional API for grammars, =
but I don&#39;t see how modifications of the concrete syntax can be combine=
d, in full generality, in a predictable way. =A0It seems you also have plan=
s to get rid of the ability to modify the concrete syntax. =A0This sounds v=
ery reasonable to me.<div class=3D"im">
<br></div></blockquote><div>We have provided purely functional grammars API=
 which helps a lot to limit the scope of the syntax extension<b>, if people=
 don&#39;t like it, just not expose it, or write another frontend with fixe=
d grammar.</b> But we do have a lot of things that Ast Rewriter does not pr=
ovide, quasiquotation(which I think is a <b>fundamental</b> difference from=
 ppx), quotation(delimited DSL), ast rewriter(the same as ppx), type hook(t=
he example I gave before), lexer hook, and lots other stuff</div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
=A0 =A0 3. How do you implement the expander? =A0Somehow, you need to parse=
<br>
=A0 =A0 the content of the quotation (stored as a string in the AST), which=
<br>
=A0 =A0 involves non trivial stuff, like a parser being able to parse OCaml=
<br>
=A0 =A0 code mixed with something else. =A0Personally, I don&#39;t know how=
 to<br>
=A0 =A0 implement the quotation expander with the parsing technologies I&#3=
9;m<br>
=A0 =A0 familiar with.<br>
<br>
when you design your DSL, the left part is pretty easy to parse, when<br>
you see the delimiter &quot;-&gt;&quot;, invoking an existing parser.<br>
</blockquote>
<br></div>
So you need to:<br>
<br>
=A0- Write a custom parser for left parts (regexps), which stops at &quot;-=
&gt;&quot;.<br>
To write this parser, you need to use ocamlyacc, menhir, or another tool. (=
And probably plug the official OCaml lexer?)<br>
=A0- Call the official(?) OCaml parser on its &quot;expr&quot; entry and ho=
pe that it stops exactly when it encounters the next &quot;|&quot; (does th=
is really work?).<br>
=A0- Adapt the locations returned by this parser, or be careful to initiali=
ze the lexbuf with locations that match exactly the concrete location of th=
e corresponding part in the original source code.<br>
<br></blockquote><div>This is <b>already implemented in Fan within tens of =
lines of code,</b> you are much more experienced than me, so I bet you defi=
nitely could parse it! (I don&#39;t consider tens of lines of code is compl=
ex.. ) my taste shows that its notation is much more elegant than sedlex (i=
mho)</div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
This seems much more complex than the current implementation of sedlex (or =
a variant of it where regexps would be written with some concrete syntax), =
for no obvious benefit.<span class=3D"HOEnZb"><font color=3D"#888888"><br>

<br>
<br>
Alain<br>
<br>
<br>
</font></span></blockquote></div><br><br clear=3D"all"><div><br></div>-- <b=
r>-- Regards, Hongbo

--20cf307f380ad4280704d4954e5a--

From alain.frisch@lexifi.com  Thu Jan 31 13:07:10 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 446D83C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:07:10 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440304 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:24624
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0tvW-0006ZJ-pD (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 31 Jan 2013 13:11:39 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d30 with ME
 id udBe1k00c3lHbAL03dBebd; Thu, 31 Jan 2013 14:11:38 +0100
Message-ID: <510A6D89.9000507@lexifi.com>
Date: Thu, 31 Jan 2013 14:11:37 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
In-Reply-To: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:07:10 -0000

On 01/31/2013 01:44 PM, Gabriel Scherer wrote:
> The point of quoting foreign languages is to translate them into a
> form that exercize the OCaml type-checker to produce rich typing
> information. With (parse_json "...") you have no static typing
> information on the parsed value, while with a quotation you can expect
> to get, say, a (< streetAdress : string > Json.t) expression.
> Supporting antiquotations there allows you to write those foreign
> values in a composable way, eg. using <:json< { streetAddress: $addr$
> } >> with (addr : string Json.t).
>
> This is essentially a nice concrete syntax on top of the typed
> combinators (point 1. in your message quoted below); indeed, good
> extensions should embed as few domain knowledge as possible and defer
> that to the pure-ocaml library providing the combinators.

There are two very different topic here: syntax and type-checking.

Clever type-checking of the DSL can be done either with combinators, and 
when this is not possible, it makes sense to have some "pre-processors" 
doing clever stuff like adding type annotations.  When we write:

  (:json { streetAddress: "21 2snd Street" })

or even:

  (:json M["streetAdress", S "21 2snd Street"])

this can be expanded to something more clever than just untyped 
constructors.  But there is no reason to force using the concrete syntax 
of the foreign language (which is not really true, because you want to 
allow anti-quotations which are not part of that syntax).  The syntax of 
OCaml is rich enough that a lot of other languages can be encoded in it. 
  The downside is that we need to make it clear syntactically that a 
fragment will be interpreted in a special way.  The upside is that no 
"parsing technology" is involved, which simplifies the design (choice of 
a syntax for anti-quotations), the implementation (writing a parser and 
calling back the OCaml parser on anti-quotations, with careful tracking 
of locations) and the user experience (support from editors, learning 
details of a concrete syntax [you might want to write JSON producers on 
an abstract level, and benefit from clever type-checking, but without 
knowing exactly how strings have to be escaped in concrete JSON]).

> Furthermore, the bare approach of using combinators directly is not
> always desirable in situations where you want the code to be used by
> non-domain-experts. "Templates" in web programming are an entire
> cottage industry made of preprocessing HTML-looking quasiquotations,
> to help the role separation between designers and programmers.

When non-programmers have to write some HTML code, this code rarely ends 
up in OCaml source code.  Usually, it stays in its own HTML file, which 
is then processed (statically or dynamically) by the (OCaml) code.

When fragments of JSON/XML/etc are created programatically, this is 
often done "piece by piece", with very small fragments involving a high 
density of anti-quotations.  The benefits of using the foreign syntax 
here are not clear to me.


> This is maybe less visible for non-programmable data description
> languages such as JSON, but I suspect this still holds. For example,
> if you distribute a protocol library built on top of JSON and bridging
> over many programming languages, you want the same maintainer to be
> able to quickly reflect changes to the protocol schema over all
> implements. This is vastly easier if they respect the domain-specific
> syntax instead of each having an embedding following the concrete
> syntax of the corresponding language.

I understand the theoretical argument, but I don't think it would apply 
in practice to many OCaml projects.


Alain

From philippe.veber@gmail.com  Thu Jan 31 13:12:46 2013
Return-Path: <philippe.veber@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 762F63C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:12:46 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.176 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (philippe.veber[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f176.google.com ([209.85.212.176]:56151)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0u0w-0004mb-Re (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <philippe.veber@gmail.com>); Thu, 31 Jan 2013 13:17:15 +0000
Received: by mail-wi0-f176.google.com with SMTP id hm14so3718642wib.3
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 05:17:14 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=gUD95YQuEG1EDji576QYq55ScOM8+K9Vv1IUvFAY/yU=;
 b=kV/9O8DN7frtoTOzitnz086TdlmyZzaYH+VPPirxdPu0h7a2QuPqNY2PD0NisAVM6Q
 HvBJPKe5UXaA18e1USSc9iLik8zj3xIKVMFk8OKAvf84LOgzxiFLt2E7d3xvLN1VoIzO
 d2LsLWc2Mu1uBnk/DbBp2/rcj1uPt9+wrE88U8zwUvtbHVpKzlbCFcwqXRTPuwkWu1zB
 cOldCVtaZ6UpU/GtANI+7QsN8meaMnMTJRjqnQe6FaXa2gNLhHovA1eRjMHKKw/Qz2xk
 fkeH+9Pjvj32GUuaNMmuXBg2iideXb228YCKxWrdeOGtkoSadGC5fMlAm+XQquTutuRn
 4yhg==
X-Received: by 10.194.94.37 with SMTP id cz5mr15397620wjb.49.1359638234250;
 Thu, 31 Jan 2013 05:17:14 -0800 (PST)
MIME-Version: 1.0
Received: by 10.194.104.132 with HTTP; Thu, 31 Jan 2013 05:16:53 -0800 (PST)
In-Reply-To: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
From: Philippe Veber <philippe.veber@gmail.com>
Date: Thu, 31 Jan 2013 14:16:53 +0100
Message-ID: <CAOOOohRzCVwjqk1Ta7zEy476qT6ieStNmSesTGKUBSRpnLcZqw@mail.gmail.com>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: multipart/alternative; boundary=047d7bb03c2af9bd7f04d49571e6
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:12:46 -0000

--047d7bb03c2af9bd7f04d49571e6
Content-Type: text/plain; charset=ISO-8859-1

Not much to add to this, I just wanted to emphasize that the point Gabriel
makes is especially relevant in web programming or database interaction,
because in those area ocaml is not often the first option that comes to
mind. So being able to quote json, sql, html etc in an ocaml source without
unplugging the type checker is real feature. Of course, there are cases
when you build those "foreign" values programmatically, in that case I
concur you're better off without the syntax extension (maybe not always, if
the guest language has some real nice support than cannot be rendered
concisely with ocaml), but there are many times when the antiquotation part
is really small compared to the "constant" fragments. In that case, it may
be desirable to have non-ocaml-programmers work directly on the ml source.

2013/1/31 Gabriel Scherer <gabriel.scherer@gmail.com>

> > From all the uses of Camlp4 I've seen listed since the beginning of this
> > discussion, I can imagine using at some point almost each of them, except
> > those which are basically "just" about quoting fragments of external
> > languages in their native syntax.  I just don't see the real benefits.
> >
> > It would be useful to get feedback from users: do people actually use
> > pa_tyxml, pa_json, etc, and do they consider this is really better than
> > proposed alternatives?
> >
> >
> > Alain
>
> The point of quoting foreign languages is to translate them into a
> form that exercize the OCaml type-checker to produce rich typing
> information. With (parse_json "...") you have no static typing
> information on the parsed value, while with a quotation you can expect
> to get, say, a (< streetAdress : string > Json.t) expression.
> Supporting antiquotations there allows you to write those foreign
> values in a composable way, eg. using <:json< { streetAddress: $addr$
> } >> with (addr : string Json.t).
>
> This is essentially a nice concrete syntax on top of the typed
> combinators (point 1. in your message quoted below); indeed, good
> extensions should embed as few domain knowledge as possible and defer
> that to the pure-ocaml library providing the combinators. That is not
> always possible, however, when you want to express rich binding
> structures in a typed way (for example the support of GROUP BY in a
> finely-typed way in Macaque relies on clever Camlp4 expansion
> strategies.
>
> Furthermore, the bare approach of using combinators directly is not
> always desirable in situations where you want the code to be used by
> non-domain-experts. "Templates" in web programming are an entire
> cottage industry made of preprocessing HTML-looking quasiquotations,
> to help the role separation between designers and programmers. More
> generally, if there is a widely accepted domain-specific notation,
> your domain-specific library should have a way to support it (so that
> you can, for example, call over SQL tuning experts to comment on the
> performance optimization of the database queries embedded in your
> OCaml code).
>
> This is maybe less visible for non-programmable data description
> languages such as JSON, but I suspect this still holds. For example,
> if you distribute a protocol library built on top of JSON and bridging
> over many programming languages, you want the same maintainer to be
> able to quickly reflect changes to the protocol schema over all
> implements. This is vastly easier if they respect the domain-specific
> syntax instead of each having an embedding following the concrete
> syntax of the corresponding language.
>
> On Thu, Jan 31, 2013 at 1:28 PM, Alain Frisch <alain@frisch.fr> wrote:
> > On 01/31/2013 12:48 PM, Leo White wrote:
> >>>
> >>> >> and << are really not keywords of OCaml, and I wouldn't be
> >>> surprised they are actually used as operators.  I prefer breaking
> >>> compatibility with camlp4 than with OCaml.
> >>
> >>
> >> Thinking about it "<:" is not entirely unproblematic. Since "[<" is a
> >> single token, [<:foo< .. >>] would be awkward for the lexer.
> >>
> >> Even if we abandon the camlp4 syntax for quotations
> >
> >
> > Hurrah :-)
> >
> >
> >> , I still think that
> >> {:lid {x{ string }x}} is too heavy and inflexible for traditional
> >> quotations. For example, a JSON quotation would look like:
> >>
> >> {:json {<{ {"streetAddress": "21 2nd Street"} }>}}
> >
> >
> > I would write this:
> >
> > (:json {{ {"streetAddress": "21 2nd Street"} }})
> >
> > And if we keep the "end marker" in the AST, this could be:
> >
> > {json{ {"streetAddress": "21 2nd Street"} }json}
> >
> >
> > But maybe we should take a step back, and really ask ourselves why we
> should
> > use concrete JSON syntax here.  Other possibilities:
> >
> >
> > 1. Write the JSON AST directly as regular OCaml code:
> >
> >  Json.(M["streetAdress", S "21 2snd Street"])
> >
> >  (assuming module Json export constructors M and S.)
> >
> > 2. Use "parsed" OCaml syntax, with some -ppx filter mapping it to JSON
> AST:
> >
> >  (:json { streetAddress: "21 2snd Street" })
> >
> > (which would expand to the version above)
> >
> >
> > 3. Use a JSON parser (if we don't need "anti-quotations"):
> >
> >   parse_json "{\"streetAddress\": \"21 2nd Street\"}"
> >
> >   or:
> >
> >   parse_json {{ {"streetAddress: "21 2nd Street"} }}
> >
> >
> > From all the uses of Camlp4 I've seen listed since the beginning of this
> > discussion, I can imagine using at some point almost each of them, except
> > those which are basically "just" about quoting fragments of external
> > languages in their native syntax.  I just don't see the real benefits.
> >
> > It would be useful to get feedback from users: do people actually use
> > pa_tyxml, pa_json, etc, and do they consider this is really better than
> > proposed alternatives?
> >
> >
> > Alain
> >
> > _______________________________________________
> > wg-camlp4 mailing list
> > wg-camlp4@lists.ocaml.org
> > http://lists.ocaml.org/listinfo/wg-camlp4
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>

--047d7bb03c2af9bd7f04d49571e6
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Not much to add to this, I just wanted to emphasize that the point Gabriel =
makes is especially relevant in web programming or database interaction, be=
cause in those area ocaml is not often the first option that comes to mind.=
 So being able to quote json, sql, html etc in an ocaml source without unpl=
ugging the type checker is real feature. Of course, there are cases when yo=
u build those &quot;foreign&quot; values programmatically, in that case I c=
oncur you&#39;re better off without the syntax extension (maybe not always,=
 if the guest language has some real nice support than cannot be rendered c=
oncisely with ocaml), but there are many times when the antiquotation part =
is really small compared to the &quot;constant&quot; fragments. In that cas=
e, it may be desirable to have non-ocaml-programmers work directly on the m=
l source.<br>

<br><div class=3D"gmail_quote">2013/1/31 Gabriel Scherer <span dir=3D"ltr">=
&lt;<a href=3D"mailto:gabriel.scherer@gmail.com" target=3D"_blank">gabriel.=
scherer@gmail.com</a>&gt;</span><br><blockquote class=3D"gmail_quote" style=
=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">

&gt; From all the uses of Camlp4 I&#39;ve seen listed since the beginning o=
f this<br>
&gt; discussion, I can imagine using at some point almost each of them, exc=
ept<br>
&gt; those which are basically &quot;just&quot; about quoting fragments of =
external<br>
&gt; languages in their native syntax. =A0I just don&#39;t see the real ben=
efits.<br>
&gt;<br>
&gt; It would be useful to get feedback from users: do people actually use<=
br>
&gt; pa_tyxml, pa_json, etc, and do they consider this is really better tha=
n<br>
&gt; proposed alternatives?<br>
&gt;<br>
&gt;<br>
&gt; Alain<br>
<br>
The point of quoting foreign languages is to translate them into a<br>
form that exercize the OCaml type-checker to produce rich typing<br>
information. With (parse_json &quot;...&quot;) you have no static typing<br=
>
information on the parsed value, while with a quotation you can expect<br>
to get, say, a (&lt; streetAdress : string &gt; Json.t) expression.<br>
Supporting antiquotations there allows you to write those foreign<br>
values in a composable way, eg. using &lt;:json&lt; { streetAddress: $addr$=
<br>
} &gt;&gt; with (addr : string Json.t).<br>
<br>
This is essentially a nice concrete syntax on top of the typed<br>
combinators (point 1. in your message quoted below); indeed, good<br>
extensions should embed as few domain knowledge as possible and defer<br>
that to the pure-ocaml library providing the combinators. That is not<br>
always possible, however, when you want to express rich binding<br>
structures in a typed way (for example the support of GROUP BY in a<br>
finely-typed way in Macaque relies on clever Camlp4 expansion<br>
strategies.<br>
<br>
Furthermore, the bare approach of using combinators directly is not<br>
always desirable in situations where you want the code to be used by<br>
non-domain-experts. &quot;Templates&quot; in web programming are an entire<=
br>
cottage industry made of preprocessing HTML-looking quasiquotations,<br>
to help the role separation between designers and programmers. More<br>
generally, if there is a widely accepted domain-specific notation,<br>
your domain-specific library should have a way to support it (so that<br>
you can, for example, call over SQL tuning experts to comment on the<br>
performance optimization of the database queries embedded in your<br>
OCaml code).<br>
<br>
This is maybe less visible for non-programmable data description<br>
languages such as JSON, but I suspect this still holds. For example,<br>
if you distribute a protocol library built on top of JSON and bridging<br>
over many programming languages, you want the same maintainer to be<br>
able to quickly reflect changes to the protocol schema over all<br>
implements. This is vastly easier if they respect the domain-specific<br>
syntax instead of each having an embedding following the concrete<br>
syntax of the corresponding language.<br>
<br>
On Thu, Jan 31, 2013 at 1:28 PM, Alain Frisch &lt;<a href=3D"mailto:alain@f=
risch.fr">alain@frisch.fr</a>&gt; wrote:<br>
&gt; On 01/31/2013 12:48 PM, Leo White wrote:<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; &gt;&gt; and &lt;&lt; are really not keywords of OCaml, and I =
wouldn&#39;t be<br>
&gt;&gt;&gt; surprised they are actually used as operators. =A0I prefer bre=
aking<br>
&gt;&gt;&gt; compatibility with camlp4 than with OCaml.<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt; Thinking about it &quot;&lt;:&quot; is not entirely unproblematic.=
 Since &quot;[&lt;&quot; is a<br>
&gt;&gt; single token, [&lt;:foo&lt; .. &gt;&gt;] would be awkward for the =
lexer.<br>
&gt;&gt;<br>
&gt;&gt; Even if we abandon the camlp4 syntax for quotations<br>
&gt;<br>
&gt;<br>
&gt; Hurrah :-)<br>
&gt;<br>
&gt;<br>
&gt;&gt; , I still think that<br>
&gt;&gt; {:lid {x{ string }x}} is too heavy and inflexible for traditional<=
br>
&gt;&gt; quotations. For example, a JSON quotation would look like:<br>
&gt;&gt;<br>
&gt;&gt; {:json {&lt;{ {&quot;streetAddress&quot;: &quot;21 2nd Street&quot=
;} }&gt;}}<br>
&gt;<br>
&gt;<br>
&gt; I would write this:<br>
&gt;<br>
&gt; (:json {{ {&quot;streetAddress&quot;: &quot;21 2nd Street&quot;} }})<b=
r>
&gt;<br>
&gt; And if we keep the &quot;end marker&quot; in the AST, this could be:<b=
r>
&gt;<br>
&gt; {json{ {&quot;streetAddress&quot;: &quot;21 2nd Street&quot;} }json}<b=
r>
&gt;<br>
&gt;<br>
&gt; But maybe we should take a step back, and really ask ourselves why we =
should<br>
&gt; use concrete JSON syntax here. =A0Other possibilities:<br>
&gt;<br>
&gt;<br>
&gt; 1. Write the JSON AST directly as regular OCaml code:<br>
&gt;<br>
&gt; =A0Json.(M[&quot;streetAdress&quot;, S &quot;21 2snd Street&quot;])<br=
>
&gt;<br>
&gt; =A0(assuming module Json export constructors M and S.)<br>
&gt;<br>
&gt; 2. Use &quot;parsed&quot; OCaml syntax, with some -ppx filter mapping =
it to JSON AST:<br>
&gt;<br>
&gt; =A0(:json { streetAddress: &quot;21 2snd Street&quot; })<br>
&gt;<br>
&gt; (which would expand to the version above)<br>
&gt;<br>
&gt;<br>
&gt; 3. Use a JSON parser (if we don&#39;t need &quot;anti-quotations&quot;=
):<br>
&gt;<br>
&gt; =A0 parse_json &quot;{\&quot;streetAddress\&quot;: \&quot;21 2nd Stree=
t\&quot;}&quot;<br>
&gt;<br>
&gt; =A0 or:<br>
&gt;<br>
&gt; =A0 parse_json {{ {&quot;streetAddress: &quot;21 2nd Street&quot;} }}<=
br>
&gt;<br>
&gt;<br>
&gt; From all the uses of Camlp4 I&#39;ve seen listed since the beginning o=
f this<br>
&gt; discussion, I can imagine using at some point almost each of them, exc=
ept<br>
&gt; those which are basically &quot;just&quot; about quoting fragments of =
external<br>
&gt; languages in their native syntax. =A0I just don&#39;t see the real ben=
efits.<br>
&gt;<br>
&gt; It would be useful to get feedback from users: do people actually use<=
br>
&gt; pa_tyxml, pa_json, etc, and do they consider this is really better tha=
n<br>
&gt; proposed alternatives?<br>
&gt;<br>
&gt;<br>
&gt; Alain<br>
&gt;<br>
&gt; _______________________________________________<br>
&gt; wg-camlp4 mailing list<br>
&gt; <a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org=
</a><br>
&gt; <a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank=
">http://lists.ocaml.org/listinfo/wg-camlp4</a><br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</blockquote></div><br>

--047d7bb03c2af9bd7f04d49571e6--

From edwin+ml-ocaml@etorok.net  Thu Jan 31 13:17:18 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7384B3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:17:18 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.1 from SpamAssassin-3.3.2-1440304 
 *  1.1 DKIM_ADSP_ALL No valid author signature, domain signs all mail
 * -0.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:43231)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0u5L-0005Em-pd (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Thu, 31 Jan 2013 13:21:47 +0000
Received: from [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d] (unknown
 [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d])
 by mail.etorok.net (Postfix) with ESMTPSA id 6259646B5
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 14:21:46 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359638506;
 bh=4ApZWrSkCzSMqIiaH1kCLTUCUzU996Y58SpdXVVmgS4=;
 h=Message-ID:Date:From:MIME-Version:To:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=u9/mcVWg0iyAlOdp/GrkZt9hNMYD7e+YPq7/buxwDjhuUX3A9sz/J7OhcNhgf78tZ
 HO8Ivqn2NfuidcRBr7B/iGR1qS0v0Eq61VYscNYXXPh9Mj21rXQuwKT9fxnIYuzCh4
 Pdxm5nFK35oB/+hmIPA7lwmb7VSmxf54toMPvb0M=
Message-ID: <510A6FEA.3080807@etorok.net>
Date: Thu, 31 Jan 2013 15:21:46 +0200
From: =?UTF-8?B?VMO2csO2ayBFZHdpbg==?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
In-Reply-To: <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
Content-Type: text/plain; charset=UTF-8
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:17:18 -0000

On 01/31/2013 01:48 PM, Leo White wrote:
> So I propose the we include 3 template forms:
> {: lid x| string |x}            (where x is an optional symbol characte=
r)

I'd be in favour of just 1 syntax, its less confusing for users.

On 01/31/2013 02:46 PM, Hongbo Zhang wrote:
> why should we introduce so many  concrete syntax notation here?
>=20
> In Fan,
> {:json| ... |}
> if "|}" is used inside,*the user (optionally) can introduce a new separ=
ator following "|" immediately*
> {:json|/ ... /|} =20

So this would be similar to Leo's proposal but with the optional symbol o=
n the inside, a mandatory whitespace
after the symbol, and no whitespace after the : right?
{:lid|x=E2=90=A3string x|}

I actually prefer this one because:
 + easier for editors to highlight beginning/end of quote
 + easier to grep for end of quote
 + easier to grep for what syntax extensions are used in a project: grep =
-Eo "{:[^|]+|"

FWIW Haskell is quite rigid, its syntax for (quasi)quotations is just [ex=
pr|...|].

Best regards,
--Edwin


From anil@recoil.org  Thu Jan 31 13:17:44 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0C83A3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:17:44 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440304
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:43718
 helo=dark.recoil.org)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with smtp id 1U0u5k-0002lh-mx (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Thu, 31 Jan 2013 13:22:12 +0000
Received: (qmail 7062 invoked by uid 634); 31 Jan 2013 13:22:11 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from volstagg-0.srg.cl.cam.ac.uk (HELO [10.0.1.83]) (128.232.32.232)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Thu, 31 Jan 2013 13:22:11 +0000
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <510A6D89.9000507@lexifi.com>
Date: Thu, 31 Jan 2013 13:22:08 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:17:44 -0000

On 31 Jan 2013, at 13:11, Alain Frisch <alain.frisch@lexifi.com> wrote:

> When non-programmers have to write some HTML code, this code rarely =
ends up in OCaml source code.  Usually, it stays in its own HTML file, =
which is then processed (statically or dynamically) by the (OCaml) code.
>=20
> When fragments of JSON/XML/etc are created programatically, this is =
often done "piece by piece", with very small fragments involving a high =
density of anti-quotations.  The benefits of using the foreign syntax =
here are not clear to me.

This does match my experience with pa_css, pa_json, pa_xml while =
building the Mirage website.  For example:

https://github.com/mirage/mirage-www/blob/master/src/style.ml#L71
https://github.com/mirage/mirage-www/blob/master/src/wiki.ml

are both either flat templates, or fairly dense with antiquotations.  It =
is quite nice that I can paste in some HTML code and get type errors =
from the XMLM parser.

More recently, I've been using Martin Jambon's new tools that perform =
external code generation instead, and it's quite a pleasant experience.  =
For example, the Github bindings use his ATD tool which auto-generates =
the parsing code into separate OCaml modules:

https://github.com/avsm/ocaml-github/blob/master/lib/github.atd

With ATD, you retain type safety, but lose other benefits of embedding =
code (most notably, using modules to control the visibility of the =
generated types).  The build system integration also took some thought, =
although this is ocamlbuild's fault.

I can't immediately think of a good case where programmatic fragments of =
JSON/XML really need the current quotation/antiquotation mechanism.  If =
it simplifies editor support, I'd be happy enough to lose this =
functionality.

-anil=

From bobzhang1988@gmail.com  Thu Jan 31 13:23:28 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C504B3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:23:28 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.53 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f53.google.com ([209.85.212.53]:39180)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0uBI-0006hJ-Z4 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 13:27:57 +0000
Received: by mail-vb0-f53.google.com with SMTP id fj18so1733538vbb.12
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 05:27:56 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=osF4i7A9sznfBFPE8tgskVWG8JJSqxKakCLvXMp13/I=;
 b=LZV60HnT12bkESXUIP4g1iKKjfppUBeh09+IN+f0gohJftfCTTA0npz88hGr0IxLqA
 dFk1SxVKZw1ZTt2ClMj1gvrTATVhYm8i2RelVogavKzpuOr2yJflcAoYDnSrpj7GbXZn
 TQKPoBDe/XbRbE7NJkLOa3DSZVicg3uUutY0zf7/4lqxJaSvyz8jAJ8S0LVek0683UDp
 6qZSkZH30/YXgqe3KaWDPpif7fL1TC9jZRe9zYFiqiTGPn2cjJ9bcye5GeoVVZQhr7Ry
 0332yWAx/iftI8xZohrK59Soo7Z4uvNSIv1q73vUFOguA1ohiprZdEyjowx7MOZT/mpl
 BlAg==
MIME-Version: 1.0
X-Received: by 10.220.108.2 with SMTP id d2mr7879974vcp.60.1359638876165; Thu,
 31 Jan 2013 05:27:56 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Thu, 31 Jan 2013 05:27:56 -0800 (PST)
In-Reply-To: <510A6FEA.3080807@etorok.net>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
Date: Thu, 31 Jan 2013 08:27:56 -0500
X-Google-Sender-Auth: 0lN8qylyyZFKtuw-Cod387eR0QY
Message-ID: <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
Content-Type: multipart/alternative; boundary=f46d043c7d603c96f604d4959867
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:23:28 -0000

--f46d043c7d603c96f604d4959867
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

> In Fan,
> > {:json| ... |}
> > if "|}" is used inside,*the user (optionally) can introduce a new
> separator following "|" immediately*
> > {:json|/ ... /|}
>
> So this would be similar to Leo's proposal but with the optional symbol o=
n
> the inside, a mandatory whitespace
> after the symbol, and no whitespace after the : right?
> {:lid|x=E2=90=A3string x|}
>
> no whitespace, we need the *precise location*, whitespace will introduce
trouble here
The optional *character set is limited to [/+-] (serveral more)*, only
those optional characters will be recgonized.
so you can still write {:json|{a;b}|}
but {:json|/{a;b|}}/|} also works

I actually prefer this one because:
>  + easier for editors to highlight beginning/end of quote
>  + easier to grep for end of quote
>  + easier to grep for what syntax extensions are used in a project: grep
> -Eo "{:[^|]+|"
>
> FWIW Haskell is quite rigid, its syntax for (quasi)quotations is just
> [expr|...|].
>
> Best regards,
> --Edwin
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>



--=20
-- Regards, Hongbo

--f46d043c7d603c96f604d4959867
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote"><blockquote class=3D"gmail_quote" style=
=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div cla=
ss=3D"im">
&gt; In Fan,<br>
&gt; {:json| ... |}<br>
</div>&gt; if &quot;|}&quot; is used inside,*the user (optionally) can intr=
oduce a new separator following &quot;|&quot; immediately*<br>
&gt; {:json|/ ... /|}<br>
<br>
So this would be similar to Leo&#39;s proposal but with the optional symbol=
 on the inside, a mandatory whitespace<br>
after the symbol, and no whitespace after the : right?<br>
{:lid|x=E2=90=A3string x|}<br>
<br></blockquote><div>no whitespace, we need the <b>precise location</b>, w=
hitespace will introduce trouble here=C2=A0</div><div>The optional <b>chara=
cter set is limited to [/+-] (serveral more)</b>, only those optional chara=
cters will be recgonized.</div>
<div>so you can still write {:json|{a;b}|}</div><div>but {:json|/{a;b|}}/|}=
 also works</div><div><br></div><blockquote class=3D"gmail_quote" style=3D"=
margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
I actually prefer this one because:<br>
=C2=A0+ easier for editors to highlight beginning/end of quote<br>
=C2=A0+ easier to grep for end of quote<br>
=C2=A0+ easier to grep for what syntax extensions are used in a project: gr=
ep -Eo &quot;{:[^|]+|&quot;<br>
<br>
FWIW Haskell is quite rigid, its syntax for (quasi)quotations is just [expr=
|...|].<br>
<br>
Best regards,<br>
--Edwin<br>
<div class=3D"HOEnZb"><div class=3D"h5"><br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo

--f46d043c7d603c96f604d4959867--

From bobzhang1988@gmail.com  Thu Jan 31 13:27:36 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 803393C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:27:36 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.174 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f174.google.com ([209.85.128.174]:38793)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0uFI-0008Ta-Z0 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 13:32:05 +0000
Received: by mail-ve0-f174.google.com with SMTP id c13so1973983vea.5
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 05:32:04 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=855dSwNMYe8ksS/RoDwJRCQZ3Io4MTmGvqwtycCYls4=;
 b=egge/vW2aE+MyzJF4RIf3kGjd+iBusAj7urVzqZWWpvW45lqeS8IU4KeW69kfZC2m2
 aNdb+o6GE1Pkqu0GrUC2sMaiTvvBLP1e3oO8BuXTEDBWSLnBdDR6zpzdSpQxEQIHy1E2
 iV2eA1d8ztqjtPhYx82y1niyLJ0u75zI7X7Htosm/6zptuV3QDTb8DogQfZyghbSIZ7F
 2lNhY1aJuM3ZlNzE6xaNwRqEYj36N3/ZjoXlsbFvm5hpQ+SVaD/gaFhkOTeMCqdHZnDd
 LJXiutJcmC6S4NnxeAqHF70U+eX5DDxms65xE5yTtn3+Co+a23W9bo4MEWRHwiKFx/OX
 3VDA==
MIME-Version: 1.0
X-Received: by 10.52.98.98 with SMTP id eh2mr6974687vdb.64.1359639124216; Thu,
 31 Jan 2013 05:32:04 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Thu, 31 Jan 2013 05:32:04 -0800 (PST)
In-Reply-To: <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
Date: Thu, 31 Jan 2013 08:32:04 -0500
X-Google-Sender-Auth: QyczsgiS4dqv9eTNzX5h8NXsDQg
Message-ID: <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Anil Madhavapeddy <anil@recoil.org>
Content-Type: multipart/alternative; boundary=20cf307f380a058ab804d495a74a
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:27:36 -0000

--20cf307f380a058ab804d495a74a
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Jan 31, 2013 at 8:22 AM, Anil Madhavapeddy <anil@recoil.org> wrote:

> On 31 Jan 2013, at 13:11, Alain Frisch <alain.frisch@lexifi.com> wrote:
> I can't immediately think of a good case where programmatic fragments of
> JSON/XML really need the current quotation/antiquotation mechanism.  If it
> simplifies editor support, I'd be happy enough to lose this functionality.
>
Would you mind elaborating a bit why it will complex editor support? the
quotation introduces enough
information that the IDE should recognize(imho) and it's delimited which is
awesome in my Emacs (with paren mode)

>
> -anil
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>



-- 
-- Regards, Hongbo

--20cf307f380a058ab804d495a74a
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Thu, Jan 31, 2013 at 8:22 AM, Anil Ma=
dhavapeddy <span dir=3D"ltr">&lt;<a href=3D"mailto:anil@recoil.org" target=
=3D"_blank">anil@recoil.org</a>&gt;</span> wrote:<br><blockquote class=3D"g=
mail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-l=
eft:1ex">
<div class=3D"im">On 31 Jan 2013, at 13:11, Alain Frisch &lt;<a href=3D"mai=
lto:alain.frisch@lexifi.com">alain.frisch@lexifi.com</a>&gt; wrote:<br></di=
v>
I can&#39;t immediately think of a good case where programmatic fragments o=
f JSON/XML really need the current quotation/antiquotation mechanism. =A0If=
 it simplifies editor support, I&#39;d be happy enough to lose this functio=
nality.<br>
</blockquote><div>Would you mind elaborating a bit why it will complex edit=
or support? the quotation introduces enough=A0</div><div>information that t=
he IDE should recognize(imho) and it&#39;s delimited which is awesome in my=
 Emacs (with paren mode)</div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
<span class=3D"HOEnZb"><font color=3D"#888888"><br>
-anil<br>
</font></span><div class=3D"HOEnZb"><div class=3D"h5">_____________________=
__________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo

--20cf307f380a058ab804d495a74a--

From alain.frisch@lexifi.com  Thu Jan 31 13:27:41 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 20EBC3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:27:41 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440304 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:34940
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0uFN-0008Un-Yf (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 31 Jan 2013 13:32:10 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d30 with ME
 id udY91k01j3lHbAL03dY9F1; Thu, 31 Jan 2013 14:32:09 +0100
Message-ID: <510A7258.1070300@lexifi.com>
Date: Thu, 31 Jan 2013 14:32:08 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <CANcqPu4CnjsJcVWTK3N0Q9iEMLWzHWtRM41u6EKRYX2T1we0wQ@mail.gmail.com>
 <510A6989.80706@lexifi.com>
 <CANcqPu6pHKxgbXoqLBVJ-ZCsOMu46PbHZrW-jNNdWpJTfK8t5A@mail.gmail.com>
In-Reply-To: <CANcqPu6pHKxgbXoqLBVJ-ZCsOMu46PbHZrW-jNNdWpJTfK8t5A@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:27:41 -0000

On 01/31/2013 02:07 PM, Hongbo Zhang wrote:
> For any nontrivial Ast Rewriter, I totally get lost, maybe I am dumb and
> you use objects here(ast_mapper) suppose both ast_mapper try to inject
> some bindings at the beginning, what do you expect here? Besides,
> there's no reason that Ast Rewriter should be pure, once is impure, how
> shall I reason the program?

As soon as you use OCaml code to specify some actions on the AST, you 
have potential problems with impure code.  ppx does not change anything, 
except maybe that each ppx rewriter in run in a separate process, which 
limits the risk of bad interaction between them.

To reason about two ppx rewriters both trying to inject code at the 
beginning, this is easy, just think in terms of functions.  The first 
transformer to be applied adds code to the beginning.  The second one 
adds more code to the beginning.  At the end, the code starts by the 
prefix added by the second ppx rewriter, then the prefix added by the 
first one, then the rest of the code.

> But we do
> have a lot of things that Ast Rewriter does not provide,

Agreed!

> This is *already implemented in Fan within tens of lines of code,* you
> are much more experienced than me, so I bet you definitely could parse
> it! (I don't consider tens of lines of code is complex.. ) my taste
> shows that its notation is much more elegant than sedlex (imho)

I strongly suspect you don't use the official OCaml parser but a 
specific parser which is part of Fan (and rely on a different parsing 
technology and a different AST).  So if I want to use your version of 
sedlex, I will add to update Fan to match my local extensions of OCaml 
(or MetaOCaml, or the next cool extension of Camlp4).  And if I wanted 
to be able to implement that version, I would have had to learn about 
Fan, its parsing technology, and its interpretation of the OCaml AST.
All that would be worth the extra effort and trouble if the benefits 
were clear enough, but I still don't see any benefit.

Alain

From thomas.gazagnaire@gmail.com  Thu Jan 31 13:29:00 2013
Return-Path: <thomas.gazagnaire@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AEDD83C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:29:00 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.178 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (thomas.gazagnaire[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f178.google.com ([74.125.82.178]:40725)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0uGf-000494-Q0 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <thomas.gazagnaire@gmail.com>); Thu, 31 Jan 2013 13:33:29 +0000
Received: by mail-we0-f178.google.com with SMTP id x48so2021042wey.23
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 05:33:28 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:subject:mime-version:content-type:from
 :in-reply-to:date:cc:content-transfer-encoding:message-id:references
 :to:x-mailer; bh=IPMClBJsHdYR6i+s8JsrjlQUMLygmkF+Ac4SU4goKcQ=;
 b=EigMdE5fkMguKWcWZj+CTD8iLpPw0UxXylTDBaStDepsk7fH1a+rNyfAguT/1IQCkl
 3IU5/tmsrL+1G1L8EJGv7Y4xJvrFu5EC0Hauzp/k4jw/dGiInNajIUzebywYJ3anQ7EJ
 T4suuRP6v4q3CjZ/Y63In1mRMTOD88aIHPijcHGkBkNtEGVzPLvPwYwDi41LRi79OY6w
 SbMxzKNV6wrYEziZWGfA2P7yUzRO7WJ3EgkOk2dZ7yRsVW0nMA6NjRvC6c03RAp9dvWe
 IkKRGeClStstu6OLIps0ND3fV0C6l26IwDYA/5UEngb3xlES3/1GCeXiARnMKR83efc5
 +O9g==
X-Received: by 10.180.101.104 with SMTP id ff8mr15200979wib.11.1359639208795; 
 Thu, 31 Jan 2013 05:33:28 -0800 (PST)
Received: from [10.0.1.84] (volstagg-0.srg.cl.cam.ac.uk. [128.232.32.232])
 by mx.google.com with ESMTPS id hu8sm15102700wib.6.2013.01.31.05.33.26
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Thu, 31 Jan 2013 05:33:27 -0800 (PST)
Sender: Thomas Gazagnaire <thomas.gazagnaire@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1085)
Content-Type: text/plain; charset=us-ascii
From: Thomas Gazagnaire <thomas@ocamlpro.com>
In-Reply-To: <510A6362.8070504@frisch.fr>
Date: Thu, 31 Jan 2013 13:33:25 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <CEF81BAE-6B70-4A8C-B49A-BBA61983C94B@ocamlpro.com>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
To: Alain Frisch <alain@frisch.fr>
X-Mailer: Apple Mail (2.1085)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:29:00 -0000

> It would be useful to get feedback from users: do people actually use =
pa_tyxml, pa_json, etc, and do they consider this is really better than =
proposed alternatives?

I definitely use (and like) quotations to write web applications. with =
https://github.com/mirage/ocaml-cow. This is used for instance to =
generate mirage =
(https://github.com/mirage/mirage-www/blob/master/src/blog.ml) and OPAM =
(https://github.com/OCamlPro/opam2web) websites.

If you look at the code source there, I use anti-quotations more like a =
templating system (and I'm fine if I can only do that) and quotations as =
simple multi-line & auto-escaping strings. In some source files, I mix =
HTML and CSS quotations, where the CSS is actually rewritten to unnest =
nested blocks by the quotation system and where some HTML antiquotations =
are CSS values.

If you have a simple way to add that in your new system I will be quite =
happy (and I don't really care about the syntax, I would simply prefer a =
light one such as <:html*.. *> where '*' is any character instead of =
having to write {foo{bar{...}}foo} but that's not really important to =
me).

 --
Thomas


>=20
>=20
> Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4


From bobzhang1988@gmail.com  Thu Jan 31 13:36:34 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 690E63C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:36:34 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.175 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f175.google.com ([209.85.220.175]:59730)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0uNy-0007HX-Rc (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 13:41:03 +0000
Received: by mail-vc0-f175.google.com with SMTP id fw7so1731544vcb.6
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 05:41:01 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=uvlKFiMni0UNzmLQ4U7OSH3UW6R88QuzLokvu0jgRTg=;
 b=Mgpi8WiM/50bTXw25vegkcYyoIYHOHTdTxU8/0HTCBzPYtAsnNZKIEc5rQRiQhctDn
 7HyzFjmbbiDWov7rptT0ES0CAJs/OFCSPcRRAHwxoUXaZr4qTt4X+oqYquNDVQXycOkc
 s5L2s8bujJSPOiUaRlr1gzyQDTtGSxAatRl7F+wQLN04pzJMXo/9ccEM2OdLRQTQ1946
 vFIsH25S21R+2BTLUx+nLGYHmRWuTw5LIUimsjyhaYRF8eol95Pb5VtWlRQX2kch+mEI
 sGlv9CRE/RhdAtzW3Af+pWtdp2n4fwr2kGb2E0RWDsuHICXTpIc5NF4XmUdmyY3cd1rG
 E7/w==
MIME-Version: 1.0
X-Received: by 10.220.156.75 with SMTP id v11mr8035780vcw.1.1359639661841;
 Thu, 31 Jan 2013 05:41:01 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Thu, 31 Jan 2013 05:41:01 -0800 (PST)
In-Reply-To: <510A7258.1070300@lexifi.com>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <CANcqPu4CnjsJcVWTK3N0Q9iEMLWzHWtRM41u6EKRYX2T1we0wQ@mail.gmail.com>
 <510A6989.80706@lexifi.com>
 <CANcqPu6pHKxgbXoqLBVJ-ZCsOMu46PbHZrW-jNNdWpJTfK8t5A@mail.gmail.com>
 <510A7258.1070300@lexifi.com>
Date: Thu, 31 Jan 2013 08:41:01 -0500
X-Google-Sender-Auth: oZHOVN3ol4HAn5meA2X79gXi5aE
Message-ID: <CANcqPu5WXUGSqczxhyeAgZAL1MOO1m+Cv0oBuQaa5Lw94M3+_w@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=f46d043c7c86110cd304d495c7a0
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:36:34 -0000

--f46d043c7c86110cd304d495c7a0
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Jan 31, 2013 at 8:32 AM, Alain Frisch <alain.frisch@lexifi.com>wrote:

>
>> I strongly suspect you don't use the official OCaml parser but a specific
> parser which is part of Fan (and rely on a different parsing technology and
> a different AST).  So if I want to use your version of sedlex, I will add
> to update Fan to match my local extensions of OCaml (or MetaOCaml, or the
> next cool extension of Camlp4).  And if I wanted to be able to implement
> that version, I would have had to learn about Fan, its parsing technology,
> and its interpretation of the OCaml AST.
> All that would be worth the extra effort and trouble if the benefits were
> clear enough, but I still don't see any benefit.
>
> To be fair, suppose people who don't understand either Fan or ppx, I think
it's much easier to learn Fan. Fan's grammar's semantics is really
clear(its kernel is *only 200 lines *without comments), and we
provide a graphic module to *visualize the tree structure*...
Anyway you can still use Fan* without sticking to Fan's parsing tech*, the
only thing you need is to accept the proposal* which introduces a
Intermediate Ast*

> Alain
>



-- 
-- Regards, Hongbo

--f46d043c7c86110cd304d495c7a0
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Thu, Jan 31, 2013 at 8:32 AM, Alain F=
risch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain.frisch@lexifi.com" targ=
et=3D"_blank">alain.frisch@lexifi.com</a>&gt;</span> wrote:<br><blockquote =
class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid=
;padding-left:1ex">
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im"><br></div></blockquote>
I strongly suspect you don&#39;t use the official OCaml parser but a specif=
ic parser which is part of Fan (and rely on a different parsing technology =
and a different AST). =A0So if I want to use your version of sedlex, I will=
 add to update Fan to match my local extensions of OCaml (or MetaOCaml, or =
the next cool extension of Camlp4). =A0And if I wanted to be able to implem=
ent that version, I would have had to learn about Fan, its parsing technolo=
gy, and its interpretation of the OCaml AST.<br>

All that would be worth the extra effort and trouble if the benefits were c=
lear enough, but I still don&#39;t see any benefit.<span class=3D"HOEnZb"><=
font color=3D"#888888"><br>
<br></font></span></blockquote><div>To be fair, suppose people who don&#39;=
t understand either Fan or ppx, I think it&#39;s much easier to learn Fan. =
Fan&#39;s grammar&#39;s semantics is really clear(its kernel is <b>only 200=
 lines </b>without comments), and we=A0</div>
<div>provide a graphic module to <b>visualize the tree structure</b>...</di=
v><div>Anyway you can still use Fan<b> without sticking to Fan&#39;s parsin=
g tech</b>, the only thing you need is to accept the proposal<b> which intr=
oduces a Intermediate Ast</b>=A0</div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><span class=3D"HOEnZb"><font color=3D"#88888=
8">
Alain<br>
</font></span></blockquote></div><br><br clear=3D"all"><div><br></div>-- <b=
r>-- Regards, Hongbo

--f46d043c7c86110cd304d495c7a0--

From alain.frisch@lexifi.com  Thu Jan 31 13:37:38 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3DD9D3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:37:38 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440304 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:17745
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0uP0-00060l-sV (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 31 Jan 2013 13:42:07 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d30 with ME
 id udi51k0093lHbAL03di5s9; Thu, 31 Jan 2013 14:42:06 +0100
Message-ID: <510A74AC.4070302@lexifi.com>
Date: Thu, 31 Jan 2013 14:42:04 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
In-Reply-To: <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:37:38 -0000

On 01/31/2013 02:32 PM, Hongbo Zhang wrote:
> Would you mind elaborating a bit why it will complex editor support?

The content of a quotation can use arbitrary grammar and even arbitrary 
lexical rules.

If the editor cannot lex the content of the quotation, it cannot produce 
nice colors for lexical entities in it.  If emacs produce decent colors 
on some example with quotation, it is only because it does not know 
anything about quotation and the example is simple enough so that 
applying OCaml rules works quite well.  But if the content of the 
quotation follows other lexical rules, emacs gets confused. Write:

   let x = foo << " >> bar

and emacs will color ">> bar" as if it were a string.  The only decent 
think an editor could do with a quotation is to understand where it 
stops and not try to do anything clever with it.  If we adapt the OCaml 
emacs mode to recognize camlp4's quotation and do that, you won't get 
any colors within quotations (correct behavior, but not if you write 
non-trivial multi-line OCaml expressions in it, as in your 'sedlex' 
version).

Even if the lexical conventions are right, the editor cannot produce 
correct indentation if it doesn't know the grammar used inside the 
quotation.


Alain


From edwin+ml-ocaml@etorok.net  Thu Jan 31 13:39:10 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BBADA3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:39:10 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.1 from SpamAssassin-3.3.2-1440304 
 *  1.1 DKIM_ADSP_ALL No valid author signature, domain signs all mail
 * -0.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:41795)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0uQU-0005Cp-Yc (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Thu, 31 Jan 2013 13:43:39 +0000
Received: from [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d] (unknown
 [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d])
 by mail.etorok.net (Postfix) with ESMTPSA id 447DC46B5;
 Thu, 31 Jan 2013 14:43:38 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359639818;
 bh=zm0XidU1HyiWJ/6WHGlixM0o1oZSJhnHKcW1tN6hWss=;
 h=Message-ID:Date:From:MIME-Version:To:CC:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=VDpn911fs5uFsF02UnqxUt5AA3G3TgMKW26zFHb31aywVAInooorDl7fSIc8JxVUE
 plDfBhJ7ZwhJ13OeU4q+vTkhw7/qPp0f4ObqgJ6B1UZYGt2bpg36AK5PMXHGkGDanN
 BrFmFiD/rzDbpj9PshePXpfMSVdNo/7QLv0yeD+U=
Message-ID: <510A7509.1000007@etorok.net>
Date: Thu, 31 Jan 2013 15:43:37 +0200
From: =?UTF-8?B?VMO2csO2ayBFZHdpbg==?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
 <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
In-Reply-To: <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
Content-Type: text/plain; charset=UTF-8
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:39:10 -0000

On 01/31/2013 03:27 PM, Hongbo Zhang wrote:
>=20
>=20
>     > In Fan,
>     > {:json| ... |}
>     > if "|}" is used inside,*the user (optionally) can introduce a new=
 separator following "|" immediately*
>     > {:json|/ ... /|}
>=20
>     So this would be similar to Leo's proposal but with the optional sy=
mbol on the inside, a mandatory whitespace
>     after the symbol, and no whitespace after the : right?
>     {:lid|x=E2=90=A3string x|}
>=20
> no whitespace, we need the *precise location*, whitespace will introduc=
e trouble here=20
> The optional *character set is limited to [/+-] (serveral more)*, only =
those optional characters will be recgonized.
> so you can still write {:json|{a;b}|}
> but {:json|/{a;b|}}/|} also works

Without a whitespace how do you know if the '/' is your optional characte=
r or part of the quoted syntax?
(unless you restrict the quoted syntax's first character to be something =
else than the optional characters)

What do you think of this syntax:
{:lid|...|lid:}

Its still quite easy to find where quotation's bounds are, it is symmetri=
c, and the end marker should be long enough
to not cause false matches inside the quotation.

Best regards,
--Edwin

From edwin@etorok.net  Thu Jan 31 13:40:43 2013
Return-Path: <edwin@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A15963C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:40:43 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.1 from SpamAssassin-3.3.2-1440304 
 *  1.1 DKIM_ADSP_ALL No valid author signature, domain signs all mail
 * -0.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:57279)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0uRy-00049z-ox (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin@etorok.net>); Thu, 31 Jan 2013 13:45:12 +0000
Received: from [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d] (unknown
 [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d])
 by mail.etorok.net (Postfix) with ESMTPSA id 8B88646B5;
 Thu, 31 Jan 2013 14:45:06 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359639906;
 bh=WpYZ2TLte++Un+6h6WRvmUAF+a3v8Ccxflj0Qz/SYmk=;
 h=Message-ID:Date:From:MIME-Version:To:CC:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=IqJ32y5ONlCwFOjYoa5SgylDNTV+7+4gmw7hCadKplBsO4j8htxXzcP3wVxZ8CVQk
 AXMh8N4XfQERPiH412vgwfcm7QUkxd1ir1jZCNIOwFz3Ny3BDfUX0SZC+sQcBmyUiO
 PsGyqUrDq3DL68z21043s1g1AD9j9TWqXNCnY2VU=
Message-ID: <510A7562.3030209@etorok.net>
Date: Thu, 31 Jan 2013 15:45:06 +0200
From: =?UTF-8?B?VMO2csO2ayBFZHdpbg==?= <edwin@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
 <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
 <510A7509.1000007@etorok.net>
In-Reply-To: <510A7509.1000007@etorok.net>
X-Enigmail-Version: 1.4.1
Content-Type: text/plain; charset=UTF-8
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:40:43 -0000

On 01/31/2013 03:43 PM, T=C3=B6r=C3=B6k Edwin wrote:
> On 01/31/2013 03:27 PM, Hongbo Zhang wrote:
>>
>>
>>     > In Fan,
>>     > {:json| ... |}
>>     > if "|}" is used inside,*the user (optionally) can introduce a ne=
w separator following "|" immediately*
>>     > {:json|/ ... /|}
>>
>>     So this would be similar to Leo's proposal but with the optional s=
ymbol on the inside, a mandatory whitespace
>>     after the symbol, and no whitespace after the : right?
>>     {:lid|x=E2=90=A3string x|}
>>
>> no whitespace, we need the *precise location*, whitespace will introdu=
ce trouble here=20
>> The optional *character set is limited to [/+-] (serveral more)*, only=
 those optional characters will be recgonized.
>> so you can still write {:json|{a;b}|}
>> but {:json|/{a;b|}}/|} also works
>=20
> Without a whitespace how do you know if the '/' is your optional charac=
ter or part of the quoted syntax?
> (unless you restrict the quoted syntax's first character to be somethin=
g else than the optional characters)
>=20
> What do you think of this syntax:
> {:lid|...|lid:}
>=20
> Its still quite easy to find where quotation's bounds are, it is symmet=
ric, and the end marker should be long enough
> to not cause false matches inside the quotation.

Forgot to add: the ending 'lid' would be optional, so one could write eit=
her:
{:lid|...|:}
{:lid|...|lid:}

--Edwin

From bobzhang1988@gmail.com  Thu Jan 31 13:42:08 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 28BD93C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:42:08 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.172 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f172.google.com ([209.85.220.172]:45635)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U0uTM-0006lY-YM (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 13:46:37 +0000
Received: by mail-vc0-f172.google.com with SMTP id l6so1744818vcl.17
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 05:46:36 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=qEJtyNeZ1BPLzYffvsfy8qRqV1ExVnhCgp+5z+ZeCjY=;
 b=UqFr0M2U8qKHHg3CtUIWI9oXUjD432oM9fdCPjmZQw8LMWVBIhb7HHKua30FuyHks5
 JuTveQQWij5fphWOqXFwIkrGcE2Smf39FUGoktWVjZN7SCf7UOn7qNh8trqpwuodH1HI
 vFFqaM4V2Uuc5PsNq25B9VSe5TC5mMfBChCU7wCUxnOLDKZ49bXHtLaumsmGn2bLb4C8
 AJtW2WWBkgzBj2G2rPioI88gDkbfXvg6a39tSBMgG8p+7WDEgchxwCGxoerC+zztb8To
 vqYPZwilvjkSS5aWjMFIVvBIP/aSeveohtI4SVfNEghpa/zXgPA5Hfv/+EDq+0H78S0K
 GyOA==
MIME-Version: 1.0
X-Received: by 10.220.108.2 with SMTP id d2mr7927869vcp.60.1359639995917; Thu,
 31 Jan 2013 05:46:35 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Thu, 31 Jan 2013 05:46:35 -0800 (PST)
In-Reply-To: <510A7509.1000007@etorok.net>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
 <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
 <510A7509.1000007@etorok.net>
Date: Thu, 31 Jan 2013 08:46:35 -0500
X-Google-Sender-Auth: -Ltkd_beA789lf1uecBZWDWudPo
Message-ID: <CANcqPu4Lru71Z86x6B9AbDP_=vU4U5EpXkNchyvPZsjbJYRepQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
Content-Type: multipart/alternative; boundary=f46d043c7d60faa4d504d495da2d
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:42:08 -0000

--f46d043c7d60faa4d504d495da2d
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

On Thu, Jan 31, 2013 at 8:43 AM, T=C3=B6r=C3=B6k Edwin <edwin+ml-ocaml@etor=
ok.net>wrote:

> On 01/31/2013 03:27 PM, Hongbo Zhang wrote:
> >
> >
> >     > In Fan,
> >     > {:json| ... |}
> >     > if "|}" is used inside,*the user (optionally) can introduce a new
> separator following "|" immediately*
> >     > {:json|/ ... /|}
> >
> >     So this would be similar to Leo's proposal but with the optional
> symbol on the inside, a mandatory whitespace
> >     after the symbol, and no whitespace after the : right?
> >     {:lid|x=E2=90=A3string x|}
> >
> > no whitespace, we need the *precise location*, whitespace will introduc=
e
> trouble here
> > The optional *character set is limited to [/+-] (serveral more)*, only
> those optional characters will be recgonized.
> > so you can still write {:json|{a;b}|}
> > but {:json|/{a;b|}}/|} also works
>
> Without a whitespace how do you know if the '/' is your optional characte=
r
> or part of the quoted syntax?
> (unless you restrict the quoted syntax's first character to be something
> else than the optional characters)
>
> exactly( optional chars is a limited set, but is enough in
practice,(stolen from perl)

> What do you think of this syntax:
> {:lid|...|lid:}
>
> no, we introduce Language namespace, sometimes you can write unamed
quotations XD

> Its still quite easy to find where quotation's bounds are, it is
> symmetric, and the end marker should be long enough
> to not cause false matches inside the quotation.
>
> Best regards,
> --Edwin
>



--=20
-- Regards, Hongbo

--f46d043c7d60faa4d504d495da2d
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Thu, Jan 31, 2013 at 8:43 AM, T=C3=B6=
r=C3=B6k Edwin <span dir=3D"ltr">&lt;<a href=3D"mailto:edwin+ml-ocaml@etoro=
k.net" target=3D"_blank">edwin+ml-ocaml@etorok.net</a>&gt;</span> wrote:<br=
><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1=
px #ccc solid;padding-left:1ex">
<div class=3D"im">On 01/31/2013 03:27 PM, Hongbo Zhang wrote:<br>
&gt;<br>
&gt;<br>
</div><div class=3D"im">&gt; =C2=A0 =C2=A0 &gt; In Fan,<br>
&gt; =C2=A0 =C2=A0 &gt; {:json| ... |}<br>
&gt; =C2=A0 =C2=A0 &gt; if &quot;|}&quot; is used inside,*the user (optiona=
lly) can introduce a new separator following &quot;|&quot; immediately*<br>
&gt; =C2=A0 =C2=A0 &gt; {:json|/ ... /|}<br>
&gt;<br>
&gt; =C2=A0 =C2=A0 So this would be similar to Leo&#39;s proposal but with =
the optional symbol on the inside, a mandatory whitespace<br>
&gt; =C2=A0 =C2=A0 after the symbol, and no whitespace after the : right?<b=
r>
&gt; =C2=A0 =C2=A0 {:lid|x=E2=90=A3string x|}<br>
&gt;<br>
</div>&gt; no whitespace, we need the *precise location*, whitespace will i=
ntroduce trouble here<br>
&gt; The optional *character set is limited to [/+-] (serveral more)*, only=
 those optional characters will be recgonized.<br>
<div class=3D"im">&gt; so you can still write {:json|{a;b}|}<br>
&gt; but {:json|/{a;b|}}/|} also works<br>
<br>
</div>Without a whitespace how do you know if the &#39;/&#39; is your optio=
nal character or part of the quoted syntax?<br>
(unless you restrict the quoted syntax&#39;s first character to be somethin=
g else than the optional characters)<br>
<br></blockquote><div>exactly( optional chars is a limited set, but is enou=
gh in practice,(stolen from perl)=C2=A0</div><blockquote class=3D"gmail_quo=
te" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"=
>
What do you think of this syntax:<br>
{:lid|...|lid:}<br>
<br></blockquote><div>no, we introduce Language namespace, sometimes you ca=
n write unamed quotations XD=C2=A0</div><blockquote class=3D"gmail_quote" s=
tyle=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
Its still quite easy to find where quotation&#39;s bounds are, it is symmet=
ric, and the end marker should be long enough<br>
to not cause false matches inside the quotation.<br>
<br>
Best regards,<br>
--Edwin<br>
</blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regards, =
Hongbo

--f46d043c7d60faa4d504d495da2d--

From gabriel.scherer@gmail.com  Thu Jan 31 13:44:43 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A09973C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:44:43 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.41 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f41.google.com ([209.85.214.41]:48333)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0uVr-0005ix-pU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 31 Jan 2013 13:49:12 +0000
Received: by mail-bk0-f41.google.com with SMTP id q16so1376001bkw.0
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 05:49:11 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=59BhSVQUGuN/uyrXVQSumZr6pnfbdUkj5kr3dastfzo=;
 b=dyodk+SAlGkn8aE1sMq2ZWUs6/whOl7so9C2rRzOzPAXzd1NZjgOdUu1mqQMzNjYrD
 8aWoViVC7wNeAurkZboYs5jk69sYc+B23dRbGSGPB2Ae2WNZHLjRlR+5f5A0J1VNHNwG
 DNth8AIKHeH0toQ8W8IqI0xRAPRkpPKsPAuOs6UNDc5y/PEEE4HXzQp9kl/ztJPFwvQ/
 aMh1GYF/yRuLDFjuX6SsCXCCnK0KLBxc1sc324cq9j1T8Jmoh9KMdspzkSlAMut3OWtJ
 8kalQgQYPdZpTh7d0HCWVt+ji/EM9f4WuiXL+/uugHBhT/g7HZS8BBpGCCaa6LYvvg0p
 Hw2Q==
X-Received: by 10.204.11.68 with SMTP id s4mr2254096bks.74.1359640151512; Thu,
 31 Jan 2013 05:49:11 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.236.134 with HTTP; Thu, 31 Jan 2013 05:48:31 -0800 (PST)
In-Reply-To: <510A6D89.9000507@lexifi.com>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 31 Jan 2013 14:48:31 +0100
Message-ID: <CAPFanBH+0kyAqBZCqmzM9jiEC=ikM1fO30h3F4jV3QvEK2EN9g@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:44:43 -0000

> When fragments of JSON/XML/etc are created programatically, this is often done "piece by piece",
> with very small fragments involving a high density of anti-quotations.
> The benefits of using the foreign syntax here are not clear to me.

This is an argument that I would very much like to be convinced of,
but that does not really match my experience. I have found this style
of piece-by-piece code difficult to understand and maintain, and when
I find the time to do things properly I very much try to have a
central piece of code that reflects the foreign structure (as a
quasiquotation when possible, or a dense expression using combinators
otherwise), preceded by the auxiliary definitions. (It's not always
possible or easy when you need data to flow from some part of the
generated AST to others).

As an example, you are probably familiar with the following piece of
code in the OCaml type-checker, that builds a non-trivial part of
typedtree in a semi-piecewise way to handle a corner case of optional
argument functions (and is probably going away someday), from L2784 to
L2813 here:
  https://github.com/ocaml/ocaml/blob/1b5d02346c8e477dbe38dd883d3b6f430924190d/typing/typecore.ml#L2784

This code is, quite frankly, quite painful to make sense of, and I
think this is in a large part related by the fact that it builds the
typedtree piecewise (relatively; it could be even more fine-grained)
instead of building the entire expression, that is (in approximative
Camlp{4,5} syntax)
  <:texp<
     let $x,tty$ = $texp$ in
     (fun $y,targ$ -> $x$ $list:zip labels none$ $y,targ$)
  >>;
that said, a smart combinator library could produce an equally (or
more, or less, depending on who you ask) readable example, for
example:
  tlet x tty (fun x ->
    tfun y targ (fun y ->
      tnapp x (zip labels none @ [y])))
and in this case the "domain-specific syntax" argument does not hold.


Anil's counter-point (converting specialized embeddings to build-time
code generation) is interesting as well. He did not (by modesty?) cite
his ocaml-orm-sqlite project (
https://github.com/avsm/ocaml-orm-sqlite ) which is doing much of the
same thing in the database field. Maybe my "Use cases for syntax
extensions" wikipage could be augmented with "Non-use cases for syntax
extensions" example?

On Thu, Jan 31, 2013 at 2:11 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 01/31/2013 01:44 PM, Gabriel Scherer wrote:
>>
>> The point of quoting foreign languages is to translate them into a
>> form that exercize the OCaml type-checker to produce rich typing
>> information. With (parse_json "...") you have no static typing
>> information on the parsed value, while with a quotation you can expect
>> to get, say, a (< streetAdress : string > Json.t) expression.
>> Supporting antiquotations there allows you to write those foreign
>> values in a composable way, eg. using <:json< { streetAddress: $addr$
>> } >> with (addr : string Json.t).
>>
>> This is essentially a nice concrete syntax on top of the typed
>> combinators (point 1. in your message quoted below); indeed, good
>> extensions should embed as few domain knowledge as possible and defer
>> that to the pure-ocaml library providing the combinators.
>
>
> There are two very different topic here: syntax and type-checking.
>
>
> Clever type-checking of the DSL can be done either with combinators, and
> when this is not possible, it makes sense to have some "pre-processors"
> doing clever stuff like adding type annotations.  When we write:
>
>  (:json { streetAddress: "21 2snd Street" })
>
> or even:
>
>  (:json M["streetAdress", S "21 2snd Street"])
>
> this can be expanded to something more clever than just untyped
> constructors.  But there is no reason to force using the concrete syntax of
> the foreign language (which is not really true, because you want to allow
> anti-quotations which are not part of that syntax).  The syntax of OCaml is
> rich enough that a lot of other languages can be encoded in it.  The
> downside is that we need to make it clear syntactically that a fragment will
> be interpreted in a special way.  The upside is that no "parsing technology"
> is involved, which simplifies the design (choice of a syntax for
> anti-quotations), the implementation (writing a parser and calling back the
> OCaml parser on anti-quotations, with careful tracking of locations) and the
> user experience (support from editors, learning details of a concrete syntax
> [you might want to write JSON producers on an abstract level, and benefit
> from clever type-checking, but without knowing exactly how strings have to
> be escaped in concrete JSON]).
>
>
>> Furthermore, the bare approach of using combinators directly is not
>> always desirable in situations where you want the code to be used by
>> non-domain-experts. "Templates" in web programming are an entire
>> cottage industry made of preprocessing HTML-looking quasiquotations,
>> to help the role separation between designers and programmers.
>
>
> When non-programmers have to write some HTML code, this code rarely ends up
> in OCaml source code.  Usually, it stays in its own HTML file, which is then
> processed (statically or dynamically) by the (OCaml) code.
>
> When fragments of JSON/XML/etc are created programatically, this is often
> done "piece by piece", with very small fragments involving a high density of
> anti-quotations.  The benefits of using the foreign syntax here are not
> clear to me.
>
>
>
>> This is maybe less visible for non-programmable data description
>> languages such as JSON, but I suspect this still holds. For example,
>> if you distribute a protocol library built on top of JSON and bridging
>> over many programming languages, you want the same maintainer to be
>> able to quickly reflect changes to the protocol schema over all
>> implements. This is vastly easier if they respect the domain-specific
>> syntax instead of each having an embedding following the concrete
>> syntax of the corresponding language.
>
>
> I understand the theoretical argument, but I don't think it would apply in
> practice to many OCaml projects.
>
>
> Alain

From lpw25@hermes.cam.ac.uk  Thu Jan 31 13:52:02 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id F2ECF3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:52:01 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:34324)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0ucw-000311-YV (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 13:56:30 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0ucw-00018G-L7 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 13:56:30 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 31 Jan 2013 13:56:30 +0000
Date: 31 Jan 2013 13:56:30 +0000
From: Leo White <lpw25@cam.ac.uk>
To: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
Message-ID: <Prayer.1.3.5.1301311356300.2838@hermes-1.csi.cam.ac.uk>
In-Reply-To: <510A7509.1000007@etorok.net>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
 <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
 <510A7509.1000007@etorok.net>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:52:02 -0000

>What do you think of this syntax:
>{:lid|...|lid:}

What about nested uses of the same quotation?

From bobzhang1988@gmail.com  Thu Jan 31 13:53:23 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8D2373C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:53:23 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f173.google.com ([209.85.128.173]:44967)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0ueG-0001XJ-md (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 13:57:52 +0000
Received: by mail-ve0-f173.google.com with SMTP id oz10so2020671veb.18
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 05:57:51 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=a87HyfKKIROmykempH00+qPX9k7/1tU+uGBRdPOYs88=;
 b=e73fCwfPQimOiNFPx/iNNEJ3M6BLoNgzCJXL1QwmQKXKQvyprPnkV95bq+budUfOKL
 yRtPH2LIG5Q+g2o0AcG5LD4NAWmhHqL9CvfhO/iq1iWK7pDmQAe1BG/zgxnwQF6YM9a4
 ksXsJRtEVbGw7EQPCqODvv5IYujM86Tz7eyqWaDTUgfyVWFOGymCmuF8csdWoyQ5eDHn
 WFNRvxRpLjdNcBzQ7kYoG0qhoOtW8cDV4I1u9ncQGpABbFBoz14RxrFp44SjBbtPgGSq
 5zZ+2pX/fWdcj4clcM3N0uXgXFVKB00wSW7kTRVtk7WhBsW9ZGDiibtNwiUqivYbBVcC
 RzXQ==
MIME-Version: 1.0
X-Received: by 10.52.21.175 with SMTP id w15mr7041047vde.100.1359640671287;
 Thu, 31 Jan 2013 05:57:51 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Thu, 31 Jan 2013 05:57:51 -0800 (PST)
In-Reply-To: <510A74AC.4070302@lexifi.com>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
Date: Thu, 31 Jan 2013 08:57:51 -0500
X-Google-Sender-Auth: bSm68JIExXGnktN6kuM4lTCzxmE
Message-ID: <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=20cf307c9bba3bfc0c04d49603f0
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:53:23 -0000

--20cf307c9bba3bfc0c04d49603f0
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Jan 31, 2013 at 8:42 AM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> On 01/31/2013 02:32 PM, Hongbo Zhang wrote:
>
>> Would you mind elaborating a bit why it will complex editor support?
>>
>
> The content of a quotation can use arbitrary grammar and even arbitrary
> lexical rules.
>
> If the editor cannot lex the content of the quotation, it cannot produce
> nice colors for lexical entities in it.  If emacs produce decent colors on
> some example with quotation, it is only because it does not know anything
> about quotation and the example is simple enough so that applying OCaml
> rules works quite well.  But if the content of the quotation follows other
> lexical rules, emacs gets confused. Write:
>
>   let x = foo << " >> bar
>
> This is unfair, how do you overcome this problem in ppx. The same thing,
except that you don't use it

> and emacs will color ">> bar" as if it were a string.  The only decent
> think an editor could do with a quotation is to understand where it stops
> and not try to do anything clever with it.  If we adapt the OCaml emacs
> mode to recognize camlp4's quotation and do that, you won't get any colors
> within quotations (correct behavior, but not if you write non-trivial
> multi-line OCaml expressions in it, as in your 'sedlex' version).
>
> Even if the lexical conventions are right, the editor cannot produce
> correct indentation if it doesn't know the grammar used inside the
> quotation.
>
>
> Alain
>
>


-- 
-- Regards, Hongbo

--20cf307c9bba3bfc0c04d49603f0
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Thu, Jan 31, 2013 at 8:42 AM, Alain F=
risch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain.frisch@lexifi.com" targ=
et=3D"_blank">alain.frisch@lexifi.com</a>&gt;</span> wrote:<br><blockquote =
class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid=
;padding-left:1ex">

<div>On 01/31/2013 02:32 PM, Hongbo Zhang wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Would you mind elaborating a bit why it will complex editor support?<br>
</blockquote>
<br></div>
The content of a quotation can use arbitrary grammar and even arbitrary lex=
ical rules.<br>
<br>
If the editor cannot lex the content of the quotation, it cannot produce ni=
ce colors for lexical entities in it. =A0If emacs produce decent colors on =
some example with quotation, it is only because it does not know anything a=
bout quotation and the example is simple enough so that applying OCaml rule=
s works quite well. =A0But if the content of the quotation follows other le=
xical rules, emacs gets confused. Write:<br>


<br>
=A0 let x =3D foo &lt;&lt; &quot; &gt;&gt; bar<br>
<br></blockquote><div>This is unfair, how do you overcome this problem in p=
px. The same thing, except that you don&#39;t use it</div><blockquote class=
=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padd=
ing-left:1ex">


and emacs will color &quot;&gt;&gt; bar&quot; as if it were a string. =A0Th=
e only decent think an editor could do with a quotation is to understand wh=
ere it stops and not try to do anything clever with it. =A0If we adapt the =
OCaml emacs mode to recognize camlp4&#39;s quotation and do that, you won&#=
39;t get any colors within quotations (correct behavior, but not if you wri=
te non-trivial multi-line OCaml expressions in it, as in your &#39;sedlex&#=
39; version).<br>


<br>
Even if the lexical conventions are right, the editor cannot produce correc=
t indentation if it doesn&#39;t know the grammar used inside the quotation.=
<span><font color=3D"#888888"><br>
<br>
<br>
Alain<br>
<br>
</font></span></blockquote></div><br><br clear=3D"all"><div><br></div>-- <b=
r>-- Regards, Hongbo

--20cf307c9bba3bfc0c04d49603f0--

From edwin+ml-ocaml@etorok.net  Thu Jan 31 13:53:24 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7EEA03C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:53:24 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.2 from SpamAssassin-3.3.2-1440304 
 * -0.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:57286)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0ueH-0001Xy-nS (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Thu, 31 Jan 2013 13:57:53 +0000
Received: from [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d] (unknown
 [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d])
 by mail.etorok.net (Postfix) with ESMTPSA id D7D2446B5;
 Thu, 31 Jan 2013 14:57:52 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359640673;
 bh=XIgZKcAlVzZDIMahFCbRnmPPZ1tLGUQVKG4JC+p1WX8=;
 h=Message-ID:Date:From:MIME-Version:To:CC:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=kimiDlmRZtHiBQ9LiRUcEB6PAuKSCaE0a/kt4BKhCUphpN20U9hbQDPD2QEd97+cX
 uaGWzKi/u0M3K9Or+3rN3KrWO/k8GlWDdYjue4U2pxFnMsNI5e0RdYBhjcjrLS0aEX
 5z10Qsw4BP8xGd/upY20KxvRuasjPHRgeYZqET50=
Message-ID: <510A7860.1060505@etorok.net>
Date: Thu, 31 Jan 2013 15:57:52 +0200
From: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
 <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
 <510A7509.1000007@etorok.net>
 <Prayer.1.3.5.1301311356300.2838@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301311356300.2838@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:53:24 -0000

On 01/31/2013 03:56 PM, Leo White wrote:
>> What do you think of this syntax:
>> {:lid|...|lid:}
> 
> What about nested uses of the same quotation?
> 

Handled like nested comments, assuming the lexer knows where the anti-quotations are.

--Edwin

From lpw25@hermes.cam.ac.uk  Thu Jan 31 13:57:33 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 730F43C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:57:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:37972)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0uiI-0006lN-pq (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 14:02:02 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0uiI-0001ur-1I (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 14:02:02 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 31 Jan 2013 14:02:02 +0000
Date: 31 Jan 2013 14:02:02 +0000
From: Leo White <lpw25@cam.ac.uk>
To: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
Message-ID: <Prayer.1.3.5.1301311402020.2838@hermes-1.csi.cam.ac.uk>
In-Reply-To: <510A7860.1060505@etorok.net>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
 <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
 <510A7509.1000007@etorok.net>
 <Prayer.1.3.5.1301311356300.2838@hermes-1.csi.cam.ac.uk>
 <510A7860.1060505@etorok.net>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 13:57:33 -0000

On Jan 31 2013, T=F6r=F6k Edwin wrote:

>On 01/31/2013 03:56 PM, Leo White wrote:
>>> What do you think of this syntax:
>>> {:lid|...|lid:}
>>=20
>> What about nested uses of the same quotation?
>>=20
>
> Handled like nested comments, assuming the lexer knows where the=20
> anti-quotations are.

An assumption that I really don't think we should make. It involves forcing=
=20
a particular style of anti-quotation on all extensions. Besides it is=20
easier to simply use a syntax that supports unique delimiters.


From lpw25@hermes.cam.ac.uk  Thu Jan 31 14:14:59 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AFEEC3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 14:14:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:40938)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0uzA-0005eQ-Yt (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 14:19:28 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0uzA-0004Sh-PH (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 14:19:28 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 31 Jan 2013 14:19:28 +0000
Date: 31 Jan 2013 14:19:28 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1301311419280.10608@hermes-1.csi.cam.ac.uk>
In-Reply-To: <510A74AC.4070302@lexifi.com>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: [wg-camlp4] Supporting traditional quotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 14:14:59 -0000

Since what we are currently debating is whether to add a lightweight syntax 
for a type of syntax extension that is used by a number of extensions and 
appreciated by a number of people, is there any real issue with including 
it?

I don't think that "I don't like using those kind of extensions" is a good 
reason to prevent them (or make them more awkward) for the people who do 
like using them.

Similarly, I think that we should support the type-conv style syntax:

type foo =
  | Foo of int
with sexp, bin_io

Sure, this could be changed to use the attribute syntax:

type foo =
  | Foo of int
(@ sexp)
(@ bin_io)

but the original is convenient, already used for a number of extensions and 
has proved popular.

In general there is little harm in supporting syntaxes/extensions that are 
already widespread.


From edwin+ml-ocaml@etorok.net  Thu Jan 31 14:23:23 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 79A533C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 14:23:23 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.1 from SpamAssassin-3.3.2-1440304 
 *  1.1 DKIM_ADSP_ALL No valid author signature, domain signs all mail
 * -0.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:57308)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0v7H-0007zg-ng (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Thu, 31 Jan 2013 14:27:52 +0000
Received: from [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d] (unknown
 [IPv6:2a02:2f09:4080:1e7:1e6f:65ff:fe23:db0d])
 by mail.etorok.net (Postfix) with ESMTPSA id 9D8AC46B5;
 Thu, 31 Jan 2013 15:27:50 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1359642470;
 bh=6ALSu4wKT6XoPGvlLnjsJ7xEQFgGFZTe7BqCQTZJww4=;
 h=Message-ID:Date:From:MIME-Version:To:CC:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=fqfMXXyH5kVTaU+VgKvXmoTxRm6OTEIadR3085CqTcfrLwrpR7Q4Siv4rAVcgoJd0
 bI0pQgJZDbiqn+8h8kfis8zYMFbFCCCT2Qg8p22D5F9YOrZeNWp7mP6O8pWlANphtw
 moPq71HhK+83+tfHEts/FTJxs+J4DMcl4xuxMhdQ=
Message-ID: <510A7F66.2080409@etorok.net>
Date: Thu, 31 Jan 2013 16:27:50 +0200
From: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
 <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
 <510A7509.1000007@etorok.net>
 <Prayer.1.3.5.1301311356300.2838@hermes-1.csi.cam.ac.uk>
 <510A7860.1060505@etorok.net>
 <Prayer.1.3.5.1301311402020.2838@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301311402020.2838@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 14:23:23 -0000

On 01/31/2013 04:02 PM, Leo White wrote:
> On Jan 31 2013, T=F6r=F6k Edwin wrote:
>=20
>> On 01/31/2013 03:56 PM, Leo White wrote:
>>>> What do you think of this syntax:
>>>> {:lid|...|lid:}
>>>
>>> What about nested uses of the same quotation?
>>>
>>
>> Handled like nested comments, assuming the lexer knows where the anti-=
quotations are.
>=20
> An assumption that I really don't think we should make. It involves for=
cing a particular style of anti-quotation on all extensions. Besides it i=
s easier to simply use a syntax that supports unique
> delimiters.
>=20

Even without a defined syntax for anti-quotations you could detect both {=
:lid| and |lid:} inside quotations:

{:foo| something $
  {:foo| something-else |foo:}
 ...$ ...
|foo:}

But I agree that this might be confusing for users, and introduce unnnece=
sary limitation on what you can use inside a quotation, so
your user-defined delimiter is probably a better idea.

Best regards,
--Edwin





From gabriel.scherer@gmail.com  Thu Jan 31 14:25:55 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7CB203C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 14:25:55 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.48 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f48.google.com ([209.85.214.48]:41210)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0v9g-0004rt-ra (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 31 Jan 2013 14:30:21 +0000
Received: by mail-bk0-f48.google.com with SMTP id jf20so1372988bkc.21
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 06:30:20 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type:content-transfer-encoding;
 bh=/u1UG9dFcPDlO+EqtK9PSewmu2JL9VhTmrvy2ixRyK4=;
 b=tTYTqIrAsvMjdrMILCwisZnk+TllzPHpV6cBLHc3738cqjUkxLT0ypUCulg4pUV0tk
 mdtlnobkcWboR+w838DrhnGh/ucPNeWodTBzUxuXz6z32cmCucYX9+Yrr1F8+HRvcUxA
 67QEJZo7Gv6ew5HI5ZTYlNausZEfXLjBkXx6HWJunBSDH4CZUfzUG8gV4qElOwZla/mp
 bPf0wLwpYNa8pc7eQHmqiExHDCgDVVp80JDeRQWDehXC240hFQRl9vDbR4SGuftZ877x
 sjNuyRUpaYCAr9Ay9n668PgIjqdYVz+uGH8qqAn29YAvU2XDWM5K4v4twlidTgIQRQhl
 Nwtg==
X-Received: by 10.204.147.147 with SMTP id l19mr2288208bkv.91.1359642620314;
 Thu, 31 Jan 2013 06:30:20 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.236.134 with HTTP; Thu, 31 Jan 2013 06:29:40 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1301311402020.2838@hermes-1.csi.cam.ac.uk>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
 <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
 <510A7509.1000007@etorok.net>
 <Prayer.1.3.5.1301311356300.2838@hermes-1.csi.cam.ac.uk>
 <510A7860.1060505@etorok.net>
 <Prayer.1.3.5.1301311402020.2838@hermes-1.csi.cam.ac.uk>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 31 Jan 2013 15:29:40 +0100
Message-ID: <CAPFanBGN0WOr_TgvH8G_K-5704a23ct8+1h3XHmNa-hjL6ef2Q@mail.gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 14:25:55 -0000

>>> What about nested uses of the same quotation?
>>>
>> Handled like nested comments, assuming the lexer knows where the
>> anti-quotations are.
>
> An assumption that I really don't think we should make. It involves forci=
ng
> a particular style of anti-quotation on all extensions. Besides it is eas=
ier
> to simply use a syntax that supports unique delimiters.

Note that there is a nice continuum in the design space for
compromises between syntactic flexibility and easy tool support
(assuming non-smart, non-extensible tools that know how to handle
OCaml code):

0) Pure OCaml syntax : combinator libraries, etc. (note: this is where
the mixfix discussion fits)
1) Alain's style of all-OCaml expressions, using annotations to denote
the domain-specific semantics (tool support for the whole expression)
2) Quotations with an agreed-upon antiquotation syntax (tool support
inside antiquotations)
3) Quotations with extension-custom antiquotation syntax (no tool
support; treated like a string)

I would be interested in seeing which use cases can be satisfyingly
encoded under which approaches. I personally suspect that for
small-scale syntax supports (say, regexps), the outer quotation syntax
being too heavy is more problematic that any antiquotation syntax
considerations (because if it needs to be short it probably doesn't
have antiquotations besides possibly a custom syntax to denote OCaml
variables, that need no editor support).

(Note: to my knowledge, Hongbo was the first to remark (
http://caml.inria.fr/mantis/view.php?id=3D5665 ) that the Camlp4 syntax
for antiquotations was problematic for nested *antiquotations*. That's
a cogent point that can also be taken into consideration, and
something I like about his work on Fan. The use cases for this are
however quite specialized, so it will be easy to counter-argue that
those considerations are for the Fan-class of preprocessing, not the
included-in-the-language-itself one.)

On Thu, Jan 31, 2013 at 3:02 PM, Leo White <lpw25@cam.ac.uk> wrote:
> On Jan 31 2013, T=F6r=F6k Edwin wrote:
>
>> On 01/31/2013 03:56 PM, Leo White wrote:
>>>>
>>>> What do you think of this syntax:
>>>> {:lid|...|lid:}
>>>
>>>
>>> What about nested uses of the same quotation?
>>>
>>
>> Handled like nested comments, assuming the lexer knows where the
>> anti-quotations are.
>
>
> An assumption that I really don't think we should make. It involves forci=
ng
> a particular style of anti-quotation on all extensions. Besides it is eas=
ier
> to simply use a syntax that supports unique delimiters.
>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From bobzhang1988@gmail.com  Thu Jan 31 14:42:21 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D573B3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 14:42:21 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.50 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f50.google.com ([209.85.212.50]:59479)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0vPd-0005rb-S6 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 14:46:51 +0000
Received: by mail-vb0-f50.google.com with SMTP id ft2so1760122vbb.23
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 06:46:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=dIkaOzWvO7UF8YyAlkMJFtHSLE87xgozqKD2WHhk3pA=;
 b=YqqKABbIlQCGoI3eFtWlnFFtaXyc3S5InymgjVibaHpyfY4yH/P5KTYNFO69XVo9Se
 9V09S1K/LQHrfYmsVvJBi7hHj8OmiaUDHX8UpQdJq1bpIO6Trr4OoBU7nYO9PtKOxhGf
 EKfyAXelU2nzsW8EYVvK78N8vY5Y4N1h7HITvH1w9u+8BdRVqoQ+hvLx2Tz9n5MsxxgW
 NcjHQGPkbLlH76xkV+Q3/ldOPmml/xlVIi3mPd93HcaryNZGJg+vl3AHcXB7dQczxeKr
 f1BJKnacmB72pRSc198LnN1EEIS5vVC00bJjaw8rtZuH9STKaEcNZepSCxGs8LAwQvMq
 5gSw==
MIME-Version: 1.0
X-Received: by 10.58.15.227 with SMTP id a3mr4026639ved.38.1359643608963; Thu,
 31 Jan 2013 06:46:48 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Thu, 31 Jan 2013 06:46:48 -0800 (PST)
In-Reply-To: <CAPFanBGN0WOr_TgvH8G_K-5704a23ct8+1h3XHmNa-hjL6ef2Q@mail.gmail.com>
References: <CANcqPu7+B+kch9eGVBfNyLmsZNP38qD81RML=DuzD+xAgVhGBw@mail.gmail.com>
 <CANcqPu5YXiZZqN7uH1u_8dQ6VxKTSELSRhvfSkaOnqJGKAo5Ow@mail.gmail.com>
 <5108E3E3.307@frisch.fr>
 <Prayer.1.3.5.1301300931510.9358@hermes-1.csi.cam.ac.uk>
 <5108FA0D.5010802@frisch.fr>
 <Prayer.1.3.5.1301301121550.2899@hermes-1.csi.cam.ac.uk>
 <51093113.1080906@frisch.fr>
 <Prayer.1.3.5.1301301511470.25451@hermes-1.csi.cam.ac.uk>
 <51093DF5.9080306@frisch.fr>
 <Prayer.1.3.5.1301301613540.31905@hermes-1.csi.cam.ac.uk>
 <51095364.9080001@frisch.fr>
 <Prayer.1.3.5.1301311148320.23992@hermes-1.csi.cam.ac.uk>
 <510A6362.8070504@frisch.fr>
 <Prayer.1.3.5.1301311242470.25787@hermes-1.csi.cam.ac.uk>
 <CANcqPu5disPNwgYFdMvr003rh9odgx47u5zsGDT3sGQMve9Mqw@mail.gmail.com>
 <510A6FEA.3080807@etorok.net>
 <CANcqPu5AvgRhyZRwocfA2AMH-HRY9pFk+agG8FgDNAdYiZkhCg@mail.gmail.com>
 <510A7509.1000007@etorok.net>
 <Prayer.1.3.5.1301311356300.2838@hermes-1.csi.cam.ac.uk>
 <510A7860.1060505@etorok.net>
 <Prayer.1.3.5.1301311402020.2838@hermes-1.csi.cam.ac.uk>
 <CAPFanBGN0WOr_TgvH8G_K-5704a23ct8+1h3XHmNa-hjL6ef2Q@mail.gmail.com>
Date: Thu, 31 Jan 2013 09:46:48 -0500
X-Google-Sender-Auth: PNz-8IiI6s9qButTgPc2nSUnTpI
Message-ID: <CANcqPu6vGKXUGzJu=oQ8n8qP=X4wgAy6MvoFA5RArg26ZdGrDQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: multipart/alternative; boundary=047d7b5daf50555b9a04d496b2ee
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Meta Programming from the view of the implementaion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 14:42:21 -0000

--047d7b5daf50555b9a04d496b2ee
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Besides, I would really appreciate that we don't introduce *too many ad-hoc
rules*. typing several more characters is ok, typing hundred lines of code
does matter.

Haskell already suffers from its too flexible syntaxes, think about
haskell-src-meta which is a Haskell front-end, can not parse Haskell
correctly due to the fact that haskell's operator precedence is dynamic.

So far, to my best knowledge, all the feature requests should be not too
hard to implement or already exist  in Fan(without changing the grammar),
so I do hope that we don't introduce too much complexity in Parsetree for
little benefit or *making tooling too hard.*

Only one syntax extension I think revised syntax did in a write way is
match with [ ... ], the closed brackets really helps to avoid a lot of bugs=
.

On Thu, Jan 31, 2013 at 9:29 AM, Gabriel Scherer
<gabriel.scherer@gmail.com>wrote:

> >>> What about nested uses of the same quotation?
> >>>
> >> Handled like nested comments, assuming the lexer knows where the
> >> anti-quotations are.
> >
> > An assumption that I really don't think we should make. It involves
> forcing
> > a particular style of anti-quotation on all extensions. Besides it is
> easier
> > to simply use a syntax that supports unique delimiters.
>
> Note that there is a nice continuum in the design space for
> compromises between syntactic flexibility and easy tool support
> (assuming non-smart, non-extensible tools that know how to handle
> OCaml code):
>
> 0) Pure OCaml syntax : combinator libraries, etc. (note: this is where
> the mixfix discussion fits)
> 1) Alain's style of all-OCaml expressions, using annotations to denote
> the domain-specific semantics (tool support for the whole expression)
> 2) Quotations with an agreed-upon antiquotation syntax (tool support
> inside antiquotations)
> 3) Quotations with extension-custom antiquotation syntax (no tool
> support; treated like a string)
>
> I would be interested in seeing which use cases can be satisfyingly
> encoded under which approaches. I personally suspect that for
> small-scale syntax supports (say, regexps), the outer quotation syntax
> being too heavy is more problematic that any antiquotation syntax
> considerations (because if it needs to be short it probably doesn't
> have antiquotations besides possibly a custom syntax to denote OCaml
> variables, that need no editor support).
>
> (Note: to my knowledge, Hongbo was the first to remark (
> http://caml.inria.fr/mantis/view.php?id=3D5665 ) that the Camlp4 syntax
> for antiquotations was problematic for nested *antiquotations*. That's
> a cogent point that can also be taken into consideration, and
> something I like about his work on Fan. The use cases for this are
> however quite specialized, so it will be easy to counter-argue that
> those considerations are for the Fan-class of preprocessing, not the
> included-in-the-language-itself one.)
>
> On Thu, Jan 31, 2013 at 3:02 PM, Leo White <lpw25@cam.ac.uk> wrote:
> > On Jan 31 2013, T=F6r=F6k Edwin wrote:
> >
> >> On 01/31/2013 03:56 PM, Leo White wrote:
> >>>>
> >>>> What do you think of this syntax:
> >>>> {:lid|...|lid:}
> >>>
> >>>
> >>> What about nested uses of the same quotation?
> >>>
> >>
> >> Handled like nested comments, assuming the lexer knows where the
> >> anti-quotations are.
> >
> >
> > An assumption that I really don't think we should make. It involves
> forcing
> > a particular style of anti-quotation on all extensions. Besides it is
> easier
> > to simply use a syntax that supports unique delimiters.
> >
> >
> > _______________________________________________
> > wg-camlp4 mailing list
> > wg-camlp4@lists.ocaml.org
> > http://lists.ocaml.org/listinfo/wg-camlp4
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>



--=20
-- Regards, Hongbo

--047d7b5daf50555b9a04d496b2ee
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Besides, I would really appreciate that we don&#39;t introduce <b>too many =
ad-hoc rules</b>. typing several more characters is ok, typing hundred line=
s of code does matter.<div><br></div><div>Haskell already suffers from its =
too flexible syntaxes, think about haskell-src-meta which is a Haskell fron=
t-end, can not parse Haskell correctly due to the fact that haskell&#39;s o=
perator precedence is dynamic.</div>
<div>=A0<br><div>So far, to my best knowledge, all the feature requests sho=
uld be not too hard to implement or already exist =A0in Fan(without changin=
g the grammar), so I do hope that we don&#39;t introduce too much complexit=
y in Parsetree for little benefit or <b>making tooling too hard.</b>=A0</di=
v>
<div><br></div><div>Only one syntax extension I think revised syntax did in=
 a write way is</div><div>match with [ ... ], the closed brackets really he=
lps to avoid a lot of bugs.<br><br><div class=3D"gmail_quote">On Thu, Jan 3=
1, 2013 at 9:29 AM, Gabriel Scherer <span dir=3D"ltr">&lt;<a href=3D"mailto=
:gabriel.scherer@gmail.com" target=3D"_blank">gabriel.scherer@gmail.com</a>=
&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">&gt;&gt;&gt; What about ne=
sted uses of the same quotation?<br>
&gt;&gt;&gt;<br>
&gt;&gt; Handled like nested comments, assuming the lexer knows where the<b=
r>
&gt;&gt; anti-quotations are.<br>
&gt;<br>
&gt; An assumption that I really don&#39;t think we should make. It involve=
s forcing<br>
&gt; a particular style of anti-quotation on all extensions. Besides it is =
easier<br>
&gt; to simply use a syntax that supports unique delimiters.<br>
<br>
</div>Note that there is a nice continuum in the design space for<br>
compromises between syntactic flexibility and easy tool support<br>
(assuming non-smart, non-extensible tools that know how to handle<br>
OCaml code):<br>
<br>
0) Pure OCaml syntax : combinator libraries, etc. (note: this is where<br>
the mixfix discussion fits)<br>
1) Alain&#39;s style of all-OCaml expressions, using annotations to denote<=
br>
the domain-specific semantics (tool support for the whole expression)<br>
2) Quotations with an agreed-upon antiquotation syntax (tool support<br>
inside antiquotations)<br>
3) Quotations with extension-custom antiquotation syntax (no tool<br>
support; treated like a string)<br>
<br>
I would be interested in seeing which use cases can be satisfyingly<br>
encoded under which approaches. I personally suspect that for<br>
small-scale syntax supports (say, regexps), the outer quotation syntax<br>
being too heavy is more problematic that any antiquotation syntax<br>
considerations (because if it needs to be short it probably doesn&#39;t<br>
have antiquotations besides possibly a custom syntax to denote OCaml<br>
variables, that need no editor support).<br>
<br>
(Note: to my knowledge, Hongbo was the first to remark (<br>
<a href=3D"http://caml.inria.fr/mantis/view.php?id=3D5665" target=3D"_blank=
">http://caml.inria.fr/mantis/view.php?id=3D5665</a> ) that the Camlp4 synt=
ax<br>
for antiquotations was problematic for nested *antiquotations*. That&#39;s<=
br>
a cogent point that can also be taken into consideration, and<br>
something I like about his work on Fan. The use cases for this are<br>
however quite specialized, so it will be easy to counter-argue that<br>
those considerations are for the Fan-class of preprocessing, not the<br>
included-in-the-language-itself one.)<br>
<div class=3D"HOEnZb"><div class=3D"h5"><br>
On Thu, Jan 31, 2013 at 3:02 PM, Leo White &lt;<a href=3D"mailto:lpw25@cam.=
ac.uk">lpw25@cam.ac.uk</a>&gt; wrote:<br>
&gt; On Jan 31 2013, T=F6r=F6k Edwin wrote:<br>
&gt;<br>
&gt;&gt; On 01/31/2013 03:56 PM, Leo White wrote:<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; What do you think of this syntax:<br>
&gt;&gt;&gt;&gt; {:lid|...|lid:}<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; What about nested uses of the same quotation?<br>
&gt;&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt; Handled like nested comments, assuming the lexer knows where the<b=
r>
&gt;&gt; anti-quotations are.<br>
&gt;<br>
&gt;<br>
&gt; An assumption that I really don&#39;t think we should make. It involve=
s forcing<br>
&gt; a particular style of anti-quotation on all extensions. Besides it is =
easier<br>
&gt; to simply use a syntax that supports unique delimiters.<br>
&gt;<br>
&gt;<br>
</div></div><div class=3D"HOEnZb"><div class=3D"h5">&gt; __________________=
_____________________________<br>
&gt; wg-camlp4 mailing list<br>
&gt; <a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org=
</a><br>
&gt; <a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank=
">http://lists.ocaml.org/listinfo/wg-camlp4</a><br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo
</div></div>

--047d7b5daf50555b9a04d496b2ee--

From alain.frisch@lexifi.com  Thu Jan 31 15:18:37 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8D8EB3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 15:18:37 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440304 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:25814
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U0vyh-0006uL-QR (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 31 Jan 2013 15:23:06 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d61 with ME
 id ufP11k0083lHbAL03fP1GA; Thu, 31 Jan 2013 16:23:02 +0100
Message-ID: <510A8C53.7080903@lexifi.com>
Date: Thu, 31 Jan 2013 16:22:59 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
In-Reply-To: <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 15:18:37 -0000

On 01/31/2013 02:57 PM, Hongbo Zhang wrote:
>
>        let x = foo << " >> bar
>
> This is unfair, how do you overcome this problem in ppx. The same thing,
> except that you don't use it

The discussion here is not about ppx vs camlp4, but whether it is a good 
idea to use quotations with "ocaml code in them".  My argument is that 
it is a very bad idea, because the only decent way to support quotation 
in editor modes is to ignore them (which is not currently the case).

I hope, for instance, that the ocaml emacs mode will be adapted to 
whatever syntax for quotation we choose to support natively in OCaml. 
Once this is done, emacs will no longer be confused with examples as the 
one above (good!), but it will no longer provide any assistance if OCaml 
code had to be written inside the quotation (bad! but only if we 
implement sedlex as you suggest, with a big quotation around the whole 
lexer definition, including actions).  If quotations are purely used to 
inject code in foreign syntax (with very simple anti-quotations which 
don't really benefit from editor support), this correct behavior of 
editors is no longer a problem.

Let me clarify my position about quotations:

The whole point of quotations, for me, is to escape from OCaml lexical 
convention.  If we have to embed fragments of foreign language syntax 
which works fine with OCaml rules (e.g. fragments which don't need 
double quotes or backslashes), strings are just fine:

fun x -> (:sql "select * from table where id = $x")

So the most important criterion of the syntax for quotations is that 
they actually allow to write an arbitrary piece of foreign syntax, and 
the simplest way to achieve that is to avoid putting any constraint on 
the closing delimiter.  That's why I suggest that the opening delimiter 
defines what the closing delimiter is explicitly, without too much 
restriction.

  {!{ ... }!}
  {x{ ... }x}
  {{ ... }}     assuming the content does not use }}


I'm not against quotations per se, but I argue:

  - Against their use such as the one suggested by Honbgo for sedlex 
(including the whole lexer definition, including potentially large OCaml 
expressions, inside a big quotation).

  - Against the idea that the syntactic aspect of quotations has 
anything to do with the notion of extension node to be expanded to AST 
fragments by some code.  They are just independent notions:

     * if the extension node can benefit from the OCaml syntax, this is 
really good (no need to write any parsing code in the "expander", and 
good editor support);

    begin(:sedlex) match lexbuf with
    | ... -> e1
    end

(I've used a syntax which make it clearer what the scope of the 
extension node is, and which dissociates the extension marker e1 from 
its content e2:  begin(:e1) e2 end)

     * quotations can be useful independently from any "expander", 
simply because they provide a different convenient style of writing 
strings which does not require escaping of double quotes and backslashes:

     failwith {{I "like" double quotes.}}

     * both notions can be combined if needed (an extension node whose 
content really has to be written in foreign syntax with a lot of double 
quotes or backslashes)

    begin(:sedlex) begin match lexbuf with
    | {{ '"' }} -> QUOTE
    | {{ '\' }} -> BACKSLASH
    | {{ [a-z]+ }} -> IDENT
    end

    or:

    ((:html) {{ <div class="$x"> }})

    (a lighter syntax with parentheses)

-- Alain

From bobzhang1988@gmail.com  Thu Jan 31 15:58:45 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 31D4F3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 15:58:45 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.49 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f49.google.com ([209.85.212.49]:44680)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U0wbZ-0003Lm-o7 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 31 Jan 2013 16:03:14 +0000
Received: by mail-vb0-f49.google.com with SMTP id s24so1810713vbi.8
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 08:03:12 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:date:x-google-sender-auth:message-id
 :subject:from:to:content-type;
 bh=BaSAmLu7sdNtFki9PWruJzQGFU/gYEf7t6l3aB6DiD0=;
 b=zTO2/yy2V8570EPWTYKzEYKDKKrs6yti8oWtaYu0+ICMAjqP+kA7Eo/0AV84jrNqPQ
 BOcUtw1mOR76XbrPrUSVHSt0hcKn5txY0Erd5ZCgQyJlikwPdjnEY5yh/f3n3nKUCuxN
 1C01sGMHwORuV8vsrORCdJQiAt/Yg4RDLviHsZ+u/rfDhq+T3Xwtb507hgR5KU7XyCRo
 oXHxdDRmSes7PlpFG50cA9p6zkEEmzgqXWx5hRqLKC8FeNJyxWJb3Bg9+gBEBsYYNQV0
 P+hkGVZoh3AhjEa/UrDftRegRr9mECSYmbM+Vb2Dpii0tGbEdWMFCXRGegL0HHQbLU6B
 4s9A==
MIME-Version: 1.0
X-Received: by 10.58.240.107 with SMTP id vz11mr4264614vec.45.1359648192845;
 Thu, 31 Jan 2013 08:03:12 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Thu, 31 Jan 2013 08:03:12 -0800 (PST)
Date: Thu, 31 Jan 2013 11:03:12 -0500
X-Google-Sender-Auth: gi90LwpRFRfQWWLF4HqZbTxxzmo
Message-ID: <CANcqPu7UdH3UBhxyhiRxxi8r+U6RZ7qi4uijn0kuOf2sirXdag@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: wg-camlp4@lists.ocaml.org
Content-Type: multipart/alternative; boundary=047d7bacbff08dd6ec04d497c30f
Subject: [wg-camlp4] Why Quotation is a good idea with decent Editor support
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 15:58:45 -0000

--047d7bacbff08dd6ec04d497c30f
Content-Type: text/plain; charset=ISO-8859-1

Dear all,

   The functionality of Editor lies in two aspects:
   1. Semantic analysis (auto completion, go to definition, etc)
   2. layout, syntax coloring

For the first part, quotation works perfect with editor support, since when
you goto a delimited
language {:lex| .... |} , the IDE gets enough information to do the
auto-completion. Besides, the
code is *readable, semantics is clear,* you know  the exactly scope where
the language lies.
If you use something like sedlex, I really don't know how to read the code.
It gives you an illusion that
it is normal ocaml, but it is not, should there be anything worse than this?

Also, since any exception to normal oaml is clearly delimited, *you can
select the region, see the expanded*
*code on the fly with the ide support.*

For the second part, namespace came to rescue, for example if we want the
lay out rules still follow
the caml syntax, put the language you defined in Fan.Lang.Caml namespace.
If we want the syntax highlighting
like javascript, we can put it in Fan.Lang.Js namespace, like
http://www.emacswiki.org/emacs/MmmMode
This solves the problem once for all, instead just ignore it


-- 
-- Regards, Hongbo

--047d7bacbff08dd6ec04d497c30f
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br clear=3D"all"><div>Dear all,</div><div><br></div><div>=A0 =A0The functi=
onality of Editor lies in two aspects:</div><div>=A0 =A01. Semantic analysi=
s (auto completion, go to definition, etc)</div><div>=A0 =A02. layout, synt=
ax coloring</div>
<div><br></div><div>For the first part, quotation works perfect with editor=
 support, since when you goto a delimited=A0</div><div>language {:lex| ....=
 |} , the IDE gets enough information to do the auto-completion. Besides, t=
he</div>
<div>code is <b>readable, semantics is clear,</b> you know =A0the exactly s=
cope where the language lies.</div><div>If you use something like sedlex, I=
 really don&#39;t know how to read the code. It gives you an illusion that<=
/div>
<div>it is normal ocaml, but it is not, should there be anything worse than=
 this?</div><div><br></div><div>Also, since any exception to normal oaml is=
 clearly delimited, <b>you can select the region, see the expanded</b></div=
>
<div><b>code on the fly with the ide support.</b></div><div><br></div><div>=
For the second part, namespace came to rescue, for example if we want the l=
ay out rules still follow</div><div>the caml syntax, put the language you d=
efined in Fan.Lang.Caml namespace. If we want the syntax highlighting</div>
<div>like javascript, we can put it in Fan.Lang.Js namespace, like <a href=
=3D"http://www.emacswiki.org/emacs/MmmMode">http://www.emacswiki.org/emacs/=
MmmMode</a></div><div>This solves the problem once for all, instead just ig=
nore it=A0</div>
<div><br></div><div><br></div>-- <br>-- Regards, Hongbo

--047d7bacbff08dd6ec04d497c30f--

From lpw25@hermes.cam.ac.uk  Thu Jan 31 16:23:00 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1C30E3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 16:23:00 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:35127)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0wz2-0004Pk-Qn (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 16:27:28 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0wz2-0005of-8h (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 16:27:28 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 31 Jan 2013 16:27:28 +0000
Date: 31 Jan 2013 16:27:28 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
In-Reply-To: <510A8C53.7080903@lexifi.com>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
 <510A8C53.7080903@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 16:23:00 -0000

>  - Against the idea that the syntactic aspect of quotations has 
>anything to do with the notion of extension node to be expanded to AST 
>fragments by some code.  They are just independent notions:

Just because quotations do not need to be part of an extension and 
extensions do not need to use quotations does not change the fact that they 
are frequently used together, so a convenient syntax would be appreciated.

I really don't understand your objection to including all of the following:

* A quotation syntax: {x{ string }x}
* A template syntax: {:lid expr}
* A convenient quotation template syntax: {:lid x| |x}

The quotation template is more lightweight than combining the other two, 
and adds flexibility/clarity for quotations that contain many "}"s. Its 
simply a case of providing a simple syntax for a common use case. Just 
because you don't like that use case doesn't make it not common.

>    begin(:sedlex) match lexbuf with
>    | ... -> e1
>    end

I think that this was better as a template:

{:sedlex 
  match lexbuf with
    | ... -> e1
}

From alain.frisch@lexifi.com  Thu Jan 31 16:43:48 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AAE043C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 16:43:48 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440304 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:17854
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U0xJ6-0005Pg-sd (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 31 Jan 2013 16:48:17 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d61 with ME
 id ugoB1k00R3lHbAL03goBls; Thu, 31 Jan 2013 17:48:12 +0100
Message-ID: <510AA04A.1010906@lexifi.com>
Date: Thu, 31 Jan 2013 17:48:10 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
 <510A8C53.7080903@lexifi.com>
 <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 16:43:48 -0000

On 01/31/2013 05:27 PM, Leo White wrote:
>>  - Against the idea that the syntactic aspect of quotations has
>> anything to do with the notion of extension node to be expanded to AST
>> fragments by some code.  They are just independent notions:
>
> Just because quotations do not need to be part of an extension and
> extensions do not need to use quotations does not change the fact that
> they are frequently used together, so a convenient syntax would be
> appreciated.
>
> I really don't understand your objection to including all of the following:
>
> * A quotation syntax: {x{ string }x}
> * A template syntax: {:lid expr}
> * A convenient quotation template syntax: {:lid x| |x}

Ok, so:
   {:lid x|..|x}
is strictly equivalent to:
   {:lid {x{...}x} }
?

Also also equivalent to:
   {:lid "..."}
as long as the string "..." does not contain any special character?

(i.e. the various forms are not distinguished in the Parsetree.)

I won't fight against this syntactic sugar, but I don't like it because:

   1. It adds even more syntax (to be supported by editors, in 
particular), even with a new character (I find the choice of |
as part of a delimiter cognitively dangerous since it is usually used as 
in separator in OCaml syntax).

   2. It creates confusion by conflating two concepts (and I'm not sure 
they will be so commonly used together), and encourage a style of 
expanders based on concrete syntax which, IMO, should rather be discouraged.

> Just
> because you don't like that use case doesn't make it not common.

It is not common at all: the system does not exist yet.  During the 
migration from camlp4 to ppx, it is not bad that people have to think 
twice before choosing a design which forces to combine "expander + 
quotation".

It seems to me that the cases where concrete foreign syntax might be 
useful (copy/paste of large chunks of code) do not necessarily require a 
very compact syntax, and that for shorter "expanders" with a 
high-density of anti-quotations, avoiding concrete syntax is preferable.

But if there is enough demand and if it can help in the transition, I 
won't fight any more against the combined "expander + quotation" 
approach. (I will just cross my fingers so that the developers of tools 
I'll like to use don't force me to use concrete syntax + anti-quotations 
for no good reason.)

>>    begin(:sedlex) match lexbuf with
>>    | ... -> e1
>>    end
>
> I think that this was better as a template:
>
> {:sedlex  match lexbuf with
>     | ... -> e1
> }

Ok, just a different syntax.


-- Alain

From lpw25@hermes.cam.ac.uk  Thu Jan 31 18:00:27 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 739C53C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 18:00:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:49630)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U0yVM-0003yE-pp (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 18:04:56 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U0yVL-0002HK-WC (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Thu, 31 Jan 2013 18:04:56 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 31 Jan 2013 18:04:55 +0000
Date: 31 Jan 2013 18:04:55 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1301311804550.1375@hermes-1.csi.cam.ac.uk>
In-Reply-To: <510AA04A.1010906@lexifi.com>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
 <510A8C53.7080903@lexifi.com>
 <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
 <510AA04A.1010906@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 18:00:27 -0000

>Ok, so:
>   {:lid x|..|x}
>is strictly equivalent to:
>   {:lid {x{...}x} }
>?
>
>Also also equivalent to:
>   {:lid "..."}
>as long as the string "..." does not contain any special character?
>
>(i.e. the various forms are not distinguished in the Parsetree.)

This comes back to how we feel about syntactic sugar in the Parsetree. 
Personally I like keeping things separate if they look different, but not 
if it involves too much hassle.

> (I find the choice of |
>as part of a delimiter cognitively dangerous since it is usually used as 
>in separator in OCaml syntax).

I would be perfectly happy with "<" + ">" instead of |, or anything else 
which doesn't interfere with the {:lid expr } syntax. As long as its a 
single-character and it is not "{" + "}".

> (I will just cross my fingers so that the developers of tools 
>I'll like to use don't force me to use concrete syntax + anti-quotations 
>for no good reason.)

Considering a parser is probably more effort to write than an AST 
transformer, I don't think you need to worry too much. If it can be done 
sensibly without concrete syntax (i.e it is not a "foreign syntax") it 
probably will be. And of course there is nothing to stop conscientious 
extension authors from providing both styles.


From gabriel.scherer@gmail.com  Thu Jan 31 21:10:04 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 92E3B3C20E
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 21:10:04 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1440304 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.41 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f41.google.com ([209.85.214.41]:62757)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U11Sr-0006HE-S1 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 31 Jan 2013 21:14:34 +0000
Received: by mail-bk0-f41.google.com with SMTP id q16so1550229bkw.14
 for <wg-camlp4@lists.ocaml.org>; Thu, 31 Jan 2013 13:14:33 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:from:date:message-id:subject:to
 :content-type; bh=QYurvZWBU+3OlYGLjnLRtAw7wQoAtsdTM9OgVRaDLcs=;
 b=AVunWssnyG1Nn3VbrSKSegh7pX2eHV4UkdPKuYhDJs9C7hdBNao9fHsOvcrColUFh5
 M/BYHKsZLiFwBxmScKXcdNawvyRUQRSZI+ZwqIm+dXcBSAZkJFkyRr+uKjXOXcKv7DqM
 guYmVd9SmY2TFJHxT5+2zNS7xMPb9p5rLKT3pQ0QiZ7wvvtWL+kvwiEguhJ0XKufsD1A
 nAYKb9bhiIyZFoYJZBuM1EoXrrw/gndzSEfuDfHAQ0wt2jCWMRgn2B25JK0682XtfxAQ
 7F99dQZeQ2fRiCQf/4jR/5bKRKaPPHrSZgulQD8JkNG15FXllI5ZBf4+0C1ZbH0Pt2yB
 J/mA==
X-Received: by 10.204.147.147 with SMTP id l19mr2565929bkv.91.1359666873227;
 Thu, 31 Jan 2013 13:14:33 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.236.134 with HTTP; Thu, 31 Jan 2013 13:13:52 -0800 (PST)
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 31 Jan 2013 22:13:52 +0100
Message-ID: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
Subject: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 31 Jan 2013 21:10:04 -0000

I like Leo's idea of distinguishing three different forms of syntax
extensions (I'm not discussing concrete syntax):

1. structured comments, which as the name indicates do not directly
  influence the semantics of the OCaml source file

  (users that don't have the corresponding extension can still use the
  source file)

  example in Use Cases
  ( https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases
),
  Bisect comments

  match List.map foo [x; a x; b x] with
  | [y1; y2; y3] -> tata
  | _ -> (*BISECT-VISIT*) assert false

  (Of course the concrete syntax does not need to be OCaml comments,
  and in fact it would be nice to parse them as OCaml code rather than
  raw strings; but this does not cover all "annotations", only those
  that can effectively be turned into comments and leave
  a semantically correct file.)


2. shallow embeddings, which is the style of lightweight marking
  (in mostly valid OCaml syntax) of -ppx rewrites that Alain promotes

  (the writer of said extension expects an OCaml syntax tree as input)

  example in Use Cases : "modified sedlex" (modified by me following
  the spirit of the compromises suggested by Alain in the "not valid
  OCaml syntax" discussion)

   (:sedlex
     let:regexp letter = ('a'..'z'|'A'..'Z') in
     match:lexer buf with
     | number -> Printf.printf "Number %s\n" (Sedlexing.Latin1.lexeme
buf); token buf
     | letter, Star ('A'..'Z' | 'a'..'z' | digit) -> Printf.printf
"Ident %s\n" (Sedlexing.Latin1.lexeme buf); token buf
   )

  (or possibly {{$letter([A-Z]|[a-z]|$digit)*}} -> ...)

3. deep embeddings, which uses a camlp4-like mechanism of
   quasiquotations to inject arbitrary syntax, and antiquotations to
   locally return to standard OCaml code with standard semantics
   (sorry Jeremy, I'm using the "quotation" name for this potentially
   improper usage, but I can't find a good matching pair for
   "antiquotations" otherwise)

  (the writer of said extensions expects a string to parse, with
  library support to get OCaml syntax trees out of the antiquotations)

  example in Use Cases: Cass

  let button = <:css<
     .button {
       $Css.gradient ~low:color2 ~high:color1$;
       color: white;
       $Css.top_rounded$;
   >>

(It's not an exhaustive categorization: I'm not discussing arbitrary
extensions of the OCaml grammar such as "let open" here. Nobody on
wg-camlp4 seems to be discussing those anyway.)




I would like to follow up with some questions:


- What is the breadth of structured comments?

  Which use cases can this form cover?  It's clear that it is adapted
  for compiler pragmas (say local warning/error selection, which we
  have wanted for a long time in OCaml) and more generally local
  configuration of analysis tools (mascot, find-bisect, whatever)

  Anil's remark on "tools that perform external code generations" can
  also be understood in this form:
  https://github.com/avsm/ocaml-github/blob/master/lib/github.atd
  could fairly easily be translated in this style.


- What can user assume of the semantics of shallow embeddings?

  I think having a global marker (here a "prefix annotation" in
  Leo's taxonomy) to denote a piece of OCaml syntax with non-standard
  semantics is important. But that does not resolve all
  questions. Will only the topmost "match" construction be
  interepreted as a lexer, or does this reinterpretation applies
  recursively in depth? (In my snippet I marked concerned matches with
  a :lexer annotation).

  I have the impression that some choices may lead to extensions that
  compose as well as the deep quasiquotations, but that some other may
  result in extensions as fragile as unrestricted grammar
  extension.

  Besides, the concrete syntax is important here: a (match:lexer
  ... with ...) annotation is clearly local to this one match
  construct, while I would tend to understand (:sedlex match .. with
  ...) as being a modality over the expression as a whole.


- What are good concrete syntaxes for these forms?

  (So far: Leo's suggestions, Alain snippets, and existing choices in
  existing syntax extension frameworks)

  It's not clear that shallow embeddings and foreign quasiquotations
  should have radically distinct syntaxes. It's important for the
  extension developper to specify the minimum amount of syntactic
  freedom needed, but does the user care which is used?


- Which forms could/should be *eventually* proposed for adoption by
  the compiler's OCaml definition, which are best relegated to a more
  sophisticated external tool like Fan?

From alain.frisch@lexifi.com  Fri Feb  1 07:33:53 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 197733C009
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Feb 2013 07:33:53 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440879 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:37451)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U1BCa-0004sT-mg (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 01 Feb 2013 07:38:24 +0000
Received: from [192.168.0.10] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id F145FA61F1;
 Fri,  1 Feb 2013 08:38:18 +0100 (CET)
Message-ID: <510B70EA.1040102@lexifi.com>
Date: Fri, 01 Feb 2013 08:38:18 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
 <510A8C53.7080903@lexifi.com>
 <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
 <510AA04A.1010906@lexifi.com>
 <Prayer.1.3.5.1301311804550.1375@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1301311804550.1375@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Feb 2013 07:33:53 -0000

On 1/31/2013 7:04 PM, Leo White wrote:
>>   {:lid x|..|x}
> I would be perfectly happy with "<" + ">" instead of |, or anything else
> which doesn't interfere with the {:lid expr } syntax. As long as its a
> single-character and it is not "{" + "}".

In OCaml, delimiters are built from those symbols:  {...}, (...), [...], 
sometimes combined with other characters as in [|...|].  It is probably 
a good idea to keep using one of these kinds of parentheses as outer 
delimiters, both to make it clear in the syntax that they are indeed 
matched delimiters, and also to benefit from basic editor support (for 
matching parentheses), when quotations are not recognized as such.  I 
don't have a concrete proposal for a syntax, though.

Something else: I suggest that the "marker" (lid in your examples) for 
extension node (whether they are combined with quotations or not) could 
rather be a general expression than just an identifier (maybe with a 
lighter syntax for the simple identifier case).  (In the Parsetree, we 
would have "Pexp_extension of expression * expression" instead of 
"Pexp_extension string * expression".)  This is to support passing 
arguments to the "expander".  Of course, those arguments could be 
encoded in the "content", but I believe it makes sense to distinguish 
those two concepts.  In particular, if you use the combined extension + 
quotation form, you probably want parsed arguments even with unparsed 
content:

  {:(html ~strict ~antiquot:'$') |<div class=$x/>|}


> Considering a parser is probably more effort to write than an AST
> transformer, I don't think you need to worry too much.

(Requiring more effort is unfortunately often valued as a good thing!)


Alain

From alain@frisch.fr  Fri Feb  1 07:45:57 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9E3B53C009
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Feb 2013 07:45:57 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440879 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:55387)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U1BOG-0007cl-oZ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Fri, 01 Feb 2013 07:50:29 +0000
Received: from [192.168.0.10] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 2F309A6185;
 Fri,  1 Feb 2013 08:50:23 +0100 (CET)
Message-ID: <510B73C0.5090700@frisch.fr>
Date: Fri, 01 Feb 2013 08:50:24 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
In-Reply-To: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
 shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Feb 2013 07:45:57 -0000

On 1/31/2013 10:13 PM, Gabriel Scherer wrote:
> I like Leo's idea of distinguishing three different forms of syntax
> extensions (I'm not discussing concrete syntax):
>
> 1. structured comments
> 2. shallow embeddings
> 3. deep embeddings

In which category would you put code generators based on type 
declaration (a la type-conv) also fall in this category?  For me, this 
is one of the most important use case of -ppx (the other being 
instrumentation of code, covered by 1 I guess).  Basically, they only 
require the ability to add annotations on type declaration and type 
expressions (and one needs to be able to include OCaml expressions in 
the annotations).  If/when runtime types are added to OCaml, they will 
hopefully also benefit from those annotations.

I guess that 1 is excluded because those annotations are required to 
compile to program and 3 is excluded, because this has nothing to do 
with syntax.  But 2 does not seem to apply either.

-- Alain

From alain@frisch.fr  Fri Feb  1 09:10:48 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 929D13C009
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Feb 2013 09:10:48 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440879 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:52208
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U1CiM-0008Rq-Yt (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Fri, 01 Feb 2013 09:15:20 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d21 with ME
 id uxFG1k00h3lHbAL03xFHgG; Fri, 01 Feb 2013 10:15:18 +0100
Message-ID: <510B87A4.8010502@frisch.fr>
Date: Fri, 01 Feb 2013 10:15:16 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
 <510A8C53.7080903@lexifi.com>
 <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
 <510AA04A.1010906@lexifi.com>
 <Prayer.1.3.5.1301311804550.1375@hermes-1.csi.cam.ac.uk>
 <510B70EA.1040102@lexifi.com>
In-Reply-To: <510B70EA.1040102@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Feb 2013 09:10:48 -0000

On 02/01/2013 08:38 AM, Alain Frisch wrote:
> (In the Parsetree, we
> would have "Pexp_extension of expression * expression" instead of
> "Pexp_extension string * expression".)  This is to support passing
> arguments to the "expander".

After some more thought, I've changed my mind.

Following one of Hongbo's suggestions, let's try to think in terms of 
abstract syntax first to clarify the concepts.

I believe we need two "modalities" for generic placeholders in the AST: 
  annotations and extensions.  An attribute annotate an existing 
fragment of the AST and can technically be ignored simply by dropping 
it.  An extension is something which does not have any built-in meaning 
and has to be expanded during the AST transformation (or maybe during 
type-checking to support OCaml Templates-like processing).  Here is a 
minimalistic way to support this in Parsetree like:

  | Ptyp_annotation of core_type * annotation
  | Ptyp_extension of extension

  | Ppat_annotation of pattern * annotation
  | Ppat_extension of extension

  | Pmod_annotation of module_expr * annotation
  | Pmod_extension of extension

  | Ptype_annotation of type_kind * annotation
  | Ptype_extension of extension

  | Pexp_annotation of expression * annotation
  | Pexp_extension of extension

  | ...


We can choose:

type annotation = expression
and extension = expression

or maybe:

type annotation = string * expression
and extension = string * expression

I think I prefer to use bare expressions, and encode in them the 
"markers", because this does not force to hard-code the nature of 
markers. An argument in favor of keeping an explicit "string" is to 
define more explicitly the "namespace" of the extension, though.


I don't believe we should add a further distinction between the 
annotations which can actually be ignored by the compiler and those on 
which the type-checker must complain.  This can be left to a choice of
syntax which combines an annotation and an extension.

Similarly, I'm not sure we should hard-code/enforce the fact that an AST 
mapper should only be able to expand "under" extensions.  Extensions 
could also be used as markers which can trigger "local enough" 
rewriting. (See examples "Bolt" and "PG'OCaml" below.)


Only to fix the ideas, let's give some examples, assuming the following 
syntax:

   (# e)       ->  extension
   ... (+ e)   ->  annotation (with light postfix syntax)
   (@ e) ...   ->  annotation (with light prefix syntax)

   (@(e) ...)  ->  annotation (explicit scope, prefix syntax)

and maybe a derived "non-ignorable annotation":

   ... (& e)  ===  ... (+ (# e))

and syntactic variants such as:

   let(+e) p = ... === (@ e)(let p = ...)

and also something which combine an extension + quotation:

   (:id x[...]x)   === (# id {x{...}x})



Some examples:

   "Bisect"

         let f x =
           match List.map foo [x; a x; b x] with
           | [y1; y2; y3] -> tata
           | _ -> (@ Bisect.visit) assert false


         (@(Bisect.ignore)
           let unused = ()
         )


   "type-conv"

type t = {
   x : int (+ default 42);
   y : int (+ default 3) (+ sexp_drop_default);
   z : int (+ default 3) (+ sexp_drop_if z_test);
} (+ sexp)


   "map/fold generators"

type variable = string
  and term =
   | Var of variable
   | Lam of variable * term
   | App of term * term


class map = (# (Generate.map : term))


   "lwt"

let(+lwt) x = ...
and y = ...
in
try(+lwt) ...
with Killed -> ...


   "Bolt"

let funct n =
   (#LOG) "funct(%d)" n LEVEL DEBUG;
(*or: (#LOG "funct(%d)" n LEVEL DEBUG); *)
   for i = 1 to n do
     print_endline "..."
   done

   "bitstring"

let bits = Bitstring.bitstring_of_file "/bin/ls" in
match(&bitmatch) bits with
| (# [ 0x7f, 8; "ELF", 24, string; (* ELF magic number *)
        e_ident, 12*8, bitstring;    (* ELF identifier *)
        e_type, 16, littleendian;    (* object file type *)
        e_machine, 16, littleendian  (* architecture *)
   ]) ->
   printf "This is an ELF binary, type %d, arch %d\n"
     e_type e_machine;

(* here I've used (&...) instead of (+...) because the interpretation of 
the pattern really depends on this annotation *)
(*  note: without the 12*8 sub-expression, this would also have been
     a valid pattern and we could have avoided the extra (# ...) used
     here only to allow an expression in place of a pattern.  If we can
     somehow bring expressions and patterns closed in the syntax,
     we could avoid this extra little overhead. *)


   "PG'OCaml"

let fetch_users dbh =
   (#PGSQL dbh) "select id, name from users"
(*
   or: (#PGSQL) dbh "select id, name from users"
   or: (#PGSQL dbh "select id, name from users")
*)


  "Cass"

let button = (:css [
    .button {
      $Css.gradient ~low:color2 ~high:color1$;
      color: white;
      $Css.top_rounded$;
  ])



-- Alain

From info@gerd-stolpmann.de  Fri Feb  1 09:29:43 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 53B4A3C009
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Feb 2013 09:29:43 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440879 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.17.10 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.17.10]:52921)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U1D0g-0007q6-Xs (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Fri, 01 Feb 2013 09:34:15 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-220-076.pools.arcor-ip.net
 [94.219.220.76])
 by mrelayeu.kundenserver.de (node=mreu0) with ESMTP (Nemesis)
 id 0M0MwL-1UqYDB3Dyf-00v3Tq; Fri, 01 Feb 2013 10:34:12 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 06888C00CF;
 Fri,  1 Feb 2013 10:34:11 +0100 (CET)
Date: Fri, 01 Feb 2013 10:34:10 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Alain Frisch <alain.frisch@lexifi.com>
In-Reply-To: <510B70EA.1040102@lexifi.com> (from alain.frisch@lexifi.com on
 Fri Feb  1 08:38:18 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1359711250.10634.21@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:d726Ni0DBDFTbfmq0uDOqS0zGmh98g7TN5usb4Gm2vQ
 UaWLQeqZmAciOFskgv23XP0GGY+xkZqst5tAEy2t+Z/Ro6EXer
 bNz/HwdpPxK2/ftnBAO6wnXeKNNxj6CN7X3VFZrKkXD+GHe6m0
 1oAqp0SmtDW5/e+uB/kQzgMvwzBAv9TcOsGyd/Q9KPR94EWVye
 39UF7bJJlqhLXwmnTYLE9C2puG6pUpL2h5My8CgJ5N4MPrAlYO
 2ASURSmnb3JK9SyXbp2NaFjY3UGv5lQAkwnKRwtHqazvPNMJpq
 5gSjVdW0lRTUij4M0xMMaUUFQWBN59/BixXrfXzQWo3jOiCQF+
 4tmv/om+DlhAJpTrhIY4=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Feb 2013 09:29:43 -0000

Am 01.02.2013 08:38:18 schrieb(en) Alain Frisch:
> Something else: I suggest that the "marker" (lid in your examples) =20
> for extension node (whether they are combined with quotations or not) =20
> could rather be a general expression than just an identifier (maybe =20
> with a lighter syntax for the simple identifier case).  (In the =20
> Parsetree, we would have "Pexp_extension of expression * expression" =20
> instead of "Pexp_extension string * expression".)  This is to support =20
> passing arguments to the "expander".  Of course, those arguments =20
> could be encoded in the "content", but I believe it makes sense to =20
> distinguish those two concepts.  In particular, if you use the =20
> combined extension + quotation form, you probably want parsed =20
> arguments even with unparsed content:
>=20
>  {:(html ~strict ~antiquot:'$') |<div class=3D$x/>|}

I don't think users would like this style in general - you don't want =20
to repeat configuration aspects like ~strict and ~antiquot in every =20
quotation. Normally the same configuration applies to a whole =20
subexpression or even the whole file.

For the few camlp4 parsers I wrote I used special configuration =20
quotations for this purpose, i.e. here

{:html_config ~strict ~antiquot:'$'}

and this would apply "for the rest" whatever this is. But this was rare =20
so far, I can remember there was one such configuration for the =20
character set of generated XML docs.

Gerd



>=20
>=20
>> Considering a parser is probably more effort to write than an AST
>> transformer, I don't think you need to worry too much.
>=20
> (Requiring more effort is unfortunately often valued as a good thing!)
>=20
>=20
> Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20


--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From lpw25@hermes.cam.ac.uk  Fri Feb  1 10:30:41 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7B0333C009
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Feb 2013 10:30:41 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:56960)
 by ppsw-43.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U1Dxg-0002wd-nw (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Fri, 01 Feb 2013 10:35:12 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U1Dxg-0007tm-Ej (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Fri, 01 Feb 2013 10:35:12 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 01 Feb 2013 10:35:12 +0000
Date: 01 Feb 2013 10:35:12 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1302011035120.25380@hermes-1.csi.cam.ac.uk>
In-Reply-To: <510B70EA.1040102@lexifi.com>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
 <510A8C53.7080903@lexifi.com>
 <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
 <510AA04A.1010906@lexifi.com>
 <Prayer.1.3.5.1301311804550.1375@hermes-1.csi.cam.ac.uk>
 <510B70EA.1040102@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Feb 2013 10:30:41 -0000

>
>  {:(html ~strict ~antiquot:'$') |<div class=$x/>|}
>

I think that this is probably too much of a pain to lex. This is perhaps 
the point at which you should switch to the non-abbreviated form:

  {:html ~strict ~antiquot:'$' {{<div class=$x/>}}}

From lpw25@hermes.cam.ac.uk  Fri Feb  1 10:58:24 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 924923C009
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Feb 2013 10:58:24 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:53954)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U1EOV-0005PG-Xz (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Fri, 01 Feb 2013 11:02:55 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U1EOV-0003Ie-Ge (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Fri, 01 Feb 2013 11:02:55 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 01 Feb 2013 11:02:55 +0000
Date: 01 Feb 2013 11:02:55 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
Message-ID: <Prayer.1.3.5.1302011102550.25380@hermes-1.csi.cam.ac.uk>
In-Reply-To: <510B87A4.8010502@frisch.fr>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
 <510A8C53.7080903@lexifi.com>
 <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
 <510AA04A.1010906@lexifi.com>
 <Prayer.1.3.5.1301311804550.1375@hermes-1.csi.cam.ac.uk>
 <510B70EA.1040102@lexifi.com> <510B87A4.8010502@frisch.fr>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Feb 2013 10:58:24 -0000

>We can choose:
>
>type annotation = expression
>and extension = expression
>
>or maybe:
>
>type annotation = string * expression
>and extension = string * expression
>
>I think I prefer to use bare expressions, and encode in them the 
>"markers", because this does not force to hard-code the nature of 
>markers. An argument in favor of keeping an explicit "string" is to 
>define more explicitly the "namespace" of the extension, though.

I think that it is very important to define the "namespace" of extensions. 
I was thinking something like:

type annotation = expression
and extension = longident * expression option

So the extension has the same type as a constructor application. I don't 
think annotations should necessarily be namespaced because they will 
probably be very useful within an extension, in which case they will 
already be namespaced by that extension.


>I don't believe we should add a further distinction between the 
>annotations which can actually be ignored by the compiler and those on 
>which the type-checker must complain.  This can be left to a choice of
>syntax which combines an annotation and an extension.

I agree.

>Similarly, I'm not sure we should hard-code/enforce the fact that an AST 
>mapper should only be able to expand "under" extensions.  Extensions 
>could also be used as markers which can trigger "local enough" 
>rewriting. (See examples "Bolt" and "PG'OCaml" below.)

I agree.

>Only to fix the ideas, let's give some examples, assuming the following 
>syntax:
>
>   (# e)       ->  extension
>   ... (+ e)   ->  annotation (with light postfix syntax)
>   (@ e) ...   ->  annotation (with light prefix syntax)
>
>   (@(e) ...)  ->  annotation (explicit scope, prefix syntax)
>
>and maybe a derived "non-ignorable annotation":
>
>   ... (& e)  ===  ... (+ (# e))
>
>and syntactic variants such as:
>
>   let(+e) p = ... === (@ e)(let p = ...)
>
>and also something which combine an extension + quotation:
>
>   (:id x[...]x)   === (# id {x{...}x})


This certainly seems to be along the right lines. If we really prefer {, ( 
or [ for delimiters then perhaps:

Quotation:  {x{ ... }x} 

Extension:  (:longid expr)

Annotation:  (@ expr)  (and maybe others for prefix etc.)

Then some abbreviated forms for common cases:

Quotation Extension:  
  {:longid x{ ... }x}  ==  (:longid {x{ .. {x})

Let Extension:  
  let:longid foo = ... in ...  
    ==  (:longid let foo = ... in ...)

Match Extension: 
  match:longid expr with ...  
   ==  (:longid match expr with ...)

Type-Conv Annotation: 
  type foo = ... with longid( expr ), longid ... 
   == type foo = ... (@ longid expr) (@ longid) ...

We could provide special-cases in ast_mapper to make these abbreviated 
forms particularly easy to work with.

The downside of this abbreviated syntax for quotation extensions (as 
opposed to {:foo| ... |} )is that it does not provide an alternative 
delimiter to "}". However it probably fits in better.


From alain.frisch@lexifi.com  Fri Feb  1 12:03:33 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D674C3C009
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Feb 2013 12:03:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1440879 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:31974
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U1FPZ-000601-qF (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 01 Feb 2013 12:08:05 +0000
Received: from [192.168.1.105] ([92.151.8.174]) by mwinf5d43 with ME
 id v0811k00B3lHbAL03081Js; Fri, 01 Feb 2013 13:08:04 +0100
Message-ID: <510BB021.8010105@lexifi.com>
Date: Fri, 01 Feb 2013 13:08:01 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
 <510A8C53.7080903@lexifi.com>
 <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
 <510AA04A.1010906@lexifi.com>
 <Prayer.1.3.5.1301311804550.1375@hermes-1.csi.cam.ac.uk>
 <510B70EA.1040102@lexifi.com> <510B87A4.8010502@frisch.fr>
 <Prayer.1.3.5.1302011102550.25380@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1302011102550.25380@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Feb 2013 12:03:33 -0000

On 02/01/2013 12:02 PM, Leo White wrote:
> I think that it is very important to define the "namespace" of
> extensions. I was thinking something like:
>
> type annotation = expression
> and extension = longident * expression option
>
> So the extension has the same type as a constructor application. I don't
> think annotations should necessarily be namespaced because they will
> probably be very useful within an extension, in which case they will
> already be namespaced by that extension.

I can see cases where the notion of "extension" is only used to inject 
syntactic expressions in a different category (module, pattern, type) 
but is also "scoped" by an outer extension which provides the namespace. 
See the "bitstring" example, where we need to put an expression inside a 
pattern, but the interpretation of this is given by the surrounding 
marker on the pattern matching.

Note that even if we choose "type extension = expression", we can 
provide a special namespaced syntax.  E.g.:

  (:lid e)   ====>  (# lid (e))

(i.e. we inject the lid/expression pair into either a function or 
constructor application.)  But the syntactic gain is rather small.

Alternatively, if we choose to make "type extension = longident * 
expression option" as you suggest, we can also support a different syntax:

  (# e)  ====>  (* empty identifier in the Parsetree *)

but this sounds a little bit less natural to me.  I like the 
minimalistic approach of having "extension = expression" in all 
syntactic categories (including expression themselves).  But I will 
certainly not fight the other solution.


-- Alain


>
>
>> I don't believe we should add a further distinction between the
>> annotations which can actually be ignored by the compiler and those on
>> which the type-checker must complain.  This can be left to a choice of
>> syntax which combines an annotation and an extension.
>
> I agree.
>
>> Similarly, I'm not sure we should hard-code/enforce the fact that an
>> AST mapper should only be able to expand "under" extensions.
>> Extensions could also be used as markers which can trigger "local
>> enough" rewriting. (See examples "Bolt" and "PG'OCaml" below.)
>
> I agree.
>
>> Only to fix the ideas, let's give some examples, assuming the
>> following syntax:
>>
>>   (# e)       ->  extension
>>   ... (+ e)   ->  annotation (with light postfix syntax)
>>   (@ e) ...   ->  annotation (with light prefix syntax)
>>
>>   (@(e) ...)  ->  annotation (explicit scope, prefix syntax)
>>
>> and maybe a derived "non-ignorable annotation":
>>
>>   ... (& e)  ===  ... (+ (# e))
>>
>> and syntactic variants such as:
>>
>>   let(+e) p = ... === (@ e)(let p = ...)
>>
>> and also something which combine an extension + quotation:
>>
>>   (:id x[...]x)   === (# id {x{...}x})
>
>
> This certainly seems to be along the right lines. If we really prefer {,
> ( or [ for delimiters then perhaps:
>
> Quotation:  {x{ ... }x}
> Extension:  (:longid expr)
>
> Annotation:  (@ expr)  (and maybe others for prefix etc.)
>
> Then some abbreviated forms for common cases:
>
> Quotation Extension:  {:longid x{ ... }x}  ==  (:longid {x{ .. {x})
>
> Let Extension:  let:longid foo = ... in ...    ==  (:longid let foo =
> ... in ...)
>
> Match Extension:  match:longid expr with ...   ==  (:longid match expr
> with ...)
>
> Type-Conv Annotation:  type foo = ... with longid( expr ), longid ...
> == type foo = ... (@ longid expr) (@ longid) ...
>
> We could provide special-cases in ast_mapper to make these abbreviated
> forms particularly easy to work with.
>
> The downside of this abbreviated syntax for quotation extensions (as
> opposed to {:foo| ... |} )is that it does not provide an alternative
> delimiter to "}". However it probably fits in better.
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4


From lpw25@hermes.cam.ac.uk  Fri Feb  1 13:50:40 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 803243C009
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Feb 2013 13:50:40 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:57575)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U1H5E-0003Yx-QM (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Fri, 01 Feb 2013 13:55:12 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U1H5E-0001LT-5B (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Fri, 01 Feb 2013 13:55:12 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 01 Feb 2013 13:55:12 +0000
Date: 01 Feb 2013 13:55:12 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1302011355120.2236@hermes-1.csi.cam.ac.uk>
In-Reply-To: <510BB021.8010105@lexifi.com>
References: <CAPFanBE-uKv-V+0W1hf9iJS6fGQzjU-LFO3uaLGY50wzpEbAdQ@mail.gmail.com>
 <510A6D89.9000507@lexifi.com>
 <FB5C1A21-6ACB-45D1-83D6-7D685A612332@recoil.org>
 <CANcqPu6te1UCB_MRAR8yebenoZhOozKgHMJwRra-Pkem5wKBnw@mail.gmail.com>
 <510A74AC.4070302@lexifi.com>
 <CANcqPu5pBTwP59qTQzfYVVO_nUXatCh3FNxifyyPQB369U8EaQ@mail.gmail.com>
 <510A8C53.7080903@lexifi.com>
 <Prayer.1.3.5.1301311627280.13866@hermes-1.csi.cam.ac.uk>
 <510AA04A.1010906@lexifi.com>
 <Prayer.1.3.5.1301311804550.1375@hermes-1.csi.cam.ac.uk>
 <510B70EA.1040102@lexifi.com> <510B87A4.8010502@frisch.fr>
 <Prayer.1.3.5.1302011102550.25380@hermes-1.csi.cam.ac.uk>
 <510BB021.8010105@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org, Martin Jambon <martin@mjambon.com>
Subject: Re: [wg-camlp4] On domain-specific foreign syntaxes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Feb 2013 13:50:40 -0000

>Alternatively, if we choose to make "type extension = longident * 
>expression option" as you suggest, we can also support a different syntax:
>
>  (# e)  ====>  (* empty identifier in the Parsetree *)
>
>but this sounds a little bit less natural to me.  I like the 
>minimalistic approach of having "extension = expression" in all 
>syntactic categories (including expression themselves).  But I will 
>certainly not fight the other solution.

If you don't particularly mind, I would prefer this way as I think that it 
will encourage people to name their extensions.


From gabriel.scherer@gmail.com  Fri Feb  1 15:35:08 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 13C043C009
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Feb 2013 15:35:08 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1440879 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.51 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f51.google.com ([209.85.214.51]:43238)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U1IiJ-0003U2-oa (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 01 Feb 2013 15:39:40 +0000
Received: by mail-bk0-f51.google.com with SMTP id ik5so1922090bkc.10
 for <wg-camlp4@lists.ocaml.org>; Fri, 01 Feb 2013 07:39:39 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=3hsUxgH0Hc7BQgEYxwHWCXI8XbHFJKxjjtqtUzB5zcg=;
 b=Kc20gKIzXeauFZcvqtrxKueXiUFGUZ6PwDDvF8r422m9Vwx+Q6vQOCKWbBLGt9X50A
 8+YeySLQT6eDLJTm6CDjtV5d8EX4kuQ+PhxiuZ2t6xwKLIA8gZQJa94dN+KdKp82e6dp
 ZOgNWbcy+aF1RmCV00f+7nau0lS70epAlrjqM8CMEpMm4w4PmcMBezoSbk6ujL3PCl84
 dyIr+BnvniZddUIzk784oNviaB1kOJy9YpnupTIuVnls2GJKBL7lQeVhaUfC8OWRsAWW
 BDQghbnksRmKFgBM6JbOmT9phjf2r6jD2BhGWAcVvxDovFOAuNKOvzNukavK9k4VwFgW
 E+7g==
X-Received: by 10.204.11.87 with SMTP id s23mr3515188bks.113.1359733179177;
 Fri, 01 Feb 2013 07:39:39 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.236.134 with HTTP; Fri, 1 Feb 2013 07:38:59 -0800 (PST)
In-Reply-To: <510B73C0.5090700@frisch.fr>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 1 Feb 2013 16:38:59 +0100
Message-ID: <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
To: Alain Frisch <alain@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Feb 2013 15:35:08 -0000

> In which category would you put code generators based on type declaration (a
> la type-conv) also fall in this category?

I think it depends on the "phase" in which the code generation results
are needed.

You could shoehorn type-conv into structured comments by saying that
the type definitions present in foo.ml, annotated with structured
comments, result in the production of a derived foo_with.ml file
(containing the generated stuff) -- that could later be used in your
project along with foo.ml

(Note: this seems somehow related to a change Hongbo made to the
Camlp4 map/fold/filter generators in Fan, that I'm not sure I
completely understand or like, and was discussed in
http://old.nabble.com/Some-utilities-about-camlp4-td33360537.html )

However, this mode of use puts constraints on the use of the
extension: you cannot in a same file have a type-conv-using
declaration, and refer to the (morally, not yet produced) result of
the boilerplate generation. I believe most people would rather see
type-conv in the second category of "shallow embeddings", under a
syntax in the spirit of

  (@deriving Eq Hash Print)
  type foo =
    ...
  ;;

I would have liked to choose a postfix syntax, but there is in general
no end delimiter to attach to unambiguously: in (type foo = Bar of baz
(+ blah)), the annotation may attach either to the constructor
argument type expression, or to the whole phrase. The real syntax
extension in fact adds an additional optional terminal, "with". The
only "end-closed" type declarations are record declarations, and this
is only because record types are not first-class type expressions.

Thanks you for your detailed syntax examples in the other topic. I
have taken the liberty to put them on the wiki:
  https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases-using-light-annotations

Regarding concrete syntax, I would be tempted to suggest that (prefix
or postfix) annotations be attached to non-terminals (including
parenthesis). I believe there is an important difference between
"modulating this AST node" and "modulating the whole enclosed
expression" that would relevant for reasoning on the locality and
composability of syntactic extensions. I'm not sure yet what's the
best way to go (I'll try to see what Leo and you suggest).

Finally, I think -ppx + arbitrary annotations, without any further
restriction, is too free-form for robust syntax extensions: one
important problem with Camlp4 is that it allowed syntax extension
writers to modify the syntax in very bad way that hurt robustness. As
already discussed, I have a strong distaste for extensions that only
piggyback on existing syntax (without adding any explicit marker); I
would feel safer if the extension *mechanism* disallowed such
unstructured extensions, or at least made them less rewarding to write
than the composable ones. (For example by only passing to the
extension writer the part(s) of the AST that have been annotated).
Unfortunately, I don't see how Bisect would fit any such restriction.
Maybe that's a problem best solved by socialization (writing a
documentation on good practices, and yelling on people), but I sort of
doubt it -- I don't know how many time I've had to argue for *not*
globally changing the associativity of infix operators through Camlp4
in Batteries.

On Fri, Feb 1, 2013 at 8:50 AM, Alain Frisch <alain@frisch.fr> wrote:
> On 1/31/2013 10:13 PM, Gabriel Scherer wrote:
>>
>> I like Leo's idea of distinguishing three different forms of syntax
>> extensions (I'm not discussing concrete syntax):
>>
>> 1. structured comments
>> 2. shallow embeddings
>> 3. deep embeddings
>
>
> In which category would you put code generators based on type declaration (a
> la type-conv) also fall in this category?  For me, this is one of the most
> important use case of -ppx (the other being instrumentation of code, covered
> by 1 I guess).  Basically, they only require the ability to add annotations
> on type declaration and type expressions (and one needs to be able to
> include OCaml expressions in the annotations).  If/when runtime types are
> added to OCaml, they will hopefully also benefit from those annotations.
>
> I guess that 1 is excluded because those annotations are required to compile
> to program and 3 is excluded, because this has nothing to do with syntax.
> But 2 does not seem to apply either.
>
> -- Alain

From yallop@gmail.com  Sat Feb  2 16:12:39 2013
Return-Path: <yallop@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7086A3C20F
 for <wg-camlp4@lists.ocaml.org>; Sat,  2 Feb 2013 16:12:39 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1441344 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.179 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (yallop[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f179.google.com ([74.125.82.179]:55548)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U1fmE-0003kO-ow (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yallop@gmail.com>); Sat, 02 Feb 2013 16:17:15 +0000
Received: by mail-we0-f179.google.com with SMTP id x43so3825527wey.10
 for <wg-camlp4@lists.ocaml.org>; Sat, 02 Feb 2013 08:17:14 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=ILrDpUiBBId1lyLar1zKsLN8Rmh1Mn4ETD3yiXDs7iE=;
 b=eUJCh/bvvTC/lPnMZcf/IrD5jhcKtKXXZZkeqk02iuoNcipHIIxadPWQMQpQli7dQ3
 3s0nrKgRTbKhSPU778bD9/VwAm5Mgtf54ZXs1+QIIi4nU6BLGT0z9RG4xTp/Iqj8BjIA
 TlUNPzl0Ixc50gU1TUiyAdCbe2YOH6WyRsIjY2RsMqm6SjV7VVMMLrt8jCgBKM/NpuC6
 Rj4nv/XNAxeKAiQRyjSuxsrVXrXBc48WBk+HlNR/9dtmEbY0U3QL6YgJFrgDWgzZhMxa
 O2Zyb3CYk8TZN+S/wwgAnSpAR3YuvbSwm8Mk8+J6GvvbGZoV1cbxG/YaDU/9QO3SsFOZ
 tA1Q==
MIME-Version: 1.0
X-Received: by 10.180.97.102 with SMTP id dz6mr3064668wib.3.1359821834391;
 Sat, 02 Feb 2013 08:17:14 -0800 (PST)
Received: by 10.217.39.129 with HTTP; Sat, 2 Feb 2013 08:17:14 -0800 (PST)
In-Reply-To: <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
Date: Sat, 2 Feb 2013 16:17:14 +0000
Message-ID: <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
From: Jeremy Yallop <yallop@gmail.com>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: text/plain; charset=UTF-8
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 02 Feb 2013 16:12:39 -0000

On 1 February 2013 15:38, Gabriel Scherer <gabriel.scherer@gmail.com> wrote:
> Finally, I think -ppx + arbitrary annotations, without any further
> restriction, is too free-form for robust syntax extensions: one
> important problem with Camlp4 is that it allowed syntax extension
> writers to modify the syntax in very bad way that hurt robustness. As
> already discussed, I have a strong distaste for extensions that only
> piggyback on existing syntax (without adding any explicit marker); I
> would feel safer if the extension *mechanism* disallowed such
> unstructured extensions, or at least made them less rewarding to write
> than the composable ones. (For example by only passing to the
> extension writer the part(s) of the AST that have been annotated).
> Unfortunately, I don't see how Bisect would fit any such restriction.
> Maybe that's a problem best solved by socialization (writing a
> documentation on good practices, and yelling on people), but I sort of
> doubt it -- I don't know how many time I've had to argue for *not*
> globally changing the associativity of infix operators through Camlp4
> in Batteries.

I agree with Gabriel.  Actually, I think that a small tweak to the
design of -ppx could address both this and a number of problems that
others have raised during the discussion here.

The -ppx approach applies one or more global transformations to the
ASTs of OCaml source files; these transformations can be parameterized
by attributes attached at particular points in the syntax tree.  This
is a significant improvement over the Camlp4 approach, largely because
it exchanges the (unnecessary) ability to change the concrete syntax
for a number of valuable guarantees, which make extensions easier to
write and code that uses extensions easier to understand.

We can go further in this direction, and give up more (unnecessary)
power in return for further guarantees.  As Gabriel says, since -ppx
extensions can arbitrarily transform the AST, it's not possible to
understand any part of a program that uses extensions without
understanding every aspect of the behaviour of every extension.  We
could, of course, seek to solve this by convention and social
pressure, but there seems to be an emerging consensus that this isn't
really satisfactory.  One of the nice things about functional
programming is that you have strong guarantees (via parametricity,
immutability, and so on) about the effects of calling a particular
function. We should strive to make it possible to reason in the same
manner about the effects of syntax extensions.

There are other legitimate concerns with the current proposal.  As
Xavier Clerc and others point out, attributes are apparently
undeclared (i.e. global) and untyped.  Alain rightly notes that it
seems to be difficult to introduce declarations and types for
attributes without significant complexity.  Still, as OCaml
programmers we're used to the benefits of precisely-scoped names and
strongly-typed data, and it seems a shame to give these benefits up if
we can find a way to keep them.

Hongbo Zhang raises a further concern: when syntax extensions are
global transformations on the whole file, the order in which
extensions are applied becomes significant.  This is a fairly serious
matter, I think: the semantics of code that uses syntax extensions is
now dependent on external factors, since we need to look for the flags
passed to OCaml in the build configuration in order to understand the
source.

I think we can address all these concerns with a small adjustment in
perspective.  Instead of globally-scoped, untyped attributes processed
by file-level externally-specified transformations, we might add a
single node to the OCaml grammar for statically-executed AST
rewriters.  Using the same syntax already proposed for attributes, we
might write, for example:

   (@deriving ["sexp"; "json"])
   type t = F of int | G of s
    and s = H of (t * t)

or

    (@perform)
       (x <-- m;
        y <-- n;
        return (x y))

In order for this to be valid code, 'deriving' and 'perform' should
resolve to functions of appropriate types:

    val deriving : string list -> Parsetree.structure_item ->
Parsetree.structure_item

    val perform : Parsetree.expression -> Parsetree.expression

Either during parsing or in a post parsing phase, the ASTs following
'@deriving ["sexp"; "json"]' and '@perform' are passed to those
functions and the results are inserted in place into the AST.
Gabriel's concern is addressed, because there's no way for @perform
(say) to access other parts of the AST: its effects are purely local.
Xavier's concern is addressed, since AST rewriters, unlike attributes
are declared and typed (and hence scoped). Hongbo's concern is
addressed, since composition is explicit:

    (@deriving ["sexp"])
    (@nonrec)
    type t = C of t

(Here '@deriving ["sexp"]' is applied to the result of applying '@nonrec'.)

It should be possible to write almost all extensions in this manner.
A variant of the stream parser syntax fits easily:

    (@parser)
       ([ `If; x = expr; `Then; y = expr; `Else; z = expr ] => "if";
        [ `Let; `Ident x; `Equal; x = expr; In; y = expr ] => "let")

as does Anil's cstruct extension:

    (@cstruct ~endianness:little)
    type pcap_header = {
       uint32_t magic_number;   (* magic number *)
       uint16_t version_major;  (* major version number *)
       ...
    }

Other extensions such as ifdef, js_of_ocaml, and pgsql could be
handled in the same sort of way.

Jeremy.

[I'm deliberately avoiding the interesting but orthogonal questions of
custom lexical syntax, and benign annotations for tools here.]

From lpw25@hermes.cam.ac.uk  Sat Feb  2 19:20:24 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 48E913C20F
 for <wg-camlp4@lists.ocaml.org>; Sat,  2 Feb 2013 19:20:24 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:44825)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U1ihw-0003zv-RC (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Sat, 02 Feb 2013 19:25:00 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U1ihw-0002H6-Ch (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Sat, 02 Feb 2013 19:25:00 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 02 Feb 2013 19:25:00 +0000
Date: 02 Feb 2013 19:25:00 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Jeremy Yallop <yallop@gmail.com>
Message-ID: <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 02 Feb 2013 19:20:24 -0000

>   (@deriving ["sexp"; "json"])
>   type t = F of int | G of s
>    and s = H of (t * t)
>
>or
>
>    (@perform)
>       (x <-- m;
>        y <-- n;
>        return (x y))
>
>In order for this to be valid code, 'deriving' and 'perform' should
>resolve to functions of appropriate types:
>
>    val deriving : string list -> Parsetree.structure_item ->
>Parsetree.structure_item
>
>    val perform : Parsetree.expression -> Parsetree.expression
>

I have a broader proposal that is along these lines, which is intended to 
be the second part of my earlier blog post. There are in general some 
difficulties with just calling functions during parsing, but I think the 
general idea of declared extensions is the right way to do things.

The reason I haven't mentioned this proposal yet, is that it is a more long 
term proposal. We can easily implement the changes needed to support ppx 
before the next OCaml release. Whereas full support for declared extensions 
will require more time, and probably a lot more debate before it can be 
included.

Since moving an extension from ppx to some kind of declared mechanism would 
require only minimal work, I see no harm in promoting ppx in the 
short/medium term, while also developing a more complete solution.

In particular I think that the extension/template syntaxes ( "(: lid 
expr)", "{: lid { string }}", etc.) that have been discussed so far will be 
a very good match for a declaration based mechanism. It is also another 
argument for forcing extensions to have names.

I will try to put my own proposals in that blog post early next week.

From philippe.veber@gmail.com  Sun Feb  3 09:53:19 2013
Return-Path: <philippe.veber@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D5B933C42D
 for <wg-camlp4@lists.ocaml.org>; Sun,  3 Feb 2013 09:53:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1441715 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.223.180 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (philippe.veber[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ie0-f180.google.com ([209.85.223.180]:63807)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U1wKj-0000LO-n0 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <philippe.veber@gmail.com>); Sun, 03 Feb 2013 09:57:58 +0000
Received: by mail-ie0-f180.google.com with SMTP id bn7so3696381ieb.39
 for <wg-camlp4@lists.ocaml.org>; Sun, 03 Feb 2013 01:57:56 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=YxhsE+4hJxQWwDpUEADxA6gLo3J4fqrAVNxzttthy2U=;
 b=gO7GWgob73KS1nPdGe6OSuV9v62hXAGUIrTstdB2X2/8zN2tcxhOEJIjrtWMfap02r
 hPdnaat+Wi4Tj+6F3w8WfSmbE9O9qKNAz4IP9kIbdX3yOLy64ndP8TpIanW+aVi2azhv
 NutmTj38qU6DAi4z3i8t1HB49dy4omCkXRc//3YR6v+QI07tkVbU8h175Hys0Hyf+nrU
 HLw46ZkWgVRj6ZjVoOOYnj8pGWrng72yDFdZYyQsM/qzB2abcZBet9EBUMGCCGp0bx9j
 JkvRn9oP7ztOfF4Bnqmp/svTkpmiC8Ogqvmw2wErsF4NNtqqxrSiWERFZ28UuRaEXRpB
 Qxcg==
X-Received: by 10.50.91.230 with SMTP id ch6mr2678664igb.92.1359885476382;
 Sun, 03 Feb 2013 01:57:56 -0800 (PST)
MIME-Version: 1.0
Received: by 10.64.136.8 with HTTP; Sun, 3 Feb 2013 01:57:36 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
From: Philippe Veber <philippe.veber@gmail.com>
Date: Sun, 3 Feb 2013 10:57:36 +0100
Message-ID: <CAOOOohQStOb=DkGFzyc99KBVekLUmjSVUiPyJ6bJw+WozyQaZw@mail.gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=e89a8f3ba0a1c147b704d4cf021c
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sun, 03 Feb 2013 09:53:19 -0000

--e89a8f3ba0a1c147b704d4cf021c
Content-Type: text/plain; charset=ISO-8859-1

Hi all,

I find Jeremy's proposal very convincing : it's very clean and seems to fit
with a lot of situations. One of its main strengths is that the functions
called at ppx time are only passed the annotated expression/item (maybe
that was proposed before, but I did not see it). I think this is a major
improvement from the current ppx option, which deals with the whole parsed
tree each time, and makes extension composition a lot more difficult to
grasp. Having extensions mapped to functions (like deriving or perform) is
also a very nice way to prevent conflicting extensions.

So as a potential user, I'd buy it without hesitation, but maybe there is
some limitation I overlooked?

Another great thing I think is that it may also simplify the build process
: writing an extension is as easy as providing a cma to the compiler,
containing Parsedtree rewriter functions, which are called through the @
notation. One just has to be careful giving cma to ocamlc/ocamlopt and cmxa
to ocamlc.opt/ocamlopt.opt.

ph.

2013/2/2 Leo White <lpw25@cam.ac.uk>

>    (@deriving ["sexp"; "json"])
>>   type t = F of int | G of s
>>    and s = H of (t * t)
>>
>> or
>>
>>    (@perform)
>>       (x <-- m;
>>        y <-- n;
>>        return (x y))
>>
>> In order for this to be valid code, 'deriving' and 'perform' should
>> resolve to functions of appropriate types:
>>
>>    val deriving : string list -> Parsetree.structure_item ->
>> Parsetree.structure_item
>>
>>    val perform : Parsetree.expression -> Parsetree.expression
>>
>>
> I have a broader proposal that is along these lines, which is intended to
> be the second part of my earlier blog post. There are in general some
> difficulties with just calling functions during parsing, but I think the
> general idea of declared extensions is the right way to do things.
>
> The reason I haven't mentioned this proposal yet, is that it is a more
> long term proposal. We can easily implement the changes needed to support
> ppx before the next OCaml release. Whereas full support for declared
> extensions will require more time, and probably a lot more debate before it
> can be included.
>
> Since moving an extension from ppx to some kind of declared mechanism
> would require only minimal work, I see no harm in promoting ppx in the
> short/medium term, while also developing a more complete solution.
>
> In particular I think that the extension/template syntaxes ( "(: lid
> expr)", "{: lid { string }}", etc.) that have been discussed so far will be
> a very good match for a declaration based mechanism. It is also another
> argument for forcing extensions to have names.
>
> I will try to put my own proposals in that blog post early next week.
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>

--e89a8f3ba0a1c147b704d4cf021c
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi all,<br><br>I find Jeremy&#39;s proposal very convincing : it&#39;s very=
 clean and seems to fit with a lot of situations. One of its main strengths=
 is that the functions called at ppx time are only passed the annotated exp=
ression/item (maybe that was proposed before, but I did not see it). I thin=
k this is a major improvement from the current ppx option, which deals with=
 the whole parsed tree each time, and makes extension composition a lot mor=
e difficult to grasp. Having extensions mapped to functions (like deriving =
or perform) is also a very nice way to prevent conflicting extensions. <br>

<br>So as a potential user, I&#39;d buy it without hesitation, but maybe th=
ere is some limitation I overlooked?<br><br>Another great thing I think is =
that it may also simplify the build process : writing an extension is as ea=
sy as providing a cma to the compiler, containing Parsedtree rewriter funct=
ions, which are called through the @ notation. One just has to be careful g=
iving cma to ocamlc/ocamlopt and cmxa to ocamlc.opt/ocamlopt.opt.<br>

<br>ph.<br><br><div class=3D"gmail_quote">2013/2/2 Leo White <span dir=3D"l=
tr">&lt;<a href=3D"mailto:lpw25@cam.ac.uk" target=3D"_blank">lpw25@cam.ac.u=
k</a>&gt;</span><br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0=
 .8ex;border-left:1px #ccc solid;padding-left:1ex">

<div class=3D"im"><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .=
8ex;border-left:1px #ccc solid;padding-left:1ex">
=A0 (@deriving [&quot;sexp&quot;; &quot;json&quot;])<br>
=A0 type t =3D F of int | G of s<br>
=A0 =A0and s =3D H of (t * t)<br>
<br>
or<br>
<br>
=A0 =A0(@perform)<br>
=A0 =A0 =A0 (x &lt;-- m;<br>
=A0 =A0 =A0 =A0y &lt;-- n;<br>
=A0 =A0 =A0 =A0return (x y))<br>
<br>
In order for this to be valid code, &#39;deriving&#39; and &#39;perform&#39=
; should<br>
resolve to functions of appropriate types:<br>
<br>
=A0 =A0val deriving : string list -&gt; Parsetree.structure_item -&gt;<br>
Parsetree.structure_item<br>
<br>
=A0 =A0val perform : Parsetree.expression -&gt; Parsetree.expression<br>
<br>
</blockquote>
<br></div>
I have a broader proposal that is along these lines, which is intended to b=
e the second part of my earlier blog post. There are in general some diffic=
ulties with just calling functions during parsing, but I think the general =
idea of declared extensions is the right way to do things.<br>


<br>
The reason I haven&#39;t mentioned this proposal yet, is that it is a more =
long term proposal. We can easily implement the changes needed to support p=
px before the next OCaml release. Whereas full support for declared extensi=
ons will require more time, and probably a lot more debate before it can be=
 included.<br>


<br>
Since moving an extension from ppx to some kind of declared mechanism would=
 require only minimal work, I see no harm in promoting ppx in the short/med=
ium term, while also developing a more complete solution.<br>
<br>
In particular I think that the extension/template syntaxes ( &quot;(: lid e=
xpr)&quot;, &quot;{: lid { string }}&quot;, etc.) that have been discussed =
so far will be a very good match for a declaration based mechanism. It is a=
lso another argument for forcing extensions to have names.<br>


<br>
I will try to put my own proposals in that blog post early next week.<div c=
lass=3D"HOEnZb"><div class=3D"h5"><br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br>

--e89a8f3ba0a1c147b704d4cf021c--

From anil@recoil.org  Mon Feb  4 19:15:59 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1A8A93C02E
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Feb 2013 19:15:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1441874 
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.0 MIME_QP_LONG_LINE RAW: Quoted-printable line longer than 76 chars
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:22618
 helo=dark.recoil.org)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with smtp id 1U2Rar-00063S-WS (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Mon, 04 Feb 2013 19:20:42 +0000
Received: (qmail 30769 invoked by uid 634); 4 Feb 2013 19:20:40 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
 tests=ALL_TRUSTED,HTML_MESSAGE,MIME_QP_LONG_LINE
X-Spam-Check-By: dark.recoil.org
Received: from cpc7-cmbg14-2-0-cust238.5-4.cable.virginmedia.com (HELO
 [192.168.1.53]) (86.30.244.239)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Mon, 04 Feb 2013 19:20:40 +0000
References: <02b901ce0309$c555da10$50018e30$@ffconsultancy.com>
From: Anil Madhavapeddy <anil@recoil.org>
Mime-Version: 1.0 (1.0)
Content-Type: multipart/alternative;
 boundary=Apple-Mail-8AB69938-9768-4B03-B8F2-7F326F69A190
X-Mailer: iPhone Mail (10A551)
Message-Id: <F0B3CD2A-5968-43E0-868B-CB79D2008F0E@recoil.org>
Date: Mon, 4 Feb 2013 19:20:41 +0000
Content-Transfer-Encoding: 7bit
To: wg-camlp4@lists.ocaml.org
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Subject: [wg-camlp4] Fwd: [Caml-list] View patterns
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Feb 2013 19:15:59 -0000


--Apple-Mail-8AB69938-9768-4B03-B8F2-7F326F69A190
Content-Type: text/plain;
	charset=us-ascii
Content-Transfer-Encoding: quoted-printable

Begin forwarded message:

> From: "Jon Harrop" <jon@ffconsultancy.com>
> Date: 4 February 2013 18:59:32 GMT
> To: "Caml List" <caml-list@inria.fr>
> Subject: [Caml-list] View patterns
>=20
>=20
> FWIW, two of the most common camlp4 parsers in the wild, stream parsers an=
d
> bitstring, are solved in F# using view patterns. I suspect many other
> applications of camlp4 would be written in terms of view patterns. Moreove=
r,
> it strikes me that consideration so far on things like F#-like attributes i=
s
> an orthogonal issue so perhaps support for that and support for view
> patterns would do a much better job of displacing camlp4.
>=20
> I use view patterns to write parsers in F# but I would prefer a camlp4-lik=
e
> technology to write parsers in-line.
>=20
> --=20
> Dr Jon Harrop, Flying Frog Consultancy Ltd.
> http://www.ffconsultancy.com
>=20
>=20
> --=20
> Caml-list mailing list.  Subscription management and archives:
> https://sympa.inria.fr/sympa/arc/caml-list
> Beginner's list: http://groups.yahoo.com/group/ocaml_beginners
> Bug reports: http://caml.inria.fr/bin/caml-bugs
>=20

--Apple-Mail-8AB69938-9768-4B03-B8F2-7F326F69A190
Content-Type: text/html;
	charset=utf-8
Content-Transfer-Encoding: quoted-printable

<html><head><meta http-equiv=3D"content-type" content=3D"text/html; charset=3D=
utf-8"></head><body dir=3D"auto"><div>Begin forwarded message:<br><br></div>=
<blockquote type=3D"cite"><div><b>From:</b> "Jon Harrop" &lt;<a href=3D"mail=
to:jon@ffconsultancy.com">jon@ffconsultancy.com</a>&gt;<br><b>Date:</b> 4 Fe=
bruary 2013 18:59:32 GMT<br><b>To:</b> "Caml List" &lt;<a href=3D"mailto:cam=
l-list@inria.fr">caml-list@inria.fr</a>&gt;<br><b>Subject:</b> <b>[Caml-list=
] View patterns</b><br><br></div></blockquote><blockquote type=3D"cite"><div=
><span></span><br><span>FWIW, two of the most common camlp4 parsers in the w=
ild, stream parsers and</span><br><span>bitstring, are solved in F# using vi=
ew patterns. I suspect many other</span><br><span>applications of camlp4 wou=
ld be written in terms of view patterns. Moreover,</span><br><span>it strike=
s me that consideration so far on things like F#-like attributes is</span><b=
r><span>an orthogonal issue so perhaps support for that and support for view=
</span><br><span>patterns would do a much better job of displacing camlp4.</=
span><br><span></span><br><span>I use view patterns to write parsers in F# b=
ut I would prefer a camlp4-like</span><br><span>technology to write parsers i=
n-line.</span><br><span></span><br><span>-- </span><br><span>Dr Jon Harrop, =
Flying Frog Consultancy Ltd.</span><br><span><a href=3D"http://www.ffconsult=
ancy.com">http://www.ffconsultancy.com</a></span><br><span></span><br><span>=
</span><br><span>-- </span><br><span>Caml-list mailing list. &nbsp;Subscript=
ion management and archives:</span><br><span><a href=3D"https://sympa.inria.=
fr/sympa/arc/caml-list">https://sympa.inria.fr/sympa/arc/caml-list</a></span=
><br><span>Beginner's list: <a href=3D"http://groups.yahoo.com/group/ocaml_b=
eginners">http://groups.yahoo.com/group/ocaml_beginners</a></span><br><span>=
Bug reports: <a href=3D"http://caml.inria.fr/bin/caml-bugs">http://caml.inri=
a.fr/bin/caml-bugs</a></span><br><span></span><br></div></blockquote></body>=
</html>=

--Apple-Mail-8AB69938-9768-4B03-B8F2-7F326F69A190--

From alain@frisch.fr  Tue Feb  5 06:48:27 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 565943C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 06:48:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442048 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:55670)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U2cP0-0000CK-mj (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 05 Feb 2013 06:53:11 +0000
Received: from [192.168.0.11] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 9F52BA623B;
 Tue,  5 Feb 2013 07:53:05 +0100 (CET)
Message-ID: <5110AC4F.6010209@frisch.fr>
Date: Tue, 05 Feb 2013 07:53:03 +0100
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
In-Reply-To: <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
 shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 06:48:27 -0000

On 2/1/2013 4:38 PM, Gabriel Scherer wrote:
> Regarding concrete syntax, I would be tempted to suggest that (prefix
> or postfix) annotations be attached to non-terminals (including
> parenthesis). I believe there is an important difference between
> "modulating this AST node" and "modulating the whole enclosed
> expression" that would relevant for reasoning on the locality and
> composability of syntactic extensions. I'm not sure yet what's the
> best way to go (I'll try to see what Leo and you suggest).

I don't see the benefits of allowing annotations on parenthesis (and 
why, not, comments), or individual tokens (the "for" "=" "to" or "do" in 
"for i = 1 to 10 do"), only extra complexity in the definition of the 
Parsetree.

Can you give an example where putting an annotation on e.g. a 
parenthesis would be the right thing to do?


> (For example by only passing to the
> extension writer the part(s) of the AST that have been annotated).
> Unfortunately, I don't see how Bisect would fit any such restriction.
> Maybe that's a problem best solved by socialization (writing a
> documentation on good practices, and yelling on people)

I'm strongly in favor of solving that by socialization, if any problem 
actually occur, rather than restricting technically what an AST rewriter 
can do.  My arguments:

1.  I don't think there will be any problem in practice.  At least this 
discussion should be motivated by some concrete problems to be expected 
in the interaction of common extensions.  For instance, the bad 
interaction between type-conv and deriving as of today would disappear, 
and I don't see how they could be written to introduce other problems 
(and if they do and some people want to use both, this should be easy to 
fix).

2.  Jeremy's proposal more or less requires all rewriters to be in the 
same process.  This requires either Dynlink (which is not available 
under all platforms in native code;  in the past there has been a strong 
resistance to have the compiler and basic tools depend on it) or custom 
static linking (which is not very "build system" friendly).

3.  Some very legitimate uses of ppx don't work nicely with the 
constraint that they can operate only on a marked fragment.  You cite 
Bisect, but this is already the case for Sedlex, which injects some 
shared declarations at the beginning of the unit.  Yes, if two 
"extensions" do that, the order in which they will be applied will 
produce different result, but I cannot imagine a case where this would 
be problematic.  I can see a lot more situations where injecting code 
non-locally makes sense.  Just as an example, consider an extension to 
mark some methods as "memoized":

    object
      ...
      (@memoized) method foo = ....
      ...
    end


   ===>

    object
      ...
      val mutable foo_memo = None
      method foo =
         match foo_memo with
         | Some x -> x
         | None -> let r = ... in foo_memo <- Some r; r
      ...
    end

   Here we need to inject code "just above".  In other cases, one might 
want to inject code "at the beginning" or "at the end"  (of the whole 
unit, of the current structure, etc), or at a completely different place 
(example: macro expansion).


4. Having "registered" expanders called when they are identified by a 
specific marker during a top-down traversal hard-codes a top-down 
rewriting strategy.  There are cases where this is not optimal. 
Consider for instance the interaction between a macro system (or 
conditional compilation) and other extensions.  I can easily imagine 
cases where one really wants macros to be expanded before other 
extensions operate on the AST (e.g. because the result of macro 
expansion generate extension markers / attributes).  Sedlex could for 
instance benefit from a macro system on patterns (in order to replace 
it's hard-coded notion of declared regexps).  One should at least allow 
each expander to apply explicitly the "complete rewriting" on a sub-tree 
and inspect the result (allowing bottom-up rewriting on demand).  But 
then we loose all nice reasoning properties.

5. It is always possible to add a marker at the top of the compilation 
unit and do all the rewriting there, so bad things are still possible.

6. Order in which ppx rewriters are applied matters, but I don't believe 
it is difficult to reason on the resulting composition, nor to devise a 
"good" order for most cases.  At least, the behavior of the composition 
only depends on the behavior of each rewriter (which can be observed 
with the -dsource compiler option).  Users don't have to understand how 
an extension is implemented, but only what it does (in terms of AST 
rewriting), in order to understand how it will compose with other 
extensions.  I'm not sure that reasoning on nested rewriting, especially 
if expanders are allowed to call other expanders on sub-terms and 
post-process the result, will be any simpler.  In practice, I suspect 
that simple priority rules between ppx rewriting would be enough to 
eliminate most problems (e.g. run first all "macro expanders / 
conditional compilation", most of the other extensions would interact 
nicely in whichever order they are applied).

7.  A nice property of "ppx" is that it is not a "system", which reduces 
the risks of over engineering and design mistakes, and simplifies the 
learning curve.  I suggest to keep to extra layers / libraries the role 
of providing higher level APIs with a more restricted semantics but 
stronger invariants.  Nothing prevent people from proposing such systems 
on top of the current -ppx flag and syntactic extensions being 
discussed, but those extensions should not be tightly coupled with these 
systems.



Alain

From alain.frisch@lexifi.com  Tue Feb  5 09:23:45 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 919883C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 09:23:45 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442048 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:57525
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U2epJ-0003FT-R8 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 05 Feb 2013 09:28:30 +0000
Received: from [192.168.1.112] ([92.151.93.123]) by mwinf5d49 with ME
 id wZUU1k00i2fi5KQ03ZUUNi; Tue, 05 Feb 2013 10:28:29 +0100
Message-ID: <5110D0BC.2040102@lexifi.com>
Date: Tue, 05 Feb 2013 10:28:28 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <5110AC4F.6010209@frisch.fr>
In-Reply-To: <5110AC4F.6010209@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
 shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 09:23:45 -0000

On 02/05/2013 07:53 AM, Alain Frisch wrote:
> 3.  Some very legitimate uses of ppx don't work nicely with the
> constraint that they can operate only on a marked fragment.

I've given examples where the expander needs to inject code 
"non-locally", but there are also cases where:

  1) one simply wants the expander to have access to its "context" (the 
rest of the unit);

  2) several occurrences of the "expansion marker" need to share some state.

This does not combine well with the idea that each expansion marker is 
treated "locally"


Alain

From yminsky@janestreet.com  Tue Feb  5 12:38:53 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id CB6D23C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 12:38:53 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1442048 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:34788
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U2hs5-0007wr-rZ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Tue, 05 Feb 2013 12:43:39 +0000
Received: from tot-smtp.delacy.com ([172.27.22.35] helo=tot-is-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1U2hrl-00076S-Eo
 for wg-camlp4@lists.ocaml.org; Tue, 05 Feb 2013 07:43:13 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-is-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1U2hrj-0008Iv-V8
 for wg-camlp4@lists.ocaml.org; Tue, 05 Feb 2013 07:43:11 -0500
Received: from mail-lb0-f197.google.com ([209.85.217.197])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1U2hrj-00034D-QM
 for wg-camlp4@lists.ocaml.org; Tue, 05 Feb 2013 07:43:11 -0500
Received: by mail-lb0-f197.google.com with SMTP id gg6so269488lbb.8
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 04:43:11 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:date:message-id:subject:from:to
 :content-type; bh=sgz+skMMHHvB7CGwgnPQAqtVNq2+ylIdnKzOadY2FA8=;
 b=Fi7VtdfyY1JdIX/Y2mvR2XT89eCIzG0Rb4HZAi3xkw5DAl3rBwifiPGSfs3OLTsHJH
 w3iV8qHKLm6xQkclRvkClWGhpGJgLUaIw4Z+3Wy6LU64IC9buzqbrmrehAxxAPeVfKDb
 dbnjp6MObMkrcyJRZHfqNdEBnAi52Onrns5vk=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:date:message-id:subject:from:to
 :content-type:x-gm-message-state;
 bh=sgz+skMMHHvB7CGwgnPQAqtVNq2+ylIdnKzOadY2FA8=;
 b=Z3D5eh+79apuNAkrFVHoCaYnBypxb0sDFUZfhZTY3sA1voarkXlvTBQdkEnFLFtAbE
 o7XO+tLRfjVUjzdEaQ33wbY4iNiBICOVcVD74VTLBpGDqHA4XXW8rBLH4LWSvUGmqHz4
 1UMlKBaWSWFyfFQSJvDnkqZwVLVm3pOeuLh75k/7yK5cgjS1A5Q5bjv2+054WE4QM8QS
 l9n13a69ncYHBYX8IfOeMrWfQD2RidBsecI/Y0RMUDiLtnRiFqOf8o8RYt29HReuiPGL
 ako3PqPWxicYsOGBxzVeV/xxe0WByLRK+dbwbp8J39DwwnTPfE6NiBus41jubDLc20Lt
 oy4g==
X-Received: by 10.14.2.196 with SMTP id 44mr84833410eef.25.1360068190919;
 Tue, 05 Feb 2013 04:43:10 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.14.2.196 with SMTP id 44mr84833376eef.25.1360068190705; Tue,
 05 Feb 2013 04:43:10 -0800 (PST)
Received: by 10.223.141.66 with HTTP; Tue, 5 Feb 2013 04:43:10 -0800 (PST)
Date: Tue, 5 Feb 2013 07:43:10 -0500
Message-ID: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQlmKl/vcesq8mwDpkSYZ9d9bF9Z9GRCg6XP8EnKu2sbkUGykirTRza5/hdoAJPdqyxgRtR3uxbl/9bXQJqalR9qP3YuY1UpUbI6ImCj+Z49TJjy1EA8rVGo7/TzNHbxVoVuTu9+uMSZ70UtYACJPjxwCZPZ1Q==
Subject: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 12:38:53 -0000

There have been so many detailed and thoughtful emails that it's hard
to keep up with the deluge.  I would humbly submit that this would be
a good time for one of the organizers (Leo or Alain) to put together a
summary of the different positions that have been expressed about how
ppx might work, so that one could read over and think through those.
Right now, I have a hard time keeping the current state of the
conversation in my head, and I'm pretty sure I'm not alone.

y

From daniel.buenzli@erratique.ch  Tue Feb  5 12:50:33 2013
Return-Path: <daniel.buenzli@erratique.ch>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 48E753C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 12:50:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.0 from SpamAssassin-3.3.2-1442048 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [178.197.233.29 listed in rbl-plus.mail-abuse.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail6.webfaction.com ([74.55.86.74]:36081
 helo=smtp.webfaction.com)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U2i3S-0000GX-mf (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <daniel.buenzli@erratique.ch>); Tue, 05 Feb 2013 12:55:18 +0000
Received: from [172.20.10.2] (29-233.197-178.cust.bluewin.ch [178.197.233.29])
 by smtp.webfaction.com (Postfix) with ESMTP id 9ED6F2095B4E;
 Tue,  5 Feb 2013 12:55:16 +0000 (UTC)
Date: Tue, 5 Feb 2013 13:55:12 +0100
From: =?utf-8?Q?Daniel_B=C3=BCnzli?= <daniel.buenzli@erratique.ch>
To: Yaron Minsky <yminsky@janestreet.com>
Message-ID: <A78CB84641DA4DB992B3E8DBBFBA410F@erratique.ch>
In-Reply-To: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
X-Mailer: sparrow 1.6.4 (build 1178)
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 12:50:33 -0000

Le mardi, 5 f=C3=A9vrier 2013 =C3=A0 13:43, Yaron Minsky a =C3=A9crit :
> Right now, I have a hard time keeping the current state of the
> conversation in my head, and I'm pretty sure I'm not alone.

I was also quickly lost. =46or me the message from Jeremy Yallop provided=
 a good summary of the situation (along with a proposal that seems much c=
leaner to me).

Best,

Daniel

From gabriel.scherer@gmail.com  Tue Feb  5 13:01:05 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AEC2F3C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 13:01:05 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1442048 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.43 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f43.google.com ([209.85.214.43]:52058)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U2iDe-0007ck-X1 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Tue, 05 Feb 2013 13:05:50 +0000
Received: by mail-bk0-f43.google.com with SMTP id jm19so58705bkc.16
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 05:05:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=WfNpIz2cGQWA2HVo7ryOjqGvUbzzn20O7tXpfKvtQWY=;
 b=YcK3DafXnvERJohrj1JD2GidpjlQiK+0W56pCFcczsW9DJjrfECypYyduHVPd3qLeH
 zyUvx4u/Bgo3jLtCLcP9VI83l2cQBdInem56jEcSHDO+tvHHLEkHWzXrmTniDvKHkkYj
 pFU+Y1Ao/qyrhDFAPjRtr1UO2GlS49MUhKSuIi7ZxP5d2o4BS2kB6urxN64LtpA4Z0f9
 c5zahSLForR4ZkNUuc/uw5+TInq0PiaFnROxOTVFV81advZwlqKn5pfGbJ8knDsssQuP
 DD/DjfVio8U5ChAqRr7O7ukUnJM0zvvpqpT9U02Fz+qbxwzE/Y48Hm47tT0R9IcyYc5+
 jp3w==
X-Received: by 10.204.4.200 with SMTP id 8mr6635037bks.94.1360069549680; Tue,
 05 Feb 2013 05:05:49 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.236.134 with HTTP; Tue, 5 Feb 2013 05:05:09 -0800 (PST)
In-Reply-To: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Tue, 5 Feb 2013 14:05:09 +0100
Message-ID: <CAPFanBH25hXwDdjnSGTFxmy1OCXdB09GNKnEojfpxmD0b0ByQg@mail.gmail.com>
To: Yaron Minsky <yminsky@janestreet.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 13:01:05 -0000

There have been very good inputs by Alain, Leo, Hongbo and Jeremy.
I've considered doing a summary as you request (after all, I have a
blog to feed), but Leo promises that he has some more ideas that he
would expose "early this week", so I've mostly been waiting for that.

My opinionated one-paragraph (in fact one-list) take-away would be:
- nobody apparently objects to Alain's idea of using lightweight
quotations and annotations to mimic most existing extensions, and him
and Leo have been busy discussing concrete syntax for that (see
Alain's examples here :
https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases-using-light-annotations
)
- there is an ongoing discussion on the robustness of global rewrites
and possible restrictions (Alain promotes the immediately available,
low-tech social approach, Jeremy has a nice technical suggestion, Leo
is going to write something, and a compromise *is* probably possible
along the lines of encapsulating common local use cases as a strongly
suggested library (like type-conv did for type-derived boilerplate))
- Hongbo has been asking for a discussion on the AST definition at the
core of syntax manipulations, but so far nobody had the courage to
look in details into the polymorphic variant solution of Fan
- relatedly, there is no consensus on the neededness and
implementation of antiquotations; so far we're heading towards a
solution where they are not well supported

Hope that helped.

On Tue, Feb 5, 2013 at 1:43 PM, Yaron Minsky <yminsky@janestreet.com> wrote:
> There have been so many detailed and thoughtful emails that it's hard
> to keep up with the deluge.  I would humbly submit that this would be
> a good time for one of the organizers (Leo or Alain) to put together a
> summary of the different positions that have been expressed about how
> ppx might work, so that one could read over and think through those.
> Right now, I have a hard time keeping the current state of the
> conversation in my head, and I'm pretty sure I'm not alone.
>
> y
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From lpw25@hermes.cam.ac.uk  Tue Feb  5 13:46:09 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3B3413C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 13:46:09 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:51150)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U2ivG-0005p0-qU (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 13:50:54 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U2ivG-00019L-7z (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 13:50:54 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 05 Feb 2013 13:50:54 +0000
Date: 05 Feb 2013 13:50:54 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Leo White <lpw25@cam.ac.uk>
Message-ID: <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 13:46:09 -0000

>I will try to put my own proposals in that blog post early next week.

That blog post is now up:

http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html

Please respond to it on this list rather than in its comment box.

From bobzhang1988@gmail.com  Tue Feb  5 14:10:51 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 736103C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 14:10:51 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1442048 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f173.google.com ([209.85.220.173]:47677)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U2jJ9-0004tP-of (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Tue, 05 Feb 2013 14:15:36 +0000
Received: by mail-vc0-f173.google.com with SMTP id fy7so114054vcb.32
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 06:15:35 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=7Whe6+o2MRl3Q7GxbQWrT8bPqDSlHtBooupAvaMlObI=;
 b=W94BH6jqCCveDpfF2YWADPj2h+ar3B1itLi3msm3tVrdprdSLLevgCl3QwZyPCbVgh
 0TBfYBXxxn1QyaSf5ltypFT059H85Zpq/ACsIfzt/MW4qt1D6KcyrkUnhl/cor4B0fSX
 v6QkkQnEKBkY5FxJv5XyjySistsWg/XUA5euxPs+tm8BlGUno80rrwzFSk9Kxw8OHHLb
 EXTxxEkAjmiw5tam+Wl8m6Ru/tTKMXZnE87yRauGfOaQyw7EcCTuqtGvz0Z7OVqBByi+
 qSCiQcfDDhr26S6DabnpJT9YCKUNW/g4e5LLfPb2PTPbJYroR3OoqI8O7zXHDaMvecQP
 HlOw==
MIME-Version: 1.0
X-Received: by 10.52.64.208 with SMTP id q16mr9719504vds.93.1360073734949;
 Tue, 05 Feb 2013 06:15:34 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Tue, 5 Feb 2013 06:15:34 -0800 (PST)
In-Reply-To: <CAPFanBH25hXwDdjnSGTFxmy1OCXdB09GNKnEojfpxmD0b0ByQg@mail.gmail.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <CAPFanBH25hXwDdjnSGTFxmy1OCXdB09GNKnEojfpxmD0b0ByQg@mail.gmail.com>
Date: Tue, 5 Feb 2013 09:15:34 -0500
X-Google-Sender-Auth: 1-TFH5_Vc4OIceyoswCAJGHKH7E
Message-ID: <CANcqPu5GmqPr+Me4a5b=fOMY1JDND3Nhh=EGRb-mauaRpbOwCw@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: multipart/alternative; boundary=bcaec5016125d70b8b04d4fad77a
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 14:10:51 -0000

--bcaec5016125d70b8b04d4fad77a
Content-Type: text/plain; charset=ISO-8859-1

A cursory look at this proposal seems to me that it's beautiful. But I
guess it is not easy to give a robust implementation

On Tue, Feb 5, 2013 at 8:05 AM, Gabriel Scherer
<gabriel.scherer@gmail.com>wrote:

> There have been very good inputs by Alain, Leo, Hongbo and Jeremy.
> I've considered doing a summary as you request (after all, I have a
> blog to feed), but Leo promises that he has some more ideas that he
> would expose "early this week", so I've mostly been waiting for that.
>
> My opinionated one-paragraph (in fact one-list) take-away would be:
> - nobody apparently objects to Alain's idea of using lightweight
> quotations and annotations to mimic most existing extensions, and him
> and Leo have been busy discussing concrete syntax for that (see
> Alain's examples here :
>
> https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases-using-light-annotations
> )
> - there is an ongoing discussion on the robustness of global rewrites
> and possible restrictions (Alain promotes the immediately available,
> low-tech social approach, Jeremy has a nice technical suggestion, Leo
> is going to write something, and a compromise *is* probably possible
> along the lines of encapsulating common local use cases as a strongly
> suggested library (like type-conv did for type-derived boilerplate))
> - Hongbo has been asking for a discussion on the AST definition at the
> core of syntax manipulations, but so far nobody had the courage to
> look in details into the polymorphic variant solution of Fan
> - relatedly, there is no consensus on the neededness and
> implementation of antiquotations; so far we're heading towards a
> solution where they are not well supported
>
> Hope that helped.
>
> On Tue, Feb 5, 2013 at 1:43 PM, Yaron Minsky <yminsky@janestreet.com>
> wrote:
> > There have been so many detailed and thoughtful emails that it's hard
> > to keep up with the deluge.  I would humbly submit that this would be
> > a good time for one of the organizers (Leo or Alain) to put together a
> > summary of the different positions that have been expressed about how
> > ppx might work, so that one could read over and think through those.
> > Right now, I have a hard time keeping the current state of the
> > conversation in my head, and I'm pretty sure I'm not alone.
> >
> > y
> > _______________________________________________
> > wg-camlp4 mailing list
> > wg-camlp4@lists.ocaml.org
> > http://lists.ocaml.org/listinfo/wg-camlp4
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>



-- 
-- Regards, Hongbo

--bcaec5016125d70b8b04d4fad77a
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

A cursory look at this proposal seems to me that it&#39;s beautiful. But I =
guess it is not easy to give a robust implementation<br><br><div class=3D"g=
mail_quote">On Tue, Feb 5, 2013 at 8:05 AM, Gabriel Scherer <span dir=3D"lt=
r">&lt;<a href=3D"mailto:gabriel.scherer@gmail.com" target=3D"_blank">gabri=
el.scherer@gmail.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">There have been very good inputs by Alain, L=
eo, Hongbo and Jeremy.<br>
I&#39;ve considered doing a summary as you request (after all, I have a<br>
blog to feed), but Leo promises that he has some more ideas that he<br>
would expose &quot;early this week&quot;, so I&#39;ve mostly been waiting f=
or that.<br>
<br>
My opinionated one-paragraph (in fact one-list) take-away would be:<br>
- nobody apparently objects to Alain&#39;s idea of using lightweight<br>
quotations and annotations to mimic most existing extensions, and him<br>
and Leo have been busy discussing concrete syntax for that (see<br>
Alain&#39;s examples here :<br>
<a href=3D"https://github.com/gasche/ocaml-syntax-extension-discussion/wiki=
/Use-Cases-using-light-annotations" target=3D"_blank">https://github.com/ga=
sche/ocaml-syntax-extension-discussion/wiki/Use-Cases-using-light-annotatio=
ns</a><br>

)<br>
- there is an ongoing discussion on the robustness of global rewrites<br>
and possible restrictions (Alain promotes the immediately available,<br>
low-tech social approach, Jeremy has a nice technical suggestion, Leo<br>
is going to write something, and a compromise *is* probably possible<br>
along the lines of encapsulating common local use cases as a strongly<br>
suggested library (like type-conv did for type-derived boilerplate))<br>
- Hongbo has been asking for a discussion on the AST definition at the<br>
core of syntax manipulations, but so far nobody had the courage to<br>
look in details into the polymorphic variant solution of Fan<br>
- relatedly, there is no consensus on the neededness and<br>
implementation of antiquotations; so far we&#39;re heading towards a<br>
solution where they are not well supported<br>
<br>
Hope that helped.<br>
<div class=3D"HOEnZb"><div class=3D"h5"><br>
On Tue, Feb 5, 2013 at 1:43 PM, Yaron Minsky &lt;<a href=3D"mailto:yminsky@=
janestreet.com">yminsky@janestreet.com</a>&gt; wrote:<br>
&gt; There have been so many detailed and thoughtful emails that it&#39;s h=
ard<br>
&gt; to keep up with the deluge. =A0I would humbly submit that this would b=
e<br>
&gt; a good time for one of the organizers (Leo or Alain) to put together a=
<br>
&gt; summary of the different positions that have been expressed about how<=
br>
&gt; ppx might work, so that one could read over and think through those.<b=
r>
&gt; Right now, I have a hard time keeping the current state of the<br>
&gt; conversation in my head, and I&#39;m pretty sure I&#39;m not alone.<br=
>
&gt;<br>
&gt; y<br>
&gt; _______________________________________________<br>
&gt; wg-camlp4 mailing list<br>
&gt; <a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org=
</a><br>
&gt; <a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank=
">http://lists.ocaml.org/listinfo/wg-camlp4</a><br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo

--bcaec5016125d70b8b04d4fad77a--

From bobzhang1988@gmail.com  Tue Feb  5 14:14:45 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0B71B3C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 14:14:45 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1442048 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.180 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f180.google.com ([209.85.128.180]:40462)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U2jMv-0002sH-qu (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Tue, 05 Feb 2013 14:19:30 +0000
Received: by mail-ve0-f180.google.com with SMTP id jx10so164010veb.25
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 06:19:28 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=nlbZLbQIZKWjlS890P09fOKV5Rc7xdECzhCjOIHG3MA=;
 b=OV4EL9K1bpBIvkvysjPjQyzHD2QSNgCEDqjne8IIO+amDRSJWpIQ2p+uE3YKxh0KI2
 TYZqhmFD6qA3TbRmTYUu3HxvI3T4N6oteBWbdbIUNCa5Bu5+ywDhBDiYi04VNADgYPoC
 MTHsN/0gGDOlUCn8PAuLHauxFCWbRxGr8u6BmuDlWjS44XhEtgw8mNB4mB+l7KNUjn+F
 dMwi/EKB8tfE1X3rVR4eXm0vyHtn1PRYUrCYzcg9CLEgaB13TQu9t9enN409rOcvz7aU
 magQaWnp1brkWudWnXNmy756PkD76XAEUem7qqxuZNAU3G+YQYcD3McHDSFTIQ/g+8dC
 JhZg==
MIME-Version: 1.0
X-Received: by 10.52.177.161 with SMTP id cr1mr6611220vdc.64.1360073968620;
 Tue, 05 Feb 2013 06:19:28 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Tue, 5 Feb 2013 06:19:28 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
Date: Tue, 5 Feb 2013 09:19:28 -0500
X-Google-Sender-Auth: gkyNZTE55t2OSWYpI-Nzgm4eElw
Message-ID: <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=20cf3071ceacc493bb04d4fae50b
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 14:14:45 -0000

--20cf3071ceacc493bb04d4fae50b
Content-Type: text/plain; charset=ISO-8859-1

We have the same ideas. ;-)
proposals 1, 2, 3, 4 are implemented in Fan as well.

For Proposal 4, we introduced overloaded quotations,
{:Ast.expr| 1 + $x |} can expand to ast with or without locations. Ast with
locations introduce a lot of unnecessary complexity when people are just
doing code generation

Proposal 3 is applied in camlp4 itself(see the quotation module)
On Tue, Feb 5, 2013 at 8:50 AM, Leo White <lpw25@cam.ac.uk> wrote:

> I will try to put my own proposals in that blog post early next week.
>>
>
> That blog post is now up:
>
> http://www.lpw25.net/2013/02/**05/camlp4-alternative-part-2.**html<http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html>
>
> Please respond to it on this list rather than in its comment box.
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>



-- 
-- Regards, Hongbo

--20cf3071ceacc493bb04d4fae50b
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br>We have the same ideas. ;-)<div>proposals 1, 2, 3, 4 are implemented in=
 Fan as well.</div><div><br></div><div>For Proposal 4, we introduced overlo=
aded quotations,</div><div>{:Ast.expr| 1 + $x |} can expand to ast with or =
without locations. Ast with locations introduce a lot of unnecessary comple=
xity when people are just doing code generation</div>
<div><br></div><div>Proposal 3 is applied in camlp4 itself(see the quotatio=
n module)<br><div class=3D"gmail_quote">On Tue, Feb 5, 2013 at 8:50 AM, Leo=
 White <span dir=3D"ltr">&lt;<a href=3D"mailto:lpw25@cam.ac.uk" target=3D"_=
blank">lpw25@cam.ac.uk</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im"><blockquote class=3D"gmail=
_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:=
1ex">
I will try to put my own proposals in that blog post early next week.<br>
</blockquote>
<br></div>
That blog post is now up:<br>
<br>
<a href=3D"http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html" =
target=3D"_blank">http://www.lpw25.net/2013/02/<u></u>05/camlp4-alternative=
-part-2.<u></u>html</a><br>
<br>
Please respond to it on this list rather than in its comment box.<div class=
=3D"HOEnZb"><div class=3D"h5"><br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo
</div>

--20cf3071ceacc493bb04d4fae50b--

From gabriel.scherer@gmail.com  Tue Feb  5 14:47:03 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7A9503C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 14:47:03 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1442048 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.44 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f44.google.com ([209.85.214.44]:50009)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U2jsC-0006la-n7 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Tue, 05 Feb 2013 14:51:49 +0000
Received: by mail-bk0-f44.google.com with SMTP id j4so117860bkw.3
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 06:51:48 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=uBTpLq2ctLUvP5vnZy1W89RottYJ9Uu8lpsShUTR5Qk=;
 b=pLJtsBl2oc+5EWs++iSXKdptmGUlK1Ky03pfLSFwr5Xd9AJq9I5wrNIwbaMH5dN7Mk
 ECSvupfO3drNW7N9ENuM5rKLVYPwINmkyzg4L4V+ARtpSCKDVjUgVZvUJOLNAh/dJN82
 7DOFOJcCxgL65AtrohwBQaw7aOZiKWBsRficDfI7pkuq5vx1NE4nr1NlDGzacDz2Ck9K
 ruMONtRzMLLt4ABu5PeHcpu9XJkcUwQEbmLz6R66cPAHiNTE4l3sUk4tRHyrH21348ne
 WEyT6IE7utcaK5SmEo0PL+xW+BRerwTt1hYS60WuhxD2hxlRhbfqCY0Id7ukSu1CR8HT
 MYMw==
X-Received: by 10.204.145.86 with SMTP id c22mr6841796bkv.5.1360075907614;
 Tue, 05 Feb 2013 06:51:47 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.236.134 with HTTP; Tue, 5 Feb 2013 06:51:07 -0800 (PST)
In-Reply-To: <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Tue, 5 Feb 2013 15:51:07 +0100
Message-ID: <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
To: Hongbo Zhang <hongboz@seas.upenn.edu>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 14:47:03 -0000

I don't really like Leo's proposal.

On the semantic side, I very much like Jeremy's idea, even if it still
has shortcomings pointed out by Alain, and partially addressed by Leo,
such as the need to get contextual information when applying a syntax
extension. I'm interested in seeing if we can go further in that
direction.

On the practical side, adding a notion of staged compilation and
namespaces to handle syntax extensions seems really overkill. I
believe I was in the same room as Alain and Leo when namespaces where
last discussed, and my personal impression was really not that they
were "likely to be included in the language in the near future" (I
would actually be surprised to see them before a monadic notation!);
there is little agreement on that.

Alain's ppx mechanism has the property of doing away with the idea
that syntax extensions have to be linked together, and I believe he is
right in pointing that out as a practical advantage. Even the previous
camlp4 mechanism had a stronger separation between syntax-time and
compile-time than in Leo's proposal, as the linking happened against
an *external* executable (which allowed other fairly independent
preprocessors to reuse the -pp option without being camlp4-related).
My gut feeling is that less coupling, rather than more, is the right
way to go -- which is not contradictory with an approach favoring
locality such as Jeremy and Leo's proposal of representing macros as
functions. I'm ready to discuss the advantages of such integration,
but I find it unlikely that their are worth tying syntax extensions to
such semantic behemoths as staged compilation and namespaces.

A reasonable compromise I would see between the point of view of Alain
and Jeremy/Leo is to have an "unsafe" interface for global
preprocessing, which we would discourage people from using by being
very good at breaking backward compatibility (we can do better than
Camlp4!), and *maintaining* at the same time one or several safer
entry point that provide the local structure and conventional syntax
that we think will bring more robustness to syntax extensions (like
type-conv can currently be seen as a protective hub around type-driven
boilerplate generation). I would have several questions:
- can Fan make use of the same unsafe interface as everyone else? I've
been impressed by some of the work done by Hongbo so far
(reimplementing the parsing stack on top of dypgen is no small feat),
and I wouldn't want this brand of work to be alienated from the
"practical" syntax extensibility people.
- what safe interface could we provide (I imagine something based on
Jeremy's proposal (plus good concrete syntax choices) with a notion of
context as in Leo's proposal; Leo, I'm a bit unclear on what kind of
GADT you're thinking of, could you elaborate? If it's as good a use of
GADTs as Alain's runtime type representations, I'm all ears.
- how should extensions built upon the safe interface be composed?
Must we link extension functions together, or use program/process
boundaries as in the wider -ppx framework? What are the
advantage/costs of either choices?
- Leo suggests using an in-language feature (namespaces) to handle
addressing of syntax extensions; what is the picture of
outside-language tools to do this? I've had reasonable luck using
'ocamlfind' as a backbone for plugin discovery in Stog. Is this what
Alain imagine users will use? Is it portable to Windows-land?

On Tue, Feb 5, 2013 at 3:19 PM, Hongbo Zhang <hongboz@seas.upenn.edu> wrote:
>
> We have the same ideas. ;-)
> proposals 1, 2, 3, 4 are implemented in Fan as well.
>
> For Proposal 4, we introduced overloaded quotations,
> {:Ast.expr| 1 + $x |} can expand to ast with or without locations. Ast with
> locations introduce a lot of unnecessary complexity when people are just
> doing code generation
>
> Proposal 3 is applied in camlp4 itself(see the quotation module)
>
> On Tue, Feb 5, 2013 at 8:50 AM, Leo White <lpw25@cam.ac.uk> wrote:
>>>
>>> I will try to put my own proposals in that blog post early next week.
>>
>>
>> That blog post is now up:
>>
>> http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html
>>
>> Please respond to it on this list rather than in its comment box.
>>
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>
>
>
>
> --
> -- Regards, Hongbo
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>

From mark@three-tuns.net  Tue Feb  5 15:01:19 2013
Return-Path: <mark@three-tuns.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8BCC03C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 15:01:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.0 from SpamAssassin-3.3.2-1442048 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mash.three-tuns.net ([93.93.131.93]:41051)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U2k60-0000CU-QA (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <mark@three-tuns.net>); Tue, 05 Feb 2013 15:06:05 +0000
Received: from mark by mash.three-tuns.net with local (Exim 4.69)
 (envelope-from <mark@three-tuns.net>)
 id 1U2k5z-0002yb-5Y; Tue, 05 Feb 2013 15:06:03 +0000
Date: Tue, 5 Feb 2013 15:06:03 +0000
From: Mark Shinwell <mark@three-tuns.net>
To: Yaron Minsky <yminsky@janestreet.com>
Message-ID: <20130205150603.GV13082@three-tuns.net>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
User-Agent: Mutt/1.5.18 (2008-05-17)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 15:01:19 -0000

On Tue, Feb 05, 2013 at 07:43:10AM -0500, Yaron Minsky wrote:
> There have been so many detailed and thoughtful emails that it's hard
> to keep up with the deluge.  I would humbly submit that this would be
> a good time for one of the organizers (Leo or Alain) to put together a
> summary of the different positions that have been expressed about how
> ppx might work, so that one could read over and think through those.
> Right now, I have a hard time keeping the current state of the
> conversation in my head, and I'm pretty sure I'm not alone.

You are not alone.  I also think a summary would be very useful.

Mark

From sebastien.mondet@gmail.com  Tue Feb  5 15:24:48 2013
Return-Path: <sebastien.mondet@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 216113C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 15:24:48 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1442048 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.178 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (sebastien.mondet[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f178.google.com ([209.85.212.178]:53924)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U2kSi-0004Za-Q6 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <sebastien.mondet@gmail.com>); Tue, 05 Feb 2013 15:29:33 +0000
Received: by mail-wi0-f178.google.com with SMTP id o1so350955wic.11
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 07:29:31 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:from:date:message-id:subject:to
 :content-type; bh=Lb3nFTE6noHQvEOcG/5Lf8HNNHNyjlqsJlJSndWfsfY=;
 b=BuijNN/rcT5iQNgVr2mL7Kb72BgaVFFTXVI4YwSdKI+US9T2hSgtS12Atb6ll0Rimq
 zHg0fnhhb+iIlW8IpFhAmc08u3MM9NPuArm9nmEb2/WyOSU9E/+pUiE1P/7NZtSAh06b
 Lg6IElm1QlPyuOEqgsKCDPzeHJQOyLeAtD//fpXMaYAt8gVtz6MjqyIMBl+KJYUhnsKF
 L/1gKgOMnQ7/3BJ/OIPPdDkJHxzAddW8E+pB/jbEkRX3DJ6k8C3jKWF2Ogh7n5IJdZks
 IX+cjm1f9tSRZ6C6R2RMsQnhIaTspEorwZkcgzs5PXpnizxYnKQZTVpdRhnpFPd/SgHw
 VyOw==
X-Received: by 10.180.81.39 with SMTP id w7mr18191818wix.15.1360078171890;
 Tue, 05 Feb 2013 07:29:31 -0800 (PST)
MIME-Version: 1.0
Received: by 10.194.221.228 with HTTP; Tue, 5 Feb 2013 07:29:11 -0800 (PST)
From: Sebastien Mondet <sebastien.mondet@gmail.com>
Date: Tue, 5 Feb 2013 10:29:11 -0500
Message-ID: <CALScVY=R-hVdJ91WX4irx5ZTB+QLhBnMV9m=qhHjh6aQ-Te8Fw@mail.gmail.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: multipart/alternative; boundary=bcaec55550344d63ce04d4fbe09f
Subject: [wg-camlp4] Runtime types and no -pp(x)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 15:24:48 -0000

--bcaec55550344d63ce04d4fbe09f
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Hi

Yet Another Proposal =E2=84=A2  :)

Here, at NYU-Bio we use camlp4 in two ways:

1. All the code is JaneSt-Core-styled and uses sexplib.syntax and
bin_prot.syntax

We also use an ('a, 'b) Result.t Lwt.t  monad everywhere but there is no
need for camlp4, monadic programming is perfectly fine with normal OCaml
syntax.

2. The web-app is fully Eliom-based: it uses the eliom{dep,c,opt}
tool-chain, so it is incompatible with sexplib.syntax (because it imposes
deriving) and takes ages to compile.
(if I had to start again the project, I think I would not use the syntax
part of ocsigen or at least limit it to one single file).


I think I have already lost too many hours of my life fixing camlp4-related
problems just for using type_conv, so:


The proposal:

Get something like dyntype [1] or what Pierre Chambart and Gr=C3=A9goire He=
nry
presented at OUD [2], into the main compiler.

type_conv and deriving will become obsolete.

Then, most people can get rid of any kind of syntactic preprocessing for
95% of their problems.

For the remaining 5%, they can use camlp4, camlp5, Fan, or write their own
code generator without imposing it to anyone else.



Cheers
Seb



[1] https://github.com/mirage/dyntype
[2] http://oud.ocaml.org/2012/#program

--bcaec55550344d63ce04d4fbe09f
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div><div><div><div><div><div><div><div><div><br></div>Hi<=
br><br></div>Yet Another Proposal =E2=84=A2=C2=A0 :)<br><br></div>Here, at =
NYU-Bio we use camlp4 in two ways:<br><br></div>1. All the code is JaneSt-C=
ore-styled and uses sexplib.syntax and=C2=A0 bin_prot.syntax<br>

</div><br>We also use an (&#39;a, &#39;b) Result.t Lwt.t=C2=A0 monad everyw=
here but there is no need for camlp4, monadic programming is perfectly fine=
 with normal OCaml syntax.<br><br></div>2. The web-app is fully Eliom-based=
: it uses the eliom{dep,c,opt} tool-chain, so it is incompatible with sexpl=
ib.syntax (because it imposes deriving) and takes ages to compile.<br>

</div>(if I had to start again the project, I think I would not use the syn=
tax part of ocsigen or at least limit it to one single file).<br><br><br></=
div><div>I think I have already lost too many hours of my life fixing camlp=
4-related problems just for using type_conv, so:<br>

<br></div><div><br></div>The proposal:<br><br></div>Get something like dynt=
ype [1] or what Pierre Chambart and Gr=C3=A9goire Henry presented at OUD [2=
], into the main compiler. <br><br>type_conv and deriving will become obsol=
ete.<br>

<div><div><br></div><div>Then, most people can get rid of any kind of synta=
ctic preprocessing for 95% of their problems.<br><br></div><div>For the rem=
aining 5%, they can use camlp4, camlp5, Fan, or write their own code genera=
tor without imposing it to anyone else.<br>

</div><div><br><br><br></div><div>Cheers<br></div><div>Seb<br><br><br><br><=
/div><div>[1] <a href=3D"https://github.com/mirage/dyntype">https://github.=
com/mirage/dyntype</a><br>[2] <a href=3D"http://oud.ocaml.org/2012/#program=
">http://oud.ocaml.org/2012/#program</a><br>

</div><div><br><br><br></div></div></div>

--bcaec55550344d63ce04d4fbe09f--

From alain.frisch@lexifi.com  Tue Feb  5 15:29:49 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 468B43C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 15:29:49 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442048 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:47976
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U2kXZ-00087F-SZ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 05 Feb 2013 15:34:34 +0000
Received: from [192.168.1.112] ([92.151.93.123]) by mwinf5d67 with ME
 id wfaZ1k00G2fi5KQ03faZgk; Tue, 05 Feb 2013 16:34:33 +0100
Message-ID: <51112689.5010606@lexifi.com>
Date: Tue, 05 Feb 2013 16:34:33 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
 <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
In-Reply-To: <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
 shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 15:29:49 -0000

Hi Gabriel,

On 02/05/2013 03:51 PM, Gabriel Scherer wrote:
> A reasonable compromise I would see between the point of view of Alain
> and Jeremy/Leo is to have an "unsafe" interface for global
> preprocessing, which we would discourage people from using by being
> very good at breaking backward compatibility (we can do better than
> Camlp4!), and *maintaining* at the same time one or several safer
> entry point that provide the local structure and conventional syntax
> that we think will bring more robustness to syntax extensions (like
> type-conv can currently be seen as a protective hub around type-driven
> boilerplate generation)

Why not, but I'm still not convinced that the "unsafe" interface will 
create actual interaction problems between extensions, which cannot be 
solved by a proper ordering between -ppx rewriters.

Can we try to come up with some realistic example of potential problems 
before considering solutions to address those problems?

> - Leo suggests using an in-language feature (namespaces) to handle
> addressing of syntax extensions; what is the picture of
> outside-language tools to do this? I've had reasonable luck using
> 'ocamlfind' as a backbone for plugin discovery in Stog. Is this what
> Alain imagine users will use? Is it portable to Windows-land?

As long as ppx rewriters are specified purely on the command-line, 
ocamlfind do the lookup quite easily:

ocamlfind ocamlc -c -package sedlex -ppx "ocamlfind sedlex/sedlex.exe" 
my_file.ml

(this already works)

I don't see any Windows-specific problem here (but I've not tried to use 
ocamlfind under Windows for a long time).

A more ambitious proposal is to let rewriters be specified in the source 
code.  Gerd has described a way to combine this with ocamlfind without 
forcing a dependency on ocamlfind.  I'm still undecided on whether it is 
good or not to specify rewriters in the source code.

Alain

From bobzhang1988@gmail.com  Tue Feb  5 15:34:46 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 84B393C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 15:34:46 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1442048 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.54 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f54.google.com ([209.85.212.54]:60843)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U2kcN-0001mT-q1 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Tue, 05 Feb 2013 15:39:32 +0000
Received: by mail-vb0-f54.google.com with SMTP id l1so164948vba.27
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 07:39:30 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=rD6o6Vj9jT+u1UHd/i/tU9iufMUUlL/u4iS49n0If9s=;
 b=aQxy1Vg4+XCyCpYhfv/3AjK6otCEH6MPdhGcMB8XOqNn7I0UBnkQ++W0odU3cUArPd
 pWxg9K7anlE82Dtid1BVntdo1BhbwPiTu3lH9I3UfyG2TfDPxLWdI4cdi9d248iO0mrr
 DFtqmFZKJhrhfD/WagmkGMJCmXg4s6AsvRYIZTg/IRdIcHWPOTlKq/NGM+04AWwueF/q
 95F8A76I9dDnST+s4qff2uFWw4J7zrDwRLc4kxuoEPfhi3d+Sei1QrT5pXZjBqusJ9Vg
 5Pyi/J41mCwd42Hn50hhfn2m8JE1WuE5hClaojs6Oqu+j/LDI+2U3dOcMPEbKbvoosgc
 mAyw==
MIME-Version: 1.0
X-Received: by 10.220.215.73 with SMTP id hd9mr28149784vcb.19.1360078770305;
 Tue, 05 Feb 2013 07:39:30 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Tue, 5 Feb 2013 07:39:30 -0800 (PST)
In-Reply-To: <CALScVY=R-hVdJ91WX4irx5ZTB+QLhBnMV9m=qhHjh6aQ-Te8Fw@mail.gmail.com>
References: <CALScVY=R-hVdJ91WX4irx5ZTB+QLhBnMV9m=qhHjh6aQ-Te8Fw@mail.gmail.com>
Date: Tue, 5 Feb 2013 10:39:30 -0500
X-Google-Sender-Auth: kwA4oBwwnkZw84AMlCeeQbTcNpo
Message-ID: <CANcqPu7dT5Av2R=JxvH1-whmAAA9PGL3bwFcxL-BRGJbkVx8dQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Sebastien Mondet <sebastien.mondet@gmail.com>
Content-Type: multipart/alternative; boundary=bcaec54ee374f87c8504d4fc0394
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Runtime types and no -pp(x)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 15:34:46 -0000

--bcaec54ee374f87c8504d4fc0394
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Hi Sebastien,
   I agree with you that adding run-time types. To clarify a bit, Fan is
not invasive as Camlp* or ppx(the current ppx proposal seems to be quite
large change to the compiler), it does not need any change to the compiler,
so it does not impose you to use it.
For the deriving and type_conv syntax extension conflict, this is not the
Fault of Camlp*, you can avoid
it while still using Camlp*, the solution is adopted by Fan
{:ocaml|
type u =3D A of int
|}
{:derive| whatever you like|}
On Tue, Feb 5, 2013 at 10:29 AM, Sebastien Mondet <
sebastien.mondet@gmail.com> wrote:

>
> Hi
>
> Yet Another Proposal =99  :)
>
> Here, at NYU-Bio we use camlp4 in two ways:
>
> 1. All the code is JaneSt-Core-styled and uses sexplib.syntax and
> bin_prot.syntax
>
> We also use an ('a, 'b) Result.t Lwt.t  monad everywhere but there is no
> need for camlp4, monadic programming is perfectly fine with normal OCaml
> syntax.
>
> 2. The web-app is fully Eliom-based: it uses the eliom{dep,c,opt}
> tool-chain, so it is incompatible with sexplib.syntax (because it imposes
> deriving) and takes ages to compile.
> (if I had to start again the project, I think I would not use the syntax
> part of ocsigen or at least limit it to one single file).
>
>
> I think I have already lost too many hours of my life fixing
> camlp4-related problems just for using type_conv, so:
>
>
> The proposal:
>
> Get something like dyntype [1] or what Pierre Chambart and Gr=E9goire Hen=
ry
> presented at OUD [2], into the main compiler.
>
> type_conv and deriving will become obsolete.
>
> Then, most people can get rid of any kind of syntactic preprocessing for
> 95% of their problems.
>
> For the remaining 5%, they can use camlp4, camlp5, Fan, or write their ow=
n
> code generator without imposing it to anyone else.
>
>
>
> Cheers
> Seb
>
>
>
> [1] https://github.com/mirage/dyntype
> [2] http://oud.ocaml.org/2012/#program
>
>
>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>
>


--=20
-- Regards, Hongbo

--bcaec54ee374f87c8504d4fc0394
Content-Type: text/html; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

Hi Sebastien,<div>=A0 =A0I agree with you that adding run-time types. To cl=
arify a bit, Fan is not invasive as Camlp* or ppx(the current ppx proposal =
seems to be quite large change to the compiler), it does not need any chang=
e to the compiler, so it does not impose you to use it.</div>
<div>For the deriving and type_conv syntax extension conflict, this is not =
the Fault of Camlp*, you can avoid=A0</div><div>it while still using Camlp*=
, the solution is adopted by Fan</div><div>{:ocaml|</div><div>type u =3D A =
of int=A0</div>
<div>|}<br>{:derive| whatever you like|}<br><div class=3D"gmail_quote">On T=
ue, Feb 5, 2013 at 10:29 AM, Sebastien Mondet <span dir=3D"ltr">&lt;<a href=
=3D"mailto:sebastien.mondet@gmail.com" target=3D"_blank">sebastien.mondet@g=
mail.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div dir=3D"ltr"><div><div><div><div><div><d=
iv><div><div><div><br></div>Hi<br><br></div>Yet Another Proposal =99=A0 :)<=
br><br>
</div>Here, at NYU-Bio we use camlp4 in two ways:<br><br></div>1. All the c=
ode is JaneSt-Core-styled and uses sexplib.syntax and=A0 bin_prot.syntax<br=
>

</div><br>We also use an (&#39;a, &#39;b) Result.t Lwt.t=A0 monad everywher=
e but there is no need for camlp4, monadic programming is perfectly fine wi=
th normal OCaml syntax.<br><br></div>2. The web-app is fully Eliom-based: i=
t uses the eliom{dep,c,opt} tool-chain, so it is incompatible with sexplib.=
syntax (because it imposes deriving) and takes ages to compile.<br>


</div>(if I had to start again the project, I think I would not use the syn=
tax part of ocsigen or at least limit it to one single file).<br><br><br></=
div><div>I think I have already lost too many hours of my life fixing camlp=
4-related problems just for using type_conv, so:<br>


<br></div><div><br></div>The proposal:<br><br></div>Get something like dynt=
ype [1] or what Pierre Chambart and Gr=E9goire Henry presented at OUD [2], =
into the main compiler. <br><br>type_conv and deriving will become obsolete=
.<br>


<div><div><br></div><div>Then, most people can get rid of any kind of synta=
ctic preprocessing for 95% of their problems.<br><br></div><div>For the rem=
aining 5%, they can use camlp4, camlp5, Fan, or write their own code genera=
tor without imposing it to anyone else.<br>


</div><div><br><br><br></div><div>Cheers<br></div><div>Seb<br><br><br><br><=
/div><div>[1] <a href=3D"https://github.com/mirage/dyntype" target=3D"_blan=
k">https://github.com/mirage/dyntype</a><br>[2] <a href=3D"http://oud.ocaml=
.org/2012/#program" target=3D"_blank">http://oud.ocaml.org/2012/#program</a=
><br>


</div><div><br><br><br></div></div></div>
<br>_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
<br></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regar=
ds, Hongbo
</div>

--bcaec54ee374f87c8504d4fc0394--

From markus.mottl@gmail.com  Tue Feb  5 15:42:14 2013
Return-Path: <markus.mottl@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5A6F83C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 15:42:14 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1442048 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (markus.mottl[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f173.google.com ([209.85.212.173]:40099)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U2kjb-0001wn-mh (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <markus.mottl@gmail.com>); Tue, 05 Feb 2013 15:47:00 +0000
Received: by mail-wi0-f173.google.com with SMTP id hq4so4359052wib.12
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 07:46:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type:content-transfer-encoding;
 bh=UiRNU+m32J4eSWB8XW2IEbSJCkDfAW19rDIzRi3HX40=;
 b=cLLyecpCRMk8zgIcjbaXXhS6+7pkgAsVzF0a9YnQF72I0TRaOE6kwN3tZMGfCDfmtJ
 nQ/BFdRVmJVmuVcvwAuvMUlBbMRwXXiAJW1+5FGf5WKXhoa853gC6zLZqk2Xqme5s2wp
 MvEhlSaNRI7MCsCX3vvTWdEGI06lPZgLJ834Zs+vr7VFlo6AGUSyKPm3gLxVn1J2k3hs
 AIDQumaBiSmohXq4tUC6a1uQRR+Cj/x4THyWC/kVh//NF8WMzM9SDWJK64mR3OMThWIV
 aUeVzB35jNg64bCufsGsXX3lPgui35jsADOMp/KKRMQoykXLn4UayflfYpR4jwDdSt+l
 I/fw==
MIME-Version: 1.0
X-Received: by 10.194.158.100 with SMTP id wt4mr43401172wjb.37.1360079218887; 
 Tue, 05 Feb 2013 07:46:58 -0800 (PST)
Received: by 10.194.18.135 with HTTP; Tue, 5 Feb 2013 07:46:58 -0800 (PST)
In-Reply-To: <CALScVY=R-hVdJ91WX4irx5ZTB+QLhBnMV9m=qhHjh6aQ-Te8Fw@mail.gmail.com>
References: <CALScVY=R-hVdJ91WX4irx5ZTB+QLhBnMV9m=qhHjh6aQ-Te8Fw@mail.gmail.com>
Date: Tue, 5 Feb 2013 10:46:58 -0500
Message-ID: <CAP_800q=uM0pT9_vOqXUYb13tANW91sZvekz_a3hW4zkUcDz+g@mail.gmail.com>
From: Markus Mottl <markus.mottl@gmail.com>
To: Sebastien Mondet <sebastien.mondet@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Runtime types and no -pp(x)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 15:42:14 -0000

On Tue, Feb 5, 2013 at 10:29 AM, Sebastien Mondet
<sebastien.mondet@gmail.com> wrote:
> The proposal:
>
> Get something like dyntype [1] or what Pierre Chambart and Gr=E9goire Hen=
ry
> presented at OUD [2], into the main compiler.
>
> type_conv and deriving will become obsolete.

I'd be happy to see cleaner and simpler solutions than ones based on
camlp4.  The latter is powerful, but quite a beast.  I'd also love to
see support for runtime type representations in the compiler.  But I
don't think the latter will fill everybody's needs, especially when it
comes to performance.  E.g. knowing the number of constructors in a
type gives great opportunities for optimizing protocols and the code
used to handle them.  This cannot be easily done without prohibitively
high costs at runtime.  Unless, maybe, we also manage to get runtime
code generation into the compiler in the spirit of MetaOCaml, but
that's a whole different story.

Regards,
Markus

--=20
Markus Mottl        http://www.ocaml.info        markus.mottl@gmail.com

From lpw25@hermes.cam.ac.uk  Tue Feb  5 15:52:45 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B775D3C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 15:52:45 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:33980)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U2ktm-0002NX-sf (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 15:57:31 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U2ktm-0002ue-U8 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 15:57:30 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 05 Feb 2013 15:57:30 +0000
Date: 05 Feb 2013 15:57:30 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Message-ID: <Prayer.1.3.5.1302051557300.13899@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
 <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 15:52:45 -0000

>I don't really like Leo's proposal.
>
>On the semantic side, I very much like Jeremy's idea

There is no fundamental difference between the two ideas. There are 
problems with trying to use functions within modules as extensions. My 
proposal is simply that we can get around this by attaching the functions 
to namespaces.

>On the practical side, adding a notion of staged compilation

I'm not suggesting any notion of staged compilation. The whole point of 
separating functions for extensions from modules is to avoid this issue.

>namespaces to handle syntax extensions seems really overkill.

Namespaces are going to be included anyway, there is no harm in using them 
to help make syntax extensions easier.
 
>A reasonable compromise I would see between the point of view of Alain
>and Jeremy/Leo is to have an "unsafe" interface for global
>preprocessing, which we would discourage people from using by being
>very good at breaking backward compatibility (we can do better than
>Camlp4!), and *maintaining* at the same time one or several safer
>entry point that provide the local structure and conventional syntax
>that we think will bring more robustness to syntax extensions (like
>type-conv can currently be seen as a protective hub around type-driven
>boilerplate generation). 

I agree. My proposal is not instead of ppx. It is a safer and easier-to-use 
alternative for a large subset of the extensions ppx can support. It is a 
more long-term option, for the short/medium-term we should use ppx.

>Leo, I'm a bit unclear on what kind of
>GADT you're thinking of, could you elaborate? 

Nothing fancy, just something like:

  type 'a ctx = 
    ExprQuot: string -> Ast.expr ctx
    PattQuot: string -> Ast.patt ctx
    ...
    ExprAst: Ast.expr -> Ast.expr ctx
    PattAst: Ast.expr -> Ast.patt ctx
    ...

>Must we link extension functions together

I'm not sure I understand what you mean by this. Could you expand?


From lpw25@hermes.cam.ac.uk  Tue Feb  5 15:56:35 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id F1C0E3C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 15:56:34 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:35073)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U2kxU-0004Vh-rW (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 16:01:20 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U2kxU-0003Ug-IN (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 16:01:20 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 05 Feb 2013 16:01:18 +0000
Date: 05 Feb 2013 16:01:18 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Hongbo Zhang <hongboz@seas.upenn.edu>
Message-ID: <Prayer.1.3.5.1302051601180.13899@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 15:56:35 -0000

On Feb 5 2013, Hongbo Zhang wrote:

>We have the same ideas. ;-)
>proposals 1, 2, 3, 4 are implemented in Fan as well.

Well it is supposed to provide a subset of camlp4. However, my proposal 
uses the compiler's own parser.

>Proposal 3 is applied in camlp4 itself(see the quotation module)

It is similar but not the same. Camlp4 requires you to register a different 
function for each different quotation context.


From bobzhang1988@gmail.com  Tue Feb  5 16:01:09 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AE3F83C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 16:01:09 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1442048 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.54 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f54.google.com ([209.85.212.54]:35779)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U2l1u-00020g-Yt (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Tue, 05 Feb 2013 16:05:55 +0000
Received: by mail-vb0-f54.google.com with SMTP id l1so181382vba.27
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 08:05:54 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=YtumvTcqL4YGJYwEpFdYcoGXtL4eHvM57kTQyziY7io=;
 b=1Jx3lKpW25CImtazst/29DQzStBUx4rLzHB8mL35cjmOlKizSB+4O0sfshQ0euXiS3
 QGBalHPLvfPMBZSngoooVkvFNynIac8H0/Kq0EkI/HTjjOAeQt7QR7r2j5RTZlLLn4Bd
 7NMOJtPmC44XLQphNzVwsYBxXieHmG99OKYPrNKDKVCvBUnaKcJLHf5sjOk2SoQqchL6
 Q4iXB3eZ61ZXZ10quQpYezHOneb6LLQ6zZjZt0x5Fm0Ximb3sDhNCEhuOQuz6vkcpkEl
 gMoQ8Zu+PAzDopOcTxGk2yRlfh8Gq6TFk3N/5ahpcJ564IOfZMqypnRbs4iWhnLPPuMq
 2EYw==
MIME-Version: 1.0
X-Received: by 10.58.240.107 with SMTP id vz11mr24494676vec.45.1360080354078; 
 Tue, 05 Feb 2013 08:05:54 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Tue, 5 Feb 2013 08:05:53 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1302051601180.13899@hermes-1.csi.cam.ac.uk>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
 <Prayer.1.3.5.1302051601180.13899@hermes-1.csi.cam.ac.uk>
Date: Tue, 5 Feb 2013 11:05:53 -0500
X-Google-Sender-Auth: zn3TtQ1BMkrWMh34lDG64BLLHM0
Message-ID: <CANcqPu4jskxTA02Rj=d1JkSgGR-nSERa3n_0+gS+u7+iFxmodw@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=047d7bacbff05eedc904d4fc6201
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 16:01:09 -0000

--047d7bacbff05eedc904d4fc6201
Content-Type: text/plain; charset=ISO-8859-1

On Tue, Feb 5, 2013 at 11:01 AM, Leo White <lpw25@cam.ac.uk> wrote:

> On Feb 5 2013, Hongbo Zhang wrote:\
> It is similar but not the same. Camlp4 requires you to register a
> different function for each different quotation context.
>
It's necessary, the semantics are different in  different syntax categories



-- 
-- Regards, Hongbo

--047d7bacbff05eedc904d4fc6201
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Tue, Feb 5, 2013 at 11:01 AM, Leo Whi=
te <span dir=3D"ltr">&lt;<a href=3D"mailto:lpw25@cam.ac.uk" target=3D"_blan=
k">lpw25@cam.ac.uk</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quot=
e" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<div class=3D"im">On Feb 5 2013, Hongbo Zhang wrote:\<br></div>
It is similar but not the same. Camlp4 requires you to register a different=
 function for each different quotation context.<br></blockquote><div>It&#39=
;s necessary, the semantics are different in =A0different syntax categories=
</div>
</div><br><br clear=3D"all"><div><br></div>-- <br>-- Regards, Hongbo

--047d7bacbff05eedc904d4fc6201--

From alain.frisch@lexifi.com  Tue Feb  5 16:12:30 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1D5383C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 16:12:30 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442048 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:21146
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U2lCt-0005tt-RC (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 05 Feb 2013 16:17:15 +0000
Received: from [192.168.1.112] ([92.151.93.123]) by mwinf5d67 with ME
 id wgHE1k00d2fi5KQ03gHEed; Tue, 05 Feb 2013 17:17:15 +0100
Message-ID: <5111308B.3080903@lexifi.com>
Date: Tue, 05 Feb 2013 17:17:15 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
 <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
 <Prayer.1.3.5.1302051557300.13899@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1302051557300.13899@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
 shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 16:12:30 -0000

On 02/05/2013 04:57 PM, Leo White wrote:
> There is no fundamental difference between the two ideas. There are
> problems with trying to use functions within modules as extensions. My
> proposal is simply that we can get around this by attaching the
> functions to namespaces.

I don't see why this notion of quotation expander is linked to 
namespaces.  The problem is not that the code for expanders is attached 
to module, but simply that it this code needs to run during compilation, 
and must thus have been compiled in an early stage of the build process 
(and then linked statically/dynamically in the compiler or pre-processor 
driver).  I don't think we need namespaces nor a new file extension to 
do that.  Quotations expander are just regular OCaml code, with the full 
expressive power of the language, and as any OCaml code to be compiled, 
they need to be part of some module.  I don't see any problem here.

> I'm not suggesting any notion of staged compilation. The whole point of
> separating functions for extensions from modules is to avoid this issue.

The OCaml code in .mlq files need to be compiled before any unit which 
uses this expander, and it will be run somehow during the compilation of 
that unit.  "User-land" code executed during compilation of another 
piece of code look like staged compilation.



Alain

From lpw25@hermes.cam.ac.uk  Tue Feb  5 16:30:57 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7791D3C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 16:30:57 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:54931)
 by ppsw-43.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U2lUk-0002bT-oz (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 16:35:42 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U2lUk-0000BF-PH (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 16:35:42 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 05 Feb 2013 16:35:42 +0000
Date: 05 Feb 2013 16:35:42 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1302051635420.23883@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5111308B.3080903@lexifi.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
 <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
 <Prayer.1.3.5.1302051557300.13899@hermes-1.csi.cam.ac.uk>
 <5111308B.3080903@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 16:30:57 -0000

>I don't see why this notion of quotation expander is linked to 
>namespaces.  The problem is not that the code for expanders is attached 
>to module, but simply that it this code needs to run during compilation, 
>and must thus have been compiled in an early stage of the build process 
>(and then linked statically/dynamically in the compiler or pre-processor 
>driver).  I don't think we need namespaces nor a new file extension to 
>do that.  Quotations expander are just regular OCaml code, with the full 
>expressive power of the language, and as any OCaml code to be compiled, 
>they need to be part of some module.  I don't see any problem here.

As I have tried to explain in the post, the problem is with combining code 
to be run at compile-time with code to be run at run-time. Trying to simply 
look in your current environment for an extension, as in Jeremy's proposal, 
means having just such a combination.

If the extension is part of a module then using it requires you to 
initialise that whole module at compile-time. This includes initialising 
(and so potentially executing) code in the module that is intended for 
run-time.

To prevent this from happening we can simply not allow extensions to be 
part of modules. However, we then have no means of referring to that 
extension. So in order to refer to these extensions we allow them to be 
members of namespaces.

>The OCaml code in .mlq files need to be compiled before any unit which 
>uses this expander, and it will be run somehow during the compilation of 
>that unit.  "User-land" code executed during compilation of another 
>piece of code look like staged compilation.

Only in the same way that a ppx extension is staged compilation.

By staged compilation I had assumed Gabriel had meant explicit in-language 
specification of what code is for compile-time and what code is for 
run-time. Similar to how a macro system based on MetaOCaml might look.

By not allowing extensions to be part of modules we avoid this issue, since 
only modules can be linked together to create a program.


From alain.frisch@lexifi.com  Tue Feb  5 16:38:25 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 620A93C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 16:38:25 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442048 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:40981
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U2lbx-0000E4-s4 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 05 Feb 2013 16:43:11 +0000
Received: from [192.168.1.112] ([92.151.93.123]) by mwinf5d67 with ME
 id wgj91k00J2fi5KQ03gj9L0; Tue, 05 Feb 2013 17:43:09 +0100
Message-ID: <5111369D.5050704@lexifi.com>
Date: Tue, 05 Feb 2013 17:43:09 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
 <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
 <Prayer.1.3.5.1302051557300.13899@hermes-1.csi.cam.ac.uk>
 <5111308B.3080903@lexifi.com>
 <Prayer.1.3.5.1302051635420.23883@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1302051635420.23883@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
 shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 16:38:25 -0000

On 02/05/2013 05:35 PM, Leo White wrote:
> If the extension is part of a module then using it requires you to
> initialise that whole module at compile-time. This includes initialising
> (and so potentially executing) code in the module that is intended for
> run-time.
>
> To prevent this from happening we can simply not allow extensions to be
> part of modules. However, we then have no means of referring to that
> extension. So in order to refer to these extensions we allow them to be
> members of namespaces.

I don't follow.  The problem, as I see it, is not that code for the 
extension is in *some* module, but that it is in the *same* module as 
the unit on which it needs to apply.

Can you clarify how you see compilation/execution being organized in 
your proposal?  Would the code for .mlq would be compiled manually 
before its expanders can be used, or would this compilation happen 
automatically?  Which technology would then be used to run this code 
(Dynlink, static linking, toplevel-like technology for in-process 
compilation/execution)?

Alain

From lpw25@hermes.cam.ac.uk  Tue Feb  5 17:18:10 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8B7B83C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 17:18:10 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:42535)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U2mER-0003mA-Sp (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 17:22:56 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U2mER-0006v8-TR (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 17:22:55 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 05 Feb 2013 17:22:55 +0000
Date: 05 Feb 2013 17:22:55 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1302051722550.14752@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5111369D.5050704@lexifi.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
 <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
 <Prayer.1.3.5.1302051557300.13899@hermes-1.csi.cam.ac.uk>
 <5111308B.3080903@lexifi.com>
 <Prayer.1.3.5.1302051635420.23883@hermes-1.csi.cam.ac.uk>
 <5111369D.5050704@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 17:18:10 -0000

On Feb 5 2013, Alain Frisch wrote:

>On 02/05/2013 05:35 PM, Leo White wrote:
>> If the extension is part of a module then using it requires you to
>> initialise that whole module at compile-time. This includes initialising
>> (and so potentially executing) code in the module that is intended for
>> run-time.
>>
>> To prevent this from happening we can simply not allow extensions to be
>> part of modules. However, we then have no means of referring to that
>> extension. So in order to refer to these extensions we allow them to be
>> members of namespaces.
>
>I don't follow.  The problem, as I see it, is not that code for the 
>extension is in *some* module, but that it is in the *same* module as 
>the unit on which it needs to apply.

While obviously using an extension from the same module is a problem, it is 
not the problem I am talking about.

The problem is that the quotation is in a module that is part of the 
program. This module will be initialised at both compile-time and run-time. 
Any effects of initialising the module will occur both times. Since an 
OCaml program's run-time behaviour is basically defined as the effects of 
initialising its modules this will cause confusion and bugs.

By separating the extensions from modules we prevent this almost certainly 
undesired behaviour because only modules can be linked into a program.

One of the strong points of the camlp4/ppx model of creating preprocessors 
for implementing extensions is that it is very clear what is executed at 
compile-time and what is executed at run-time. The ".mlq" files provide 
similar clarity to extensions implemented within the language itself.

>Would the code for .mlq would be compiled manually 
>before its expanders can be used, or would this compilation happen 
>automatically?  

They would need to be compiled, just like ".mli" files.

> Which technology would then be used to run this code 
>(Dynlink, static linking, toplevel-like technology for in-process 
>compilation/execution)?

Probably the same technology as the top-level.


From alain.frisch@lexifi.com  Tue Feb  5 17:34:59 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3B6D93C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 17:34:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442048 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:33122
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U2mUi-00087Q-rQ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 05 Feb 2013 17:39:45 +0000
Received: from [192.168.1.112] ([92.151.93.123]) by mwinf5d67 with ME
 id whfj1k00b2fi5KQ03hfjza; Tue, 05 Feb 2013 18:39:44 +0100
Message-ID: <511143E0.7070400@lexifi.com>
Date: Tue, 05 Feb 2013 18:39:44 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
 <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
 <Prayer.1.3.5.1302051557300.13899@hermes-1.csi.cam.ac.uk>
 <5111308B.3080903@lexifi.com>
 <Prayer.1.3.5.1302051635420.23883@hermes-1.csi.cam.ac.uk>
 <5111369D.5050704@lexifi.com>
 <Prayer.1.3.5.1302051722550.14752@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1302051722550.14752@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
 shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 17:34:59 -0000

On 02/05/2013 06:22 PM, Leo White wrote:
> The problem is that the quotation is in a module that is part of the
> program. This module will be initialised at both compile-time and
> run-time. Any effects of initialising the module will occur both times.
> Since an OCaml program's run-time behaviour is basically defined as the
> effects of initialising its modules this will cause confusion and bugs.

As I see it, the problem is not that the code for the extension is in a 
module, but that it is in a module which will be linked with your target 
program.  You propose to avoid any such potential confusion by 
segregating those modules which contain extension code from other 
"regular modules".  Conceptually, this is not very different than 
choosing a module prefix (e.g. "pb_", the successor of "pa_") and simply 
ensuring in the compiler that they refuse to link pb_* modules into 
programs; those module can only be loaded (dynamically?) in a specific 
context (a particular "ppx" driver). It's just that you declare that 
these pb_* units are not real modules (and introduce a specific file 
extension instead of a prefix).

But fundamentally, I still don't agree that there is a clear separation 
between "extension code" and "program code".  In particular, an 
extension might very well use a third-party library (e.g. an XML parser) 
or share some code with the target program.  Why should we enforce a 
strong separation, in particular if this implies some ad hoc rules in 
the compilers?


> >> Would the code for .mlq would be compiled manually before its
>> expanders can be used, or would this compilation happen automatically?
>
> They would need to be compiled, just like ".mli" files.

They contain code, so I guess you meant: just like ".ml" files?

>> Which technology would then be used to run this code (Dynlink, static
>> linking, toplevel-like technology for in-process compilation/execution)?
>
> Probably the same technology as the top-level.

This seems to contradict the "need to be compiled" above.


Alain


From lpw25@hermes.cam.ac.uk  Tue Feb  5 18:26:02 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D1B773C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 18:26:02 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:45626)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U2nI8-0007IV-Y8 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 18:30:48 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U2nI8-0007Oq-I5 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Feb 2013 18:30:48 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 05 Feb 2013 18:30:48 +0000
Date: 05 Feb 2013 18:30:48 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1302051830480.21589@hermes-1.csi.cam.ac.uk>
In-Reply-To: <511143E0.7070400@lexifi.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
 <Prayer.1.3.5.1302021925001.337@hermes-1.csi.cam.ac.uk>
 <Prayer.1.3.5.1302051350540.19661@hermes-1.csi.cam.ac.uk>
 <CANcqPu4Kh8K=4dS=nS1MoATr+iXB5v56XOrb1kWre34GvzUKbg@mail.gmail.com>
 <CAPFanBG=LHDGQ=DV3nahSpL0+tOLkuOwGPivFXFDPPrLOFOTyA@mail.gmail.com>
 <Prayer.1.3.5.1302051557300.13899@hermes-1.csi.cam.ac.uk>
 <5111308B.3080903@lexifi.com>
 <Prayer.1.3.5.1302051635420.23883@hermes-1.csi.cam.ac.uk>
 <5111369D.5050704@lexifi.com>
 <Prayer.1.3.5.1302051722550.14752@hermes-1.csi.cam.ac.uk>
 <511143E0.7070400@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 18:26:02 -0000

On Feb 5 2013, Alain Frisch wrote:

>On 02/05/2013 06:22 PM, Leo White wrote:
>> The problem is that the quotation is in a module that is part of the
>> program. This module will be initialised at both compile-time and
>> run-time. Any effects of initialising the module will occur both times.
>> Since an OCaml program's run-time behaviour is basically defined as the
>> effects of initialising its modules this will cause confusion and bugs.
>
>As I see it, the problem is not that the code for the extension is in a 
>module, but that it is in a module which will be linked with your target 
>program.  You propose to avoid any such potential confusion by 
>segregating those modules which contain extension code from other 
>"regular modules".  Conceptually, this is not very different than 
>choosing a module prefix (e.g. "pb_", the successor of "pa_") and simply 
>ensuring in the compiler that they refuse to link pb_* modules into 
>programs; those module can only be loaded (dynamically?) in a specific 
>context (a particular "ppx" driver). It's just that you declare that 
>these pb_* units are not real modules (and introduce a specific file 
>extension instead of a prefix).

That's about right.

>But fundamentally, I still don't agree that there is a clear separation 
>between "extension code" and "program code".  In particular, an 
>extension might very well use a third-party library (e.g. an XML parser) 
>or share some code with the target program. 

Yes, it is not a hard separation between the two.

Why should we enforce a 
>strong separation, in particular if this implies some ad hoc rules in 
>the compilers?

My proposal was for a system that made extensions simple for non-experts. I 
think that it is easier to explain that extensions are like 
mini-preprocessors that live in ".mlq" files, than to explain that they are 
normal functions, but you can't use them in the same module, and you 
shouldn't include them in a module intended for run-time execution, and the 
side-effects of running the function will not be preserved etc.

Note that Haskell does not have the last two conditions because it manages 
all side-effects.

>> >> Would the code for .mlq would be compiled manually before its
>>> expanders can be used, or would this compilation happen automatically?
>>
>> They would need to be compiled, just like ".mli" files.
>
>They contain code, so I guess you meant: just like ".ml" files?

I meant that they were like ".mli" files in that they must be compiled 
before a module that refers to them can be compiled.

>>> Which technology would then be used to run this code (Dynlink, static
>>> linking, toplevel-like technology for in-process compilation/execution)?
>>
>> Probably the same technology as the top-level.
>
>This seems to contradict the "need to be compiled" above.
>

Sorry, I meant the technology that the top-level uses to do "#load" 
directives. This is probably the same as Dynlink.


From yminsky@janestreet.com  Tue Feb  5 18:36:58 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 73C873C06E
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Feb 2013 18:36:58 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1442048 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:50779
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U2nSc-0006Ci-ry (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Tue, 05 Feb 2013 18:41:44 +0000
Received: from tot-smtp.delacy.com ([172.27.22.35] helo=tot-is-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1U2nSI-00062T-MX
 for wg-camlp4@lists.ocaml.org; Tue, 05 Feb 2013 13:41:18 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-is-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1U2nSH-0003DL-6x
 for wg-camlp4@lists.ocaml.org; Tue, 05 Feb 2013 13:41:17 -0500
Received: from mail-ee0-f72.google.com ([74.125.83.72])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1U2nSH-0005F1-39
 for wg-camlp4@lists.ocaml.org; Tue, 05 Feb 2013 13:41:17 -0500
Received: by mail-ee0-f72.google.com with SMTP id b15so559141eek.11
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 10:41:16 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type;
 bh=78r4Gz8KzwdcncKjcNfp3Rpc4fH3W9ZIvc+zUfeCzBg=;
 b=s8nHsW0WBSbXjr4bXqyDhmo+UnAahbyvkem7rMUCfEI+iiERCgTPxQxjAD6qou/ofq
 IJsLPDbqKeSCc9+4xa04TyPkGVdaB8OBBCLxvgAjqtjCXeIywnTYFWKlzCqFx7PVFKvJ
 hPbknDJcEQ+UVBlFve8TKmcf1VlAgLog3EW1c=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type:x-gm-message-state;
 bh=78r4Gz8KzwdcncKjcNfp3Rpc4fH3W9ZIvc+zUfeCzBg=;
 b=K6aF97vTB+iO2WlwOa3iFeK0DkXSt6RkeWmnUgUy/psbeCqqyyoazA1SX1SP7SPXH+
 ERPYqTeslwZmQywv6EueVfXI5/dPtj75B1P3FuMX0SpJxUKLufbiKNFEfnrzqbikvV6N
 dHU9ERbM63njwoIp/lAtUJovlJUwjueS2wf2b5Gi7eGMtYbP6xrXuiW+Ejnvi5yAp9aU
 HwJM5nSS0Bgc05RMsAgb8V850/ndOKNqT5tNwEoAMlE1ZHPbLF9TwcvpwQRlKt4qpl4Q
 IBzHgEp0K46pxRbVIpAwvrDC6hARHrEo4AOeFKAjWUmZDCCyhZpc/euQ62owTIdHYtmp
 wFdQ==
X-Received: by 10.14.178.196 with SMTP id f44mr87323512eem.14.1360089676524;
 Tue, 05 Feb 2013 10:41:16 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.14.178.196 with SMTP id f44mr87323486eem.14.1360089676322;
 Tue, 05 Feb 2013 10:41:16 -0800 (PST)
Received: by 10.223.141.66 with HTTP; Tue, 5 Feb 2013 10:41:15 -0800 (PST)
In-Reply-To: <20130205150603.GV13082@three-tuns.net>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
Date: Tue, 5 Feb 2013 13:41:15 -0500
Message-ID: <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: Mark Shinwell <mark@three-tuns.net>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQkN95WpuLX9FLGsgyyPh3ekO7qy/313bm13NT5EeDZgSJ6pwu8knmns4ZqkhmXcG6Pq/K4GZqK7MXHAElXWs//+tGQ7Vw1u9spKCkq6tqTzJLCc80jS46I6k7avU2ApR7kBnEk+ZI6PbIAmxzmpVFKiHTBt3A==
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Feb 2013 18:36:58 -0000

Leo's post is welcome, but it would be nice for an overview of what
the other proposals floating around are.  Maybe a single post
summarizing the main proposals and points of contention?

y

On Tue, Feb 5, 2013 at 10:06 AM, Mark Shinwell <mark@three-tuns.net> wrote:
> On Tue, Feb 05, 2013 at 07:43:10AM -0500, Yaron Minsky wrote:
>> There have been so many detailed and thoughtful emails that it's hard
>> to keep up with the deluge.  I would humbly submit that this would be
>> a good time for one of the organizers (Leo or Alain) to put together a
>> summary of the different positions that have been expressed about how
>> ppx might work, so that one could read over and think through those.
>> Right now, I have a hard time keeping the current state of the
>> conversation in my head, and I'm pretty sure I'm not alone.
>
> You are not alone.  I also think a summary would be very useful.
>
> Mark

From bobzhang1988@gmail.com  Wed Feb  6 00:22:41 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1FF753C06E
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Feb 2013 00:22:41 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1442048 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f173.google.com ([209.85.128.173]:61077)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U2srG-0005QI-nK (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Wed, 06 Feb 2013 00:27:27 +0000
Received: by mail-ve0-f173.google.com with SMTP id oz10so694699veb.32
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Feb 2013 16:27:25 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=G3cMSeyl8KAhOBFTcHCzA4OzvgyhdWDJhWMhCti7mcE=;
 b=nsAwYkSuYA6XfIV4WmKgMfaOaSxc/EUYIuB8YgVMzCHdNdi1XlmXpWQwBlDJl+p5/b
 BP1O+c31yJYEG+prLwd6pbY+MK86KubyaVmVUUpvea5InO141jp4DGwsAWmMBxl2Ho+r
 Ao8DYknn/Qxp0q/tCHX7PF/BKA00vAtIRN8eXta9O43ZFzq2zMYTnS/pwQeolsiP+qWn
 M6N2BfZiDf/yM6VtcDS6sPci1LGrb22ICkOPqkRXY8PD1O724OK+/Cs0HnJmFSFmome6
 gKfo2Fzc40XMy4azURihi8JQYEKrqJehFzq30lfqkKA+V0jCrq8OBwL5omESsd2B8mhO
 MQlw==
MIME-Version: 1.0
X-Received: by 10.52.177.161 with SMTP id cr1mr8938235vdc.64.1360110445259;
 Tue, 05 Feb 2013 16:27:25 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Tue, 5 Feb 2013 16:27:25 -0800 (PST)
In-Reply-To: <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
References: <CAPFanBHJP1xgNvSCDpYYFbBHwnPKPyODPjZUpkwOTs8ToU9ijQ@mail.gmail.com>
 <510B73C0.5090700@frisch.fr>
 <CAPFanBGWLmjhXD+zGVich5mPd50NKGgHknwtL40rU-z05ycbqw@mail.gmail.com>
 <CAAxsn=F-6FMk+BJqphG18O-a5=Ld__zsePjBHAbp8qJgpaXWNQ@mail.gmail.com>
Date: Tue, 5 Feb 2013 19:27:25 -0500
X-Google-Sender-Auth: a8LyjUnal3IKe6a1GAbsreM7fDk
Message-ID: <CANcqPu61U03NNsx0J=P2ReKQpm4edAfQo-sN=ViLKgOcVTZCoQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Jeremy Yallop <yallop@gmail.com>
Content-Type: multipart/alternative; boundary=20cf3071ceacf1eb2b04d50363b5
Cc: wg-camlp4@lists.ocaml.org, Alain Frisch <alain@frisch.fr>
Subject: Re: [wg-camlp4] Structured comments,
	shallow embeddings and deep quasiquotations
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Feb 2013 00:22:41 -0000

--20cf3071ceacf1eb2b04d50363b5
Content-Type: text/plain; charset=ISO-8859-1

Hi, Jeremy,
   I like your ideas, ;-). Fan adopt the same approach as you proposed.
Instead of
    (@deriving ["sexp"; "json"])
   type t = F of int | G of s
    and s = H of (t * t)

I used the notation
{:ocaml|
type t = F of int | G of s
and s = H of (t * t)
|}
{:derive| (sexp,json)|}
But the semantics are essentially the same,
should we take a serious look at Fan? As a much more advanced tool, Fan,
compared with ppx, while it does not require any change to the compiler,
and porting other camlp4 based library is much easier, I see a lot of
benefits here.

If we change the compiler a lot for little benefit in the internal
compiler, that makes life too hard for more advanced tools, are we a bit
short-sighted here? I really like some other features like run-time types
in the compiler instead, my 2 cents


On Sat, Feb 2, 2013 at 11:17 AM, Jeremy Yallop <yallop@gmail.com> wrote:

> On 1 February 2013 15:38, Gabriel Scherer <gabriel.scherer@gmail.com>
> wrote:
> > Finally, I think -ppx + arbitrary annotations, without any further
> > restriction, is too free-form for robust syntax extensions: one
> > important problem with Camlp4 is that it allowed syntax extension
> > writers to modify the syntax in very bad way that hurt robustness. As
> > already discussed, I have a strong distaste for extensions that only
> > piggyback on existing syntax (without adding any explicit marker); I
> > would feel safer if the extension *mechanism* disallowed such
> > unstructured extensions, or at least made them less rewarding to write
> > than the composable ones. (For example by only passing to the
> > extension writer the part(s) of the AST that have been annotated).
> > Unfortunately, I don't see how Bisect would fit any such restriction.
> > Maybe that's a problem best solved by socialization (writing a
> > documentation on good practices, and yelling on people), but I sort of
> > doubt it -- I don't know how many time I've had to argue for *not*
> > globally changing the associativity of infix operators through Camlp4
> > in Batteries.
>
> I agree with Gabriel.  Actually, I think that a small tweak to the
> design of -ppx could address both this and a number of problems that
> others have raised during the discussion here.
>
> The -ppx approach applies one or more global transformations to the
> ASTs of OCaml source files; these transformations can be parameterized
> by attributes attached at particular points in the syntax tree.  This
> is a significant improvement over the Camlp4 approach, largely because
> it exchanges the (unnecessary) ability to change the concrete syntax
> for a number of valuable guarantees, which make extensions easier to
> write and code that uses extensions easier to understand.
>
> We can go further in this direction, and give up more (unnecessary)
> power in return for further guarantees.  As Gabriel says, since -ppx
> extensions can arbitrarily transform the AST, it's not possible to
> understand any part of a program that uses extensions without
> understanding every aspect of the behaviour of every extension.  We
> could, of course, seek to solve this by convention and social
> pressure, but there seems to be an emerging consensus that this isn't
> really satisfactory.  One of the nice things about functional
> programming is that you have strong guarantees (via parametricity,
> immutability, and so on) about the effects of calling a particular
> function. We should strive to make it possible to reason in the same
> manner about the effects of syntax extensions.
>
> There are other legitimate concerns with the current proposal.  As
> Xavier Clerc and others point out, attributes are apparently
> undeclared (i.e. global) and untyped.  Alain rightly notes that it
> seems to be difficult to introduce declarations and types for
> attributes without significant complexity.  Still, as OCaml
> programmers we're used to the benefits of precisely-scoped names and
> strongly-typed data, and it seems a shame to give these benefits up if
> we can find a way to keep them.
>
> Hongbo Zhang raises a further concern: when syntax extensions are
> global transformations on the whole file, the order in which
> extensions are applied becomes significant.  This is a fairly serious
> matter, I think: the semantics of code that uses syntax extensions is
> now dependent on external factors, since we need to look for the flags
> passed to OCaml in the build configuration in order to understand the
> source.
>
> I think we can address all these concerns with a small adjustment in
> perspective.  Instead of globally-scoped, untyped attributes processed
> by file-level externally-specified transformations, we might add a
> single node to the OCaml grammar for statically-executed AST
> rewriters.  Using the same syntax already proposed for attributes, we
> might write, for example:
>
>    (@deriving ["sexp"; "json"])
>    type t = F of int | G of s
>     and s = H of (t * t)
>
> or
>
>     (@perform)
>        (x <-- m;
>         y <-- n;
>         return (x y))
>
> In order for this to be valid code, 'deriving' and 'perform' should
> resolve to functions of appropriate types:
>
>     val deriving : string list -> Parsetree.structure_item ->
> Parsetree.structure_item
>
>     val perform : Parsetree.expression -> Parsetree.expression
>
> Either during parsing or in a post parsing phase, the ASTs following
> '@deriving ["sexp"; "json"]' and '@perform' are passed to those
> functions and the results are inserted in place into the AST.
> Gabriel's concern is addressed, because there's no way for @perform
> (say) to access other parts of the AST: its effects are purely local.
> Xavier's concern is addressed, since AST rewriters, unlike attributes
> are declared and typed (and hence scoped). Hongbo's concern is
> addressed, since composition is explicit:
>
>     (@deriving ["sexp"])
>     (@nonrec)
>     type t = C of t
>
> (Here '@deriving ["sexp"]' is applied to the result of applying '@nonrec'.)
>
> It should be possible to write almost all extensions in this manner.
> A variant of the stream parser syntax fits easily:
>
>     (@parser)
>        ([ `If; x = expr; `Then; y = expr; `Else; z = expr ] => "if";
>         [ `Let; `Ident x; `Equal; x = expr; In; y = expr ] => "let")
>
> as does Anil's cstruct extension:
>
>     (@cstruct ~endianness:little)
>     type pcap_header = {
>        uint32_t magic_number;   (* magic number *)
>        uint16_t version_major;  (* major version number *)
>        ...
>     }
>
> Other extensions such as ifdef, js_of_ocaml, and pgsql could be
> handled in the same sort of way.
>
> Jeremy.
>
> [I'm deliberately avoiding the interesting but orthogonal questions of
> custom lexical syntax, and benign annotations for tools here.]
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>



-- 
-- Regards, Hongbo

--20cf3071ceacf1eb2b04d50363b5
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi, Jeremy,<div>=A0 =A0I like your ideas, ;-). Fan adopt the same approach =
as you proposed.</div><div>Instead of=A0</div><div>=A0=A0 =A0(@deriving [&q=
uot;sexp&quot;; &quot;json&quot;])<br>=A0 =A0type t =3D F of int | G of s<b=
r>=A0 =A0 and s =3D H of (t * t)<br>
<br>I used the notation</div><div>{:ocaml|</div><div>type t =3D F of int | =
G of s</div><div>and s =3D H of (t * t)</div><div>|}</div><div>{:derive| (s=
exp,json)|}</div><div>But the semantics are essentially the same,=A0</div><=
div>
should we take a serious look at Fan? As a much more advanced tool, Fan, co=
mpared with ppx, while it does not require any change to the compiler, and =
porting other camlp4 based library is much easier, I see a lot of benefits =
here.</div>
<div><br></div><div>If we change the compiler a lot for little benefit in t=
he internal compiler, that makes life too hard for more advanced tools, are=
 we a bit short-sighted here? I really like some other features like run-ti=
me types in the compiler instead, my 2 cents</div>
<div><br></div><div><br><div class=3D"gmail_quote">On Sat, Feb 2, 2013 at 1=
1:17 AM, Jeremy Yallop <span dir=3D"ltr">&lt;<a href=3D"mailto:yallop@gmail=
.com" target=3D"_blank">yallop@gmail.com</a>&gt;</span> wrote:<br><blockquo=
te class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc so=
lid;padding-left:1ex">
<div class=3D"im">On 1 February 2013 15:38, Gabriel Scherer &lt;<a href=3D"=
mailto:gabriel.scherer@gmail.com">gabriel.scherer@gmail.com</a>&gt; wrote:<=
br>
&gt; Finally, I think -ppx + arbitrary annotations, without any further<br>
&gt; restriction, is too free-form for robust syntax extensions: one<br>
&gt; important problem with Camlp4 is that it allowed syntax extension<br>
&gt; writers to modify the syntax in very bad way that hurt robustness. As<=
br>
&gt; already discussed, I have a strong distaste for extensions that only<b=
r>
&gt; piggyback on existing syntax (without adding any explicit marker); I<b=
r>
&gt; would feel safer if the extension *mechanism* disallowed such<br>
&gt; unstructured extensions, or at least made them less rewarding to write=
<br>
&gt; than the composable ones. (For example by only passing to the<br>
&gt; extension writer the part(s) of the AST that have been annotated).<br>
&gt; Unfortunately, I don&#39;t see how Bisect would fit any such restricti=
on.<br>
&gt; Maybe that&#39;s a problem best solved by socialization (writing a<br>
&gt; documentation on good practices, and yelling on people), but I sort of=
<br>
&gt; doubt it -- I don&#39;t know how many time I&#39;ve had to argue for *=
not*<br>
&gt; globally changing the associativity of infix operators through Camlp4<=
br>
&gt; in Batteries.<br>
<br>
</div>I agree with Gabriel. =A0Actually, I think that a small tweak to the<=
br>
design of -ppx could address both this and a number of problems that<br>
others have raised during the discussion here.<br>
<br>
The -ppx approach applies one or more global transformations to the<br>
ASTs of OCaml source files; these transformations can be parameterized<br>
by attributes attached at particular points in the syntax tree. =A0This<br>
is a significant improvement over the Camlp4 approach, largely because<br>
it exchanges the (unnecessary) ability to change the concrete syntax<br>
for a number of valuable guarantees, which make extensions easier to<br>
write and code that uses extensions easier to understand.<br>
<br>
We can go further in this direction, and give up more (unnecessary)<br>
power in return for further guarantees. =A0As Gabriel says, since -ppx<br>
extensions can arbitrarily transform the AST, it&#39;s not possible to<br>
understand any part of a program that uses extensions without<br>
understanding every aspect of the behaviour of every extension. =A0We<br>
could, of course, seek to solve this by convention and social<br>
pressure, but there seems to be an emerging consensus that this isn&#39;t<b=
r>
really satisfactory. =A0One of the nice things about functional<br>
programming is that you have strong guarantees (via parametricity,<br>
immutability, and so on) about the effects of calling a particular<br>
function. We should strive to make it possible to reason in the same<br>
manner about the effects of syntax extensions.<br>
<br>
There are other legitimate concerns with the current proposal. =A0As<br>
Xavier Clerc and others point out, attributes are apparently<br>
undeclared (i.e. global) and untyped. =A0Alain rightly notes that it<br>
seems to be difficult to introduce declarations and types for<br>
attributes without significant complexity. =A0Still, as OCaml<br>
programmers we&#39;re used to the benefits of precisely-scoped names and<br=
>
strongly-typed data, and it seems a shame to give these benefits up if<br>
we can find a way to keep them.<br>
<br>
Hongbo Zhang raises a further concern: when syntax extensions are<br>
global transformations on the whole file, the order in which<br>
extensions are applied becomes significant. =A0This is a fairly serious<br>
matter, I think: the semantics of code that uses syntax extensions is<br>
now dependent on external factors, since we need to look for the flags<br>
passed to OCaml in the build configuration in order to understand the<br>
source.<br>
<br>
I think we can address all these concerns with a small adjustment in<br>
perspective. =A0Instead of globally-scoped, untyped attributes processed<br=
>
by file-level externally-specified transformations, we might add a<br>
single node to the OCaml grammar for statically-executed AST<br>
rewriters. =A0Using the same syntax already proposed for attributes, we<br>
might write, for example:<br>
<br>
=A0 =A0(@deriving [&quot;sexp&quot;; &quot;json&quot;])<br>
=A0 =A0type t =3D F of int | G of s<br>
=A0 =A0 and s =3D H of (t * t)<br>
<br>
or<br>
<br>
=A0 =A0 (@perform)<br>
=A0 =A0 =A0 =A0(x &lt;-- m;<br>
=A0 =A0 =A0 =A0 y &lt;-- n;<br>
=A0 =A0 =A0 =A0 return (x y))<br>
<br>
In order for this to be valid code, &#39;deriving&#39; and &#39;perform&#39=
; should<br>
resolve to functions of appropriate types:<br>
<br>
=A0 =A0 val deriving : string list -&gt; Parsetree.structure_item -&gt;<br>
Parsetree.structure_item<br>
<br>
=A0 =A0 val perform : Parsetree.expression -&gt; Parsetree.expression<br>
<br>
Either during parsing or in a post parsing phase, the ASTs following<br>
&#39;@deriving [&quot;sexp&quot;; &quot;json&quot;]&#39; and &#39;@perform&=
#39; are passed to those<br>
functions and the results are inserted in place into the AST.<br>
Gabriel&#39;s concern is addressed, because there&#39;s no way for @perform=
<br>
(say) to access other parts of the AST: its effects are purely local.<br>
Xavier&#39;s concern is addressed, since AST rewriters, unlike attributes<b=
r>
are declared and typed (and hence scoped). Hongbo&#39;s concern is<br>
addressed, since composition is explicit:<br>
<br>
=A0 =A0 (@deriving [&quot;sexp&quot;])<br>
=A0 =A0 (@nonrec)<br>
=A0 =A0 type t =3D C of t<br>
<br>
(Here &#39;@deriving [&quot;sexp&quot;]&#39; is applied to the result of ap=
plying &#39;@nonrec&#39;.)<br>
<br>
It should be possible to write almost all extensions in this manner.<br>
A variant of the stream parser syntax fits easily:<br>
<br>
=A0 =A0 (@parser)<br>
=A0 =A0 =A0 =A0([ `If; x =3D expr; `Then; y =3D expr; `Else; z =3D expr ] =
=3D&gt; &quot;if&quot;;<br>
=A0 =A0 =A0 =A0 [ `Let; `Ident x; `Equal; x =3D expr; In; y =3D expr ] =3D&=
gt; &quot;let&quot;)<br>
<br>
as does Anil&#39;s cstruct extension:<br>
<br>
=A0 =A0 (@cstruct ~endianness:little)<br>
=A0 =A0 type pcap_header =3D {<br>
=A0 =A0 =A0 =A0uint32_t magic_number; =A0 (* magic number *)<br>
=A0 =A0 =A0 =A0uint16_t version_major; =A0(* major version number *)<br>
=A0 =A0 =A0 =A0...<br>
=A0 =A0 }<br>
<br>
Other extensions such as ifdef, js_of_ocaml, and pgsql could be<br>
handled in the same sort of way.<br>
<br>
Jeremy.<br>
<br>
[I&#39;m deliberately avoiding the interesting but orthogonal questions of<=
br>
custom lexical syntax, and benign annotations for tools here.]<br>
<div class=3D"HOEnZb"><div class=3D"h5">___________________________________=
____________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo
</div>

--20cf3071ceacf1eb2b04d50363b5--

From lpw25@hermes.cam.ac.uk  Wed Feb  6 13:00:35 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8116D3C04E
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Feb 2013 13:00:35 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:36691)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U34gh-0001jS-sj (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 06 Feb 2013 13:05:20 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U34gh-0000gu-UX (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 06 Feb 2013 13:05:19 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 06 Feb 2013 13:05:19 +0000
Date: 06 Feb 2013 13:05:19 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Yaron Minsky <yminsky@janestreet.com>
Message-ID: <Prayer.1.3.5.1302061305190.1975@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Feb 2013 13:00:35 -0000

On Feb 5 2013, Yaron Minsky wrote:

>Maybe a single post
>summarizing the main proposals and points of contention?

I'll try to post a summary this afternoon.

From lpw25@hermes.cam.ac.uk  Wed Feb  6 18:06:26 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D836E3C04E
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Feb 2013 18:06:26 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:48437)
 by ppsw-43.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U39Sj-0001TM-ms (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 06 Feb 2013 18:11:13 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U39Sj-0002Xa-4W (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 06 Feb 2013 18:11:13 +0000
Received: from [86.26.0.34] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 06 Feb 2013 18:11:12 +0000
Date: 06 Feb 2013 18:11:12 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Yaron Minsky <yminsky@janestreet.com>
Message-ID: <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
In-Reply-To: <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Feb 2013 18:06:26 -0000

> Maybe a single post
>summarizing the main proposals and points of contention?

I will attempt a summary of the parts of the discussion that I remember. In 
no particular order the following has been discussed:


1. Current uses of camlp4

 There were many examples of current uses of camlp4 given. Gabriel put a 
 summary of them on a wiki:

  https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases

 Anil also posted a list of all the extensions used by OPAM packages:

  https://github.com/avsm/opam-camlp4-analysis/wiki

 I don't think anyone has systematically gone through these yet, but I 
 think that it is important, before any concrete proposal is made by this 
 working group, to make clear which of these extensions we intend to 
 support and how we intend to support them.


2. New syntaxes needed for ppx:

 There seems to be general agreement that, for ppx to replace camlp4 for 
its
 most common uses, at least the following three kinds of syntax are needed:

 a) A "template" syntax along the lines of (:longid expr). This syntax 
    could be used as an expression, a pattern, a structure item, etc.
    For example Sedlex could be:
       (:sedlex
          match buf with
          | number -> ..
          | letter, Star ('A'..'Z' | 'a'..'z' | digit) -> ..
       )
 b) An "attribute" syntax along the lines of (@ expr). This syntax allows 
    you to attach expressions to other expressions, patterns, etc. Unlike 
    the template syntax, the type-checker can silently ignore any of these 
    that don't get translated. For example Bisect could be:

      let f x =
        match List.map foo [x; a x; b x] with
        | [y1; y2; y3] -> tata
        | _ -> (@ Bisect.visit) assert false

      (@ Bisect.ignore)
      let unused = ()
    
    It has also been suggested that there might need to be different syntax 
    for "post-fix" and "pre-fix". Gabriel suggested that whether an 
    attribute in a particular syntactic position is pre-fix or post-fix be 
    decided on a case by case basis.

 c) A quotation syntax like {x{ .. }x} (where x is any operator symbol) 
    that could be used for quoting non-OCaml syntax. For example sedlex 
    with a more compact notation for regular expressions:

      (:sedlex
         match lexbuf with
         | {{ xml_letter+ }} -> ...
         | {{ "with" }} -> ...
         | ...
      )

 There has also been some agreement, and no strong objection, to including 
 some abbreviated forms of the above syntaxes. Some of the suggested forms 
 include:

 a) Template + quotation: 
     {:id x{ str }x}  ==  (:id {x{ str }x})

 b) Template + let: 
      let:id x = .. in ...  ==  (:id let x = .. in ... )

 c) Template + match:
      match:id exp with ..  ==  (:id match exp with .. )

 d) Type-conv style attribute:
      type t = ... with foo, bar( expr ) == type t = ... (@foo) (@bar expr)

 e) Anonymous template:
      (# expr)  ==  (:(*no id*) expr)


3. Anti-quotations

 There has been some discussion about how to support anti-quotations:

 - Fabrice suggested using a standardised format for anti-quotations, but 
   some people were against that because they use "$" in their camlp4 
   quotation extensions.

   I suggested that if we provided functions which took a predicate 
   function and then parsed an OCaml phrase up until the next *unnested* 
   location that made the predicate true, then we could support general 
   anti-quotations for ppx.

 - Hongbo suggested that AST lifting was necessary for supporting 
   anti-quotations, citing this paper:

     http://dl.acm.org/citation.cfm?id=1291211

   I suggested that it isn't necessarily needed, and that if people wanted 
   it then it could be provided using a type-conv style extension or 
   run-time types.


4. On the use of "quotations"

 There has also been some discussion about when it is a good idea to use a 
 camlp4-style quasi-quotation:

 - Alain suggested that they should not be used for extensions that are 
   "mostly valid OCaml code". He pointed out that doing so causes you to 
   lose all editor and tool support.

   Hongbo disagreed saying that in Fan extensions like sedlex would be 
   implement as quasi-quotation and that editor support was fine.

   After this there seems to have been some agreement that it would be 
   better to implement such extensions as "templates" (see section 2 of 
   this post) rather than quasi-quotations.

 - Alain then went further, suggesting that quotations were not even 
   suitable for encoding foreign languages in OCaml.

   Gabriel disagreed, saying that for domain-specific foreign languages 
   (e.g. SQL) quotations allow you to have a domain expert maintain the 
   foreign code even if they didn't know OCaml.

   Other people also said that they liked using quotations for foreign 
   syntax.


5. Alternatives to ppx

 There have been some proposals for alternatives and variations to using 
 ppx for extensions:

 a) Hongbo suggests that his Fan project is a better alternative to camlp4 
    than ppx:

      https://github.com/bobzhang/Fan

 b) Xavier Clerc suggested that attributes might be declared and typed, as 
    in Java. So before an attribute could be used:

      (@ MyAnnot {a=1, b="two"})

    "MyAnnot" would have to be declared with fields "a" (of type "int") and 
    "b" (of type "string"). He points out that this may protect the user 
    from some typos and other obvious errors.

    Alain suggested that this would be a much more complicated system, and 
    might be too restrictive for some uses of attributes.

 c) Sebastien Mondet suggested that run-time types or dyntype might be 
    sufficient without ppx for many extensions.

    Markus Mottl pointed out that there are runtime performance 
    implications for using those solutions.

 d) Jeremy suggested that rather than implementing extensions as AST 
    transformers that operate over the whole AST they might be implemented 
    as transformers only for the part of the AST that they were to operate 
    on. So an extension used like this:

      (:perform
          x <-- m;
          y <-- n;
          return (x y))

    would be implemented as a function with type:

      val perform : Parsetree.expression -> Parsetree.expression

    He suggests that this may help with scoping, safety and 
    compositionality.

    Alain pointed out that some legitimate uses of ppx don't work nicely 
    with the constraint that they can operate only on a marked fragment. He 
    also pointed out that handling extensions as those extensions are found 
    within the source forces a top-down expansion order, which is not 
    necessarily desirable.

 e) I suggested an extension to Jeremy's proposal. This involves giving the 
    expansion functions in their own kind of file (".mlq" - compiled to 
    ".cmq"), referring to them using a namespace mechanism, and then having 
    the compiler itself perform the expansion of the extensions.

    There are more details in my blog post:

      http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html

    Since such a solution would take a while to implement, and since moving 
    an extension from ppx to it would be trivial, I proposed using ppx for 
    the short/medium term.

    I suggested that such a mechanism might improving tooling and make it 
    easier for average users to use extensions.

    Both Gabriel and Alain suggested that the use of namespaces might be 
    unnecessary and too heavyweight. Alain also questioned the need for 
    special ".mlq" files.


There are probably other parts of the discussion that I've forgotten. I'm 
sure someone will fill-in any important details I've missed.


From bobzhang1988@gmail.com  Wed Feb  6 18:43:52 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B3DCA3C04E
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Feb 2013 18:43:52 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1442501 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.176 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f176.google.com ([209.85.220.176]:59738)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U3A2y-000514-mk (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Wed, 06 Feb 2013 18:48:42 +0000
Received: by mail-vc0-f176.google.com with SMTP id fy27so1045511vcb.7
 for <wg-camlp4@lists.ocaml.org>; Wed, 06 Feb 2013 10:48:39 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=0Qj6TNWFvvdfVRnbBQx6zHBo8s6VmFCsAb1NPhXcPeg=;
 b=uH+ndjiqq/V77XEIF8VPvs+UM13GD49fehS6bUgFPS9xU+LdvK8ojc+XQSKggV9xi5
 Mrsqvbzt2kxGwxXvtuzSF6XZ4JYHYrIXokbHOz3IyusTu5byxgfXhll500kmz0EZZXaY
 n/W3j4EGJw6ZD82f4Jrk3kMzDdJl8kLkYicWMk+HcD/sdCwusjZ5WyPAskbh4+dtfurr
 YsUqzoS6Mof0bh91N3ZF9qjqafDRD1MavU/x6UTtTTY7CfXLyUJsu6fic/OhDh33jv66
 zOn1Ax+YMFm5SVt5rjF0soC34IUDXSZBDG8beyuk8e0Yj1KPvShEEvUjOD6dBMgLmpzE
 Aiwg==
MIME-Version: 1.0
X-Received: by 10.58.50.7 with SMTP id y7mr30895156ven.24.1360176519069; Wed,
 06 Feb 2013 10:48:39 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Wed, 6 Feb 2013 10:48:38 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
Date: Wed, 6 Feb 2013 13:48:38 -0500
X-Google-Sender-Auth: -48z5uy1sxC_LiPE7cg0CI1NPvg
Message-ID: <CANcqPu7QQDAwL3tTMOSbW2q5jhjtYpFF4SntH_NF336o9cOdLA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=089e0112c63a403e5104d512c6cc
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Feb 2013 18:43:52 -0000

--089e0112c63a403e5104d512c6cc
Content-Type: text/plain; charset=ISO-8859-1

Summarize of my suggestions:
   I wrote 3 blogs(http://hongboz.wordpress.com/) explaining  why Parsetree
is not an ideal candidate for meta-programming.
   I express my worries if ppx is widely used
   http://lists.ocaml.org/pipermail/wg-camlp4/2013-January/000140.html

   Some arguments why Fan is a better candidate than ppx
   1. Fan is much much faster than P4 (10~20 times)
   2. Fan does not require any compiler change, easy to distribute, on the
contrary the pervasive change to compiler is close to kill P4, Fan or any
other advanced external tools, unlike P4, it will
not inhibit OCaml's compiler's progress.
   3. It's easy to build in Fan, Fan can recognize its syntax on its own,
without external tool's help
   4. It's easy to port P4's code base to Fan, it only takes me 2 hours to
port Alain's ulex to Fan(I also make it available on the toplevel, this
feature is not available in sedlex or ulex)
   5. Global Ast Rewriter is available but discouraged
   6. Local Ast Rewriter is provided(deriving and type_conv conflicts will
never happen in Fan)
       {:ocaml| type u = A of int |}
       {:derive| (sexp,json) |}
   7. Fan's notation is uniform
       only {:| |} is introduced, I  am a bit headache when seeing so many
notations
   8. Fan provides first class parser lexer(or in-line parser/lexer) as a
library
   9. Last but not least, Compatibility is important
       If we are un-satisfied with a tool, the right approach is to find a
way to repair it, building something from scratch and discard the old tool
may not be wise.

On Wed, Feb 6, 2013 at 1:11 PM, Leo White <lpw25@cam.ac.uk> wrote:

> Maybe a single post
>> summarizing the main proposals and points of contention?
>>
>
> I will attempt a summary of the parts of the discussion that I remember.
> In no particular order the following has been discussed:
>
>
> 1. Current uses of camlp4
>
> There were many examples of current uses of camlp4 given. Gabriel put a
> summary of them on a wiki:
>
>  https://github.com/gasche/**ocaml-syntax-extension-**
> discussion/wiki/Use-Cases<https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases>
>
> Anil also posted a list of all the extensions used by OPAM packages:
>
>  https://github.com/avsm/opam-**camlp4-analysis/wiki<https://github.com/avsm/opam-camlp4-analysis/wiki>
>
> I don't think anyone has systematically gone through these yet, but I
> think that it is important, before any concrete proposal is made by this
> working group, to make clear which of these extensions we intend to support
> and how we intend to support them.
>
>
> 2. New syntaxes needed for ppx:
>
> There seems to be general agreement that, for ppx to replace camlp4 for its
> most common uses, at least the following three kinds of syntax are needed:
>
> a) A "template" syntax along the lines of (:longid expr). This syntax
>  could be used as an expression, a pattern, a structure item, etc.
>    For example Sedlex could be:
>       (:sedlex
>          match buf with
>          | number -> ..
>          | letter, Star ('A'..'Z' | 'a'..'z' | digit) -> ..
>       )
> b) An "attribute" syntax along the lines of (@ expr). This syntax allows
>  you to attach expressions to other expressions, patterns, etc. Unlike
>  the template syntax, the type-checker can silently ignore any of these
>  that don't get translated. For example Bisect could be:
>
>      let f x =
>        match List.map foo [x; a x; b x] with
>        | [y1; y2; y3] -> tata
>        | _ -> (@ Bisect.visit) assert false
>
>      (@ Bisect.ignore)
>      let unused = ()
>       It has also been suggested that there might need to be different
> syntax    for "post-fix" and "pre-fix". Gabriel suggested that whether an
>  attribute in a particular syntactic position is pre-fix or post-fix be
>  decided on a case by case basis.
>
> c) A quotation syntax like {x{ .. }x} (where x is any operator symbol)
>  that could be used for quoting non-OCaml syntax. For example sedlex
>  with a more compact notation for regular expressions:
>
>      (:sedlex
>         match lexbuf with
>         | {{ xml_letter+ }} -> ...
>         | {{ "with" }} -> ...
>         | ...
>      )
>
> There has also been some agreement, and no strong objection, to including
> some abbreviated forms of the above syntaxes. Some of the suggested forms
> include:
>
> a) Template + quotation:     {:id x{ str }x}  ==  (:id {x{ str }x})
>
> b) Template + let:      let:id x = .. in ...  ==  (:id let x = .. in ... )
>
> c) Template + match:
>      match:id exp with ..  ==  (:id match exp with .. )
>
> d) Type-conv style attribute:
>      type t = ... with foo, bar( expr ) == type t = ... (@foo) (@bar expr)
>
> e) Anonymous template:
>      (# expr)  ==  (:(*no id*) expr)
>
>
> 3. Anti-quotations
>
> There has been some discussion about how to support anti-quotations:
>
> - Fabrice suggested using a standardised format for anti-quotations, but
> some people were against that because they use "$" in their camlp4
> quotation extensions.
>
>   I suggested that if we provided functions which took a predicate
> function and then parsed an OCaml phrase up until the next *unnested*
> location that made the predicate true, then we could support general
> anti-quotations for ppx.
>
> - Hongbo suggested that AST lifting was necessary for supporting
> anti-quotations, citing this paper:
>
>     http://dl.acm.org/citation.**cfm?id=1291211<http://dl.acm.org/citation.cfm?id=1291211>
>
>   I suggested that it isn't necessarily needed, and that if people wanted
>   it then it could be provided using a type-conv style extension or
> run-time types.
>
>
> 4. On the use of "quotations"
>
> There has also been some discussion about when it is a good idea to use a
> camlp4-style quasi-quotation:
>
> - Alain suggested that they should not be used for extensions that are
> "mostly valid OCaml code". He pointed out that doing so causes you to
> lose all editor and tool support.
>
>   Hongbo disagreed saying that in Fan extensions like sedlex would be
> implement as quasi-quotation and that editor support was fine.
>
>   After this there seems to have been some agreement that it would be
> better to implement such extensions as "templates" (see section 2 of   this
> post) rather than quasi-quotations.
>
> - Alain then went further, suggesting that quotations were not even
> suitable for encoding foreign languages in OCaml.
>
>   Gabriel disagreed, saying that for domain-specific foreign languages
> (e.g. SQL) quotations allow you to have a domain expert maintain the
> foreign code even if they didn't know OCaml.
>
>   Other people also said that they liked using quotations for foreign
> syntax.
>
>
> 5. Alternatives to ppx
>
> There have been some proposals for alternatives and variations to using
> ppx for extensions:
>
> a) Hongbo suggests that his Fan project is a better alternative to camlp4
>    than ppx:
>
>      https://github.com/bobzhang/**Fan <https://github.com/bobzhang/Fan>
>
> b) Xavier Clerc suggested that attributes might be declared and typed, as
>    in Java. So before an attribute could be used:
>
>      (@ MyAnnot {a=1, b="two"})
>
>    "MyAnnot" would have to be declared with fields "a" (of type "int") and
>    "b" (of type "string"). He points out that this may protect the user
>  from some typos and other obvious errors.
>
>    Alain suggested that this would be a much more complicated system, and
>    might be too restrictive for some uses of attributes.
>
> c) Sebastien Mondet suggested that run-time types or dyntype might be
>  sufficient without ppx for many extensions.
>
>    Markus Mottl pointed out that there are runtime performance
>  implications for using those solutions.
>
> d) Jeremy suggested that rather than implementing extensions as AST
>  transformers that operate over the whole AST they might be implemented
>  as transformers only for the part of the AST that they were to operate
>  on. So an extension used like this:
>
>      (:perform
>          x <-- m;
>          y <-- n;
>          return (x y))
>
>    would be implemented as a function with type:
>
>      val perform : Parsetree.expression -> Parsetree.expression
>
>    He suggests that this may help with scoping, safety and
>  compositionality.
>
>    Alain pointed out that some legitimate uses of ppx don't work nicely
>  with the constraint that they can operate only on a marked fragment. He
>  also pointed out that handling extensions as those extensions are found
>  within the source forces a top-down expansion order, which is not
>  necessarily desirable.
>
> e) I suggested an extension to Jeremy's proposal. This involves giving the
>    expansion functions in their own kind of file (".mlq" - compiled to
>  ".cmq"), referring to them using a namespace mechanism, and then having
>  the compiler itself perform the expansion of the extensions.
>
>    There are more details in my blog post:
>
>      http://www.lpw25.net/2013/02/**05/camlp4-alternative-part-2.**html<http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html>
>
>    Since such a solution would take a while to implement, and since moving
>    an extension from ppx to it would be trivial, I proposed using ppx for
>  the short/medium term.
>
>    I suggested that such a mechanism might improving tooling and make it
>  easier for average users to use extensions.
>
>    Both Gabriel and Alain suggested that the use of namespaces might be
>  unnecessary and too heavyweight. Alain also questioned the need for
>  special ".mlq" files.
>
>
> There are probably other parts of the discussion that I've forgotten. I'm
> sure someone will fill-in any important details I've missed.
>
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>



-- 
-- Regards, Hongbo

--089e0112c63a403e5104d512c6cc
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Summarize of my suggestions:<div>=A0 =A0I wrote 3 blogs(<a href=3D"http://h=
ongboz.wordpress.com/">http://hongboz.wordpress.com/</a>) explaining =A0why=
 Parsetree is not an ideal candidate for meta-programming.</div><div>=A0 =
=A0I express my worries if ppx is widely used</div>
<div>=A0 =A0<a href=3D"http://lists.ocaml.org/pipermail/wg-camlp4/2013-Janu=
ary/000140.html">http://lists.ocaml.org/pipermail/wg-camlp4/2013-January/00=
0140.html</a></div><div>=A0=A0</div><div>=A0 =A0Some arguments why Fan is a=
 better candidate than ppx</div>
<div>=A0 =A01. Fan is much much faster than P4 (10~20 times)</div><div>=A0 =
=A02. Fan does not require any compiler change, easy to distribute, on the =
contrary the pervasive change to compiler is close to kill P4, Fan or any o=
ther advanced external tools, unlike P4, it will</div>
<div>not inhibit OCaml&#39;s compiler&#39;s progress.</div><div>=A0 =A03. I=
t&#39;s easy to build in Fan, Fan can recognize its syntax on its own, with=
out external tool&#39;s help</div><div>=A0 =A04. It&#39;s easy to port P4&#=
39;s code base to Fan, it only takes me 2 hours to port Alain&#39;s ulex to=
 Fan(I also make it available on the toplevel, this feature is not availabl=
e in sedlex or ulex)</div>
<div>=A0 =A05. Global Ast Rewriter is available but discouraged</div><div>=
=A0 =A06. Local Ast Rewriter is provided(deriving and type_conv conflicts w=
ill never happen in Fan)</div><div>=A0 =A0 =A0 =A0{:ocaml| type u =3D A of =
int |}</div><div>
=A0 =A0 =A0 =A0{:derive| (sexp,json) |}<br>=A0 =A07. Fan&#39;s notation is =
uniform</div><div>=A0 =A0 =A0 =A0only {:| |} is introduced, I =A0am a bit h=
eadache when seeing so many notations</div><div>=A0 =A08. Fan provides firs=
t class parser lexer(or in-line parser/lexer) as a library</div>
<div>=A0 =A09. Last but not least, Compatibility is important</div><div>=A0=
 =A0 =A0 =A0If we are un-satisfied with a tool, the right approach is to fi=
nd a way to repair it, building something from scratch and discard the old =
tool may not be wise.<br>
<br><div class=3D"gmail_quote">On Wed, Feb 6, 2013 at 1:11 PM, Leo White <s=
pan dir=3D"ltr">&lt;<a href=3D"mailto:lpw25@cam.ac.uk" target=3D"_blank">lp=
w25@cam.ac.uk</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" st=
yle=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<div class=3D"im"><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .=
8ex;border-left:1px #ccc solid;padding-left:1ex">
Maybe a single post<br>
summarizing the main proposals and points of contention?<br>
</blockquote>
<br></div>
I will attempt a summary of the parts of the discussion that I remember. In=
 no particular order the following has been discussed:<br>
<br>
<br>
1. Current uses of camlp4<br>
<br>
There were many examples of current uses of camlp4 given. Gabriel put a sum=
mary of them on a wiki:<br>
<br>
=A0<a href=3D"https://github.com/gasche/ocaml-syntax-extension-discussion/w=
iki/Use-Cases" target=3D"_blank">https://github.com/gasche/<u></u>ocaml-syn=
tax-extension-<u></u>discussion/wiki/Use-Cases</a><br>
<br>
Anil also posted a list of all the extensions used by OPAM packages:<br>
<br>
=A0<a href=3D"https://github.com/avsm/opam-camlp4-analysis/wiki" target=3D"=
_blank">https://github.com/avsm/opam-<u></u>camlp4-analysis/wiki</a><br>
<br>
I don&#39;t think anyone has systematically gone through these yet, but I t=
hink that it is important, before any concrete proposal is made by this wor=
king group, to make clear which of these extensions we intend to support an=
d how we intend to support them.<br>

<br>
<br>
2. New syntaxes needed for ppx:<br>
<br>
There seems to be general agreement that, for ppx to replace camlp4 for its=
<br>
most common uses, at least the following three kinds of syntax are needed:<=
br>
<br>
a) A &quot;template&quot; syntax along the lines of (:longid expr). This sy=
ntax =A0 =A0could be used as an expression, a pattern, a structure item, et=
c.<br>
=A0 =A0For example Sedlex could be:<br>
=A0 =A0 =A0 (:sedlex<br>
=A0 =A0 =A0 =A0 =A0match buf with<br>
=A0 =A0 =A0 =A0 =A0| number -&gt; ..<br>
=A0 =A0 =A0 =A0 =A0| letter, Star (&#39;A&#39;..&#39;Z&#39; | &#39;a&#39;..=
&#39;z&#39; | digit) -&gt; ..<br>
=A0 =A0 =A0 )<br>
b) An &quot;attribute&quot; syntax along the lines of (@ expr). This syntax=
 allows =A0 =A0you to attach expressions to other expressions, patterns, et=
c. Unlike =A0 =A0the template syntax, the type-checker can silently ignore =
any of these =A0 =A0that don&#39;t get translated. For example Bisect could=
 be:<br>

<br>
=A0 =A0 =A0let f x =3D<br>
=A0 =A0 =A0 =A0match List.map foo [x; a x; b x] with<br>
=A0 =A0 =A0 =A0| [y1; y2; y3] -&gt; tata<br>
=A0 =A0 =A0 =A0| _ -&gt; (@ Bisect.visit) assert false<br>
<br>
=A0 =A0 =A0(@ Bisect.ignore)<br>
=A0 =A0 =A0let unused =3D ()<br>
=A0 =A0 =A0 It has also been suggested that there might need to be differen=
t syntax =A0 =A0for &quot;post-fix&quot; and &quot;pre-fix&quot;. Gabriel s=
uggested that whether an =A0 =A0attribute in a particular syntactic positio=
n is pre-fix or post-fix be =A0 =A0decided on a case by case basis.<br>

<br>
c) A quotation syntax like {x{ .. }x} (where x is any operator symbol) =A0 =
=A0that could be used for quoting non-OCaml syntax. For example sedlex =A0 =
=A0with a more compact notation for regular expressions:<br>
<br>
=A0 =A0 =A0(:sedlex<br>
=A0 =A0 =A0 =A0 match lexbuf with<br>
=A0 =A0 =A0 =A0 | {{ xml_letter+ }} -&gt; ...<br>
=A0 =A0 =A0 =A0 | {{ &quot;with&quot; }} -&gt; ...<br>
=A0 =A0 =A0 =A0 | ...<br>
=A0 =A0 =A0)<br>
<br>
There has also been some agreement, and no strong objection, to including s=
ome abbreviated forms of the above syntaxes. Some of the suggested forms in=
clude:<br>
<br>
a) Template + quotation: =A0 =A0 {:id x{ str }x} =A0=3D=3D =A0(:id {x{ str =
}x})<br>
<br>
b) Template + let: =A0 =A0 =A0let:id x =3D .. in ... =A0=3D=3D =A0(:id let =
x =3D .. in ... )<br>
<br>
c) Template + match:<br>
=A0 =A0 =A0match:id exp with .. =A0=3D=3D =A0(:id match exp with .. )<br>
<br>
d) Type-conv style attribute:<br>
=A0 =A0 =A0type t =3D ... with foo, bar( expr ) =3D=3D type t =3D ... (@foo=
) (@bar expr)<br>
<br>
e) Anonymous template:<br>
=A0 =A0 =A0(# expr) =A0=3D=3D =A0(:(*no id*) expr)<br>
<br>
<br>
3. Anti-quotations<br>
<br>
There has been some discussion about how to support anti-quotations:<br>
<br>
- Fabrice suggested using a standardised format for anti-quotations, but =
=A0 some people were against that because they use &quot;$&quot; in their c=
amlp4 =A0 quotation extensions.<br>
<br>
=A0 I suggested that if we provided functions which took a predicate =A0 fu=
nction and then parsed an OCaml phrase up until the next *unnested* =A0 loc=
ation that made the predicate true, then we could support general =A0 anti-=
quotations for ppx.<br>

<br>
- Hongbo suggested that AST lifting was necessary for supporting =A0 anti-q=
uotations, citing this paper:<br>
<br>
=A0 =A0 <a href=3D"http://dl.acm.org/citation.cfm?id=3D1291211" target=3D"_=
blank">http://dl.acm.org/citation.<u></u>cfm?id=3D1291211</a><br>
<br>
=A0 I suggested that it isn&#39;t necessarily needed, and that if people wa=
nted =A0 it then it could be provided using a type-conv style extension or =
=A0 run-time types.<br>
<br>
<br>
4. On the use of &quot;quotations&quot;<br>
<br>
There has also been some discussion about when it is a good idea to use a c=
amlp4-style quasi-quotation:<br>
<br>
- Alain suggested that they should not be used for extensions that are =A0 =
&quot;mostly valid OCaml code&quot;. He pointed out that doing so causes yo=
u to =A0 lose all editor and tool support.<br>
<br>
=A0 Hongbo disagreed saying that in Fan extensions like sedlex would be =A0=
 implement as quasi-quotation and that editor support was fine.<br>
<br>
=A0 After this there seems to have been some agreement that it would be =A0=
 better to implement such extensions as &quot;templates&quot; (see section =
2 of =A0 this post) rather than quasi-quotations.<br>
<br>
- Alain then went further, suggesting that quotations were not even =A0 sui=
table for encoding foreign languages in OCaml.<br>
<br>
=A0 Gabriel disagreed, saying that for domain-specific foreign languages =
=A0 (e.g. SQL) quotations allow you to have a domain expert maintain the =
=A0 foreign code even if they didn&#39;t know OCaml.<br>
<br>
=A0 Other people also said that they liked using quotations for foreign =A0=
 syntax.<br>
<br>
<br>
5. Alternatives to ppx<br>
<br>
There have been some proposals for alternatives and variations to using ppx=
 for extensions:<br>
<br>
a) Hongbo suggests that his Fan project is a better alternative to camlp4 =
=A0 =A0than ppx:<br>
<br>
=A0 =A0 =A0<a href=3D"https://github.com/bobzhang/Fan" target=3D"_blank">ht=
tps://github.com/bobzhang/<u></u>Fan</a><br>
<br>
b) Xavier Clerc suggested that attributes might be declared and typed, as =
=A0 =A0in Java. So before an attribute could be used:<br>
<br>
=A0 =A0 =A0(@ MyAnnot {a=3D1, b=3D&quot;two&quot;})<br>
<br>
=A0 =A0&quot;MyAnnot&quot; would have to be declared with fields &quot;a&qu=
ot; (of type &quot;int&quot;) and =A0 =A0&quot;b&quot; (of type &quot;strin=
g&quot;). He points out that this may protect the user =A0 =A0from some typ=
os and other obvious errors.<br>

<br>
=A0 =A0Alain suggested that this would be a much more complicated system, a=
nd =A0 =A0might be too restrictive for some uses of attributes.<br>
<br>
c) Sebastien Mondet suggested that run-time types or dyntype might be =A0 =
=A0sufficient without ppx for many extensions.<br>
<br>
=A0 =A0Markus Mottl pointed out that there are runtime performance =A0 =A0i=
mplications for using those solutions.<br>
<br>
d) Jeremy suggested that rather than implementing extensions as AST =A0 =A0=
transformers that operate over the whole AST they might be implemented =A0 =
=A0as transformers only for the part of the AST that they were to operate =
=A0 =A0on. So an extension used like this:<br>

<br>
=A0 =A0 =A0(:perform<br>
=A0 =A0 =A0 =A0 =A0x &lt;-- m;<br>
=A0 =A0 =A0 =A0 =A0y &lt;-- n;<br>
=A0 =A0 =A0 =A0 =A0return (x y))<br>
<br>
=A0 =A0would be implemented as a function with type:<br>
<br>
=A0 =A0 =A0val perform : Parsetree.expression -&gt; Parsetree.expression<br=
>
<br>
=A0 =A0He suggests that this may help with scoping, safety and =A0 =A0compo=
sitionality.<br>
<br>
=A0 =A0Alain pointed out that some legitimate uses of ppx don&#39;t work ni=
cely =A0 =A0with the constraint that they can operate only on a marked frag=
ment. He =A0 =A0also pointed out that handling extensions as those extensio=
ns are found =A0 =A0within the source forces a top-down expansion order, wh=
ich is not =A0 =A0necessarily desirable.<br>

<br>
e) I suggested an extension to Jeremy&#39;s proposal. This involves giving =
the =A0 =A0expansion functions in their own kind of file (&quot;.mlq&quot; =
- compiled to =A0 =A0&quot;.cmq&quot;), referring to them using a namespace=
 mechanism, and then having =A0 =A0the compiler itself perform the expansio=
n of the extensions.<br>

<br>
=A0 =A0There are more details in my blog post:<br>
<br>
=A0 =A0 =A0<a href=3D"http://www.lpw25.net/2013/02/05/camlp4-alternative-pa=
rt-2.html" target=3D"_blank">http://www.lpw25.net/2013/02/<u></u>05/camlp4-=
alternative-part-2.<u></u>html</a><br>
<br>
=A0 =A0Since such a solution would take a while to implement, and since mov=
ing =A0 =A0an extension from ppx to it would be trivial, I proposed using p=
px for =A0 =A0the short/medium term.<br>
<br>
=A0 =A0I suggested that such a mechanism might improving tooling and make i=
t =A0 =A0easier for average users to use extensions.<br>
<br>
=A0 =A0Both Gabriel and Alain suggested that the use of namespaces might be=
 =A0 =A0unnecessary and too heavyweight. Alain also questioned the need for=
 =A0 =A0special &quot;.mlq&quot; files.<br>
<br>
<br>
There are probably other parts of the discussion that I&#39;ve forgotten. I=
&#39;m sure someone will fill-in any important details I&#39;ve missed.<div=
 class=3D"HOEnZb"><div class=3D"h5"><br>
<br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo
</div>

--089e0112c63a403e5104d512c6cc--

From alain.frisch@lexifi.com  Thu Feb  7 10:04:40 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 881263C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 10:04:40 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442869 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:49817
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U3OQ6-0003RA-sa (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 07 Feb 2013 10:09:31 +0000
Received: from [192.168.1.112] ([92.151.93.123]) by mwinf5d02 with ME
 id xN9V1k00F2fi5KQ03N9V3u; Thu, 07 Feb 2013 11:09:30 +0100
Message-ID: <51137D59.7050308@lexifi.com>
Date: Thu, 07 Feb 2013 11:09:29 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
 <CANcqPu7QQDAwL3tTMOSbW2q5jhjtYpFF4SntH_NF336o9cOdLA@mail.gmail.com>
In-Reply-To: <CANcqPu7QQDAwL3tTMOSbW2q5jhjtYpFF4SntH_NF336o9cOdLA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 10:04:40 -0000

On 02/06/2013 07:48 PM, Hongbo Zhang wrote:
>     Some arguments why Fan is a better candidate than ppx
>     1. Fan is much much faster than P4 (10~20 times)

This is great, in particular because it illustrates a vastly simplified 
bootstrapping procedure of Fan compared to Camlp4.  But this does not 
bring much to the comparison with ppx.

"-ppx" on its own is even faster to build, since there is nothing to 
build (it is just a command-line flag, in the same way as "-pp" on which 
Fan relies, I guess).

>     2. Fan does not require any compiler change, easy to distribute, on
> the contrary the pervasive change to compiler is close to kill P4, Fan
> or any other advanced external tools

ppx is already part of the development version and required minimal 
changes.  We are also discussing the addition of a few syntactic 
constructs which will only impact the definition of Parsetree and the 
official parser.  This cannot really be considered as a "pervasive 
change" to the compiler.

Can you elaborate on why you think this would kill Camlp4 or Fan?  I 
know from experience that Camlp4 is quite tedious to update when the 
concrete syntax of OCaml changes, but I'm sure someone will manage to 
update Camlp4/Fan definition of OCaml's AST and the associate parsers.

-ppx is compatible with pre-processors implemented with -pp 
(Camlp4/Fan), as long as those pre-processors can understand the new 
syntactic constructs and pass them back to OCaml.

 > unlike P4, it will
 > not inhibit OCaml's compiler's progress.

Your point above illustrates that it is not that simple: a simple 
addition to the OCaml syntax, which would normally require to adapt only
parser.mly, parsetree.mli, ast_mapper.ml/mli and a few other modules in 
the compilers, also requires to port the same changes to Fan's 
definition of the OCaml AST and to its parsers.

>     3. It's easy to build in Fan

Again, this seems more like a comparison between Fan and Camlp4 than 
between Fan and the ppx approach.

 > Fan can recognize its syntax on its
 > own, without external tool's help

How does this argument apply to the comparison with the ppx approach?


>     4. It's easy to port P4's code base to Fan, it only takes me 2 hours
> to port Alain's ulex to Fan

It did not take that much longer to port ulex from Camlp4 to -ppx, and 
as an extra added bonus, it really gave me the feeling that I could 
finally *breathe* and understand exactly what I'm writing. Frankly, I'm 
more comfortable writing:

   E.let_ Recursive states
     (E.sequence
        (appfun "Sedlexing.start" [eid lexbuf])
        (E.match_ (appfun (state_fun 0) [eid lexbuf])
           (cases @ [P.any (), error])
        )
     )

than:

   <:expr< fun lexbuf ->
     let rec $list:Array.to_list states$ in
     do { Ulexing.start lexbuf;
          match __ulex_state_0 lexbuf with
          [ $list:Array.to_list cases$ | _ -> raise Ulexing.Error ] } >>

which requires me to learn two new "sub-languages" (the revised syntax 
and the notion of quotation / antiquotation).  Imagine that the "rec" 
flag above should be set only according to some condition to be checked; 
I know directly how to write that in regular OCaml but I would need to 
dig into Camlp4 documentation (or not) to see how to introduce an 
"anti-quotation on the rec flag".

Is the code for the Fan version of ulex/sedlex available somewehere?


 > (I also make it available on the toplevel,
 > this feature is not available in sedlex or ulex)

sedlex works fine in the toplevel:

$ ocaml -ppx "ocamlfind sedlex/sedlex.exe"
         OCaml version 4.01.0+dev10-2012-10-16

# #use "topfind";;
- : unit = ()
Findlib has been successfully loaded. Additional directives:
...
# #require "sedlex";;
/home/afrisch/.opam/4.01.0dev+trunk/lib/sedlex: added to search path
/home/afrisch/.opam/4.01.0dev+trunk/lib/sedlex/sedlexing.cma: loaded
# let rec token buf =
   let ('a'..'z'|'A'..'Z') as letter = SEDLEX.regexp in
   let '0'..'9' as digit = SEDLEX.regexp in
   match SEDLEX buf with
   | Plus letter -> Printf.printf "Word %s\n" (Sedlexing.Latin1.lexeme 
buf); token buf
   | Plus digit -> Printf.printf "Number %s\n" (Sedlexing.Latin1.lexeme 
buf); token buf
   | _ -> failwith "Error"
               ;;
...
val token : Sedlexing.lexbuf -> 'a = <fun>
#


>     5. Global Ast Rewriter is available but discouraged
>     6. Local Ast Rewriter is provided(deriving and type_conv conflicts
> will never happen in Fan)
>         {:ocaml| type u = A of int |}
>         {:derive| (sexp,json) |}

Can you describe in more detail your position concerning the following 
points?

   - How do you deal with cases where the "expander" for such a local 
annotation needs to access the context of the AST fragment on which it 
applies, or where it needs to inject code non-locally?  For instance, 
several ulex/sedlex lexers specified in the same file will share code 
"partition function" (put at the beginning of the compilation unit in 
this case).

  - How would you support "ignorable" attributes, e.g. information 
targeted to specific tools like bisect or a variant ocamldoc based on 
structured comments?

  - How would you support a simple macro system?  For instance, I can 
imagine to use -ppx to do something like:

    let(:macro) if_debug x =
      if !debug_mode then (print_endline "DEBUG:"; x)

    let debug_mode = ref false

    ....

    if_debug (print_endline "XXX")

    What would be the Fan equivalent of it?

  - Imagine that two type-conv-like extensions need to be applied on the 
same type declaration, and detect attributes put on type expressions in it:

     type foo =
           {
             quantity: float (@xml ~digits:2) (@bin single);
             code: string (@xml ~cdata) (@bin base64);
           }
          (@xml) (@bin)

  (here we have two annotations "xml" and "bin" on the type declaration 
"foo", understood by two independent tools which generate marshaling 
code based the declaration, and interpret annotations on inner type 
expressions to customize the format)

  How do you write that in Fan?  My understanding is that one the 
expanders will be applied first and it will need to parse the type 
declaration itself; but what will it do with attributes intended to be 
used by the other extension?

  - Can you confirm that the content .... of {:foo| .... |} is passed as 
an unparsed string to the expander "foo"?  If this is the case, what is 
your position concerning support from editor?  Should they treat .... 
like OCaml code (e.g. applying lexing rules for coloring and grammar 
rules for indentation)?  If so, this syntax will not work well with 
fragments of code in a foreign syntax, and could potentially lead to 
broken editor behavior.  If not, you loose all support from your editor 
as soon as your are in the scope of an expander.  Or maybe do you 
envision a much ambitious proposal where the editor would somehow need 
to run the expander "on the fly" (I don't believe this is possible at a 
reasonable cost).  Another question: how is the end marker |} detected? 
  Can you write e.g.:

    {:html|
      <p>I <em>really</em> like <b>Fan</b> syntax, and especially
      its terminator |}
    |}

>     7. Fan's notation is uniform
>         only {:| |} is introduced, I  am a bit headache when seeing so
> many notations

I claim that this single notation corresponds to three different 
concepts which deserve to be understood separately:

   - Extension marker around a parsed fragment, to be interpreted by an 
expander (otherwise the type-checker fails).

   - Attributes attached on AST fragments, to be (optionally) 
interpreted by tools like Bisect, by expanders, or which can trigger 
themselves local rewritings (in that case, one might want a specific 
syntax to ensure they won't be silently ignored by the type-checker).

   - Quotations: a way to write fragment of code in a foreign syntax, by 
escaping from OCaml lexical conventions on string literals.  (I believe 
this is rather orthogonal to -ppx and might be useful for regular 
libraries, but I accept the idea of a combined notation: extension 
marker + quotation.)

>     8. Fan provides first class parser lexer(or in-line parser/lexer) as
> a library

I claim that most interesting uses of camlp4 extensions around can be 
implemented in a way which does not require any extra lexing/parsing 
technology in addition to what's included in the core compiler today 
(based on ocamllex/ocamlyacc).  (The only exceptions seem to be these 
extensions which need to parse foreign syntax, and I find it good that 
they can rely on an arbitrary parsing technology.)






Alain

From info@gerd-stolpmann.de  Thu Feb  7 13:11:39 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id ACF8B3C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 13:11:39 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442869 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.187 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.187]:56960)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U3RL4-0006U8-pB (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Thu, 07 Feb 2013 13:16:31 +0000
Received: from office1.lan.sumadev.de (dslb-084-059-074-050.pools.arcor-ip.net
 [84.59.74.50])
 by mrelayeu.kundenserver.de (node=mrbap0) with ESMTP (Nemesis)
 id 0LobEI-1UZlHs09hC-00gNxu; Thu, 07 Feb 2013 14:16:18 +0100
Received: from samsung (546BF816.cm-12-4d.dynamic.ziggo.nl [84.107.248.22])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 33814C00CF;
 Thu,  7 Feb 2013 14:16:17 +0100 (CET)
Date: Thu, 07 Feb 2013 14:16:14 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Alain Frisch <alain.frisch@lexifi.com>
In-Reply-To: <51137D59.7050308@lexifi.com> (from alain.frisch@lexifi.com on
 Thu Feb  7 11:09:29 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1360242974.18230.7@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:LvrEtWTbb65D0Sy/LWhuDdr6eyDfvRZk50t5AAUwMqh
 UWIAP8PPkecD0e4+AEuokx8QCBNJEViI7bOQVEoWsu4k8EQ+M3
 Tasn8xwlbax4SCpp4uU+vWh01dywCx+FhTiSFQIvKxJFc3Qh7t
 W5/rsDqFQKDtR7X9l6nj/holJt3wvfEyU0a5+tfK5K1TecUiKf
 NUSDZwzIr2xoTORiZxR5s5SpsqEwL2SUPgNbA9LQ3H9b+aO8qZ
 BqajRtUrk5k/tIeAoWa+A9txxoNOKEwYSrwp4PQH4BUK50n6Ux
 lc5b7KLPQknaxypOI6mSUUfEncjL6p5vJlvjDFWtz2PJnwkmuZ
 k+Z7ege9SrYji2YYPIOY=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 13:11:39 -0000

Am 07.02.2013 11:09:29 schrieb(en) Alain Frisch:
>>     4. It's easy to port P4's code base to Fan, it only takes me 2 =20
>> hours
>> to port Alain's ulex to Fan
>=20
> It did not take that much longer to port ulex from Camlp4 to -ppx, =20
> and as an extra added bonus, it really gave me the feeling that I =20
> could finally *breathe* and understand exactly what I'm writing. =20
> Frankly, I'm more comfortable writing:
>=20
>   E.let_ Recursive states
>     (E.sequence
>        (appfun "Sedlexing.start" [eid lexbuf])
>        (E.match_ (appfun (state_fun 0) [eid lexbuf])
>           (cases @ [P.any (), error])
>        )
>     )
>=20
> than:
>=20
>   <:expr< fun lexbuf ->
>     let rec $list:Array.to_list states$ in
>     do { Ulexing.start lexbuf;
>          match __ulex_state_0 lexbuf with
>          [ $list:Array.to_list cases$ | _ -> raise Ulexing.Error ] =20
> } >>
>=20
> which requires me to learn two new "sub-languages" (the revised =20
> syntax and the notion of quotation / antiquotation).

Frankly, this is a quite subjective experience. For me (and many =20
developers who are not familiar with parsetrees) there is not much =20
difference doing either. Of course, the revised syntax is an extra =20
hurdle.

Currently, there is no documentation about parsetrees, and I would need =20
to guess how they are built up. But if there was some documentation =20
plus some examples it would probably be fully acceptable.

>  Imagine that the "rec" flag above should be set only according to =20
> some condition to be checked; I know directly how to write that in =20
> regular OCaml but I would need to dig into Camlp4 documentation (or =20
> not) to see how to introduce an "anti-quotation on the rec flag".

My guess here is that this is not directly possible, and you need to =20
program two independent cases (if rec_flag then <:expr< ...>> else =20
<:expr< ...>>). This is the price for an extra abstraction, but you =20
also get something back: if, for some reason, the parsetree changes and =20
let rec gets a variant of its own, you don't need to change the program.

"let rec" might be a bad example, because such a change is not =20
expected, but generally we _will_ run into the problem that changes of =20
the parsetree type break ppx processors. (Well, to some degree we can =20
avoid this by having wrapper functions, i.e. don't use E.let_ directly, =20
but a function mk_let, as then many changes can be done in a way that =20
doesn't affect compatibility.)

Gerd
--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From bobzhang1988@gmail.com  Thu Feb  7 14:51:33 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 23B413C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 14:51:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1442869 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.174 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f174.google.com ([209.85.220.174]:41290)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U3Stj-0004xr-YI (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 07 Feb 2013 14:56:25 +0000
Received: by mail-vc0-f174.google.com with SMTP id n11so1667578vch.5
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Feb 2013 06:56:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=uCk08ST+yijrFX81FUjQMzro392FySGs4B5VufIWMfM=;
 b=rIUkNemg7o6IS+kgLeroK4TuL5T49NA+GVY2WJ28O36/cest+ba/N9r14tfetqr9LB
 o9FqzVxYRbO+gGkBDGDt+KJZ/dBsonB/zACaM8Xd8HuzY6xdUbI6a3u+axjC5lg8i/0T
 Tr5Vhm4dStqyPmGzcncT0Okvwnpo1YuVgmlgENK1YedRH2o500jcya8RZg2u+emc+c30
 h15UqYE7HbCcvhwmqMC2QuwhZ/8+BJiTxaC2+DqeUAusuGVUQVVj4HXYBmxq0P+Df0hx
 GEkCiv0jLqHENtSOgaECCzJyy/72w/OcW1yc2XRXy7XaNvxC5Uiu+iMlOY3TyMypbTxV
 blnA==
MIME-Version: 1.0
X-Received: by 10.220.241.80 with SMTP id ld16mr2006669vcb.5.1360248982885;
 Thu, 07 Feb 2013 06:56:22 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Thu, 7 Feb 2013 06:56:22 -0800 (PST)
In-Reply-To: <51137D59.7050308@lexifi.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
 <CANcqPu7QQDAwL3tTMOSbW2q5jhjtYpFF4SntH_NF336o9cOdLA@mail.gmail.com>
 <51137D59.7050308@lexifi.com>
Date: Thu, 7 Feb 2013 09:56:22 -0500
X-Google-Sender-Auth: i0G1GbfkNh2Z1P-QTPB74LnyoRc
Message-ID: <CANcqPu7eG0v16GXkzz0kaQ66KLGT-sVGRTpYeVt9bHmr+eSUoA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/mixed; boundary=14dae9cfc8506e55fa04d523a5ac
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 14:51:33 -0000

--14dae9cfc8506e55fa04d523a5ac
Content-Type: multipart/alternative; boundary=14dae9cfc8506e55f604d523a5aa

--14dae9cfc8506e55f604d523a5aa
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Feb 7, 2013 at 5:09 AM, Alain Frisch <alain.frisch@lexifi.com>
wrote:
>
>
> "-ppx" on its own is even faster to build, since there is nothing to
build (it is just a command-line flag, in the same way as "-pp" on which
Fan relies, I guess).

Not always, as I pointed out, as long as you combine several global Ast
Rewriter, I am  optimistic that Fan has a great chance to outperform
ppx.(currently with respect to the compiling performance, Fan is on par
with ocamlc.opt directly, slightly slower)
>
>
>
>>     2. Fan does not require any compiler change, easy to distribute, on
>> the contrary the pervasive change to compiler is close to kill P4, Fan
>> or any other advanced external tools
>
>
> ppx is already part of the development version and required minimal
changes.  We are also discussing the addition of a few syntactic constructs
which will only impact the definition of Parsetree and the official parser.
 This cannot really be considered as a "pervasive change" to the compiler.
>
> Can you elaborate on why you think this would kill Camlp4 or Fan?  I know
from experience that Camlp4 is quite tedious to update when the concrete
syntax of OCaml changes, but I'm sure someone will manage to update
Camlp4/Fan definition of OCaml's AST and the associate parsers.
>
> -ppx is compatible with pre-processors implemented with -pp (Camlp4/Fan),
as long as those pre-processors can understand the new syntactic constructs
and pass them back to OCaml.
>
Well, things are always possible, but just too difficult in some cases,
remember that (Camlp4/Camlp5/Fan) preprocess the intermediate Ast, if we
clutter Parsetree too much, like adding some attributes node per syntax
category and ignored by the compiler later, which may require all other
tools to mix Intermediate Ast with Parsetree, it's always possible, just
too hard. I am perfectly fine with ppx so far, and I am happy to see bisect
switch to ppx, because global Ast Rewriter happen to be very fit there, but
 if we try to make everything possible in ppx, there's a large chance that
it will result in a ugly design in the compiler.
>
>
> > unlike P4, it will
> > not inhibit OCaml's compiler's progress.
>
> Your point above illustrates that it is not that simple: a simple
addition to the OCaml syntax, which would normally require to adapt only
> parser.mly, parsetree.mli, ast_mapper.ml/mli and a few other modules in
the compilers, also requires to port the same changes to Fan's definition
of the OCaml AST and to its parsers.
> ]

I think the amount of work is similar, the only difference is that we
maintain the change ast2pt.ml(dump intermediate ast into parsetree), it's
just a piece of cake, and we don't need to maintain ast_mapper, since it is
generated automatically in Fan. For the fan ast, we have tools
   {|derive(Map2
      Fold2 OIter MetaExpr MetaPatt Map Fold Print OPrint OEq
      GenLoc  Strip ) |}
for FanAst, suppose in one day you have those tools for parsetree, the
maintenance will
be a nightmare.

>>     4. It's easy to port P4's code base to Fan, it only takes me 2 hours
>> to port Alain's ulex to Fan
>
>
> It did not take that much longer to port ulex from Camlp4 to -ppx, and as
an extra added bonus, it really gave me the feeling that I could finally
*breathe* and understand exactly what I'm writing. Frankly, I'm more
comfortable writing:
>
>   E.let_ Recursive states
>     (E.sequence
>        (appfun "Sedlexing.start" [eid lexbuf])
>        (E.match_ (appfun (state_fun 0) [eid lexbuf])
>           (cases @ [P.any (), error])
>        )
>     )
>
> than:
>
>   <:expr< fun lexbuf ->
>     let rec $list:Array.to_list states$ in
>     do { Ulexing.start lexbuf;
>          match __ulex_state_0 lexbuf with
>          [ $list:Array.to_list cases$ | _ -> raise Ulexing.Error ] } >>
>
> which requires me to learn two new "sub-languages" (the revised syntax
and the notion of quotation / antiquotation).  Imagine that the "rec" flag
above should be set only according to some condition to be checked; I know
directly how to write that in regular OCaml but I would need to dig into
Camlp4 documentation (or not) to see how to introduce an "anti-quotation on
the rec flag".

Here, this happens to hit the sweet spot of quosi-quotation, first, I agree
that the revised syntax should be adapted to original syntax, and that's
part of my on-going work.
Let me explain a bit why quosi-quotation is superb here:
1. It quickly goes into my muscle memory, because I write ocaml everyday
(not parsetree), it's just my *intuition* that the Ast should be
constructed that way, and I don't need to remember those alien function
names, to be honest, I don't know what's the module E here. If I want to
make a piece of code into data, I just need to quote them, add "{:expr||}"
surrounding them, that's all. How would that happen in your "E" module?
2. The E module seems to be a bit magic here, but Fan's quosiquotation
works very nice with Emacs or any decent IDE, just like slime for lisp, I
type one key in my Emacs, it just expand the code explicitly(I attached the
result), but it's never going to happen with your "E" module, since it
requires *explicit multiple staging*.
3. For the parsetree, if you want to do syntactic grep over bigarray, you
will get into much trouble:
   ({pexp_desc=Pexp_ident
                    {txt= Ldot (Ldot (Lident "Bigarray", array),
("get"|"set" as gs)) ;_};_}
   This does not solve the problem at all, since it can not discriminate
"a.{b,c}" from "Bigarray.get a b c " in Fan, you only need to do say
   "`Bigarray (a,b,c)"
   There are so many syntax desugaring in the parsetree that I don't know
where to stop.

>>     5. Global Ast Rewriter is available but discouraged
>>     6. Local Ast Rewriter is provided(deriving and type_conv conflicts
>> will never happen in Fan)
>>         {:ocaml| type u = A of int |}
>>         {:derive| (sexp,json) |}
>
>
> Can you describe in more detail your position concerning the following
points?
>
If it can be implemented by ppx, it can be straightforwardly translated
into Fan, since ppx is simply a tiny proper subset of Fan(the part of
global Ast Rewriter). There are so many great ideas proposed here that I
would shamelessly steal into Fan even without bothering any change to the
compiler. Fan provides first class parser/lexer(or in-line parser lexer),
which is good, and there are people who appreciate it(
https://sympa.inria.fr/sympa/arc/caml-list/2013-02/msg00020.html), john
harrop even claims that "Parsers written using Camlp4 are nicer than with
any other tool I have ever used", but users are not locked in specific
parsing technology, it's perfectly fine if you want to use either menhir or
ocamlyacc.


--
-- Regards, Hongbo

--14dae9cfc8506e55f604d523a5aa
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br>On Thu, Feb 7, 2013 at 5:09 AM, Alain Frisch &lt;<a href=3D"mailto:=
alain.frisch@lexifi.com">alain.frisch@lexifi.com</a>&gt; wrote:<br>&gt;<br>=
&gt;<br>&gt; &quot;-ppx&quot; on its own is even faster to build, since the=
re is nothing to build (it is just a command-line flag, in the same way as =
&quot;-pp&quot; on which Fan relies, I guess).<br>
<br>Not always, as I pointed out, as long as you combine several global Ast=
 Rewriter, I am =A0optimistic that Fan has a great chance to outperform ppx=
.(currently with respect to the compiling performance, Fan is on par with o=
camlc.opt directly, slightly slower)<br>
&gt;<br>&gt;<br>&gt;<br>&gt;&gt; =A0 =A0 2. Fan does not require any compil=
er change, easy to distribute, on<br>&gt;&gt; the contrary the pervasive ch=
ange to compiler is close to kill P4, Fan<br>&gt;&gt; or any other advanced=
 external tools<br>
&gt;<br>&gt;<br>&gt; ppx is already part of the development version and req=
uired minimal changes. =A0We are also discussing the addition of a few synt=
actic constructs which will only impact the definition of Parsetree and the=
 official parser. =A0This cannot really be considered as a &quot;pervasive =
change&quot; to the compiler.<br>
&gt;<br>&gt; Can you elaborate on why you think this would kill Camlp4 or F=
an? =A0I know from experience that Camlp4 is quite tedious to update when t=
he concrete syntax of OCaml changes, but I&#39;m sure someone will manage t=
o update Camlp4/Fan definition of OCaml&#39;s AST and the associate parsers=
.<br>
&gt;<br>&gt; -ppx is compatible with pre-processors implemented with -pp (C=
amlp4/Fan), as long as those pre-processors can understand the new syntacti=
c constructs and pass them back to OCaml.<br>&gt;<br>Well, things are alway=
s possible, but just too difficult in some cases, remember that (Camlp4/Cam=
lp5/Fan) preprocess the intermediate Ast, if we clutter Parsetree too much,=
 like adding some attributes node per syntax category and ignored by the co=
mpiler later, which may require all other tools to mix Intermediate Ast wit=
h Parsetree, it&#39;s always possible, just too hard. I am perfectly fine w=
ith ppx so far, and I am happy to see bisect switch to ppx, because global =
Ast Rewriter happen to be very fit there, but =A0if we try to make everythi=
ng possible in ppx, there&#39;s a large chance that it will result in a ugl=
y design in the compiler.<br>
&gt;<br>&gt;<br>&gt; &gt; unlike P4, it will<br>&gt; &gt; not inhibit OCaml=
&#39;s compiler&#39;s progress.<br>&gt;<br>&gt; Your point above illustrate=
s that it is not that simple: a simple addition to the OCaml syntax, which =
would normally require to adapt only<br>
&gt; parser.mly, parsetree.mli, <a href=3D"http://ast_mapper.ml/mli">ast_ma=
pper.ml/mli</a> and a few other modules in the compilers, also requires to =
port the same changes to Fan&#39;s definition of the OCaml AST and to its p=
arsers.<br>
&gt; ]<br><br>I think the amount of work is similar, the only difference is=
 that we maintain the change <a href=3D"http://ast2pt.ml">ast2pt.ml</a>(dum=
p intermediate ast into parsetree), it&#39;s just a piece of cake, and we d=
on&#39;t need to maintain ast_mapper, since it is generated automatically i=
n Fan. For the fan ast, we have tools<br>
=A0 =A0{|derive(Map2<br>=A0 =A0 =A0 Fold2 OIter MetaExpr MetaPatt Map Fold =
Print OPrint OEq<br>=A0 =A0 =A0 GenLoc =A0Strip ) |}<br>for FanAst, suppose=
 in one day you have those tools for parsetree, the maintenance will<br>be =
a nightmare. <br>
<br>&gt;&gt; =A0 =A0 4. It&#39;s easy to port P4&#39;s code base to Fan, it=
 only takes me 2 hours<br>&gt;&gt; to port Alain&#39;s ulex to Fan<br>&gt;<=
br>&gt;<br>&gt; It did not take that much longer to port ulex from Camlp4 t=
o -ppx, and as an extra added bonus, it really gave me the feeling that I c=
ould finally *breathe* and understand exactly what I&#39;m writing. Frankly=
, I&#39;m more comfortable writing:<br>
&gt;<br>&gt; =A0 E.let_ Recursive states<br>&gt; =A0 =A0 (E.sequence<br>&gt=
; =A0 =A0 =A0 =A0(appfun &quot;Sedlexing.start&quot; [eid lexbuf])<br>&gt; =
=A0 =A0 =A0 =A0(E.match_ (appfun (state_fun 0) [eid lexbuf])<br>&gt; =A0 =
=A0 =A0 =A0 =A0 (cases @ [P.any (), error])<br>
&gt; =A0 =A0 =A0 =A0)<br>&gt; =A0 =A0 )<br>&gt;<br>&gt; than:<br>&gt;<br>&g=
t; =A0 &lt;:expr&lt; fun lexbuf -&gt;<br>&gt; =A0 =A0 let rec $list:Array.t=
o_list states$ in<br>&gt; =A0 =A0 do { Ulexing.start lexbuf;<br>&gt; =A0 =
=A0 =A0 =A0 =A0match __ulex_state_0 lexbuf with<br>
&gt; =A0 =A0 =A0 =A0 =A0[ $list:Array.to_list cases$ | _ -&gt; raise Ulexin=
g.Error ] } &gt;&gt;<br>&gt;<br>&gt; which requires me to learn two new &qu=
ot;sub-languages&quot; (the revised syntax and the notion of quotation / an=
tiquotation). =A0Imagine that the &quot;rec&quot; flag above should be set =
only according to some condition to be checked; I know directly how to writ=
e that in regular OCaml but I would need to dig into Camlp4 documentation (=
or not) to see how to introduce an &quot;anti-quotation on the rec flag&quo=
t;.<br>
<br>Here, this happens to hit the sweet spot of quosi-quotation, first, I a=
gree that the revised syntax should be adapted to original syntax, and that=
&#39;s part of my on-going work.<br>Let me explain a bit why quosi-quotatio=
n is superb here:<br>
1. It quickly goes into my muscle memory, because I write ocaml everyday (n=
ot parsetree), it&#39;s just my <b>intuition</b> that the Ast should be con=
structed that way, and I don&#39;t need to remember those alien function na=
mes, to be honest, I don&#39;t know what&#39;s the module E here. If I want=
 to make a piece of code into data, I just need to quote them, add &quot;{:=
expr||}&quot; surrounding them, that&#39;s all. How would that happen in yo=
ur &quot;E&quot; module?<br>
2. The E module seems to be a bit magic here, but Fan&#39;s quosiquotation =
works very nice with Emacs or any decent IDE, just like slime for lisp, I t=
ype one key in my Emacs, it just expand the code explicitly(I attached the =
result), but it&#39;s never going to happen with your &quot;E&quot; module,=
 since it requires <b>explicit multiple staging</b>.<br>
3. For the parsetree, if you want to do syntactic grep over bigarray, you w=
ill get into much trouble:<br>=A0 =A0({pexp_desc=3DPexp_ident<br>=A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 {txt=3D Ldot (Ldot (Lident &quot;Bigarray&q=
uot;, array), (&quot;get&quot;|&quot;set&quot; as gs)) ;_};_}<br>
=A0 =A0This does not solve the problem at all, since it can not discriminat=
e &quot;a.{b,c}&quot; from &quot;Bigarray.get a b c &quot; in Fan, you only=
 need to do say<br>=A0 =A0&quot;`Bigarray (a,b,c)&quot;<br>=A0 =A0There are=
 so many syntax desugaring in the parsetree that I don&#39;t know where to =
stop.<br>
<br>&gt;&gt; =A0 =A0 5. Global Ast Rewriter is available but discouraged<br=
>&gt;&gt; =A0 =A0 6. Local Ast Rewriter is provided(deriving and type_conv =
conflicts<br>&gt;&gt; will never happen in Fan)<br>&gt;&gt; =A0 =A0 =A0 =A0=
 {:ocaml| type u =3D A of int |}<br>
&gt;&gt; =A0 =A0 =A0 =A0 {:derive| (sexp,json) |}<br>&gt;<br>&gt;<br>&gt; C=
an you describe in more detail your position concerning the following point=
s?<br>&gt;<br>If it can be implemented by ppx, it can be straightforwardly =
translated into Fan, since ppx is simply a tiny proper subset of Fan(the pa=
rt of global Ast Rewriter). There are so many great ideas proposed here tha=
t I would shamelessly steal into Fan even without bothering any change to t=
he compiler. Fan provides first class parser/lexer(or in-line parser lexer)=
, which is good, and there are people who appreciate it(<a href=3D"https://=
sympa.inria.fr/sympa/arc/caml-list/2013-02/msg00020.html">https://sympa.inr=
ia.fr/sympa/arc/caml-list/2013-02/msg00020.html</a>), john harrop even clai=
ms that &quot;<span style=3D"color:rgb(51,51,51);font-family:&#39;Trebuchet=
 MS&#39;,Myriad,&#39;Gill Sans&#39;,&#39;Century Gothic&#39;,&#39;Bitstream=
 Vera Sans&#39;,verdana,lucida,arial,helvetica,sans-serif;font-size:11.1999=
99809265137px;background-color:rgb(255,255,255)">Parsers written=A0</span><=
span style=3D"color:rgb(51,51,51);font-family:&#39;Trebuchet MS&#39;,Myriad=
,&#39;Gill Sans&#39;,&#39;Century Gothic&#39;,&#39;Bitstream Vera Sans&#39;=
,verdana,lucida,arial,helvetica,sans-serif;font-size:11.199999809265137px;b=
ackground-color:rgb(255,255,255)">using Camlp4 are nicer than with any othe=
r tool I have ever used&quot;</span>, but users are not locked in specific =
parsing technology, it&#39;s perfectly fine if you want to use either menhi=
r or ocamlyacc.<br>
<br><br>--<br>-- Regards, Hongbo

--14dae9cfc8506e55f604d523a5aa--
--14dae9cfc8506e55fa04d523a5ac
Content-Type: application/octet-stream; name="tmp.ml"
Content-Disposition: attachment; filename="tmp.ml"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hcw143wy0

bGV0IF8gPQogIGBGdW4KICAgIChfbG9jLAogICAgICAoYENhc2UKICAgICAgICAgKF9sb2MsIChg
SWQgKF9sb2MsIChgTGlkIChfbG9jLCAibGV4YnVmIikpKSksIChgTmlsIF9sb2MpLAogICAgICAg
ICAgIChgTGV0SW4KICAgICAgICAgICAgICAoX2xvYywgKGBSZU5pbCBfbG9jKSwgKEZhbkFzdC5h
bmRfb2ZfbGlzdCB0YWJsZXMpLAogICAgICAgICAgICAgICAgKGBMZXRJbgogICAgICAgICAgICAg
ICAgICAgKF9sb2MsIChgUmVOaWwgX2xvYyksIChGYW5Bc3QuYW5kX29mX2xpc3QgcGFydHMpLAog
ICAgICAgICAgICAgICAgICAgICAoYExldEluCiAgICAgICAgICAgICAgICAgICAgICAgIChfbG9j
LCBiLAogICAgICAgICAgICAgICAgICAgICAgICAgIChGYW5Bc3QuYW5kX29mX2xpc3QgKEFycmF5
LnRvX2xpc3Qgc3RhdGVzKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgKGBTZXEKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAoX2xvYywKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIChgU2VtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX2xvYywKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGBBcHAKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgKF9sb2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgKGBJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IChfbG9jLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGBE
b3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfbG9j
LCAoZ20gKCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAoYExpZCAoX2xvYywgInN0YXJ0IikpKSkpKSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAoYElkIChfbG9jLCAoYExpZCAoX2xvYywgImxleGJ1ZiIpKSkpKSks
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChgTWF0Y2gKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgKF9sb2MsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgKGBBcHAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAoX2xvYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIChgSWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIChfbG9jLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAoYExpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAoX2xvYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAobWtfc3RhdGVfbmFtZSAwKSkpKSksCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAoYElkCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAoX2xvYywKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgKGBMaWQgKF9sb2MsICJsZXhidWYiKSkpKSkpLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChgT3IKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX2xvYywKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIChGYW5Bc3Qub3Jfb2ZfbGlzdAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKEFycmF5LnRvX2xpc3QgY2FzZXMp
KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChgQ2FzZQog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKF9sb2MsIChg
QW55IF9sb2MpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAoYE5pbCBfbG9jKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgKGBBcHAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgKF9sb2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgKGBJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfbG9jLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGBMaWQKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfbG9j
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAicmFpc2UiKSkpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAoYElkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKF9sb2MsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYERvdAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKF9s
b2MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIChnbSAoKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChgVWlkCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKF9sb2MsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIkVycm9yIikpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKQo=
--14dae9cfc8506e55fa04d523a5ac--

From yminsky@janestreet.com  Thu Feb  7 15:44:23 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 33B573C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 15:44:23 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1442869 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:38736
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U3Tin-0002h8-mc (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Thu, 07 Feb 2013 15:49:15 +0000
Received: from tot-smtp.delacy.com ([172.27.22.35] helo=tot-is-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1U3TiS-0002on-KP
 for wg-camlp4@lists.ocaml.org; Thu, 07 Feb 2013 10:48:48 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-is-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1U3TiR-0000rF-4K
 for wg-camlp4@lists.ocaml.org; Thu, 07 Feb 2013 10:48:47 -0500
Received: from mail-ee0-f70.google.com ([74.125.83.70])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1U3TiR-0003zT-05
 for wg-camlp4@lists.ocaml.org; Thu, 07 Feb 2013 10:48:47 -0500
Received: by mail-ee0-f70.google.com with SMTP id l10so2913141eei.1
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Feb 2013 07:48:46 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type;
 bh=UkBebyIikPTzaF20xDGqTcDQh8QkmtLzI1hw1yEz7mU=;
 b=avl3JROg2Jx1JqxCmC4tYYfnyRS1zpWw788HqoNVKOPlcZ5Rdb2O4pKwoRTGWPfdSA
 t3E2dlxBu4KcGR4dEJDpE3QHoI4f9RCf5clVbpOC9+qsx1z9H2W1IgsfoRk4CVEDLtXL
 nnu3rRvK45+GWPMl5TcIVdfMve/pyywkIBOXI=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type:x-gm-message-state;
 bh=UkBebyIikPTzaF20xDGqTcDQh8QkmtLzI1hw1yEz7mU=;
 b=Q9uM7fD8amh2a1lFHGWvaBaIZLd3xzO4ZoVV84f5UcMfb8QMvNVtWO9LWe+jWDcR31
 6+gnJRszD0r7+4cuioJn15rX8TzC0Rhjv9seZu71jOr3SNVcoqTFJN9bY1aQ2uEvunhW
 rOeEqz1L+3GGJ+jXLllUZQSUtWzGUt1ULmZzOGo87fIGU1SvUXX0xEm3GMCWrgSLEasJ
 3mZJLxoarErQvO1w2ccHpV0wqkSZyxj43f8q2z53LdA+4ysKhvZXEFwRx+jgqoHZpr7r
 hI6y1wqsR7xEtA1L7q2dDffuJ+fwxiTcEeaD1I8zCIvuWUP2TpPO3weNi3cm2FXAXA8C
 dsBg==
X-Received: by 10.14.2.196 with SMTP id 44mr5243482eef.25.1360252126395;
 Thu, 07 Feb 2013 07:48:46 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.14.2.196 with SMTP id 44mr5243457eef.25.1360252126233; Thu,
 07 Feb 2013 07:48:46 -0800 (PST)
Received: by 10.223.141.66 with HTTP; Thu, 7 Feb 2013 07:48:46 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
Date: Thu, 7 Feb 2013 10:48:46 -0500
Message-ID: <CACLX4jQg2Lsre3DGyDvEFA1=dpPYoy_Gt-DrtkmeZ0UvLN75GQ@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQmVV3Jt/c236YWTTCmwYnmuHmM3DqHHmx6W+W+jGiaf3gcP825Gb/pYfe/Kr9/5ajFbMpdHmaBwN+o12+63Ljn4Xde0aJhCZ65hGx9yppZ78FexcLYtUb0aqH5y3d2qBVowHNJgAeHsy237EkzuYHua9kd4Nw==
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 15:44:23 -0000

Thanks Leo!  This is very helpful.  Maybe we should throw this up on a
wiki page somewhere, and keep it up to date as proposals show up.

A few notes of my own below.

On Wed, Feb 6, 2013 at 1:11 PM, Leo White <lpw25@cam.ac.uk> wrote:
> c) Sebastien Mondet suggested that run-time types or dyntype might be
> sufficient without ppx for many extensions.
>
> Markus Mottl pointed out that there are runtime performance
> implications for using those solutions.

I strongly agree with Markus on this.  Run-time types are lovely, but
we really need something more efficient for the vast majority of our
camlp4 needs.  Using a comparison function constructed with run-time
types, for example, would be a disaster performance wise.  We've done
experiments internally, and the performance hit is absolutely
crushing.

> d) Jeremy suggested that rather than implementing extensions as AST
> transformers that operate over the whole AST they might be implemented    as
> transformers only for the part of the AST that they were to operate    on.
> So an extension used like this:
>
>      (:perform
>          x <-- m;
>          y <-- n;
>          return (x y))
>
>    would be implemented as a function with type:
>
>      val perform : Parsetree.expression -> Parsetree.expression
>
>    He suggests that this may help with scoping, safety and
> compositionality.
>
>    Alain pointed out that some legitimate uses of ppx don't work nicely
> with the constraint that they can operate only on a marked fragment. He
> also pointed out that handling extensions as those extensions are found
> within the source forces a top-down expansion order, which is not
> necessarily desirable.

I wonder if this is a place where we can have it both ways: have an
underlying ppx mechanism that is a whole-AST transformation; and
expose libraries that support more disciplined, scoped
transformations.  We could strongly encourage the latter, but still
allow the former when necessary.

> e) I suggested an extension to Jeremy's proposal. This involves giving the
> expansion functions in their own kind of file (".mlq" - compiled to
> ".cmq"), referring to them using a namespace mechanism, and then having
> the compiler itself perform the expansion of the extensions.
>
>    There are more details in my blog post:
>
>      http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html
>
>    Since such a solution would take a while to implement, and since moving
> an extension from ppx to it would be trivial, I proposed using ppx for
> the short/medium term.
>
>    I suggested that such a mechanism might improving tooling and make it
> easier for average users to use extensions.
>
>    Both Gabriel and Alain suggested that the use of namespaces might be
> unnecessary and too heavyweight. Alain also questioned the need for
> special ".mlq" files.

I do like the idea of eventually getting to a name-spaced solution.
In our world, there are really two cases: one, where we really just
want to extend the language, and we're happy to specify which language
we're using fairly broadly at the build-system level.  For such
things, namespaces do not seem helpful.

The other case is where you want to invoke a particular,
special-purpose syntax extension for just one file.  There, having
something that would allow the specification of the extension in the
file, ideally with some integration with namespaces, seems lovely.
That said, I think it's a less important use-case in the current
world.

I wonder, does anyone on the list of have much experience with
Scheme's approach to macros?  There's been a lot of work there,
covering everything from hygeine to integration with module systems.
It would be great to leverage off of that experience.

y

From alain.frisch@lexifi.com  Thu Feb  7 16:32:41 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 632673C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 16:32:41 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442869 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:36215)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U3UTc-0002Sw-nm (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 07 Feb 2013 16:37:33 +0000
Received: from [192.168.0.11] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 6BD3FA628D;
 Thu,  7 Feb 2013 17:37:27 +0100 (CET)
Message-ID: <5113D846.3080703@lexifi.com>
Date: Thu, 07 Feb 2013 17:37:26 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
 <CANcqPu7QQDAwL3tTMOSbW2q5jhjtYpFF4SntH_NF336o9cOdLA@mail.gmail.com>
 <51137D59.7050308@lexifi.com>
 <CANcqPu7eG0v16GXkzz0kaQ66KLGT-sVGRTpYeVt9bHmr+eSUoA@mail.gmail.com>
In-Reply-To: <CANcqPu7eG0v16GXkzz0kaQ66KLGT-sVGRTpYeVt9bHmr+eSUoA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 16:32:41 -0000

On 2/7/2013 3:56 PM, Hongbo Zhang wrote:
> Not always, as I pointed out, as long as you combine several global Ast
> Rewriter, I am  optimistic that Fan has a great chance to outperform
> ppx.

Oh sorry, I thought you were referring to the compilation of Fan itself.

> Well, things are always possible, but just too difficult in some cases,
> remember that (Camlp4/Camlp5/Fan) preprocess the intermediate Ast, if we
> clutter Parsetree too much, like adding some attributes node per syntax
> category and ignored by the compiler later, which may require all other
> tools to mix Intermediate Ast with Parsetree, it's always possible, just
> too hard.

I don't follow. We are talking, basically, about adding simple 
constructions to the AST, like:

   Pexp_annotation of expression * expression
   Pexp_extension of string * expression

and you were suggesting that this would almost kill Camlp4/Fan. Why?

> I am perfectly fine with ppx so far, and I am happy to see
> bisect switch to ppx, because global Ast Rewriter happen to be very fit
> there, but  if we try to make everything possible in ppx, there's a
> large chance that it will result in a ugly design in the compiler.

Again, we are talking about adding a few constructs to the AST.  The 
only real "consumer" of the AST in the compiler is the type-checker, and 
its behavior is pretty clear for the new nodes:  attributes are ignored, 
extensions raise a type error.  Where is the "ugly design"?

> Let me explain a bit why quosi-quotation is superb here:
> 1. It quickly goes into my muscle memory, because I write ocaml everyday
> (not parsetree)

So do I and thus I'm more familiar with constructors of a standard sum 
types (wrapped into simple functions) than something which requires a 
new syntax.

>, it's just my *intuition* that the Ast should be
> constructed that way, and I don't need to remember those alien function
> names, to be honest, I don't know what's the module E here. If I want to
> make a piece of code into data, I just need to quote them, add
> "{:expr||}" surrounding them, that's all. How would that happen in your
> "E" module?

I don't see where "lifting ASTs" is required in order to implement all 
the interesting tools we are discussing here (except Fan itself).

> 2. The E module seems to be a bit magic here

E is defined in Ast_mapper:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/parsing/ast_mapper.mli?view=markup

For instance, let_ is defined very cleverly as:

let mk ?(loc = Location.none) x = {pexp_desc = x; pexp_loc = loc}
...
let let_ ?loc a b c = mk ?loc (Pexp_let (a, b, c))

There is absolutely no magic.


> 3. For the parsetree, if you want to do syntactic grep over bigarray,
> you will get into much trouble:
>     ({pexp_desc=Pexp_ident
>                      {txt= Ldot (Ldot (Lident "Bigarray", array),
> ("get"|"set" as gs)) ;_};_}
>     This does not solve the problem at all, since it can not
> discriminate "a.{b,c}" from "Bigarray.get a b c " in Fan, you only need
> to do say
>     "`Bigarray (a,b,c)"
>     There are so many syntax desugaring in the parsetree that I don't
> know where to stop.

This is a valid point, and I believe there would not be any strong 
opposition to move some desugaring logic from parser.mly into the 
typechecker, i.e. make Parsetree look more like a parse tree than an AST.

That said, I've no idea what

  `Bigarray (a,b,c)

means.


>  > Can you describe in more detail your position concerning the
> following points?
>  >
> If it can be implemented by ppx, it can be straightforwardly translated
> into Fan, since ppx is simply a tiny proper subset of Fan(the part of
> global Ast Rewriter).

Will you introduce in Fan the notion of attributes attached to every 
possible category and represented explicitly in the (Fan) AST?  I 
thought you only had the intention to extend the syntax of OCaml with a 
single construct {:xxx| ... |}  with  .... being left unparsed.  I don't 
see how you can simulate "ignorable attributes" with that. Can you 
elaborate?

> Fan provides first class parser/lexer(or in-line parser
> lexer), which is good, and there are people who appreciate
> it(https://sympa.inria.fr/sympa/arc/caml-list/2013-02/msg00020.html),

I'm fine with Camlp4/Fan as a "parsing technology", and I've used it 
quite a lot (e.g. the parser for CDuce was implemented in Camlp4).  But 
this is largely independent of the use of Camlp4 to write "syntax 
extensions".  I believe that most interesting uses of Camlp4 to write 
syntax extensions today don't require any parsing technology at all, 
because they are not about really extending the syntax per so, but 
rather about providing convenient tools to OCaml developpers, and this 
does not require to play with the syntax.


Alain

From gabriel.scherer@gmail.com  Thu Feb  7 16:45:09 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 611613C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 16:45:09 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1442869 
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.53 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f53.google.com ([209.85.214.53]:40566)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U3Ufg-0000Cu-ra (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 07 Feb 2013 16:50:01 +0000
Received: by mail-bk0-f53.google.com with SMTP id j10so1248089bkw.40
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Feb 2013 08:50:00 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type:content-transfer-encoding;
 bh=3JjSXnEqg4udPIucIgMWsLAXaP20X1yW4opEMRwHL+g=;
 b=wkRaFxCzXAL2K/+T3ByJCHMTJTwxK2H3NMPaYrytJM0qbLg0A8WHs3zdLVBJUC0ejy
 F+n55JG+QyAEhorZED8PJG1g74BgJcs6eP3D0BtQyp8MFmtM1zqocsaJ7qeKC6/sOLFj
 jw62wt7qBZfVKDtKTafuRY9mTAfLBy6USxYIDT2ODM8EhKYC5ukkXniHlToZQtGRqypM
 a7ckBxPGrlcshInisDxDLzIvNfC8PYG3/J8SutTG+5x37qbN4ff/5yy7BuVy2Zy17Vxu
 Rey49EFgzz/0SggS4KNIb9RbPLMU91j6UuvTN1xc+e1Ut80JV82IYavvm927gJcLEOyl
 NKEQ==
X-Received: by 10.204.129.16 with SMTP id m16mr588743bks.103.1360255800047;
 Thu, 07 Feb 2013 08:50:00 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Thu, 7 Feb 2013 08:49:18 -0800 (PST)
In-Reply-To: <CACLX4jQg2Lsre3DGyDvEFA1=dpPYoy_Gt-DrtkmeZ0UvLN75GQ@mail.gmail.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
 <CACLX4jQg2Lsre3DGyDvEFA1=dpPYoy_Gt-DrtkmeZ0UvLN75GQ@mail.gmail.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 7 Feb 2013 17:49:18 +0100
Message-ID: <CAPFanBGR-r+6T1_x1SPpOSBw1qottsyVVKEz4MeV9VK+b6RUsw@mail.gmail.com>
To: Yaron Minsky <yminsky@janestreet.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 16:45:09 -0000

>> c) Sebastien Mondet suggested that run-time types or dyntype might be
>> sufficient without ppx for many extensions.
>>
>> Markus Mottl pointed out that there are runtime performance
>> implications for using those solutions.
>
> I strongly agree with Markus on this.  Run-time types are lovely, but
> we really need something more efficient for the vast majority of our
> camlp4 needs.  Using a comparison function constructed with run-time
> types, for example, would be a disaster performance wise.  We've done
> experiments internally, and the performance hit is absolutely
> crushing.

Two remarks on this.

First, it is unclear that runtime types (or any form of internalized
type-driven value generation) will scale to higher-kinded settings
(generating a "Functor" instance out of a parametrized datatype), so
there is also an argument of expressivity. In the current state of the
OCaml type system, "a ty" is only robustly defined for closed types or
type schemes (as opposed to parametrized types as type operators, that
is anything of kind different from '*'), and while I don't exclude
impressive workarounds from Alain or other, I wouldn't trust the
dyntype approach to work really well on type operators.

Second, Pierre Chambart and Gr=E9goire Henry are working on a different
take on type-directed code injection that is more general than just
inferred dynamic type representations, and could make much of that
performance overhead you're mentioning go away, at least on paper
(whether the actually generated terms will be actually optimized as
you would hope is another question in which I'm sure they are also
interested). The idea is that instead of having a type-directed
generation of a ('a ty) and then a function ('a ty -> 'a printer), you
could directly generate ('a printer) in a type-directed way. This
generalization allows to express type-directed behavior that are not
defined on all types (eg. comparison rejected statically rather than
at runtime on function types), and could potentially make the
performance issue simpler. Note that in theory clever partial
evaluation could work on the previous dyntype approach (but I think
that's beyond hope for now).

On Thu, Feb 7, 2013 at 4:48 PM, Yaron Minsky <yminsky@janestreet.com> wrote=
:
> Thanks Leo!  This is very helpful.  Maybe we should throw this up on a
> wiki page somewhere, and keep it up to date as proposals show up.
>
> A few notes of my own below.
>
> On Wed, Feb 6, 2013 at 1:11 PM, Leo White <lpw25@cam.ac.uk> wrote:
>> c) Sebastien Mondet suggested that run-time types or dyntype might be
>> sufficient without ppx for many extensions.
>>
>> Markus Mottl pointed out that there are runtime performance
>> implications for using those solutions.
>
> I strongly agree with Markus on this.  Run-time types are lovely, but
> we really need something more efficient for the vast majority of our
> camlp4 needs.  Using a comparison function constructed with run-time
> types, for example, would be a disaster performance wise.  We've done
> experiments internally, and the performance hit is absolutely
> crushing.
>
>> d) Jeremy suggested that rather than implementing extensions as AST
>> transformers that operate over the whole AST they might be implemented  =
  as
>> transformers only for the part of the AST that they were to operate    o=
n.
>> So an extension used like this:
>>
>>      (:perform
>>          x <-- m;
>>          y <-- n;
>>          return (x y))
>>
>>    would be implemented as a function with type:
>>
>>      val perform : Parsetree.expression -> Parsetree.expression
>>
>>    He suggests that this may help with scoping, safety and
>> compositionality.
>>
>>    Alain pointed out that some legitimate uses of ppx don't work nicely
>> with the constraint that they can operate only on a marked fragment. He
>> also pointed out that handling extensions as those extensions are found
>> within the source forces a top-down expansion order, which is not
>> necessarily desirable.
>
> I wonder if this is a place where we can have it both ways: have an
> underlying ppx mechanism that is a whole-AST transformation; and
> expose libraries that support more disciplined, scoped
> transformations.  We could strongly encourage the latter, but still
> allow the former when necessary.
>
>> e) I suggested an extension to Jeremy's proposal. This involves giving t=
he
>> expansion functions in their own kind of file (".mlq" - compiled to
>> ".cmq"), referring to them using a namespace mechanism, and then having
>> the compiler itself perform the expansion of the extensions.
>>
>>    There are more details in my blog post:
>>
>>      http://www.lpw25.net/2013/02/05/camlp4-alternative-part-2.html
>>
>>    Since such a solution would take a while to implement, and since movi=
ng
>> an extension from ppx to it would be trivial, I proposed using ppx for
>> the short/medium term.
>>
>>    I suggested that such a mechanism might improving tooling and make it
>> easier for average users to use extensions.
>>
>>    Both Gabriel and Alain suggested that the use of namespaces might be
>> unnecessary and too heavyweight. Alain also questioned the need for
>> special ".mlq" files.
>
> I do like the idea of eventually getting to a name-spaced solution.
> In our world, there are really two cases: one, where we really just
> want to extend the language, and we're happy to specify which language
> we're using fairly broadly at the build-system level.  For such
> things, namespaces do not seem helpful.
>
> The other case is where you want to invoke a particular,
> special-purpose syntax extension for just one file.  There, having
> something that would allow the specification of the extension in the
> file, ideally with some integration with namespaces, seems lovely.
> That said, I think it's a less important use-case in the current
> world.
>
> I wonder, does anyone on the list of have much experience with
> Scheme's approach to macros?  There's been a lot of work there,
> covering everything from hygeine to integration with module systems.
> It would be great to leverage off of that experience.
>
> y
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From alain.frisch@lexifi.com  Thu Feb  7 16:48:04 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8C1023C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 16:48:04 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442869 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:34281)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U3UiV-0001st-qC (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 07 Feb 2013 16:52:56 +0000
Received: from [192.168.0.11] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 87FD5A6281;
 Thu,  7 Feb 2013 17:52:50 +0100 (CET)
Message-ID: <5113DBE1.8000808@lexifi.com>
Date: Thu, 07 Feb 2013 17:52:49 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gerd Stolpmann <info@gerd-stolpmann.de>
References: <1360242974.18230.7@samsung>
In-Reply-To: <1360242974.18230.7@samsung>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 16:48:04 -0000

On 2/7/2013 2:16 PM, Gerd Stolpmann wrote:
> Currently, there is no documentation about parsetrees, and I would need
> to guess how they are built up. But if there was some documentation plus
> some examples it would probably be fully acceptable.

See the discussion with X. Clerc on this list.  It has been suggested to 
add a compiler option to dump the parse tree into "Parsetree" syntax 
(Pexp_... constructors).

> "let rec" might be a bad example, because such a change is not expected,
> but generally we _will_ run into the problem that changes of the
> parsetree type break ppx processors. (Well, to some degree we can avoid
> this by having wrapper functions, i.e. don't use E.let_ directly, but a
> function mk_let, as then many changes can be done in a way that doesn't
> affect compatibility.)

E.let_ is already a wrapper around the constructor:

let mk ?(loc = Location.none) x = {pexp_desc = x; pexp_loc = loc}
...
let let_ ?loc a b c = mk ?loc (Pexp_let (a, b, c))

If the Parsetree is extended, there are different ways to organize 
ourselves to avoid breaking existing -ppx rewriters (at least for AST 
fragments "builders", not "patterns"): new functions, optional 
arguments, a copy of the ast_mapper module to support older versions of 
the Parsetree (with an implicit mapping).  But it also make sense to 
think about ways to make the definition of Parsetree itself more robust 
to future changes.  For instance, using records instead of tuples is 
much more future-proof:  when deconstructing a node, one can choose to 
use "open record patterns" (to explicitly ignore future fields which 
could be added) or not (to be forced to adapt the code if more fields 
are added);  and wrapper functions can use optional arguments for new 
fields.


Alain

From bobzhang1988@gmail.com  Thu Feb  7 19:46:03 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 58C903C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 19:46:03 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1442869 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f173.google.com ([209.85.220.173]:64925)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U3XUk-0003kJ-s7 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 07 Feb 2013 19:50:56 +0000
Received: by mail-vc0-f173.google.com with SMTP id fy7so1899432vcb.32
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Feb 2013 11:50:54 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=F88BeoZWV6573Jg+5Gg5Fk3uk9Wjpxsc+PozWx0Ligo=;
 b=Mgl03mUXeRLrqtd/9cFAPPAySLgKpPG6KFuXQoZudxPgkBYW5iwANdm/R2OHG+yCJy
 ozEOh58WtJcZc4hdHO4/Nlf+aaEElElz64y739AJdLbeMneXcXEuASnuJBNQRzbmG2Ak
 O1aNEejQJdYVS1d5OLMZcHD7CHxokEuwKbA5Cpj63Lq2EZVc/xqhCv3DPdrSYZ3byMpe
 2VTCXDZ4FWg2VeX6ru/YVvc3mnxoUnlx43gJhG+C23/4lyPB1PBbERjS13hjTu+FCKr4
 83XNo+f8t/YhkaMKOqqbXlYf1Zrw8TtAGpD9bXmhgDZL70cNz1+mo9qT4tDV18nH51h5
 xpYQ==
MIME-Version: 1.0
X-Received: by 10.221.10.72 with SMTP id oz8mr3336421vcb.36.1360266653913;
 Thu, 07 Feb 2013 11:50:53 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Thu, 7 Feb 2013 11:50:53 -0800 (PST)
In-Reply-To: <5113D846.3080703@lexifi.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
 <CANcqPu7QQDAwL3tTMOSbW2q5jhjtYpFF4SntH_NF336o9cOdLA@mail.gmail.com>
 <51137D59.7050308@lexifi.com>
 <CANcqPu7eG0v16GXkzz0kaQ66KLGT-sVGRTpYeVt9bHmr+eSUoA@mail.gmail.com>
 <5113D846.3080703@lexifi.com>
Date: Thu, 7 Feb 2013 14:50:53 -0500
X-Google-Sender-Auth: ni7VR9FflNqOb3dE_ZvEfUvyqII
Message-ID: <CANcqPu6HjyvpRSG5AOiYEPnLYjeJwT2iTL6gV_MtO45L_UUDtA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=bcaec54d4bdeb4d36c04d527c288
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 19:46:03 -0000

--bcaec54d4bdeb4d36c04d527c288
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Feb 7, 2013 at 11:37 AM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> On 2/7/2013 3:56 PM, Hongbo Zhang wrote:
>
>>
>> I don't follow. We are talking, basically, about adding simple
> constructions to the AST, like:
>
>   Pexp_annotation of expression * expression
>   Pexp_extension of string * expression
>
> and you were suggesting that this would almost kill Camlp4/Fan. Why?
>
> The problem is that I am a bit unclear how to encode them in the
meta-level, since the introduced constructs will not be consumed by the
type checker, they are provided for the convenience of ppx, but does not
exist in real world.  I think camlp5 and Coq maintainers will also
appreciate that we are a bit conservative in the compiler part.

>
> E is defined in Ast_mapper:
>
> http://caml.inria.fr/cgi-bin/**viewvc.cgi/ocaml/trunk/**
> parsing/ast_mapper.mli?view=**markup<http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/parsing/ast_mapper.mli?view=markup>
>
> For instance, let_ is defined very cleverly as:
>
> let mk ?(loc = Location.none) x = {pexp_desc = x; pexp_loc = loc}
> ...
> let let_ ?loc a b c = mk ?loc (Pexp_let (a, b, c))
>
> There is absolutely no magic.
>
> First, I guess most people will seldom write ppx, and they have to
remember all those function names for once use a year. Quosi-quotation is
so intuitive that you don't need remember anything.

Second, as I said, quosi-quotation works so nice with IDE or Emacs, since
you can expand code any time you want, just one key binding, the expanded
code just show up in my emacs buffer, the experience is exactly the same as
slime in lisp, it's impossible to expand the code using arbitrary functions.

Third, this way to construct code is very limited, think about how you
encode the ast, "{:expr| {:expr| a + b|} |}"


> This is a valid point, and I believe there would not be any strong
> opposition to move some desugaring logic from parser.mly into the
> typechecker, i.e. make Parsetree look more like a parse tree than an AST.
>
> That said, I've no idea what
>
>  `Bigarray (a,b,c)
>
> means.

In Fan, the transformation between concrete syntax and abstract syntax is
bijective(at least the design goal), so there is no ambiguity here, but for
parsetree, it's hard to draw a line here, if you prevent all the syntax
desguaring, that might introduces too much unnecessary complexity for the
type checker

>
>
>
> Will you introduce in Fan the notion of attributes attached to every
> possible category and represented explicitly in the (Fan) AST?  I thought
> you only had the intention to extend the syntax of OCaml with a single
> construct {:xxx| ... |}  with  .... being left unparsed.  I don't see how
> you can simulate "ignorable attributes" with that. Can you elaborate?
>
> I am pretty open-minded here, actually I thought it for a while, I am more
inclined to do this in the parsing stage by providing some plugins without
cluttering the ast too much.

>
>
> Alain
>



-- 
-- Regards, Hongbo

--bcaec54d4bdeb4d36c04d527c288
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Thu, Feb 7, 2013 at 11:37 AM, Alain F=
risch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain.frisch@lexifi.com" targ=
et=3D"_blank">alain.frisch@lexifi.com</a>&gt;</span> wrote:<br><blockquote =
class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid=
;padding-left:1ex">
<div class=3D"im">On 2/7/2013 3:56 PM, Hongbo Zhang wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><br></blockquote></div>
I don&#39;t follow. We are talking, basically, about adding simple construc=
tions to the AST, like:<br>
<br>
=A0 Pexp_annotation of expression * expression<br>
=A0 Pexp_extension of string * expression<br>
<br>
and you were suggesting that this would almost kill Camlp4/Fan. Why?<div cl=
ass=3D"im"><br></div></blockquote><div>The problem is that I am a bit uncle=
ar how to encode them in the meta-level, since the introduced constructs wi=
ll not be consumed by the type checker, they are provided for the convenien=
ce of ppx, but does not exist in real world. =A0I think camlp5 and Coq main=
tainers will also appreciate that we are a bit conservative in the compiler=
 part.</div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im"><br></div>
E is defined in Ast_mapper:<br>
<br>
<a href=3D"http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/parsing/ast_=
mapper.mli?view=3Dmarkup" target=3D"_blank">http://caml.inria.fr/cgi-bin/<u=
></u>viewvc.cgi/ocaml/trunk/<u></u>parsing/ast_mapper.mli?view=3D<u></u>mar=
kup</a><br>

<br>
For instance, let_ is defined very cleverly as:<br>
<br>
let mk ?(loc =3D Location.none) x =3D {pexp_desc =3D x; pexp_loc =3D loc}<b=
r>
...<br>
let let_ ?loc a b c =3D mk ?loc (Pexp_let (a, b, c))<br>
<br>
There is absolutely no magic.<div class=3D"im"><br></div></blockquote><div>=
First, I guess most people will seldom write ppx, and they have to remember=
 all those function names for once use a year. Quosi-quotation is so intuit=
ive that you don&#39;t need remember anything.</div>
<div><br></div><div>Second, as I said, quosi-quotation works so nice with I=
DE or Emacs, since you can expand code any time you want, just one key bind=
ing, the expanded code just show up in my emacs buffer, the experience is e=
xactly the same as slime in lisp, it&#39;s impossible to expand the code us=
ing arbitrary functions.</div>
<div><br></div><div>Third, this way to construct code is very limited, thin=
k about how you encode the ast, &quot;{:expr| {:expr| a + b|} |}&quot;</div=
><div><br></div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8e=
x;border-left:1px #ccc solid;padding-left:1ex">
<div class=3D"im"><br></div>
This is a valid point, and I believe there would not be any strong oppositi=
on to move some desugaring logic from parser.mly into the typechecker, i.e.=
 make Parsetree look more like a parse tree than an AST.<br>
<br>
That said, I&#39;ve no idea what<br>
<br>
=A0`Bigarray (a,b,c)<br>
<br>
means.</blockquote><div>In Fan, the transformation between concrete syntax =
and abstract syntax is bijective(at least the design goal), so there is no =
ambiguity here, but for parsetree, it&#39;s hard to draw a line here, if yo=
u prevent all the syntax desguaring, that might introduces too much unneces=
sary complexity for the type checker</div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im"><br>
<br><br></div>
Will you introduce in Fan the notion of attributes attached to every possib=
le category and represented explicitly in the (Fan) AST? =A0I thought you o=
nly had the intention to extend the syntax of OCaml with a single construct=
 {:xxx| ... |} =A0with =A0.... being left unparsed. =A0I don&#39;t see how =
you can simulate &quot;ignorable attributes&quot; with that. Can you elabor=
ate?<div class=3D"im">
<br></div></blockquote><div>I am pretty open-minded here, actually I though=
t it for a while, I am more inclined to do this in the parsing stage by pro=
viding some plugins without cluttering the ast too much.=A0</div><blockquot=
e class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc sol=
id;padding-left:1ex">
<span class=3D"HOEnZb"><font color=3D"#888888">
<br>
<br>
Alain<br>
</font></span></blockquote></div><br><br clear=3D"all"><div><br></div>-- <b=
r>-- Regards, Hongbo

--bcaec54d4bdeb4d36c04d527c288--

From bobzhang1988@gmail.com  Thu Feb  7 20:12:21 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5E36B3C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 20:12:21 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.5 from SpamAssassin-3.3.2-1442869 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.170 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f170.google.com ([209.85.128.170]:62872)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U3XuC-0000vB-S9 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 07 Feb 2013 20:17:14 +0000
Received: by mail-ve0-f170.google.com with SMTP id 14so2711703vea.1
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Feb 2013 12:17:12 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:message-id:date:from:user-agent:mime-version:to:subject
 :references:in-reply-to:content-type:content-transfer-encoding;
 bh=EEnL+u712goBr0SlH9SEy+Na7zIYB/AJSsS2IStkYVY=;
 b=xio5qfBREoe51FqQBolryzy4Z14MxvcVVsoBEGMZhFLYQ5FZRfr35D6eQojEVo8JnB
 TXqMWAU9tYc/lwIBkVpsCPN00YQ0kAN/NC39qkByBL8d5Wtf69my3t2+3YWjbF1WI/wi
 aE6jQOR2f2w08GTjNLAJcm9OwcyxUPDJactjWlX90Y1Sr+RUsAWBO09Y3oBxVB3nExvA
 OXkhI5twryQtufSqIxH8Hlrt3z5YdDp25Tqn1B4PU70kLpUQUCNrvJaiZp5verTUWqUv
 c+QNvyxffeelzfN0yNnHn6FSiM9NZh7a/JVfiyxKsxZMmZxyFh7iXOeBJ3Q0nREQMZnT
 LE7Q==
X-Received: by 10.58.97.165 with SMTP id eb5mr3512490veb.40.1360268232019;
 Thu, 07 Feb 2013 12:17:12 -0800 (PST)
Received: from vagvlan536.0716.wlan.vpul.upenn.edu
 (vagvlan536.0716.wlan.vpul.upenn.edu. [158.130.211.49])
 by mx.google.com with ESMTPS id a19sm39936496vdh.9.2013.02.07.12.17.10
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Thu, 07 Feb 2013 12:17:11 -0800 (PST)
Message-ID: <51140BC9.1060300@gmail.com>
Date: Thu, 07 Feb 2013 15:17:13 -0500
From: Hongbo Zhang <bobzhang1988@gmail.com>
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Alain Frisch <alain@frisch.fr>, wg-camlp4@lists.ocaml.org
References: <1359407533.10634.8@samsung> <51077DEC.5060109@frisch.fr>
In-Reply-To: <51077DEC.5060109@frisch.fr>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] [Caml-list] Working Group: the future of syntax
 extensions in OCaml, after camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 20:12:21 -0000

On 1/29/13 2:44 AM, Alain Frisch wrote:
>
> Let me throw a crazy idea: maybe we could merge the grammar for 
> patterns and expressions, and let the type checker reject bad patterns 
> and bad expressions from this more admissible class. This would give 
> plenty of space for extensions.
>
This is not a crazy idea, it's a beautiful idea, In Fan, we make expr 
and patt symmetric, and defined a new type
expr_patt which is a subtype of both expr and patt(thanks to polymorphic 
variants), it seems that the  Ast lifting only need expr_patt, so the 
part [meta_expr] and [meta_patt] can be shared, which gives much more 
precise type information than the normal sum types, it's so beautiful, XD
>
>
>>>
>>
>>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4


From thomas.gazagnaire@gmail.com  Thu Feb  7 20:34:52 2013
Return-Path: <thomas.gazagnaire@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5A0B03C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 20:34:52 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1442869 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.48 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (thomas.gazagnaire[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f48.google.com ([74.125.82.48]:38742)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U3YG0-0002iP-Xh (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <thomas.gazagnaire@gmail.com>); Thu, 07 Feb 2013 20:39:45 +0000
Received: by mail-wg0-f48.google.com with SMTP id 16so2338034wgi.15
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Feb 2013 12:39:44 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:from:content-type:content-transfer-encoding
 :subject:date:message-id:to:mime-version:x-mailer;
 bh=IIh+DsDJf3uZiVI/Z5Wb7E6WygqmX0Ve6ha3FvgI4rU=;
 b=uGpqLDYDItGcX3orS2MVW4rWbKnjkM1dNFHmgD0+DiBI9slhT3WQ2LyQZ6jfRNu2TB
 c9Xd0BgD+mmJLwEFOPWWzAn+xvYVC0rsvVLjyM1DxyoFaBakdxiEdA0TkvY4Smwx8yHV
 wileBNCWse7tk9Xj5l3x3OGHqIFRGuzJpCpNvzZXhVgNG2BNsJC5MC4WxseBKUQiwgaW
 1NaEpMnAgJZEhRciUy8V56qYNXfYj66czuNH/YimJSf+3oBFvPyp+7fU/rqPiVJmE725
 eA7w5Mx/85/bUYznEL2It8QBG0p8PQDqk6WfogKrUT2bnjT1s4enCnJC1ELwdktuIsLu
 etSQ==
X-Received: by 10.194.57.206 with SMTP id k14mr5491461wjq.26.1360269584155;
 Thu, 07 Feb 2013 12:39:44 -0800 (PST)
Received: from [192.168.0.14] (gou06-3-88-170-165-56.fbx.proxad.net.
 [88.170.165.56])
 by mx.google.com with ESMTPS id ex1sm11712882wib.7.2013.02.07.12.39.41
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Thu, 07 Feb 2013 12:39:42 -0800 (PST)
Sender: Thomas Gazagnaire <thomas.gazagnaire@gmail.com>
From: Thomas Gazagnaire <thomas@ocamlpro.com>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Date: Thu, 7 Feb 2013 21:39:39 +0100
Message-Id: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
To: wg-camlp4@lists.ocaml.org
Mime-Version: 1.0 (Apple Message framework v1085)
X-Mailer: Apple Mail (2.1085)
Subject: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 20:34:52 -0000

Hi all,

In my opinion as a *user* of camlp4, the main pitfall that I can see =
(and which has not yet been addressed) is that it is really slowing down =
the compilation process. To improve that, the usual methods are:
1. to use native syntax extensions
2. to statically link the syntax extensions into one preprocessor binary

Currently, 1. is very broken  (natdynlink doesn't work on all platforms =
and most of the syntax packages do not install their native libraries =
anyway) and 2. is not very flexible because of lack of tooling, and so =
very rarely used.

So, if we decide to switch to a new preprocessing tool, I guess it's =
important to get these hings right:
* it should be easy enough for external tools to statically build =
pre-processors.
* the new preprocessor should be benchmarked on realistic examples to =
see how much time we gain vs. camlp4. A good example might be mirage =
which is using only pa_lwt and cstruct (or xen-api which is using only =
ocaml-rpc, or core but that maybe too much syntax in one go).

Best,
Thomas
PS: I'm not speaking about the bootstraping time of camlp4, which is =
indeed very painful, but which doesn't really affect the end-user once =
the compiler is installed.=

From info@gerd-stolpmann.de  Thu Feb  7 21:18:01 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 67A5D3C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 21:18:01 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1442869 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.17.10 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.17.10]:59388)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U3Yvl-000830-X5 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Thu, 07 Feb 2013 21:22:54 +0000
Received: from office1.lan.sumadev.de (dslb-084-059-074-050.pools.arcor-ip.net
 [84.59.74.50])
 by mrelayeu.kundenserver.de (node=mrbap2) with ESMTP (Nemesis)
 id 0LiWYm-1Udzfs2U0a-00d0V4; Thu, 07 Feb 2013 22:22:52 +0100
Received: from samsung (546BF816.cm-12-4d.dynamic.ziggo.nl [84.107.248.22])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 2F682C00CF;
 Thu,  7 Feb 2013 22:22:52 +0100 (CET)
Date: Thu, 07 Feb 2013 22:22:51 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Thomas Gazagnaire <thomas@ocamlpro.com>
In-Reply-To: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com> (from
 thomas@ocamlpro.com on Thu Feb  7 21:39:39 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1360272171.18230.10@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:t3rki7eXpEf1nVDiuvusqQfR+dcoXkb6+Lb3D6ytviA
 1FXWWEWXF2dWqvxX4cexX+lT5Pi3z9Wbjd3+FefRbGNW4wzena
 IMEv97wl7/0Rlay1bQm7D6601UVoNIIo77ihzjo/MzMx6RqcSC
 3s+4X82VkncNPIbG04iN8lCxY4UVsag996a/wcjx6Ip8PWTWty
 arL0rqZR+Y58KduDt5ZN/ifYzKgYRwifOo5YDeaKdzcueeyOT/
 QbjR3IeYT3j60BkOd/hukaojiYh8HsMNGoNJuwOxrsmWa7W2Ll
 VBDUKBLCKeYuegbeV96FsL3R5IzzaTCpWQGXxCiKVBNtiERVKQ
 5py99jHGf8C2LT0Agv8U=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 21:18:01 -0000

Am 07.02.2013 21:39:39 schrieb(en) Thomas Gazagnaire:
> Hi all,
>=20
> In my opinion as a *user* of camlp4, the main pitfall that I can see =20
> (and which has not yet been addressed) is that it is really slowing =20
> down the compilation process. To improve that, the usual methods are:
> 1. to use native syntax extensions
> 2. to statically link the syntax extensions into one preprocessor =20
> binary

Well, Alain started with the suggestion to run all preprocessors as =20
separate binaries. Of course, if you have many preprocessors or many =20
files to preprocess, this will become slow. Under the most common =20
assumption, though, namely that only a few files need preprocessing at =20
all, this is no problem, and certainly the most flexible option.

Regarding dynloading. First, it's not only that native dynloading does =20
not work on all platforms. Worse, not even bytecode dynloading works =20
everywhere when it comes to loading external C libraries (which may be =20
required here and there). Because of this, we should design without =20
dynloading in mind, and at most consider this as an accelarator that is =20
available on certain platforms only.

In my opinion, there should be ppx drivers (=3D something that turns a =20
preprocessor into a program suited for -ppx). The simple default driver =20
just pipes the parsetree through the preprocessors, and these are =20
running as subprocesses. But it should also be possible to link a =20
custom ppx driver for the not-so-frequent cases that the preprocessors =20
are needed often. And finally, there could also be a ppx driver that =20
dynloads.

I guess the details are not so complicated to figure out (e.g. define a =20
module type a ppx preprocessor must satisfy, and have some utilities to =20
"make this a program", "make this a dynloadable extension", and "bind =20
several ppx processors together").

> Currently, 1. is very broken  (natdynlink doesn't work on all =20
> platforms and most of the syntax packages do not install their native =20
> libraries anyway) and 2. is not very flexible because of lack of =20
> tooling, and so very rarely used.
>=20
> So, if we decide to switch to a new preprocessing tool, I guess it's =20
> important to get these hings right:
> * it should be easy enough for external tools to statically build =20
> pre-processors.
> * the new preprocessor should be benchmarked on realistic examples to =20
> see how much time we gain vs. camlp4. A good example might be mirage =20
> which is using only pa_lwt and cstruct (or xen-api which is using =20
> only ocaml-rpc, or core but that maybe too much syntax in one go).

Fully agreed to both points.

Gerd

>=20
> Best,
> Thomas
> PS: I'm not speaking about the bootstraping time of camlp4, which is =20
> indeed very painful, but which doesn't really affect the end-user =20
> once the compiler is installed.
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
>=20



--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From bobzhang1988@gmail.com  Thu Feb  7 21:24:51 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0DA673C07C
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Feb 2013 21:24:51 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.5 from SpamAssassin-3.3.2-1442869 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.180 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f180.google.com ([209.85.220.180]:52552)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U3Z2M-0004oq-sU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 07 Feb 2013 21:29:43 +0000
Received: by mail-vc0-f180.google.com with SMTP id fo13so1912342vcb.39
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Feb 2013 13:29:42 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:message-id:date:from:user-agent:mime-version:to:cc
 :subject:references:in-reply-to:content-type
 :content-transfer-encoding;
 bh=HEWGFCwqUDBB2QB25e7vqlu/eukSpGX82/Ch0EIhun0=;
 b=N4zSlsRjP+pvliBV0KIGEY4tagGWTbZNCnnXiR0N2s9WPbpWOXYsmc9yF2cQR2k8ba
 bAa3LdEJzrNQyqM2SxMMcis+snCV1MEZzcc1FXpv8gJ6LxtIFIpdu1F+YVvqO3Olgk+T
 xiSyR9MKnCU2f58mTG4K8+e1SexToH7mYninnOE4stoWRThWtutRHRN4xPqheU71/imh
 Y7/FB9leoqaagvGOTbqfQZQRlaS6nP0GTrI96PN6MLsRcccuKNoGM1jUEC4EE/sf69Oa
 WXdVCGjf4WMMZ4+YN/lebDvtoATwCjZK10enKXxOUsfAcv//sT0Hu6YvCbX1HdrERwHO
 1t0A==
X-Received: by 10.220.116.5 with SMTP id k5mr3674804vcq.55.1360272582107;
 Thu, 07 Feb 2013 13:29:42 -0800 (PST)
Received: from vagvlan536.0716.wlan.vpul.upenn.edu
 (vagvlan536.0716.wlan.vpul.upenn.edu. [158.130.211.49])
 by mx.google.com with ESMTPS id kn18sm39955862veb.5.2013.02.07.13.29.41
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Thu, 07 Feb 2013 13:29:41 -0800 (PST)
Message-ID: <51141CC7.60201@gmail.com>
Date: Thu, 07 Feb 2013 16:29:43 -0500
From: Hongbo Zhang <bobzhang1988@gmail.com>
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Gerd Stolpmann <info@gerd-stolpmann.de>
References: <1360272171.18230.10@samsung>
In-Reply-To: <1360272171.18230.10@samsung>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Feb 2013 21:24:51 -0000

On 2/7/13 4:22 PM, Gerd Stolpmann wrote:
> Am 07.02.2013 21:39:39 schrieb(en) Thomas Gazagnaire:
>> Hi all,
>>
>> In my opinion as a *user* of camlp4, the main pitfall that I can see 
>> (and which has not yet been addressed) is that it is really slowing 
>> down the compilation process. To improve that, the usual methods are:
>> 1. to use native syntax extensions
>> 2. to statically link the syntax extensions into one preprocessor binary
>
Fan encourages static linking to native code, that's to say "linking all 
your plugins as much as possible", unlike p4 the linking does not have 
any side effects, it registers the features it could provide,  each file 
itself tells what features it want to use.
> Well, Alain started with the suggestion to run all preprocessors as 
> separate binaries. Of course, if you have many preprocessors or many 
> files to preprocess, this will become slow. Under the most common 
> assumption, though, namely that only a few files need preprocessing at 
> all, this is no problem, and certainly the most flexible option.
>
> Regarding dynloading. First, it's not only that native dynloading does 
> not work on all platforms. Worse, not even bytecode dynloading works 
> everywhere when it comes to loading external C libraries (which may be 
> required here and there). Because of this, we should design without 
> dynloading in mind, and at most consider this as an accelarator that 
> is available on certain platforms only.
>
> In my opinion, there should be ppx drivers (= something that turns a 
> preprocessor into a program suited for -ppx). The simple default 
> driver just pipes the parsetree through the preprocessors, and these 
> are running as subprocesses. But it should also be possible to link a 
> custom ppx driver for the not-so-frequent cases that the preprocessors 
> are needed often. And finally, there could also be a ppx driver that 
> dynloads.
>
> I guess the details are not so complicated to figure out (e.g. define 
> a module type a ppx preprocessor must satisfy, and have some utilities 
> to "make this a program", "make this a dynloadable extension", and 
> "bind several ppx processors together").
>
>> Currently, 1. is very broken  (natdynlink doesn't work on all 
>> platforms and most of the syntax packages do not install their native 
>> libraries anyway) and 2. is not very flexible because of lack of 
>> tooling, and so very rarely used.
>>
>> So, if we decide to switch to a new preprocessing tool, I guess it's 
>> important to get these hings right:
>> * it should be easy enough for external tools to statically build 
>> pre-processors.
>> * the new preprocessor should be benchmarked on realistic examples to 
>> see how much time we gain vs. camlp4. A good example might be mirage 
>> which is using only pa_lwt and cstruct (or xen-api which is using 
>> only ocaml-rpc, or core but that maybe too much syntax in one go).
>
> Fully agreed to both points.
>
> Gerd
>
>>
>> Best,
>> Thomas
>> PS: I'm not speaking about the bootstraping time of camlp4, which is 
>> indeed very painful, but which doesn't really affect the end-user 
>> once the compiler is installed.
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>>
>>
>
>
>


From yminsky@janestreet.com  Fri Feb  8 01:13:59 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C64A53C07C
 for <wg-camlp4@lists.ocaml.org>; Fri,  8 Feb 2013 01:13:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1442869 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:39961
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U3cc3-0007Jm-pg (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Fri, 08 Feb 2013 01:18:53 +0000
Received: from tot-smtp.delacy.com ([172.27.22.35] helo=tot-is-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1U3cbi-0001kx-Aa
 for wg-camlp4@lists.ocaml.org; Thu, 07 Feb 2013 20:18:26 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-is-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1U3cbg-0000ep-RH
 for wg-camlp4@lists.ocaml.org; Thu, 07 Feb 2013 20:18:24 -0500
Received: from mail-fa0-f71.google.com ([209.85.161.71])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1U3cbg-0001c4-NB
 for wg-camlp4@lists.ocaml.org; Thu, 07 Feb 2013 20:18:24 -0500
Received: by mail-fa0-f71.google.com with SMTP id m1so1756682fam.10
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Feb 2013 17:18:24 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type;
 bh=dHXfVf7XQ9E5NsB4YI3F6ny/p3NHkC1ylswp7uivUX8=;
 b=LwsN+SgLDAXzglsrow5tadGFtPnVXxVTu1SJy7jXmP3Dxv+agbrNlsyHRiCYbrraEh
 xVOcbERc7ei9Or2DnXPtGN1h/nEXzW9bRSVQmL2AK+WuaOFH3jiltN6w6ttXsfg7MG+D
 r0J7/VtGfQFBacgCH9z/ZDsXLKBNcRrkkGK7E=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type:x-gm-message-state;
 bh=dHXfVf7XQ9E5NsB4YI3F6ny/p3NHkC1ylswp7uivUX8=;
 b=E86t/PLxuOKrG8WfLd44PS6+49hIPrWhIYlRT1g5eabQFUsp6SA2R7/xSwpouh/X2c
 Nabom2FMcx1uDNbARxgcQTBAC6Totx4w15KfQvhY3Bw8Jj9oRIDpMPSVVLi/TePCSFXo
 Uv0GtM1oqOCKcMc0ZiwcBfedE7ufJzglP8iAUL0V2JVpugmffJJ9pTKgTHOf35zl3IUr
 XImK88w9THPUTDlNrhrc0pJL18hnZjjcCcYp9fr0Wu0iqYr1vPjx3X7wzHWa8QcW8ehP
 kiOskMYsyFDWT1ZTgnGLv939jsx/lZjJH+rfFuIVPFkOPfb0zjYxvxRVnaf9pQUscFND
 8Y0g==
X-Received: by 10.14.2.196 with SMTP id 44mr10060682eef.25.1360286304054;
 Thu, 07 Feb 2013 17:18:24 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.14.2.196 with SMTP id 44mr10060656eef.25.1360286303849; Thu,
 07 Feb 2013 17:18:23 -0800 (PST)
Received: by 10.223.141.66 with HTTP; Thu, 7 Feb 2013 17:18:23 -0800 (PST)
In-Reply-To: <1360272171.18230.10@samsung>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <1360272171.18230.10@samsung>
Date: Thu, 7 Feb 2013 20:18:23 -0500
Message-ID: <CACLX4jQE-=8Kk8bjfncLFNrwv+UCi2X_KCOeyJrUJoze7O8FmQ@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: Gerd Stolpmann <info@gerd-stolpmann.de>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQm8RNumDVr6CcasVXGmsomJIbOJZlD/R5UfJfKY57tb60EMPTNFUMdFPI7xUgP2qYekLfMfFwGH8XxybssIzNAE5sWWLOfTakRYepAnSEPmTzlpu8bUAQ+kgKqUM/cIVKUYl/ce1CnK7ih52jMd5WeGXTrhhw==
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 08 Feb 2013 01:13:59 -0000

On Thu, Feb 7, 2013 at 4:22 PM, Gerd Stolpmann <info@gerd-stolpmann.de> wrote:
> Am 07.02.2013 21:39:39 schrieb(en) Thomas Gazagnaire:
>
>> Hi all,
>>
>> In my opinion as a *user* of camlp4, the main pitfall that I can see (and
>> which has not yet been addressed) is that it is really slowing down the
>> compilation process. To improve that, the usual methods are:
>> 1. to use native syntax extensions
>> 2. to statically link the syntax extensions into one preprocessor binary
>
>
> Well, Alain started with the suggestion to run all preprocessors as separate
> binaries. Of course, if you have many preprocessors or many files to
> preprocess, this will become slow. Under the most common assumption, though,
> namely that only a few files need preprocessing at all, this is no problem,
> and certainly the most flexible option.

I'm not sure this should be the basic assumption.  At Jane Street,
essentially all of our files are processed by camlp4.  Extensions like
sexplib and camlp4 are at their best when used fairly pervasively.

That said, I could easily imagine that we would build a single, fast
binary that combined all of our transformations into one, if that
turns out to be a bottleneck.

> Regarding dynloading. First, it's not only that native dynloading does not
> work on all platforms. Worse, not even bytecode dynloading works everywhere
> when it comes to loading external C libraries (which may be required here
> and there). Because of this, we should design without dynloading in mind,
> and at most consider this as an accelarator that is available on certain
> platforms only.
>
> In my opinion, there should be ppx drivers (= something that turns a
> preprocessor into a program suited for -ppx). The simple default driver just
> pipes the parsetree through the preprocessors, and these are running as
> subprocesses. But it should also be possible to link a custom ppx driver for
> the not-so-frequent cases that the preprocessors are needed often. And
> finally, there could also be a ppx driver that dynloads.
>
> I guess the details are not so complicated to figure out (e.g. define a
> module type a ppx preprocessor must satisfy, and have some utilities to
> "make this a program", "make this a dynloadable extension", and "bind
> several ppx processors together").
>
>
>> Currently, 1. is very broken  (natdynlink doesn't work on all platforms
>> and most of the syntax packages do not install their native libraries
>> anyway) and 2. is not very flexible because of lack of tooling, and so very
>> rarely used.
>>
>> So, if we decide to switch to a new preprocessing tool, I guess it's
>> important to get these hings right:
>> * it should be easy enough for external tools to statically build
>> pre-processors.
>> * the new preprocessor should be benchmarked on realistic examples to see
>> how much time we gain vs. camlp4. A good example might be mirage which is
>> using only pa_lwt and cstruct (or xen-api which is using only ocaml-rpc, or
>> core but that maybe too much syntax in one go).
>
>
> Fully agreed to both points.
>
> Gerd
>
>
>>
>> Best,
>> Thomas
>> PS: I'm not speaking about the bootstraping time of camlp4, which is
>> indeed very painful, but which doesn't really affect the end-user once the
>> compiler is installed.
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>>
>>
>
>
>
> --
> ------------------------------------------------------------
> Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
> Creator of GODI and camlcity.org.
> Contact details:        http://www.camlcity.org/contact.html
> Company homepage:       http://www.gerd-stolpmann.de
> ------------------------------------------------------------
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From alain.frisch@lexifi.com  Fri Feb  8 06:08:32 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B2CDF3C07C
 for <wg-camlp4@lists.ocaml.org>; Fri,  8 Feb 2013 06:08:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1443355 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:42840)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U3hDC-0000Zu-mQ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 08 Feb 2013 06:13:26 +0000
Received: from [192.168.0.11] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id A2962A6260;
 Fri,  8 Feb 2013 07:13:21 +0100 (CET)
Message-ID: <51149780.1010302@lexifi.com>
Date: Fri, 08 Feb 2013 07:13:20 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Thomas Gazagnaire <thomas@ocamlpro.com>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
In-Reply-To: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 08 Feb 2013 06:08:32 -0000

On 2/7/2013 9:39 PM, Thomas Gazagnaire wrote:
> In my opinion as a *user* of camlp4, the main pitfall that I can see
> (and which has not yet been addressed) is that it is really slowing
> down the compilation process.
 >
> So, if we decide to switch to a new preprocessing tool, I guess it's important to get these hings right:
> * it should be easy enough for external tools to statically build pre-processors.
> * the new preprocessor should be benchmarked on realistic examples to see how much time we gain vs. camlp4. A good example might be mirage which is using only pa_lwt and cstruct (or xen-api which is using only ocaml-rpc, or core but that maybe too much syntax in one go).

It is certainly a good idea to do some benchmarks with the -ppx, I'll 
try to find some time to do so.

*If* performance is not satisfactory,  one should then identify the 
respective contributions of:

  1. Marshaling / demarshaling AST on the process boundaries.
  2. Spawning new processes.
  3. Traversing the AST with the ast_mapper class (overhead of method 
dispatch) and rebuilding a new AST in memory.

I doubt 3 would be a problem even with a lot of ppx rewriters, 
especially because they can be native code programs on platforms which 
support ocamlopt (even if native dynlink is not supported). *If* 1 or 2 
become a bottleneck,  one should indeed consider ways to avoid them.

The current version of ast_mapper:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/parsing/ast_mapper.mli?view=markup

provides a very simple "registration" API:

=========================================================================
val register_function: (string -> (string list -> mapper) -> unit) ref

val register: string -> (string list -> #mapper) -> unit

     (** Apply the [register_function].  The default behavior is to run
         the mapper immediately, taking arguments from the process
         command line.  This is to support a scenario where a mapper is
         linked as a stand-alone executable.

         It is possible to overwrite the [register_function] to define
         "-ppx drivers", which combine several mappers in a single
         process.  Typically, a driver starts by defining
         [register_function] to a custom implementation, then lets ppx
         rewriters (linked statically or dynamically) register
         themselves, and then run all or some of them.  It is also
         possible to have -ppx drivers apply rewriters to only specific
         parts of an AST.  *)
=========================================================================

The main program of a typical ppx tool would look like:


let mapper _args =
    object
       inherit Ast_mapper.mapper
       method! expr = ...
    end

let () = Ast_mapper.register "foo" mapper


When linked as a stand-alone program, this produces something which can 
be readily used as a -ppx rewriter.  But it is also possible to create 
"ppx drivers" which link code as above statically or dynamically (and 
then decide to run it or not).  It would even be possible to provide a 
hook in the compiler so as to make it possible (through compiler-libs) 
to link statically custom versions of ocamldep.opt / ocamlc.opt / 
ocamlopt.opt with statically linked "ppx rewriters" (avoiding any 
marshaling of the AST or any extra process).  I can imagine that for 
huge code base, this could be considered.


Alain

From alain.frisch@lexifi.com  Fri Feb  8 06:10:56 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A7AED3C07C
 for <wg-camlp4@lists.ocaml.org>; Fri,  8 Feb 2013 06:10:56 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1443355 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:47358)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U3hFW-0000uq-nb (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 08 Feb 2013 06:15:50 +0000
Received: from [192.168.0.11] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 37FFDA6274;
 Fri,  8 Feb 2013 07:15:46 +0100 (CET)
Message-ID: <51149810.7020502@lexifi.com>
Date: Fri, 08 Feb 2013 07:15:44 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Thomas Gazagnaire <thomas@ocamlpro.com>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com>
In-Reply-To: <51149780.1010302@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 08 Feb 2013 06:10:56 -0000

On 2/8/2013 7:13 AM, Alain Frisch wrote:
>   1. Marshaling / demarshaling AST on the process boundaries.
>   2. Spawning new processes.
>   3. Traversing the AST with the ast_mapper class (overhead of method
> dispatch) and rebuilding a new AST in memory.

I forgot:

4. Passing marshaled AST through temporary files.


This is the most portable solution, and the only available with the 
standard library, but one could certainly do better under certain platforms.

-- Alain

From alain.frisch@lexifi.com  Mon Feb 11 10:01:44 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AD9B73C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 10:01:44 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1444510 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:35679
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U4qHg-0006jt-ol (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 11 Feb 2013 10:06:49 +0000
Received: from [192.168.1.112] ([92.151.93.123]) by mwinf5d34 with ME
 id yy6n1k00k2fi5KQ03y6nGQ; Mon, 11 Feb 2013 11:06:48 +0100
Message-ID: <5118C2B8.4070807@lexifi.com>
Date: Mon, 11 Feb 2013 11:06:48 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com>
In-Reply-To: <51149780.1010302@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 10:01:44 -0000

On 02/08/2013 07:13 AM, Alain Frisch wrote:
> It is certainly a good idea to do some benchmarks with the -ppx, I'll
> try to find some time to do so.

Here we go.

I've done some timings for compiling typing/typecore.ml from the OCaml 
distribution with ocamlopt.opt, applying the sedlex AST mapper several 
times.

0.43s  ocamlopt.opt, no ppx
0.73s  ocamlopt.opt, 10 -ppx sedlex rewriters
0.98s  ocamlopt.opt, 20 -ppx sedlex rewriters
1.70s  ocamlopt.opt, 40 -ppx sedlex rewriters
0.54s  ocamlopt.opt, sedlex dynlinked by ppx_driver and run 10 times
0.58s  ocamlopt.opt, sedlex dynlinked by ppx_driver and run 20 times
0.68s  ocamlopt.opt, sedlex dynlinked by ppx_driver and run 40 times
0.84s  ocamlopt.opt, sedlex dynlinked by ppx_driver and run 80 times

0.57s  ocamlopt.opt, sedlex dynlinked by ppx_driver and run 80 times, 
with OCAMLRUNPARAM=s=32M (for ppx_driver only, not ocamlopt.opt itself)
0.45s  ocamlopt.opt, sedlex dynlinked by ppx_driver and run 80 times, 
with OCAMLRUNPARAM=s=32M for both ppx_driver and ocamlopt.opt itself

(Timings are user time, averaged over 5 runs, on a Linux 64-bit system. 
  Variance is quite high, though, so this should be taken with a grain 
of salt.)

Note: ppx_driver dynlinks sedlex.cmxs only once and runs it N times.
For big values of N, this gives a performance profile similar to static 
linking.

Intepretation:

- Running AST rewriters as independent processes adds about 7% of 
compilation time with ocamlopt.opt
- If we run a single process without marshaling the AST between 
rewriters, the marginal cost goes below 1% per rewriter.  (This is, 
basically, the cost of iterating over the AST with objects, matching 
over each expression to find extension "markers", and rebuilding a deep 
copy of the AST.)
- This can be reduced a lot with proper configuration of the GC (down to 
about 0.3% of compilation time with ocamlopt.opt, with the same GC config).
- It would be interesting to do some timings when dynlinking a lot of 
different .cmxs plugins in ppx_drivers.

(If we link the rewriters statically with a custom version of the 
compiler itself, assuming a new hook in the compiler allows to plug AST 
rewriter, we would only pay the marginal cost < 1%.)

For a code base like Jane Street's where many "extensions" have to be 
used everywhere, I suspect that the "independent" ppx processes might 
become an issue (or maybe not, if compared to camlp4), but the following 
solutions would work:

  - Statically linking a "big rewriter" called with -ppx.
  - Statically linking a version of ocamlopt.opt + all rewriters.
  - Dynamically linking all rewriters with a single ppx driver (to be 
confirmed, there would be a small overhead for the dynamic linking 
itself in addition to the 0.3% marginal cost above).




Alain

From alain.frisch@lexifi.com  Mon Feb 11 10:23:01 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 28DE53C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 10:23:01 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1444510 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:47916
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U4qcH-00059N-Wy (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 11 Feb 2013 10:28:05 +0000
Received: from [192.168.1.112] ([92.151.93.123]) by mwinf5d34 with ME
 id yyU31k00w2fi5KQ03yU34c; Mon, 11 Feb 2013 11:28:04 +0100
Message-ID: <5118C7B5.8010309@lexifi.com>
Date: Mon, 11 Feb 2013 11:28:05 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hongbo Zhang <hongboz@seas.upenn.edu>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
 <CANcqPu7QQDAwL3tTMOSbW2q5jhjtYpFF4SntH_NF336o9cOdLA@mail.gmail.com>
 <51137D59.7050308@lexifi.com>
 <CANcqPu7eG0v16GXkzz0kaQ66KLGT-sVGRTpYeVt9bHmr+eSUoA@mail.gmail.com>
 <5113D846.3080703@lexifi.com>
 <CANcqPu6HjyvpRSG5AOiYEPnLYjeJwT2iTL6gV_MtO45L_UUDtA@mail.gmail.com>
In-Reply-To: <CANcqPu6HjyvpRSG5AOiYEPnLYjeJwT2iTL6gV_MtO45L_UUDtA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 10:23:01 -0000

On 02/07/2013 08:50 PM, Hongbo Zhang wrote:
> On Thu, Feb 7, 2013 at 11:37 AM, Alain Frisch <alain.frisch@lexifi.com
> <mailto:alain.frisch@lexifi.com>> wrote:
>     I don't follow. We are talking, basically, about adding simple
>     constructions to the AST, like:
>
>        Pexp_annotation of expression * expression
>        Pexp_extension of string * expression
>
>     and you were suggesting that this would almost kill Camlp4/Fan. Why?
>
> The problem is that I am a bit unclear how to encode them in the
> meta-level, since the introduced constructs will not be consumed by the
> type checker, they are provided for the convenience of ppx, but does not
> exist in real world.  I think camlp5 and Coq maintainers will also
> appreciate that we are a bit conservative in the compiler part.

Again, I'm lost.  Why is that difficult to support the suggested 
extensions to the grammar of OCaml in camlp4/camlp4/fan?  The fact that 
attributes are ignored (or propagated) by the type-checker does not 
change anything: Pexp_annotation is just like a binary operator from a 
syntactic point of view.  And what has Coq to do with it?

> First, I guess most people will seldom write ppx, and they have to
> remember all those function names for once use a year. Quosi-quotation
> is so intuitive that you don't need remember anything.

Yes, to write (robust) code generators or transformers, you need to know 
about the OCaml AST.  I suspect most people who have written Camlp4 
extensions are somehow familiar with the OCaml parse tree.  And we 
should make the Parsetree more accessible:

  - Clean up some of its rough edges (or introduce a variant of 
Parsetree which looks more like a parse tree than an AST; I'm not 
completely decided on that point yet).

  - Provide a tool / compiler command-line option to dump a fragment of 
parsed source code in "Parsetree" syntax (as discussed with X. Clerc on 
this list).



> Second, as I said, quosi-quotation works so nice with IDE or Emacs,
> since you can expand code any time you want, just one key binding, the
> expanded code just show up in my emacs buffer

Could you clarify how this would work?  My understanding of quotations 
in Fan is still that they should be completely ignored by editors, 
because you can put arbitrary syntax in them, so it doesn't make sense 
to apply OCaml "rules" (coloring, indentation, folding, etc) to them.


> Third, this way to construct code is very limited, think about how you
> encode the ast, "{:expr| {:expr| a + b|} |}"

It's a good example of something I've never wanted to do and which is 
not required to implement any of the "extensions" I'd be interested to use.



Regards,

Alain

From anil@recoil.org  Mon Feb 11 10:26:11 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6ED743C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 10:26:11 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1444510
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:9508
 helo=dark.recoil.org)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with smtp id 1U4qfK-0006MW-rZ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Mon, 11 Feb 2013 10:31:16 +0000
Received: (qmail 16921 invoked by uid 634); 11 Feb 2013 10:31:14 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from volstagg-0.srg.cl.cam.ac.uk (HELO [10.0.1.83]) (128.232.32.232)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Mon, 11 Feb 2013 10:31:14 +0000
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <5118C2B8.4070807@lexifi.com>
Date: Mon, 11 Feb 2013 10:31:15 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 10:26:11 -0000

On 11 Feb 2013, at 10:06, Alain Frisch <alain.frisch@lexifi.com> wrote:
>=20
> For a code base like Jane Street's where many "extensions" have to be =
used everywhere, I suspect that the "independent" ppx processes might =
become an issue (or maybe not, if compared to camlp4), but the following =
solutions would work:
>=20
> - Statically linking a "big rewriter" called with -ppx.

This worked well in the case of Mirage; in the monolithic repository, we =
link together all the camlp4 extensions into a single big one, and =
invoke that across all files.

It should work just fine with ppx, and has the advantage of reducing the =
number of ocamlfind calls per-file (which is a considerable overhead on =
large projects, since it has to scan the META directories on every =
invocation).

There's also the advantage in camlp4 that this checks that syntax =
extensions do not conflict. This is less of an issue with ppx, =
thankfully.

-anil=

From gabriel.scherer@gmail.com  Mon Feb 11 10:41:33 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B77453C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 10:41:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1444510 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.48 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f48.google.com ([209.85.214.48]:47162)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U4quD-0005IB-rd (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Mon, 11 Feb 2013 10:46:38 +0000
Received: by mail-bk0-f48.google.com with SMTP id jf20so2564784bkc.35
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 02:46:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=lWVgB0atIBxDhALH3j7ad8yhIyzeLFCCLrpSlw/S7mo=;
 b=B1e5Rri28hnvhcV/w+xpQ4plFO0/yOoP/q1oP8l13sF6YTIyb77SRQjAd123D05aDy
 XBPBLxsOZersGuglDcN9ZJ5KykraiZt3C+etRT6KoYdFLfE4JWgeBvb+mbcMWCGdZolm
 PKSD3M5P4ExTPaeo9u+cGb+RK1G3hsEkMGv93SH8uFbVcoH1U+wDIoA0JoX2boJugVvI
 JEtTvXQ/6NPnh7fZbNIbsHBN6NvAdDpi1jhGXfkYXnlWkITG8BczLdJAQ28GF3WgtfST
 aOTuWt/iSQblzYWgPGc7wB0wPKW+cj4aNVcwQ327BXj/EuhY0vaGpWLXGVKUImy+wAIL
 NkPg==
X-Received: by 10.204.11.87 with SMTP id s23mr3912241bks.113.1360579597309;
 Mon, 11 Feb 2013 02:46:37 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Mon, 11 Feb 2013 02:45:57 -0800 (PST)
In-Reply-To: <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Mon, 11 Feb 2013 11:45:57 +0100
Message-ID: <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
To: Anil Madhavapeddy <anil@recoil.org>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 10:41:33 -0000

On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org> wrote:
> It should work just fine with ppx, and has the advantage of reducing the number of ocamlfind calls per-file (which is a considerable overhead on large projects, since it has to scan the META directories on every invocation).

That's of course rather orthogonal to the present discussion, but have
you been in contact with Gerd to see if some caching solution would be
possible? Intuitively it feels like ocamlfind could easily maintain a
cache in /var/run/blah and only clean it on install/remove commands.

(An external process invocation would still make some overhead so in
you're case you'd still have to go all the way, but that could improve
the threshold at which such ~hacks become interesting.)

On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org> wrote:
> On 11 Feb 2013, at 10:06, Alain Frisch <alain.frisch@lexifi.com> wrote:
>>
>> For a code base like Jane Street's where many "extensions" have to be used everywhere, I suspect that the "independent" ppx processes might become an issue (or maybe not, if compared to camlp4), but the following solutions would work:
>>
>> - Statically linking a "big rewriter" called with -ppx.
>
> This worked well in the case of Mirage; in the monolithic repository, we link together all the camlp4 extensions into a single big one, and invoke that across all files.
>
> It should work just fine with ppx, and has the advantage of reducing the number of ocamlfind calls per-file (which is a considerable overhead on large projects, since it has to scan the META directories on every invocation).
>
> There's also the advantage in camlp4 that this checks that syntax extensions do not conflict. This is less of an issue with ppx, thankfully.
>
> -anil
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From gabriel.scherer@gmail.com  Mon Feb 11 10:44:49 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BCF053C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 10:44:49 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1444510 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.46 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f46.google.com ([209.85.214.46]:60244)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U4qxN-0006se-Y7 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Mon, 11 Feb 2013 10:49:54 +0000
Received: by mail-bk0-f46.google.com with SMTP id j5so2577398bkw.33
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 02:49:53 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=wjoIZYWdO2iXu51+BW+WZeqV4z1J4M5qIUtM70LLVUI=;
 b=XhFDTdqYFydRgjCNS0gR6vo+6e7LVqOXA8f1f2Q0QxmIKi8IuH3ct37reMsrROzCal
 Q/hcXA3lWUbmyg1QUzhL96oiVDbxA1a5L7VI/Pt9ZHgzpT5UOph8HmkLBqss/LWj1IRo
 LxYV0ZNzADYemK66TqSe1A9mujIXDfHYmGVY432krYFobEPg+lK30vfiUDYTMAMGHTZ7
 l6vqMv76UfkfiqG7jqJHgOyEuHwlCeJpalsfMqDTyTw+jdoyuv1AQ5guxGkAQhiTrmxh
 2S9B1+LAy2gQQDYPyiJgvn1cmTETl4U3/mZEjAwakCppPxkA3fuf6jl6YxghIt1qkOWg
 Rd/w==
X-Received: by 10.204.145.86 with SMTP id c22mr4017999bkv.5.1360579793234;
 Mon, 11 Feb 2013 02:49:53 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Mon, 11 Feb 2013 02:49:13 -0800 (PST)
In-Reply-To: <5118C7B5.8010309@lexifi.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
 <CANcqPu7QQDAwL3tTMOSbW2q5jhjtYpFF4SntH_NF336o9cOdLA@mail.gmail.com>
 <51137D59.7050308@lexifi.com>
 <CANcqPu7eG0v16GXkzz0kaQ66KLGT-sVGRTpYeVt9bHmr+eSUoA@mail.gmail.com>
 <5113D846.3080703@lexifi.com>
 <CANcqPu6HjyvpRSG5AOiYEPnLYjeJwT2iTL6gV_MtO45L_UUDtA@mail.gmail.com>
 <5118C7B5.8010309@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Mon, 11 Feb 2013 11:49:13 +0100
Message-ID: <CAPFanBEwXbjhkViVi-NW9pmH_5hW9+vqz7zZY-2r3WP2B+39KQ@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 10:44:49 -0000

On Mon, Feb 11, 2013 at 11:28 AM, Alain Frisch <alain.frisch@lexifi.com> wrote:
>  - Clean up some of its rough edges (or introduce a variant of Parsetree
> which looks more like a parse tree than an AST; I'm not completely decided
> on that point yet).

Independently of whether we use a separate AST format for syntax
extensions to work on, I have concluded from the -bin-annot work that
we want the surface information to be maintained until the typetree if
possible in a non-invasive way (which enables the promise of doing
typedtree-level manipulation in a way that can be explained back to
the user in terms of her code), so I'm interested in the "keep more
concrete syntax details"-kind of changes bubbling up to the parsetree
and typedtree.

On Mon, Feb 11, 2013 at 11:28 AM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 02/07/2013 08:50 PM, Hongbo Zhang wrote:
>>
>> On Thu, Feb 7, 2013 at 11:37 AM, Alain Frisch <alain.frisch@lexifi.com
>> <mailto:alain.frisch@lexifi.com>> wrote:
>>     I don't follow. We are talking, basically, about adding simple
>>     constructions to the AST, like:
>>
>>        Pexp_annotation of expression * expression
>>        Pexp_extension of string * expression
>>
>>     and you were suggesting that this would almost kill Camlp4/Fan. Why?
>>
>> The problem is that I am a bit unclear how to encode them in the
>> meta-level, since the introduced constructs will not be consumed by the
>> type checker, they are provided for the convenience of ppx, but does not
>> exist in real world.  I think camlp5 and Coq maintainers will also
>> appreciate that we are a bit conservative in the compiler part.
>
>
> Again, I'm lost.  Why is that difficult to support the suggested extensions
> to the grammar of OCaml in camlp4/camlp4/fan?  The fact that attributes are
> ignored (or propagated) by the type-checker does not change anything:
> Pexp_annotation is just like a binary operator from a syntactic point of
> view.  And what has Coq to do with it?
>
>
>> First, I guess most people will seldom write ppx, and they have to
>> remember all those function names for once use a year. Quosi-quotation
>> is so intuitive that you don't need remember anything.
>
>
> Yes, to write (robust) code generators or transformers, you need to know
> about the OCaml AST.  I suspect most people who have written Camlp4
> extensions are somehow familiar with the OCaml parse tree.  And we should
> make the Parsetree more accessible:
>
>  - Clean up some of its rough edges (or introduce a variant of Parsetree
> which looks more like a parse tree than an AST; I'm not completely decided
> on that point yet).
>
>  - Provide a tool / compiler command-line option to dump a fragment of
> parsed source code in "Parsetree" syntax (as discussed with X. Clerc on this
> list).
>
>
>
>
>> Second, as I said, quosi-quotation works so nice with IDE or Emacs,
>> since you can expand code any time you want, just one key binding, the
>> expanded code just show up in my emacs buffer
>
>
> Could you clarify how this would work?  My understanding of quotations in
> Fan is still that they should be completely ignored by editors, because you
> can put arbitrary syntax in them, so it doesn't make sense to apply OCaml
> "rules" (coloring, indentation, folding, etc) to them.
>
>
>
>> Third, this way to construct code is very limited, think about how you
>> encode the ast, "{:expr| {:expr| a + b|} |}"
>
>
> It's a good example of something I've never wanted to do and which is not
> required to implement any of the "extensions" I'd be interested to use.
>
>
>
> Regards,
>
>
> Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From anil@recoil.org  Mon Feb 11 10:51:47 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5252C3C4AA
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 10:51:47 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1444510
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:14347
 helo=dark.recoil.org)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with smtp id 1U4r47-0001dJ-qv (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Mon, 11 Feb 2013 10:56:51 +0000
Received: (qmail 6837 invoked by uid 634); 11 Feb 2013 10:56:51 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from volstagg-0.srg.cl.cam.ac.uk (HELO [10.0.1.83]) (128.232.32.232)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Mon, 11 Feb 2013 10:56:50 +0000
Content-Type: text/plain; charset=iso-8859-1
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
Date: Mon, 11 Feb 2013 10:56:52 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <6E9F4686-250B-4C25-8149-A952543B3BE7@recoil.org>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
 <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 10:51:47 -0000

On 11 Feb 2013, at 10:45, Gabriel Scherer <gabriel.scherer@gmail.com> =
wrote:

> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org> =
wrote:
>> It should work just fine with ppx, and has the advantage of reducing =
the number of ocamlfind calls per-file (which is a considerable overhead =
on large projects, since it has to scan the META directories on every =
invocation).
>=20
> That's of course rather orthogonal to the present discussion, but have
> you been in contact with Gerd to see if some caching solution would be
> possible? Intuitively it feels like ocamlfind could easily maintain a
> cache in /var/run/blah and only clean it on install/remove commands.
>=20
> (An external process invocation would still make some overhead so in
> you're case you'd still have to go all the way, but that could improve
> the threshold at which such ~hacks become interesting.)

I don't think it's necessary to put this in ocamlfind, which does the =
job
it's designed to do very well. Just fix your build systems to run =
ocamlfind
at configure time, save the results, and apply them to the compiler =
flags
during the build phase.

-anil


From gabriel.scherer@gmail.com  Mon Feb 11 12:16:23 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AF96E3C4B9
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 12:16:23 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1444510 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.46 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f46.google.com ([209.85.214.46]:59477)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U4sNz-0007H7-sk (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Mon, 11 Feb 2013 12:21:28 +0000
Received: by mail-bk0-f46.google.com with SMTP id j5so2614526bkw.33
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 04:21:27 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=4wbYfYz+S9KxtfmxdO9BVwsnktgu5WKz6NoeA4ZoWZM=;
 b=MYShi4KtlELasAwIx2S1EkqhVJUOi6GcY2w9rCK/NMOQJ9KAUufx68EgR63IoPQezT
 4nYmjcPhDTccJlQ5cLmJTZreErXOD6VdlCUA2rT2YownFhuCiH1iu02wTnLQkDygzfSL
 /f60DNHhAhGsnqfdCokHqE//b+eRZowx+pBZZw9G5pYbR8yCpAFywdYLYprB/WBv3e1m
 1gDJLN5nM7njCA6U3gIoWANgM+Q4xwptJX2OEbfLzIMAWZWoImTmmaE2srGTtQ6kvrtg
 dpiF+c6hwtLGHH5UPljm3O4hGbxJVlZkuHnHJ3dy4s7TPSPuxfZ6aL9UrYjxLu4R/oWQ
 xV8g==
X-Received: by 10.204.8.71 with SMTP id g7mr3976599bkg.118.1360585287672; Mon,
 11 Feb 2013 04:21:27 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Mon, 11 Feb 2013 04:20:47 -0800 (PST)
In-Reply-To: <6E9F4686-250B-4C25-8149-A952543B3BE7@recoil.org>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
 <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
 <6E9F4686-250B-4C25-8149-A952543B3BE7@recoil.org>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Mon, 11 Feb 2013 13:20:47 +0100
Message-ID: <CAPFanBGnTvCy1MvAP2nsFF3Kv+=RrFOXDjmyOqabJ9cUvVEb_w@mail.gmail.com>
To: Anil Madhavapeddy <anil@recoil.org>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 12:16:23 -0000

On the other hand, build systems come and go (and ./configure is like
the most horrible part to add logic to in most cases), while ocamlfind
has proved a reliable tool as a basis for any OCaml ecosystem so far.
If I can shelve some logic there without making the tool more complex
or less elegant I think that would be better for everyone.

On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy <anil@recoil.org> wrote:
> On 11 Feb 2013, at 10:45, Gabriel Scherer <gabriel.scherer@gmail.com> wrote:
>
>> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org> wrote:
>>> It should work just fine with ppx, and has the advantage of reducing the number of ocamlfind calls per-file (which is a considerable overhead on large projects, since it has to scan the META directories on every invocation).
>>
>> That's of course rather orthogonal to the present discussion, but have
>> you been in contact with Gerd to see if some caching solution would be
>> possible? Intuitively it feels like ocamlfind could easily maintain a
>> cache in /var/run/blah and only clean it on install/remove commands.
>>
>> (An external process invocation would still make some overhead so in
>> you're case you'd still have to go all the way, but that could improve
>> the threshold at which such ~hacks become interesting.)
>
> I don't think it's necessary to put this in ocamlfind, which does the job
> it's designed to do very well. Just fix your build systems to run ocamlfind
> at configure time, save the results, and apply them to the compiler flags
> during the build phase.
>
> -anil
>

From bobzhang1988@gmail.com  Mon Feb 11 13:36:21 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4DF063C4B9
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 13:36:21 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1444510 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.54 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f54.google.com ([209.85.212.54]:35691)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U4tdM-0006lT-rQ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 11 Feb 2013 13:41:26 +0000
Received: by mail-vb0-f54.google.com with SMTP id l1so3782121vba.41
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 05:41:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=eyhBZs9UAZIzh0/tcUVmi/iyjgZlEnqINLWPjAnqKgo=;
 b=Icr1QwII4+oEU822qus4T9BkWHTE7OWkb56X6i/AeLcxv0OuaC5ZK6+TseYiADGUnZ
 zVWKOaTLOQ/aR3uYAoKOZlA1dKvM+/o2W46fF01jaZbEZmYWjMnDLSKZSsf7JKxUIY+5
 N05RVxnRZKbKawKiusDsL8MYFYR9HdWTKvHpbf//4L4ke6yHdSxagn5bTxZ6vmZZbAZA
 SxsI4ia7oP0gn2ppuFWZ4Pf5ysRPjkw3jnm9Ap6Jp0pqAPfn4emO8dr36gvfkAIVdMRk
 g3p2yx+V6ztliz+6ErA2HeIr5mpA2xqGcL9YdHiu+5JaE9QxWTFmnzyRu81BTnERcyos
 jxUw==
MIME-Version: 1.0
X-Received: by 10.52.98.196 with SMTP id ek4mr16879903vdb.16.1360590083784;
 Mon, 11 Feb 2013 05:41:23 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Mon, 11 Feb 2013 05:41:23 -0800 (PST)
In-Reply-To: <5118C7B5.8010309@lexifi.com>
References: <CACLX4jQVFgC1DCXxgCz1VorOkYXQuQsudBYWZ4XTw+QZJY5b-A@mail.gmail.com>
 <20130205150603.GV13082@three-tuns.net>
 <CACLX4jQaRxRd6DS2VJB_S6ndVLymmKgoDFJHO-GWjco4fzvv3A@mail.gmail.com>
 <Prayer.1.3.5.1302061811120.12086@hermes-1.csi.cam.ac.uk>
 <CANcqPu7QQDAwL3tTMOSbW2q5jhjtYpFF4SntH_NF336o9cOdLA@mail.gmail.com>
 <51137D59.7050308@lexifi.com>
 <CANcqPu7eG0v16GXkzz0kaQ66KLGT-sVGRTpYeVt9bHmr+eSUoA@mail.gmail.com>
 <5113D846.3080703@lexifi.com>
 <CANcqPu6HjyvpRSG5AOiYEPnLYjeJwT2iTL6gV_MtO45L_UUDtA@mail.gmail.com>
 <5118C7B5.8010309@lexifi.com>
Date: Mon, 11 Feb 2013 08:41:23 -0500
X-Google-Sender-Auth: -bYkGsr6ghcpa94A9WnSpWPZDfs
Message-ID: <CANcqPu4+SW26QKB+dk0F+sOV8XGPhkxPyPBbxVZfBTY0cFyRvQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=20cf307ac86da0fe5304d5731023
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Time for a summary?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 13:36:21 -0000

--20cf307ac86da0fe5304d5731023
Content-Type: text/plain; charset=ISO-8859-1

On Mon, Feb 11, 2013 at 5:28 AM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> On 02/07/2013 08:50 PM, Hongbo Zhang wrote:
>
>>
>> Again, I'm lost.  Why is that difficult to support the suggested
> extensions to the grammar of OCaml in camlp4/camlp4/fan?  The fact that
> attributes are ignored (or propagated) by the type-checker does not change
> anything: Pexp_annotation is just like a binary operator from a syntactic
> point of view.  And what has Coq to do with it?
>
> The grammar parser (the same as stream parser) relies on quasi-quotation.
Though I do not know how camlp5 implemented it, but I think they have a
similar implementation. (coq depends on p5)

>
>  First, I guess most people will seldom write ppx, and they have to
>> remember all those function names for once use a year. Quosi-quotation
>> is so intuitive that you don't need remember anything.
>>
>
> Yes, to write (robust) code generators or transformers, you need to know
> about the OCaml AST.  I suspect most people who have written Camlp4
> extensions are somehow familiar with the OCaml parse tree.  And we should
> make the Parsetree more accessible:
>
>  - Clean up some of its rough edges (or introduce a variant of Parsetree
> which looks more like a parse tree than an AST; I'm not completely decided
> on that point yet).
>
>  - Provide a tool / compiler command-line option to dump a fragment of
> parsed source code in "Parsetree" syntax (as discussed with X. Clerc on
> this list).
>
> This is a hack, it may help you to write, but does not help you to read
the code.

>
>
>
>  Second, as I said, quosi-quotation works so nice with IDE or Emacs,
>> since you can expand code any time you want, just one key binding, the
>> expanded code just show up in my emacs buffer
>>
>
> Could you clarify how this would work?  My understanding of quotations in
> Fan is still that they should be completely ignored by editors, because you
> can put arbitrary syntax in them, so it doesn't make sense to apply OCaml
> "rules" (coloring, indentation, folding, etc) to them.

Suppose you embed arbitrary functions to construct the ast,

"E.let_ (E.appfun_ ...)"
If you select the region, the IDE does not know how to expand this region
to view the expanded code.

For quosi-quotaiton, instead
"let a = fun b -> c"
The ide knows how to expanded this part of code to visualize its AST.

>
>
>
>  Third, this way to construct code is very limited, think about how you
>> encode the ast, "{:expr| {:expr| a + b|} |}"
>>
>
> It's a good example of something I've never wanted to do and which is not
> required to implement any of the "extensions" I'd be interested to use.
>
> Sometimes the fact people never think about to do something is due to the
current tool they use does not provide such ability. Nested quotation is a
 common idiom for meta programming

>
>
> Regards,
>
> Alain
>



-- 
-- Regards, Hongbo

--20cf307ac86da0fe5304d5731023
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Mon, Feb 11, 2013 at 5:28 AM, Alain F=
risch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain.frisch@lexifi.com" targ=
et=3D"_blank">alain.frisch@lexifi.com</a>&gt;</span> wrote:<br><blockquote =
class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid=
;padding-left:1ex">
<div class=3D"im">On 02/07/2013 08:50 PM, Hongbo Zhang wrote:<br>
</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-l=
eft:1px #ccc solid;padding-left:1ex"><div class=3D"im"><br></div></blockquo=
te>
Again, I&#39;m lost. =A0Why is that difficult to support the suggested exte=
nsions to the grammar of OCaml in camlp4/camlp4/fan? =A0The fact that attri=
butes are ignored (or propagated) by the type-checker does not change anyth=
ing: Pexp_annotation is just like a binary operator from a syntactic point =
of view. =A0And what has Coq to do with it?<div class=3D"im">
<br></div></blockquote><div>The grammar parser (the same as stream parser) =
relies on quasi-quotation. Though I do not know how camlp5 implemented it, =
but I think they have a similar implementation. (coq depends on p5) =A0</di=
v>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
First, I guess most people will seldom write ppx, and they have to<br>
remember all those function names for once use a year. Quosi-quotation<br>
is so intuitive that you don&#39;t need remember anything.<br>
</blockquote>
<br></div>
Yes, to write (robust) code generators or transformers, you need to know ab=
out the OCaml AST. =A0I suspect most people who have written Camlp4 extensi=
ons are somehow familiar with the OCaml parse tree. =A0And we should make t=
he Parsetree more accessible:<br>

<br>
=A0- Clean up some of its rough edges (or introduce a variant of Parsetree =
which looks more like a parse tree than an AST; I&#39;m not completely deci=
ded on that point yet).<br>
<br>
=A0- Provide a tool / compiler command-line option to dump a fragment of pa=
rsed source code in &quot;Parsetree&quot; syntax (as discussed with X. Cler=
c on this list).<div class=3D"im"><br></div></blockquote><div>This is a hac=
k, it may help you to write, but does not help you to read the code.</div>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">
<br>
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Second, as I said, quosi-quotation works so nice with IDE or Emacs,<br>
since you can expand code any time you want, just one key binding, the<br>
expanded code just show up in my emacs buffer<br>
</blockquote>
<br></div>
Could you clarify how this would work? =A0My understanding of quotations in=
 Fan is still that they should be completely ignored by editors, because yo=
u can put arbitrary syntax in them, so it doesn&#39;t make sense to apply O=
Caml &quot;rules&quot; (coloring, indentation, folding, etc) to them.</bloc=
kquote>
<div>Suppose you embed arbitrary functions to construct the ast,</div><div>=
<br></div><div>&quot;E.let_ (E.appfun_ ...)&quot;</div><div>If you select t=
he region, the IDE does not know how to expand this region to view the expa=
nded code.</div>
<div><br></div><div>For quosi-quotaiton, instead</div><div>&quot;let a =3D =
fun b -&gt; c&quot;</div><div>The ide knows how to expanded this part of co=
de to visualize its AST.=A0</div><blockquote class=3D"gmail_quote" style=3D=
"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<div class=3D"im"><br>
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Third, this way to construct code is very limited, think about how you<br>
encode the ast, &quot;{:expr| {:expr| a + b|} |}&quot;<br>
</blockquote>
<br></div>
It&#39;s a good example of something I&#39;ve never wanted to do and which =
is not required to implement any of the &quot;extensions&quot; I&#39;d be i=
nterested to use.<br>
<br></blockquote><div>Sometimes the fact people never think about to do som=
ething is due to the current tool they use does not provide such ability. N=
ested quotation is a =A0common idiom for meta programming</div><blockquote =
class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid=
;padding-left:1ex">

<br>
<br>
Regards,<br>
<br>
Alain<br>
</blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regards, =
Hongbo

--20cf307ac86da0fe5304d5731023--

From bobzhang1988@gmail.com  Mon Feb 11 14:02:41 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9BF3B3CBC0
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 14:02:41 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1444510 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.171 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f171.google.com ([209.85.128.171]:38738)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U4u2r-0008Dh-nW (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 11 Feb 2013 14:07:46 +0000
Received: by mail-ve0-f171.google.com with SMTP id b10so5154994vea.30
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 06:07:44 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=GsCY8OlUit0sUm8nA4GPyGlgvd1pLxUa6G5Zy5EaACg=;
 b=oeXJfJI4GIue3hPuwkQw7VAcXX45S/X20MVqt09P9TOXYXGrkXKUz5ejCvHVpgwax6
 j0zdJmMNGwQrXQz5ecbdUt8392JRpSP8d8eeBEpeR1s6rZKu0b5/z4p+xcdkfx5Uf96R
 9o7Q7O3FLqzDrdkFUd70okoxlbTRjnBtpcnftBAFr+H2f+JhaGFNFpqdR/nRT2SWWvy2
 lnt48jhPjJpvss9nGXPJV1yoakHZ37P/6ZudG9k6JA2oBW8ChPlRJBNl4NxBVnF5VxFs
 WTYHM2us2xa9DuIGGD6xWxL/uj+IJE7Y7PNTRrmzh6P2uY8/5fgOb/QamP4hkbZkjRuO
 Nk7Q==
MIME-Version: 1.0
X-Received: by 10.52.72.129 with SMTP id d1mr16627132vdv.109.1360591655292;
 Mon, 11 Feb 2013 06:07:35 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Mon, 11 Feb 2013 06:07:35 -0800 (PST)
In-Reply-To: <CAPFanBGnTvCy1MvAP2nsFF3Kv+=RrFOXDjmyOqabJ9cUvVEb_w@mail.gmail.com>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
 <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
 <6E9F4686-250B-4C25-8149-A952543B3BE7@recoil.org>
 <CAPFanBGnTvCy1MvAP2nsFF3Kv+=RrFOXDjmyOqabJ9cUvVEb_w@mail.gmail.com>
Date: Mon, 11 Feb 2013 09:07:35 -0500
X-Google-Sender-Auth: TwEa1eXrBGTlCPr-8l14t4irH7U
Message-ID: <CANcqPu79E86_oG9z=SEk7RuKn_DOd=MO7PEXkDR_ykAF8TTz6g@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: multipart/alternative; boundary=20cf3071c70a4c4d6e04d5736e69
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 14:02:41 -0000

--20cf3071c70a4c4d6e04d5736e69
Content-Type: text/plain; charset=ISO-8859-1

Some statistics about Fan.

Fan has a mirror directory cold which shares the same structure as src,
it's the expanded code of src for distribution

For the user time
ocamlbuild cold/FanDriver.native
user 0m28.494s
ocamlbuild src/FanDriver.native
user 0m30.680s
For the system time
the cold directory takes
sys 0m3.843s
while the src directory takes
sys 0m4.657s


On Mon, Feb 11, 2013 at 7:20 AM, Gabriel Scherer
<gabriel.scherer@gmail.com>wrote:

> On the other hand, build systems come and go (and ./configure is like
> the most horrible part to add logic to in most cases), while ocamlfind
> has proved a reliable tool as a basis for any OCaml ecosystem so far.
> If I can shelve some logic there without making the tool more complex
> or less elegant I think that would be better for everyone.
>
> On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy <anil@recoil.org>
> wrote:
> > On 11 Feb 2013, at 10:45, Gabriel Scherer <gabriel.scherer@gmail.com>
> wrote:
> >
> >> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org>
> wrote:
> >>> It should work just fine with ppx, and has the advantage of reducing
> the number of ocamlfind calls per-file (which is a considerable overhead on
> large projects, since it has to scan the META directories on every
> invocation).
> >>
> >> That's of course rather orthogonal to the present discussion, but have
> >> you been in contact with Gerd to see if some caching solution would be
> >> possible? Intuitively it feels like ocamlfind could easily maintain a
> >> cache in /var/run/blah and only clean it on install/remove commands.
> >>
> >> (An external process invocation would still make some overhead so in
> >> you're case you'd still have to go all the way, but that could improve
> >> the threshold at which such ~hacks become interesting.)
> >
> > I don't think it's necessary to put this in ocamlfind, which does the job
> > it's designed to do very well. Just fix your build systems to run
> ocamlfind
> > at configure time, save the results, and apply them to the compiler flags
> > during the build phase.
> >
> > -anil
> >
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>



-- 
-- Regards, Hongbo

--20cf3071c70a4c4d6e04d5736e69
Content-Type: text/html; charset=ISO-8859-1

Some statistics about Fan.<div><br></div><div>Fan has a mirror directory cold which shares the same structure as src, it&#39;s the expanded code of src for distribution<div><br></div><div>For the user time</div><div>ocamlbuild cold/FanDriver.native</div>
<div>user<span class="Apple-tab-span" style="white-space:pre">	</span>0m28.494s</div><div>ocamlbuild src/FanDriver.native</div><div>user<span class="Apple-tab-span" style="white-space:pre">	</span>0m30.680s</div><div>For the system time</div>
<div>the cold directory takes</div><div>sys<span class="Apple-tab-span" style="white-space:pre">	</span>0m3.843s</div><div>while the src directory takes</div><div>sys<span class="Apple-tab-span" style="white-space:pre">	</span>0m4.657s</div>
<div><br></div><div><br><div class="gmail_quote">On Mon, Feb 11, 2013 at 7:20 AM, Gabriel Scherer <span dir="ltr">&lt;<a href="mailto:gabriel.scherer@gmail.com" target="_blank">gabriel.scherer@gmail.com</a>&gt;</span> wrote:<br>
<blockquote class="gmail_quote" style="margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">On the other hand, build systems come and go (and ./configure is like<br>
the most horrible part to add logic to in most cases), while ocamlfind<br>
has proved a reliable tool as a basis for any OCaml ecosystem so far.<br>
If I can shelve some logic there without making the tool more complex<br>
or less elegant I think that would be better for everyone.<br>
<div class="HOEnZb"><div class="h5"><br>
On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy &lt;<a href="mailto:anil@recoil.org">anil@recoil.org</a>&gt; wrote:<br>
&gt; On 11 Feb 2013, at 10:45, Gabriel Scherer &lt;<a href="mailto:gabriel.scherer@gmail.com">gabriel.scherer@gmail.com</a>&gt; wrote:<br>
&gt;<br>
&gt;&gt; On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy &lt;<a href="mailto:anil@recoil.org">anil@recoil.org</a>&gt; wrote:<br>
&gt;&gt;&gt; It should work just fine with ppx, and has the advantage of reducing the number of ocamlfind calls per-file (which is a considerable overhead on large projects, since it has to scan the META directories on every invocation).<br>

&gt;&gt;<br>
&gt;&gt; That&#39;s of course rather orthogonal to the present discussion, but have<br>
&gt;&gt; you been in contact with Gerd to see if some caching solution would be<br>
&gt;&gt; possible? Intuitively it feels like ocamlfind could easily maintain a<br>
&gt;&gt; cache in /var/run/blah and only clean it on install/remove commands.<br>
&gt;&gt;<br>
&gt;&gt; (An external process invocation would still make some overhead so in<br>
&gt;&gt; you&#39;re case you&#39;d still have to go all the way, but that could improve<br>
&gt;&gt; the threshold at which such ~hacks become interesting.)<br>
&gt;<br>
&gt; I don&#39;t think it&#39;s necessary to put this in ocamlfind, which does the job<br>
&gt; it&#39;s designed to do very well. Just fix your build systems to run ocamlfind<br>
&gt; at configure time, save the results, and apply them to the compiler flags<br>
&gt; during the build phase.<br>
&gt;<br>
&gt; -anil<br>
&gt;<br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href="mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><br>
<a href="http://lists.ocaml.org/listinfo/wg-camlp4" target="_blank">http://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear="all"><div><br></div>-- <br>-- Regards, Hongbo
</div></div>

--20cf3071c70a4c4d6e04d5736e69--

From anil@recoil.org  Mon Feb 11 14:25:32 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A324A3CBC0
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 14:25:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1444510
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:28888
 helo=dark.recoil.org)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with smtp id 1U4uOz-0002Tn-py (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Mon, 11 Feb 2013 14:30:37 +0000
Received: (qmail 11218 invoked by uid 634); 11 Feb 2013 14:30:36 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from volstagg-0.srg.cl.cam.ac.uk (HELO [10.0.1.83]) (128.232.32.232)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Mon, 11 Feb 2013 14:30:36 +0000
Content-Type: text/plain; charset=iso-8859-1
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <CAPFanBGnTvCy1MvAP2nsFF3Kv+=RrFOXDjmyOqabJ9cUvVEb_w@mail.gmail.com>
Date: Mon, 11 Feb 2013 14:30:35 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <DEF6D517-15E2-4C72-94B3-09DC4E3D6CE6@recoil.org>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
 <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
 <6E9F4686-250B-4C25-8149-A952543B3BE7@recoil.org>
 <CAPFanBGnTvCy1MvAP2nsFF3Kv+=RrFOXDjmyOqabJ9cUvVEb_w@mail.gmail.com>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
X-Mailer: Apple Mail (2.1499)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 14:25:32 -0000

Fix the underlying problem.  There are several build system efforts =
ongoing
at the moment from various folk at JSC/Citrix/other, and we need to =
tackle
that problem head-on.

There'll be a wg-build mailing list next month, after some preparatory =
work
has been done by the people involved.  It's fairly off-topic for this =
list,
so I'll defer further discussion until then.

-anil

On 11 Feb 2013, at 12:20, Gabriel Scherer <gabriel.scherer@gmail.com> =
wrote:

> On the other hand, build systems come and go (and ./configure is like
> the most horrible part to add logic to in most cases), while ocamlfind
> has proved a reliable tool as a basis for any OCaml ecosystem so far.
> If I can shelve some logic there without making the tool more complex
> or less elegant I think that would be better for everyone.
>=20
> On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy <anil@recoil.org> =
wrote:
>> On 11 Feb 2013, at 10:45, Gabriel Scherer <gabriel.scherer@gmail.com> =
wrote:
>>=20
>>> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy =
<anil@recoil.org> wrote:
>>>> It should work just fine with ppx, and has the advantage of =
reducing the number of ocamlfind calls per-file (which is a considerable =
overhead on large projects, since it has to scan the META directories on =
every invocation).
>>>=20
>>> That's of course rather orthogonal to the present discussion, but =
have
>>> you been in contact with Gerd to see if some caching solution would =
be
>>> possible? Intuitively it feels like ocamlfind could easily maintain =
a
>>> cache in /var/run/blah and only clean it on install/remove commands.
>>>=20
>>> (An external process invocation would still make some overhead so in
>>> you're case you'd still have to go all the way, but that could =
improve
>>> the threshold at which such ~hacks become interesting.)
>>=20
>> I don't think it's necessary to put this in ocamlfind, which does the =
job
>> it's designed to do very well. Just fix your build systems to run =
ocamlfind
>> at configure time, save the results, and apply them to the compiler =
flags
>> during the build phase.
>>=20
>> -anil
>>=20
>=20


From alain.frisch@lexifi.com  Mon Feb 11 14:40:44 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8A1F23CBD5
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 14:40:44 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: sss
X-Cam-SpamDetails: score 3.0 from SpamAssassin-3.3.2-1444510 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
 *  3.0 TBIRD_SPOOF Claims Thunderbird mail client but looks suspicious
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:54675
 helo=msa.smtpout.orange.fr)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U4udg-00005A-pY (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 11 Feb 2013 14:45:49 +0000
Received: from [192.168.1.112] ([92.151.93.123]) by mwinf5d63 with ME
 id z2lo1k00X2fi5KQ032lo9z; Mon, 11 Feb 2013 15:45:48 +0100
Message-ID: <51190420.5080305@lexifi.com>
Date: Mon, 11 Feb 2013 15:45:52 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 14:40:44 -0000

Dear all,

I think we have made good progress in discussing extensions to the OCaml 
grammar with generic extension points (which can be used as anchors for 
-ppx rewriters), and how existing "camlp4 extensions" could be 
re-implemented based on them.

Here is a list of questions on which I'd like to hear the opinion of 
participants.

0. Scope of extensions covered by ppx + extension points

Do people see useful camlp4 extensions which couldn't be covered in a 
satisfactory way with the ppx + extension points approach?  The only 
such cases I've seen mentioned on this list are pervasive changes to the 
syntax, where the goal is precisely to customized the concrete syntax.


1. Nature of extension points

There seems to be a consensus that we should distinguish between 
"ignorable" attributes and extension markers, to be expanded by 
rewriters (the type-checker fails on them).  Concretely, this amounts to 
extending the OCaml Parsetree with cases like:

  | Ptyp_attribute of core_type * attribute
  | Ptyp_extension of extension

  | Ppat_attribute of pattern * attribute
  | Ppat_extension of extension

  | Pmod_attribute of module_expr * attribute
  | Pmod_extension of extension

  ...

Leo suggests to take:

type attribute = expression
and extension = longident * expression option

I'm now convinced that it's a good idea to make the "extension name" 
explicit (and not encoded in the expression itself), if only to allow 
nice error messages when the type-checker fails on such a node.  I'm 
wondering if we shouldn't be more symmetric and do the same for 
attributes. Opinions?  Also, I'm not sure that the expression should be 
optional (if the idea is that the extension marker "expands" its 
content, without touching its context "too much", we need a non-trivial 
content).  One can always have a syntax which support "empty argument" 
represented as the "()" expression internally.


2. Concrete syntax for extension points

Proposals are welcome.  We must choose an unambiguous syntax, which 
allows to add an attribute on a structure item, an expression, etc.
Do we want both prefix and suffix syntaxes for attributes on all 
syntactic categories?  Do we want a special (lighter) syntax to attach 
attributes on specific constructions?


3. Quotations

The more I think about it, the more I believe this concept is orthogonal 
to "extensions".  Leo disagrees and would like to have a combined syntax 
for the case where the argument of an extension is a quotation.  What do 
other people think?  (For me, a quotation is only a way to introduce a 
string literal without "suffering" from the lexical conventions of OCaml.)

For the concrete syntax of quotations, it was suggested to use a form 
where the closing delimiter would be defined by the opening one.  This 
makes it possible to "quote" an arbitrary string without having to 
define a way to escape a potential occurrence of the closing delimiter 
(just pick a different one).   Example:  {xxx{blablabla}xxx}

Do people familiar with implementation of editor modes believe it will 
be easy to support such syntax in emacs or vim modes?


4. What to do with attributes in the type-checker

Attributes are designed in a way which make it trivial for the 
type-checker to ignore them, which is a good property.  It is not much 
more difficult to keep in the Typedtree so that they appear in 
.cmt/.cmti files.  This could support interesting tools, like an 
"ocamldoc-like" tool based on those files (instead of having to rarse 
the source file again).  What do people think about it?  Of course, this 
does not need to be implemented right away.

A related question is related to the current work on runtime types. 
Attributes on type declarations could be kept in the runtime 
representation of the declarations, allowing libraries to interpret them 
as they want.  (LexiFi's version of OCaml has been extended with 
attributes on type declarations precisely to do that.)  Having 
attributes defined as general expressions, however, means that those 
libraries would need to link with compiler-libs, or at least be compiled 
against some of its .cmi, in order to be able to analyze the Parsetree. 
  I don't see it is as a big problem, and it would also be possible to 
restrict which expressions are reflected in runtime types (e.g. to 
structured constants).  Comments are welcome!


5. Fork Parsetree or clean it up?

Hongbo has proposed that we introduce a different representation of the 
Parsetree on which -ppx rewriters would be applied.  Concretely, we 
could fork parsetree.mli into parsetree.mli/ast.mli, clean up parsetree 
(see below) and adapt parser.mly accordingly, and then implement a 
translation pass from Parsetree to Ast before running the type-checker 
on Ast.  The alternative is to clean up Parsetree directly and adapt the 
type-checker to these changes.  This avoids an extra intermediate 
language and the mapping, but this could add a little bit of extra 
complexity to the type-checker (and it might be more difficult to 
convince core developers).  What do people think?

Changes (to be discussed):

  - Avoid some desugaring currently done in the parsetree (interval 
patterns, let open M in... = M.(...) ).
  - Avoid some weird encodings (Pexp_when, mandatory Ptyp_poly at some 
places, etc).
  - Make the Parsetree more future proof and self-documented by using 
records instead of tuples, sum types instead of booleans, etc.
  - Remove prefixes on constructors/labels (although I've got some 
negative feedback from other core developers on this point).



Alain

From bobzhang1988@gmail.com  Mon Feb 11 14:46:19 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B4D8F3CBD5
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 14:46:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1444510 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.170 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f170.google.com ([209.85.128.170]:40517)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U4uj5-0002rJ-rv (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 11 Feb 2013 14:51:24 +0000
Received: by mail-ve0-f170.google.com with SMTP id 14so5176171vea.1
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 06:51:23 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=0yUbhWGV6hUOa2cMDjF93rUBSIsK0L/tkvIONbjuyuE=;
 b=xtUnGVa9JIXNbQMVLJQFqiLdxmvdwhWuX4JujTdC6xnUhE6fyPbe4g+7BlIi5c0os0
 EaObROAFofSX69CYKAN8BhpWjfEtuom0oDlJpkNUPCsf7LWmjToJ7BDdqJ5gY9cpkJQt
 CbiIziAfRciDcQ+cSefNRv3SMZziCjvNAgmnIqF7197S0WcF3OYQYUCo3ceJT1LqPi3y
 0Uf4pGi3oX1XjookYCRbWLV6gjtIFXODuhZYHLqgx6sW5sXKJpt5NNPJqjVOcR5nY6Fx
 nlRHrg4w31raiAtzom3bJKDucC35xj5cvPjqeQ3h28JxGDaZs+x7SaMb4H6T7G7JrigH
 CIaQ==
MIME-Version: 1.0
X-Received: by 10.58.214.231 with SMTP id od7mr19052546vec.44.1360594282984;
 Mon, 11 Feb 2013 06:51:22 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Mon, 11 Feb 2013 06:51:22 -0800 (PST)
In-Reply-To: <51190420.5080305@lexifi.com>
References: <51190420.5080305@lexifi.com>
Date: Mon, 11 Feb 2013 09:51:22 -0500
X-Google-Sender-Auth: idlt6RZBcobKvtJDZmDNjl38Yik
Message-ID: <CANcqPu5yEYov6Muk6sgpAX_3UyDMygsJzV5xXSYCnR1amaE_FA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=089e01183198ebb71404d5740a90
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 14:46:19 -0000

--089e01183198ebb71404d5740a90
Content-Type: text/plain; charset=ISO-8859-1

On Mon, Feb 11, 2013 at 9:45 AM, Alain Frisch <alain.frisch@lexifi.com>wrote:

>
> 5. Fork Parsetree or clean it up?
>
> Hongbo has proposed that we introduce a different representation of the
> Parsetree on which -ppx rewriters would be applied.  Concretely, we could
> fork parsetree.mli into parsetree.mli/ast.mli, clean up parsetree (see
> below) and adapt parser.mly accordingly, and then implement a translation
> pass from Parsetree to Ast before running the type-checker on Ast.  The
> alternative is to clean up Parsetree directly and adapt the type-checker to
> these changes.  This avoids an extra intermediate language and the mapping,
> but this could add a little bit of extra complexity to the type-checker
> (and it might be more difficult to convince core developers).  What do
> people think?
>
> Hi Alain, This is great , and you have more freedom to clean up the Ast,
for example, remove the unnecessary prefix names without breaking other
existing software.

> Alain
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>



-- 
-- Regards, Hongbo

--089e01183198ebb71404d5740a90
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Mon, Feb 11, 2013 at 9:45 AM, Alain F=
risch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain.frisch@lexifi.com" targ=
et=3D"_blank">alain.frisch@lexifi.com</a>&gt;</span> wrote:<br><blockquote =
class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid=
;padding-left:1ex">
<br>
5. Fork Parsetree or clean it up?<br>
<br>
Hongbo has proposed that we introduce a different representation of the Par=
setree on which -ppx rewriters would be applied. =A0Concretely, we could fo=
rk parsetree.mli into parsetree.mli/ast.mli, clean up parsetree (see below)=
 and adapt parser.mly accordingly, and then implement a translation pass fr=
om Parsetree to Ast before running the type-checker on Ast. =A0The alternat=
ive is to clean up Parsetree directly and adapt the type-checker to these c=
hanges. =A0This avoids an extra intermediate language and the mapping, but =
this could add a little bit of extra complexity to the type-checker (and it=
 might be more difficult to convince core developers). =A0What do people th=
ink?<br>
<br></blockquote><div>Hi Alain, This is great , and you have more freedom t=
o clean up the Ast, for example, remove the unnecessary prefix names withou=
t breaking other existing software.=A0</div><blockquote class=3D"gmail_quot=
e" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">

Alain<br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regards, =
Hongbo

--089e01183198ebb71404d5740a90--

From bobzhang1988@gmail.com  Mon Feb 11 15:25:23 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 66EFC3CBDD
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 15:25:23 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1444510 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.46 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f46.google.com ([209.85.212.46]:44102)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U4vKt-00046r-p6 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 11 Feb 2013 15:30:28 +0000
Received: by mail-vb0-f46.google.com with SMTP id b13so3815963vby.5
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 07:30:27 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type
 :content-transfer-encoding;
 bh=5bJUPGNrjBZZ2Ag1badjiZ8H84SwHvNg98ffBVtP2r8=;
 b=kuDgDTJAG380Sikoj/sdJ1i5Rky1K9oP/akfTHRDx29dWs6FuLEKkK0+j3T3J7au5N
 0939TJvqEYYEvX2UoyooqepBcYcJmmz6ptFwvYWeZ4GsftfxaL12TB3k4ouqbBWtcxVG
 AqPD9fPhXu9MJ36TXuOUDADZOm3Tvqnzv9ul+zx2VSOYj5nMrGO4FM3R52mKNtKohrRL
 GiZ5YL9brjgMiOUVC4Ut4CRsC5pgr8QweHsii/NGp1oYzKyyz4HZ9KIOs8140hnx7W83
 DaToLamTkXi70SBIAJq2kjILvBo1pStmp1+nB8N2C9/8aH/3M9SKbKTSdU7PRVpJHyN4
 gLcw==
MIME-Version: 1.0
X-Received: by 10.58.247.132 with SMTP id ye4mr19426039vec.9.1360596627116;
 Mon, 11 Feb 2013 07:30:27 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Mon, 11 Feb 2013 07:30:26 -0800 (PST)
In-Reply-To: <CANcqPu5yEYov6Muk6sgpAX_3UyDMygsJzV5xXSYCnR1amaE_FA@mail.gmail.com>
References: <51190420.5080305@lexifi.com>
 <CANcqPu5yEYov6Muk6sgpAX_3UyDMygsJzV5xXSYCnR1amaE_FA@mail.gmail.com>
Date: Mon, 11 Feb 2013 10:30:26 -0500
X-Google-Sender-Auth: c33IoMyDzFC7EFXJZnf1Ui6bDpc
Message-ID: <CANcqPu6qD7YW-FmjDaQ6Ri+ALuXJrgxU9KaZPOT2HGU=0jJRbQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 15:25:23 -0000

If you clean up the ast, it could be great to make pattern and
expression symmetric for the intersection part.

For example, in Fan the intersection type is something like
--------------------------------------
  type ep =3D
     [=3D `Nil of loc
     | `Id  of (loc * ident) (* i *)
     | `App of (loc * ep * ep) (* e e *)
     | `Vrn of (loc * string)       (* `s *)
     | `Com of (loc * ep * ep)
     | `Sem of (loc * ep * ep) (* e; e *)
     | `Tup of (loc * ep)
     | `Record of (loc * rec_bind)
     | ant  | literal ]
     and rec_bind =3D
     [=3D `Nil of loc
     | `RecBind of (loc * ident * ep)
     | `Sem of (loc * rec_bind * rec_bind)
     | `Any of loc
     | ant];
--------------------------------------------------------
We benefit a lot from the subtyping  relation here (ep:>expr, ep :> patt)
On Mon, Feb 11, 2013 at 9:51 AM, Hongbo Zhang <hongboz@seas.upenn.edu> wrot=
e:
>
>
>
> On Mon, Feb 11, 2013 at 9:45 AM, Alain Frisch <alain.frisch@lexifi.com> w=
rote:
>>
>>
>> 5. Fork Parsetree or clean it up?
>>
>> Hongbo has proposed that we introduce a different representation of the =
Parsetree on which -ppx rewriters would be applied.  Concretely, we could f=
ork parsetree.mli into parsetree.mli/ast.mli, clean up parsetree (see below=
) and adapt parser.mly accordingly, and then implement a translation pass f=
rom Parsetree to Ast before running the type-checker on Ast.  The alternati=
ve is to clean up Parsetree directly and adapt the type-checker to these ch=
anges.  This avoids an extra intermediate language and the mapping, but thi=
s could add a little bit of extra complexity to the type-checker (and it mi=
ght be more difficult to convince core developers).  What do people think?
>>
> Hi Alain, This is great , and you have more freedom to clean up the Ast, =
for example, remove the unnecessary prefix names without breaking other exi=
sting software.
>>
>> Alain
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>
>
>
>
> --
> -- Regards, Hongbo




--
-- Regards, Hongbo

From info@gerd-stolpmann.de  Mon Feb 11 15:39:09 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6918B3CBDD
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 15:39:09 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1444510 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.171 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.171]:54491)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U4vYD-0003x8-Rx (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Mon, 11 Feb 2013 15:44:14 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-217-035.pools.arcor-ip.net
 [94.219.217.35])
 by mrelayeu.kundenserver.de (node=mreu3) with ESMTP (Nemesis)
 id 0Lsrle-1V37kq3k9S-012bar; Mon, 11 Feb 2013 16:44:07 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id 764F6C00CF;
 Mon, 11 Feb 2013 16:44:06 +0100 (CET)
Date: Mon, 11 Feb 2013 16:44:06 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
In-Reply-To: <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
 (from gabriel.scherer@gmail.com on Mon Feb 11 11:45:57 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1360597446.2379.2@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:0hd7YeWrFyJ0WWXaLj0VZIMOsm5w0uWUOcJ0dfYPP8F
 OtHxZD8ZfO5Z39mzIbCGKTnjK5mqvDHGkbWUljEvp9z6K4nRXk
 PRl6EwgiAcE4syMZkBAZJO/1eD/agGPfMS5trU+bPl+w3cilK/
 jpuMkoYtMWOXi6eLfUFVZ4MH+xwIfBoMF6t4dblfZET+pElcQF
 wNJnMclQ97ayUWo8GGugfvjZbjDES2FZZD1/h+VgMJo+RKqLYN
 giTBoJ7PdZVaVIBDmPyAKL6RaA15OSKEH0G8nTr3cNHCtUsiG4
 OjmuZ0rdLr3jgabyEDmokIzCmyc2Ds5SM+uZPSUK4lqtVenxVw
 DbdRGxRa0O2hfHBC7NZQ=
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 15:39:09 -0000

Am 11.02.2013 11:45:57 schrieb(en) Gabriel Scherer:
> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org> =20
> wrote:
> > It should work just fine with ppx, and has the advantage of =20
> reducing the number of ocamlfind calls per-file (which is a =20
> considerable overhead on large projects, since it has to scan the =20
> META directories on every invocation).
>=20
> That's of course rather orthogonal to the present discussion, but have
> you been in contact with Gerd to see if some caching solution would be
> possible? Intuitively it feels like ocamlfind could easily maintain a
> cache in /var/run/blah and only clean it on install/remove commands.

As a system engineer I think this is overkill. ocamlfind only loads the =20
META files actually needed (it does not "scan"), and loading a file =20
already in the page cache is a matter of microseconds. Even when you =20
have 100 packages this should be hardly noticeable. Such a cache can =20
even make things worse, because loading once a large cache can be more =20
costly than a few META files (simply because of the data volume).

What is probably more a problem when you have many packages: This =20
generates many -I paths, and the compiler has to search for modules. I =20
don't know how this is implemented, but if it is the naive way, this is =20
an O(n*m) algorithm (n=3Dnumber of -I directories, m=3Dnumber of modules to=
 =20
look up).

Gerd


> (An external process invocation would still make some overhead so in
> you're case you'd still have to go all the way, but that could improve
> the threshold at which such ~hacks become interesting.)
>=20
> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org> =20
> wrote:
> > On 11 Feb 2013, at 10:06, Alain Frisch <alain.frisch@lexifi.com> =20
> wrote:
> >>
> >> For a code base like Jane Street's where many "extensions" have to =20
> be used everywhere, I suspect that the "independent" ppx processes =20
> might become an issue (or maybe not, if compared to camlp4), but the =20
> following solutions would work:
> >>
> >> - Statically linking a "big rewriter" called with -ppx.
> >
> > This worked well in the case of Mirage; in the monolithic =20
> repository, we link together all the camlp4 extensions into a single =20
> big one, and invoke that across all files.
> >
> > It should work just fine with ppx, and has the advantage of =20
> reducing the number of ocamlfind calls per-file (which is a =20
> considerable overhead on large projects, since it has to scan the =20
> META directories on every invocation).
> >
> > There's also the advantage in camlp4 that this checks that syntax =20
> extensions do not conflict. This is less of an issue with ppx, =20
> thankfully.
> >
> > -anil
> > _______________________________________________
> > wg-camlp4 mailing list
> > wg-camlp4@lists.ocaml.org
> > http://lists.ocaml.org/listinfo/wg-camlp4
>=20
>=20



--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From edwin+ml-ocaml@etorok.net  Mon Feb 11 15:56:08 2013
Return-Path: <edwin+ml-ocaml@etorok.net>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D457E3CBDD
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 15:56:08 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1444510 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail.etorok.net ([176.9.138.55]:51019)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U4voe-0003n8-ZH (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <edwin+ml-ocaml@etorok.net>); Mon, 11 Feb 2013 16:01:14 +0000
Received: from [IPv6:2a02:2f09:40b0:2c:1e6f:65ff:fe23:db0d] (unknown
 [IPv6:2a02:2f09:40b0:2c:1e6f:65ff:fe23:db0d])
 by mail.etorok.net (Postfix) with ESMTPSA id 2C07D46B4
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 17:01:11 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=etorok.net;
 s=MAILOUT; t=1360598471;
 bh=pdLxGa5wVQHd2i3X398OCbDTTb85XyJD1JQ2RvDPoOA=;
 h=Message-ID:Date:From:MIME-Version:To:Subject:References:
 In-Reply-To:Content-Type:Content-Transfer-Encoding;
 b=R0sdyQevAGjF8YqkIDRcvNeW9sSryUtzV3ExSpxONGL/WB8aZMWBTSI83vrtRyyPV
 kUlaYCNKWenKDZ8tBrynF8mtoeL20V1TzjHQAGwzRl4qx3KdrPNzQxPb+wAS02uxuR
 TPUWn3ZT+dGI4KudHKk7kZmArVWL94ldVnPeose4=
Message-ID: <511915C6.4010509@etorok.net>
Date: Mon, 11 Feb 2013 18:01:10 +0200
From: =?ISO-8859-1?Q?T=F6r=F6k_Edwin?= <edwin+ml-ocaml@etorok.net>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <1360597446.2379.2@samsung>
In-Reply-To: <1360597446.2379.2@samsung>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Virus-Scanned: clamav-milter 0.97.6 at mail
X-Virus-Status: Clean
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 15:56:08 -0000

On 02/11/2013 05:44 PM, Gerd Stolpmann wrote:
> Am 11.02.2013 11:45:57 schrieb(en) Gabriel Scherer:
>> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org> wrote:
>> > It should work just fine with ppx, and has the advantage of reducing the number of ocamlfind calls per-file (which is a considerable overhead on large projects, since it has to scan the META
>> directories on every invocation).
>>
>> That's of course rather orthogonal to the present discussion, but have
>> you been in contact with Gerd to see if some caching solution would be
>> possible? Intuitively it feels like ocamlfind could easily maintain a
>> cache in /var/run/blah and only clean it on install/remove commands.
> 
> As a system engineer I think this is overkill. ocamlfind only loads the META files actually needed (it does not "scan"), and loading a file already in the page cache is a matter of microseconds. Even
> when you have 100 packages this should be hardly noticeable. Such a cache can even make things worse, because loading once a large cache can be more costly than a few META files (simply because of the
> data volume).
> 
> What is probably more a problem when you have many packages: This generates many -I paths, and the compiler has to search for modules. I don't know how this is implemented, but if it is the naive way,
> this is an O(n*m) algorithm (n=number of -I directories, m=number of modules to look up).

Is there a reason that ocamlbuild has to spawn the compiler for each file?
Couldn't it use compiler-libs to perform the compilation directly, and re-use some of the cached information (location of modules, parsed interfaces for example)?

Also I've noticed some suboptimal behaviours with oasis+ocamlbuild+ocamlfind, would that new wg-build list be appropriate to discuss such issues (and find solutions)?
Or should I just file bugreports for the individual tools?

For example:
 - ocamlfind returning -I paths in different order (with different -tag), which caused ocamlbuild to think that the "build command" has changed, and thus rebuild files it shouldn't
 - oasis sometimes adds more -I than necessary (if two libraries share a directory)
 - oasis sometimes adds too few -I (causing interface mismatch errors between my src/ and test/ for example)
 - even when there's nothing to rebuild it takes 1-2s to say that


Best regards,
--Edwin

> 
> Gerd
> 
> 
>> (An external process invocation would still make some overhead so in
>> you're case you'd still have to go all the way, but that could improve
>> the threshold at which such ~hacks become interesting.)
>>
>> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org> wrote:
>> > On 11 Feb 2013, at 10:06, Alain Frisch <alain.frisch@lexifi.com> wrote:
>> >>
>> >> For a code base like Jane Street's where many "extensions" have to be used everywhere, I suspect that the "independent" ppx processes might become an issue (or maybe not, if compared to camlp4),
>> but the following solutions would work:
>> >>
>> >> - Statically linking a "big rewriter" called with -ppx.
>> >
>> > This worked well in the case of Mirage; in the monolithic repository, we link together all the camlp4 extensions into a single big one, and invoke that across all files.
>> >
>> > It should work just fine with ppx, and has the advantage of reducing the number of ocamlfind calls per-file (which is a considerable overhead on large projects, since it has to scan the META
>> directories on every invocation).
>> >
>> > There's also the advantage in camlp4 that this checks that syntax extensions do not conflict. This is less of an issue with ppx, thankfully.
>> >
>> > -anil
>> > _______________________________________________
>> > wg-camlp4 mailing list
>> > wg-camlp4@lists.ocaml.org
>> > http://lists.ocaml.org/listinfo/wg-camlp4
>>
>>
> 
> 
> 


From david.waern@gmail.com  Mon Feb 11 23:40:34 2013
Return-Path: <david.waern@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3BA2E3CBDE
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 23:40:34 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1444510 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.216.178 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (david.waern[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-qc0-f178.google.com ([209.85.216.178]:48623)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U5344-0008GW-mh (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <david.waern@gmail.com>); Mon, 11 Feb 2013 23:45:40 +0000
Received: by mail-qc0-f178.google.com with SMTP id j34so2397430qco.23
 for <wg-camlp4@lists.ocaml.org>; Mon, 11 Feb 2013 15:45:35 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=ylLTw2AJTFx8o18zU+L8WNsSKrUwAx/xTZ1k4iF2xKE=;
 b=DX4E03V84YyP6+6p9/UC6H5AAdNmizR/oFltKGCpnITzQhob7hlNX5VWSYNB/WBx5t
 6T/5DloRPvOUX08/umy+c/F4lJVuf8zvmm8njHd7oKF7+gZbzmrpF1kHrkIjPwHdnqez
 Evo+J1HaogOuFOh+POjEmsIzmhOKT5vE4ZuiJxZOBMONzMSqRXA33n9Ya685i9B7Gqpf
 30Ebf5nORotUhRI38iD+bIsmg5s+SZLdxOCgLpXsuUUwcaYk8MYxG5EnZqRRpd4uWZNc
 MhPXusI9qZN7I+FlB78lhdIDgTftj3EBdrZs+SHwnI3PviDsVWqeeE7QCcwJHxaDfxvQ
 DRIg==
MIME-Version: 1.0
X-Received: by 10.49.132.199 with SMTP id ow7mr6960590qeb.56.1360626335385;
 Mon, 11 Feb 2013 15:45:35 -0800 (PST)
Received: by 10.49.117.7 with HTTP; Mon, 11 Feb 2013 15:45:35 -0800 (PST)
In-Reply-To: <51190420.5080305@lexifi.com>
References: <51190420.5080305@lexifi.com>
Date: Tue, 12 Feb 2013 00:45:35 +0100
Message-ID: <CAN8ZjBGJpMZNiMccs6rCR-8PvzZezO_KzedqyV-yqMoEM_rDYA@mail.gmail.com>
From: David Waern <david.waern@gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 11 Feb 2013 23:40:34 -0000

2013/2/11 Alain Frisch <alain.frisch@lexifi.com>:
> 5. Fork Parsetree or clean it up?
>
> Hongbo has proposed that we introduce a different representation of the
> Parsetree on which -ppx rewriters would be applied.  Concretely, we could
> fork parsetree.mli into parsetree.mli/ast.mli, clean up parsetree (see
> below) and adapt parser.mly accordingly, and then implement a translation
> pass from Parsetree to Ast before running the type-checker on Ast.  The
> alternative is to clean up Parsetree directly and adapt the type-checker to
> these changes.  This avoids an extra intermediate language and the mapping,
> but this could add a little bit of extra complexity to the type-checker (and
> it might be more difficult to convince core developers).  What do people
> think?

I'm not a core developer, but I vote for cleaning up Parsetree rather
than forking it. Advantages:

  - one single (clean) type
  - the typechecker can produce error messages closer to what the user wrote

The Haskell compiler (GHC) does typechecking on the non-desugared
version of the syntax for exactly the second reason, and the
developers seem to have been quite happy with that decision.

Another note: in the Haskell land there are multiple different syntax
tree types floating around:

   - the aforementioned front end type
   - another one used in Template Haskell
   - a third type (in the "haskell-src-exts" library) that is designed
to be as clean and easy to use as possible

Most stand-alone tools are implemented using the third type since it's
by far the easiest one to use. I have heard many people (including GHC
core developers) whishing they would have just one clean type.

David

From romain.bardou@inria.fr  Tue Feb 12 11:37:32 2013
Return-Path: <romain.bardou@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7B5D93C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 11:37:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.0 from SpamAssassin-3.3.2-1444680 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:31258)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U5EG0-0005NL-my (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <romain.bardou@inria.fr>); Tue, 12 Feb 2013 11:42:40 +0000
X-IronPort-AV: E=Sophos;i="4.84,648,1355094000"; 
   d="scan'208";a="1919987"
Received: from unknown (HELO [10.120.187.186]) ([193.51.16.212])
 by mail3-relais-sop.national.inria.fr with ESMTP/TLS/DHE-RSA-CAMELLIA256-SHA;
 12 Feb 2013 12:31:58 +0100
Message-ID: <511A2AAF.6010107@inria.fr>
Date: Tue, 12 Feb 2013 12:42:39 +0100
From: Romain Bardou <romain.bardou@inria.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.11) Gecko/20121122 Icedove/10.0.11
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <51190420.5080305@lexifi.com>
In-Reply-To: <51190420.5080305@lexifi.com>
Content-Type: text/plain; charset=windows-1252; format=flowed
Content-Transfer-Encoding: 8bit
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 12 Feb 2013 11:37:32 -0000

Hello,

> 3. Quotations
>
> The more I think about it, the more I believe this concept is orthogonal
> to "extensions". Leo disagrees and would like to have a combined syntax
> for the case where the argument of an extension is a quotation. What do
> other people think? (For me, a quotation is only a way to introduce a
> string literal without "suffering" from the lexical conventions of OCaml.)
>
> For the concrete syntax of quotations, it was suggested to use a form
> where the closing delimiter would be defined by the opening one. This
> makes it possible to "quote" an arbitrary string without having to
> define a way to escape a potential occurrence of the closing delimiter
> (just pick a different one). Example: {xxx{blablabla}xxx}
>
> Do people familiar with implementation of editor modes believe it will
> be easy to support such syntax in emacs or vim modes?

I agree it is orthogonal and about the "string literal" aspect, *if* you 
do not want antiquotations.

Melt has a rather complex variation on quotations. There is an emacs 
mode and a vim mode. I think the emacs mode handles quotations. I don't 
know if the vim mode does. But the emacs mode can be very slow on big files.

However without antiquotations I think it should not be too hard, 
because it can be written as a regexp (using a group to repeat the "xxx").

I didn't follow the list close enough to know whether the consensus is 
to have antiquotations or not

Cheers,

-- 
Romain Bardou

From thomas.gazagnaire@gmail.com  Tue Feb 12 11:49:32 2013
Return-Path: <thomas.gazagnaire@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D5FDF3C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 11:49:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1444680 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.175 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (thomas.gazagnaire[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f175.google.com ([74.125.82.175]:37014)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U5ERb-0003dS-YU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <thomas.gazagnaire@gmail.com>); Tue, 12 Feb 2013 11:54:40 +0000
Received: by mail-we0-f175.google.com with SMTP id x8so5718612wey.6
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 03:54:39 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:subject:mime-version:content-type:from
 :in-reply-to:date:cc:content-transfer-encoding:message-id:references
 :to:x-mailer; bh=t2vAec+cq6b5SwApVYXX9FFhou+DcCPLMrg+Nw4J+hE=;
 b=NLHDevPE6rPTvYBs6Pflf3Rgw2td0c5gKLVacyjPUxdBxk65UfW6zjfwqvMYzzvLS2
 f53Mo6NFaZyNrl+7G2cxtjusOWWGsKSSajG3URElz1hKc1qM4gEUWu0uyx3O57aPGTCs
 13VMcTXrfVfFHgM8jdY9FWbAfRxHFheVj86fU/XWyrOl0kfbh+GqvnBOarAMBDSe8Ft7
 m7FXKQtd0eKnfcwZnZNaXNSK5gOoN5P8qGklrDuB4qOCpY+jSC86dxwz45LVkOwLvwCs
 2bvkTD/JAZG8e3uN/MZ2q4rrLTgJEKo3sksqNSBW8NjRUjS8VynZGC1cgQlEgC8PrYGU
 SESw==
X-Received: by 10.180.97.197 with SMTP id ec5mr2651788wib.1.1360670067163;
 Tue, 12 Feb 2013 03:54:27 -0800 (PST)
Received: from [192.168.0.14] (gou06-3-88-170-165-56.fbx.proxad.net.
 [88.170.165.56])
 by mx.google.com with ESMTPS id ex1sm39191185wib.7.2013.02.12.03.54.23
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Tue, 12 Feb 2013 03:54:26 -0800 (PST)
Sender: Thomas Gazagnaire <thomas.gazagnaire@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1085)
Content-Type: text/plain; charset=us-ascii
From: Thomas Gazagnaire <thomas@ocamlpro.com>
In-Reply-To: <5118C2B8.4070807@lexifi.com>
Date: Tue, 12 Feb 2013 12:54:21 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <BFBA82C7-FF2D-4E99-9DA8-E96734B76813@ocamlpro.com>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1085)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 12 Feb 2013 11:49:32 -0000

> - Running AST rewriters as independent processes adds about 7% of =
compilation time with ocamlopt.opt
> - If we run a single process without marshaling the AST between =
rewriters, the marginal cost goes below 1% per rewriter.  (This is, =
basically, the cost of iterating over the AST with objects, matching =
over each expression to find extension "markers", and rebuilding a deep =
copy of the AST.)
> - This can be reduced a lot with proper configuration of the GC (down =
to about 0.3% of compilation time with ocamlopt.opt, with the same GC =
config).
> - It would be interesting to do some timings when dynlinking a lot of =
different .cmxs plugins in ppx_drivers.

Thanks for the detailed explanation. This sounds like very good results =
and strong arguments to replace the complex camlp4 beast by something =
lighter.

I quite like the idea of having AST rewriter hooks in compiler libs to =
create easy-to-use compiler variations.

--
Thomas


> (If we link the rewriters statically with a custom version of the =
compiler itself, assuming a new hook in the compiler allows to plug AST =
rewriter, we would only pay the marginal cost < 1%.)
>=20
> For a code base like Jane Street's where many "extensions" have to be =
used everywhere, I suspect that the "independent" ppx processes might =
become an issue (or maybe not, if compared to camlp4), but the following =
solutions would work:
>=20
> - Statically linking a "big rewriter" called with -ppx.
> - Statically linking a version of ocamlopt.opt + all rewriters.
> - Dynamically linking all rewriters with a single ppx driver (to be =
confirmed, there would be a small overhead for the dynamic linking =
itself in addition to the 0.3% marginal cost above).
>=20
>=20
>=20
>=20
> Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4


From thomas.gazagnaire@gmail.com  Tue Feb 12 11:52:35 2013
Return-Path: <thomas.gazagnaire@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 15E643C05E
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 11:52:35 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1444680 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.172 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (thomas.gazagnaire[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f172.google.com ([209.85.212.172]:41751)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U5EUY-0004DT-n7 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <thomas.gazagnaire@gmail.com>); Tue, 12 Feb 2013 11:57:43 +0000
Received: by mail-wi0-f172.google.com with SMTP id ez12so4297107wid.17
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 03:57:42 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:subject:mime-version:content-type:from
 :in-reply-to:date:cc:content-transfer-encoding:message-id:references
 :to:x-mailer; bh=uUYM0lPig9TlQkPHUlPaFcFhpfIFqYSWNesuhHAYWpA=;
 b=hqiWZZa1xZVwiGUpA16tt99IhNvdWqeHlNn+AYYKUZ4ITAqcINx1g/dE42AxziuMSS
 eHVv8CHDxnq/lTALSmzhnxDrqlsKMee2TAJYUDwoNXHiYuVvhpuWhdmsdmm2y6KB6bXm
 TdRT0Cv7xc2wkAmB5CmXH5ftNeBYlnXoG5XApXqNBXRM7QlsD6ZTJfVkamAhUZzxEMkS
 NCS0ISR4bfZa3dJ1tQlhjzVdP7eczenE3vDxfapU0/6EOi0wKbCTxDp5niF6A4d3iAHx
 Z19wdlGmphWDk+IjhPVUOvTGqtACAaBamUNN9aHAACA0terH5mDvXnHptpE29zgLzRxT
 aKXQ==
X-Received: by 10.194.174.234 with SMTP id bv10mr2023028wjc.47.1360670253275; 
 Tue, 12 Feb 2013 03:57:33 -0800 (PST)
Received: from [192.168.0.14] (gou06-3-88-170-165-56.fbx.proxad.net.
 [88.170.165.56])
 by mx.google.com with ESMTPS id ec3sm36147388wib.1.2013.02.12.03.57.31
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Tue, 12 Feb 2013 03:57:32 -0800 (PST)
Sender: Thomas Gazagnaire <thomas.gazagnaire@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1085)
Content-Type: text/plain; charset=us-ascii
From: Thomas Gazagnaire <thomas@ocamlpro.com>
In-Reply-To: <CANcqPu79E86_oG9z=SEk7RuKn_DOd=MO7PEXkDR_ykAF8TTz6g@mail.gmail.com>
Date: Tue, 12 Feb 2013 12:57:29 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <585C2A34-2B1C-4970-B985-727438280335@ocamlpro.com>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
 <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
 <6E9F4686-250B-4C25-8149-A952543B3BE7@recoil.org>
 <CAPFanBGnTvCy1MvAP2nsFF3Kv+=RrFOXDjmyOqabJ9cUvVEb_w@mail.gmail.com>
 <CANcqPu79E86_oG9z=SEk7RuKn_DOd=MO7PEXkDR_ykAF8TTz6g@mail.gmail.com>
To: Hongbo Zhang <hongboz@seas.upenn.edu>
X-Mailer: Apple Mail (2.1085)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 12 Feb 2013 11:52:35 -0000

Hi Hongbo,

> For the user time
> ocamlbuild cold/FanDriver.native
> user	0m28.494s
> ocamlbuild src/FanDriver.native
> user	0m30.680s
> For the system time
> the cold directory takes
> sys	0m3.843s
> while the src directory takes
> sys	0m4.657s

I'm not sure to understand what you are measuring exactly here (ie. I =
don't know what magic your myocamlbuild.ml is doing) and how to =
interpret the results. Could you please elaborate a bit more ?

Cheers,
Thomas

>=20
>=20
> On Mon, Feb 11, 2013 at 7:20 AM, Gabriel Scherer =
<gabriel.scherer@gmail.com> wrote:
> On the other hand, build systems come and go (and ./configure is like
> the most horrible part to add logic to in most cases), while ocamlfind
> has proved a reliable tool as a basis for any OCaml ecosystem so far.
> If I can shelve some logic there without making the tool more complex
> or less elegant I think that would be better for everyone.
>=20
> On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy <anil@recoil.org> =
wrote:
> > On 11 Feb 2013, at 10:45, Gabriel Scherer =
<gabriel.scherer@gmail.com> wrote:
> >
> >> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy =
<anil@recoil.org> wrote:
> >>> It should work just fine with ppx, and has the advantage of =
reducing the number of ocamlfind calls per-file (which is a considerable =
overhead on large projects, since it has to scan the META directories on =
every invocation).
> >>
> >> That's of course rather orthogonal to the present discussion, but =
have
> >> you been in contact with Gerd to see if some caching solution would =
be
> >> possible? Intuitively it feels like ocamlfind could easily maintain =
a
> >> cache in /var/run/blah and only clean it on install/remove =
commands.
> >>
> >> (An external process invocation would still make some overhead so =
in
> >> you're case you'd still have to go all the way, but that could =
improve
> >> the threshold at which such ~hacks become interesting.)
> >
> > I don't think it's necessary to put this in ocamlfind, which does =
the job
> > it's designed to do very well. Just fix your build systems to run =
ocamlfind
> > at configure time, save the results, and apply them to the compiler =
flags
> > during the build phase.
> >
> > -anil
> >
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
>=20
>=20
> --=20
> -- Regards, Hongbo
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4


From bobzhang1988@gmail.com  Tue Feb 12 13:16:52 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8AD303C30F
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 13:16:52 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1444680 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.41 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f41.google.com ([209.85.212.41]:63250)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U5Fo7-0002nx-WX (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Tue, 12 Feb 2013 13:22:00 +0000
Received: by mail-vb0-f41.google.com with SMTP id l22so37692vbn.14
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 05:21:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type
 :content-transfer-encoding;
 bh=WdH59YhJQISqokjDA2MYEFn+bDTakDUEGvaInSElRPE=;
 b=b4ybqMtFS5d5htmvAJiToFlnHF+OEISvIUoAgeWomwu6KCNlDCSdPa/JBAiyOrdUpK
 kyrMQWQaKJQxNwz4szq8YM+KyDHSI5K9JzScQ155LUcCLRytpx9GvQfPp3Ac6sycmv8m
 Aw+flW0cfilLYoM833psT4nm0VqBfNvx4zjJJDZXiBcp7hdWtqt7Qoe7Ry1VMEmJ3Fb9
 wQtIxZ6LP1syhyNa+67yrWeVdEkHbQogoDZLJYTNQkJerTbAi+MZs92lQmneFqA/3HdJ
 Z1FNH8U+c5eI/KZtKzYTlcZdnK8zo05U5NkG0Fx5qAgQpdpqBUtLxIStHHR6gxw4V871
 a7TA==
MIME-Version: 1.0
X-Received: by 10.52.98.196 with SMTP id ek4mr21305453vdb.16.1360675318226;
 Tue, 12 Feb 2013 05:21:58 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Tue, 12 Feb 2013 05:21:58 -0800 (PST)
In-Reply-To: <BFBA82C7-FF2D-4E99-9DA8-E96734B76813@ocamlpro.com>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <BFBA82C7-FF2D-4E99-9DA8-E96734B76813@ocamlpro.com>
Date: Tue, 12 Feb 2013 08:21:58 -0500
X-Google-Sender-Auth: nfleeYXUzEEbas0XzSFGM6BEIo8
Message-ID: <CANcqPu5zxsXT-C4P_zVGahN+KiEJCH-c=23qA28Dt89kSxUZkA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Thomas Gazagnaire <thomas@ocamlpro.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 12 Feb 2013 13:16:52 -0000

On Tue, Feb 12, 2013 at 6:54 AM, Thomas Gazagnaire <thomas@ocamlpro.com> wr=
ote:
>> - Running AST rewriters as independent processes adds about 7% of compil=
ation time with ocamlopt.opt
>> - If we run a single process without marshaling the AST between rewriter=
s, the marginal cost goes below 1% per rewriter.  (This is, basically, the =
cost of iterating over the AST with objects, matching over each expression =
to find extension "markers", and rebuilding a deep copy of the AST.)
>> - This can be reduced a lot with proper configuration of the GC (down to=
 about 0.3% of compilation time with ocamlopt.opt, with the same GC config)=
.
>> - It would be interesting to do some timings when dynlinking a lot of di=
fferent .cmxs plugins in ppx_drivers.
>
> Thanks for the detailed explanation. This sounds like very good results a=
nd strong arguments to replace the complex camlp4 beast by something lighte=
r.
Hi, Thomas, my micro-benchmark(in the previous email) shows fan be as
fast as ast rewriter
>
> I quite like the idea of having AST rewriter hooks in compiler libs to cr=
eate easy-to-use compiler variations.
>
> --
> Thomas
>
>
>> (If we link the rewriters statically with a custom version of the compil=
er itself, assuming a new hook in the compiler allows to plug AST rewriter,=
 we would only pay the marginal cost < 1%.)
>>
>> For a code base like Jane Street's where many "extensions" have to be us=
ed everywhere, I suspect that the "independent" ppx processes might become =
an issue (or maybe not, if compared to camlp4), but the following solutions=
 would work:
>>
>> - Statically linking a "big rewriter" called with -ppx.
>> - Statically linking a version of ocamlopt.opt + all rewriters.
>> - Dynamically linking all rewriters with a single ppx driver (to be conf=
irmed, there would be a small overhead for the dynamic linking itself in ad=
dition to the 0.3% marginal cost above).
>>
>>
>>
>>
>> Alain
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4



--=20
-- Regards, Hongbo

From bobzhang1988@gmail.com  Tue Feb 12 13:39:32 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 2DF413C30F
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 13:39:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1444680 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.179 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f179.google.com ([209.85.220.179]:47365)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U5GA3-0000lB-R8 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Tue, 12 Feb 2013 13:44:40 +0000
Received: by mail-vc0-f179.google.com with SMTP id gb23so46469vcb.38
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 05:44:38 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=MalSu6P6QgaChZBr6P8E9ZOWA9UgxVK9kd1KOXeoGtw=;
 b=x1JZvvTLadYIQBSm+cNGiTnD1pYN8X7oMt/3CcQoyM4hD4J1faqEb0rdR9YJKekYnu
 vjiu+KScy9mNBnaeqsKZEu2v9p7n5P8sRgb0siHea97nhUT5t08sZBbdmZffRQEWzxHF
 E+WIuPfd3jlJgMJhFaKJodH9ZvNQkNCNBM48DsM/9vTx/2qpuajBbdNUsZkvVwayfNqJ
 N6cho7axITKa8zJJ1OJeD+KzEDsQFSI6i53vLzw5bcXzLqIlfggiCM8Lh8IXf5F4LieT
 nXt5qoaB6+3tAm/wrykrxlC/ytkMXPykgP5Mf2CC1SZw26fvzwvCNWSkUVL8j38JSAcb
 /EVA==
MIME-Version: 1.0
X-Received: by 10.220.240.11 with SMTP id ky11mr23965445vcb.11.1360676678547; 
 Tue, 12 Feb 2013 05:44:38 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Tue, 12 Feb 2013 05:44:38 -0800 (PST)
In-Reply-To: <585C2A34-2B1C-4970-B985-727438280335@ocamlpro.com>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
 <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
 <6E9F4686-250B-4C25-8149-A952543B3BE7@recoil.org>
 <CAPFanBGnTvCy1MvAP2nsFF3Kv+=RrFOXDjmyOqabJ9cUvVEb_w@mail.gmail.com>
 <CANcqPu79E86_oG9z=SEk7RuKn_DOd=MO7PEXkDR_ykAF8TTz6g@mail.gmail.com>
 <585C2A34-2B1C-4970-B985-727438280335@ocamlpro.com>
Date: Tue, 12 Feb 2013 08:44:38 -0500
X-Google-Sender-Auth: uqvABM6l36dAhm85IGHZ6FGPe-U
Message-ID: <CANcqPu4wHE+PPLb5wfK=UM1_R2aLX2gzUE+f48JwCOdHXfMHJQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Thomas Gazagnaire <thomas@ocamlpro.com>
Content-Type: multipart/alternative; boundary=14dae9cdcc751437a404d5873a08
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 12 Feb 2013 13:39:32 -0000

--14dae9cdcc751437a404d5873a08
Content-Type: text/plain; charset=ISO-8859-1

On Tue, Feb 12, 2013 at 6:57 AM, Thomas Gazagnaire <thomas@ocamlpro.com>
wrote:
> Hi Hongbo,
>
>> For the user time
>> ocamlbuild cold/FanDriver.native
>> user  0m28.494s
>> ocamlbuild src/FanDriver.native
>> user  0m30.680s
>> For the system time
>> the cold directory takes
>> sys   0m3.843s
>> while the src directory takes
>> sys   0m4.657s
>
> I'm not sure to understand what you are measuring exactly here (ie. I
don't know what magic your myocamlbuild.ml is doing) and how to interpret
the results. Could you please elaborate a bit more ?

For each file subdir/a.ml in src directory, there is a corresponding file
subdir/a.ml in the cold directory, they have *the same Parsetree*, the only
difference is that file in src should be preprocessed, while the file in
cold is vanilla ocaml code that can be compiled without preprocessing.

So here
ocamlbuild src/FanDriver.native
and
ocamlbuild cold/FanDriver.native
does exactly the samething except for each file, when
compiling src/a.mo, it will compile as
ocamlc.opt -c -pp fan src/a.ml
while when compiing cold/a.ml, it works as normal
ocamlc.opt -c cold/a.ml

For our non-trivial code base, our output shows that when compiling with
preprocessing by Fan, its performance is 30s compared with 28s without
preprocessing, this means with good engineering effort, even preprocessing
as powerful as camlp4(Fan provide more features than camlp4) should bring
not too much overhead, I did some experiment before, my feeling is that
typechecking is the bottleneck in most cases.

The extra effort for Fan compared with compiling directly is a dumping
process which dumps FanAst into Parsetree, since our output is already good
enough in practice, I did not tune the GC for better performance.

>
> Cheers,
> Thomas
>
>>
>>
>> On Mon, Feb 11, 2013 at 7:20 AM, Gabriel Scherer <
gabriel.scherer@gmail.com> wrote:
>> On the other hand, build systems come and go (and ./configure is like
>> the most horrible part to add logic to in most cases), while ocamlfind
>> has proved a reliable tool as a basis for any OCaml ecosystem so far.
>> If I can shelve some logic there without making the tool more complex
>> or less elegant I think that would be better for everyone.
>>
>> On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy <anil@recoil.org>
wrote:
>> > On 11 Feb 2013, at 10:45, Gabriel Scherer <gabriel.scherer@gmail.com>
wrote:
>> >
>> >> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <anil@recoil.org>
wrote:
>> >>> It should work just fine with ppx, and has the advantage of reducing
the number of ocamlfind calls per-file (which is a considerable overhead on
large projects, since it has to scan the META directories on every
invocation).
>> >>
>> >> That's of course rather orthogonal to the present discussion, but have
>> >> you been in contact with Gerd to see if some caching solution would be
>> >> possible? Intuitively it feels like ocamlfind could easily maintain a
>> >> cache in /var/run/blah and only clean it on install/remove commands.
>> >>
>> >> (An external process invocation would still make some overhead so in
>> >> you're case you'd still have to go all the way, but that could improve
>> >> the threshold at which such ~hacks become interesting.)
>> >
>> > I don't think it's necessary to put this in ocamlfind, which does the
job
>> > it's designed to do very well. Just fix your build systems to run
ocamlfind
>> > at configure time, save the results, and apply them to the compiler
flags
>> > during the build phase.
>> >
>> > -anil
>> >
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>>
>>
>>
>> --
>> -- Regards, Hongbo
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>



-- 
-- Regards, Hongbo

--14dae9cdcc751437a404d5873a08
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br>On Tue, Feb 12, 2013 at 6:57 AM, Thomas Gazagnaire &lt;<a href=3D"m=
ailto:thomas@ocamlpro.com">thomas@ocamlpro.com</a>&gt; wrote:<br>&gt; Hi Ho=
ngbo,<br>&gt;<br>&gt;&gt; For the user time<br>&gt;&gt; ocamlbuild cold/Fan=
Driver.native<br>
&gt;&gt; user =A00m28.494s<br>&gt;&gt; ocamlbuild src/FanDriver.native<br>&=
gt;&gt; user =A00m30.680s<br>&gt;&gt; For the system time<br>&gt;&gt; the c=
old directory takes<br>&gt;&gt; sys =A0 0m3.843s<br>&gt;&gt; while the src =
directory takes<br>
&gt;&gt; sys =A0 0m4.657s<br>&gt;<br>&gt; I&#39;m not sure to understand wh=
at you are measuring exactly here (ie. I don&#39;t know what magic your <a =
href=3D"http://myocamlbuild.ml">myocamlbuild.ml</a> is doing) and how to in=
terpret the results. Could you please elaborate a bit more ?<br>
<br>For each file subdir/<a href=3D"http://a.ml">a.ml</a> in src directory,=
 there is a corresponding file subdir/<a href=3D"http://a.ml">a.ml</a> in t=
he cold directory, they have <b>the same Parsetree</b>, the only difference=
 is that file in src should be preprocessed, while the file in cold is vani=
lla ocaml code that can be compiled without preprocessing.<br>
<br>So here <br>ocamlbuild src/FanDriver.native <br>and<br>ocamlbuild cold/=
FanDriver.native<br>does exactly the samething except for each file, when <=
br>compiling src/a.mo, it will compile as<br>ocamlc.opt -c -pp fan src/<a h=
ref=3D"http://a.ml">a.ml</a>=A0<br>
while when compiing cold/<a href=3D"http://a.ml">a.ml</a>, it works as norm=
al<br>ocamlc.opt -c cold/<a href=3D"http://a.ml">a.ml</a><br>=A0<div>For ou=
r non-trivial code base, our output shows that when compiling with preproce=
ssing by Fan, its performance is 30s compared with 28s without preprocessin=
g, this means with good engineering effort, even preprocessing as powerful =
as camlp4(Fan provide more features than camlp4) should bring not too much =
overhead, I did some experiment before, my feeling is that typechecking is =
the bottleneck in most cases.</div>
<div><br></div><div>The extra effort for Fan compared with compiling direct=
ly is a dumping process which dumps FanAst into Parsetree, since our output=
 is already good enough in practice, I did not tune the GC for better perfo=
rmance.</div>
<div><br>&gt;<br>&gt; Cheers,<br>&gt; Thomas<br>&gt;<br>&gt;&gt;<br>&gt;&gt=
;<br>&gt;&gt; On Mon, Feb 11, 2013 at 7:20 AM, Gabriel Scherer &lt;<a href=
=3D"mailto:gabriel.scherer@gmail.com">gabriel.scherer@gmail.com</a>&gt; wro=
te:<br>
&gt;&gt; On the other hand, build systems come and go (and ./configure is l=
ike<br>&gt;&gt; the most horrible part to add logic to in most cases), whil=
e ocamlfind<br>&gt;&gt; has proved a reliable tool as a basis for any OCaml=
 ecosystem so far.<br>
&gt;&gt; If I can shelve some logic there without making the tool more comp=
lex<br>&gt;&gt; or less elegant I think that would be better for everyone.<=
br>&gt;&gt;<br>&gt;&gt; On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy=
 &lt;<a href=3D"mailto:anil@recoil.org">anil@recoil.org</a>&gt; wrote:<br>
&gt;&gt; &gt; On 11 Feb 2013, at 10:45, Gabriel Scherer &lt;<a href=3D"mail=
to:gabriel.scherer@gmail.com">gabriel.scherer@gmail.com</a>&gt; wrote:<br>&=
gt;&gt; &gt;<br>&gt;&gt; &gt;&gt; On Mon, Feb 11, 2013 at 11:31 AM, Anil Ma=
dhavapeddy &lt;<a href=3D"mailto:anil@recoil.org">anil@recoil.org</a>&gt; w=
rote:<br>
&gt;&gt; &gt;&gt;&gt; It should work just fine with ppx, and has the advant=
age of reducing the number of ocamlfind calls per-file (which is a consider=
able overhead on large projects, since it has to scan the META directories =
on every invocation).<br>
&gt;&gt; &gt;&gt;<br>&gt;&gt; &gt;&gt; That&#39;s of course rather orthogon=
al to the present discussion, but have<br>&gt;&gt; &gt;&gt; you been in con=
tact with Gerd to see if some caching solution would be<br>&gt;&gt; &gt;&gt=
; possible? Intuitively it feels like ocamlfind could easily maintain a<br>
&gt;&gt; &gt;&gt; cache in /var/run/blah and only clean it on install/remov=
e commands.<br>&gt;&gt; &gt;&gt;<br>&gt;&gt; &gt;&gt; (An external process =
invocation would still make some overhead so in<br>&gt;&gt; &gt;&gt; you&#3=
9;re case you&#39;d still have to go all the way, but that could improve<br=
>
&gt;&gt; &gt;&gt; the threshold at which such ~hacks become interesting.)<b=
r>&gt;&gt; &gt;<br>&gt;&gt; &gt; I don&#39;t think it&#39;s necessary to pu=
t this in ocamlfind, which does the job<br>&gt;&gt; &gt; it&#39;s designed =
to do very well. Just fix your build systems to run ocamlfind<br>
&gt;&gt; &gt; at configure time, save the results, and apply them to the co=
mpiler flags<br>&gt;&gt; &gt; during the build phase.<br>&gt;&gt; &gt;<br>&=
gt;&gt; &gt; -anil<br>&gt;&gt; &gt;<br>&gt;&gt; ___________________________=
____________________<br>
&gt;&gt; wg-camlp4 mailing list<br>&gt;&gt; <a href=3D"mailto:wg-camlp4@lis=
ts.ocaml.org">wg-camlp4@lists.ocaml.org</a><br>&gt;&gt; <a href=3D"http://l=
ists.ocaml.org/listinfo/wg-camlp4">http://lists.ocaml.org/listinfo/wg-camlp=
4</a><br>
&gt;&gt;<br>&gt;&gt;<br>&gt;&gt;<br>&gt;&gt; --<br>&gt;&gt; -- Regards, Hon=
gbo<br>&gt;&gt; _______________________________________________<br>&gt;&gt;=
 wg-camlp4 mailing list<br>&gt;&gt; <a href=3D"mailto:wg-camlp4@lists.ocaml=
.org">wg-camlp4@lists.ocaml.org</a><br>
&gt;&gt; <a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4">http://lists=
.ocaml.org/listinfo/wg-camlp4</a><br>&gt;<br><br><br><br>-- <br>-- Regards,=
 Hongbo<br></div>

--14dae9cdcc751437a404d5873a08--

From thomas.gazagnaire@gmail.com  Tue Feb 12 13:56:58 2013
Return-Path: <thomas.gazagnaire@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id DDCD23CBE2
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 13:56:58 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1444680 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.43 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (thomas.gazagnaire[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f43.google.com ([74.125.82.43]:54089)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U5GQw-0004dd-nA (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <thomas.gazagnaire@gmail.com>); Tue, 12 Feb 2013 14:02:07 +0000
Received: by mail-wg0-f43.google.com with SMTP id e12so79754wge.34
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 06:02:06 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:subject:mime-version:content-type:from
 :in-reply-to:date:cc:content-transfer-encoding:message-id:references
 :to:x-mailer; bh=lN/5AYV/SFLQbpUC3Tq9rfUAHOt+5uQz9OG/kYydTAo=;
 b=TyFAaK8I9j6XGgU2JayulBzaQVjEJHS07Ek7ZpQXBGW9unBQ4cWNmPtXAQPKWSw/Gg
 cXr7kUbG5G1joLD0YgDU4uA9TFbO/1Z6QFJrxvJOCc439qWwYVboU2KAA2CjQzeKJkKk
 alHIeLZTE6lL/s+qMOCEPEEo4Gkv6Uxy4VkaYM4JVmvQ+Jh6CIl88YyTkFG94mn6git1
 5ytaT+XIkJQACsBlk2wnsPx02hS83oaQzGnmFchXog1VmSOgXypLlBq3BpLv/0lw5Suu
 9uIjzTBSbGHlE0g8CXWhrcPYu/DjAhPZyh1A3EhSdSYMv2zec/bBOsmIOPecC2Zp/1Sj
 7TPg==
X-Received: by 10.194.92.231 with SMTP id cp7mr15742999wjb.19.1360677726011;
 Tue, 12 Feb 2013 06:02:06 -0800 (PST)
Received: from [192.168.0.14] (gou06-3-88-170-165-56.fbx.proxad.net.
 [88.170.165.56])
 by mx.google.com with ESMTPS id hb9sm36781395wib.3.2013.02.12.06.02.03
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Tue, 12 Feb 2013 06:02:05 -0800 (PST)
Sender: Thomas Gazagnaire <thomas.gazagnaire@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1085)
Content-Type: text/plain; charset=us-ascii
From: Thomas Gazagnaire <thomas@ocamlpro.com>
In-Reply-To: <CANcqPu4wHE+PPLb5wfK=UM1_R2aLX2gzUE+f48JwCOdHXfMHJQ@mail.gmail.com>
Date: Tue, 12 Feb 2013 15:02:02 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <2DB281F2-8A2B-4D20-B758-6EBCB4C34BD7@ocamlpro.com>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
 <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
 <6E9F4686-250B-4C25-8149-A952543B3BE7@recoil.org>
 <CAPFanBGnTvCy1MvAP2nsFF3Kv+=RrFOXDjmyOqabJ9cUvVEb_w@mail.gmail.com>
 <CANcqPu79E86_oG9z=SEk7RuKn_DOd=MO7PEXkDR_ykAF8TTz6g@mail.gmail.com>
 <585C2A34-2B1C-4970-B985-727438280335@ocamlpro.com>
 <CANcqPu4wHE+PPLb5wfK=UM1_R2aLX2gzUE+f48JwCOdHXfMHJQ@mail.gmail.com>
To: Hongbo Zhang <hongboz@seas.upenn.edu>
X-Mailer: Apple Mail (2.1085)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 12 Feb 2013 13:56:58 -0000

> For each file subdir/a.ml in src directory, there is a corresponding =
file subdir/a.ml in the cold directory, they have the same Parsetree, =
the only difference is that file in src should be preprocessed, while =
the file in cold is vanilla ocaml code that can be compiled without =
preprocessing.
>=20
> So here=20
> ocamlbuild src/FanDriver.native=20
> and
> ocamlbuild cold/FanDriver.native
> does exactly the samething except for each file, when=20
> compiling src/a.mo, it will compile as
> ocamlc.opt -c -pp fan src/a.ml=20
> while when compiing cold/a.ml, it works as normal
> ocamlc.opt -c cold/a.ml

I still don't understand. Alain clearly showed my the overhead of ppx =
compared to bare-bone ocaml compilers using dynamic and static =
strategies. I understand where are the bottleneck and I'm confident that =
this will not be a concerned regarding compilation speed. Here I don't =
understand what you are measuring exactly . So what magic is hidden in =
your '-pp fan' ? Does it look for some predefined path to dynamically =
load macros, or is it a self-contained statically-linked compiler ? In =
the later case, how does it work in practice when people start =
assembling different pieces of syntax extensions (as it is already the =
case with camlp4) ?

 Honestly, I don't have a strong opinion on which final syntax/solution =
this group will pick up (ppx, fan or other with hopefully a light syntax =
proposal) , I just need concrete arguments to motivate me enough to dig =
into my old camlp4 code and port it to the new selected tool. Also, I =
think it's important to understand upfront the impact of this change on =
how we are building OCaml programs: should we change all of our =
compilation tools if we want decent compilation performance ? For =
instance, I think that the way people tend to use camlp4 and ocamlfind =
is very suboptimal in term of compilation speed, and I think this comes =
from a design issue in the first place. Let's not do that again please.

--
Thomas
=20
>=20
> For our non-trivial code base, our output shows that when compiling =
with preprocessing by Fan, its performance is 30s compared with 28s =
without preprocessing, this means with good engineering effort, even =
preprocessing as powerful as camlp4(Fan provide more features than =
camlp4) should bring not too much overhead, I did some experiment =
before, my feeling is that typechecking is the bottleneck in most cases.
>=20
> The extra effort for Fan compared with compiling directly is a dumping =
process which dumps FanAst into Parsetree, since our output is already =
good enough in practice, I did not tune the GC for better performance.
>=20
> >
> > Cheers,
> > Thomas
> >
> >>
> >>
> >> On Mon, Feb 11, 2013 at 7:20 AM, Gabriel Scherer =
<gabriel.scherer@gmail.com> wrote:
> >> On the other hand, build systems come and go (and ./configure is =
like
> >> the most horrible part to add logic to in most cases), while =
ocamlfind
> >> has proved a reliable tool as a basis for any OCaml ecosystem so =
far.
> >> If I can shelve some logic there without making the tool more =
complex
> >> or less elegant I think that would be better for everyone.
> >>
> >> On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy =
<anil@recoil.org> wrote:
> >> > On 11 Feb 2013, at 10:45, Gabriel Scherer =
<gabriel.scherer@gmail.com> wrote:
> >> >
> >> >> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy =
<anil@recoil.org> wrote:
> >> >>> It should work just fine with ppx, and has the advantage of =
reducing the number of ocamlfind calls per-file (which is a considerable =
overhead on large projects, since it has to scan the META directories on =
every invocation).
> >> >>
> >> >> That's of course rather orthogonal to the present discussion, =
but have
> >> >> you been in contact with Gerd to see if some caching solution =
would be
> >> >> possible? Intuitively it feels like ocamlfind could easily =
maintain a
> >> >> cache in /var/run/blah and only clean it on install/remove =
commands.
> >> >>
> >> >> (An external process invocation would still make some overhead =
so in
> >> >> you're case you'd still have to go all the way, but that could =
improve
> >> >> the threshold at which such ~hacks become interesting.)
> >> >
> >> > I don't think it's necessary to put this in ocamlfind, which does =
the job
> >> > it's designed to do very well. Just fix your build systems to run =
ocamlfind
> >> > at configure time, save the results, and apply them to the =
compiler flags
> >> > during the build phase.
> >> >
> >> > -anil
> >> >
> >> _______________________________________________
> >> wg-camlp4 mailing list
> >> wg-camlp4@lists.ocaml.org
> >> http://lists.ocaml.org/listinfo/wg-camlp4
> >>
> >>
> >>
> >> --
> >> -- Regards, Hongbo
> >> _______________________________________________
> >> wg-camlp4 mailing list
> >> wg-camlp4@lists.ocaml.org
> >> http://lists.ocaml.org/listinfo/wg-camlp4
> >
>=20
>=20
>=20
> --=20
> -- Regards, Hongbo


From hez@0ok.org  Tue Feb 12 14:04:15 2013
Return-Path: <hez@0ok.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 323FC3CBE2
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 14:04:15 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1444680 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [208.97.132.66 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from caiajhbdcagg.dreamhost.com ([208.97.132.66]:47992
 helo=homiemail-a98.g.dreamhost.com)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U5GXt-0004fm-sJ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <hez@0ok.org>); Tue, 12 Feb 2013 14:09:23 +0000
Received: from homiemail-a98.g.dreamhost.com (localhost [127.0.0.1])
 by homiemail-a98.g.dreamhost.com (Postfix) with ESMTP id CE3A02C207C
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 06:08:56 -0800 (PST)
DomainKey-Signature: a=rsa-sha1; c=nofws; d=0ok.org; h=mime-version
 :in-reply-to:references:from:date:message-id:subject:to:cc:
 content-type; q=dns; s=0ok.org; b=X/Ca8os525w4qCEL/uc3Ng+ura4YT0
 7AykrM9TjeBvNtfBmdIkebfXYacNmnrP8m1lnz6x53dzIfKUSYGSS61t9Wm7e9te
 PkN+2z35p5ToaZo3QGn8AWUeCpKm+lp6vpzpZprOoHt9esPMgej7GJ6FrNncb/ZW
 Fr1GCLjUUkRh0=
DKIM-Signature: v=1; a=rsa-sha1; c=relaxed; d=0ok.org; h=mime-version
 :in-reply-to:references:from:date:message-id:subject:to:cc:
 content-type; s=0ok.org; bh=NCVV1ZbRjs4T0sckEjjmGcM0fFw=; b=cR7B
 OJxKf26/LpCqEAhCx+bkGwLpDM9VLiMYkTrh0+BvhEIY/fTRsemHdGdfdYivcv9n
 P7usHSvyoBbm2BLXR3pKtJZg4iQR/nYr68Dwc2nT7CYuKeCkKUrR4+5Na8DGy/pR
 BEni8iH3vCpsWdOiNtVGbyp922TtCiGn5+JmfcI=
Received: from mail-qc0-f178.google.com (mail-qc0-f178.google.com
 [209.85.216.178]) (using TLSv1 with cipher RC4-SHA (128/128 bits))
 (No client certificate requested) (Authenticated sender: hez@0ok.org)
 by homiemail-a98.g.dreamhost.com (Postfix) with ESMTPSA id 7ABA42C206E
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 06:08:56 -0800 (PST)
Received: by mail-qc0-f178.google.com with SMTP id j34so38680qco.23
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 06:08:55 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type:x-gm-message-state;
 bh=SwPhAx5FNMOAPNHt+6bxLYuLLcfGlpzhPfvP5uIS0PU=;
 b=bTOKrjVGzv3dparrwVcI/hwlx6tQawCWAzYU2qgdS2w9GfB91vhwKjABMxAaJ+dvQb
 esYQWHrw+kY3luS0q7yJqDqgB1DYov6BztsfGUIaCB6S5mZKbFxc16Eit3tnFmJGdBeR
 RycprdpOYKtNjTsEYkt25k16I4SWO2mfSd0Kdj0UwXDVMhOocSd49I+utgzWzAroHO5j
 JGZsfyyp9BJajQEmlDivqmofL+VGpXPRsqQ9+7cL//bkH5eczb7Ed5uJ8KsoU7oRHw7T
 u+/RQfbaB05K8b7OfNesKz2wGKAv03Ink+rXalWnl0ZubnWiJPH2Q1mw/4hrocF8xJFa
 9r3w==
X-Received: by 10.224.31.209 with SMTP id z17mr7041920qac.28.1360678134942;
 Tue, 12 Feb 2013 06:08:54 -0800 (PST)
MIME-Version: 1.0
Received: by 10.49.12.240 with HTTP; Tue, 12 Feb 2013 06:08:34 -0800 (PST)
In-Reply-To: <51190420.5080305@lexifi.com>
References: <51190420.5080305@lexifi.com>
From: "Hezekiah M. Carty" <hez@0ok.org>
Date: Tue, 12 Feb 2013 09:08:34 -0500
Message-ID: <CAMfPyLDQTa1KaV4QkGxZsxiaauQMFqmSZWPwWHRVraC3VJKZAw@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=UTF-8
X-Gm-Message-State: ALoCoQkBKbgg7GHddLLpHsFroxUKYr/My2BV13smwskPZKmpEGYmohERJ6q7Vz79LoiwT/moB14M
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 12 Feb 2013 14:04:15 -0000

On Mon, Feb 11, 2013 at 9:45 AM, Alain Frisch <alain.frisch@lexifi.com> wrote:
>
> 3. Quotations
>
> The more I think about it, the more I believe this concept is orthogonal to
> "extensions".  Leo disagrees and would like to have a combined syntax for
> the case where the argument of an extension is a quotation.  What do other
> people think?  (For me, a quotation is only a way to introduce a string
> literal without "suffering" from the lexical conventions of OCaml.)
>
> For the concrete syntax of quotations, it was suggested to use a form where
> the closing delimiter would be defined by the opening one.  This makes it
> possible to "quote" an arbitrary string without having to define a way to
> escape a potential occurrence of the closing delimiter (just pick a
> different one).   Example:  {xxx{blablabla}xxx}
>
> Do people familiar with implementation of editor modes believe it will be
> easy to support such syntax in emacs or vim modes?
>

Perl's custom quotes are similar and vim handles them well.  For
example, q/foo/ and q{foo} are both highlighted properly and would be
roughly equivalent to {{"foo"}}.

Hez

From bobzhang1988@gmail.com  Tue Feb 12 14:12:56 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 84B253CBE3
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 14:12:56 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1444680 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.54 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f54.google.com ([209.85.212.54]:61629)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U5GgN-0008Vl-S5 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Tue, 12 Feb 2013 14:18:04 +0000
Received: by mail-vb0-f54.google.com with SMTP id l1so71860vba.13
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 06:18:03 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=OF+oKb683osbjNXKbn2yxdk7CmtXnYiDw00kT41wDuw=;
 b=Gai2ZLepnPkEcE+mNWu8vS4PdFb3L/NhWfy5WfjlMhRRg+FmcbBWBFoeBjAuXcDQrn
 dIVRsMgbdjdu/a8T3Az1kteAUjb8X2+kdTt8BadJ7SIwNMg0T5fevgiupacHjckjFoVb
 bq2+5nelMTfVtGrGgOV5PYUgKa+eNqJ37e2tc3tVE0eMoo39uIjEqeUsNN+1g7MlO/2k
 /32Ni911gHQMIIyyYmHaQQRaKAEPYF+R2z1Xemzgm7Hs9Vy0QykyDPWQBRi0pDZeJm2o
 NY4RMy54tDYDuVwYXAJ/PgYvBex1RQLxRCJsw/nZk6I3XCYBPQ/0F6fmwVj/vsQpPOaX
 JP+A==
MIME-Version: 1.0
X-Received: by 10.58.50.7 with SMTP id y7mr24079844ven.24.1360678682875; Tue,
 12 Feb 2013 06:18:02 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Tue, 12 Feb 2013 06:18:02 -0800 (PST)
In-Reply-To: <2DB281F2-8A2B-4D20-B758-6EBCB4C34BD7@ocamlpro.com>
References: <E51AEB20-0079-4D94-B75E-7BEDA84CFCC1@ocamlpro.com>
 <51149780.1010302@lexifi.com> <5118C2B8.4070807@lexifi.com>
 <293E5CF1-A147-49A1-8854-F428F28FFA1E@recoil.org>
 <CAPFanBGmFWg4JL17Qs5BiC9B30pu9CrGXc8eHA-QHN-f+RnNoQ@mail.gmail.com>
 <6E9F4686-250B-4C25-8149-A952543B3BE7@recoil.org>
 <CAPFanBGnTvCy1MvAP2nsFF3Kv+=RrFOXDjmyOqabJ9cUvVEb_w@mail.gmail.com>
 <CANcqPu79E86_oG9z=SEk7RuKn_DOd=MO7PEXkDR_ykAF8TTz6g@mail.gmail.com>
 <585C2A34-2B1C-4970-B985-727438280335@ocamlpro.com>
 <CANcqPu4wHE+PPLb5wfK=UM1_R2aLX2gzUE+f48JwCOdHXfMHJQ@mail.gmail.com>
 <2DB281F2-8A2B-4D20-B758-6EBCB4C34BD7@ocamlpro.com>
Date: Tue, 12 Feb 2013 09:18:02 -0500
X-Google-Sender-Auth: ejFWv2938sirP-UgCEboul-45yA
Message-ID: <CANcqPu4Z_Q5FD3_DKAVMR+MgU4NVeby9SJFk4f7WELUCfdLyJA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Thomas Gazagnaire <thomas@ocamlpro.com>
Content-Type: multipart/alternative; boundary=089e0112c63a8bd75c04d587b155
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] benchmarks
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 12 Feb 2013 14:12:56 -0000

--089e0112c63a8bd75c04d587b155
Content-Type: text/plain; charset=ISO-8859-1

On Tue, Feb 12, 2013 at 9:02 AM, Thomas Gazagnaire <thomas@ocamlpro.com>wrote:

>
>
> I still don't understand. Alain clearly showed my the overhead of ppx
> compared to bare-bone ocaml compilers using dynamic and static strategies.
> I understand where are the bottleneck and I'm confident that this will not
> be a concerned regarding compilation speed. Here I don't understand what
> you are measuring exactly . So what magic is hidden in your '-pp fan' ?
> Does it look for some predefined path to dynamically load macros, or is it
> a self-contained statically-linked compiler ? In the later case, how does
> it work in practice when people start assembling different pieces of syntax
> extensions (as it is already the case with camlp4) ?
>
It's a statically-linked compiler. I am concerned about performance as much
as you, since I have to bootstrap Fan itself everytime I add new features.
Unlike Camlp4, Fan's design encourages static linking or dynamic linking as
much as you can. When you have different pieces of extensions, the static
linking or dynamic linking *only registe*r what features it provides, here
the order does not matter, and it does not have any side effect otherwise,
the file in src/a.ml specifies which syntax extension it wants to pick
for example in src/a.ml
---------------------------------
#load_syntax ["normal"];;
#filter ["serialize"];;
blabla ...
---------------------------------
itself states what syntax or ast rewriter it needs, so here you only need
to supply '-pp fan', it could figure out how to parse and transform the Ast
by itself as long as those features needed are registered.



>  Honestly, I don't have a strong opinion on which final syntax/solution
> this group will pick up (ppx, fan or other with hopefully a light syntax
> proposal) , I just need concrete arguments to motivate me enough to dig
> into my old camlp4 code and port it to the new selected tool. Also, I think
> it's important to understand upfront the impact of this change on how we
> are building OCaml programs: should we change all of our compilation tools
> if we want decent compilation performance ? For instance, I think that the
> way people tend to use camlp4 and ocamlfind is very suboptimal in term of
> compilation speed, and I think this comes from a design issue in the first
> place. Let's not do that again please.
>
> --
> Thomas
>
> >
> > For our non-trivial code base, our output shows that when compiling with
> preprocessing by Fan, its performance is 30s compared with 28s without
> preprocessing, this means with good engineering effort, even preprocessing
> as powerful as camlp4(Fan provide more features than camlp4) should bring
> not too much overhead, I did some experiment before, my feeling is that
> typechecking is the bottleneck in most cases.
> >
> > The extra effort for Fan compared with compiling directly is a dumping
> process which dumps FanAst into Parsetree, since our output is already good
> enough in practice, I did not tune the GC for better performance.
> >
> > >
> > > Cheers,
> > > Thomas
> > >
> > >>
> > >>
> > >> On Mon, Feb 11, 2013 at 7:20 AM, Gabriel Scherer <
> gabriel.scherer@gmail.com> wrote:
> > >> On the other hand, build systems come and go (and ./configure is like
> > >> the most horrible part to add logic to in most cases), while ocamlfind
> > >> has proved a reliable tool as a basis for any OCaml ecosystem so far.
> > >> If I can shelve some logic there without making the tool more complex
> > >> or less elegant I think that would be better for everyone.
> > >>
> > >> On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy <anil@recoil.org>
> wrote:
> > >> > On 11 Feb 2013, at 10:45, Gabriel Scherer <
> gabriel.scherer@gmail.com> wrote:
> > >> >
> > >> >> On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy <
> anil@recoil.org> wrote:
> > >> >>> It should work just fine with ppx, and has the advantage of
> reducing the number of ocamlfind calls per-file (which is a considerable
> overhead on large projects, since it has to scan the META directories on
> every invocation).
> > >> >>
> > >> >> That's of course rather orthogonal to the present discussion, but
> have
> > >> >> you been in contact with Gerd to see if some caching solution
> would be
> > >> >> possible? Intuitively it feels like ocamlfind could easily
> maintain a
> > >> >> cache in /var/run/blah and only clean it on install/remove
> commands.
> > >> >>
> > >> >> (An external process invocation would still make some overhead so
> in
> > >> >> you're case you'd still have to go all the way, but that could
> improve
> > >> >> the threshold at which such ~hacks become interesting.)
> > >> >
> > >> > I don't think it's necessary to put this in ocamlfind, which does
> the job
> > >> > it's designed to do very well. Just fix your build systems to run
> ocamlfind
> > >> > at configure time, save the results, and apply them to the compiler
> flags
> > >> > during the build phase.
> > >> >
> > >> > -anil
> > >> >
> > >> _______________________________________________
> > >> wg-camlp4 mailing list
> > >> wg-camlp4@lists.ocaml.org
> > >> http://lists.ocaml.org/listinfo/wg-camlp4
> > >>
> > >>
> > >>
> > >> --
> > >> -- Regards, Hongbo
> > >> _______________________________________________
> > >> wg-camlp4 mailing list
> > >> wg-camlp4@lists.ocaml.org
> > >> http://lists.ocaml.org/listinfo/wg-camlp4
> > >
> >
> >
> >
> > --
> > -- Regards, Hongbo
>
>


-- 
-- Regards, Hongbo

--089e0112c63a8bd75c04d587b155
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Tue, Feb 12, 2013 at 9:02 AM, Thomas =
Gazagnaire <span dir=3D"ltr">&lt;<a href=3D"mailto:thomas@ocamlpro.com" tar=
get=3D"_blank">thomas@ocamlpro.com</a>&gt;</span> wrote:<br><blockquote cla=
ss=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;pa=
dding-left:1ex">
<div class=3D"im"><br>
<br>
</div>I still don&#39;t understand. Alain clearly showed my the overhead of=
 ppx compared to bare-bone ocaml compilers using dynamic and static strateg=
ies. I understand where are the bottleneck and I&#39;m confident that this =
will not be a concerned regarding compilation speed. Here I don&#39;t under=
stand what you are measuring exactly . So what magic is hidden in your &#39=
;-pp fan&#39; ? Does it look for some predefined path to dynamically load m=
acros, or is it a self-contained statically-linked compiler ? In the later =
case, how does it work in practice when people start assembling different p=
ieces of syntax extensions (as it is already the case with camlp4) ?<br>
</blockquote><div>It&#39;s a statically-linked compiler. I am concerned abo=
ut performance as much as you, since I have to bootstrap Fan itself everyti=
me I add new features.=A0</div><div>Unlike Camlp4, Fan&#39;s design encoura=
ges static linking or dynamic linking as much as you can. When you have dif=
ferent pieces of extensions, the static linking or dynamic linking <b>only =
registe</b>r what features it provides, here the order does not matter, and=
 it does not have any side effect otherwise, the file in src/<a href=3D"htt=
p://a.ml">a.ml</a> specifies which syntax extension it wants to pick</div>
<div>for example in src/<a href=3D"http://a.ml">a.ml</a></div><div>--------=
-------------------------</div><div>#load_syntax [&quot;normal&quot;];;</di=
v><div>#filter [&quot;serialize&quot;];;</div><div>blabla ...</div><div>---=
------------------------------</div>
<div>itself states what syntax or ast rewriter it needs, so here you only n=
eed to supply &#39;-pp fan&#39;, it could figure out how to parse and trans=
form the Ast by itself as long as those features needed are registered.</di=
v>
<div><br></div><div><br></div><blockquote class=3D"gmail_quote" style=3D"ma=
rgin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<br>
=A0Honestly, I don&#39;t have a strong opinion on which final syntax/soluti=
on this group will pick up (ppx, fan or other with hopefully a light syntax=
 proposal) , I just need concrete arguments to motivate me enough to dig in=
to my old camlp4 code and port it to the new selected tool. Also, I think i=
t&#39;s important to understand upfront the impact of this change on how we=
 are building OCaml programs: should we change all of our compilation tools=
 if we want decent compilation performance ? For instance, I think that the=
 way people tend to use camlp4 and ocamlfind is very suboptimal in term of =
compilation speed, and I think this comes from a design issue in the first =
place. Let&#39;s not do that again please.<br>

<br>
--<br>
Thomas<br>
<div class=3D"HOEnZb"><div class=3D"h5"><br>
&gt;<br>
&gt; For our non-trivial code base, our output shows that when compiling wi=
th preprocessing by Fan, its performance is 30s compared with 28s without p=
reprocessing, this means with good engineering effort, even preprocessing a=
s powerful as camlp4(Fan provide more features than camlp4) should bring no=
t too much overhead, I did some experiment before, my feeling is that typec=
hecking is the bottleneck in most cases.<br>

&gt;<br>
&gt; The extra effort for Fan compared with compiling directly is a dumping=
 process which dumps FanAst into Parsetree, since our output is already goo=
d enough in practice, I did not tune the GC for better performance.<br>

&gt;<br>
&gt; &gt;<br>
&gt; &gt; Cheers,<br>
&gt; &gt; Thomas<br>
&gt; &gt;<br>
&gt; &gt;&gt;<br>
&gt; &gt;&gt;<br>
&gt; &gt;&gt; On Mon, Feb 11, 2013 at 7:20 AM, Gabriel Scherer &lt;<a href=
=3D"mailto:gabriel.scherer@gmail.com">gabriel.scherer@gmail.com</a>&gt; wro=
te:<br>
&gt; &gt;&gt; On the other hand, build systems come and go (and ./configure=
 is like<br>
&gt; &gt;&gt; the most horrible part to add logic to in most cases), while =
ocamlfind<br>
&gt; &gt;&gt; has proved a reliable tool as a basis for any OCaml ecosystem=
 so far.<br>
&gt; &gt;&gt; If I can shelve some logic there without making the tool more=
 complex<br>
&gt; &gt;&gt; or less elegant I think that would be better for everyone.<br=
>
&gt; &gt;&gt;<br>
&gt; &gt;&gt; On Mon, Feb 11, 2013 at 11:56 AM, Anil Madhavapeddy &lt;<a hr=
ef=3D"mailto:anil@recoil.org">anil@recoil.org</a>&gt; wrote:<br>
&gt; &gt;&gt; &gt; On 11 Feb 2013, at 10:45, Gabriel Scherer &lt;<a href=3D=
"mailto:gabriel.scherer@gmail.com">gabriel.scherer@gmail.com</a>&gt; wrote:=
<br>
&gt; &gt;&gt; &gt;<br>
&gt; &gt;&gt; &gt;&gt; On Mon, Feb 11, 2013 at 11:31 AM, Anil Madhavapeddy =
&lt;<a href=3D"mailto:anil@recoil.org">anil@recoil.org</a>&gt; wrote:<br>
&gt; &gt;&gt; &gt;&gt;&gt; It should work just fine with ppx, and has the a=
dvantage of reducing the number of ocamlfind calls per-file (which is a con=
siderable overhead on large projects, since it has to scan the META directo=
ries on every invocation).<br>

&gt; &gt;&gt; &gt;&gt;<br>
&gt; &gt;&gt; &gt;&gt; That&#39;s of course rather orthogonal to the presen=
t discussion, but have<br>
&gt; &gt;&gt; &gt;&gt; you been in contact with Gerd to see if some caching=
 solution would be<br>
&gt; &gt;&gt; &gt;&gt; possible? Intuitively it feels like ocamlfind could =
easily maintain a<br>
&gt; &gt;&gt; &gt;&gt; cache in /var/run/blah and only clean it on install/=
remove commands.<br>
&gt; &gt;&gt; &gt;&gt;<br>
&gt; &gt;&gt; &gt;&gt; (An external process invocation would still make som=
e overhead so in<br>
&gt; &gt;&gt; &gt;&gt; you&#39;re case you&#39;d still have to go all the w=
ay, but that could improve<br>
&gt; &gt;&gt; &gt;&gt; the threshold at which such ~hacks become interestin=
g.)<br>
&gt; &gt;&gt; &gt;<br>
&gt; &gt;&gt; &gt; I don&#39;t think it&#39;s necessary to put this in ocam=
lfind, which does the job<br>
&gt; &gt;&gt; &gt; it&#39;s designed to do very well. Just fix your build s=
ystems to run ocamlfind<br>
&gt; &gt;&gt; &gt; at configure time, save the results, and apply them to t=
he compiler flags<br>
&gt; &gt;&gt; &gt; during the build phase.<br>
&gt; &gt;&gt; &gt;<br>
&gt; &gt;&gt; &gt; -anil<br>
&gt; &gt;&gt; &gt;<br>
&gt; &gt;&gt; _______________________________________________<br>
&gt; &gt;&gt; wg-camlp4 mailing list<br>
&gt; &gt;&gt; <a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.=
ocaml.org</a><br>
&gt; &gt;&gt; <a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=
=3D"_blank">http://lists.ocaml.org/listinfo/wg-camlp4</a><br>
&gt; &gt;&gt;<br>
&gt; &gt;&gt;<br>
&gt; &gt;&gt;<br>
&gt; &gt;&gt; --<br>
&gt; &gt;&gt; -- Regards, Hongbo<br>
&gt; &gt;&gt; _______________________________________________<br>
&gt; &gt;&gt; wg-camlp4 mailing list<br>
&gt; &gt;&gt; <a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.=
ocaml.org</a><br>
&gt; &gt;&gt; <a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=
=3D"_blank">http://lists.ocaml.org/listinfo/wg-camlp4</a><br>
&gt; &gt;<br>
&gt;<br>
&gt;<br>
&gt;<br>
&gt; --<br>
&gt; -- Regards, Hongbo<br>
<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo

--089e0112c63a8bd75c04d587b155--

From pierre.chambart@ocamlpro.com  Tue Feb 12 20:07:24 2013
Return-Path: <pierre.chambart@ocamlpro.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 378B33CBE5
 for <wg-camlp4@lists.ocaml.org>; Tue, 12 Feb 2013 20:07:24 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1444680
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from redisdead.crans.org ([138.231.136.39]:40839)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U5MDQ-0003nq-nx (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <pierre.chambart@ocamlpro.com>); Tue, 12 Feb 2013 20:12:33 +0000
Received: from localhost (abo-30-238-68.guy.modulonet.fr [85.68.238.30])
 (using SSLv3 with cipher DHE-RSA-AES128-SHA (128/128 bits))
 (No client certificate requested)
 by redisdead.crans.org (Postfix) with ESMTPSA id 146A82142;
 Tue, 12 Feb 2013 21:12:31 +0100 (CET)
Date: Tue, 12 Feb 2013 21:12:26 +0100
From: Pierre Chambart <pierre.chambart@ocamlpro.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <20130212211226.31edad00@ocamlpro.com>
In-Reply-To: <51190420.5080305@lexifi.com>
References: <51190420.5080305@lexifi.com>
Organization: OCamlPro
X-Mailer: Claws Mail 3.8.1 (GTK+ 2.24.10; x86_64-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=PGP-SHA1;
 boundary="Sig_/AjH_KlO.Mu=nQY62RBPMWlq"; protocol="application/pgp-signature"
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 12 Feb 2013 20:07:24 -0000

--Sig_/AjH_KlO.Mu=nQY62RBPMWlq
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Le Mon, 11 Feb 2013 15:45:52 +0100,
Alain Frisch <alain.frisch@lexifi.com> a =C3=A9crit :

> 4. What to do with attributes in the type-checker
>=20
> ...
>=20
> A related question is related to the current work on runtime types.=20
> Attributes on type declarations could be kept in the runtime=20
> representation of the declarations, allowing libraries to interpret
> them as they want.  (LexiFi's version of OCaml has been extended with=20
> attributes on type declarations precisely to do that.)  Having=20
> attributes defined as general expressions, however, means that those=20
> libraries would need to link with compiler-libs, or at least be
> compiled against some of its .cmi, in order to be able to analyze the
> Parsetree. I don't see it is as a big problem, and it would also be
> possible to restrict which expressions are reflected in runtime types
> (e.g. to structured constants).  Comments are welcome!

I think it is usualy a bad idea to need to link against compiler-libs.
Doing so almost certainly prevent you from being able to compile
against different version of the compiler. This ast should be
fixed once and be provided in the stdlib. I would also prefer to
restrict that kind of annotation to a small subset of the expression
language avoiding as much as possible duplication. This would simplify
the code using those annotations. Maybe only list, Variant, record and
string literals/identifiers would be sufficient. Maybe also let in ?

--=20
Pierre

--Sig_/AjH_KlO.Mu=nQY62RBPMWlq
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iEYEARECAAYFAlEaoioACgkQQ2gKRvJTD87AgACgiOgMlrkpf2bqWXfAp7rzvxCY
oqYAoJ5oqCpyNu4+JJcrGJItiICfeqdA
=b5KN
-----END PGP SIGNATURE-----

--Sig_/AjH_KlO.Mu=nQY62RBPMWlq--

From lpw25@hermes.cam.ac.uk  Wed Feb 13 12:01:02 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 94C7B3C53B
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Feb 2013 12:01:02 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:44488)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U5b6L-0007JH-Wq (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 13 Feb 2013 12:06:13 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U5b6L-0008N4-4u (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 13 Feb 2013 12:06:13 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 13 Feb 2013 12:06:12 +0000
Date: 13 Feb 2013 12:06:12 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Pierre Chambart <pierre.chambart@ocamlpro.com>
Message-ID: <Prayer.1.3.5.1302131206120.25997@hermes-1.csi.cam.ac.uk>
In-Reply-To: <20130212211226.31edad00@ocamlpro.com>
References: <51190420.5080305@lexifi.com>
 <20130212211226.31edad00@ocamlpro.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Feb 2013 12:01:02 -0000

>> A related question is related to the current work on runtime types. 
>> Attributes on type declarations could be kept in the runtime 
>> representation of the declarations, allowing libraries to interpret
>> them as they want.  (LexiFi's version of OCaml has been extended with 
>> attributes on type declarations precisely to do that.)  Having 
>> attributes defined as general expressions, however, means that those 
>> libraries would need to link with compiler-libs, or at least be
>> compiled against some of its .cmi, in order to be able to analyze the
>> Parsetree. I don't see it is as a big problem, and it would also be
>> possible to restrict which expressions are reflected in runtime types
>> (e.g. to structured constants).  Comments are welcome!
>
>I think it is usualy a bad idea to need to link against compiler-libs.
>Doing so almost certainly prevent you from being able to compile
>against different version of the compiler. This ast should be
>fixed once and be provided in the stdlib. I would also prefer to
>restrict that kind of annotation to a small subset of the expression
>language avoiding as much as possible duplication. This would simplify
>the code using those annotations. Maybe only list, Variant, record and
>string literals/identifiers would be sufficient. Maybe also let in ?

I agree that we should avoid making people link against compiler-libs where 
possible. However, I think that having a fixed AST and only supporting a 
subset is too restrictive.

An alternative would be to provide a standard library module that could be 
used to handle simple ASTs, but still support using Parsetree directly for 
more complicated AST handling.

For example the "Ast" module might provide functions like:

getIdent: Ast.expression -> string option

which would return a string of an identifier if the expression was a simple 
identifier.

This way we don't restrict changes to Parsetree, or the possible 
expressions within an attribute, but we do allow people to get basic 
information out of an expression without linking against compiler-libs.



From pierre.chambart@ocamlpro.com  Wed Feb 13 12:10:35 2013
Return-Path: <pierre.chambart@ocamlpro.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id EB9393C53B
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Feb 2013 12:10:35 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1445060
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from redisdead.crans.org ([138.231.136.39]:38998)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U5bFa-0000at-Rk (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <pierre.chambart@ocamlpro.com>); Wed, 13 Feb 2013 12:15:47 +0000
Received: from localhost (perens.inria.fr [128.93.60.79])
 (using SSLv3 with cipher DHE-RSA-AES128-SHA (128/128 bits))
 (No client certificate requested)
 by redisdead.crans.org (Postfix) with ESMTPSA id 948392103;
 Wed, 13 Feb 2013 13:15:45 +0100 (CET)
Date: Wed, 13 Feb 2013 13:15:41 +0100
From: Pierre Chambart <pierre.chambart@ocamlpro.com>
To: Leo White <lpw25@cam.ac.uk>
Message-ID: <20130213131541.4e88a9a5@ocamlpro.com>
In-Reply-To: <Prayer.1.3.5.1302131206120.25997@hermes-1.csi.cam.ac.uk>
References: <51190420.5080305@lexifi.com>
 <20130212211226.31edad00@ocamlpro.com>
 <Prayer.1.3.5.1302131206120.25997@hermes-1.csi.cam.ac.uk>
Organization: OCamlPro
X-Mailer: Claws Mail 3.8.1 (GTK+ 2.24.10; x86_64-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=PGP-SHA1;
 boundary="Sig_/0n96AYyXtSBmOrEewHQlwA="; protocol="application/pgp-signature"
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Feb 2013 12:10:36 -0000

--Sig_/0n96AYyXtSBmOrEewHQlwA=
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Le 13 Feb 2013 12:06:12 +0000,
Leo White <lpw25@cam.ac.uk> a =C3=A9crit :

> >> A related question is related to the current work on runtime
> >> types. Attributes on type declarations could be kept in the
> >> runtime representation of the declarations, allowing libraries to
> >> interpret them as they want.  (LexiFi's version of OCaml has been
> >> extended with attributes on type declarations precisely to do
> >> that.)  Having attributes defined as general expressions, however,
> >> means that those libraries would need to link with compiler-libs,
> >> or at least be compiled against some of its .cmi, in order to be
> >> able to analyze the Parsetree. I don't see it is as a big problem,
> >> and it would also be possible to restrict which expressions are
> >> reflected in runtime types (e.g. to structured constants).
> >> Comments are welcome!
> >
> >I think it is usualy a bad idea to need to link against
> >compiler-libs. Doing so almost certainly prevent you from being able
> >to compile against different version of the compiler. This ast
> >should be fixed once and be provided in the stdlib. I would also
> >prefer to restrict that kind of annotation to a small subset of the
> >expression language avoiding as much as possible duplication. This
> >would simplify the code using those annotations. Maybe only list,
> >Variant, record and string literals/identifiers would be sufficient.
> >Maybe also let in ?
>=20
> I agree that we should avoid making people link against compiler-libs
> where possible. However, I think that having a fixed AST and only
> supporting a subset is too restrictive.
>=20
> An alternative would be to provide a standard library module that
> could be used to handle simple ASTs, but still support using
> Parsetree directly for more complicated AST handling.
>=20
> For example the "Ast" module might provide functions like:
>=20
> getIdent: Ast.expression -> string option
>=20
> which would return a string of an identifier if the expression was a
> simple identifier.
>=20
> This way we don't restrict changes to Parsetree, or the possible=20
> expressions within an attribute, but we do allow people to get basic=20
> information out of an expression without linking against
> compiler-libs.

I understand the need for accessing annotation at runtime, but why
whould anyone reasonnable want something else than simple declarative
informations, for which a simple substet is enouth. And restricting
as much as possible this make the usage far easier: this kind of value
won't be manipulated by 'experts' writing syntax extensions, but by
classical users. Moreover, if the ast you are manipulating is the full
ocaml one, it will be impossible to write exhaustive pattern matching
without breaking at each new ocaml release.

--=20
Pierre

--Sig_/0n96AYyXtSBmOrEewHQlwA=
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iEYEARECAAYFAlEbg+0ACgkQQ2gKRvJTD85ljgCfceMYO+Vmp6yYfDDgBLoA7y4O
agIAn07K+JwUYwoFVi2Ms/8Hs806+pM5
=Qibw
-----END PGP SIGNATURE-----

--Sig_/0n96AYyXtSBmOrEewHQlwA=--

From alain.frisch@lexifi.com  Wed Feb 13 13:07:50 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C5E2B3CBEC
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Feb 2013 13:07:50 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1445060 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:43260)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U5c8z-0007vy-oU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 13 Feb 2013 13:13:02 +0000
Received: from [192.168.0.11] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 82B41A6234;
 Wed, 13 Feb 2013 14:12:56 +0100 (CET)
Message-ID: <511B9154.3030608@lexifi.com>
Date: Wed, 13 Feb 2013 14:12:52 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Pierre Chambart <pierre.chambart@ocamlpro.com>
References: <51190420.5080305@lexifi.com>
 <20130212211226.31edad00@ocamlpro.com>
In-Reply-To: <20130212211226.31edad00@ocamlpro.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Feb 2013 13:07:50 -0000

On 2/12/2013 9:12 PM, Pierre Chambart wrote:
> I would also prefer to
> restrict that kind of annotation to a small subset of the expression
> language avoiding as much as possible duplication.

Just to be clear, do you propose to restrict attributes in general, or 
only those which will be reflected in runtime types?   There are several 
cases where one really wants to be able to use general expressions as 
attributes, such as the example given by Yaron:

          type t =
            { a : int with default(2), sexp_drop_if(fun x -> x = 2);
            } with sexp

One could imagine restricting attributes to structured constants, and 
one would have to write the expression as a string literal to be parsed 
explicitly by the ppx rewriter.  Two arguments against doing so:

   - You loose editor support (admittedly, attributes are likely to be 
short enough that we don't care).

   - You need to be more careful about the order in which ppx rewriters 
are applied. Imagine a variant of the example above:

    type t =
      { a : int with default(2), sexp_drop_if("fun x -> x = DEFAULT");
      } with sexp

  where DEFAULT is to be expanded by another ppx rewriter.  Then you 
need to ensure that the macro expander is run after "sexp", not before. 
  And one could build other examples where one really needs the macro 
expander to apply to the attribute's content before it is processed 
(which works only if the attribute content is parsed).


Alain

From lpw25@hermes.cam.ac.uk  Wed Feb 13 13:42:16 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6015E3CBEC
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Feb 2013 13:42:16 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:53760)
 by ppsw-43.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U5cgJ-0005md-pK (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 13 Feb 2013 13:47:27 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U5cgJ-0005TS-Sg (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 13 Feb 2013 13:47:27 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 13 Feb 2013 13:47:27 +0000
Date: 13 Feb 2013 13:47:27 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Pierre Chambart <pierre.chambart@ocamlpro.com>
Message-ID: <Prayer.1.3.5.1302131347271.7788@hermes-1.csi.cam.ac.uk>
In-Reply-To: <20130213131541.4e88a9a5@ocamlpro.com>
References: <51190420.5080305@lexifi.com>
 <20130212211226.31edad00@ocamlpro.com>
 <Prayer.1.3.5.1302131206120.25997@hermes-1.csi.cam.ac.uk>
 <20130213131541.4e88a9a5@ocamlpro.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Feb 2013 13:42:16 -0000

>I understand the need for accessing annotation at runtime, but why
>whould anyone reasonnable want something else than simple declarative
>informations, for which a simple substet is enouth.

People will want them for statically handled attributes. You could restrict 
the kind that was passed to the run-time but that inconsistency will 
probably annoy people.

> And restricting
>as much as possible this make the usage far easier: this kind of value
>won't be manipulated by 'experts' writing syntax extensions, but by
>classical users. 

For the kind of information most classical users would want to get from an 
attribute, simple functions like "Ast.getIdent" and "Ast.getIntConst" are 
even easier to use than a reduced AST.

>Moreover, if the ast you are manipulating is the full
>ocaml one, it will be impossible to write exhaustive pattern matching
>without breaking at each new ocaml release.

When fetching data from an attribute you probably don't want exhaustive 
pattern matching. If you expect people to attach a number or a string to a 
type then all you want is to check if the attribute is a number or a 
string, and if it isn't then ignore it or raise an exception. You are 
unlikely to want to perform a different action for each possible kind of 
expression.

The exception to this would be if you wanted to handle general expressions 
within an attribute, but in that case you probably want to handle all 
expressions not a restricted subset.


From xavier.clerc@inria.fr  Wed Feb 13 15:17:46 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 006463CBEC
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Feb 2013 15:17:46 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.0 from SpamAssassin-3.3.2-1445060 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:46285)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U5eAj-00036R-XU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Wed, 13 Feb 2013 15:22:57 +0000
X-IronPort-AV: E=Sophos;i="4.84,657,1355094000"; 
   d="scan'208";a="2095817"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail3-relais-sop.national.inria.fr with ESMTP; 13 Feb 2013 16:11:16 +0100
Date: Wed, 13 Feb 2013 16:22:51 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <321459169.166662.1360768971402.JavaMail.root@inria.fr>
In-Reply-To: <511B9154.3030608@lexifi.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [128.93.134.213]
X-Mailer: Zimbra 7.2.0_GA_2669 (ZimbraWebClient - SAF3 (Mac)/7.2.0_GA_2669)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Feb 2013 15:17:46 -0000

----- Mail original -----
> On 2/12/2013 9:12 PM, Pierre Chambart wrote:
> > I would also prefer to
> > restrict that kind of annotation to a small subset of the
> > expression
> > language avoiding as much as possible duplication.
> 
> Just to be clear, do you propose to restrict attributes in general,
> or
> only those which will be reflected in runtime types?   There are
> several
> cases where one really wants to be able to use general expressions as
> attributes, such as the example given by Yaron:
> 
>           type t =
>             { a : int with default(2), sexp_drop_if(fun x -> x = 2);
>             } with sexp

I am probably missing something here...

Are you discussing the ability to store some attribute
for runtime retrieval? In this case, how do you intent
to store the function? I mean, you cannot marshal it
as a closure, and at the very same time its usefulness
at runtime seems to be based on the ability to actually
execute it?


Regards,

Xavier Clerc

From pierre.chambart@ocamlpro.com  Wed Feb 13 15:58:53 2013
Return-Path: <pierre.chambart@ocamlpro.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 19D3C3CBEC
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Feb 2013 15:58:53 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1445060
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from redisdead.crans.org ([138.231.136.39]:60682)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1U5eoR-00023a-oU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <pierre.chambart@ocamlpro.com>); Wed, 13 Feb 2013 16:04:04 +0000
Received: from localhost (perens.inria.fr [128.93.60.79])
 (using SSLv3 with cipher DHE-RSA-AES128-SHA (128/128 bits))
 (No client certificate requested)
 by redisdead.crans.org (Postfix) with ESMTPSA id 4BF892142;
 Wed, 13 Feb 2013 17:03:59 +0100 (CET)
Date: Wed, 13 Feb 2013 17:03:54 +0100
From: Pierre Chambart <pierre.chambart@ocamlpro.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <20130213170354.00a3622a@ocamlpro.com>
In-Reply-To: <511B9154.3030608@lexifi.com>
References: <51190420.5080305@lexifi.com>
 <20130212211226.31edad00@ocamlpro.com>
 <511B9154.3030608@lexifi.com>
Organization: OCamlPro
X-Mailer: Claws Mail 3.8.1 (GTK+ 2.24.10; x86_64-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=PGP-SHA1;
 boundary="Sig_/MX=+jZHz+chRsSaSSOE_z+T"; protocol="application/pgp-signature"
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Feb 2013 15:58:53 -0000

--Sig_/MX=+jZHz+chRsSaSSOE_z+T
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Le Wed, 13 Feb 2013 14:12:52 +0100,
Alain Frisch <alain.frisch@lexifi.com> a =C3=A9crit :

> On 2/12/2013 9:12 PM, Pierre Chambart wrote:
> > I would also prefer to
> > restrict that kind of annotation to a small subset of the expression
> > language avoiding as much as possible duplication.
>=20
> Just to be clear, do you propose to restrict attributes in general,
> or only those which will be reflected in runtime types?

Only those available at runtime. Other attributes could of course need
to contain classical OCaml, so there is a need for the full syntax.
And when writting syntax extensions, you will already be exposed to the
full OCaml syntax.

What I was thinking of whas that a ppx rewriter could get whatever
expression as attributes, but what remains after applying all rewriters
must be included in a subset that could map to a type like (maybe a bit
too restricitve)

type expr =3D
  | List of expr list
  | Sum of string * expr
  | Cst of string

without a rewriter this could be written as

type t =3D
  { a : int with Min 1, Max 5 }

finishing as List [ Sum ("Min","1"); Sum ("Max","5") ]

If something really generic could be needed a case like this is
possible:

  | Dyn of 'a ty * 'a -> expr

It could be generated by a ppx or taken from a variable like:

let var_name =3D int_of_string (Sys.argv.(1))
type t =3D
  { a : int with Default var_name }

generating Sum ("Default", Dyn (Int,var_name))

--=20
Pierre

--Sig_/MX=+jZHz+chRsSaSSOE_z+T
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iEYEARECAAYFAlEbuWoACgkQQ2gKRvJTD86aDACcCfrU27GDYAtdBmjrcKQ1WWUR
eUMAn1HohswmJzZP0iwgBkgcsbVfaDll
=hTsK
-----END PGP SIGNATURE-----

--Sig_/MX=+jZHz+chRsSaSSOE_z+T--

From lpw25@hermes.cam.ac.uk  Wed Feb 13 17:51:25 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 35C693CBEE
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Feb 2013 17:51:25 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:33635)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1U5gZR-0003ir-pq (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 13 Feb 2013 17:56:37 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1U5gZR-0007Nc-0w (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 13 Feb 2013 17:56:37 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 13 Feb 2013 17:56:36 +0000
Date: 13 Feb 2013 17:56:36 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Pierre Chambart <pierre.chambart@ocamlpro.com>
Message-ID: <Prayer.1.3.5.1302131756360.20604@hermes-1.csi.cam.ac.uk>
In-Reply-To: <20130213170354.00a3622a@ocamlpro.com>
References: <51190420.5080305@lexifi.com>
 <20130212211226.31edad00@ocamlpro.com>
 <511B9154.3030608@lexifi.com>
 <20130213170354.00a3622a@ocamlpro.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Feb 2013 17:51:25 -0000

>What I was thinking of whas that a ppx rewriter could get whatever
>expression as attributes, but what remains after applying all rewriters
>must be included in a subset that could map to a type like (maybe a bit
>too restricitve)
>
>type expr =
>  | List of expr list
>  | Sum of string * expr
>  | Cst of string
>

This interface can be provided by:

------
  (* Ast.mli *)

  type expr

  type simple_expr = 
  | List of expr list
  | Sum of string * simple_expr
  | Cst of string

  val simplify_expr: expr -> simple_expr

------
  (* Ast.ml *)

  type expr = Parsetree.expression

  type simple_expr =
  | List of expr list
  | Sum of string * simple_expr
  | Cst of string

  let simplify_expr expr = ...

------
  (* Parsetree.mli *)

  type expression = ...

  val of_ast_expr: Ast.expr -> expression

------
  (* Parsetree.ml *)

  type expression = ...

  external of_ast_expr: Ast.expr -> expression = "%identity"

------

This would allow users to use the fixed simple interface, or the full 
parsetree interface.


From wojciech.meyer@gmail.com  Thu Feb 14 11:43:15 2013
Return-Path: <wojciech.meyer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id EA19A3C0D9
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Feb 2013 11:43:15 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1445505 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.170 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (wojciech.meyer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ob0-f170.google.com ([209.85.214.170]:33058)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U5xIh-0001e8-Xs (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <wojciech.meyer@gmail.com>); Thu, 14 Feb 2013 11:48:30 +0000
Received: by mail-ob0-f170.google.com with SMTP id wc20so2338551obb.15
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Feb 2013 03:48:26 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=LXxos3E5ZXkqVKFj3O7U8IXlgVCuDhmTUmyLFNvwDyk=;
 b=t0Z3iKS+ut97JkatXwl1QGJqH61JgFpaYGfcfyrpQ8VaaUEmISpYFUns3SE8jtX6Qj
 RoK46UZGbQSc/snY+lQUvgWj6Pig8+cPOZ5eM5OBctVC5so/got1CwqTWfaeco9aSvkm
 7NpbJwExudxc5blACV7Dx5KJLwose6NJ8w0uDjYpAnyV7TFor19rpW0bHwManGnywEXo
 pKjNlQswzkNtVNV0tgZblsPhWv8wwcqzExjscxuFCJ27Q42oY8AIS4D2D8uKKq4iDzVd
 cUIEELe3PPj98fKo+WFn1vivELc88kCT6bCcnRYg3cd0sB1iwqoWkKI2YQoB/aHmFNJR
 hcJA==
MIME-Version: 1.0
X-Received: by 10.182.154.4 with SMTP id vk4mr19032115obb.70.1360842506610;
 Thu, 14 Feb 2013 03:48:26 -0800 (PST)
Received: by 10.182.221.71 with HTTP; Thu, 14 Feb 2013 03:48:26 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1302131756360.20604@hermes-1.csi.cam.ac.uk>
References: <51190420.5080305@lexifi.com>
 <20130212211226.31edad00@ocamlpro.com>
 <511B9154.3030608@lexifi.com>
 <20130213170354.00a3622a@ocamlpro.com>
 <Prayer.1.3.5.1302131756360.20604@hermes-1.csi.cam.ac.uk>
Date: Thu, 14 Feb 2013 11:48:26 +0000
Message-ID: <CAOg1smCbQdEFn9ge=+rOy5niFV_PT-xByGJgDi6qROL8ju4Ptg@mail.gmail.com>
From: Wojciech Meyer <wojciech.meyer@gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 14 Feb 2013 11:43:16 -0000

Another way of providing these simple asts would be to treat any
flavor of variants uniformly and then in the end transform it back to
what was expected (only if it's needed).

(I don't know if that what wasn't originally proposed by Pierre).

So regardless if it's a polymorphic variant, GADT, or plain data type,
we would have one AST - the common denominator and what matters of
these is usually the tag name and general signature. Once we have that
we will match from that simple AST our type driven plugin that will
generate JSON, XML, visitors. etc The idea is to have something that
is good enough and reflects general structure to get rid of
complicated parse tree or/and quotations on the LHS and/or factor out
the common pattern matchers using some meta object.

We could go even further and generate all the bolier plate pattern
matchers via visitor pattern by default, of course it needs to be
thought - but the idea is to not look at types at all - now it turns
to be it's already a meta-meta programming.

On Wed, Feb 13, 2013 at 5:56 PM, Leo White <lpw25@cam.ac.uk> wrote:
>> What I was thinking of whas that a ppx rewriter could get whatever
>> expression as attributes, but what remains after applying all rewriters
>> must be included in a subset that could map to a type like (maybe a bit
>> too restricitve)
>>
>> type expr =
>>  | List of expr list
>>  | Sum of string * expr
>>  | Cst of string
>>
>
> This interface can be provided by:
>
> ------
>  (* Ast.mli *)
>
>  type expr
>
>  type simple_expr =  | List of expr list
>  | Sum of string * simple_expr
>  | Cst of string
>
>  val simplify_expr: expr -> simple_expr
>
> ------
>  (* Ast.ml *)
>
>  type expr = Parsetree.expression
>
>  type simple_expr =
>  | List of expr list
>  | Sum of string * simple_expr
>  | Cst of string
>
>  let simplify_expr expr = ...
>
> ------
>  (* Parsetree.mli *)
>
>  type expression = ...
>
>  val of_ast_expr: Ast.expr -> expression
>
> ------
>  (* Parsetree.ml *)
>
>  type expression = ...
>
>  external of_ast_expr: Ast.expr -> expression = "%identity"
>
> ------
>
> This would allow users to use the fixed simple interface, or the full
> parsetree interface.
>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From bobzhang1988@gmail.com  Thu Feb 14 13:45:16 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 44EAF3C070
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Feb 2013 13:45:16 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1445505 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.177 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f177.google.com ([209.85.128.177]:35038)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U5zCm-0006GS-WV (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 14 Feb 2013 13:50:30 +0000
Received: by mail-ve0-f177.google.com with SMTP id m1so2066642ves.8
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Feb 2013 05:50:27 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=WlvjTaAeE2J2s4u+GQt4sVYtHe1ucwyfYDWg9AEqspY=;
 b=Jva5A3qRv9/2xlhK3l6rLJZRHPyHXFUT0nyEDkcyavicKbyScCBqWD/vqMK4dJZa9l
 ZpChUq/I8mQhYPd8oor8bC2HJCia3gCZrVIrcb03Yofm+7yspg6qhKEjc0DeMJKnI3yX
 fUXPuLiiaCKiymufpk+kEl+DCMHnmIXV7wu3XCKURu6cwWEdrCQSbAeWbOBW4rL0azX7
 nV37ULpf4nltoGxfLREt2obrDL56jn31zOltIDXEqIBPWTW6zbnOdosq7RiGTY2SB0gH
 Ww+zPPhrja/JxYTiSI2ivGepeu9Vu7Nqtv7uKs4/uB+xsVlsx4EZnnu1xNTVWjw7jZeE
 0arg==
MIME-Version: 1.0
X-Received: by 10.220.240.11 with SMTP id ky11mr35155875vcb.11.1360849827203; 
 Thu, 14 Feb 2013 05:50:27 -0800 (PST)
Sender: bobzhang1988@gmail.com
Received: by 10.220.252.133 with HTTP; Thu, 14 Feb 2013 05:50:27 -0800 (PST)
In-Reply-To: <CAOg1smCbQdEFn9ge=+rOy5niFV_PT-xByGJgDi6qROL8ju4Ptg@mail.gmail.com>
References: <51190420.5080305@lexifi.com>
 <20130212211226.31edad00@ocamlpro.com>
 <511B9154.3030608@lexifi.com>
 <20130213170354.00a3622a@ocamlpro.com>
 <Prayer.1.3.5.1302131756360.20604@hermes-1.csi.cam.ac.uk>
 <CAOg1smCbQdEFn9ge=+rOy5niFV_PT-xByGJgDi6qROL8ju4Ptg@mail.gmail.com>
Date: Thu, 14 Feb 2013 08:50:27 -0500
X-Google-Sender-Auth: kZEqWs-FjYtCQHezca9SqEea7fk
Message-ID: <CANcqPu4LeQaebtnm2V4iunGajVSgpigLkUa29cq4bw8UK6DQ6w@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Wojciech Meyer <wojciech.meyer@gmail.com>
Content-Type: multipart/alternative; boundary=14dae9cdcc758b09d504d5af8af9
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Pending issues
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 14 Feb 2013 13:45:16 -0000

--14dae9cdcc758b09d504d5af8af9
Content-Type: text/plain; charset=ISO-8859-1

On Thu, Feb 14, 2013 at 6:48 AM, Wojciech Meyer <wojciech.meyer@gmail.com>wrote:

> Another way of providing these simple asts would be to treat any
> flavor of variants uniformly and then in the end transform it back to
> what was expected (only if it's needed).
>
> (I don't know if that what wasn't originally proposed by Pierre).
>
> So regardless if it's a polymorphic variant, GADT, or plain data type,
> we would have one AST - the common denominator and what matters of
> these is usually the tag name and general signature. Once we have that
> we will match from that simple AST our type driven plugin that will
> generate JSON, XML, visitors. etc The idea is to have something that
> is good enough and reflects general structure to get rid of
> complicated parse tree or/and quotations on the LHS and/or factor out
> the common pattern matchers using some meta object.
>
> We could go even further and generate all the bolier plate pattern
> matchers via visitor pattern by default, of course it needs to be
> thought - but the idea is to not look at types at all - now it turns
> to be it's already a meta-meta programming.
>
> That's how ast works in Fan, constructor names are not associated with
type at
all.
So, suppose you have a function
sem_of_list, it works for all syntax categories, in Camlp4 you need to
write sem_of_list_ctyp, sem_of_list_expr,.....

Second, no dependency, in Fan, you can write tons of libraries for Fan
without depending on Fan, since Fan adopts polymorphic variants, you don't
have to fix its type in the first place. There is a nice application here:
reflection or runtime types generated by Fan. For each compilation unit,
for example, a.ml, Fan can inject a value in the module A, called
repr_of_a, which stores the ast as a runtime value(there is a subtle
difference here, it's a runtime value), which means you can program it in
vanilla ocaml without marshalling or demarshalling

Third, subtyping, you can pick a subset of the ast you want to process,
while reuse most of existing Fan's utilities. The contract is detected at
compile time.




> On Wed, Feb 13, 2013 at 5:56 PM, Leo White <lpw25@cam.ac.uk> wrote:
> >> What I was thinking of whas that a ppx rewriter could get whatever
> >> expression as attributes, but what remains after applying all rewriters
> >> must be included in a subset that could map to a type like (maybe a bit
> >> too restricitve)
> >>
> >> type expr =
> >>  | List of expr list
> >>  | Sum of string * expr
> >>  | Cst of string
> >>
> >
> > This interface can be provided by:
> >
> > ------
> >  (* Ast.mli *)
> >
> >  type expr
> >
> >  type simple_expr =  | List of expr list
> >  | Sum of string * simple_expr
> >  | Cst of string
> >
> >  val simplify_expr: expr -> simple_expr
> >
> > ------
> >  (* Ast.ml *)
> >
> >  type expr = Parsetree.expression
> >
> >  type simple_expr =
> >  | List of expr list
> >  | Sum of string * simple_expr
> >  | Cst of string
> >
> >  let simplify_expr expr = ...
> >
> > ------
> >  (* Parsetree.mli *)
> >
> >  type expression = ...
> >
> >  val of_ast_expr: Ast.expr -> expression
> >
> > ------
> >  (* Parsetree.ml *)
> >
> >  type expression = ...
> >
> >  external of_ast_expr: Ast.expr -> expression = "%identity"
> >
> > ------
> >
> > This would allow users to use the fixed simple interface, or the full
> > parsetree interface.
> >
> >
> > _______________________________________________
> > wg-camlp4 mailing list
> > wg-camlp4@lists.ocaml.org
> > http://lists.ocaml.org/listinfo/wg-camlp4
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>



-- 
-- Regards, Hongbo

--14dae9cdcc758b09d504d5af8af9
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">On Thu, Feb 14, 2013 at 6:48 AM, Wojciec=
h Meyer <span dir=3D"ltr">&lt;<a href=3D"mailto:wojciech.meyer@gmail.com" t=
arget=3D"_blank">wojciech.meyer@gmail.com</a>&gt;</span> wrote:<br><blockqu=
ote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc s=
olid;padding-left:1ex">
Another way of providing these simple asts would be to treat any<br>
flavor of variants uniformly and then in the end transform it back to<br>
what was expected (only if it&#39;s needed).<br>
<br>
(I don&#39;t know if that what wasn&#39;t originally proposed by Pierre).<b=
r>
<br>
So regardless if it&#39;s a polymorphic variant, GADT, or plain data type,<=
br>
we would have one AST - the common denominator and what matters of<br>
these is usually the tag name and general signature. Once we have that<br>
we will match from that simple AST our type driven plugin that will<br>
generate JSON, XML, visitors. etc The idea is to have something that<br>
is good enough and reflects general structure to get rid of<br>
complicated parse tree or/and quotations on the LHS and/or factor out<br>
the common pattern matchers using some meta object.<br>
<br>
We could go even further and generate all the bolier plate pattern<br>
matchers via visitor pattern by default, of course it needs to be<br>
thought - but the idea is to not look at types at all - now it turns<br>
to be it&#39;s already a meta-meta programming.<br>
<div class=3D"HOEnZb"><div class=3D"h5"><br></div></div></blockquote><div>T=
hat&#39;s how ast works in Fan, constructor names are not associated with t=
ype at</div><div>all.</div><div>So, suppose you have a function=A0</div><di=
v>
sem_of_list, it works for all syntax categories, in Camlp4 you need to writ=
e sem_of_list_ctyp, sem_of_list_expr,.....</div><div><br></div><div>Second,=
 no dependency, in Fan, you can write tons of libraries for Fan without dep=
ending on Fan, since Fan adopts polymorphic variants, you don&#39;t have to=
 fix its type in the first place. There is a nice application here: reflect=
ion or runtime types generated by Fan. For each compilation unit, for examp=
le, <a href=3D"http://a.ml">a.ml</a>, Fan can inject a value in the module =
A, called repr_of_a, which stores the ast as a runtime value(there is a sub=
tle difference here, it&#39;s a runtime value), which means you can program=
 it in vanilla ocaml without marshalling or demarshalling</div>
<div><br></div><div>Third, subtyping, you can pick a subset of the ast you =
want to process, while reuse most of existing Fan&#39;s utilities. The cont=
ract is detected at compile time.</div><div><br></div><div><br></div><div>
=A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;borde=
r-left:1px #ccc solid;padding-left:1ex"><div class=3D"HOEnZb"><div class=3D=
"h5">
On Wed, Feb 13, 2013 at 5:56 PM, Leo White &lt;<a href=3D"mailto:lpw25@cam.=
ac.uk">lpw25@cam.ac.uk</a>&gt; wrote:<br>
&gt;&gt; What I was thinking of whas that a ppx rewriter could get whatever=
<br>
&gt;&gt; expression as attributes, but what remains after applying all rewr=
iters<br>
&gt;&gt; must be included in a subset that could map to a type like (maybe =
a bit<br>
&gt;&gt; too restricitve)<br>
&gt;&gt;<br>
&gt;&gt; type expr =3D<br>
&gt;&gt; =A0| List of expr list<br>
&gt;&gt; =A0| Sum of string * expr<br>
&gt;&gt; =A0| Cst of string<br>
&gt;&gt;<br>
&gt;<br>
&gt; This interface can be provided by:<br>
&gt;<br>
&gt; ------<br>
&gt; =A0(* Ast.mli *)<br>
&gt;<br>
&gt; =A0type expr<br>
&gt;<br>
&gt; =A0type simple_expr =3D =A0| List of expr list<br>
&gt; =A0| Sum of string * simple_expr<br>
&gt; =A0| Cst of string<br>
&gt;<br>
&gt; =A0val simplify_expr: expr -&gt; simple_expr<br>
&gt;<br>
&gt; ------<br>
&gt; =A0(* Ast.ml *)<br>
&gt;<br>
&gt; =A0type expr =3D Parsetree.expression<br>
&gt;<br>
&gt; =A0type simple_expr =3D<br>
&gt; =A0| List of expr list<br>
&gt; =A0| Sum of string * simple_expr<br>
&gt; =A0| Cst of string<br>
&gt;<br>
&gt; =A0let simplify_expr expr =3D ...<br>
&gt;<br>
&gt; ------<br>
&gt; =A0(* Parsetree.mli *)<br>
&gt;<br>
&gt; =A0type expression =3D ...<br>
&gt;<br>
&gt; =A0val of_ast_expr: Ast.expr -&gt; expression<br>
&gt;<br>
&gt; ------<br>
&gt; =A0(* Parsetree.ml *)<br>
&gt;<br>
&gt; =A0type expression =3D ...<br>
&gt;<br>
&gt; =A0external of_ast_expr: Ast.expr -&gt; expression =3D &quot;%identity=
&quot;<br>
&gt;<br>
&gt; ------<br>
&gt;<br>
&gt; This would allow users to use the fixed simple interface, or the full<=
br>
&gt; parsetree interface.<br>
&gt;<br>
&gt;<br>
&gt; _______________________________________________<br>
&gt; wg-camlp4 mailing list<br>
&gt; <a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org=
</a><br>
&gt; <a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank=
">http://lists.ocaml.org/listinfo/wg-camlp4</a><br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo

--14dae9cdcc758b09d504d5af8af9--

From tews@os.inf.tu-dresden.de  Fri Feb 22 12:26:31 2013
Return-Path: <tews@os.inf.tu-dresden.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E8AF63C07C
 for <wg-camlp4@lists.ocaml.org>; Fri, 22 Feb 2013 12:26:31 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -3.0 from SpamAssassin-3.3.2-1448547 
 * -2.3 RCVD_IN_DNSWL_MED RBL: Sender listed at http://www.dnswl.org/,
 *      medium trust
 *      [141.76.48.99 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: inria.fr]
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from os.inf.tu-dresden.de ([141.76.48.99]:53358)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1U8rnP-00038P-pr (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <tews@os.inf.tu-dresden.de>); Fri, 22 Feb 2013 12:32:12 +0000
Received: from [2002:8d4c:3001:48:222:68ff:fe19:71d]
 (helo=blau.inf.tu-dresden.de)
 by os.inf.tu-dresden.de with esmtpsa (TLSv1:DHE-RSA-AES128-SHA:128) (Exim
 4.80.1) id 1U8rnO-0001i5-8R
 for wg-camlp4@lists.ocaml.org; Fri, 22 Feb 2013 13:32:10 +0100
Received: from tews by blau.inf.tu-dresden.de with local (Exim 4.80)
 (envelope-from <tews@blau.inf.tu-dresden.de>) id 1U8rnN-0002NA-H4
 for wg-camlp4@lists.ocaml.org; Fri, 22 Feb 2013 13:32:09 +0100
From: Hendrik Tews <tews@os.inf.tu-dresden.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
Date: Fri, 22 Feb 2013 13:32:09 +0100
To: wg-camlp4@lists.ocaml.org
X-Mailer: VM 8.1.0 under 23.4.1 (i486-pc-linux-gnu)
Subject: [wg-camlp4] My no-use of camlp4 syntax extensions for Otags
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 22 Feb 2013 12:26:32 -0000

Hi,

I just noticed the wg-camlp4 initiative, here is my no-use of
camlp4 syntax extensions.

I use camlp4 for otags, the OCaml tag generator for emacs and vi.
I don't use any syntax extensions, I only use the parsing engine
and the ability to access the abstract syntax tree. After
generating the TAGS, the syntax tree is thrown away.

For generating TAGS one needs exact location information on the
identifiers in the abstract syntax tree. This has always been a
problem with camlp4, see the various open bug reports on this
topic. It would be good, if, together with -ppx, suitable
functions would be provided for getting the location info right
for those syntax tree nodes that get added/modified in -ppx
preprocessors. 

Another point that was always problematic with camlp4 was
documentation. I believe that the attitude present in
http://caml.inria.fr/pub/ml-archives/caml-list/2007/04/65b9d8de785307fe310d1179cea0729c.fr.html
and in
http://mirror.ocamlcore.org/caml.inria.fr/pub/ml-archives/caml-list/2007/05/9c2dd8a116e04931c0ba88337c7ced69.en.html
was largely responsible for the failure of the new camlp4. 
I would therefore strongly suggest to provide complete
documentation for the ast that preprocessors must process with
the _beta_ release of the next version.


One could think, that otags could work perfectly as a -ppx
preprocessor. There are, however, some issues:

- The otags ast preprocessor would produce no output, because no
  compilation should be happen when generating TAGS.

- For simplicity I would need to pass some state from one
  preprocessor invocation to the next. 

  For Emacs TAGS this would just be the open file descriptor of
  the TAGS file.

  vi TAGS should be sorted, so for vi I would need to pass the
  set of accumulated TAGS. Only the last preprocessor would
  write them to the file.

- For simplicity otags permits tagging whole projects or
  directory trees at once, where different files need possibly be
  preprocessed with different syntax extensions. Therefore I
  would need a version of the -ppx flag that applies to one file
  or a flag that clears the list of accumulated ppx'es.

For these reasons, it would probably be simpler, if otags has its
own driver that invokes the parser and the preprocessors as
needed. For this it would be nice, if the compilerlibs could
provide a function parse_with_ppx, or everything that is needed
for writing it. parse_with_ppx takes a filename and a list of
preprocessor names, parses the file, runs all preprocessors and
returns the ast.

Bye,

Hendrik

From alain.frisch@lexifi.com  Mon Feb 25 09:24:40 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 841143C170
 for <wg-camlp4@lists.ocaml.org>; Mon, 25 Feb 2013 09:24:40 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1449446 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:56203
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1U9uOD-0002uw-Xv (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 25 Feb 2013 09:30:29 +0000
Received: from [192.168.1.120] ([92.151.93.34]) by mwinf5d07 with ME
 id 4ZWL1l00L0kVFFg03ZWL30; Mon, 25 Feb 2013 10:30:21 +0100
Message-ID: <512B2F2C.9090308@lexifi.com>
Date: Mon, 25 Feb 2013 10:30:20 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130107 Thunderbird/17.0.2
MIME-Version: 1.0
To: Hendrik Tews <tews@os.inf.tu-dresden.de>
References: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
In-Reply-To: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] My no-use of camlp4 syntax extensions for Otags
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 25 Feb 2013 09:24:40 -0000

On 02/22/2013 01:32 PM, Hendrik Tews wrote:
> For generating TAGS one needs exact location information on the
> identifiers in the abstract syntax tree. This has always been a
> problem with camlp4, see the various open bug reports on this
> topic. It would be good, if, together with -ppx, suitable
> functions would be provided for getting the location info right
> for those syntax tree nodes that get added/modified in -ppx
> preprocessors.

Defining the notion of the "right location" for syntax tree nodes which 
are added is not easy.  For instance, which location should we use for 
nodes obtained after macro expansion?  The location of the macro 
definition, or the location of the "call site"?  Similarly, which 
location should we use for code generated from type definitions?  The 
location of the type definition?


> Another point that was always problematic with camlp4 was
> documentation.

Point taken.  The nice thing is that we will mostly have to document the 
parse tree and the calling convention for ppx, which is rather simple. 
The amount of information to be aware of will be much smaller than with 
Camlp4.


> For these reasons, it would probably be simpler, if otags has its
> own driver that invokes the parser and the preprocessors as
> needed. For this it would be nice, if the compilerlibs could
> provide a function parse_with_ppx, or everything that is needed
> for writing it. parse_with_ppx takes a filename and a list of
> preprocessor names, parses the file, runs all preprocessors and
> returns the ast.

This is already the case, you can do something like:

   let inputfile = Pparse.preprocess sourcefile in
   let ast =
    Pparse.file ppf inputfile Parse.implementation ast_impl_magic_number
   in
   ...
   Pparse.remove_preprocessed inputfile


The -pp and -ppx preprocessors are taken from Clflags 
(Clflags.preprocessor, Clflags.ppx).

Maybe we should encapsulate the code above as a single function (with 
proper support for errors, i.e. removing the temporary file produced by 
the -pp preprocessor in case of error).


Alain


From tews@os.inf.tu-dresden.de  Mon Feb 25 10:08:08 2013
Return-Path: <tews@os.inf.tu-dresden.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C2A183C170
 for <wg-camlp4@lists.ocaml.org>; Mon, 25 Feb 2013 10:08:08 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -3.0 from SpamAssassin-3.3.2-1449446 
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -2.3 RCVD_IN_DNSWL_MED RBL: Sender listed at http://www.dnswl.org/,
 *      medium trust
 *      [141.76.48.99 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from os.inf.tu-dresden.de ([141.76.48.99]:59877)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1U9v4G-000640-Si (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <tews@os.inf.tu-dresden.de>); Mon, 25 Feb 2013 10:13:58 +0000
Received: from [2002:8d4c:3001:48:222:68ff:fe19:71d]
 (helo=blau.inf.tu-dresden.de)
 by os.inf.tu-dresden.de with esmtpsa (TLSv1:DHE-RSA-AES128-SHA:128) (Exim
 4.80.1) id 1U9v4G-0006CE-Eo
 for wg-camlp4@lists.ocaml.org; Mon, 25 Feb 2013 11:13:56 +0100
Received: from tews by blau.inf.tu-dresden.de with local (Exim 4.80)
 (envelope-from <tews@blau.inf.tu-dresden.de>) id 1U9v4F-0005qU-Dk
 for wg-camlp4@lists.ocaml.org; Mon, 25 Feb 2013 11:13:55 +0100
From: Hendrik Tews <tews@os.inf.tu-dresden.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <20779.14690.944605.283053@blau.inf.tu-dresden.de>
Date: Mon, 25 Feb 2013 11:13:54 +0100
To: wg-camlp4@lists.ocaml.org
In-Reply-To: <512B2F2C.9090308@lexifi.com>
References: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
 <512B2F2C.9090308@lexifi.com>
X-Mailer: VM 8.1.0 under 23.4.1 (i486-pc-linux-gnu)
Subject: Re: [wg-camlp4] My no-use of camlp4 syntax extensions for Otags
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 25 Feb 2013 10:08:08 -0000

Alain Frisch writes:
   Date: Mon, 25 Feb 2013 10:30:20 +0100
   Subject: Re: [wg-camlp4] My no-use of camlp4 syntax extensions for Otags
   
   On 02/22/2013 01:32 PM, Hendrik Tews wrote:
   > For generating TAGS one needs exact location information on the
   > identifiers in the abstract syntax tree. 
   
   Defining the notion of the "right location" for syntax tree nodes which 
   are added is not easy.  For instance, which location should we use for 
   nodes obtained after macro expansion?  The location of the macro 
   definition, or the location of the "call site"?  Similarly, which 
   location should we use for code generated from type definitions?  The 
   location of the type definition?

It is not only about the synthesized or added ast nodes. Camlp4
suffers from the problem that sometimes location info for ast
nodes that follow a camlp4 macro are wrong (eg. bug #5127). I
hope that with -ppx we get for free, that location info of nodes
that are not touched stays correct.

Regarding synthesized nodes, my suggestion would be to have a
clear definition of an undefined location, which should be the
default for synthesized ast nodes. There should also be a clear
definition of synthesized location info, for the case where the
author of the preprocessor decides to provide some better
location info. 

For instance, from otags point of view, the identifiers for
printers and xml parsers that are generated for a type definition
should have the location of that type definition. But only the
identifiers, the generated function bodies can have the undefined
location. For otags I need to distinguish the locations for these
generated functions from those that really appear in the code.
This is because TAGS files contain small fragments from the
sources to make the TAGS file more robust when line numbers
change. For TAGS entries of synthesized functions and values it
is probably better to not copy any part of the source into the
TAGS file.


   > Another point that was always problematic with camlp4 was
   > documentation.
   
   Point taken.  

Thanks a lot! If you choose a form where user contribution is
easy (eg a wiki) I'll probably contribute, similarly to the
camlp4 wiki.

   > For this it would be nice, if the compilerlibs could
   > provide a function parse_with_ppx
   
   This is already the case, you can do something like:
   
Great!

   Maybe we should encapsulate the code above as a single function (with 
   proper support for errors, i.e. removing the temporary file produced by 
   the -pp preprocessor in case of error).
   
I would prefer something that automatically deals with temporary
files but raises errors as exceptions together with a function
that converts these exceptions into proper error messages. 

There are people who run otags automatically on whole directory
trees to index all files in there. For them, files with parse
errors should be simply skipped without even producing an error
message.


Bye,

Hendrik

From alain.frisch@lexifi.com  Thu Feb 28 20:58:18 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AF0F53CA21
 for <wg-camlp4@lists.ocaml.org>; Thu, 28 Feb 2013 20:58:18 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1450680 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: inria.fr]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:55095)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UBAeJ-00015h-QV (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 28 Feb 2013 21:04:20 +0000
Received: from [192.168.0.10] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 7F433A627F
 for <wg-camlp4@lists.ocaml.org>; Thu, 28 Feb 2013 22:04:15 +0100 (CET)
Message-ID: <512FC647.6050900@lexifi.com>
Date: Thu, 28 Feb 2013 22:04:07 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 28 Feb 2013 20:58:18 -0000

Dear all,

Since there seemed to be a consensus about extending the OCaml grammar 
with attributes and extension nodes in various syntactic categories, 
I've started an experimental branch on the OCaml SVN to try some syntax.
The branch is called extension_points ( 
http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/ ).

Currently, the following are supported:

  - Extension node as a structure item:

       &(foo expr)

  - Extension node as an expression:

       (&foo expr)

  - Extension node as a type expression:

       (&foo expr)

  - Attribute on a structure item, postfix notation:

       .... :: foo expr

  - Attribute on a type expression, postfix notation:

       .... (/foo expr)

In all cases, foo denotes a lowercase unprefixed identifier (LIDENT) and 
expr is an optional expression (it can be omitted).

(The parser has more commented-out syntax for attributes on expressions 
with prefix and postfix notation, and attributes on type expression with 
prefix notation.)


Alain

From yminsky@janestreet.com  Fri Mar  1 04:48:44 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 324843CA21
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 04:48:44 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1451140 
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: inria.fr]
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:51037
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UBHzV-0006Z9-pl (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Fri, 01 Mar 2013 04:54:46 +0000
Received: from [172.27.22.15] (helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1UBHzC-0005V0-6w
 for wg-camlp4@lists.ocaml.org; Thu, 28 Feb 2013 23:54:22 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1UBHzA-0008C8-Lp
 for wg-camlp4@lists.ocaml.org; Thu, 28 Feb 2013 23:54:20 -0500
Received: from mail-lb0-f200.google.com ([209.85.217.200])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1UBHzA-0005KL-Gl
 for wg-camlp4@lists.ocaml.org; Thu, 28 Feb 2013 23:54:20 -0500
Received: by mail-lb0-f200.google.com with SMTP id k6so3036378lbo.7
 for <wg-camlp4@lists.ocaml.org>; Thu, 28 Feb 2013 20:54:19 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type;
 bh=iQ9wOKZctHs8pIsfuDIBmBnySPuBzXdhdcoocUTAApI=;
 b=jh6snYqGRRUfdUOIgQyPmIiKE9kyed44J2bOZEIqex3PArSQ8uBzciOgHMyNkTwbvb
 y30QV6bZf9G2v/Zt8Wzan8alXKxOQkY/6CqPDd7c1uZLHwrqI5GqYEDFEiJ5CNi9E70Y
 P1aZf54pQTMXzHiwUmeoHMstiyHShKCOEm8YM=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type:x-gm-message-state;
 bh=iQ9wOKZctHs8pIsfuDIBmBnySPuBzXdhdcoocUTAApI=;
 b=H5lQl6ZFnap7zr1sM28AIYukeJRXDUr0GzSYjOi7NI8OZApSkFig4ogsSyt4k4vLDn
 asW67D8hmj7GkE62pj/Fn63KmSM03gfvNijaCM1sj19k9zWju5PGmBMVOD/mpdOyrDAS
 YTKo/qiRwGXb084uAyvzjbvoa2Nca6DUOYVKxgTNOJU9DQljbk8YQSVVWPQYQ9OCnPbp
 0nb/S48NL9Gjp+1P8o1O3RAdYMRGbmpFwy30qAQRSl9ByP8iGZv2omdRb1cSr3Vckxs7
 vnf6yDzfV7VKpeKzIWm1Rsy6tQ9hVal7g+ZVrpOutC4RRg+MiX+dCIKrdJCsMWHKUCB4
 zmJw==
X-Received: by 10.15.45.201 with SMTP id b49mr24130713eew.9.1362113659655;
 Thu, 28 Feb 2013 20:54:19 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.15.45.201 with SMTP id b49mr24130694eew.9.1362113659553;
 Thu, 28 Feb 2013 20:54:19 -0800 (PST)
Received: by 10.223.76.202 with HTTP; Thu, 28 Feb 2013 20:54:19 -0800 (PST)
In-Reply-To: <512FC647.6050900@lexifi.com>
References: <512FC647.6050900@lexifi.com>
Date: Thu, 28 Feb 2013 23:54:19 -0500
Message-ID: <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQmOheUG4u2jPijS4uQiovTeCOrY9YGUdHo+vAgv7+vFuLSdVB+H2t85wn7XTK5ljbk/yfmt/ks3JdWFFUt1vvnPMScQZ0q53BvTjclGBozJKvbOdlxuU5OYyALgXxvrJrs3vJ5yt/huIMXEFdO3tmMItc0T9g==
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 04:48:44 -0000

Is there any hope of keeping the "with" syntax for type definitions
that type-conv uses?  There's quite a bit of code that depends on it,
and there seems at least some utility in keeping it.

On Thu, Feb 28, 2013 at 4:04 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> Dear all,
>
> Since there seemed to be a consensus about extending the OCaml grammar with
> attributes and extension nodes in various syntactic categories, I've started
> an experimental branch on the OCaml SVN to try some syntax.
> The branch is called extension_points (
> http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/ ).
>
> Currently, the following are supported:
>
>  - Extension node as a structure item:
>
>       &(foo expr)
>
>  - Extension node as an expression:
>
>       (&foo expr)
>
>  - Extension node as a type expression:
>
>       (&foo expr)
>
>  - Attribute on a structure item, postfix notation:
>
>       .... :: foo expr
>
>  - Attribute on a type expression, postfix notation:
>
>       .... (/foo expr)
>
> In all cases, foo denotes a lowercase unprefixed identifier (LIDENT) and
> expr is an optional expression (it can be omitted).
>
> (The parser has more commented-out syntax for attributes on expressions with
> prefix and postfix notation, and attributes on type expression with prefix
> notation.)
>
>
> Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From daniel.buenzli@erratique.ch  Fri Mar  1 07:55:44 2013
Return-Path: <daniel.buenzli@erratique.ch>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D052F3C548
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 07:55:44 +0000 (GMT)
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.9 from SpamAssassin-3.3.2-1451140 
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [178.197.232.123 listed in rbl-plus.mail-abuse.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail6.webfaction.com ([74.55.86.74]:34366
 helo=smtp.webfaction.com)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UBKuZ-0003Uy-7m (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <daniel.buenzli@erratique.ch>); Fri, 01 Mar 2013 08:01:47 +0000
Received: from [172.20.10.2] (123-232.197-178.cust.bluewin.ch
 [178.197.232.123])
 by smtp.webfaction.com (Postfix) with ESMTP id 05DD12083138;
 Fri,  1 Mar 2013 08:01:44 +0000 (UTC)
Date: Fri, 1 Mar 2013 09:01:41 +0100
From: =?utf-8?Q?Daniel_B=C3=BCnzli?= <daniel.buenzli@erratique.ch>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <7D4C7AF5FE954F738A1DA04E86E45C68@erratique.ch>
In-Reply-To: <512FC647.6050900@lexifi.com>
References: <512FC647.6050900@lexifi.com>
X-Mailer: sparrow 1.6.4 (build 1178)
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 7bit
Content-Disposition: inline
Cc: "=?utf-8?Q?wg-camlp4=40lists.ocaml.org?=" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 07:55:44 -0000

Is there example good somewhere so that we can look how it looks like ?  

Daniel



From daniel.buenzli@erratique.ch  Fri Mar  1 08:01:27 2013
Return-Path: <daniel.buenzli@erratique.ch>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B8E8F3C548
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 08:01:27 +0000 (GMT)
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.9 from SpamAssassin-3.3.2-1451140 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [178.197.232.123 listed in rbl-plus.mail-abuse.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail6.webfaction.com ([74.55.86.74]:36323
 helo=smtp.webfaction.com)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UBL05-0004wd-7M (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <daniel.buenzli@erratique.ch>); Fri, 01 Mar 2013 08:07:30 +0000
Received: from [172.20.10.2] (123-232.197-178.cust.bluewin.ch
 [178.197.232.123])
 by smtp.webfaction.com (Postfix) with ESMTP id EDF512083284;
 Fri,  1 Mar 2013 08:07:27 +0000 (UTC)
Date: Fri, 1 Mar 2013 09:07:25 +0100
From: =?utf-8?Q?Daniel_B=C3=BCnzli?= <daniel.buenzli@erratique.ch>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <19B456B8AFB04ACCA6E399FE19367A24@erratique.ch>
In-Reply-To: <7D4C7AF5FE954F738A1DA04E86E45C68@erratique.ch>
References: <512FC647.6050900@lexifi.com>
 <7D4C7AF5FE954F738A1DA04E86E45C68@erratique.ch>
X-Mailer: sparrow 1.6.4 (build 1178)
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
Cc: "=?utf-8?Q?wg-camlp4=40lists.ocaml.org?=" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 08:01:27 -0000

Le vendredi, 1 mars 2013 =C3=A0 09:01, Daniel B=C3=BCnzli a =C3=A9crit :
> Is there example good somewhere so that we can look how it looks like =3F=


Oula, =22example code=22 =21

Daniel



From mshinwell@janestreet.com  Fri Mar  1 08:02:52 2013
Return-Path: <mshinwell@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 207703C548
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 08:02:52 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1451140 
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: janestreet.com]
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:40950
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UBL1N-00062B-RR (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <mshinwell@janestreet.com>); Fri, 01 Mar 2013 08:08:55 +0000
Received: from [172.27.22.15] (helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <mshinwell@janestreet.com>) id 1UBL13-0004Ck-Gh
 for wg-camlp4@lists.ocaml.org; Fri, 01 Mar 2013 03:08:29 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <mshinwell@janestreet.com>) id 1UBL11-0003hT-VC
 for wg-camlp4@lists.ocaml.org; Fri, 01 Mar 2013 03:08:27 -0500
Received: from mail-qa0-f72.google.com ([209.85.216.72])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <mshinwell@janestreet.com>) id 1UBL11-0000vG-TK
 for wg-camlp4@lists.ocaml.org; Fri, 01 Mar 2013 03:08:27 -0500
Received: by mail-qa0-f72.google.com with SMTP id dx4so4696594qab.3
 for <wg-camlp4@lists.ocaml.org>; Fri, 01 Mar 2013 00:08:27 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type;
 bh=oIwEzT4A+a1CND0XxzES6gAqQu2fOIwMikW1qd590K4=;
 b=smEwjcSzLCM8x8B2V+5KVw/QAcJnwfP/AEkqSo9FQnFGbqYxsYGEZUd1alZNE18eKw
 INnns3PUqWES7VH/DBF2RgRi4GreiwijkBa7PufujuZFjOZwesw5rrcM6/jU0N6EqNNR
 Mfa3ptlSKYBn4LryW1mMKH5tf4AKG+yYShv3k=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type:x-gm-message-state;
 bh=oIwEzT4A+a1CND0XxzES6gAqQu2fOIwMikW1qd590K4=;
 b=Uz88Ph0aZQu5a3Bkj0HttqhBRQLzcAaoCeejyxtU7omHknEW/rC9ZWzaCQfmbvp0wN
 o5C7M15Srm9SPtgMgzs7oSoJNKU15CPfdoev2zU8hBVCKwjpaYnFQ0km1/m/07AN+m0f
 bqRA2FSOdo+SHrGHLQfEM0hm4WH5L7DjruOXq6g8TftbEwcPDSpRcRiQRWc33ZPCtvFT
 wfHRHGaKEELwCiSYRsDj/noOCKQY98UsTmJlHfR2F+RkZ8O80PDXC4Rv4gy6R1WKLU8R
 dRP/Knp8oH5gy2UBWkZ9r3qAmx9oV/EpVgLs9ufmN5BIorV34LvLuPAG+LdwCQL9GlLV
 KYCg==
X-Received: by 10.52.38.234 with SMTP id j10mr3266508vdk.0.1362125307637;
 Fri, 01 Mar 2013 00:08:27 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.52.38.234 with SMTP id j10mr3266506vdk.0.1362125307530; Fri,
 01 Mar 2013 00:08:27 -0800 (PST)
Received: by 10.58.244.164 with HTTP; Fri, 1 Mar 2013 00:08:27 -0800 (PST)
In-Reply-To: <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
Date: Fri, 1 Mar 2013 08:08:27 +0000
Message-ID: <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
From: Mark Shinwell <mshinwell@janestreet.com>
To: Yaron Minsky <yminsky@janestreet.com>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQnzv1lNsqofEAaJrQQtNzfayZYeYICNh0I78w5ysypmaZEfVCtoz6zwsbL6vEuuruZn1BzTWgIg+cblO8G/+J8xM5joxnpjySmJKqEMJAT+ZP6fqjl/vgQBEOInE7GAHCZDWJgSZFeTkqJEvaaEq4q6aNuubA==
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 08:02:52 -0000

On 1 March 2013 04:54, Yaron Minsky <yminsky@janestreet.com> wrote:
> Is there any hope of keeping the "with" syntax for type definitions
> that type-conv uses?  There's quite a bit of code that depends on it,
> and there seems at least some utility in keeping it.

+1.

Two comments on the suggestions from Alain's mail:

1. If possible, I'd rather see one new syntactic form, rather than
three.

2. The syntax seems kind of cryptic to me.  I wonder if we could find
something more accessible without being overly verbose.

Mark

From alain.frisch@lexifi.com  Fri Mar  1 08:23:15 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id ABECD3C548
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 08:23:15 +0000 (GMT)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1451140 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:49186
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UBLLC-000286-7X (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 01 Mar 2013 08:29:18 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d65 with ME
 id 68VH1l00H2Tqu6L038VHqS; Fri, 01 Mar 2013 09:29:18 +0100
Message-ID: <513066DD.5010104@lexifi.com>
Date: Fri, 01 Mar 2013 09:29:17 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: =?UTF-8?B?RGFuaWVsIELDvG56bGk=?= <daniel.buenzli@erratique.ch>
References: <512FC647.6050900@lexifi.com>
 <7D4C7AF5FE954F738A1DA04E86E45C68@erratique.ch>
In-Reply-To: <7D4C7AF5FE954F738A1DA04E86E45C68@erratique.ch>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 08:23:15 -0000

On 03/01/2013 09:01 AM, Daniel Bnzli wrote:
> Is there example good somewhere so that we can look how it looks like ?

Not yet.  The syntax is not even fixed yet.  But since the branch exists 
and is intended to experiment with syntax, it is a good time to start 
expressing individual syntactic preferences (like Yaron did).


Alain


From alain.frisch@lexifi.com  Fri Mar  1 08:28:36 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6C2323C548
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 08:28:36 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1451140 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:48268
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UBLQM-0004Fw-ZI (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 01 Mar 2013 08:34:39 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d65 with ME
 id 68ae1l00G2Tqu6L038aetz; Fri, 01 Mar 2013 09:34:38 +0100
Message-ID: <5130681E.2080500@lexifi.com>
Date: Fri, 01 Mar 2013 09:34:38 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Yaron Minsky <yminsky@janestreet.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
In-Reply-To: <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 08:28:36 -0000

On 03/01/2013 05:54 AM, Yaron Minsky wrote:
> Is there any hope of keeping the "with" syntax for type definitions
> that type-conv uses?  There's quite a bit of code that depends on it,
> and there seems at least some utility in keeping it.

There will be a need for attributes on individual type declarations (not 
only structure items, since a set of mutually recursive declarations in 
a single structure item), and "with" seems quite good.   However, I 
don't believe that it will be possible to find a syntax which will allow 
reusing existing code based on type-conv without any change.  Leo 
suggested that existing Camlp4 extensions could be turned into mapper 
from "old syntax" (the one they used to interpret) to the new one (based 
on attributes/extension nodes, to be interpreted by a -ppx mapper). 
This could help in the migration (at least as a way to document what's 
to be done).

-- Alain

From alain.frisch@lexifi.com  Fri Mar  1 08:46:02 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4595C3C548
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 08:46:02 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1451140 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:44338
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UBLhE-0004cl-sd (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 01 Mar 2013 08:52:05 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d65 with ME
 id 68s41l00C2Tqu6L038s40X; Fri, 01 Mar 2013 09:52:04 +0100
Message-ID: <51306C34.7090403@lexifi.com>
Date: Fri, 01 Mar 2013 09:52:04 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Mark Shinwell <mshinwell@janestreet.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
In-Reply-To: <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 08:46:02 -0000

On 03/01/2013 09:08 AM, Mark Shinwell wrote:
> 1. If possible, I'd rather see one new syntactic form, rather than
> three.

Can you elaborate?

The need for various syntaxes arise from:

  - A distinction between attributes (meta-data which can be ignored by 
the type-checker if they remain after -ppx rewriting) and extension 
nodes (on which the type-checker must fail).  Do you claim they should 
be merged, or that we should somehow find a way to use a similar syntax 
for both?

  - The need for attributes/extension nodes on various syntactic 
categories.  For instance, one wants both attributes on type expressions 
and on type declarations, which easily create conflicts in the grammar. 
  Do you think we should restrict where attributes/extension nodes are 
allowed, or that we should find a uniform syntax for 
attributes/extension nodes on all syntactic categories (with priority 
rules)?

  - The desire to have both prefix and postfix syntaxes for attributes. 
This might be overkill, and if I had to choose, I'd pick a postfix 
syntax (but there are probably use cases where prefix attributes would 
look nicer).



Alain

From alain.frisch@lexifi.com  Fri Mar  1 12:59:29 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id DA4C83CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 12:59:29 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1451140 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:24840
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UBPeV-000343-se (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 01 Mar 2013 13:05:33 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d04 with ME
 id 6D5W1l00J2Tqu6L03D5Wb5; Fri, 01 Mar 2013 14:05:31 +0100
Message-ID: <5130A79A.2080505@lexifi.com>
Date: Fri, 01 Mar 2013 14:05:30 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Mark Shinwell <mshinwell@janestreet.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
In-Reply-To: <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 12:59:29 -0000

On 03/01/2013 09:08 AM, Mark Shinwell wrote:
> 1. If possible, I'd rather see one new syntactic form, rather than
> three.

I've made the syntax more uniform, dropped prefix attributes, and added 
attributes on type declarations.

The current syntax is:

Attributes:

   On expressions:         expr (:foo expr)
   On type expressions:    type (:foo expr)
   On structure items:     str_item ..(:foo expr)
   On type declarations:   type t = ... with (:foo1 expr1) (:foo2 expr2)

Extension nodes:

   On expressions:         (&foo expr)
   On type expressions:    (&foo expr)
   On structure items:     ..(&foo expr)


A type-conv like example (attributes on type expressions and type 
declarations):


=================================================
  type t = {
     x : int (:default 42);
     y : int (:default 3) (:sexp_drop_default);
     z : int (:default 3) (:sexp_drop_if z_test);
  } with (:sexp)
=================================================


A Bisect-like example (attributes on expressions and structure items):

=================================================
let f x =
   match List.map foo [x; a x; b x] with
   | [y1; y2; y3] -> tata
   | _ -> (assert false) (:bisect visit)


let unused = ()
..(:bisect ignore)
=================================================


A Bolt-like example (extension nodes on expressions):

=================================================
let funct n =
   (&log) "funct(%d)" n LEVEL DEBUG;
   for i = 1 to n do
     print_endline "..."
   done
=================================================

or:

=================================================
let funct n =
   (&log "funct(%d)" n LEVEL DEBUG);
   for i = 1 to n do
     print_endline "..."
   done
=================================================


A map/fold generator (extension nodes on structure item):

=================================================
type variable = string
  and term =
   | Var of variable
   | Lam of variable * term
   | App of term * term


..(&generate_map map term)
=================================================

or, if we also add extension nodes on class expressions:

=================================================
type variable = string
  and term =
   | Var of variable
   | Lam of variable * term
   | App of term * term


class map = (&generate_map term)
=================================================



-- Alain

From gabriel.scherer@gmail.com  Fri Mar  1 13:34:59 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6DECB3CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 13:34:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1451140 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.50 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: lexifi.com]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f50.google.com ([209.85.214.50]:39170)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UBQCs-0005ux-Xy (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 01 Mar 2013 13:41:03 +0000
Received: by mail-bk0-f50.google.com with SMTP id jg9so1335596bkc.23
 for <wg-camlp4@lists.ocaml.org>; Fri, 01 Mar 2013 05:41:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=bSwNTVIAJMHK4TMMwhdGt3/4h9LjRSeb6Oxo+/yQ17E=;
 b=OQVwVwgS9PQclAgtZdhao+JS208ht0lPeyIm/xDMj0jXCKrn3AWuB6sg4JpI5Hy6yh
 Jij5oQPzvo7QEHjXaq4fIgtEEdqP0NpzaR2uAKEhyVMZFbZn+XvnxC+ikxPuUjGg0Ipq
 8mmQkkv1sir9WlJRCKGxlKIidUKylJwH1f+BVeU1o5ZGwtrp8onXrMW+N2KmCgX6G0bS
 Q1KWN1FMiFhyJm7ZDx2p/htNNvO2cZNC5H2/VnjdSbIU7qhU8i9maDOkrvEu++sI/dL/
 lSMO7fBAmKcsCFp+XWYs0bCThtn/au+0oW5vmK8sG48DjcTFyorXuhn5/fCs3sCJdq2X
 0dAQ==
X-Received: by 10.204.8.71 with SMTP id g7mr3927785bkg.118.1362145262177; Fri,
 01 Mar 2013 05:41:02 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Fri, 1 Mar 2013 05:40:22 -0800 (PST)
In-Reply-To: <5130A79A.2080505@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 1 Mar 2013 14:40:22 +0100
Message-ID: <CAPFanBE5MncSgihzf3VevEAPwrGVt=5Mz8ko5kN6_jVVbQi9eQ@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 13:34:59 -0000

I'm not fond of having "with" as a special case. If you don't support
the type-conv or deriving syntax as is, could we take this as an
opportunity to go back to an uniform syntax? Type declaration could be
handled like any structure item.

Don't we want to have attributes on signature items as well?

Finally, I bet the non-terminal ".." will get little love, but I'm
sure you considered other option (for example just ;;(:foo), but that
doesn't work in the toplevel and we really want ";;" to help *avoid*
precedence issues) and trust that this is one of the less ugly ones.

Is that proposal sufficient to do ocamldoc with structured attributes
rather than comments? It looks like it is. Can an annotation node, by
itself, stand as a structure item (I'm thinking section comments)?

On Fri, Mar 1, 2013 at 2:05 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 03/01/2013 09:08 AM, Mark Shinwell wrote:
>>
>> 1. If possible, I'd rather see one new syntactic form, rather than
>> three.
>
>
> I've made the syntax more uniform, dropped prefix attributes, and added
> attributes on type declarations.
>
> The current syntax is:
>
> Attributes:
>
>   On expressions:         expr (:foo expr)
>   On type expressions:    type (:foo expr)
>   On structure items:     str_item ..(:foo expr)
>   On type declarations:   type t = ... with (:foo1 expr1) (:foo2 expr2)
>
> Extension nodes:
>
>   On expressions:         (&foo expr)
>   On type expressions:    (&foo expr)
>   On structure items:     ..(&foo expr)
>
>
> A type-conv like example (attributes on type expressions and type
> declarations):
>
>
> =================================================
>  type t = {
>     x : int (:default 42);
>     y : int (:default 3) (:sexp_drop_default);
>     z : int (:default 3) (:sexp_drop_if z_test);
>  } with (:sexp)
> =================================================
>
>
> A Bisect-like example (attributes on expressions and structure items):
>
> =================================================
> let f x =
>   match List.map foo [x; a x; b x] with
>   | [y1; y2; y3] -> tata
>   | _ -> (assert false) (:bisect visit)
>
>
> let unused = ()
> ..(:bisect ignore)
> =================================================
>
>
> A Bolt-like example (extension nodes on expressions):
>
> =================================================
> let funct n =
>   (&log) "funct(%d)" n LEVEL DEBUG;
>   for i = 1 to n do
>     print_endline "..."
>   done
> =================================================
>
> or:
>
> =================================================
> let funct n =
>   (&log "funct(%d)" n LEVEL DEBUG);
>   for i = 1 to n do
>     print_endline "..."
>   done
> =================================================
>
>
> A map/fold generator (extension nodes on structure item):
>
> =================================================
> type variable = string
>  and term =
>   | Var of variable
>   | Lam of variable * term
>   | App of term * term
>
>
> ..(&generate_map map term)
> =================================================
>
> or, if we also add extension nodes on class expressions:
>
> =================================================
> type variable = string
>  and term =
>   | Var of variable
>   | Lam of variable * term
>   | App of term * term
>
>
> class map = (&generate_map term)
> =================================================
>
>
>
> -- Alain
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From markus.mottl@gmail.com  Fri Mar  1 13:41:46 2013
Return-Path: <markus.mottl@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 2B49A3CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 13:41:46 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1451140 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.176 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: ocaml.org]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (markus.mottl[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f176.google.com ([209.85.212.176]:53109)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UBQJR-0000YQ-Ww (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <markus.mottl@gmail.com>); Fri, 01 Mar 2013 13:47:49 +0000
Received: by mail-wi0-f176.google.com with SMTP id hm14so9094791wib.9
 for <wg-camlp4@lists.ocaml.org>; Fri, 01 Mar 2013 05:47:49 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=O5xK9cI8/BBkETSzQ6mG0MBqM/DmpT3B9HjQgt9qFtY=;
 b=l5JGubJnX344dalZCMdi9vqsE9PXKWVPcqOydyltIoe498P9mBIEYgMa0tfWFw0que
 VPYIotAfmb9+edg8/QAVmIWq4h86LFHTOo/ZjgvJYC7IBVyPHwefAdX29fN/ZZ3EWm/g
 u3N2jOH4YKpB8lL3pT8MDzYjN25cvqkEhP9zQoD/m+s91Sl6rCOmJVk5pgCq1x2B3ONz
 KsCB7STAoClPcDz6V0mUbdn7DVa0pHcUq840M/YW1NS9GT3egNyaDbCnBxLXuDlWs+Rj
 YsFJL25S8Kvcc5OdljpJZipSCXOMNqrvU05VyNp05gZmnCwTxSFmsH4ik99oXjke2sCy
 B58Q==
MIME-Version: 1.0
X-Received: by 10.180.88.168 with SMTP id bh8mr39850587wib.15.1362145668983;
 Fri, 01 Mar 2013 05:47:48 -0800 (PST)
Received: by 10.194.18.135 with HTTP; Fri, 1 Mar 2013 05:47:48 -0800 (PST)
In-Reply-To: <CAPFanBE5MncSgihzf3VevEAPwrGVt=5Mz8ko5kN6_jVVbQi9eQ@mail.gmail.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <CAPFanBE5MncSgihzf3VevEAPwrGVt=5Mz8ko5kN6_jVVbQi9eQ@mail.gmail.com>
Date: Fri, 1 Mar 2013 08:47:48 -0500
Message-ID: <CAP_800rrrqWffWoi+wN-V4yr_-61nsnAVQWQUOfhMMfwHGmzYw@mail.gmail.com>
From: Markus Mottl <markus.mottl@gmail.com>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 13:41:46 -0000

It would be great to have one uniform syntax for syntax extensions.  I
don't think we absolutely should keep type_conv like extensions if a
new approach can replace them.  I can understand that industrial users
that have thousands of legacy annotations will not be happy having to
change their sources.  But I think updating sources could be safely
automated to a large extent, and any remaining fixes could be applied
with a little elbow grease.

Regards,
Markus

On Fri, Mar 1, 2013 at 8:40 AM, Gabriel Scherer
<gabriel.scherer@gmail.com> wrote:
> I'm not fond of having "with" as a special case. If you don't support
> the type-conv or deriving syntax as is, could we take this as an
> opportunity to go back to an uniform syntax? Type declaration could be
> handled like any structure item.
>
> Don't we want to have attributes on signature items as well?
>
> Finally, I bet the non-terminal ".." will get little love, but I'm
> sure you considered other option (for example just ;;(:foo), but that
> doesn't work in the toplevel and we really want ";;" to help *avoid*
> precedence issues) and trust that this is one of the less ugly ones.
>
> Is that proposal sufficient to do ocamldoc with structured attributes
> rather than comments? It looks like it is. Can an annotation node, by
> itself, stand as a structure item (I'm thinking section comments)?
>
> On Fri, Mar 1, 2013 at 2:05 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
>> On 03/01/2013 09:08 AM, Mark Shinwell wrote:
>>>
>>> 1. If possible, I'd rather see one new syntactic form, rather than
>>> three.
>>
>>
>> I've made the syntax more uniform, dropped prefix attributes, and added
>> attributes on type declarations.
>>
>> The current syntax is:
>>
>> Attributes:
>>
>>   On expressions:         expr (:foo expr)
>>   On type expressions:    type (:foo expr)
>>   On structure items:     str_item ..(:foo expr)
>>   On type declarations:   type t = ... with (:foo1 expr1) (:foo2 expr2)
>>
>> Extension nodes:
>>
>>   On expressions:         (&foo expr)
>>   On type expressions:    (&foo expr)
>>   On structure items:     ..(&foo expr)
>>
>>
>> A type-conv like example (attributes on type expressions and type
>> declarations):
>>
>>
>> =================================================
>>  type t = {
>>     x : int (:default 42);
>>     y : int (:default 3) (:sexp_drop_default);
>>     z : int (:default 3) (:sexp_drop_if z_test);
>>  } with (:sexp)
>> =================================================
>>
>>
>> A Bisect-like example (attributes on expressions and structure items):
>>
>> =================================================
>> let f x =
>>   match List.map foo [x; a x; b x] with
>>   | [y1; y2; y3] -> tata
>>   | _ -> (assert false) (:bisect visit)
>>
>>
>> let unused = ()
>> ..(:bisect ignore)
>> =================================================
>>
>>
>> A Bolt-like example (extension nodes on expressions):
>>
>> =================================================
>> let funct n =
>>   (&log) "funct(%d)" n LEVEL DEBUG;
>>   for i = 1 to n do
>>     print_endline "..."
>>   done
>> =================================================
>>
>> or:
>>
>> =================================================
>> let funct n =
>>   (&log "funct(%d)" n LEVEL DEBUG);
>>   for i = 1 to n do
>>     print_endline "..."
>>   done
>> =================================================
>>
>>
>> A map/fold generator (extension nodes on structure item):
>>
>> =================================================
>> type variable = string
>>  and term =
>>   | Var of variable
>>   | Lam of variable * term
>>   | App of term * term
>>
>>
>> ..(&generate_map map term)
>> =================================================
>>
>> or, if we also add extension nodes on class expressions:
>>
>> =================================================
>> type variable = string
>>  and term =
>>   | Var of variable
>>   | Lam of variable * term
>>   | App of term * term
>>
>>
>> class map = (&generate_map term)
>> =================================================
>>
>>
>>
>> -- Alain
>>
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4



-- 
Markus Mottl        http://www.ocaml.info        markus.mottl@gmail.com

From pierre.chambart@crans.org  Fri Mar  1 15:11:57 2013
Return-Path: <pierre.chambart@crans.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7901A3CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 15:11:57 +0000 (GMT)
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1451140 
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from redisdead.crans.org ([138.231.136.39]:57699)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UBRij-0000ZB-6T (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <pierre.chambart@crans.org>); Fri, 01 Mar 2013 15:18:01 +0000
Received: from localhost (perens.inria.fr [128.93.60.79])
 (using SSLv3 with cipher DHE-RSA-AES128-SHA (128/128 bits))
 (No client certificate requested)
 by redisdead.crans.org (Postfix) with ESMTPSA id 74A5E20DE
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 16:18:00 +0100 (CET)
Date: Fri, 1 Mar 2013 16:17:54 +0100
From: Pierre Chambart <pierre.chambart@crans.org>
To: wg-camlp4@lists.ocaml.org
Message-ID: <20130301161754.766b9e9b@crans.org>
In-Reply-To: <CAPFanBE5MncSgihzf3VevEAPwrGVt=5Mz8ko5kN6_jVVbQi9eQ@mail.gmail.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <CAPFanBE5MncSgihzf3VevEAPwrGVt=5Mz8ko5kN6_jVVbQi9eQ@mail.gmail.com>
X-Mailer: Claws Mail 3.8.1 (GTK+ 2.24.10; x86_64-pc-linux-gnu)
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=PGP-SHA1;
 boundary="Sig_/jA_eeYOyE=gXzzm.WB2=x5J"; protocol="application/pgp-signature"
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 15:11:57 -0000

--Sig_/jA_eeYOyE=gXzzm.WB2=x5J
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Le Fri, 1 Mar 2013 14:40:22 +0100,
Gabriel Scherer <gabriel.scherer@gmail.com> a =C3=A9crit :

> I'm not fond of having "with" as a special case. If you don't support
> the type-conv or deriving syntax as is, could we take this as an
> opportunity to go back to an uniform syntax? Type declaration could be
> handled like any structure item.
>=20
> Don't we want to have attributes on signature items as well?
>=20
> Finally, I bet the non-terminal ".." will get little love, but I'm
> sure you considered other option (for example just ;;(:foo), but that
> doesn't work in the toplevel and we really want ";;" to help *avoid*
> precedence issues) and trust that this is one of the less ugly ones.
>=20
> Is that proposal sufficient to do ocamldoc with structured attributes
> rather than comments? It looks like it is. Can an annotation node, by
> itself, stand as a structure item (I'm thinking section comments)?

I think that ocamldoc like things would need the 'any string' kind of
attribute that was discused in previous threads. I imagine that this
will need some clever lexing tricks to find a start delimiter that is
not currently accepted and seems nice. Since I a very bad at choosing
syntax what I will propose will be ugly:

something like

(:#DELIM#ident the real stringDELIM) and
(&#DELIM#ident the real stringDELIM)

maybe it the string does not contains # and ) we could also allow
(:#ident the real string)
(&#ident the real string)

Feel free to find that awfull and have any proposition that will
necessarily be better...

By the way I like the overall proposition. Go on Alain !
--=20
Pierre

--Sig_/jA_eeYOyE=gXzzm.WB2=x5J
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iEYEARECAAYFAlEwxqIACgkQQ2gKRvJTD845zQCfX4ehzKWx321b5y1nx5wYYiIj
264An1V6jMfdcrr01qd1OC1lRKMLu+D7
=EvRl
-----END PGP SIGNATURE-----

--Sig_/jA_eeYOyE=gXzzm.WB2=x5J--

From yminsky@janestreet.com  Fri Mar  1 15:26:18 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BA8933CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 15:26:18 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1451140 
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: janestreet.com]
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:40891
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UBRwW-0003lZ-qX (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Fri, 01 Mar 2013 15:32:22 +0000
Received: from [172.27.22.15] (helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1UBRwD-000394-Et
 for wg-camlp4@lists.ocaml.org; Fri, 01 Mar 2013 10:31:57 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1UBRwB-0006B2-U4
 for wg-camlp4@lists.ocaml.org; Fri, 01 Mar 2013 10:31:55 -0500
Received: from mail-la0-f70.google.com ([209.85.215.70])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1UBRwB-0003d4-P3
 for wg-camlp4@lists.ocaml.org; Fri, 01 Mar 2013 10:31:55 -0500
Received: by mail-la0-f70.google.com with SMTP id eb20so3879587lab.5
 for <wg-camlp4@lists.ocaml.org>; Fri, 01 Mar 2013 07:31:55 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type;
 bh=rMUxF6FZ0y1fUrM/GONF38KBYRtHd74JMW+UqHWgYyQ=;
 b=dHqTfYMevtMqdiZLuWEYGIwYj59ga5mWLoaau7GSmLFkOoGF4ueEoyPzVXVR3ya0V2
 thzyrsZRJKWzQi3nuH7Vzuz9YfI9JXtL7K9j1bzmBhSorrOrFhdcuaga0h3QNUGSHTHT
 YCkNj8Qn9xMwiYKmgYj6fOIHrqEl9a8fNVK+o=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type:x-gm-message-state;
 bh=rMUxF6FZ0y1fUrM/GONF38KBYRtHd74JMW+UqHWgYyQ=;
 b=Cz1Q1dw9JzYZ008d/jQRaezvPdh1K9N355GtouZfmXE83TvhGEgjjH0SHD1OXMZdnU
 lKuWTT9NkC54FbNZrCSyNbWj3fZewVoTc6w0olgVKZaOrEwSjQCiB/VnGG6kYjUmJPWN
 SRR3c7i7vn0aRiwmNVWkaoFL01avTuSGvHRuQmGyy75S2DD642T7Fi50iUHcW5NoVYE0
 Bzj2Ed20U/9i7dhrrdsNvmL6WTpYQC/B3JmyEap0Y8Ml9eQHORrXu/3iAOCx3xc5CuC+
 eXah0WKSpWAL9oXtiIho2/RUbsUINsZ+RZF3ii6vOY+GZI12yt6WwxxPC9Jzch7BCbKy
 O/fQ==
X-Received: by 10.15.45.201 with SMTP id b49mr29206069eew.9.1362151914938;
 Fri, 01 Mar 2013 07:31:54 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.15.45.201 with SMTP id b49mr29206046eew.9.1362151914793;
 Fri, 01 Mar 2013 07:31:54 -0800 (PST)
Received: by 10.223.76.202 with HTTP; Fri, 1 Mar 2013 07:31:54 -0800 (PST)
In-Reply-To: <CAP_800rrrqWffWoi+wN-V4yr_-61nsnAVQWQUOfhMMfwHGmzYw@mail.gmail.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <CAPFanBE5MncSgihzf3VevEAPwrGVt=5Mz8ko5kN6_jVVbQi9eQ@mail.gmail.com>
 <CAP_800rrrqWffWoi+wN-V4yr_-61nsnAVQWQUOfhMMfwHGmzYw@mail.gmail.com>
Date: Fri, 1 Mar 2013 10:31:54 -0500
Message-ID: <CACLX4jRNv27WgSzqG4j5nxojtt9oS3FOjnfFpsP6M_+i4t=s1Q@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: Markus Mottl <markus.mottl@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQkc/KA5LjUAVzFfkqiwy6oCar5bfHFNMrCThfNXdcJUOeXSkQLKVo9k0viYB85VAA39oX/5XrSBhtHN49NTcw5z5pkkbRxa8GZEbRYGiBAZE138eHlHqsqFmdfvJIGTFOlmOIl3gNhnhp7YQOFETv/A5cVo5A==
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 15:26:18 -0000

On Fri, Mar 1, 2013 at 8:47 AM, Markus Mottl <markus.mottl@gmail.com> wrote:
> It would be great to have one uniform syntax for syntax extensions.  I
> don't think we absolutely should keep type_conv like extensions if a
> new approach can replace them.  I can understand that industrial users
> that have thousands of legacy annotations will not be happy having to
> change their sources.  But I think updating sources could be safely
> automated to a large extent, and any remaining fixes could be applied
> with a little elbow grease.

I do think that "with (:sexp)" is of no real benefit to us.  There's
some value in keeping the syntax largely as it was (i.e., "with sexp,
bin_io"), but if we're going to change the syntax at all, I'd prefer a
clean break.

And we can surely apply some elbow grease to get over the hump.

y

> Regards,
> Markus
>
> On Fri, Mar 1, 2013 at 8:40 AM, Gabriel Scherer
> <gabriel.scherer@gmail.com> wrote:
>> I'm not fond of having "with" as a special case. If you don't support
>> the type-conv or deriving syntax as is, could we take this as an
>> opportunity to go back to an uniform syntax? Type declaration could be
>> handled like any structure item.
>>
>> Don't we want to have attributes on signature items as well?
>>
>> Finally, I bet the non-terminal ".." will get little love, but I'm
>> sure you considered other option (for example just ;;(:foo), but that
>> doesn't work in the toplevel and we really want ";;" to help *avoid*
>> precedence issues) and trust that this is one of the less ugly ones.
>>
>> Is that proposal sufficient to do ocamldoc with structured attributes
>> rather than comments? It looks like it is. Can an annotation node, by
>> itself, stand as a structure item (I'm thinking section comments)?
>>
>> On Fri, Mar 1, 2013 at 2:05 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
>>> On 03/01/2013 09:08 AM, Mark Shinwell wrote:
>>>>
>>>> 1. If possible, I'd rather see one new syntactic form, rather than
>>>> three.
>>>
>>>
>>> I've made the syntax more uniform, dropped prefix attributes, and added
>>> attributes on type declarations.
>>>
>>> The current syntax is:
>>>
>>> Attributes:
>>>
>>>   On expressions:         expr (:foo expr)
>>>   On type expressions:    type (:foo expr)
>>>   On structure items:     str_item ..(:foo expr)
>>>   On type declarations:   type t = ... with (:foo1 expr1) (:foo2 expr2)
>>>
>>> Extension nodes:
>>>
>>>   On expressions:         (&foo expr)
>>>   On type expressions:    (&foo expr)
>>>   On structure items:     ..(&foo expr)
>>>
>>>
>>> A type-conv like example (attributes on type expressions and type
>>> declarations):
>>>
>>>
>>> =================================================
>>>  type t = {
>>>     x : int (:default 42);
>>>     y : int (:default 3) (:sexp_drop_default);
>>>     z : int (:default 3) (:sexp_drop_if z_test);
>>>  } with (:sexp)
>>> =================================================
>>>
>>>
>>> A Bisect-like example (attributes on expressions and structure items):
>>>
>>> =================================================
>>> let f x =
>>>   match List.map foo [x; a x; b x] with
>>>   | [y1; y2; y3] -> tata
>>>   | _ -> (assert false) (:bisect visit)
>>>
>>>
>>> let unused = ()
>>> ..(:bisect ignore)
>>> =================================================
>>>
>>>
>>> A Bolt-like example (extension nodes on expressions):
>>>
>>> =================================================
>>> let funct n =
>>>   (&log) "funct(%d)" n LEVEL DEBUG;
>>>   for i = 1 to n do
>>>     print_endline "..."
>>>   done
>>> =================================================
>>>
>>> or:
>>>
>>> =================================================
>>> let funct n =
>>>   (&log "funct(%d)" n LEVEL DEBUG);
>>>   for i = 1 to n do
>>>     print_endline "..."
>>>   done
>>> =================================================
>>>
>>>
>>> A map/fold generator (extension nodes on structure item):
>>>
>>> =================================================
>>> type variable = string
>>>  and term =
>>>   | Var of variable
>>>   | Lam of variable * term
>>>   | App of term * term
>>>
>>>
>>> ..(&generate_map map term)
>>> =================================================
>>>
>>> or, if we also add extension nodes on class expressions:
>>>
>>> =================================================
>>> type variable = string
>>>  and term =
>>>   | Var of variable
>>>   | Lam of variable * term
>>>   | App of term * term
>>>
>>>
>>> class map = (&generate_map term)
>>> =================================================
>>>
>>>
>>>
>>> -- Alain
>>>
>>> _______________________________________________
>>> wg-camlp4 mailing list
>>> wg-camlp4@lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/wg-camlp4
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>
>
>
> --
> Markus Mottl        http://www.ocaml.info        markus.mottl@gmail.com
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From alain.frisch@lexifi.com  Fri Mar  1 16:22:46 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 990083CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 16:22:46 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1451140 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:45234
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UBSpG-0006Of-qD (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 01 Mar 2013 16:28:50 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d04 with ME
 id 6GUp1l0082Tqu6L03GUpwx; Fri, 01 Mar 2013 17:28:49 +0100
Message-ID: <5130D741.5090704@lexifi.com>
Date: Fri, 01 Mar 2013 17:28:49 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <CAPFanBE5MncSgihzf3VevEAPwrGVt=5Mz8ko5kN6_jVVbQi9eQ@mail.gmail.com>
In-Reply-To: <CAPFanBE5MncSgihzf3VevEAPwrGVt=5Mz8ko5kN6_jVVbQi9eQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 16:22:46 -0000

On 03/01/2013 02:40 PM, Gabriel Scherer wrote:
> I'm not fond of having "with" as a special case. If you don't support
> the type-conv or deriving syntax as is, could we take this as an
> opportunity to go back to an uniform syntax? Type declaration could be
> handled like any structure item.

Cf my previous email:

> There will be a need for attributes on individual type declarations (not only structure items, since a set of mutually recursive declarations in a single structure item), and "with" seems quite good.

An alternative solution would be to consider each declared type as its 
own structure item, so that we wouldn't need an extra notation for 
attributes attached to them.  This changes the current definition of the 
Parsetree.  Do you think it would be a good idea?

> Don't we want to have attributes on signature items as well?

Of course we do.  Also on patterns, class expressions, module 
expressions, module types, etc.

> Finally, I bet the non-terminal ".." will get little love, but I'm
> sure you considered other option (for example just ;;(:foo), but that
> doesn't work in the toplevel and we really want ";;" to help *avoid*
> precedence issues) and trust that this is one of the less ugly ones.

Even without considering technical issues with it, ;;(:foo) does not 
seem so good, because ;; looks like a strong end delimiter for the 
reader and it is weird to have something after it related to what's 
before.  (In the same way that it is weird to have a parenthesized 
sentence after a full dot if if related to the previous sentence :-))

> Is that proposal sufficient to do ocamldoc with structured attributes
> rather than comments? It looks like it is. Can an annotation node, by
> itself, stand as a structure item (I'm thinking section comments)?

An extension nodes stands as a structure item:

..(&foo)

but the type-checker is assumed to fail on them.  Attributes are 
normally attached to something.  Here you mention the need for an 
ignorable extension.  I don't think we want to introduce a third notion. 
  A solution would be to say that contrary to "algebraic structures" 
(expressions, type expressions, patterns), attributes within structures 
are not attached to structured items but are just part of the sequence 
of items of the structure.  So they would be more like extension nodes, 
but silently ignored by the type-checker.  We could then have the 
convention that an attribute placed after a structure item might pertain 
to it.  "ocamldoc" could then use some attributes for section delimiters 
and other attributes to document structure items.  Do you think this is 
an interesting direction?


Alain

From lpw25@hermes.cam.ac.uk  Fri Mar  1 17:46:07 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BCF723CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 17:46:07 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:54748)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1UBU7v-0001zn-Qm (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Fri, 01 Mar 2013 17:52:11 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1UBU7v-00050b-95 (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Fri, 01 Mar 2013 17:52:11 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 01 Mar 2013 17:52:11 +0000
Date: 01 Mar 2013 17:52:11 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5130A79A.2080505@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 17:46:07 -0000

Looking at the code, I don't think that it is taking the correct approach 
to defining the extension syntaxes.

The standard way to define a delimiter like "(:", in keeping with how the 
rest of OCaml is parsed, is to make it a single token from the lexer.

This (dramatically) restricts our choice of delimiters but it also makes it 
much easier to use precedences to parse the extensions in more positions.

After looking through the parser in detail to find safe delimiters, I have 
created a (untested) patch of your implementation that provides the 
following syntaxes:

1. Extensions:

     (: ident expr_opt ) 

   Used as a structure item, signature item, expression or type expression.

2. Attributes:

     [: ident expr_opt ]

   Attached postfix to structure items, signature items, expressions or 
   type expressions.

3. With Attributes

     with ident ( expr), ident, ident (expr) 

   Attached postfix to structure items or signature items.

There are two attribute syntaxes because it is difficult to have a single 
attribute syntax that can be used easily across all these categories. I 
also think that the "with" syntax is particularly nice with types and 
encourages a sensible kind of meta-programming.

The patch is available at:

  http://www.cl.cam.ac.uk/~lpw25/extension_points.diff

Regards,

Leo



From alain.frisch@lexifi.com  Fri Mar  1 18:45:43 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 76CD73CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 18:45:43 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1451140 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: frisch.fr]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:38083
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UBV3b-00064M-QK (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 01 Mar 2013 18:51:47 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d04 with ME
 id 6Jrl1l00k2Tqu6L03JrmqF; Fri, 01 Mar 2013 19:51:46 +0100
Message-ID: <5130F8C1.9020904@lexifi.com>
Date: Fri, 01 Mar 2013 19:51:45 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 18:45:43 -0000

On 03/01/2013 06:52 PM, Leo White wrote:
> The standard way to define a delimiter like "(:", in keeping with how
> the rest of OCaml is parsed, is to make it a single token from the lexer.

Agreed!

>
> 1. Extensions:
>
>      (: ident expr_opt )
>    Used as a structure item, signature item, expression or type expression.
>
> 2. Attributes:
>
>      [: ident expr_opt ]
>
>    Attached postfix to structure items, signature items, expressions or
>    type expressions.
>
> 3. With Attributes
>
>      with ident ( expr), ident, ident (expr)
>    Attached postfix to structure items or signature items.

This looks good to me.

We also need attributes on individual types in a type declaration.

Also, I think it make sense for structure/signature items, to consider 
that attributes are "between" items, to support things like ocamldoc 
section headers.

I've started to work on a change to the Parsetree (unfinished, not 
committed yet):

http://alain.frisch.fr/split_type_decls.txt

where each declared type in a type declaration become a full 
structure/signature item with a marker telling if this is the first type 
in the declaration or not (similar to the representation of signatures 
in the Types module).  This puts some extra invariants in the Parsetree 
(a Pstr_type Prec_nextmust follow another Pstr_type ..., maybe with 
attributes in between), but then we don't need to distinguish 
syntactically attributes on a declared type and attributes on the whole 
declarations, which would be hard to explain to users.

The goal is to be able to write (keeping my original syntax for 
attributes in structure items):

===============================================
..(:doc 2 "My section header")

type t = {...} ..(:id expr) ..(:id expr)
and  s = {...} ..(:id expr)

..(:doc 2 "Another section header")
===============================================

Here we have the following sequence of structure items:

  Pstr_attribute "doc"
  Pstr_type (Prec_first, ...)
  Pstr_attributes "id"
  Pstr_attributes "id"
  Pstr_type (Prec_next, ...)
  Pstr_attributes "id"
  Pstr_attributes "doc"



Independently of the syntax, I'd be interested to get feedback on these 
two proposals:

  -  splitting declarations of mutually recursive types into single 
declarations in the Parsetree, and

  -  having attributes as standalone items within signatures and 
structures (so also between types in a single recursive declaration) 
instead of having them attached to other items.


Alain

From gabriel.scherer@gmail.com  Fri Mar  1 19:55:42 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AB4F73CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 19:55:42 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1451140 
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: inria.fr]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.44 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f44.google.com ([209.85.214.44]:62264)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UBW9K-00030Q-rW (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 01 Mar 2013 20:01:47 +0000
Received: by mail-bk0-f44.google.com with SMTP id j4so1525582bkw.3
 for <wg-camlp4@lists.ocaml.org>; Fri, 01 Mar 2013 12:01:46 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=LUEMdcQIyMwLdwjcLE0o5h/Sxo6voEiWbjmLvQaNqps=;
 b=H+5aseOWGU1F59cwf10NcOQwCsOurFjAtzW/JWs+ldfTAQUp0vplAS/Wyr2WD84tyZ
 8U+Ewh91qBRCaHbSVeF69xKV2Klk8ZxjKIoQYI6uBi6el5YBC6FYHpkF66h50Q82jdJH
 5BQjtOCXaTTqCEsgZuDTtmfucydg9Xv326Vsa5xbxQ/xBK4rPdcOrYLRgoAvMiMmEZWg
 RVn7GjrITn+scUtH+IdfENKtBAtuwnl7cIC+aLaRGPJHXqNq+5s8NwQo9zHwQTQHfKwj
 46CsatBJ2foGb/aZbxAl1mE4K7ha/NNYDiXnq8arbnnQd1haf96stTw7bxP1BDjQi0kH
 QRCw==
X-Received: by 10.204.129.16 with SMTP id m16mr4438703bks.103.1362168106130;
 Fri, 01 Mar 2013 12:01:46 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Fri, 1 Mar 2013 12:01:04 -0800 (PST)
In-Reply-To: <5130F8C1.9020904@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <5130F8C1.9020904@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 1 Mar 2013 21:01:05 +0100
Message-ID: <CAPFanBE-i0KDTmUAsSyD4eUhRYx7bZT6bxoWO5X9FmNzRFCUzA@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 19:55:42 -0000

I'm sorry if my remarks set you in this way, but I'm not sure the
recent changes go in the right direction.

1. I have bad feelings about the idea to split "type foo = bar and baz
= foobar" in two structure items. I'm not sure how that affect the
parsing rules (is "type foo = bar;; and baz = foobar" legal now?), and
more importantly it doesn't fit my mental model of structure items as
being self-contained unit of meaning that can, say, be sent separately
to a toplevel (and this is actually a very important use case). If
"foo" and "baz" are mutually recursive type in my example about, it
makes no sense to consider "type foo = bar" in isolation.

This remark is in direct conflict with my previous remark that "with"
could be replaced by the generic annotation on structure_items. This
previous remark was a mistake, as I had not thought of mutually
recursive definitions, and I now believe that you indeed need to
attach attributes to the grammar element named "typedef" in the manual
grammar description (
http://caml.inria.fr/pub/docs/manual-ocaml/manual016.html ).

(Orthogonal anecdote: Damien Doligez has been looking closely at the
BNF described in the manual recently, and committed some fixes to it.
Contrary to what intuition suggests, it is reasonably safe to assume
that it is correctly describes the grammar of the language as we
understand it.)

2. I have mixed feelings about the idea that detaching struct_item
attributes from the corresponding struct_item is the right way to
handle the OCamldoc setting. I'd rather keep a more semantic model
that makes it explicit what an annotation scopes over, and more
convenient to write consumers/extensions to handle attributes (no need
to peek at the next structure items to collect all annotations for the
current one). Maybe ocamldoc sections could simply be modeled as
annotations on "();;", if we don't discover that we really want
ignored-by-default annotations in the general case (I wouldn't be
surprised).


On Fri, Mar 1, 2013 at 7:51 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 03/01/2013 06:52 PM, Leo White wrote:
>>
>> The standard way to define a delimiter like "(:", in keeping with how
>> the rest of OCaml is parsed, is to make it a single token from the lexer.
>
>
> Agreed!
>
>
>>
>> 1. Extensions:
>>
>>      (: ident expr_opt )
>>    Used as a structure item, signature item, expression or type
>> expression.
>>
>> 2. Attributes:
>>
>>      [: ident expr_opt ]
>>
>>    Attached postfix to structure items, signature items, expressions or
>>    type expressions.
>>
>> 3. With Attributes
>>
>>      with ident ( expr), ident, ident (expr)
>>    Attached postfix to structure items or signature items.
>
>
> This looks good to me.
>
> We also need attributes on individual types in a type declaration.
>
> Also, I think it make sense for structure/signature items, to consider that
> attributes are "between" items, to support things like ocamldoc section
> headers.
>
> I've started to work on a change to the Parsetree (unfinished, not committed
> yet):
>
> http://alain.frisch.fr/split_type_decls.txt
>
> where each declared type in a type declaration become a full
> structure/signature item with a marker telling if this is the first type in
> the declaration or not (similar to the representation of signatures in the
> Types module).  This puts some extra invariants in the Parsetree (a
> Pstr_type Prec_nextmust follow another Pstr_type ..., maybe with attributes
> in between), but then we don't need to distinguish syntactically attributes
> on a declared type and attributes on the whole declarations, which would be
> hard to explain to users.
>
> The goal is to be able to write (keeping my original syntax for attributes
> in structure items):
>
> ===============================================
> ..(:doc 2 "My section header")
>
> type t = {...} ..(:id expr) ..(:id expr)
> and  s = {...} ..(:id expr)
>
> ..(:doc 2 "Another section header")
> ===============================================
>
> Here we have the following sequence of structure items:
>
>  Pstr_attribute "doc"
>  Pstr_type (Prec_first, ...)
>  Pstr_attributes "id"
>  Pstr_attributes "id"
>  Pstr_type (Prec_next, ...)
>  Pstr_attributes "id"
>  Pstr_attributes "doc"
>
>
>
> Independently of the syntax, I'd be interested to get feedback on these two
> proposals:
>
>  -  splitting declarations of mutually recursive types into single
> declarations in the Parsetree, and
>
>  -  having attributes as standalone items within signatures and structures
> (so also between types in a single recursive declaration) instead of having
> them attached to other items.
>
>
> Alain
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From alain.frisch@lexifi.com  Fri Mar  1 22:32:00 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 34CB03CBD2
 for <wg-camlp4@lists.ocaml.org>; Fri,  1 Mar 2013 22:32:00 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1451140 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: inria.fr]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:34555)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UBYaa-0006g2-Wq (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 01 Mar 2013 22:38:05 +0000
Received: from [192.168.0.10] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id A31CEA6217;
 Fri,  1 Mar 2013 23:37:59 +0100 (CET)
Message-ID: <51312DC6.7010106@lexifi.com>
Date: Fri, 01 Mar 2013 23:37:58 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <5130F8C1.9020904@lexifi.com>
 <CAPFanBE-i0KDTmUAsSyD4eUhRYx7bZT6bxoWO5X9FmNzRFCUzA@mail.gmail.com>
In-Reply-To: <CAPFanBE-i0KDTmUAsSyD4eUhRYx7bZT6bxoWO5X9FmNzRFCUzA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 01 Mar 2013 22:32:00 -0000

On 3/1/2013 9:01 PM, Gabriel Scherer wrote:
> I'm sorry if my remarks set you in this way, but I'm not sure the
> recent changes go in the right direction.

No problem, it is just an experiment.

> This remark is in direct conflict with my previous remark that "with"
> could be replaced by the generic annotation on structure_items. This
> previous remark was a mistake, as I had not thought of mutually
> recursive definitions, and I now believe that you indeed need to
> attach attributes to the grammar element named "typedef" in the manual
> grammar description (
> http://caml.inria.fr/pub/docs/manual-ocaml/manual016.html ).

Do you think we still need generic attributes on structure items, or 
would attributes on each declared typed + each declared values + etc... 
be enough?

> 2. I have mixed feelings about the idea that detaching struct_item
> attributes from the corresponding struct_item is the right way to
> handle the OCamldoc setting. I'd rather keep a more semantic model
> that makes it explicit what an annotation scopes over, and more
> convenient to write consumers/extensions to handle attributes (no need
> to peek at the next structure items to collect all annotations for the
> current one). Maybe ocamldoc sections could simply be modeled as
> annotations on "();;", if we don't discover that we really want
> ignored-by-default annotations in the general case (I wouldn't be
> surprised).

To keep things more structured, it could make sense to have the ocamldoc 
section header be an attribute on the section, as in:

include sig
  ...
end ..(:doc "My section header")

In that case, we'd better have a prefix syntax for attributes on this 
"include" signature item:

(@doc "My section header")
include sig
   ...
end

But while this make sense from a structural point of view, this starts 
to look heavy, doesn't it?   (That said, another advantage of this 
structural approach is that you can use your editor to "fold" the 
ocamldoc section...)


Alain

From alain.frisch@lexifi.com  Mon Mar  4 10:41:37 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4919C3C087
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 10:41:37 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452019 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:29420
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UCSvt-0003SR-sg (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Mar 2013 10:47:50 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d21 with ME
 id 7Nno1l00s2Tqu6L03NnoSd; Mon, 04 Mar 2013 11:47:49 +0100
Message-ID: <51347BD4.4060008@lexifi.com>
Date: Mon, 04 Mar 2013 11:47:48 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 10:41:37 -0000

On 03/01/2013 06:52 PM, Leo White wrote:
> Looking at the code, I don't think that it is taking the correct
> approach to defining the extension syntaxes.

I'll backtrack my changes (I agree with Gabriel that it is not a great 
idea to "split" declarations of multiple types into individual 
signature/structure items), and try to incorporate yours.

However:

> 3. With Attributes
>
>      with ident ( expr), ident, ident (expr)
>    Attached postfix to structure items or signature items.

I think those attributes should be attached to declared types, not 
structure/signature items.  It is important to attach different 
attributes to each type in a multi-type declaration.

What I'm less convinced now is that we need attributes on arbitrary 
structure/signature items, rather that on individual components. 
Consider for instance signature items:

and signature_item_desc =
     Psig_value of string loc * value_description
   | Psig_type of (string loc * type_declaration) list
   | Psig_exception of string loc * exception_declaration
   | Psig_module of string loc * module_type
   | Psig_recmodule of (string loc * module_type) list
   | Psig_modtype of string loc * modtype_declaration
   | Psig_open of Longident.t loc
   | Psig_include of module_type
   | Psig_class of class_description list
   | Psig_class_type of class_type_declaration list


I propose to add attributes to value_description, type_declaration, 
exception_declaration, the Psig_module case each item in the 
Psig_recmodule case, the Psig_modtype case, the Psig_open case, the 
Psig_include case, class_description, class_type_declaration.  While we 
are at it, we could introduce a proper record types for 
exception_declaration.  We could also push the names (of declared 
values, names, etc) inside their *_description or *_declaration record.


Opinion on these changes?   I think it's rather important to agree on 
where attributes can be put exactly.



Alain

From lpw25@hermes.cam.ac.uk  Mon Mar  4 10:45:00 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0F9A63C087
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 10:45:00 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:52818)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:25)
 with esmtpa (EXTERNAL:lpw25) id 1UCSzB-0005LJ-pu (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 04 Mar 2013 10:51:13 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1UCSzB-0000JX-2Q (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 04 Mar 2013 10:51:13 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 04 Mar 2013 10:51:12 +0000
Date: 04 Mar 2013 10:51:12 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
In-Reply-To: <51347BD4.4060008@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 10:45:00 -0000

>
>Opinion on these changes?   I think it's rather important to agree on 
>where attributes can be put exactly.
>

That all seems reasonable to me.

Leo

From alain.frisch@lexifi.com  Mon Mar  4 12:54:10 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 328C83C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 12:54:10 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452019 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:22451
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UCV0B-0001f3-XL (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Mar 2013 13:00:23 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d21 with ME
 id 7R0N1l00K2Tqu6L03R0NE4; Mon, 04 Mar 2013 14:00:23 +0100
Message-ID: <51349AE6.2090000@lexifi.com>
Date: Mon, 04 Mar 2013 14:00:22 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 12:54:10 -0000

On 03/04/2013 11:51 AM, Leo White wrote:
>> Opinion on these changes?   I think it's rather important to agree on
>> where attributes can be put exactly.
>>
>
> That all seems reasonable to me.

I've committed a version where attributes are mostly parsed as in your 
patch.

Currently supported:

- Attributes  .... [: lid expr ]
   where .... can be:

     a module expression
     an expression
     a type expression

- Extension (: lid expr )
   in position of a:

    a module expression
    an expression
    a type expression

- Attributes .... with lid1(expr1),..,lidn(exprn)
   where .... can be:

    a single type declaration
    an open or include structure item (more to come)


-- Alain

From lpw25@hermes.cam.ac.uk  Mon Mar  4 13:37:57 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6F04E3C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 13:37:57 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:46763)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1UCVgY-0005Mb-Yz (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 04 Mar 2013 13:44:10 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1UCVgY-0000jg-Qq (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 04 Mar 2013 13:44:10 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 04 Mar 2013 13:44:10 +0000
Date: 04 Mar 2013 13:44:10 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1303041344100.31492@hermes-1.csi.cam.ac.uk>
In-Reply-To: <51349AE6.2090000@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 13:37:57 -0000

>I've committed a version where attributes are mostly parsed as in your 
>patch.
>
> [...]
>
>- Extension (: lid expr )
>   in position of a:
>
>    a module expression
>    an expression
>    a type expression


Is there any particular reason that these are not allowed as structure 
items?


From gabriel.scherer@gmail.com  Mon Mar  4 13:46:54 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3ED4C3C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 13:46:54 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1452019 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.47 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: lexifi.com]
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f47.google.com ([209.85.214.47]:34863)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UCVpD-0003QO-QZ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Mon, 04 Mar 2013 13:53:07 +0000
Received: by mail-bk0-f47.google.com with SMTP id jc3so2350316bkc.6
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Mar 2013 05:53:06 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=cRydJgTDAJViX6s7Uc6rz0nioOVwOHOGZpjDNPFi9pg=;
 b=Nob7fQoevxeLSQLwtRrkqINtMSg4Ra/+TZtULelIzBwAtKernX6pOgSMRB8/6uqCRO
 l+zKzJ5//kvtxuvyi+brT2YaudOzJVk02BPHd/wUrqyf3tU39uFlwKLRsQ7gMNMl4SIl
 BExkx/nEog9b/54egPyOrntw5s4XcbnTuPFtzrdO9GJfQxdqHqqvOq4rjkQzKoP44AXb
 Pb8gt9LB2n9UeczGfdQ4qeV5cFz4kEbJJyK6tgDa6GXeVElyl5qPsSjqVtT8P5v0XsYf
 wSgHXJHcPDyJLvMDN4F6dcicJLoXxxURw0n/xPSvSbUHrtLWje//AibvGX1BtenuiWTW
 MjTA==
X-Received: by 10.204.156.140 with SMTP id x12mr7394448bkw.91.1362405186752;
 Mon, 04 Mar 2013 05:53:06 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Mon, 4 Mar 2013 05:52:26 -0800 (PST)
In-Reply-To: <51349AE6.2090000@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Mon, 4 Mar 2013 14:52:26 +0100
Message-ID: <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 13:46:54 -0000

Could Alain or Leo summarize what is the design space of safe
annotation grammars, lexing/parsing wise?

Some remarks on the current situation:

1. After thinking about it more, I regret the use of the (: foo)
syntax for two different reasons. For once, all delimiters in the
OCaml syntax so far are symmetric ([, {, (, but also [< and {<), and
I'm not sure there is a reason to break this here, so I'd rather have
(: foo :) (I asked the same question for my sequence-comprehension
camlp4 extension that started using [? foo ], then swichted to [? foo
?] -- with a lexer modification to handle those as two-char tokens) .
Another problematic aspect is that we already have ( exp : ty ) in the
OCaml grammar, and I'm not too happy with something that rather
closely looks like (: ty ). Finally, I'm not sure that it's wise to
eat up both (: and [: for related purposes; there are not a lot of
convenient delimiters (pretty much only (, [ and { ) and we will have
people suggesting new syntaxes for a lot of years to come. Could the
two syntaxes share a single delimiter prefix, for example [: and [:: ?

2. I'm unsure about generalization of the "with" syntax to other
syntactic cases. In expression context, "with" is very much associated
to pattern matching, and in particular there is syntactic contention
around a potential "let try ... = ... with ... in" construct. Using
"with" in local module open introduces avenue for confusion. The
with-syntax has the important advantage of internalizing an existing
practice in type-conv, but I'm not sure it scales so well to other
syntactic constructs. What is the current rationale for when to use
with, and when to use with (besides "when the grammar does not
conflict"?).

3. I think we really need a prefix syntax. If we where to use this
annotation syntax for compiler pragmas (locally enabling/disabling
some warning, for example), users would really want to be able to
write, say,

  begin [: pragma(non_exhaustive_match) :]
    ...
  end


On Mon, Mar 4, 2013 at 2:00 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 03/04/2013 11:51 AM, Leo White wrote:
>>>
>>> Opinion on these changes?   I think it's rather important to agree on
>>> where attributes can be put exactly.
>>>
>>
>> That all seems reasonable to me.
>
>
> I've committed a version where attributes are mostly parsed as in your
> patch.
>
> Currently supported:
>
> - Attributes  .... [: lid expr ]
>   where .... can be:
>
>     a module expression
>     an expression
>     a type expression
>
> - Extension (: lid expr )
>   in position of a:
>
>    a module expression
>    an expression
>    a type expression
>
> - Attributes .... with lid1(expr1),..,lidn(exprn)
>   where .... can be:
>
>    a single type declaration
>    an open or include structure item (more to come)
>
>
> -- Alain
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From alain.frisch@lexifi.com  Mon Mar  4 14:01:28 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5768A3C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 14:01:28 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452019 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:40530
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UCW3I-0008C4-pj (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Mar 2013 14:07:41 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d21 with ME
 id 7S7f1l00K2Tqu6L03S7f0N; Mon, 04 Mar 2013 15:07:39 +0100
Message-ID: <5134AAAA.5010501@lexifi.com>
Date: Mon, 04 Mar 2013 15:07:38 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <Prayer.1.3.5.1303041344100.31492@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1303041344100.31492@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 14:01:28 -0000

On 03/04/2013 02:44 PM, Leo White wrote:
>> I've committed a version where attributes are mostly parsed as in your
>> patch.
>>
>> [...]
>>
>> - Extension (: lid expr )
>>   in position of a:
>>
>>    a module expression
>>    an expression
>>    a type expression
>
>
> Is there any particular reason that these are not allowed as structure
> items?

I've removed the notion of extension as structure item at the same time 
I removed the notion of attribute on structure item.  I believe 
extensions as structure items will not be frequently useful, and they 
required a specific syntax (or created opportunities of conflicts with 
other categories).  It is always possible to write, for instance:

   include (:foo bar)

where (:foo bar) is as a (module expression) extension.

-- Alain

From alain.frisch@lexifi.com  Mon Mar  4 14:25:50 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E06B03C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 14:25:50 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452019 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:35173
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UCWQu-00015I-WZ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Mar 2013 14:32:04 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d21 with ME
 id 7SY31l00U2Tqu6L03SY3Dj; Mon, 04 Mar 2013 15:32:03 +0100
Message-ID: <5134B062.6010106@lexifi.com>
Date: Mon, 04 Mar 2013 15:32:02 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
In-Reply-To: <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 14:25:51 -0000

On 03/04/2013 02:52 PM, Gabriel Scherer wrote:
 > For once, all delimiters in the
 > OCaml syntax so far are symmetric ([, {, (, but also [< and {<),

This is not true, for instance, for ocamldoc comments (I know they are 
not part of the OCaml syntax!), and personally I'm not sure to see the 
benefit of making the syntax heavier just to keep symmetry.

> Could the
> two syntaxes share a single delimiter prefix, for example [: and [:: ?
 > ...
 > I think we really need a prefix syntax.

I don't have a strong opinion on syntax, and I agree with the need for a 
prefix syntax (another example:  ocamldoc section header, as a 
prefix-attribute on an "include").

Leo seems to be a lot more comfortable than me with hacking the concrete 
syntax, so I'll let him comment on the possibilities.

> 2. I'm unsure about generalization of the "with" syntax to other
> syntactic cases. In expression context, "with" is very much associated
> to pattern matching, and in particular there is syntactic contention
> around a potential "let try ... = ... with ... in" construct. Using
> "with" in local module open introduces avenue for confusion.

I was thinking about using the "with" syntax only for 
structure/signature item-like components (only that we want to attach 
them to individual component in case of multi-component declarations), 
and probably exclude the expression-as-a-structure-item case.

But it's true that the following:

open M with foo
include S with foo

can be misleading (this is not a with constraint on module type S).

(Before someone question the need for attributes on such items: yes, I 
think it can be useful.  For instance to guide, an attribute on an 
include statement in an interface could instruct ocamldoc whether it 
should inline the corresponding module type or keep it as a reference. 
For open: an attribute could control whether ocamldoc should use the 
opened module to shorten names in the generated doc.)


What about:

  ... [@id expr]    (* attribute on expression, pattern, type, module 
type, module expr *)

  [^id expr] ...    (* same, prefix syntax *)

  ... [@@id expr]   (* attribute on str/sig item-like components *)

  [#id expr]        (* extension as an expression, etc. *)


Alain

From david.waern@gmail.com  Mon Mar  4 14:37:51 2013
Return-Path: <david.waern@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 908F63C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 14:37:51 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1452019 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.181 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (david.waern[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: lexifi.com]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f181.google.com ([209.85.220.181]:45034)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UCWcW-0007if-s0 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <david.waern@gmail.com>); Mon, 04 Mar 2013 14:44:05 +0000
Received: by mail-vc0-f181.google.com with SMTP id f13so3386349vcb.40
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Mar 2013 06:44:04 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=wYrsRjowwM/NReGyfIUWTxwokk+SbJUTj5X2Xqs+3sg=;
 b=nQkeGldHKKO/qI3hWJpfmC6pRDrM76IgbGJMpXy5dNLBbU64MJp3EHKLPdvNiv+rbT
 xNCEJM3Z5+bSA9sr3K9ha+Df84BkIBKJAqqY11fx6VObw3icA5B+64/D1o+NtZ9aZ5Za
 gnHyNVRoX/ioo3jawniawdAs+tpY4qWhWErMiugaGUXROQf6BnnadOIcNZu7wPX+nj1y
 PnSB/sQ9F67+Psi//c/WhKzdZfdIcLjaXg6sYKGmfNtUpJcve10ZJshBaU7pKNuVIucw
 4hjSlbsb0A7KGnzGpMlVaysK6c5uVSAw15hf6n98nxpKsaEWYlNqod8K+s8HnbFWwgxE
 Xjig==
MIME-Version: 1.0
X-Received: by 10.221.1.144 with SMTP id nq16mr4117288vcb.57.1362408244016;
 Mon, 04 Mar 2013 06:44:04 -0800 (PST)
Received: by 10.58.188.110 with HTTP; Mon, 4 Mar 2013 06:44:03 -0800 (PST)
In-Reply-To: <5134B062.6010106@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com>
Date: Mon, 4 Mar 2013 15:44:03 +0100
Message-ID: <CAN8ZjBFXof4LW_tD=4z+kqmhoaLRQtzoRHAJGQHmb2rqi2dNow@mail.gmail.com>
From: David Waern <david.waern@gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=bcaec54eee3c6cd9cc04d71a6307
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 14:37:51 -0000

--bcaec54eee3c6cd9cc04d71a6307
Content-Type: text/plain; charset=ISO-8859-1

2013/3/4 Alain Frisch <alain.frisch@lexifi.com>

>
> What about:
>
>  ... [@id expr]    (* attribute on expression, pattern, type, module type,
> module expr *)
>
>  [^id expr] ...    (* same, prefix syntax *)
>

Could we switch these two so that ^ is used for the postfix version? :-)

David

--bcaec54eee3c6cd9cc04d71a6307
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">2013/3/4 Alain Frisch <span dir=3D"ltr">=
&lt;<a href=3D"mailto:alain.frisch@lexifi.com" target=3D"_blank">alain.fris=
ch@lexifi.com</a>&gt;</span><br><blockquote class=3D"gmail_quote" style=3D"=
margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<br>
What about:<br>
<br>
=A0... [@id expr] =A0 =A0(* attribute on expression, pattern, type, module =
type, module expr *)<br>
<br>
=A0[^id expr] ... =A0 =A0(* same, prefix syntax *)<br></blockquote><div><br=
>Could we switch these two so that ^ is used for the postfix version? :-)<b=
r><br>David<br></div></div>

--bcaec54eee3c6cd9cc04d71a6307--

From lpw25@hermes.cam.ac.uk  Mon Mar  4 15:49:32 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A538A3C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 15:49:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:32986)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1UCXju-0007PH-Wr (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 04 Mar 2013 15:55:46 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1UCXju-0003rA-5K (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 04 Mar 2013 15:55:46 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 04 Mar 2013 15:55:46 +0000
Date: 04 Mar 2013 15:55:46 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1303041555460.4948@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5134AAAA.5010501@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <Prayer.1.3.5.1303041344100.31492@hermes-1.csi.cam.ac.uk>
 <5134AAAA.5010501@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 15:49:32 -0000

>I've removed the notion of extension as structure item at the same time 
>I removed the notion of attribute on structure item.  I believe 
>extensions as structure items will not be frequently useful, and they 
>required a specific syntax (or created opportunities of conflicts with 
>other categories).  It is always possible to write, for instance:
>
>   include (:foo bar)
>
>where (:foo bar) is as a (module expression) extension.

I don't think these are really a problem, since they should simply bind to 
the include statement. For ambiguous cases, inserting a ";;" should be 
sufficient to indicate that a following extension is a structure item.

The more difficult problem is the fact that ordinary expressions are often 
allowed as structure items. I had thought that my previous patch managed to 
sufficiently avoid this problem, but I now think that there will always be 
awkward conflicts between an expression extension and a structure item 
extension (especially in the toplevel).

So, in conclusion, I now agree that we should provide a separate syntax for 
structure item extensions.


From gabriel.scherer@gmail.com  Mon Mar  4 15:57:44 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1214D3C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 15:57:44 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1452019 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.54 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: cam.ac.uk]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f54.google.com ([209.85.214.54]:59329)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UCXrp-00009h-Q8 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Mon, 04 Mar 2013 16:03:57 +0000
Received: by mail-bk0-f54.google.com with SMTP id w5so2465987bku.41
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Mar 2013 08:03:56 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=XuJAZNHchUu7VHyulbvgBauwAMRNdzZx5tzmkSBR0zo=;
 b=peDsS5RjJdbfnp0dgRh5cdY37ePM9ZGqSZbgUdgAiV0tA1GhXmdhMBxCaJ68iH3lp0
 wl62fAhHJxJY7XRVuVRhUw9DmUKYXVFX0JobwIzTHnIzGqr1n1NnSQLk7WSERKoCfGi0
 6MX3LL7L/VY2jZQ6Yfbyvxbfle3I//VhFQmfeEX+yAAWP2cCBysTDrTrweyCkIMhm9tE
 uocqR6KxvNAy8lDtXHymYq/vaWbncEcQdq+RofokR7lwIIRI1PotHosmtCTKY8Xub+bd
 VbLcOIP3zDqvXiTFeqnjK5A1GJMguS0Iufg+p4oLCmnaR5+WZK2s3rs0sK2eFRblxqrV
 UkGA==
X-Received: by 10.204.145.86 with SMTP id c22mr7888592bkv.5.1362413036775;
 Mon, 04 Mar 2013 08:03:56 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Mon, 4 Mar 2013 08:03:15 -0800 (PST)
In-Reply-To: <Prayer.1.3.5.1303041555460.4948@hermes-1.csi.cam.ac.uk>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <Prayer.1.3.5.1303041344100.31492@hermes-1.csi.cam.ac.uk>
 <5134AAAA.5010501@lexifi.com>
 <Prayer.1.3.5.1303041555460.4948@hermes-1.csi.cam.ac.uk>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Mon, 4 Mar 2013 17:03:15 +0100
Message-ID: <CAPFanBGehDbzmWnq6NXrjpRVz7FBwEVhQ6bkny_YS_yt6_6J5A@mail.gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 15:57:44 -0000

> I don't think these are really a problem, since they should simply bind to
> the include statement. For ambiguous cases, inserting a ";;" should be
> sufficient to indicate that a following extension is a structure item.

I think Alain's point is not that "include (: foo bar)" would be
conflicting, but precisely that people could decide by convention that
when they want to write (: foo bar) as a structure item, they tag it
with an "include". I'm not sure whether this is a good idea or not,
and if it is I would rather aim for the more canonical "struct (: foo
bar ) end", but I think tagging with terminals to get more structure
could be an interesting choice in other situations as well, eg. we
could possibly ditch prefix annotations and just use "let (: foo bar )
in ...".

On Mon, Mar 4, 2013 at 4:55 PM, Leo White <lpw25@cam.ac.uk> wrote:
>> I've removed the notion of extension as structure item at the same time I
>> removed the notion of attribute on structure item.  I believe extensions as
>> structure items will not be frequently useful, and they required a specific
>> syntax (or created opportunities of conflicts with other categories).  It is
>> always possible to write, for instance:
>>
>>   include (:foo bar)
>>
>> where (:foo bar) is as a (module expression) extension.
>
>
> I don't think these are really a problem, since they should simply bind to
> the include statement. For ambiguous cases, inserting a ";;" should be
> sufficient to indicate that a following extension is a structure item.
>
> The more difficult problem is the fact that ordinary expressions are often
> allowed as structure items. I had thought that my previous patch managed to
> sufficiently avoid this problem, but I now think that there will always be
> awkward conflicts between an expression extension and a structure item
> extension (especially in the toplevel).
>
> So, in conclusion, I now agree that we should provide a separate syntax for
> structure item extensions.
>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From alain.frisch@lexifi.com  Mon Mar  4 16:08:49 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B5D9A3C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 16:08:49 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452019 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:57978
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UCY2Z-0006Fd-q2 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Mar 2013 16:15:03 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d21 with ME
 id 7UF21l0082Tqu6L03UF2VF; Mon, 04 Mar 2013 17:15:02 +0100
Message-ID: <5134C884.1060701@lexifi.com>
Date: Mon, 04 Mar 2013 17:15:00 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <Prayer.1.3.5.1303041344100.31492@hermes-1.csi.cam.ac.uk>
 <5134AAAA.5010501@lexifi.com>
 <Prayer.1.3.5.1303041555460.4948@hermes-1.csi.cam.ac.uk>
 <CAPFanBGehDbzmWnq6NXrjpRVz7FBwEVhQ6bkny_YS_yt6_6J5A@mail.gmail.com>
In-Reply-To: <CAPFanBGehDbzmWnq6NXrjpRVz7FBwEVhQ6bkny_YS_yt6_6J5A@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 16:08:49 -0000

On 03/04/2013 05:03 PM, Gabriel Scherer wrote:
>> I don't think these are really a problem, since they should simply bind to
>> the include statement. For ambiguous cases, inserting a ";;" should be
>> sufficient to indicate that a following extension is a structure item.
>
> I think Alain's point is not that "include (: foo bar)" would be
> conflicting, but precisely that people could decide by convention that
> when they want to write (: foo bar) as a structure item, they tag it
> with an "include".

I don't know if this is what you mean, but I claim that a general 
extension as a structure item is not needed.

The point is that:

include (:foo bar)

already exists; it is not a special case, just an instance of the 
constructions:

include MODULE_EXPR
or:
include MODULE_TYPE

and since we have extensions at the level of module expressions and 
types, the following is a valid structure/signature item:

include (:foo bar)

Given that, I don't see case where people would like to use extension as 
a signature/structure item but would not be happy with that form.


> I'm not sure whether this is a good idea or not,
> and if it is I would rather aim for the more canonical "struct (: foo
> bar ) end", but I think tagging with terminals to get more structure
> could be an interesting choice in other situations as well, eg. we
> could possibly ditch prefix annotations and just use "let (: foo bar )
> in ...".

The difference is that attributes are ignored by the type-checker while 
extensions are rejected.

-- Alain

From alain.frisch@lexifi.com  Mon Mar  4 17:50:52 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D42843C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 17:50:52 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.2 from SpamAssassin-3.3.2-1452019 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
 *  1.2 MISSING_HEADERS Missing To: header
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:43576
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UCZdK-0000eO-Y2 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Mar 2013 17:57:06 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d21 with ME
 id 7Vx61l0082Tqu6L03Vx6dT; Mon, 04 Mar 2013 18:57:06 +0100
Message-ID: <5134E071.4050408@lexifi.com>
Date: Mon, 04 Mar 2013 18:57:05 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
CC: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com>
In-Reply-To: <5134B062.6010106@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 17:50:52 -0000

Current state of the SVN branch:

Attributes on expressions, module expressions, types, patterns, module 
type expressions:

   postfix syntax: ... [@id expr]
   prefix syntax:  [^id expr] ...

Extensions on the same categories:

   [#lid expr]


Attributes on constructor declarations (needed for constant 
constructors, in particular):

  type t =
    | A [@id expr] [@id expr]
    | B [@id expr] [@id expr] of ...



"Item" attributes:

  postfix syntax:   ... [@@id expr]
  prefix syntax:    [^^id expr] ...

  Currently available on most kind of declarations/statements in 
signatures (except class and class types), and on some kinds of 
declarations in structures (exception declaration, open, include, types)

Example of a signature:

   [^^doc section "My functions"] include sig
      [^^deprecated]
      val foo: int -> int [@@since "3.01"]

      type t = A [@default] | B of (int [@init 10]) * s
	  [@@sexp]
           [@@doc "A type with two constructors"]

      and  [^^deprecated] s = {x : int [@init 1]; y : int [@init 2]}
           [@@doc "A record type"]

      include S
      [@@doc inline]
   end


-- Alain

From alain.frisch@lexifi.com  Mon Mar  4 17:59:28 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1654E3C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 17:59:28 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452019 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: haskell.org]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:28397
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UCZld-0004NZ-YP (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Mar 2013 18:05:42 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d21 with ME
 id 7W5h1l00F2Tqu6L03W5hE4; Mon, 04 Mar 2013 19:05:41 +0100
Message-ID: <5134E274.5070704@lexifi.com>
Date: Mon, 04 Mar 2013 19:05:40 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com>
 <CAN8ZjBFXof4LW_tD=4z+kqmhoaLRQtzoRHAJGQHmb2rqi2dNow@mail.gmail.com>
In-Reply-To: <CAN8ZjBFXof4LW_tD=4z+kqmhoaLRQtzoRHAJGQHmb2rqi2dNow@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 17:59:28 -0000

On 03/04/2013 03:44 PM, David Waern wrote:
> Could we switch these two so that ^ is used for the postfix version? :-)

For the records, after checking with David, this comes from Haddock (= 
ocamldoc for Haskell, also piggy-backing the generic syntax for comments):

http://www.haskell.org/haddock/doc/html/markup.html#id564988


Alain

From lpw25@hermes.cam.ac.uk  Mon Mar  4 19:02:58 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 546313C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 19:02:58 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:47357)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:25)
 with esmtpa (EXTERNAL:lpw25) id 1UCal6-0005Fp-RH (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 04 Mar 2013 19:09:12 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1UCal6-0005CV-Db (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Mon, 04 Mar 2013 19:09:12 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 04 Mar 2013 19:09:12 +0000
Date: 04 Mar 2013 19:09:12 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1303041909120.11091@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5134E071.4050408@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com> <5134E071.4050408@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 19:02:58 -0000

>Extensions on the same categories:
>
>   [#lid expr]
>

This delimiter isn't technically safe (it could be made safe but its 
probably not worth the effort), might I suggest [%lid expr] as an 
alternative.

>"Item" attributes:
>
>  postfix syntax:   ... [@@id expr]
>  prefix syntax:    [^^id expr] ...
>

How about including "Item" extensions "[%%lid expr]"? I would rather not 
force people to use "include [%id expr]". I can imagine syntax extensions 
that might want to be used as both a strucuture item and a module 
expression.

>Attributes on constructor declarations (needed for constant
>constructors, in particular):
>
>  type t =
>    | A [@id expr] [@id expr]
>    | B [@id expr] [@id expr] of ...

I agree that we need a special syntax for variant constructor attributes. 
How about:

type t =
  | A with id, id(expr)
  | B of ... with id(expr), id

We could also allow this for convenient record label attributes. I think 
this syntax is already used in type-conv, it fits in with the "with" 
attributes for type declarations, and is a lighter syntax than the 
alternative.


From alain.frisch@lexifi.com  Mon Mar  4 20:37:00 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4290F3C522
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Mar 2013 20:37:00 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452019 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:56131)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UCcE6-0000Ex-Q4 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Mar 2013 20:43:14 +0000
Received: from [192.168.0.10] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id BD976A625A;
 Mon,  4 Mar 2013 21:43:09 +0100 (CET)
Message-ID: <5135075C.1080302@lexifi.com>
Date: Mon, 04 Mar 2013 21:43:08 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com> <5134E071.4050408@lexifi.com>
 <Prayer.1.3.5.1303041909120.11091@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1303041909120.11091@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Mar 2013 20:37:00 -0000

On 3/4/2013 8:09 PM, Leo White wrote:
>> Extensions on the same categories:
>>
>>   [#lid expr]
>>
>
> This delimiter isn't technically safe (it could be made safe but its
> probably not worth the effort), might I suggest [%lid expr] as an
> alternative.

Ah, I keep forgetting about #type pattern...  I'm fine with [%lid expr].

> How about including "Item" extensions "[%%lid expr]"? I would rather not
> force people to use "include [%id expr]". I can imagine syntax
> extensions that might want to be used as both a strucuture item and a
> module expression.

Well, the extension could always use a different lid to distinguish the 
two cases, but ok, it doesn't add too much complexity to support "item" 
extensions directly.


>>  type t =
>>    | A [@id expr] [@id expr]
>>    | B [@id expr] [@id expr] of ...
>
> I agree that we need a special syntax for variant constructor
> attributes. How about:
>
> type t =
>   | A with id, id(expr)
>   | B of ... with id(expr), id

This is a case where the standard syntax for attributes works well (if 
we put attributes before constructor arguments).  What's the argument in 
favor of a dedicated syntax?  (I like the fact that all attribute 
syntaxes look similar.)

> We could also allow this for convenient record label attributes.

Yes, it make sense.

> I think
> this syntax is already used in type-conv, it fits in with the "with"
> attributes for type declarations, and is a lighter syntax than the
> alternative.

What do you call lighter?  It uses fewer non-alphanumeric symbols, but 
it becomes more compact only with 4 attributes:

A with id(expr), id(expr), id(expr), id(expr)
A [@id expr] [@id expr] [@id expr] [@id expr]


How does type-conv distinguish attributes on the last constructors from 
attributes on the type itself?  (Where do we find the documentation for 
the syntax recognized by type-conv?)


Alain

From david.waern@gmail.com  Tue Mar  5 12:10:52 2013
Return-Path: <david.waern@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 91A513C087
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Mar 2013 12:10:52 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1452211 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.182 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: lexifi.com]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (david.waern[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f182.google.com ([209.85.128.182]:44100)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UCqns-0007WP-XD (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <david.waern@gmail.com>); Tue, 05 Mar 2013 12:17:09 +0000
Received: by mail-ve0-f182.google.com with SMTP id ox1so5647457veb.41
 for <wg-camlp4@lists.ocaml.org>; Tue, 05 Mar 2013 04:17:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=AKGUlgG2U/lTZn4hRKmt0LEUpOhFMhVn2FiySH6hUmQ=;
 b=jw2BM+YXx64eupslsu0zrQFZXTLYeZ94Z+CmcDoiX4O+Ea5MMXQu1Uxvi8nInQco8T
 0j+vdqzFg99SM6QiRgyYpeDvAHPxHMPrroXRFaOU6AERMfnmWhq2MHq2lrH8c12EZ4JK
 EaVDTs/Fc7VHyZDbhlNNel/p10A+6ZrhIJpU6Yrbxs3OBFOkb/7AwCg0xPUsrGuJk38l
 cpq8MnovY3IWdC6DKft2/L+cLC3uPFvZEIvXOZaUzUaAC6I8EsR2AYcN8G2BHdIHy6M+
 ZCj/q04jvAwDmQnfqQDY5npBljVmDgFpl5tFK5wKkkJ2MWjgay3YBTCxpnFUjSsjwfld
 yA6A==
MIME-Version: 1.0
X-Received: by 10.220.248.74 with SMTP id mf10mr9442668vcb.0.1362485827592;
 Tue, 05 Mar 2013 04:17:07 -0800 (PST)
Received: by 10.58.188.110 with HTTP; Tue, 5 Mar 2013 04:17:07 -0800 (PST)
In-Reply-To: <5134E274.5070704@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com>
 <CAN8ZjBFXof4LW_tD=4z+kqmhoaLRQtzoRHAJGQHmb2rqi2dNow@mail.gmail.com>
 <5134E274.5070704@lexifi.com>
Date: Tue, 5 Mar 2013 13:17:07 +0100
Message-ID: <CAN8ZjBECg8Ga3=0p7HG3tP+n_PWAeQOXx83UbTNOj_CB+G2vsQ@mail.gmail.com>
From: David Waern <david.waern@gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=bcaec54a37bcc3eab304d72c73de
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Mar 2013 12:10:52 -0000

--bcaec54a37bcc3eab304d72c73de
Content-Type: text/plain; charset=ISO-8859-1

2013/3/4 Alain Frisch <alain.frisch@lexifi.com>

> On 03/04/2013 03:44 PM, David Waern wrote:
>
>> Could we switch these two so that ^ is used for the postfix version? :-)
>>
>
> For the records, after checking with David, this comes from Haddock (=
> ocamldoc for Haskell, also piggy-backing the generic syntax for comments):
>
> http://www.haskell.org/**haddock/doc/html/markup.html#**id564988<http://www.haskell.org/haddock/doc/html/markup.html#id564988>
>
>
>
Sorry, should have added a few more sentences. So basically I just wanted
to add that ^ works better for postfix, when the attribute/extension is put
on the next line, since it resembles an up-arrow.

David

--bcaec54a37bcc3eab304d72c73de
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<br><br><div class=3D"gmail_quote">2013/3/4 Alain Frisch <span dir=3D"ltr">=
&lt;<a href=3D"mailto:alain.frisch@lexifi.com" target=3D"_blank">alain.fris=
ch@lexifi.com</a>&gt;</span><br><blockquote class=3D"gmail_quote" style=3D"=
margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<div class=3D"im">On 03/04/2013 03:44 PM, David Waern wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Could we switch these two so that ^ is used for the postfix version? :-)<br=
>
</blockquote>
<br></div>
For the records, after checking with David, this comes from Haddock (=3D oc=
amldoc for Haskell, also piggy-backing the generic syntax for comments):<br=
>
<br>
<a href=3D"http://www.haskell.org/haddock/doc/html/markup.html#id564988" ta=
rget=3D"_blank">http://www.haskell.org/<u></u>haddock/doc/html/markup.html#=
<u></u>id564988</a><div class=3D"HOEnZb"><div class=3D"h5"><br>
<br></div></div></blockquote><div><br>Sorry, should have added a few more s=
entences. So basically I just wanted to add that ^ works better for postfix=
, when the attribute/extension is put on the next line, since it resembles =
an up-arrow.<br>
<br>David<br></div></div>

--bcaec54a37bcc3eab304d72c73de--

From lpw25@hermes.cam.ac.uk  Tue Mar  5 13:47:59 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 059C83C087
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Mar 2013 13:47:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:39810)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:25)
 with esmtpa (EXTERNAL:lpw25) id 1UCsJr-00073o-YQ (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Mar 2013 13:54:15 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1UCsJr-0003ih-Kx (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Tue, 05 Mar 2013 13:54:15 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 05 Mar 2013 13:54:15 +0000
Date: 05 Mar 2013 13:54:15 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1303051354150.24635@hermes-1.csi.cam.ac.uk>
In-Reply-To: <5135075C.1080302@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com> <5134E071.4050408@lexifi.com>
 <Prayer.1.3.5.1303041909120.11091@hermes-1.csi.cam.ac.uk>
 <5135075C.1080302@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Mar 2013 13:47:59 -0000

>>>  type t =
>>>    | A [@id expr] [@id expr]
>>>    | B [@id expr] [@id expr] of ...
>>
>> I agree that we need a special syntax for variant constructor
>> attributes. How about:
>>
>> type t =
>>   | A with id, id(expr)
>>   | B of ... with id(expr), id
>
>This is a case where the standard syntax for attributes works well (if 
>we put attributes before constructor arguments).  What's the argument in 
>favor of a dedicated syntax?  (I like the fact that all attribute 
>syntaxes look similar.)

My argument was based on the assumption that we were going to provide a 
"with" attribute syntax for type definitions (for convenience and to 
distinguish attributes on a type definition from attributes on a whole set 
of recursive type definitions). I have since noticed that using the same 
syntax for both would conflict.

>What do you call lighter?  It uses fewer non-alphanumeric symbols, but 
>it becomes more compact only with 4 attributes:
>
>A with id(expr), id(expr), id(expr), id(expr)
>
>A [@id expr] [@id expr] [@id expr] [@id expr]

I meant lighter in an aesthetic sense. It is easier for people to read code 
that uses alphanumeric characters. 

I think the "[@id expr]" syntax is more appropriate within expression and 
type expressions, but for "larger" constructs like structure items a 
keyword based solution would be preferable. However, other than by adding a 
keyword, I have not been able to come up with a suitable syntax that 
wouldn't conflict with some existing structure item.

>How does type-conv distinguish attributes on the last constructors from 
>attributes on the type itself?  

It turns out that type-conv only allows "with" for type definitions and 
record labels -- which don't conflict.


From alain.frisch@lexifi.com  Tue Mar  5 15:24:33 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 43A893C087
 for <wg-camlp4@lists.ocaml.org>; Tue,  5 Mar 2013 15:24:33 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452211 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:35275
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UCtpJ-0002NZ-ZS (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 05 Mar 2013 15:30:50 +0000
Received: from [192.168.1.120] ([92.151.53.114]) by mwinf5d69 with ME
 id 7rWp1l00C2Tqu6L03rWpF3; Tue, 05 Mar 2013 16:30:49 +0100
Message-ID: <51360FAE.7040407@lexifi.com>
Date: Tue, 05 Mar 2013 16:30:54 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com> <5134E071.4050408@lexifi.com>
 <Prayer.1.3.5.1303041909120.11091@hermes-1.csi.cam.ac.uk>
 <5135075C.1080302@lexifi.com>
 <Prayer.1.3.5.1303051354150.24635@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1303051354150.24635@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 05 Mar 2013 15:24:33 -0000

On 03/05/2013 02:54 PM, Leo White wrote:
> I meant lighter in an aesthetic sense. It is easier for people to read
> code that uses alphanumeric characters.
> I think the "[@id expr]" syntax is more appropriate within expression
> and type expressions, but for "larger" constructs like structure items a
> keyword based solution would be preferable.

One could argue that attributes "within expressions" should be the light 
ones (with only alphanumeric characters) because they are "in the way", 
while attributes on items on the contrary, can be allowed to be more 
visible because they apply on well-delimited and big pieces of syntax.

Also note that ocamldoc uses "non alphanumeric characters" for its 
"attributes" on small (constructors) and big items.

> However, other than by
> adding a keyword, I have not been able to come up with a suitable syntax
> that wouldn't conflict with some existing structure item.

Talking from experience, there will be a strong resistance to add a new 
keyword (and it is likely that a proposal for a new keyword would use a 
quite common name).  So let's assume this is not an option.


Alain

From alain.frisch@lexifi.com  Wed Mar  6 09:59:27 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 407293C04E
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 09:59:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452698 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:17914
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UDBEH-0005s1-pw (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 06 Mar 2013 10:05:46 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d56 with ME
 id 8A5k1l00i4U5yvJ03A5ktj; Wed, 06 Mar 2013 11:05:44 +0100
Message-ID: <513714F7.2090203@lexifi.com>
Date: Wed, 06 Mar 2013 11:05:43 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com> <5134E071.4050408@lexifi.com>
 <Prayer.1.3.5.1303041909120.11091@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1303041909120.11091@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 09:59:27 -0000

On 03/04/2013 08:09 PM, Leo White wrote:
> How about including "Item" extensions "[%%lid expr]"?

I now believe it would also be useful to have attributes as 
extension/signature item (in addition to attributes *on* items).  This 
will be lighter than putting attributes on "include" statements (e.g. 
for ocamldoc section headers), and it could also be useful to specify 
meta-data for the whole unit (as an attribute at the beginning of the 
file).   This problem is that this requires a third syntax for attributes.

Do people agree on the need for such attributes, and that a new syntax 
is required?  Any proposal?  I believe the following would be safe, for 
instance:

  [*  ...]
  [@@@ ...]
  [%? ...]


An alternative could be to have a "nop" signature/structure item 
(semantically equivalent to "include sig end"/"include struct end"), on 
which we can use the standard syntax for item attributes.  But we still 
need some new syntax for it...


Alain

From lpw25@hermes.cam.ac.uk  Wed Mar  6 12:51:01 2013
Return-Path: <lpw25@hermes.cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 35AF73CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 12:51:01 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from hermes-1.csi.cam.ac.uk ([131.111.8.51]:48176)
 by ppsw-42.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:25)
 with esmtpa (EXTERNAL:lpw25) id 1UDDuL-00025H-6j (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 06 Mar 2013 12:57:21 +0000
Received: from prayer by hermes-1.csi.cam.ac.uk (hermes.cam.ac.uk)
 with local (PRAYER:lpw25) id 1UDDuL-0002Vm-1i (Exim 4.72)
 (return-path <lpw25@hermes.cam.ac.uk>); Wed, 06 Mar 2013 12:57:21 +0000
Received: from [128.232.64.15] by webmail.hermes.cam.ac.uk
 with HTTP (Prayer-1.3.5); 06 Mar 2013 12:57:20 +0000
Date: 06 Mar 2013 12:57:20 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <Prayer.1.3.5.1303061257200.564@hermes-1.csi.cam.ac.uk>
In-Reply-To: <513714F7.2090203@lexifi.com>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com> <5134E071.4050408@lexifi.com>
 <Prayer.1.3.5.1303041909120.11091@hermes-1.csi.cam.ac.uk>
 <513714F7.2090203@lexifi.com>
X-Mailer: Prayer v1.3.5
Mime-Version: 1.0
Content-Type: text/plain; format=flowed; charset=ISO-8859-1
Sender: "L.P. White" <lpw25@hermes.cam.ac.uk>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 12:51:01 -0000

>Do people agree on the need for such attributes, and that a new syntax 
>is required?  

I can understand the desire to attach attributes to the whole compilation 
unit, but that could be done without a new syntax by allowing postfix 
attributes at the start of a file.

I'm not sure that I understand the need for general attributes not attached 
to anything in the middle of the module. If their position is important 
then there must be some item that they are essentially attached to, if 
their position is not important then they can just be placed at the top of 
the module.


From alain.frisch@lexifi.com  Wed Mar  6 13:11:56 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4A69F3CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 13:11:56 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452698 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:51670
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UDEEZ-00011l-Sk (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 06 Mar 2013 13:18:16 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d62 with ME
 id 8DJF1l0084U5yvJ03DJFf2; Wed, 06 Mar 2013 14:18:15 +0100
Message-ID: <51374214.6030501@lexifi.com>
Date: Wed, 06 Mar 2013 14:18:12 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <512FC647.6050900@lexifi.com>
 <CACLX4jTkfWe-Ax+SUL=vvq-P_vhO2nVKMAbj61p=kqKXW44D6g@mail.gmail.com>
 <CAM3Ki76qvbESLoGiPahUrO00-vDf2Tz-sZ_33ev_w78oO6dEag@mail.gmail.com>
 <5130A79A.2080505@lexifi.com>
 <Prayer.1.3.5.1303011752110.11703@hermes-1.csi.cam.ac.uk>
 <51347BD4.4060008@lexifi.com>
 <Prayer.1.3.5.1303041051120.31488@hermes-1.csi.cam.ac.uk>
 <51349AE6.2090000@lexifi.com>
 <CAPFanBEqWfZj9KpPnypG2Lj7j=hdzwifz7o-V-ANdD9H67CB5w@mail.gmail.com>
 <5134B062.6010106@lexifi.com> <5134E071.4050408@lexifi.com>
 <Prayer.1.3.5.1303041909120.11091@hermes-1.csi.cam.ac.uk>
 <513714F7.2090203@lexifi.com>
 <Prayer.1.3.5.1303061257200.564@hermes-1.csi.cam.ac.uk>
In-Reply-To: <Prayer.1.3.5.1303061257200.564@hermes-1.csi.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 13:11:56 -0000

On 03/06/2013 01:57 PM, Leo White wrote:
> I'm not sure that I understand the need for general attributes not
> attached to anything in the middle of the module. If their position is
> important then there must be some item that they are essentially
> attached to, if their position is not important then they can just be
> placed at the top of the module.

I was mentioning ocamldoc section headers.  Without "floating" 
attributes, one can write:

[^^doc section "....."] include sig
    ...
end

On the one hand, this is nice, because it materializes the scope of the 
section (and you can benefit from your editor's folding feature).  But 
on the other hand, it is quite verbose and forces some extra 
indentation.  More fundamentally, this might not interact nicely with 
other features/tools, which might require a different nesting structure. 
  For instance, imagine a global dead code detector, for which one might 
want to exclude whole "sections" of exported declarations.  One could 
use the same technique as for ocamldoc sections:

[^^dead_code_detector ignore] include sig
    ...
end

But then we need to close/reopen those sections so that they remain 
nested within ocamldoc ones.  With floating attributes, one can write:


[*doc section "Section 1"]

[*dead_code_detector ignore true]

....

[*doc section "Section 2"]

....

[*dead_code_detector ignore false]

....


Does it make sense?


Alain

From alain.frisch@lexifi.com  Wed Mar  6 14:55:57 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C36603CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 14:55:57 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452698 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: inria.fr]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:51261
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UDFrF-0006ZI-qb (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 06 Mar 2013 15:02:17 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d62 with ME
 id 8F2G1l00S4U5yvJ03F2GFf; Wed, 06 Mar 2013 16:02:17 +0100
Message-ID: <51375A74.5090304@lexifi.com>
Date: Wed, 06 Mar 2013 16:02:12 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: multipart/mixed; boundary="------------080807030307040506040707"
Subject: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 14:55:57 -0000

This is a multi-part message in MIME format.
--------------080807030307040506040707
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit

I've started a document to describe the current state of the branch:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/extension_points.txt?view=markup

A copy of the current version is attached.

Recent additions:


  - Attributes on labels in record declarations.
  - Attributes as standalone signature/structure items.
  - An alternative syntax for attributes on some kinds of expressions
    starting with a keyword, e.g.  "let[@id] p = e in e" is parsed
    as "(let p = e in e)[@id]" and as "[^id](let p = e in e)".
    Do people think this is useful?

    (I'm considering recognizing also "let[%id] p = e in e"
    as "(%id (let p = e in e))" and "let[%id e0] p = e in e"
    e.g. as "(%id (%id e0) (let p = e in e))".  Opinion?)


Don't hesitate to comment on the choice of syntaxes and representation 
in the Parsetree, etc!


Alain

--------------080807030307040506040707
Content-Type: text/plain; charset=UTF-8;
 name="extension_points.txt"
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment;
 filename="extension_points.txt"

This file describes the changes on the extension_points branch.


=== Attributes

Attributes are "decorations" of the syntax tree which are ignored by
the type-checker.  An attribute is made of an identifier (an "LIDENT", written
id below) and an optional expression (written expr below).

Four syntaxes exist for attributes, according to the kind of component
the attribute applies to, and whether the attribute is written before
or after the component.

On expressions, type expressions, module expressions, module type expressions,
patterns (TODO: class expressions, class type expressions):
 
  Prefix syntax:   [^id expr] ...
  Postfix syntax:  ... [@id expr]

The postfix syntax [@id expr] is also available to add attributes on
constructors and labels in type declarations:

  type t =
    | A [@id1]
    | B [@id2] of int [@id3]

Here, id1 (resp. id2) is attached to the constructor A (resp. B)
and id3 is attached to the int type expression.  Example on records:

 type t =
   {
      x [@id1]: int;
      mutable y [@id2] [@id3]: string [@id4];
   }  


On items:

  Prefix syntax: [^^id expr] ...
  Postfix syntax: ... [@@id expr]

  Items designate signature and structure items, and also individual
  components of multiple declaration (type declarations, recursive modules,
  class declarations, class type declarations). (TODO: class fields?)

  For multiple declarations:

    - prefix attributes written before the first keyword of the item
      are attached to the first declared component

    - postfix attributes written after the item are attached to the
      last declared component

    - more prefix attributes can be inserted after the opening keyword
      (for the first component) and after the "and" keyword (for other
      components)

    - more postfix attributes can be inserted before the "and" keyword

  For instance, consider:

    [^^id1] type [^^id2] t1 = ... [@@id3] and [^^id4] t2 = ... [@@id5]

  Here, the attributes on t1 are id1, id2 and id3; the attributes on
  t2 are id4 and id5.

  Note: item attributes are currently not supported on Pstr_eval
  and Pstr_value structure items.

A fifth syntax exists for attributes which stand as signature or
structure item on their own (i.e. they are not attached to any other
component):

   [*id expr]

([^^] and [@@] attributes cannot be attached to such a standalone attribute.)


=== Alternative syntax for attributes on specific kinds of nodes

Some constructions starting with a keyword KW supports an alternative
syntax for attributes:

  KW[@id expr]...[@id expr] ....
  ---->
  (KW ....)[@id expr]...[@id expr]

For instance:

let[@foo] x = 2 in x + 1

is equivalent to:

(let x = 2 in x + 1)[@foo]

and also to:

[^foo](let x = 2 in x + 1)

Supported constructions:

local let binding
function ...
fun (type t) ->  ...
match ... with ...
try ... with ...
begin ... end


=== Representation of attributes in the Parsetree

For attributes on expressions and similar categories, attributes are
just another possible constructor (one single attribute per node):

and expression_desc =
  ....
  | Pexp_attribute of (expression * attribute)

Note: we currently don't distinguish between prefix and postfix attributes.

Similarly, attributes as standalone signature/structure items are represented
by a new constructor:
  | Psig_attribute of attribute
  | Pstr_attribute of attribute

For "declarations"-like items (type declarations, module declarations,
..., but also constructors and record labels), all attributes are stored
in an extra field in their record (again, without making the distinction
between prefix and postfix attributes):

and type_declaration = {
   ...
   ptype_attributes: attribute list;
   ...

For other kinds of items (currently: open/include stataments,
exception rebind), the attributes are stored directly in the
constructor of the item:

  | Pstr_open of Longident.t loc * attribute list



=== Extension nodes

Extension nodes replace valid components in the syntax tree.  They are
normally interpreted and expanded by AST mapper.  The type-checker
fails when it encounters such an extension node.  An extension node is
made of an identifier (an "LIDENT", written id below) and an optional
expression (written expr below).

Two syntaxes exist for extension node:

As expressions, type expressions, module expressions, module type expressions,
patterns (TODO: class expressions, class type expressions):

  [%id expr]

As structure or signature item (TODO: class fields?):
 
  [%%id expr]

As other structure or signature items, attributes can be attached to a
[%%id expr] extension node.


=== Other changes to the parser and Parsetree

--- Relaxing the syntax for recursive modules.

Before:
   module X1 : MT1 = M1 and ... and Xn : MTn = Mn

Now:
   module X1 = M1 and ... and Xn = Mn
   (with the usual sugar that Xi = (Mi : MTi) can be written as Xi : MTi = Mi
   which gives the old syntax)

   The type-checker fails when a module expression is not of
   the form (M : MT)
   

Rationale:

1. More uniform representation in the Parsetree.

2. The type-checker can be made more clever in the future to support
   other forms of module expressions (e.g. functions with an explicit
   constraint on its result; or a structure with only type-level
   components).
    
      
--- Turning some tuple or n-ary constructors into records

Before:

  | Pstr_module of string loc * module_expr

After:

  | Pstr_module of module_binding
...
  and module_binding =
    {
     pmb_name: string loc;
     pmb_expr: module_expr;
     pmb_attributes: attribute list;
    }



Rationale:

More self-documented, more robust to future additions (such as
attributes), simplifies some code.


--- Keeping names inside value_description and type_declaration

Before:

  | Psig_type of (string loc * type_declaration) list


After:

  | Psig_type of type_declaration list

....
and type_declaration =
  { ptype_name: string loc;
    ...
  }

Rationale:

More self-documented, simplifies some code.


=== More TODOs

- Adapt pprintast.
- Adapt Camlp4 (both its parser(s) and its internal representation of OCaml ASTs).
- Propagate attributes to the Typedtree (so that they can be retrieved in .cmt/.cmti).
- Consider adding hooks to the type-checker so that custom extension expanders can be registered (a la OCaml Templates).
- Quotations (i.e. string literals with custom delimiters and without any interpretation of special characters in them), and a syntax which combines extension nodes and quotations.
- More cleanups to the Parsetree + documentation.

--------------080807030307040506040707--

From xavier.clerc@inria.fr  Wed Mar  6 15:11:27 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 2A58B3CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 15:11:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.6 from SpamAssassin-3.3.2-1452698 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.83 listed in list.dnswl.dnsbl.ja.net]
 * -0.6 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.0 URIBL_BLOCKED ADMINISTRATOR NOTICE: The query to URIBL was blocked.
 *        See http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
 *       for more information. *      [URIs: inria.fr]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail2-relais-roc.national.inria.fr ([192.134.164.83]:59277)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UDG6E-0007l2-SQ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Wed, 06 Mar 2013 15:17:47 +0000
X-IronPort-AV: E=Sophos;i="4.84,795,1355094000"; 
   d="scan'208";a="5777199"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail2-relais-roc.national.inria.fr with ESMTP; 06 Mar 2013 16:17:46 +0100
Date: Wed, 6 Mar 2013 16:17:46 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
In-Reply-To: <51375A74.5090304@lexifi.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [81.194.27.158]
X-Mailer: Zimbra 7.2.2_GA_2857 (ZimbraWebClient - SAF3 (Mac)/7.2.2_GA_2852)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 15:11:27 -0000

----- Mail original -----
> I've started a document to describe the current state of the branch:
> 
> http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/extension_points.txt?view=markup
> 
> A copy of the current version is attached.
> 
> Recent additions:
> 
> 
>   - Attributes on labels in record declarations.
>   - Attributes as standalone signature/structure items.
>   - An alternative syntax for attributes on some kinds of expressions
>     starting with a keyword, e.g.  "let[@id] p = e in e" is parsed
>     as "(let p = e in e)[@id]" and as "[^id](let p = e in e)".
>     Do people think this is useful?
> 
>     (I'm considering recognizing also "let[%id] p = e in e"
>     as "(%id (let p = e in e))" and "let[%id e0] p = e in e"
>     e.g. as "(%id (%id e0) (let p = e in e))".  Opinion?)
> 
> 
> Don't hesitate to comment on the choice of syntaxes and
> representation
> in the Parsetree, etc!

I will not discuss the syntax per se, but I wonder whether
having both prefix and suffix attributes is not error-prone.
Could you elaborate on the need of having both?

Another, unrelated question: as an extension developer, it
seems that I will have to deal with full-fledged expressions
as attributes values. Do you plan some mechanism to allow
easy access to an identifier used in such an expression.
I mean, it can even refer to another module. This also implies
that you could create dependencies between modules solely
through attributes; is that correct?


Sorry if those questions have already been answered, I did
not follow the previous thread about extension points.


Xavier Clerc

From alain.frisch@lexifi.com  Wed Mar  6 15:45:06 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4C4803CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 15:45:06 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452698 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:43926
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UDGck-0003hN-WK (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 06 Mar 2013 15:51:26 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d62 with ME
 id 8FrM1l00X4U5yvJ03FrM6f; Wed, 06 Mar 2013 16:51:21 +0100
Message-ID: <513765F5.5020900@lexifi.com>
Date: Wed, 06 Mar 2013 16:51:17 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Xavier Clerc <xavier.clerc@inria.fr>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
In-Reply-To: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 15:45:06 -0000

On 03/06/2013 04:17 PM, Xavier Clerc wrote:
> I will not discuss the syntax per se, but I wonder whether
> having both prefix and suffix attributes is not error-prone.
> Could you elaborate on the need of having both?

I proposed to use a prefix attribute (on an include statement) to create 
ocamldoc sections:

[^^doc section "Section Title"] include
    ...
end

but I now tend to prefer "floating" attributes in signatures.

Gabriel gave another example to justify the need for a prefix syntax:

  begin [: pragma(non_exhaustive_match) :]
     ...
  end

but this might be subsumed by the special form:

    begin[@id expr] ... end

which is equivalent to:

   (...)[@id expr]


Do people see use cases where the prefix syntax is much better?

> Another, unrelated question: as an extension developer, it
> seems that I will have to deal with full-fledged expressions
> as attributes values. Do you plan some mechanism to allow
> easy access to an identifier used in such an expression.
> I mean, it can even refer to another module. This also implies
> that you could create dependencies between modules solely
> through attributes; is that correct?

Expressions used inside attributes/extension nodes are just syntactical 
expressions.  They are never type-checked and their identifiers are not 
resolved; ocamldep does not look inside those expressions.

We could use any "universal" type instead of expressions (strings, 
s-expressions, xml, json).  Some arguments to use OCaml expressions:

  - This is a rich language, in which we can encode various DSL 
understood by extensions, so that the extensions don't need to do any 
parsing.

  - We already have a parser!

  - The syntax will look familiar to OCaml developers and adapting 
editors to nicely support (colors, indentation, etc) them will be easy.

  - It won't be uncommon to embed fragments of OCaml code, to be 
inserted into the real code fed to the compiler, within those 
expressions. Example:

   type t = {
      x: int;
      y [@default (x + 1)]: int;
      z [@optional]: int option;
   } [@@builder {with_labels; invariant=(x <= y)}]

  rewritten to:

   type t = {
      x: int;
      y: int;
   }

   let build_t ~x ?(y = x + 1) ?z () =
      assert(x <= y);
      {x; y; z}



As an extension developer, you don't need to suffer from the complexity 
of OCaml expression.  Instead,  you are free to define the subset of 
OCaml expressions which make sense inside "your" attributes/extension 
nodes, and fail when the user doesn't comply with this constraint.

From xavier.clerc@inria.fr  Wed Mar  6 15:56:42 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 41B143CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 15:56:42 +0000 (GMT)
X-Cam-SpamDetails: score -5.7 from SpamAssassin-3.3.2-1452698 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.83 listed in list.dnswl.dnsbl.ja.net]
 * -0.6 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail2-relais-roc.national.inria.fr ([192.134.164.83]:64641)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UDGo1-0001OP-7p (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Wed, 06 Mar 2013 16:03:02 +0000
X-IronPort-AV: E=Sophos;i="4.84,795,1355094000"; 
   d="scan'208";a="5786727"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail2-relais-roc.national.inria.fr with ESMTP; 06 Mar 2013 17:03:01 +0100
Date: Wed, 6 Mar 2013 17:03:00 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <2090494651.3090344.1362585780838.JavaMail.root@inria.fr>
In-Reply-To: <513765F5.5020900@lexifi.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [81.194.27.158]
X-Mailer: Zimbra 7.2.2_GA_2857 (ZimbraWebClient - SAF3 (Mac)/7.2.2_GA_2852)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 15:56:42 -0000



----- Mail original -----
> On 03/06/2013 04:17 PM, Xavier Clerc wrote:
> > I will not discuss the syntax per se, but I wonder whether
> > having both prefix and suffix attributes is not error-prone.
> > Could you elaborate on the need of having both?
> 
> I proposed to use a prefix attribute (on an include statement) to
> create
> ocamldoc sections:
> 
> [^^doc section "Section Title"] include
>     ...
> end
> 
> but I now tend to prefer "floating" attributes in signatures.
> 
> Gabriel gave another example to justify the need for a prefix syntax:
> 
>   begin [: pragma(non_exhaustive_match) :]
>      ...
>   end
> 
> but this might be subsumed by the special form:
> 
>     begin[@id expr] ... end
> 
> which is equivalent to:
> 
>    (...)[@id expr]
> 
> 
> Do people see use cases where the prefix syntax is much better?
> 
> > Another, unrelated question: as an extension developer, it
> > seems that I will have to deal with full-fledged expressions
> > as attributes values. Do you plan some mechanism to allow
> > easy access to an identifier used in such an expression.
> > I mean, it can even refer to another module. This also implies
> > that you could create dependencies between modules solely
> > through attributes; is that correct?
> 
> Expressions used inside attributes/extension nodes are just
> syntactical
> expressions.  They are never type-checked and their identifiers are
> not
> resolved; ocamldep does not look inside those expressions.
> 
> We could use any "universal" type instead of expressions (strings,
> s-expressions, xml, json).  Some arguments to use OCaml expressions:
> 
>   - This is a rich language, in which we can encode various DSL
> understood by extensions, so that the extensions don't need to do any
> parsing.
> 
>   - We already have a parser!
> 
>   - The syntax will look familiar to OCaml developers and adapting
> editors to nicely support (colors, indentation, etc) them will be
> easy.
> 
>   - It won't be uncommon to embed fragments of OCaml code, to be
> inserted into the real code fed to the compiler, within those
> expressions. Example:
> 
>    type t = {
>       x: int;
>       y [@default (x + 1)]: int;
>       z [@optional]: int option;
>    } [@@builder {with_labels; invariant=(x <= y)}]
> 
>   rewritten to:
> 
>    type t = {
>       x: int;
>       y: int;
>    }
> 
>    let build_t ~x ?(y = x + 1) ?z () =
>       assert(x <= y);
>       {x; y; z}
> 
> 
> 
> As an extension developer, you don't need to suffer from the
> complexity
> of OCaml expression.  Instead,  you are free to define the subset of
> OCaml expressions which make sense inside "your" attributes/extension
> nodes, and fail when the user doesn't comply with this constraint.

Thanks for the clarification. However, I am now afraid about user side...
Expression will be treated in a non-uniform way by attributes.
Moreover, replacing a literal constant with a symbolic one will cause
extension to stop working. Honestly, I cannot say if it is a big deal.
But, I think it can be a surprise.


Xavier Clerc


From alain.frisch@lexifi.com  Wed Mar  6 16:21:47 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7B6693CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 16:21:47 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452698 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:34548
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UDHCI-00059o-sU (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 06 Mar 2013 16:28:07 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d62 with ME
 id 8GU61l00F4U5yvJ03GU6Mg; Wed, 06 Mar 2013 17:28:06 +0100
Message-ID: <51376E91.8090202@lexifi.com>
Date: Wed, 06 Mar 2013 17:28:01 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Xavier Clerc <xavier.clerc@inria.fr>
References: <2090494651.3090344.1362585780838.JavaMail.root@inria.fr>
In-Reply-To: <2090494651.3090344.1362585780838.JavaMail.root@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 16:21:47 -0000

On 03/06/2013 05:03 PM, Xavier Clerc wrote:
> Thanks for the clarification. However, I am now afraid about user side...
> Expression will be treated in a non-uniform way by attributes.
> Moreover, replacing a literal constant with a symbolic one will cause
> extension to stop working. Honestly, I cannot say if it is a big deal.
> But, I think it can be a surprise.

Would the situation be very different if we used a different syntax for 
attributes?

I expect extensions to document exactly which attributes are recognized 
and fail if the user does something wrong.

Example:

  type t =
   {
     foo: float [@xml digits 3];
     bar [@xml omit_if (fun s -> s = "")]: string;
   } [@@xml]


where the "xml" extension would specify something like:

"Within the type declaration, some special attributes are recognized on 
to customize the rendering of OCaml values as XML:

  - on type expressions:
    float [@xml digits N]  (where N is a integer literal)
                The float value is displayed with N digits
    date [@xml format "YYYY-MM-DD"]
                ...

  - on record fields:
    field[@xml omit_if <fun>]: ...
                Omit the XML element corresponding to the field if the
                provided function evaluates to false when passed the
                field value.
  ...
"

If we used, say, JSON as the attribute argument, the example would look 
like:

  type t =
   {
     foo: float [@xml {digits:3}];
     bar [@xml {omit_if:"(fun s -> s = \"\")"}]: string;
   } [@@xml]



Would that be really less confusing?

-- Alain

From xavier.clerc@inria.fr  Wed Mar  6 16:25:12 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6CA003CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 16:25:12 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.6 from SpamAssassin-3.3.2-1452698 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.6 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:51967)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UDHFb-0006px-sp (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Wed, 06 Mar 2013 16:31:32 +0000
X-IronPort-AV: E=Sophos;i="4.84,795,1355094000"; 
   d="scan'208";a="4430984"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail3-relais-sop.national.inria.fr with ESMTP; 06 Mar 2013 17:31:31 +0100
Date: Wed, 6 Mar 2013 17:31:31 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <1844158249.3101104.1362587491534.JavaMail.root@inria.fr>
In-Reply-To: <51376E91.8090202@lexifi.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [81.194.27.158]
X-Mailer: Zimbra 7.2.2_GA_2857 (ZimbraWebClient - SAF3 (Mac)/7.2.2_GA_2852)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 16:25:12 -0000

----- Mail original -----
> On 03/06/2013 05:03 PM, Xavier Clerc wrote:
> > Thanks for the clarification. However, I am now afraid about user
> > side...
> > Expression will be treated in a non-uniform way by attributes.
> > Moreover, replacing a literal constant with a symbolic one will
> > cause
> > extension to stop working. Honestly, I cannot say if it is a big
> > deal.
> > But, I think it can be a surprise.
> 
> Would the situation be very different if we used a different syntax
> for
> attributes?

No, probably not.


(...)


> Would that be really less confusing?

No, you are clearly right.
I just feel dizzy when there is less type safety...
but that's a problem with me, not with your proposal!


Xavier Clerc

From alain.frisch@lexifi.com  Wed Mar  6 16:25:33 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C67E13CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 16:25:33 +0000 (GMT)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1452698 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:25531
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UDHFx-0005vi-7t (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 06 Mar 2013 16:31:54 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d62 with ME
 id 8GXs1l00n4U5yvJ03GXsJj; Wed, 06 Mar 2013 17:31:53 +0100
Message-ID: <51376F74.8020502@lexifi.com>
Date: Wed, 06 Mar 2013 17:31:48 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Xavier Clerc <xavier.clerc@inria.fr>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com>
In-Reply-To: <513765F5.5020900@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 16:25:33 -0000

On 03/06/2013 04:51 PM, Alain Frisch wrote:
> We could use any "universal" type instead of expressions (strings,
> s-expressions, xml, json).  Some arguments to use OCaml expressions:

I forgot one important argument: using expressions as arguments of 
attributes make it possible, if desired, to have rewriters applied on 
those arguments as well.  For instance, if the first -ppx rewriters to 
be applied are a "macro expander" and a "conditional compilation" 
system, they could operate naturally on the content of attributes 
understood by later rewriters.  This could be useful, for instance, to 
decide to include or not some fragments in the generated documentation 
(generated by a variant of ocamldoc based on attributes) based on 
whether some symbols are defined or not (to create a "public" 
documentation vs. a "private" one, for the same module).

-- Alain

From alain.frisch@lexifi.com  Wed Mar  6 16:35:17 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B14553CBE6
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 16:35:17 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1452698 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:30485
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UDHPN-0008AS-SV (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 06 Mar 2013 16:41:38 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d62 with ME
 id 8Ghd1l00G4U5yvJ03GhdLH; Wed, 06 Mar 2013 17:41:37 +0100
Message-ID: <513771BC.3050706@lexifi.com>
Date: Wed, 06 Mar 2013 17:41:32 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Xavier Clerc <xavier.clerc@inria.fr>
References: <1844158249.3101104.1362587491534.JavaMail.root@inria.fr>
In-Reply-To: <1844158249.3101104.1362587491534.JavaMail.root@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 16:35:17 -0000

On 03/06/2013 05:31 PM, Xavier Clerc wrote:
> I just feel dizzy when there is less type safety...

But is it really the case that there is less safety?  If you use a 
"wrong" expression as an argument of some attribute, the -ppx rewriter 
will (hopefully) let you know at compile time, exactly as a good old 
type error.  I see there is something "weird" in re-using the same 
syntax as expressions for something treated very differently by the 
compiler, but I believe the technical advantages outweigh this feeling 
of weirdness.

The only thing which is not checked is the fact that the attribute 
itself is recognized (i.e. if you mistype the attribute name, the 
attribute will just be ignored by the type-checker).  We could introduce 
yet another syntax for non-ignorable attributes.  Or we could create an 
"attribute checker" (a -ppx rewriter applied after all the other ones, 
and which checks that no attribute remain in the AST).  But since it is 
not an abnormal situation to have attributes remaining in the final AST 
(for later use by tools based on .cmt/.cmti files, for instance, such as 
a new ocamldoc), the tool would need to be configured with a list of 
such attributes to accept.


Alain

From amc79@cam.ac.uk  Wed Mar  6 17:10:55 2013
Return-Path: <amc79@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 226443CBE6;
 Wed,  6 Mar 2013 17:10:55 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from dhcp-128-232-140-31.eduroam.csx.cam.ac.uk
 ([128.232.140.31]:56939)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:amc79) (TLSv1:AES128-SHA:128)
 id 1UDHxr-0000oD-rV (Exim 4.72)
 (return-path <amc79@cam.ac.uk>); Wed, 06 Mar 2013 17:17:15 +0000
From: Amir Chaudhry <amc79@cam.ac.uk>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Date: Wed, 6 Mar 2013 17:17:18 +0000
Message-Id: <7B2B1F92-FA0B-4D82-A0CC-7C9064031608@cam.ac.uk>
To: "cl-ocamllabs@lists.cam.ac.uk" <cl-ocamllabs@lists.cam.ac.uk>
Mime-Version: 1.0 (Mac OS X Mail 6.2 \(1499\))
X-Mailer: Apple Mail (2.1499)
Cc: wg-camlp4@lists.ocaml.org,
 "platform@lists.ocaml.org" <platform@lists.ocaml.org>,
 infrastructure <infrastructure@lists.ocaml.org>,
 Mirage List <cl-mirage@lists.cam.ac.uk>
Subject: [wg-camlp4] Reminder of OCaml Labs-related mailing lists
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 17:10:55 -0000

Dear all,

I thought it would be useful to point out the range of mailing lists =
that OCaml Labs is involved in.  Most of these have public archives and =
if you're interested in any of the topics, please feel free to sign-up.  =
I'm sending this message to each list, so apologies if you receive it =
multiple times.

cl-ocamllabs@lists.cam.ac.uk
Mostly used for announcements and updates. Discussions take place =
elsewhere.
Join: https://lists.cam.ac.uk/mailman/listinfo/cl-ocamllabs

cl-mirage@lists.cam.ac.uk
Day to day development talk on Mirage [1] and related projects.
Archive: https://lists.cam.ac.uk/pipermail/cl-mirage/
Join: https://lists.cam.ac.uk/mailman/listinfo/cl-mirage

platform@lists.ocaml.org
Discussions on aspects of the OCaml Platform and things that pertain to =
it.
Archive: http://lists.ocaml.org/pipermail/platform/
Join: http://lists.ocaml.org/listinfo/platform

infrastructure@lists.ocaml.org
Discussions on continuous integration infrastructure, ocaml.org and =
other things supporting OCaml.
Archive: http://lists.ocaml.org/pipermail/infrastructure
Join: http://lists.ocaml.org/listinfo/infrastructure

wg-camlp4@lists.ocaml.org
Community working group on the future of syntax extensions to OCaml.
Archive: http://lists.ocaml.org/pipermail/wg-camlp4/
Join: http://lists.ocaml.org/listinfo/wg-camlp4

[1] mirage - http://openmirage.org and =
http://www.cl.cam.ac.uk/projects/ocamllabs/projects/mirage.html

Best wishes,
Amir=

From xavier.clerc@inria.fr  Wed Mar  6 19:18:05 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5C9083CC22
 for <wg-camlp4@lists.ocaml.org>; Wed,  6 Mar 2013 19:18:05 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -5.6 from SpamAssassin-3.3.2-1452698 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.6 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:35954)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UDJwv-0001P5-ZD (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Wed, 06 Mar 2013 19:24:26 +0000
X-IronPort-AV: E=Sophos;i="4.84,795,1355094000"; 
   d="scan'208";a="4449315"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail3-relais-sop.national.inria.fr with ESMTP; 06 Mar 2013 20:24:25 +0100
Date: Wed, 6 Mar 2013 20:24:25 +0100 (CET)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <1693542754.3283877.1362597865344.JavaMail.root@inria.fr>
In-Reply-To: <513771BC.3050706@lexifi.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [82.216.20.161]
X-Mailer: Zimbra 7.2.2_GA_2857 (ZimbraWebClient - SAF3 (Mac)/7.2.2_GA_2852)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 06 Mar 2013 19:18:05 -0000

----- Mail original -----
> On 03/06/2013 05:31 PM, Xavier Clerc wrote:
> > I just feel dizzy when there is less type safety...
> 
> But is it really the case that there is less safety?  If you use a
> "wrong" expression as an argument of some attribute, the -ppx
> rewriter
> will (hopefully) let you know at compile time, exactly as a good old
> type error.

Quite not, as this is rewriter-dependent. A developer may very well
decide to accept both integers and floats for a given value for example.


(...)


> The only thing which is not checked is the fact that the attribute
> itself is recognized (i.e. if you mistype the attribute name, the
> attribute will just be ignored by the type-checker).

Yes, this is a potential pitfall.
And I would state things differently: the only thing that is checked
is that attribute values are syntactically well-formed.


>  We could introduce yet another syntax for non-ignorable attributes.
>  Or we could create an "attribute checker" (a -ppx rewriter applied
> after all the other ones, and which checks that no attribute remain
> in the AST).  But since it
> is
> not an abnormal situation to have attributes remaining in the final
> AST
> (for later use by tools based on .cmt/.cmti files, for instance, such
> as
> a new ocamldoc), the tool would need to be configured with a list of
> such attributes to accept.

Rather than a new syntax (they are already multiple), I would argue
for another solution:
  - maybe a tag to indicate that a given attribute has been preprocessed;
  - or, as the rewriter to register the attributes they handle and issue
    a warning if there is an attribute that cannot be treated by the
    rewriters.
Just wild ideas, though.


Xavier Clerc

From alain.frisch@lexifi.com  Thu Mar  7 09:01:19 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 90C5E3C04E
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Mar 2013 09:01:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1453215 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:33329
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UDWnd-0003O8-ZA (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 07 Mar 2013 09:07:42 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d09 with ME
 id 8Z7h1l00E4U5yvJ03Z7h2u; Thu, 07 Mar 2013 10:07:41 +0100
Message-ID: <513858DD.6040705@lexifi.com>
Date: Thu, 07 Mar 2013 10:07:41 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com>
In-Reply-To: <513765F5.5020900@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Mar 2013 09:01:19 -0000

On 03/06/2013 04:51 PM, Alain Frisch wrote:
> Do people see use cases where the prefix syntax is much better?

I found only one case: attaching meta-data to a function in an .ml file 
is better done before the function code than after, for readability 
purposes.  (In interfaces, it's fine to put the comments/meta-data after 
the function declaration, since the prototype is short enough.)


[^^backend ensure_inlining]
let foobar x l =
   ...

But I'm not sure it is worth creating more syntax only for that case.

What do you think?

Unless someone objects to it, I'll remove the prefix syntax.



An alternative solution to the case above (which we can implement later) 
could be to keep the standard syntax for postfix [@...] attributes and 
allow to put the attribute on the function name and/or on the let keyword:

    let foobar [@backend ensure_inlining] x l =
       ...

    or:

    let[@backend ensure_inlining] foobar x l =
       ...

which could be represented as:

    let foobar = ((fun x l -> ...) [@backend ensure_inlining])
    (the attribute is on the function expression)

    or:

    let (foobar [@backend ensure_inlining]) = fun x l -> ...
    (the attribute is on the pattern)




Alain

From alain.frisch@lexifi.com  Thu Mar  7 14:25:27 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 790ED3C568
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Mar 2013 14:25:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1453215 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:59423
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UDbrK-00030s-Xs (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 07 Mar 2013 14:31:50 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d52 with ME
 id 8eXp1l00F4U5yvJ03eXqwQ; Thu, 07 Mar 2013 15:31:50 +0100
Message-ID: <5138A4D7.5040804@lexifi.com>
Date: Thu, 07 Mar 2013 15:31:51 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
In-Reply-To: <513858DD.6040705@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] Request for feedback (was: A new branch to experiment
 with extension points)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Mar 2013 14:25:27 -0000

On 03/07/2013 10:07 AM, Alain Frisch wrote:
> Unless someone objects to it, I'll remove the prefix syntax.

Done!

I've also removed the special syntax [*id expr] for floating 
signature/structure item attributes.  Instead, they use the standard 
syntax for "item" attributes ([@@id expr]), recognized at the beginning 
of the whole signature/structure or after a ";;" token.   (I've also 
changed the grammar a little bit so that a signature/structure can start 
with a ";;" token and it is allowed to have two successive ";;" tokens. 
  This makes it possible to prefix any floating attribute [@@id expr] 
with ";;" and this will work in any context.)

With these simplifications, we've reduced the number of different 
syntaxes for attributes from 5 to 2.

Sorry for all those repeated changes, and thanks to those who can follow 
and comment :-)  I think I'm now pretty happy with the current 
implementation,  and I'd really like to get feedback on the current 
syntactic choices, in particular on the following points, where at least 
someone objected to the current choice:

- Gabriel mentioned that he would prefer more symmetric delimiters (e.g. 
[@ ... @] and not [@ ... ]).  I'd personally prefer something lighter, 
and I've argued that ocamldoc comments are already non symmetric.

- Leo did not seem convinced by the need for floating 
signature/structure items.  I've given the example of ocamldoc section 
headers.

- Leo expressed some preference for a more alphanumeric syntax for item 
attributes (... with ...).  I prefer to have a more similar syntax for 
all kinds of attributes.

(Did I forget any other discussed point about the syntax?)

There is also the question of how attributes are represented in the 
Parsetree, on which there was little discussion.  For instance, it could 
make sense to store attributes on expressions as an extra field of the 
expression record (next to pexp_desc, pexp_loc) instead of introducing a 
new constructor to expression_desc.  On the one hand, it would make it 
slighlty more complex to pattern match on a specific attribute (it could 
be anywhere in the list), but on the other hand it would make it simpler 
to detect a non-trivial Parsetree fragment for its structure modulo 
attributes.



Alain

From gabriel.scherer@gmail.com  Thu Mar  7 14:37:37 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BEF573C568
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Mar 2013 14:37:37 +0000 (GMT)
X-Cam-SpamDetails: score 0.2 from SpamAssassin-3.3.2-1453215 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.161.48 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  0.9 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-fa0-f48.google.com ([209.85.161.48]:44333)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UDc34-0005xh-8v (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 07 Mar 2013 14:43:59 +0000
Received: by mail-fa0-f48.google.com with SMTP id s1so21408fas.35
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Mar 2013 06:43:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=KzT4OD4jOQZXljdxBWLG8ursITz9YkyMx+N7n0FD73Q=;
 b=JqeEXmjQoX3daoG91eGNcRgFVFcvvq1EThoS4TBLmbdTtL5FI5Z3QKC9FdvdYl2Yq9
 mzjFQ3XXWyRkQiTy815xngqLCZBDCRFAUYyGnKQQT+ircboW53YPNom+0melTtOvtzBh
 G+gvdxYrdHzpCdJyBmNuluAGdFPTBEv3SPVJ9MxYdEwbyjwAnS2EOw/w6sE4esrLyh11
 lCDz6LyeAH2QijnvYzYNwCRKSVJNbbYIuH0/51l3xkDoI24k3Jj0XneWl7FG2ulWBAH/
 Se/rS1Moc0hqNdLWl+/nKiaBhsS3fcQ5H0dtKrYiuyf8zUP1jhjclFsZRFBHQFVNVln7
 P4og==
X-Received: by 10.204.8.71 with SMTP id g7mr13185913bkg.118.1362667438221;
 Thu, 07 Mar 2013 06:43:58 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Thu, 7 Mar 2013 06:43:18 -0800 (PST)
In-Reply-To: <5138A4D7.5040804@lexifi.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 7 Mar 2013 15:43:18 +0100
Message-ID: <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback (was: A new branch to
 experiment with extension points)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Mar 2013 14:37:37 -0000

I think it would be useful to see concrete example use cases, to get a
better feel of the concrete syntax choices.

Could you go over some of the examples in
https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases
, and transcode the ones that are reachable through such annotations
in your current syntax?

(Feel free to create a new wiki page; otherwise I'll probably add it
myself as I did for
https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases-using-light-annotations
)

On Thu, Mar 7, 2013 at 3:31 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 03/07/2013 10:07 AM, Alain Frisch wrote:
>>
>> Unless someone objects to it, I'll remove the prefix syntax.
>
>
> Done!
>
> I've also removed the special syntax [*id expr] for floating
> signature/structure item attributes.  Instead, they use the standard syntax
> for "item" attributes ([@@id expr]), recognized at the beginning of the
> whole signature/structure or after a ";;" token.   (I've also changed the
> grammar a little bit so that a signature/structure can start with a ";;"
> token and it is allowed to have two successive ";;" tokens.  This makes it
> possible to prefix any floating attribute [@@id expr] with ";;" and this
> will work in any context.)
>
> With these simplifications, we've reduced the number of different syntaxes
> for attributes from 5 to 2.
>
> Sorry for all those repeated changes, and thanks to those who can follow and
> comment :-)  I think I'm now pretty happy with the current implementation,
> and I'd really like to get feedback on the current syntactic choices, in
> particular on the following points, where at least someone objected to the
> current choice:
>
> - Gabriel mentioned that he would prefer more symmetric delimiters (e.g. [@
> ... @] and not [@ ... ]).  I'd personally prefer something lighter, and I've
> argued that ocamldoc comments are already non symmetric.
>
> - Leo did not seem convinced by the need for floating signature/structure
> items.  I've given the example of ocamldoc section headers.
>
> - Leo expressed some preference for a more alphanumeric syntax for item
> attributes (... with ...).  I prefer to have a more similar syntax for all
> kinds of attributes.
>
> (Did I forget any other discussed point about the syntax?)
>
> There is also the question of how attributes are represented in the
> Parsetree, on which there was little discussion.  For instance, it could
> make sense to store attributes on expressions as an extra field of the
> expression record (next to pexp_desc, pexp_loc) instead of introducing a new
> constructor to expression_desc.  On the one hand, it would make it slighlty
> more complex to pattern match on a specific attribute (it could be anywhere
> in the list), but on the other hand it would make it simpler to detect a
> non-trivial Parsetree fragment for its structure modulo attributes.
>
>
>
> Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From alain.frisch@lexifi.com  Thu Mar  7 15:26:10 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4A43C3C568
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Mar 2013 15:26:10 +0000 (GMT)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1453215 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:54411
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UDco4-0004Z5-9f (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 07 Mar 2013 15:32:33 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d52 with ME
 id 8fYR1l00U4U5yvJ03fYUJg; Thu, 07 Mar 2013 16:32:32 +0100
Message-ID: <5138B308.5080301@lexifi.com>
Date: Thu, 07 Mar 2013 16:32:24 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
In-Reply-To: <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Mar 2013 15:26:10 -0000

On 03/07/2013 03:43 PM, Gabriel Scherer wrote:
> I think it would be useful to see concrete example use cases, to get a
> better feel of the concrete syntax choices.
>
> Could you go over some of the examples in
> https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases
> , and transcode the ones that are reachable through such annotations
> in your current syntax?

Good suggestion.  I've committed a list of examples at the end of:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/extension_points.txt?view=markup


As a small change, the "id" of attributes and extension nodes can now be 
uppercase identifiers (and later, keywords will also be accepted). 
Should we accept qualified identifiers as well?

Alain

From gabriel.scherer@gmail.com  Thu Mar  7 16:17:47 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E971C3C568
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Mar 2013 16:17:47 +0000 (GMT)
X-Cam-SpamDetails: score 0.2 from SpamAssassin-3.3.2-1453215 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.47 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  0.9 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f47.google.com ([209.85.214.47]:40355)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UDdc1-000520-8d (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 07 Mar 2013 16:24:10 +0000
Received: by mail-bk0-f47.google.com with SMTP id jc3so299048bkc.20
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Mar 2013 08:24:09 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=YPGXKd3xrHIuR276Ljb5bQ4OKHmUVhtY825NKOD8lR0=;
 b=N0Zx/VgfMyHf9zKgmVXCJhYTahcVPDHu9lyPUIRYxlmKJg8/ekp5Ro9una7y2dNGs2
 b2Dv1fMO7SFxqKZ87WBQnTNV/43K22QoJkO9SgjHUHZ6zlTYnpyhPdOMfLye+jt8tG38
 w+4gy73dQjvKAp4xf8keBwTwxn3awyHlQhyK7bwhms9XvRHTm4gHIfUG20Zmcg/vVIzJ
 YMZb6wS8wFEwlf4kFs/Qqc98RKEBnFaD4WZkWJBE1SvasWQYJdYc2hdu7ayybmRXaP5/
 5rGolX3zx6H9mYinju6v/g16DPLHgfCeoUZ4NT7/ksME7j3zN2fqVCf0g/K3igLIO3R6
 QMrA==
X-Received: by 10.204.129.16 with SMTP id m16mr13427746bks.103.1362673449276; 
 Thu, 07 Mar 2013 08:24:09 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Thu, 7 Mar 2013 08:23:29 -0800 (PST)
In-Reply-To: <5138B308.5080301@lexifi.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 7 Mar 2013 17:23:29 +0100
Message-ID: <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Mar 2013 16:17:48 -0000

I understood the syntactic constructs, but it really help to see them
used in realistic cases.
I actually find those examples quite impressive:
- the [@lwt] ones are good because you managed to give a clean
semantics to the relevant syntactic exceptions.
- I didn't except the quotation-using ones to work that well either

I'm wondering how much I should trust them :p Have you actually tried
to parse the most daring ones with your parser? If you have a
testsuite, it may be interesting to add them to it.

While I admire the cleverness of using the fact that attributes are
OCaml syntax to get the "quotation" use cases for free, it also gives
me mixed feelings:
- I'm not sure how robust it is to future design changes
- For multi-line quotations, I would appreciate a slightly more
explicit syntax (possibly the symmetric delimiter to help users see
where the quotation end).

No precise idea on this front, but that's still something to think about.

On Thu, Mar 7, 2013 at 4:32 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 03/07/2013 03:43 PM, Gabriel Scherer wrote:
>>
>> I think it would be useful to see concrete example use cases, to get a
>> better feel of the concrete syntax choices.
>>
>> Could you go over some of the examples in
>> https://github.com/gasche/ocaml-syntax-extension-discussion/wiki/Use-Cases
>> , and transcode the ones that are reachable through such annotations
>> in your current syntax?
>
>
> Good suggestion.  I've committed a list of examples at the end of:
>
> http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/extension_points.txt?view=markup
>
>
> As a small change, the "id" of attributes and extension nodes can now be
> uppercase identifiers (and later, keywords will also be accepted). Should we
> accept qualified identifiers as well?
>
> Alain

From alain.frisch@lexifi.com  Thu Mar  7 16:48:49 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4F97E3C568
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Mar 2013 16:48:49 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1453215 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:39084
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UDe64-0005iQ-Rv (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 07 Mar 2013 16:55:13 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d52 with ME
 id 8gvC1l0034U5yvJ03gvCPn; Thu, 07 Mar 2013 17:55:12 +0100
Message-ID: <5138C672.3030504@lexifi.com>
Date: Thu, 07 Mar 2013 17:55:14 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
In-Reply-To: <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Mar 2013 16:48:49 -0000

On 03/07/2013 05:23 PM, Gabriel Scherer wrote:
> I'm wondering how much I should trust them :p Have you actually tried
> to parse the most daring ones with your parser? If you have a
> testsuite, it may be interesting to add them to it.

Yes, I've tried most of them.  Most of them work. A few number are 
rejected, but only because more work is needed on the parser (e.g. 
for[@id] is not yet supported, even though it would have taken less time 
to add support than to write this sentence; and class expressions do not 
yet support extension nodes).

> While I admire the cleverness of using the fact that attributes are
> OCaml syntax to get the "quotation" use cases for free, it also gives
> me mixed feelings:
> - I'm not sure how robust it is to future design changes

It is true that there could be some discontinuity: at some point, you 
can shoehorn your "DSL" in the syntax of OCaml expressions, but when you 
extend it, you might not find a nice way to continue doing so and you 
might be forced to switch to a very different embedding.  I don't 
believe that this will be a serious problem in practice, in particular 
because one can always use an extension node with a string literal 
content  in order to use custom concrete syntax locally in most 
syntactic categories (or directly a string if the category accept it, 
i.e. expressions and patterns).  As an example, let's have a look at the 
bitstring example:

let bits = Bitstring.bitstring_of_file "/bin/ls" in
[%bit match bits with
| [ 0x7f, 8; "ELF", 24, string;  (* ELF magic number *)
     e_ident, Mul(12,8), bitstring;    (* ELF identifier *)
     e_type, 16, littleendian;    (* object file type *)
     e_machine, 16, littleendian  (* architecture *)
   ] ->
   printf "This is an ELF binary, type %d, arch %d\n"
     e_type e_machine
]

One can imagine that in an early version, the size field could only be 
specified as an int literal.  When the author decides to let his users 
write "12*8", he can decide between:

  - Creating some "DSL" to describe those formulas, with a syntax 
compatible with patterns, as I did in the example above (Mul(12, 8))

   e_ident, Mul(12,8), bitstring;    (* ELF identifier *)

  - Using a string to represent the formula (but then one must create a 
new parser... or call the OCaml parser!):

   e_ident, "12 * 8", bitstring;

  - Using an extension node to allow injecting an expression without 
requiring a parser:

   e_ident, [%sz 12 * 8], bitstring;

   (Here we don't care about the "id" of the extension node.  It is 
worth creating a syntax for name-less extension nodes?)



> - For multi-line quotations, I would appreciate a slightly more
> explicit syntax (possibly the symmetric delimiter to help users see
> where the quotation end).

Do you mean:

[%bit ... %bit]
or:
[%bit ... bit%]
or:
[%bit ... %]

or something else?

Note than one can also write:

begin[@bit]
....
end

The only difference is that if we compile without the "bitstring 
expander", we will probably get a type-error which might be a little 
harder to understand.  I was thinking about supporting:

begin[%bit]
....
end

as an equivalent to:

[%bit ....]

but this would be ambiguous (function appliction with [%bit] in function 
position).


Alain

From gabriel.scherer@gmail.com  Thu Mar  7 17:01:36 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9200A3C568
 for <wg-camlp4@lists.ocaml.org>; Thu,  7 Mar 2013 17:01:36 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1453215 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.161.41 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-fa0-f41.google.com ([209.85.161.41]:55744)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UDeIR-0004aM-XY (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 07 Mar 2013 17:08:00 +0000
Received: by mail-fa0-f41.google.com with SMTP id p1so39745fad.0
 for <wg-camlp4@lists.ocaml.org>; Thu, 07 Mar 2013 09:07:59 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=0Me6SwMk8WpEPtvVezKkwfXBxmYj6yVKlEl+lILTkoM=;
 b=gt52oH71Nn1SA2ajN3iuiZ7wn/9AVn2BV1viS0Q2dL3CKyvasDBP7wzN8kgWxREb7J
 FQcvn6S2syLt1iORcox2MXpnEOIzZjcHhKs/nBURtHrY8NhCMTKZTHUAdnAJCIWFvRd/
 EI7TBaa9s+kfKbgbVqKzaqPTpiPtob8sKskXw6xhICLz7DPoRGNpILWO4VOTUsL31Qn3
 unveWzl+TZOua8jlawRzHZL5nFx5s74Xje99iRESQnJXYSbS6H2Kb9aaGNYcAqzZ76Ot
 W8UDmXOkI1SfVZ1X2QRdSzcjzAR8RgxN+UrKE6ZU1jR6rwfc7kAIzVkP7Gi1gyKpeNUz
 vYXg==
X-Received: by 10.204.9.16 with SMTP id j16mr13489901bkj.53.1362676078874;
 Thu, 07 Mar 2013 09:07:58 -0800 (PST)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Thu, 7 Mar 2013 09:07:18 -0800 (PST)
In-Reply-To: <5138C672.3030504@lexifi.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 7 Mar 2013 18:07:18 +0100
Message-ID: <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 07 Mar 2013 17:01:36 -0000

> It is true that there could be some discontinuity: at some point, you can
> shoehorn your "DSL" in the syntax of OCaml expressions, but when you extend
> it, you might not find a nice way to continue doing so and you might be
> forced to switch to a very different embedding.

I was thinking of changes to the extension mechanism itself. There
have been sparse but regular calls to a more structured representation
of annotations (eg. using a few literal categories to do some form of
structure-checking uniformly on all annotations), and if we found out
in the future we really want that, that could be disruptive to
existing quotation usages. In the discussion you suggested a dedicated
{{...}} syntax for quotations, something like that seems less likely
to want to evolve and forbid previous precious use cases.

(Don't jump implementing {{...}} yet! There are equally compelling
reasons to limit the number of new concepts and appreciate the
expressivity of the core you have, so it's more thinking out loud
about possible arguments and counter-arguments.)

> Do you mean:
>
> [%bit ... %bit]
> or:
> [%bit ... bit%]
> or:
> [%bit ... %]
>
> or something else?

I was thinking of [%bit ... %]. On the other hand, it's not clear we
would want to have two syntaxes, one for "short annotations" and one
for "long annotations", while one suffices semantically. Also, for
extensions that are really quotations, that is of the form

  [%name
     ...long expr...
  ]

we could use the following pattern by convention

[%name(
   ... long expr ...
)]

or even

[%name begin
   ... long expr ...
end]


In a perfect world, I would dream of a long-syntax with symmetric
delimiters [% foo bar %], and a short-syntax *without delimiters*
reserved to the specific cases where the extension is attached to a
keyword: for%lwt, let%monad, etc., so we can have both convenient
short-scale marks and readable, structured, symmetric larger-scale
delimiters. However, non-delimited syntaxes such as for%lwt open a new
parsing can of worms, so it's reasonable to choose [% foo bar ] as an
awkward compromise that is not too painful at small scale, even if
maybe not optimal at large scale.


On Thu, Mar 7, 2013 at 5:55 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 03/07/2013 05:23 PM, Gabriel Scherer wrote:
>>
>> I'm wondering how much I should trust them :p Have you actually tried
>> to parse the most daring ones with your parser? If you have a
>> testsuite, it may be interesting to add them to it.
>
>
> Yes, I've tried most of them.  Most of them work. A few number are rejected,
> but only because more work is needed on the parser (e.g. for[@id] is not yet
> supported, even though it would have taken less time to add support than to
> write this sentence; and class expressions do not yet support extension
> nodes).
>
>
>> While I admire the cleverness of using the fact that attributes are
>> OCaml syntax to get the "quotation" use cases for free, it also gives
>> me mixed feelings:
>> - I'm not sure how robust it is to future design changes
>
>
> It is true that there could be some discontinuity: at some point, you can
> shoehorn your "DSL" in the syntax of OCaml expressions, but when you extend
> it, you might not find a nice way to continue doing so and you might be
> forced to switch to a very different embedding.  I don't believe that this
> will be a serious problem in practice, in particular because one can always
> use an extension node with a string literal content  in order to use custom
> concrete syntax locally in most syntactic categories (or directly a string
> if the category accept it, i.e. expressions and patterns).  As an example,
> let's have a look at the bitstring example:
>
> let bits = Bitstring.bitstring_of_file "/bin/ls" in
> [%bit match bits with
> | [ 0x7f, 8; "ELF", 24, string;  (* ELF magic number *)
>     e_ident, Mul(12,8), bitstring;    (* ELF identifier *)
>     e_type, 16, littleendian;    (* object file type *)
>     e_machine, 16, littleendian  (* architecture *)
>   ] ->
>   printf "This is an ELF binary, type %d, arch %d\n"
>     e_type e_machine
> ]
>
> One can imagine that in an early version, the size field could only be
> specified as an int literal.  When the author decides to let his users write
> "12*8", he can decide between:
>
>  - Creating some "DSL" to describe those formulas, with a syntax compatible
> with patterns, as I did in the example above (Mul(12, 8))
>
>   e_ident, Mul(12,8), bitstring;    (* ELF identifier *)
>
>  - Using a string to represent the formula (but then one must create a new
> parser... or call the OCaml parser!):
>
>   e_ident, "12 * 8", bitstring;
>
>  - Using an extension node to allow injecting an expression without
> requiring a parser:
>
>   e_ident, [%sz 12 * 8], bitstring;
>
>   (Here we don't care about the "id" of the extension node.  It is worth
> creating a syntax for name-less extension nodes?)
>
>
>
>
>> - For multi-line quotations, I would appreciate a slightly more
>> explicit syntax (possibly the symmetric delimiter to help users see
>> where the quotation end).
>
>
> Do you mean:
>
> [%bit ... %bit]
> or:
> [%bit ... bit%]
> or:
> [%bit ... %]
>
> or something else?
>
> Note than one can also write:
>
> begin[@bit]
> ....
> end
>
> The only difference is that if we compile without the "bitstring expander",
> we will probably get a type-error which might be a little harder to
> understand.  I was thinking about supporting:
>
> begin[%bit]
> ....
> end
>
> as an equivalent to:
>
> [%bit ....]
>
> but this would be ambiguous (function appliction with [%bit] in function
> position).
>
>
> Alain

From alain.frisch@lexifi.com  Fri Mar  8 08:13:00 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D2D4A3C56D
 for <wg-camlp4@lists.ocaml.org>; Fri,  8 Mar 2013 08:13:00 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1453735 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:20460
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UDsWU-0000ku-Qx (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 08 Mar 2013 08:19:26 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d03 with ME
 id 8wKR1l00B4U5yvJ03wKRmA; Fri, 08 Mar 2013 09:19:25 +0100
Message-ID: <51399F14.4080500@lexifi.com>
Date: Fri, 08 Mar 2013 09:19:32 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: David Waern <david.waern@gmail.com>, 
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
References: <51375A74.5090304@lexifi.com>
 <CAN8ZjBHCu20dbMkU1-ta-FNyTtNg_6pzef=tVV3M5zuDjouZUg@mail.gmail.com>
In-Reply-To: <CAN8ZjBHCu20dbMkU1-ta-FNyTtNg_6pzef=tVV3M5zuDjouZUg@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] A new branch to experiment with extension points
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 08 Mar 2013 08:13:00 -0000

On 03/08/2013 12:01 AM, David Waern wrote:
> Would it be a crazy idea to replace expr by seq_expr in attributes and
> extensions? That would allow a more light-weight monadic notation:
>
> [%do a; b; c <-- d; f c; ...]

This is an excellent idea!  It is now committed.

Thanks for suggestion,

Alain

> which could be useful where begin[%monad] ... end would be too verbose,
> typically when embedding small fragments of monadic code inside
> non-monadic code.
>
> I think it's nice to make overloading the semi-colon light-weight (this
> way, without needing parentheses) for other use-cases as well (e.g
> literals for custom list types).
>
> Or does this cause any problems that I've overlooked?


From alain.frisch@lexifi.com  Fri Mar  8 09:12:44 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3FAFC3C07C
 for <wg-camlp4@lists.ocaml.org>; Fri,  8 Mar 2013 09:12:44 +0000 (GMT)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1453735 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:17847
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UDtSG-00085c-9H (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 08 Mar 2013 09:19:10 +0000
Received: from [192.168.1.120] ([86.195.25.207]) by mwinf5d03 with ME
 id 8xK81l00C4U5yvJ03xK8S0; Fri, 08 Mar 2013 10:19:08 +0100
Message-ID: <5139AD13.8050304@lexifi.com>
Date: Fri, 08 Mar 2013 10:19:15 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130215 Thunderbird/17.0.3
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
 <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
In-Reply-To: <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 08 Mar 2013 09:12:44 -0000

I've generalized the "attribute on the opening keyword" form to all 
kinds of expressions starting with a keyword, a sequence of keywords 
(let open, let module), and even delimiters.  In the same way that we 
can write:

   let[@id arg] p = e1 in e2

for:

   (let p = e1 in e2)[@id arg]

we can also write:

   ((@id arg) expr)

which is equivalent to:

   (expr (@id arg))

(We see the first form as an attribute of the opening delimiter of the 
construction "(expr)".)

I think it is nice to be able to use the same syntax and essentially get 
prefix attributes as well.  Do you guy agree?  Or do you believe that 
this creates too much confusion?


On 03/07/2013 06:07 PM, Gabriel Scherer wrote:
> However, non-delimited syntaxes such as for%lwt open a new
> parsing can of worms

Actually, I believe this works quite well, and I'm playing with the idea 
that this could be the (only) syntax for extension nodes.

We could actually extend the idea above of putting attributes on opening 
keywords/delimiters to support also an optional extension identifier. 
For instance:

   let%foo p = e1 in e2

would be equivalent to:

   [%foo let p = e1 in e2]

Doing that for the "lwt" example would not only give a more compact 
syntax, but also make use of extensions instead of attributes, which can 
be preferred in that case (so that the compiler fails cleanly if we 
don't compile with "-ppx lwt" instead of giving weird error messages).


The "bitstring" example could then be written:

match%bit bits with ...

instead of

[%bit match bits with ...]



And if we do the same for the parenthesized expressions, we could write:

  (%foo expr)

which would be equivalent to:

  [%foo expr]

At this point, if we do that, it makes little sense to keep the original 
form for extensions ([%id expr]), and we could use (%id expr) instead, 
for all categories (not only expressions).

What do you think?


Alain

From lpw25@cam.ac.uk  Wed Mar 13 17:24:13 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6AF563C170
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Mar 2013 17:24:13 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:33760)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UFpVw-00048t-se (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Wed, 13 Mar 2013 17:30:56 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
 <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
 <5139AD13.8050304@lexifi.com>
Date: Wed, 13 Mar 2013 17:30:56 +0000
In-Reply-To: <5139AD13.8050304@lexifi.com> (Alain Frisch's message of "Fri, 08
 Mar 2013 10:19:15 +0100")
Message-ID: <87hakf6wbz.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Mar 2013 17:24:13 -0000

Alain Frisch <alain.frisch@lexifi.com> writes:

> I've generalized the "attribute on the opening keyword" form to all kinds of expressions starting with a keyword, a
> sequence of keywords (let open, let module), and even delimiters.  In the same way that we can write:
>
>   let[@id arg] p = e1 in e2
>
> for:
>
>   (let p = e1 in e2)[@id arg]

That seems reasonable.
>
> we can also write:
>
>   ((@id arg) expr)
>
> which is equivalent to:
>
>   (expr (@id arg))

As long as you meant

    ([@id arg] expr)

then this is also a good idea.

> On 03/07/2013 06:07 PM, Gabriel Scherer wrote:
>> However, non-delimited syntaxes such as for%lwt open a new
>> parsing can of worms
>
> Actually, I believe this works quite well, and I'm playing with the idea that this could be the (only) syntax for
> extension nodes.

I have to agree with Gabriel here, these things are a pain to get
right. If you don't handle it in the lexer then you allow things like:

   let% lwt x =  (* defining a lwt function? *) 

or

  let % lwt x = (* defining the % operator? *)

which is definitly undesirable. It also allows comments and newlines to
be inserted in awkward places.

This means that you must lex "let%lwt" as a single token which can be a
bit awkward. It is probably ok for a few specific cases, but expanding
it to all keywords is asking for trouble.

> And if we do the same for the parenthesized expressions, we could write:
>
>  (%foo expr)
>
> which would be equivalent to:
>
>  [%foo expr]
>

I don't think this is a good idea because you are parsing '%' as a
strange prefix operator, so that all of the following are allowed:

(% foo expr) ( %foo expr ) ( % foo expr )

((* hello world*)%
  foo expr
)

this is probably a bad idea, and disagrees with how every other two
character delimiter in OCaml is parsed.

And lexing '(%' as single token conflicts with other places in the
grammar.


From alain.frisch@lexifi.com  Wed Mar 13 17:42:52 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 61B183C170
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Mar 2013 17:42:52 +0000 (GMT)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1455441 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:51985
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UFpnh-0001Jg-6h (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 13 Mar 2013 17:49:36 +0000
Received: from [192.168.1.120] ([92.151.28.8]) by mwinf5d60 with ME
 id B5pG1l0070AW3BQ035pGcm; Wed, 13 Mar 2013 18:49:16 +0100
Message-ID: <5140BC1D.3060703@lexifi.com>
Date: Wed, 13 Mar 2013 18:49:17 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130307 Thunderbird/17.0.4
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
 <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
 <5139AD13.8050304@lexifi.com> <87hakf6wbz.fsf@kingston.cl.cam.ac.uk>
In-Reply-To: <87hakf6wbz.fsf@kingston.cl.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Mar 2013 17:42:52 -0000

On 03/13/2013 06:30 PM, Leo White wrote:
>> we can also write:
>>
>>    ((@id arg) expr)
>>
>> which is equivalent to:
>>
>>    (expr (@id arg))
>
> As long as you meant
>
>      ([@id arg] expr)
>
> then this is also a good idea.

No, I really meant (expr (@id arg)).

It is really the same as:

begin[@id arg] ... end

being equivalent to:

... [@id arg]

i.e. putting the attribute on the opening keyword (here the opening 
parenthesis being considered as the opening keyword).

> I have to agree with Gabriel here, these things are a pain to get
> right. If you don't handle it in the lexer then you allow things like:
>
>     let% lwt x =  (* defining a lwt function? *)
>
> or
>
>    let % lwt x = (* defining the % operator? *)
>
> which is definitly undesirable. It also allows comments and newlines to
> be inserted in awkward places.

I can see that there is a possibility to write awkward code, but I don't 
think people would actually do it.  We can try to find a better syntax, 
but I would find it sad to pick something more heavy only because the 
light syntax could theoretically allow people to write confusing code.

I don't see "let % lwt" as a worst kind of code than:

   let (* oh, you really believe I'm going to define a local value here ?
   Wait a minute ...*)

   open List

   (* and now you think this is a global open statement *)

   in
   ...


> This means that you must lex "let%lwt" as a single token which can be a
> bit awkward. It is probably ok for a few specific cases, but expanding
> it to all keywords is asking for trouble.

If we go this way (and as said I'm not convinced this is required) this 
would only be necessary for the keywords used as the first token of 
expressions (e.g. not "in", "with", "to" for instance).  And we could 
limit ourselves to the most useful ones only.


> I don't think this is a good idea because you are parsing '%' as a
> strange prefix operator, so that all of the following are allowed:
>
> (% foo expr) ( %foo expr ) ( % foo expr )
>
> ((* hello world*)%
>    foo expr
> )

Again, we can try to fix that in the lexer/parser, or just publicize the 
"good style".  I don't think that the grammar is supposed to prevent 
people from writing un-readable code, just to allow and encourage them 
to write good one.


Alain

From lpw25@cam.ac.uk  Wed Mar 13 21:25:06 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 120103C170
 for <wg-camlp4@lists.ocaml.org>; Wed, 13 Mar 2013 21:25:06 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from cpc2-cmbg14-2-0-cust33.5-4.cable.virginmedia.com
 ([86.26.0.34]:35965 helo=netbook)
 by ppsw-42.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1UFtH4-00049G-6n (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@cam.ac.uk>); Wed, 13 Mar 2013 21:31:50 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
 <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
 <5139AD13.8050304@lexifi.com> <87hakf6wbz.fsf@kingston.cl.cam.ac.uk>
 <5140BC1D.3060703@lexifi.com>
Date: Wed, 13 Mar 2013 21:32:22 +0000
In-Reply-To: <5140BC1D.3060703@lexifi.com> (Alain Frisch's message of "Wed, 13
 Mar 2013 18:49:17 +0100")
Message-ID: <86fvzzgf4p.fsf@cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 13 Mar 2013 21:25:06 -0000

>>> we can also write:
>>>
>>>    ((@id arg) expr)
>>>
>>> which is equivalent to:
>>>
>>>    (expr (@id arg))
>>
>> As long as you meant
>>
>>      ([@id arg] expr)
>>
>> then this is also a good idea.
>
> No, I really meant (expr (@id arg)).
>

Sorry, what i meant was that it should be ([@id arg] expr) instead of
((@arg) expr). In other words, it should be square brackets like the
other attributes.

>
> I can see that there is a possibility to write awkward code, but I don't think people would actually do it.  We can try
> to find a better syntax, but I would find it sad to pick something more heavy only because the light syntax could
> theoretically allow people to write confusing code.
>
> I don't see "let % lwt" as a worst kind of code than: ...

I do think that 

  let % lwt x = ...

is potentially confusing. Maybe it would be better as

  let . lwt x = ...

since people nearly always write dots without spaces, and a dot
obviously can't be an operator. Another posibility would be

  let .% lwt x = ...

It does seems like we're going from having a single extension syntax to
having many extension syntaxes. I can see the benefit of "let % lwt"
since that will probably be a common extension point (the same goes for
"match % bit") but is there much to be gained from the other possible
keyword extensions. The [%foo expr] syntax provides a clear indication
of which parts are an extension, that is less clear for some other
constructs.

>> I don't think this is a good idea because you are parsing '%' as a
>> strange prefix operator, so that all of the following are allowed:
>>
>> (% foo expr) ( %foo expr ) ( % foo expr )
>>
>> ((* hello world*)%
>>    foo expr
>> )
>
> Again, we can try to fix that in the lexer/parser, or just publicize the "good style".  I don't think that the grammar
> is supposed to prevent people from writing un-readable code, just to allow and encourage them to write good one.

While "let % lwt" may be alright, I do think that

( % id expr )

is a bad idea. It looks too much like a prefix operator. Also, having a
two character delimiter that isn't a single token is different from
every other two character delimiter in the langauge. It also means that
you can't use precedence to resolve conflicts in the parser. Is there
any real benefit in using (%id expr) instead of [%id expr]?

From alain.frisch@lexifi.com  Thu Mar 14 08:28:04 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id ED6733CBD2
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Mar 2013 08:28:03 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1455841 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:33110
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UG3cd-0007B6-sa (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 14 Mar 2013 08:34:49 +0000
Received: from [192.168.1.120] ([92.151.28.8]) by mwinf5d22 with ME
 id BLan1l00D0AW3BQ03Lanwr; Thu, 14 Mar 2013 09:34:47 +0100
Message-ID: <51418BA7.2030305@lexifi.com>
Date: Thu, 14 Mar 2013 09:34:47 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130307 Thunderbird/17.0.4
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
 <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
 <5139AD13.8050304@lexifi.com> <87hakf6wbz.fsf@kingston.cl.cam.ac.uk>
 <5140BC1D.3060703@lexifi.com> <86fvzzgf4p.fsf@cam.ac.uk>
In-Reply-To: <86fvzzgf4p.fsf@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 14 Mar 2013 08:28:04 -0000

On 03/13/2013 10:32 PM, Leo White wrote:
> Sorry, what i meant was that it should be ([@id arg] expr) instead of
> ((@arg) expr). In other words, it should be square brackets like the
> other attributes.

Oh yes, sorry, of course.

> I do think that
>
>    let % lwt x = ...
>
> is potentially confusing. Maybe it would be better as
>
>    let . lwt x = ...
>
> since people nearly always write dots without spaces, and a dot
> obviously can't be an operator.

If people see examples written "let%lwt", they will probably do the 
same, don't you think?   "%" does not seem very common in OCaml code; I 
don't think people already have "bad habits" about it.  And if people 
insist to write "let % lwt", it will be because they believe it somehow 
better.

I'm not very fond of "let.lwt".  The dot symbol has already so many 
different uses in OCaml...  At least "%" is quite rare and will thus be 
clearly noticed as an extension.

> Another posibility would be
>
>    let .% lwt x = ...

Do you believe it is worth making the syntax more heavy only to 
discourage (and not even prevent) people from potentially writing code 
with a style we don't like?

> It does seems like we're going from having a single extension syntax to
> having many extension syntaxes. I can see the benefit of "let % lwt"
> since that will probably be a common extension point (the same goes for
> "match % bit") but is there much to be gained from the other possible
> keyword extensions.

function%ext and try%ext are also probably useful.

And I can imagine examples where {%ext x1=e1; ...; xn=en} would be 
useful as well (see the "pre-polyrecord" example).

At this point, why not be uniform, and do the same for all kinds of 
expressions starting with a well-defined keyword or symbol, including 
the parenthesized expressions "begin%ext expr end" and "(%ext expr)". 
For other syntactic categories than expressions, this last form would be 
recognized (as the only syntax for extensions), instead of "[%ext 
expr]".  There is a single syntax.

> While "let % lwt" may be alright, I do think that
>
> ( % id expr )
>
> is a bad idea. It looks too much like a prefix operator. Also, having a
> two character delimiter that isn't a single token is different from
> every other two character delimiter in the langauge. It also means that
> you can't use precedence to resolve conflicts in the parser. Is there
> any real benefit in using (%id expr) instead of [%id expr]?

The benefit I can see is the uniformity with other forms of expressions:

    KW%id ...

where KW is the opening keyword/symbol (here "(") and ... the rest of 
the construction starting with KW.


Alain

From lpw25@cam.ac.uk  Thu Mar 14 10:53:16 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D1AD13CBFB
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Mar 2013 10:53:16 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:51814)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UG5tC-0004xt-sG (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Thu, 14 Mar 2013 11:00:02 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
 <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
 <5139AD13.8050304@lexifi.com> <87hakf6wbz.fsf@kingston.cl.cam.ac.uk>
 <5140BC1D.3060703@lexifi.com> <86fvzzgf4p.fsf@cam.ac.uk>
 <51418BA7.2030305@lexifi.com>
Date: Thu, 14 Mar 2013 11:00:02 +0000
In-Reply-To: <51418BA7.2030305@lexifi.com> (Alain Frisch's message of "Thu, 14
 Mar 2013 09:34:47 +0100")
Message-ID: <878v5qtff1.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 14 Mar 2013 10:53:16 -0000

> If people see examples written "let%lwt", they will probably do the same, don't you think?   "%" does not seem very
> common in OCaml code; I don't think people already have "bad habits" about it.  And if people insist to write "let %
> lwt", it will be because they believe it somehow better.
>
> I'm not very fond of "let.lwt".  The dot symbol has already so many different uses in OCaml...  At least "%" is quite
> rare and will thus be clearly noticed as an extension.
>
>> Another posibility would be
>>
>>    let .% lwt x = ...
>
> Do you believe it is worth making the syntax more heavy only to discourage (and not even prevent) people from
> potentially writing code with a style we don't like?
>

To be honest I am (cautiously) ok with "let%lwt x = ...". 

>> It does seems like we're going from having a single extension syntax to
>> having many extension syntaxes. I can see the benefit of "let % lwt"
>> since that will probably be a common extension point (the same goes for
>> "match % bit") but is there much to be gained from the other possible
>> keyword extensions.
>
> function%ext and try%ext are also probably useful.

I'm much less sure about these other syntaxes. I think that

    [%bit match foo with
        bit-pattern -> ...
      | other-bit-pattern -> ...
    ]

makes it much more obvious that we are abusing the OCaml syntax within
an extension, which is important. It is also not much heavier than:

    match%bit foot with
      bit-pattern -> ...
    | other-bit-pattern -> ...

The same goes for function%ext and try%ext.

Note that for "let" the trade-off is potentially much worse:

[%lwt let x = .... in
  [%lwt let y = ... in
    [%lwt let z = ... in
       ...
    ]
  ]
]

vs.

let%lwt x = ... in
let%lwt y = ... in
let%lwt z = ... in
  ...

So while I think it is worth it for let, I'm much less sure about the
other constructs. I also think that it will be difficult to persuade the
OCaml developers to allow "KWD % id" all over the place.

> And I can imagine examples where {%ext x1=e1; ...; xn=en} would be useful as well (see the "pre-polyrecord" example).

[%ext x1=e1; ...; xn=en] would already be valid. Also, this might get in
the way of my proposed short quotation extension form: {%id { .... }}.

Which reminds me, at the very least, we must implement a {x{ ... }x}
quoting construct for quotation extensions.

>> While "let % lwt" may be alright, I do think that
>>
>> ( % id expr )
>>
>> is a bad idea. It looks too much like a prefix operator. Also, having a
>> two character delimiter that isn't a single token is different from
>> every other two character delimiter in the langauge. It also means that
>> you can't use precedence to resolve conflicts in the parser. Is there
>> any real benefit in using (%id expr) instead of [%id expr]?
>
> The benefit I can see is the uniformity with other forms of expressions:
>
>    KW%id ...
>
> where KW is the opening keyword/symbol (here "(") and ... the rest of the construction starting with KW.

I don't think there is any uniformity here, people do not think of
keywords and delimiters as equivalent, and do not expect them to behave
the same. They do expect all delimiters to behave the same, which is why
"( % id expr )" really should not be allowed.

From alain.frisch@lexifi.com  Thu Mar 14 11:27:19 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3BF353CBFB
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Mar 2013 11:27:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1455841 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:53441
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UG6Q8-00076d-ZO (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 14 Mar 2013 11:34:05 +0000
Received: from [192.168.1.120] ([92.151.28.8]) by mwinf5d22 with ME
 id BPa41l0020AW3BQ03Pa47Z; Thu, 14 Mar 2013 12:34:04 +0100
Message-ID: <5141B5AC.7090702@lexifi.com>
Date: Thu, 14 Mar 2013 12:34:04 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130307 Thunderbird/17.0.4
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
 <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
 <5139AD13.8050304@lexifi.com> <87hakf6wbz.fsf@kingston.cl.cam.ac.uk>
 <5140BC1D.3060703@lexifi.com> <86fvzzgf4p.fsf@cam.ac.uk>
 <51418BA7.2030305@lexifi.com> <878v5qtff1.fsf@kingston.cl.cam.ac.uk>
In-Reply-To: <878v5qtff1.fsf@kingston.cl.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 14 Mar 2013 11:27:19 -0000

On 03/14/2013 12:00 PM, Leo White wrote:
> To be honest I am (cautiously) ok with "let%lwt x = ...".

If we only support the special form for "let", I agree it would make 
sense to make "let%ext" a single token.

I don't have a strong opinion about it, but if we special-case the 
treatment of the "let" binding, maybe it is worth introducing a custom 
kind of extension point for this construction, like supporting an 
arbitrary sequence of symbol characters:

   [%%lwt let suffix = "**"]
   [%%lazy let suffix = "..."]

   ...
      let** x1 = e1 in
      let** x2 = e2 in
      ...
   ...
      let... rec x = button "X" ~click:(fun () -> y # set_text "X")
      and  y = button "Y" ~click:(fun () -> x # set_text "Y")
      in
      hbox [x; y]


> Note that for "let" the trade-off is potentially much worse:

It makes sense.

What do other people on the list think?

  - Should we support a compact syntax for extension nodes on all 
constructions starting with a keyword or delimiter (and if so, should 
this become the only syntax for extension nodes)?

  - If not, should be do it for the (local) let-binding only?  Or, if we 
special-case this construction, should we do something different for it 
altogether (arbitrary symbol characters)?



Alain

From gabriel.scherer@gmail.com  Thu Mar 14 16:51:23 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7C6443C548
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Mar 2013 16:51:23 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1455841 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.41 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f41.google.com ([209.85.214.41]:65395)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UGBTk-0000Tt-se (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 14 Mar 2013 16:58:10 +0000
Received: by mail-bk0-f41.google.com with SMTP id q16so1142823bkw.0
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Mar 2013 09:58:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=iIubewsrpt3OredBmrHGjJIknXmjEO5iarJlc7mDIss=;
 b=d+q5ADEWJrpAwY6D24nx4PUhRU5kBGRCZRPSv8b5TY6A+pNa9RInSjP76ANqA0YfTF
 ticIpJSlqrbe888bNLeef1NpVDtydJQqkWAL+CwfSjr7rm1rnO1L4OiN5BNEj/dotdeD
 UwHOTRyIQ35/vaX5ZNsldmKsx0BExDkq2aaRqYKi5ZW6OtZs0HL6Rw74ZhetrJpgiubQ
 Iiz3YWV1k3FhwubKAEsXKUrw8Bkht18Mx1IY/V6DyqZo/59fVNc/6B+Frqc2/tZqL1xo
 UKChChK/yd1ssQDf8oNo4uu+hEfs8iMEruTmpBhSWHhQjBjP+Cr5ikkqwUczmYouENba
 IF4Q==
X-Received: by 10.205.33.81 with SMTP id sn17mr1762398bkb.53.1363280288573;
 Thu, 14 Mar 2013 09:58:08 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Thu, 14 Mar 2013 09:57:27 -0700 (PDT)
In-Reply-To: <5141B5AC.7090702@lexifi.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
 <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
 <5139AD13.8050304@lexifi.com> <87hakf6wbz.fsf@kingston.cl.cam.ac.uk>
 <5140BC1D.3060703@lexifi.com> <86fvzzgf4p.fsf@cam.ac.uk>
 <51418BA7.2030305@lexifi.com>
 <878v5qtff1.fsf@kingston.cl.cam.ac.uk> <5141B5AC.7090702@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 14 Mar 2013 17:57:27 +0100
Message-ID: <CAPFanBHtio4eAf7g18bxzh+je-bNe=XQVykj4eVL96heV9rDJA@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 14 Mar 2013 16:51:23 -0000

> What do other people on the list think?
>
>  - Should we support a compact syntax for extension nodes on all
> constructions starting with a keyword or delimiter (and if so, should this
> become the only syntax for extension nodes)?
>
>  - If not, should be do it for the (local) let-binding only?  Or, if we
> special-case this construction, should we do something different for it
> altogether (arbitrary symbol characters)?

If we have a let%foo syntax, I think it's better to have it for all
constructions starting with a keyword than for an arbitrary subset of
them. I have no strong opinion on whether delimiters should be
included as well. That said, I appreciate the idea of having a single,
uniform way to put an annotation in any grammar class, that can be
introduced anywhere the keyword structure is not satisfying.

That said, I'm still a bit uncomfortable with translating (let%foo p =
e1 in e2) into [%foo let p = e1 in e2]. This amounts to injecting
arbitrary "Annot" node in the AST structure, and I'm worried about the
implementation consequences: the -bin-annot implementation showed than
adding new nodes in between is a bad idea when the compiler does
depth-higher-than-one pattern-matching to spot optimization
opportunities. I'm wondering whether all such extensibility data could
have a more second-class place in the AST structure, as the location
fields have today (they're attached to each "real AST node", not a
node of their own), orthogonally to the distinction (to which I'm not
really attached in any case) between "stuff that it is legal to have
left after preprocessing and must be ignored" and "stuff that should
provoke a failure if left unattended".

On Thu, Mar 14, 2013 at 12:34 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 03/14/2013 12:00 PM, Leo White wrote:
>>
>> To be honest I am (cautiously) ok with "let%lwt x = ...".
>
>
> If we only support the special form for "let", I agree it would make sense
> to make "let%ext" a single token.
>
> I don't have a strong opinion about it, but if we special-case the treatment
> of the "let" binding, maybe it is worth introducing a custom kind of
> extension point for this construction, like supporting an arbitrary sequence
> of symbol characters:
>
>   [%%lwt let suffix = "**"]
>   [%%lazy let suffix = "..."]
>
>   ...
>      let** x1 = e1 in
>      let** x2 = e2 in
>      ...
>   ...
>      let... rec x = button "X" ~click:(fun () -> y # set_text "X")
>      and  y = button "Y" ~click:(fun () -> x # set_text "Y")
>      in
>      hbox [x; y]
>
>
>
>> Note that for "let" the trade-off is potentially much worse:
>
>
> It makes sense.
>
> What do other people on the list think?
>
>  - Should we support a compact syntax for extension nodes on all
> constructions starting with a keyword or delimiter (and if so, should this
> become the only syntax for extension nodes)?
>
>  - If not, should be do it for the (local) let-binding only?  Or, if we
> special-case this construction, should we do something different for it
> altogether (arbitrary symbol characters)?
>
>
>
> Alain

From lpw25@cam.ac.uk  Thu Mar 14 17:12:10 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6F3AD3C548
 for <wg-camlp4@lists.ocaml.org>; Thu, 14 Mar 2013 17:12:10 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:37813)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UGBnt-0002S3-WW (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Thu, 14 Mar 2013 17:18:57 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <1827966950.3050167.1362583066514.JavaMail.root@inria.fr>
 <513765F5.5020900@lexifi.com> <513858DD.6040705@lexifi.com>
 <5138A4D7.5040804@lexifi.com>
 <CAPFanBH1eZ-Uukhs2w2X1zPb=CjUpan85MOYnorBXFeFfM-01Q@mail.gmail.com>
 <5138B308.5080301@lexifi.com>
 <CAPFanBFvP6AjZzYOuBQB3JnE0JM7omud_LseF65LOcryzbGW=A@mail.gmail.com>
 <5138C672.3030504@lexifi.com>
 <CAPFanBFTvmCugwvom_fdhs-2W7BHuYpamWQpFH3AHG8WMoTyQA@mail.gmail.com>
 <5139AD13.8050304@lexifi.com> <87hakf6wbz.fsf@kingston.cl.cam.ac.uk>
 <5140BC1D.3060703@lexifi.com> <86fvzzgf4p.fsf@cam.ac.uk>
 <51418BA7.2030305@lexifi.com> <878v5qtff1.fsf@kingston.cl.cam.ac.uk>
 <5141B5AC.7090702@lexifi.com>
 <CAPFanBHtio4eAf7g18bxzh+je-bNe=XQVykj4eVL96heV9rDJA@mail.gmail.com>
Date: Thu, 14 Mar 2013 17:18:56 +0000
In-Reply-To: <CAPFanBHtio4eAf7g18bxzh+je-bNe=XQVykj4eVL96heV9rDJA@mail.gmail.com>
 (Gabriel Scherer's message of "Thu, 14 Mar 2013 17:57:27 +0100")
Message-ID: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 14 Mar 2013 17:12:10 -0000

> [...] I appreciate the idea of having a single,
> uniform way to put an annotation in any grammar class, that can be
> introduced anywhere the keyword structure is not satisfying.

I agree.

> That said, I'm still a bit uncomfortable with translating (let%foo p =
> e1 in e2) into [%foo let p = e1 in e2]. This amounts to injecting
> arbitrary "Annot" node in the AST structure, and I'm worried about the
> implementation consequences: the -bin-annot implementation showed than
> adding new nodes in between is a bad idea when the compiler does
> depth-higher-than-one pattern-matching to spot optimization
> opportunities. 

Since the extension nodes have to be compiled away by an AST transformer
before type-checking, there is no danger of them preventing an
optimisation. Attributes on the other hand could cause problems.

> I'm wondering whether all such extensibility data could
> have a more second-class place in the AST structure, as the location
> fields have today

I think that this is definitely the right way to go for attributes. For
extensions, I think it makes more sense to give them their own AST
node. The idea is that an extension used as an expression *is* an
expression, so it should be represented in the AST as such.

From alain.frisch@lexifi.com  Fri Mar 15 11:17:37 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7AA363CBDF
 for <wg-camlp4@lists.ocaml.org>; Fri, 15 Mar 2013 11:17:37 +0000 (GMT)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1456366 
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mta50.yaziba.net ([85.233.204.131]:47846)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UGSkM-0001l5-8N (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 15 Mar 2013 11:24:26 +0000
Received: from mta40.int.yaziba.net (unknown [10.4.20.33])
 by mta50.yaziba.net (Postfix) with ESMTP id F0A5020E62;
 Fri, 15 Mar 2013 12:24:25 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
 by mta40.int.yaziba.net (Postfix) with ESMTP id E9EC9CAC26;
 Fri, 15 Mar 2013 12:24:25 +0100 (CET)
X-Virus-Scanned: amavisd-new at 
Received: from mta40.int.yaziba.net ([127.0.0.1])
 by localhost (mta40.int.yaziba.net [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id BTKyEv3Bye8K; Fri, 15 Mar 2013 12:24:25 +0100 (CET)
Received: from mail20.int.yaziba.net (mail20.int.yaziba.net [10.4.20.52])
 by mta40.int.yaziba.net (Postfix) with ESMTP id D0235CAC1A;
 Fri, 15 Mar 2013 12:24:25 +0100 (CET)
Date: Fri, 15 Mar 2013 12:24:25 +0100 (CET)
From: Alain Frisch <alain.frisch@lexifi.com>
To: Leo White <lpw25@cam.ac.uk>
Message-ID: <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
In-Reply-To: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: 7bit
X-Mailer: Zimbra 7.2.1_GA_2790 (ZimbraWebClient - FF3.0 (Win)/7.2.1_GA_2790)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 15 Mar 2013 11:17:37 -0000

> I think that this is definitely the right way to go for attributes.

Attributes are now implemented as an extra field of the expression (and other) record in the Parsetree.

> For
> extensions, I think it makes more sense to give them their own AST
> node. The idea is that an extension used as an expression *is* an
> expression, so it should be represented in the AST as such.

Agreed.

Extension designers will need to choose between using an attribute:

  let[@foo] x = e1 in e2

or an extension node:

  let%foo x = e1 in e2


The first form is clearly to be preferred for adding meta-data which can be safely ignored by the type-checker, and the second one for constructions which just piggy-back existing syntax with a very different semantics (a la sedlex, bitstring, etc).   There is a gray area in between, though.

-- Alain

From gabriel.scherer@gmail.com  Fri Mar 15 12:58:06 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9B00D3CBF9
 for <wg-camlp4@lists.ocaml.org>; Fri, 15 Mar 2013 12:58:06 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1456366 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.52 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f52.google.com ([209.85.214.52]:56666)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UGUJb-0002mq-Si (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 15 Mar 2013 13:04:56 +0000
Received: by mail-bk0-f52.google.com with SMTP id jk13so1467282bkc.25
 for <wg-camlp4@lists.ocaml.org>; Fri, 15 Mar 2013 06:04:55 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type:content-transfer-encoding;
 bh=j7d8IehXLoDSxF6FR2smfZZ98YYeGg+uFc5+A0wpOIc=;
 b=VlIc3OPOiQg+ya9Ml2DwjJmimw/QklgxVEy7V8kOZE0TxYX6rcsMVO5Wn3xwMy/Jej
 2WrpuLPCLfSJQ4EHdn8DlqTXEWb4fRYmSJsVo2UsXRS/GQzLUuNeEyoXHnhEfWwDM7K5
 GFNraa3sgF4p9XXMgI9T/bSyj11huQB36sLxxX1k+kxQlcjw8J42UaKJxMlelSSnj25t
 PeFuFCWM4uKe3EbVcIpzkFvZo94GKzL0OTudV5X1HbhJu8pM6mKfHgMLPEwUpDXiHL2p
 hmfnjUStdnmAxwfwYIzk5/cc/zfUL1nWzyxsEE3UkWDkMTL+kLKgkdMMSKjcb/9fLK6l
 v6kg==
X-Received: by 10.204.200.131 with SMTP id ew3mr3076246bkb.103.1363352695433; 
 Fri, 15 Mar 2013 06:04:55 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Fri, 15 Mar 2013 06:04:14 -0700 (PDT)
In-Reply-To: <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 15 Mar 2013 14:04:14 +0100
Message-ID: <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 15 Mar 2013 12:58:06 -0000

But why do we have a heavier syntax for innocuous stuff, and an easy
syntax for wild-semantics-change stuff? Would let@foo work as well?

On Fri, Mar 15, 2013 at 12:24 PM, Alain Frisch <alain.frisch@lexifi.com> wr=
ote:
>> I think that this is definitely the right way to go for attributes.
>
> Attributes are now implemented as an extra field of the expression (and o=
ther) record in the Parsetree.
>
>> For
>> extensions, I think it makes more sense to give them their own AST
>> node. The idea is that an extension used as an expression *is* an
>> expression, so it should be represented in the AST as such.
>
> Agreed.
>
> Extension designers will need to choose between using an attribute:
>
>   let[@foo] x =3D e1 in e2
>
> or an extension node:
>
>   let%foo x =3D e1 in e2
>
>
> The first form is clearly to be preferred for adding meta-data which can =
be safely ignored by the type-checker, and the second one for constructions=
 which just piggy-back existing syntax with a very different semantics (a l=
a sedlex, bitstring, etc).   There is a gray area in between, though.
>
> -- Alain

From alain.frisch@lexifi.com  Fri Mar 15 13:44:38 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 857043CBF9
 for <wg-camlp4@lists.ocaml.org>; Fri, 15 Mar 2013 13:44:38 +0000 (GMT)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1456366 
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0001]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mta50.yaziba.net ([85.233.204.131]:49467)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UGV2c-0001mt-8P (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 15 Mar 2013 13:51:28 +0000
Received: from mta30.int.yaziba.net (unknown [10.4.20.32])
 by mta50.yaziba.net (Postfix) with ESMTP id 6CA4B2131E;
 Fri, 15 Mar 2013 14:51:26 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
 by mta30.int.yaziba.net (Postfix) with ESMTP id 64585CC76D;
 Fri, 15 Mar 2013 14:51:26 +0100 (CET)
X-Virus-Scanned: amavisd-new at mta30.int.yaziba.net
Received: from mta30.int.yaziba.net ([127.0.0.1])
 by localhost (mta30.int.yaziba.net [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id dGYPlcj+oyaH; Fri, 15 Mar 2013 14:51:26 +0100 (CET)
Received: from mail20.int.yaziba.net (mail20.int.yaziba.net [10.4.20.52])
 by mta30.int.yaziba.net (Postfix) with ESMTP id 4BC28CC722;
 Fri, 15 Mar 2013 14:51:26 +0100 (CET)
Date: Fri, 15 Mar 2013 14:51:26 +0100 (CET)
From: Alain Frisch <alain.frisch@lexifi.com>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Message-ID: <84430774.3486159.1363355486267.JavaMail.root@lexifi.com>
In-Reply-To: <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: 7bit
X-Mailer: Zimbra 7.2.1_GA_2790 (ZimbraWebClient - FF3.0 (Win)/7.2.1_GA_2790)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 15 Mar 2013 13:44:38 -0000

Gabriel:
> But why do we have a heavier syntax for innocuous stuff, and an easy
> syntax for wild-semantics-change stuff? Would let@foo work as well?

Attributes takes an optional argument, i.e. you can write:

  let[@foo bla] x = ....

so we need some delimeters.  (Maybe we could have a lighter syntax for attributes without arguments.)

In the form "let%foo x = ...", the argument of the extension is "let x = ...".


-- Alain

From lpw25@cam.ac.uk  Fri Mar 15 13:46:16 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id EA6ED3CBF9
 for <wg-camlp4@lists.ocaml.org>; Fri, 15 Mar 2013 13:46:16 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:41746)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UGV4E-0003oQ-Xq (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Fri, 15 Mar 2013 13:53:06 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
Date: Fri, 15 Mar 2013 13:53:06 +0000
In-Reply-To: <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 (Gabriel Scherer's message of "Fri, 15 Mar 2013 14:04:14 +0100")
Message-ID: <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 15 Mar 2013 13:46:17 -0000

Gabriel Scherer <gabriel.scherer@gmail.com> writes:

> But why do we have a heavier syntax for innocuous stuff, and an easy
> syntax for wild-semantics-change stuff? Would let@foo work as well?
>

I think that is because "let@foo x = ..." doesn't annotate foo with much
information. The expected uses are more like:

    let [@foo (*some information pretending to be an expression*)] x = ...

where obviously the hevier syntax is required.

From gabriel.scherer@gmail.com  Fri Mar 15 15:09:59 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6422D3CBF9
 for <wg-camlp4@lists.ocaml.org>; Fri, 15 Mar 2013 15:09:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1456366 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.45 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f45.google.com ([209.85.214.45]:36595)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UGWNE-00057D-sa (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 15 Mar 2013 15:16:49 +0000
Received: by mail-bk0-f45.google.com with SMTP id i18so1543404bkv.4
 for <wg-camlp4@lists.ocaml.org>; Fri, 15 Mar 2013 08:16:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=93JqCNN/vDL9yPsXcG9DrJv4rXbKdAatfr97XEAAOBE=;
 b=UtAtllDGKUzR9XWsFs6dAhXEzro1mv5vdXuFp8N+gUoj4HICaEkwFYskl0AMk8AZz9
 GXPY776CBh2WK3dEAApzkyxLTJf5/EzhGubGVZg8GovQl4F+uWiy/waeYOp5XL7C/Oe+
 we31bQNoM8okfuxtQqV3vW3EVEl9Z861H2zASqbt5oZkx825IITbn3vC9ygOz94MSTxx
 UaTYBd44o/AUQwJ4WeYTztfR0UPGT1b1EFTIMohD0ozIt83KtISaSQhgaHBL47pr9G+Z
 mmUJSHoxgii8hutaQJ/4svgJH4M5Yqbzy6BvwCRDFEzyhmgeySTYKfaiLuQQja/ee1LR
 7Uxw==
X-Received: by 10.205.33.81 with SMTP id sn17mr3308091bkb.53.1363360608663;
 Fri, 15 Mar 2013 08:16:48 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Fri, 15 Mar 2013 08:16:07 -0700 (PDT)
In-Reply-To: <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 15 Mar 2013 16:16:07 +0100
Message-ID: <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 15 Mar 2013 15:09:59 -0000

I suspect we could get some value, for example, of

  let@nowarn [x;y;z] = List.map normalize [x;y;z]

(More generally I've been thinking about compiler pragmas, and those
often don't need arguments.)

I think the answer is yes, but I don't quite remember: if let[@foo
bar] .. = ... in .. is accepted, do we also allow let[%foo bar] ... in
... as a shortcut for [%foo bar (let .. in ...)]?

On Fri, Mar 15, 2013 at 2:53 PM, Leo White <lpw25@cam.ac.uk> wrote:
> Gabriel Scherer <gabriel.scherer@gmail.com> writes:
>
>> But why do we have a heavier syntax for innocuous stuff, and an easy
>> syntax for wild-semantics-change stuff? Would let@foo work as well?
>>
>
> I think that is because "let@foo x = ..." doesn't annotate foo with much
> information. The expected uses are more like:
>
>     let [@foo (*some information pretending to be an expression*)] x = ...
>
> where obviously the hevier syntax is required.

From alain.frisch@lexifi.com  Thu Mar 21 09:08:38 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 39E163C568
 for <wg-camlp4@lists.ocaml.org>; Thu, 21 Mar 2013 09:08:38 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1458688 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:41361
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UIbb8-0003n1-YB (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 21 Mar 2013 09:15:46 +0000
Received: from [192.168.1.120] ([92.151.4.52]) by mwinf5d32 with ME
 id E9Fl1l00E17LM8k039Flq2; Thu, 21 Mar 2013 10:15:46 +0100
Message-ID: <514ACFC1.5090705@lexifi.com>
Date: Thu, 21 Mar 2013 10:15:45 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130307 Thunderbird/17.0.4
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
In-Reply-To: <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 21 Mar 2013 09:08:38 -0000

On 03/15/2013 04:16 PM, Gabriel Scherer wrote:
> I suspect we could get some value, for example, of
>
>    let@nowarn [x;y;z] = List.map normalize [x;y;z]
>
> (More generally I've been thinking about compiler pragmas, and those
> often don't need arguments.)
>
> I think the answer is yes, but I don't quite remember: if let[@foo
> bar] .. = ... in .. is accepted, do we also allow let[%foo bar] ... in
> ... as a shortcut for [%foo bar (let .. in ...)]?

No, currently let[%foo bar] ... in ... is not allowed.

I think we should move forward and make a decision concerning the 
alternative syntax for attributes and extension nodes on opening 
delimiters and keywords.  As a reminder, the current version in the SVN 
supports the following sugar for an EXPRESSION which starts with a 
keyword or delimiter KW (EXPRESSION == KW REST):

Attributes:

   KW[@id expr]...[@id expr] REST
   ---->
   EXPRESSION[@id expr]...[@id expr]

Extension node:

   KW%id REST
   ---->
   [%id EXPRESSION]

Attributes on extension node:

   KW%id[@id expr]...[@id expr] REST
   ---->
   [%id EXPRESSION][@id expr]...[@id expr]


where KW can stand for:

  (
  (module
  [
  [|
  assert
  begin
  for
  fun
  function
  if
  lazy
  let
  let module
  let open
  match
  new
  object
  try
  while
  {
  {<



I propose to choose between one of the following:

  1. Continue with the current situation.

  2. Completely get rid of this alternative "prefix" syntax for 
attributes and extension points.  This only affect parser.mly and can 
easily be discussed again and added later.  This would reduce the 
changes to the concrete grammar (and would thus simplify supporting 
attributes and extension points in Camlp4)

  3. Keep the syntax, but only for real keywords, not opening delimiters 
( [ [| { and {<.

  4. Do something special for "let" (it has been argued that for other 
constructions, the normal syntax of extension point does not add too 
much overhead); to be detailed.


Note, even if we go with 2, we can still write:

  let (x, y) [@lwt] = ... in
  ...

i.e. use (a postfix) attribute on the (first) pattern of the binding.


I'm now slightly in favor of 2, neutral between 1 and 3, and slightly 
against 4.

Please share your opinion (and feel free to propose something else)!



Alain

From lpw25@cam.ac.uk  Thu Mar 21 10:07:54 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AFF103C568
 for <wg-camlp4@lists.ocaml.org>; Thu, 21 Mar 2013 10:07:54 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:38795)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UIcWV-0004Hp-Xe (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Thu, 21 Mar 2013 10:15:03 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com>
Date: Thu, 21 Mar 2013 10:15:03 +0000
In-Reply-To: <514ACFC1.5090705@lexifi.com> (Alain Frisch's message of "Thu, 21
 Mar 2013 10:15:45 +0100")
Message-ID: <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 21 Mar 2013 10:07:54 -0000

> I propose to choose between one of the following:
>
>  1. Continue with the current situation.
>
>  2. Completely get rid of this alternative "prefix" syntax for attributes and extension points.  This only affect
> parser.mly and can easily be discussed again and added later.  This would reduce the changes to the concrete grammar
> (and would thus simplify supporting attributes and extension points in Camlp4)
>
>  3. Keep the syntax, but only for real keywords, not opening delimiters ( [ [| { and {<.
>
>  4. Do something special for "let" (it has been argued that for other constructions, the normal syntax of extension
> point does not add too much overhead); to be detailed.
>

I'm basically fine with 2, 3 or 4. I would also be fine with:

  1.5. Completely get rid of the "prefix" syntax for extensions but
       keep it for attributes.

It might be best to go with 2 for now since, as you suggested, it will be
much easier to add syntactic sugar later than to remove it.

From gabriel.scherer@gmail.com  Thu Mar 21 13:15:49 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3BEED3C57B
 for <wg-camlp4@lists.ocaml.org>; Thu, 21 Mar 2013 13:15:49 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1458688 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.45 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f45.google.com ([209.85.214.45]:44775)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UIfSM-000574-q9 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 21 Mar 2013 13:22:58 +0000
Received: by mail-bk0-f45.google.com with SMTP id i18so1397923bkv.18
 for <wg-camlp4@lists.ocaml.org>; Thu, 21 Mar 2013 06:22:57 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=6BxCezhZLwiazf/onuEeBIZjlss7yR9hho61kObtsUQ=;
 b=amNiGdcMEmDyGuedDIgYprZr/iW4ECros/db/8Ol7irtKyuoZEx4IzKUQxrrPpcS96
 bgiJAjGTp1FpAj9L9j5nKGYC8wcPKwSImADgpPfVDPBNN1zmrqKmfzL7xcUrUAvNHkz3
 36PpWpW4er/vb3PTvrXa0v4vAuGg31HkWf98K5dbWVamMDRFPmBk/FVN5oSd4g1ywZui
 Q+c3Rb/uHlsWYeBLjAOjFAy7hzW7XEAdkw/XfUoe0yIrQbbj0r9/bgW67LDhBAxdHHVJ
 06h1VUhq+uOUb4RZXK8UKx0eF6dUuxLpIdmseatb9Ss+niNwm/1l5UyVAJgUBl1VjIm6
 TN8g==
X-Received: by 10.204.227.143 with SMTP id ja15mr13376641bkb.5.1363872177750; 
 Thu, 21 Mar 2013 06:22:57 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Thu, 21 Mar 2013 06:22:17 -0700 (PDT)
In-Reply-To: <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 21 Mar 2013 14:22:17 +0100
Message-ID: <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 21 Mar 2013 13:15:49 -0000

The translation of
   KW%id[@id expr]..[@id expr] REST
into
  [%id KW REST] [@id expr]..[@id expr]
is surprising to me. I would instead have expected it to translate into
  [%id (KW REST)[@id expr]..[@id expr] ]
(the extensions would have precedence over attributes, so that
localized extension handlers only rewriting what is inside the [%id
EXPR] can see the attributes and react to them)

Among the options you highlight, my own current preference goes for (3).

I think the question is: how much do we need for the "easy cases" of
current camlp4 users to switch to this style, and not the style of
"overloading valid code semantics" that is currently used by, say,
ppx_monad, and I think is the wrong way to go on the long term?

If having a convenient syntax as discussed here is not necessary to do
the switch, maybe that's enough. But if it is necessary, I think it
should be agreed upon right away, to be sure that the "good solutions"
will not, when studied in the future, require changes to what you will
implement short-term.

On Thu, Mar 21, 2013 at 11:15 AM, Leo White <lpw25@cam.ac.uk> wrote:
>> I propose to choose between one of the following:
>>
>>  1. Continue with the current situation.
>>
>>  2. Completely get rid of this alternative "prefix" syntax for attributes and extension points.  This only affect
>> parser.mly and can easily be discussed again and added later.  This would reduce the changes to the concrete grammar
>> (and would thus simplify supporting attributes and extension points in Camlp4)
>>
>>  3. Keep the syntax, but only for real keywords, not opening delimiters ( [ [| { and {<.
>>
>>  4. Do something special for "let" (it has been argued that for other constructions, the normal syntax of extension
>> point does not add too much overhead); to be detailed.
>>
>
> I'm basically fine with 2, 3 or 4. I would also be fine with:
>
>   1.5. Completely get rid of the "prefix" syntax for extensions but
>        keep it for attributes.
>
> It might be best to go with 2 for now since, as you suggested, it will be
> much easier to add syntactic sugar later than to remove it.

From alain.frisch@lexifi.com  Fri Mar 22 11:29:34 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 210C53C04E
 for <wg-camlp4@lists.ocaml.org>; Fri, 22 Mar 2013 11:29:34 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1459191 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:35626
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UJ0H6-00068C-si (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 22 Mar 2013 11:36:46 +0000
Received: from [192.168.1.120] ([92.151.4.52]) by mwinf5d68 with ME
 id Ebck1l00F17LM8k03bckip; Fri, 22 Mar 2013 12:36:44 +0100
Message-ID: <514C424A.6070905@lexifi.com>
Date: Fri, 22 Mar 2013 12:36:42 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:17.0) Gecko/20130307 Thunderbird/17.0.4
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
In-Reply-To: <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Request for feedback
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 22 Mar 2013 11:29:34 -0000

On 03/21/2013 02:22 PM, Gabriel Scherer wrote:
> The translation of
>     KW%id[@id expr]..[@id expr] REST
> into
>    [%id KW REST] [@id expr]..[@id expr]
> is surprising to me. I would instead have expected it to translate into
>    [%id (KW REST)[@id expr]..[@id expr] ]
> (the extensions would have precedence over attributes, so that
> localized extension handlers only rewriting what is inside the [%id
> EXPR] can see the attributes and react to them)

I don't think it will make a big difference in practice if the 
attributes are stored in the pexp_attributes of the record whose 
pexp_desc is Pexp_extension(_, e) instead of e.pexp_attributes.

But I've changed the code to match the behavior you describe.

> Among the options you highlight, my own current preference goes for (3).

Since Leo and me are also ok with that, and nobody else commented, let's 
go with (3) for now.  I've removed support for the alternative syntax 
for expression constructions not starting with a keyword or a combinator 
of keywords (let module, let open).  I've considered "(module ...)" as 
not starting with a keyword.

-- Alain

From alain.frisch@lexifi.com  Mon Mar 25 11:35:41 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 34D933C40C
 for <wg-camlp4@lists.ocaml.org>; Mon, 25 Mar 2013 11:35:41 +0000 (GMT)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1460285 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:18956
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UK5np-0001LW-7c (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 25 Mar 2013 11:43:02 +0000
Received: from [192.168.1.120] ([92.151.4.52]) by mwinf5d54 with ME
 id Fniz1l00W17LM8k03nizjw; Mon, 25 Mar 2013 12:42:59 +0100
Message-ID: <51503841.7040708@lexifi.com>
Date: Mon, 25 Mar 2013 12:42:57 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com>
In-Reply-To: <514C424A.6070905@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 25 Mar 2013 11:35:41 -0000

Dear all,

Now that we have reached a stable state concerning the syntax of 
attributes and extension nodes, I'd like to get feedback on the proposed 
changes to the definition of the Parsetree:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/parsing/parsetree.mli?r1=13329&r2=HEAD


The following changes have been applied:

  - Adding new constructors for extension nodes and for attributes as 
stand-alone signature/structure items.

  - Storing attributes as new fields in record types (such as 
expression, pattern, core_type, etc).

  - Introducing some more records to replace tuples/n-ary constructors: 
label_declaration, constructor_declaration, exception_declaration, 
module_declaration, module_type_declaration, module_binding, 
module_type_binding.

  - Adding a name field to value_description and type_declaration.

Another tiny change is that recursive modules are no longer restricted 
syntactically to come with explicit module types (this is enforced in 
the type-checker).  This means that "module rec A = (struct ... end : 
sig ... end)" is now accepted as well as "module rec A : sig ... end = 
struct ... end".


More cleanup to the Parsetree representation can be considered. Examples:

  - Cleaner representation of "when" guard (before doing anything here, 
I'd like to know if the removal of the "fun pat when cond -> ..." form 
will be accepted, see http://caml.inria.fr/mantis/view.php?id=5939).

  - Doing less desugaring the parser (interval patterns, M.(e) === let 
open M in e, ....).

  - Make the type-checker more robust w.r.t. where Ptyp_poly node have 
to be inserted (currently the parser introduces some empty Ptyp_poly 
nodes and the type-checker expects to find them).

  - Replacing Booleans with more explicit sum types and getting rid of 
more tuples/n-ary constructors.


It's probably good to validate the general approach first with the core 
team before we apply any such further cleanups.  Before submitting the 
current version for review to the core team, I'd like to get feedback 
from the participants of this working group.


Alain

From lpw25@cam.ac.uk  Mon Mar 25 13:58:20 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 91FA13C16D
 for <wg-camlp4@lists.ocaml.org>; Mon, 25 Mar 2013 13:58:20 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:39459)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UK81u-0008Dn-sX (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Mon, 25 Mar 2013 14:05:42 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
Date: Mon, 25 Mar 2013 14:05:42 +0000
In-Reply-To: <51503841.7040708@lexifi.com> (Alain Frisch's message of "Mon, 25
 Mar 2013 12:42:57 +0100")
Message-ID: <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 25 Mar 2013 13:58:20 -0000

> Now that we have reached a stable state concerning the syntax of attributes and extension nodes, I'd like to get
> feedback on the proposed changes to the definition of the Parsetree:
>
> [...]
>
> It's probably good to validate the general approach first with the core team before we apply any such further cleanups.
> Before submitting the current version for review to the core team, I'd like to get feedback from the participants of
> this working group.

All of those changes seem reasonable. 

Another small clean-up I'd like would be to change "ptype_params" from
"string loc option list" to "core_type list" and the first part of
"pci_params" from "string loc list" to "core_type list".

I think this would be more consistent with what people will expect. It
also improves Typedtree by attaching the Type of the parameters to their
place in the syntax tree. (and it makes things a little simpler for my
"open types" branch.)

Before you submit the changes to the core team, we really need to add
the:

    {x{ ... }x}

syntax for use with quotations. It should be simple enough to add to the
lexer, and then accept as a "constant" in the parser. In the parsetree
it should either be represented by its own node (Const_quote) or just
translated into a Const_string.



    

From jathdr@gmail.com  Mon Mar 25 14:05:52 2013
Return-Path: <jathdr@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id F1F7C3C16D
 for <wg-camlp4@lists.ocaml.org>; Mon, 25 Mar 2013 14:05:51 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1460285 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.83.54 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (jathdr[at]gmail.com)
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ee0-f54.google.com ([74.125.83.54]:48317)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UK89B-0005we-Qs (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <jathdr@gmail.com>); Mon, 25 Mar 2013 14:13:14 +0000
Received: by mail-ee0-f54.google.com with SMTP id c41so3329061eek.13
 for <wg-camlp4@lists.ocaml.org>; Mon, 25 Mar 2013 07:13:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:references:mime-version:in-reply-to:content-type
 :content-transfer-encoding:message-id:cc:x-mailer:from:subject:date
 :to; bh=mdjn7egytKoFFckHvkDVnlHi7H554uYCsqczXe6eU4o=;
 b=M2AtE/P1fU4EicH1c+6S65JmkL0x2ja4Gqy07XshcCLT1ZaOh++9W1CYg98hPoSebh
 lQeXIafhILl5Cyya2U+QV0KZCBedcjNB8suUzLgPi0cTBhQg2KEndGaUF+p+8ZmarZp+
 AbxLSCVqmV+1HprDHbmc+DWUy1D2tLiPwOQ5nQ+6KO4Jv670qWzJ9WgqZZWqE+3WRKIO
 FM02t+u7EvHo7LR/dCZs1XjhV/DzfRIxJBrbdt7O+5Dnm/W+XVr2gYR2ChETsFZp1cWy
 7t1XrXUxNKVsSTzqFwPbYj2EOUo7vKmQ7YYHPdBKnxAgg1S83o33jvB8vI84HlEmVJe4
 zXWw==
X-Received: by 10.14.200.137 with SMTP id z9mr34122780een.20.1364220792932;
 Mon, 25 Mar 2013 07:13:12 -0700 (PDT)
Received: from [10.40.162.11] ([80.215.64.212])
 by mx.google.com with ESMTPS id u44sm19310144eel.7.2013.03.25.07.13.11
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Mon, 25 Mar 2013 07:13:12 -0700 (PDT)
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
Mime-Version: 1.0 (1.0)
In-Reply-To: <51503841.7040708@lexifi.com>
Content-Type: text/plain;
	charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Message-Id: <83EA4AF5-E403-4CB1-971B-04C82078C183@gmail.com>
X-Mailer: iPhone Mail (10A523)
From: jathdr <jathdr@gmail.com>
Date: Mon, 25 Mar 2013 15:13:09 +0100
To: Alain Frisch <alain.frisch@lexifi.com>
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 25 Mar 2013 14:05:52 -0000



Alain Frisch <alain.frisch@lexifi.com>:

> Now that we have reached a stable state concerning the syntax of attribute=
s and extension nodes, I'd like to get feedback on the proposed changes to t=
he definition of the Parsetree:
>=20

Could we get a summary of the current syntax proposal? I've been following a=
long, but I'm a bit lost as to what has been discussed, accepted, rejected, e=
tc.=20

> - Doing less desugaring the parser (interval patterns, M.(e) =3D=3D=3D let=
 open M in e, ....).
>=20

This is probably a bit off topic, but while we're talking about interval pat=
terns: I discovered the other day that interval patterns only work for chars=
, while I always assumed they also worked for ints. Is there a reason why th=
ey don't?=

From alain.frisch@lexifi.com  Mon Mar 25 18:42:32 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AD63C3C16D
 for <wg-camlp4@lists.ocaml.org>; Mon, 25 Mar 2013 18:42:32 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1460285 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:55912
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UKCSx-0004cR-X5 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 25 Mar 2013 18:49:55 +0000
Received: from [192.168.1.120] ([92.151.4.52]) by mwinf5d32 with ME
 id Fupu1l00a17LM8k03upuhf; Mon, 25 Mar 2013 19:49:54 +0100
Message-ID: <51509C4D.9010509@lexifi.com>
Date: Mon, 25 Mar 2013 19:49:49 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: jathdr <jathdr@gmail.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <83EA4AF5-E403-4CB1-971B-04C82078C183@gmail.com>
In-Reply-To: <83EA4AF5-E403-4CB1-971B-04C82078C183@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 25 Mar 2013 18:42:32 -0000

On 03/25/2013 03:13 PM, jathdr wrote:
> Could we get a summary of the current syntax proposal? I've been
> following along, but I'm a bit lost as to what has been discussed,
> accepted, rejected, etc.

This file describes the current syntax proposal:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/extension_points.txt?revision=HEAD&view=markup


> This is probably a bit off topic, but while we're talking about
> interval patterns: I discovered the other day that interval patterns
> only work for chars, while I always assumed they also worked for
> ints. Is there a reason why they don't?

Currently, range patterns for characters are expanded in the parser. 
Doing so for integers as well could lead to huge or-patterns to be 
processed by the rest of the compiler.  Supporting range patterns 
directly in the compiler would add a little bit of extra complexity for 
type-checking (exhaustiveness check) and code generation.  I don't see 
any theoretical problem, though.


-- Alain

From bobzhang1988@gmail.com  Mon Mar 25 21:42:59 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 577113C16D
 for <wg-camlp4@lists.ocaml.org>; Mon, 25 Mar 2013 21:42:59 +0000 (GMT)
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1460285 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.178 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f178.google.com ([209.85.128.178]:51929)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UKFHZ-0003QD-81 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Mon, 25 Mar 2013 21:50:22 +0000
Received: by mail-ve0-f178.google.com with SMTP id db10so1393648veb.9
 for <wg-camlp4@lists.ocaml.org>; Mon, 25 Mar 2013 14:50:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=a/ghVwCRDR6qAChrSdKFfiicZ1z9dXMn0utosOEmFx0=;
 b=JDGl0JtaUGI63a1st//Crhz6RZwo92ig+vMgAgeigY9oNA9TdKOOe+0BkxSeTkRzYf
 s6xpowOx0Q9ewUi4PZxl6Aluks5F9Wqg4m4bfFvt/jsz/XbLokMPIkrDigSQhsGqDtsx
 P1MPWhdCfYLzdax5LHKlFQAeaC0hnBV7hckrVb22ivujQUQ6jUqGWu2szGfkMQrvN50r
 1n8/D7GDkuZaY/RqI3Qk73Chygan6F0nKUcwjuw82cZRWiA4yuZ3IpWbSQMTQbywdkP5
 9/XsIntnsI8UZzbHS+ltOETdVlPLUBi7D3sRuYdnJjthz4SY7nznOCz6cekYrJ+rUfFT
 u5Qw==
MIME-Version: 1.0
X-Received: by 10.220.156.75 with SMTP id v11mr17832062vcw.1.1364248220699;
 Mon, 25 Mar 2013 14:50:20 -0700 (PDT)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Mon, 25 Mar 2013 14:50:20 -0700 (PDT)
In-Reply-To: <51509C4D.9010509@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com>
 <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <83EA4AF5-E403-4CB1-971B-04C82078C183@gmail.com>
 <51509C4D.9010509@lexifi.com>
Date: Mon, 25 Mar 2013 17:50:20 -0400
X-Google-Sender-Auth: PWrqpqqix9U_RK_dymg2vK2aMbA
Message-ID: <CANcqPu5hO1d6+ifdTZNxYpJ5m4gWu2XeM+D6BO7nbv6AW2izOQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=f46d043c7c869494b204d8c6ca36
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 25 Mar 2013 21:42:59 -0000

--f46d043c7c869494b204d8c6ca36
Content-Type: text/plain; charset=ISO-8859-1

Hi Alain,
  I am a bit busy this week, but I would like to follow the discussion and
give some feedback next week, Thanks
On Mon, Mar 25, 2013 at 2:49 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> On 03/25/2013 03:13 PM, jathdr wrote:
>
>> Could we get a summary of the current syntax proposal? I've been
>> following along, but I'm a bit lost as to what has been discussed,
>> accepted, rejected, etc.
>>
>
> This file describes the current syntax proposal:
>
> http://caml.inria.fr/cgi-bin/**viewvc.cgi/ocaml/branches/**
> extension_points/experimental/**frisch/extension_points.txt?**
> revision=HEAD&view=markup<http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/extension_points.txt?revision=HEAD&view=markup>
>
>
>
>  This is probably a bit off topic, but while we're talking about
>> interval patterns: I discovered the other day that interval patterns
>> only work for chars, while I always assumed they also worked for
>> ints. Is there a reason why they don't?
>>
>
> Currently, range patterns for characters are expanded in the parser. Doing
> so for integers as well could lead to huge or-patterns to be processed by
> the rest of the compiler.  Supporting range patterns directly in the
> compiler would add a little bit of extra complexity for type-checking
> (exhaustiveness check) and code generation.  I don't see any theoretical
> problem, though.
>
>
> -- Alain
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>



-- 
-- Regards, Hongbo

--f46d043c7c869494b204d8c6ca36
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Hi Alain,<br>=A0 I am a bit busy this week, but I would like to follow the =
discussion and give some feedback next week, Thanks<br><div class=3D"gmail_=
quote">On Mon, Mar 25, 2013 at 2:49 PM, Alain Frisch <span dir=3D"ltr">&lt;=
<a href=3D"mailto:alain.frisch@lexifi.com" target=3D"_blank">alain.frisch@l=
exifi.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">On 03/25/2013 03:13 PM, ja=
thdr wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Could we get a summary of the current syntax proposal? I&#39;ve been<br>
following along, but I&#39;m a bit lost as to what has been discussed,<br>
accepted, rejected, etc.<br>
</blockquote>
<br></div>
This file describes the current syntax proposal:<br>
<br>
<a href=3D"http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension=
_points/experimental/frisch/extension_points.txt?revision=3DHEAD&amp;view=
=3Dmarkup" target=3D"_blank">http://caml.inria.fr/cgi-bin/<u></u>viewvc.cgi=
/ocaml/branches/<u></u>extension_points/experimental/<u></u>frisch/extensio=
n_points.txt?<u></u>revision=3DHEAD&amp;view=3Dmarkup</a><div class=3D"im">
<br>
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
This is probably a bit off topic, but while we&#39;re talking about<br>
interval patterns: I discovered the other day that interval patterns<br>
only work for chars, while I always assumed they also worked for<br>
ints. Is there a reason why they don&#39;t?<br>
</blockquote>
<br></div>
Currently, range patterns for characters are expanded in the parser. Doing =
so for integers as well could lead to huge or-patterns to be processed by t=
he rest of the compiler. =A0Supporting range patterns directly in the compi=
ler would add a little bit of extra complexity for type-checking (exhaustiv=
eness check) and code generation. =A0I don&#39;t see any theoretical proble=
m, though.<span class=3D"HOEnZb"><font color=3D"#888888"><br>

<br>
<br>
-- Alain</font></span><div class=3D"HOEnZb"><div class=3D"h5"><br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo

--f46d043c7c869494b204d8c6ca36--

From alain.frisch@lexifi.com  Tue Mar 26 11:27:07 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 179C63C40C
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 11:27:07 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1460549 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:35544
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UKS99-0003DA-RH (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 26 Mar 2013 11:34:32 +0000
Received: from [192.168.1.120] ([92.151.4.52]) by mwinf5d28 with ME
 id GBaW1l00E17LM8k03BaWDh; Tue, 26 Mar 2013 12:34:31 +0100
Message-ID: <515187C8.2030109@lexifi.com>
Date: Tue, 26 Mar 2013 12:34:32 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk>
In-Reply-To: <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 11:27:07 -0000

On 03/25/2013 03:05 PM, Leo White wrote:
> Another small clean-up I'd like would be to change "ptype_params" from
> "string loc option list" to "core_type list" and the first part of
> "pci_params" from "string loc list" to "core_type list".

Would you change the parser to accept arbitrary types (instead of _ and 
type variables), and enforce the previous constraint in the 
type-checker?  It would also make sense to merge the ptype_variance 
information into ptype_params (probably introducing a record type to 
represent each type parameter).

> Before you submit the changes to the core team, we really need to add
> the:
>
>      {x{ ... }x}
>
> syntax for use with quotations. It should be simple enough to add to the
> lexer, and then accept as a "constant" in the parser. In the parsetree
> it should either be represented by its own node (Const_quote) or just
> translated into a Const_string.

I've committed this change, using {x| ... |x} instead of {x{ ... }x} 
(this just looks more readable to me; feel free to object).  In this 
syntax, x is an arbitrary (possibly empty) sequence of lowercase 
letters, no whitespaces allowed between { and |.  Inside the quoted 
string, no character is interpreted in a special way.  In the Parsetree, 
this is represented by changing Const_string to:

   | Const_string of string * string option

where the delimiter is stored in the "string option" (None for the 
regular syntax of OCaml strings).


Another change I've committed recently is an update to the Typedtree 
representation, to bring it closer to the current state of the 
Parsetree, including attributes.  This makes it possible for external 
tools to process attributes in .cmt/.cmti files.  I've committed an 
example of a "mini-ocamldoc" based on this technique:

 
http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/minidoc.ml?revision=HEAD&view=markup
 
http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/testdoc.mli?revision=HEAD&view=markup 



Leo: you mentioned that you're working on a revised ocamldoc.  Do you 
have plans to have it rely on attributes?


Alain


From thomas.gazagnaire@gmail.com  Tue Mar 26 11:49:54 2013
Return-Path: <thomas.gazagnaire@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 586C23C40C
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 11:49:54 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1460549 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (thomas.gazagnaire[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f173.google.com ([74.125.82.173]:35753)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UKSVD-00047G-WY (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <thomas.gazagnaire@gmail.com>); Tue, 26 Mar 2013 11:57:19 +0000
Received: by mail-we0-f173.google.com with SMTP id t57so1895510wey.4
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 04:57:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:subject:mime-version:content-type:from
 :in-reply-to:date:cc:content-transfer-encoding:message-id:references
 :to:x-mailer; bh=RUc+coveMnGQF1FaRvZnjncdCvurDsZ1n4nsDSdxp3o=;
 b=frF4x9LdVKQyZWsZ6hUoy/CMUQcU0MA88vPbxTEhTka7lwuy91MGZfsXu3f+/VzgXl
 EvKSk9eKZ2+dBRQs0RUM3IXhe5nU9dLcsYgdrXsZ3L9QmhusoBn2lH1DSDrKMtY+6hYJ
 fFg/NJGGmRfbckk29wyw2fm/48CIQ5TRX+A9GNyaJAMvG5hVnyN++uFdUZo2hw63lju9
 898hwsxtY4cLhyQRVVaKAosa8ABYjvPeSR6BReKxJ2DUYsx52TyXGMHLrQGSXFLOD61v
 Eo4I2ijo0AaVtUcpWBmcoP2gSEZlTr9daiWoXFqohcb30AoUMoqItu2VOeg9CcklIZ1M
 hoIA==
X-Received: by 10.194.89.234 with SMTP id br10mr13870316wjb.43.1364299038728; 
 Tue, 26 Mar 2013 04:57:18 -0700 (PDT)
Received: from [192.168.0.12] (gou06-3-88-170-165-56.fbx.proxad.net.
 [88.170.165.56])
 by mx.google.com with ESMTPS id fg6sm2863827wib.10.2013.03.26.04.57.16
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Tue, 26 Mar 2013 04:57:17 -0700 (PDT)
Sender: Thomas Gazagnaire <thomas.gazagnaire@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1085)
Content-Type: text/plain; charset=us-ascii
From: Thomas Gazagnaire <thomas@ocamlpro.com>
In-Reply-To: <515187C8.2030109@lexifi.com>
Date: Tue, 26 Mar 2013 12:57:15 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1085)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 11:49:54 -0000

Hi,

just few minor remarks/questions:

* is the distinction between top-level items and other items really =
necessary (eg, @ vs. @@) ? This seems to be the only "complex" thing to =
explain, as the other parts of the design nicely sounds rather simple. =
Also I'm not sure to understand why you need/want to annotate individual =
structure items in a recursive type declaration.

> Another change I've committed recently is an update to the Typedtree =
representation, to bring it closer to the current state of the =
Parsetree, including attributes.  This makes it possible for external =
tools to process attributes in .cmt/.cmti files.  I've committed an =
example of a "mini-ocamldoc" based on this technique:

* the doc annotations are the ones where you usually prefer to have some =
kind of suffix notation (eg. you usually read what the function / module =
does before reading its signature). Is the plan to automatically =
transform suffix ocamldoc snippets into prefix annotations or to drop =
the suffix doc snippets completely ?

Thomas





>=20
> =
http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/ex=
perimental/frisch/minidoc.ml?revision=3DHEAD&view=3Dmarkup
> =
http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/ex=
perimental/frisch/testdoc.mli?revision=3DHEAD&view=3Dmarkup=20
>=20
>=20
> Leo: you mentioned that you're working on a revised ocamldoc.  Do you =
have plans to have it rely on attributes?
>=20
>=20
> Alain
>=20
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4


From thomas.gazagnaire@gmail.com  Tue Mar 26 11:54:11 2013
Return-Path: <thomas.gazagnaire@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3843C3C40C
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 11:54:11 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1460549 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.169 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (thomas.gazagnaire[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f169.google.com ([74.125.82.169]:57721)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UKSZM-0006aX-X7 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <thomas.gazagnaire@gmail.com>); Tue, 26 Mar 2013 12:01:36 +0000
Received: by mail-we0-f169.google.com with SMTP id x43so1721611wey.0
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 05:01:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:subject:mime-version:content-type:from
 :in-reply-to:date:cc:content-transfer-encoding:message-id:references
 :to:x-mailer; bh=Ln++5i/ul0IlcFNSSROS6LmHAfgZrdl093vr87UlVu8=;
 b=0nJewrMrkLq1J3oxunFvD8PogF27PHSg5QZyZqzuAA63ggWN9m+5emTU0bglX/0bAb
 lyx0t/bhsKCN2m8+8pE1zagcV6Pfxswcco14AsRFuIfrCSTA9VANLV17P/er5LhGwu13
 mXPMx8kTcDqXMLbOUrdnYw3V2DdMUwL5w2NwcB/0hZeRNUqpANUn2WcEwV4B9xWBZjNv
 LKAduGsWY7UQuVZ1mKB9BgFVOhyJTZ5LPcOcC4rLQfrMDKGjHbiYY3oaOzXMk8yeQLuN
 d+W5kHQigombC8MRHZ72UBdSAN6+SYJtIdmlFe3HOfJB+GZY30HHPoFpvV2MfL6/VYTW
 +KUA==
X-Received: by 10.194.237.40 with SMTP id uz8mr24154310wjc.49.1364299296095;
 Tue, 26 Mar 2013 05:01:36 -0700 (PDT)
Received: from [192.168.0.12] (gou06-3-88-170-165-56.fbx.proxad.net.
 [88.170.165.56])
 by mx.google.com with ESMTPS id bk1sm2948108wib.2.2013.03.26.05.01.34
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Tue, 26 Mar 2013 05:01:35 -0700 (PDT)
Sender: Thomas Gazagnaire <thomas.gazagnaire@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1085)
Content-Type: text/plain; charset=us-ascii
From: Thomas Gazagnaire <thomas@ocamlpro.com>
In-Reply-To: <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
Date: Tue, 26 Mar 2013 13:01:27 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <4E9D70B6-C14E-4E0A-88F9-3F562AA19308@ocamlpro.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1085)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 11:54:11 -0000

> * the doc annotations are the ones where you usually prefer to have =
some kind of suffix notation

I meant *prefix*


From alain.frisch@lexifi.com  Tue Mar 26 12:26:11 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 91DF53C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 12:26:11 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1460549 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:35523
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UKT4K-0005Tc-S0 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 26 Mar 2013 12:33:37 +0000
Received: from [192.168.1.120] ([92.151.4.52]) by mwinf5d28 with ME
 id GCZb1l00c17LM8k03CZcaZ; Tue, 26 Mar 2013 13:33:36 +0100
Message-ID: <515195A2.5020501@lexifi.com>
Date: Tue, 26 Mar 2013 13:33:38 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Thomas Gazagnaire <thomas@ocamlpro.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
In-Reply-To: <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 12:26:11 -0000

On 03/26/2013 12:57 PM, Thomas Gazagnaire wrote:
> * is the distinction between top-level items and other items really
> necessary (eg, @ vs. @@) ? This seems to be the only "complex" thing
> to explain, as the other parts of the design nicely sounds rather
> simple.

Consider:

type t = Foo of int [@xxx]

val x: int [@xxx]

module X : S [@xxx]

These are attributes on (module) type expressions.  If we want to 
support such attributes in addition to attributes on the corresponding 
"items" (type, value, module declarations), we need a different syntax.

 > Also I'm not sure to understand why you need/want to annotate
> individual structure items in a recursive type declaration.

type t = X | Y
   [@@sexp]
   [@@doc "This is the type [t], supporting s-exp."]

and s = A | B
   [@@xml]
   [@@doc "This is the type [s], supporting xml."]

> * the doc annotations are the ones where you usually prefer to have
> some kind of prefix notation (eg. you usually read what the function
> / module does before reading its signature). Is the plan to
> automatically transform prefix ocamldoc snippets into suffix
> annotations or to drop the prefix doc snippets completely ?

I don't have any plan to rewrite ocamldoc myself; I only mentioned that 
attributes could be used to drastically simplify the design of ocamldoc, 
avoiding the need to re-parse to source file to find comments.

Concerning the syntax, I tend to write ocamldoc comments *after* 
signature items.  Since the comments often refers to parts of the 
definition (function parameters, constructors, etc), it makes sense to 
do so.  This seems to be the convention adopted in the stdlib, for instance.

When using ocamldoc to generate doc based on implementations, not 
interfaces, it would indeed be more natural to put the description 
before the function definition.  But I don't think that ocamldoc is 
really used like that.  Or is it an important use case for you?


Alain

From thomas.gazagnaire@gmail.com  Tue Mar 26 12:41:46 2013
Return-Path: <thomas.gazagnaire@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5A2B93C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 12:41:46 +0000 (GMT)
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1460549 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.182 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (thomas.gazagnaire[at]gmail.com)
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f182.google.com ([209.85.212.182]:40007)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UKTJN-0003nJ-8r (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <thomas.gazagnaire@gmail.com>); Tue, 26 Mar 2013 12:49:11 +0000
Received: by mail-wi0-f182.google.com with SMTP id hi18so741529wib.15
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 05:49:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:subject:mime-version:content-type:from
 :in-reply-to:date:cc:content-transfer-encoding:message-id:references
 :to:x-mailer; bh=zbjblrPn8vrFb4IiTzPwBUHG78URVo7fPfy3iOcu1kE=;
 b=b+3PXAm+iBYw1lByhU1T51pzps79FreQ/yqY6T+IIvBfWrYA37D6T31oItz+dFHK/m
 Uw8PIv2j+FaskLfdrYqhVGDjc6OtfcZeSCP0GiJfQ3VJ8iKZyK+OBJqTC5i5kSfSdvu+
 Shfl1gg0NaN/SODUBE9KT2nOocgrLY2W6w3W2BXzSAEWMxduefnBdy/scWEK9aHgpq0W
 oDsLjte4jetljguwAvMZ0c+d5OZ9kolf3rYTYbrhYxuvLiLqJRNLmxacerxw5XE4OJMi
 lEHpH6q/mnwtb9Wm6glOUGCYDYmzEKV/yPjnKYer6gzbHoA6kEkk8Lo5S2MBTwFsWZtx
 i5qw==
X-Received: by 10.194.176.34 with SMTP id cf2mr12674569wjc.59.1364302149536;
 Tue, 26 Mar 2013 05:49:09 -0700 (PDT)
Received: from [192.168.0.12] (gou06-3-88-170-165-56.fbx.proxad.net.
 [88.170.165.56])
 by mx.google.com with ESMTPS id k5sm3184099wiy.5.2013.03.26.05.49.07
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Tue, 26 Mar 2013 05:49:08 -0700 (PDT)
Sender: Thomas Gazagnaire <thomas.gazagnaire@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1085)
Content-Type: text/plain; charset=us-ascii
From: Thomas Gazagnaire <thomas@ocamlpro.com>
In-Reply-To: <515195A2.5020501@lexifi.com>
Date: Tue, 26 Mar 2013 13:49:06 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <9A9E5F6A-A828-457F-9030-4AAA88B2B8C7@ocamlpro.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
 <515195A2.5020501@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1085)
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 12:41:46 -0000

>> * is the distinction between top-level items and other items really
>> necessary (eg, @ vs. @@) ? This seems to be the only "complex" thing
>> to explain, as the other parts of the design nicely sounds rather
>> simple.
>=20
> Consider:
>=20
> type t =3D Foo of int [@xxx]
>=20
> val x: int [@xxx]
>=20
> module X : S [@xxx]
>=20
> These are attributes on (module) type expressions.  If we want to =
support such attributes in addition to attributes on the corresponding =
"items" (type, value, module declarations), we need a different syntax.

ok.

> > Also I'm not sure to understand why you need/want to annotate
>> individual structure items in a recursive type declaration.
>=20
> type t =3D X | Y
>  [@@sexp]
>  [@@doc "This is the type [t], supporting s-exp."]
>=20
> and s =3D A | B
>  [@@xml]
>  [@@doc "This is the type [s], supporting xml."]

For the @@sexp and @@xml parts, you won't see that in real-codebases. =
Usually, all the types in a given module/file have their associated =
generators. But ok for the documentation.

> Concerning the syntax, I tend to write ocamldoc comments *after* =
signature items.  Since the comments often refers to parts of the =
definition (function parameters, constructors, etc), it makes sense to =
do so.  This seems to be the convention adopted in the stdlib, for =
instance.

A lot of existing code doesn't follow this convention (JS' core for =
instance). Personally, I found clearer to read what the =
function/type/module does in a comment, before reading its signature.=20

> When using ocamldoc to generate doc based on implementations, not =
interfaces, it would indeed be more natural to put the description =
before the function definition.  But I don't think that ocamldoc is =
really used like that.  Or is it an important use case for you?

I never use ocamldoc on .ml files, so no, it's not important for me.

Thomas



From alain.frisch@lexifi.com  Tue Mar 26 12:51:48 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C620B3C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 12:51:48 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1460549 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:17000
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UKTT7-0007CP-QX (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 26 Mar 2013 12:59:14 +0000
Received: from [192.168.1.120] ([92.151.4.52]) by mwinf5d28 with ME
 id GCzC1l00N17LM8k03CzC6c; Tue, 26 Mar 2013 13:59:12 +0100
Message-ID: <51519BA3.2@lexifi.com>
Date: Tue, 26 Mar 2013 13:59:15 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Thomas Gazagnaire <thomas@ocamlpro.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
 <515195A2.5020501@lexifi.com>
 <9A9E5F6A-A828-457F-9030-4AAA88B2B8C7@ocamlpro.com>
In-Reply-To: <9A9E5F6A-A828-457F-9030-4AAA88B2B8C7@ocamlpro.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 12:51:48 -0000

On 03/26/2013 01:49 PM, Thomas Gazagnaire wrote:
> Personally, I found clearer to read what the function/type/module does in a comment, before reading its signature.

Of course, nothing prevent the tool to show the text before the item in 
the generated doc.  This is really a discussion about where to put the 
text in the source file (we expect users to read the ocamldoc-generated 
documentation, not the source .mli files).

Note that you can write:

;;[@@doc "blabla"]
val f: int -> unit

Here, the attribute is a standalone (floating) signature-item attribute. 
  The tool could interpret such attributes as being attached to the 
following item.  But I don't find it very nice to break the natural 
"scoping" of attributes like that.  (To some extent, the minidoc example 
already does that, since it allows "section headers" to be put on other 
items' attributes.)

ocamldoc uses the same syntax for prefix and postfix notation, and 
relies on heuristics based on concrete placement (including whitespace, 
I believe) in order to attach comments to items.  This is very fragile, 
and it doesn't support some interesting usage scenarios (like 
documentation fragments generated/inserted by -ppx filters).  If we had 
to support a prefix notation for attributes, we would need to introduce 
a different syntax.  We discussed it, but I don't think it is worthwhile 
doing so only for this use case.


-- Alain



From daniel.buenzli@erratique.ch  Tue Mar 26 13:19:20 2013
Return-Path: <daniel.buenzli@erratique.ch>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id EFC683C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 13:19:19 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.6 from SpamAssassin-3.3.2-1460549 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [178.197.233.11 listed in rbl-plus.mail-abuse.ja.net]
 *  0.6 RCVD_IN_SORBS_WEB RBL: SORBS: sender is an abusable web server
 *      [178.197.233.11 listed in dnsbl.sorbs.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail6.webfaction.com ([74.55.86.74]:43003
 helo=smtp.webfaction.com)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UKTtk-0001YC-Sd (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <daniel.buenzli@erratique.ch>); Tue, 26 Mar 2013 13:26:45 +0000
Received: from [172.20.10.2] (11-233.197-178.cust.bluewin.ch [178.197.233.11])
 by smtp.webfaction.com (Postfix) with ESMTP id 236FA20E362C;
 Tue, 26 Mar 2013 13:26:42 +0000 (UTC)
Date: Tue, 26 Mar 2013 14:26:40 +0100
From: =?utf-8?Q?Daniel_B=C3=BCnzli?= <daniel.buenzli@erratique.ch>
To: Thomas Gazagnaire <thomas@ocamlpro.com>
Message-ID: <881B15BF470F4FC3AC20ED82AC08DD6F@erratique.ch>
In-Reply-To: <9A9E5F6A-A828-457F-9030-4AAA88B2B8C7@ocamlpro.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
 <515195A2.5020501@lexifi.com>
 <9A9E5F6A-A828-457F-9030-4AAA88B2B8C7@ocamlpro.com>
X-Mailer: sparrow 1.6.4 (build 1178)
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: inline
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 13:19:20 -0000

Le mardi, 26 mars 2013 =C3=A0 13:49, Thomas Gazagnaire a =C3=A9crit :

> (eg. you usually read what the function / module does before reading it=
s signature).
=5B...=5D =20

> A lot of existing code doesn't follow this convention (JS' core for ins=
tance). Personally, I found clearer to read what the function/type/module=
 does in a comment, before reading its signature.

I also write them after. I think that for *libraries* the =22usually you =
read what the function does before reading its signature=22 is quite deba=
table. =20

=46or a library maybe once or twice you will read an interface from top t=
o bottom, but that's not the average use case. Most of the time you want =
to first *find* a function and then consult its signature (often a brain =
refresh on that is sufficient) and *maybe* read the documentation. =20

=46rom that perspective making the comment after makes it easier to skip =
from one definition to the other: just look for what follows a blank spac=
e.  If comments are before, you have to look for blank space and then mov=
e up again, which incurs direction changes that slows down your scanning.=
 (=46or those that object that CTRL-s does the scanning, I respond that y=
our brain sometimes doesn't remember the exact name you are looking for).=
 =20

Besides having comments after also matches the order in which it appears =
in the generated html, which makes it easier for my brain to switch from =
one representation to the other. =20

These may seem like details, but I think they are relevant from a human f=
actor point of view. =20

Best,

Daniel 

From mike.mcclurg@gmail.com  Tue Mar 26 15:08:28 2013
Return-Path: <mike.mcclurg@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 14BEC3C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 15:08:28 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.8 from SpamAssassin-3.3.2-1460549 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.182 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (mike.mcclurg[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f182.google.com ([74.125.82.182]:65183)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UKVbN-0005NT-qJ (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <mike.mcclurg@gmail.com>); Tue, 26 Mar 2013 15:15:53 +0000
Received: by mail-we0-f182.google.com with SMTP id k14so3569968wer.27
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 08:15:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=BxGafbpd4PBfOdp/USfSD1PJcW3Q9fm8+TaqsM7Ziqs=;
 b=fHVODVlR8xuh1XYJu+Avfq0YwylhJYVT0tLoUrcY7jK7g0kOXO9NuUcZ/mBAp7zR9X
 Q+GFE/nbowcnn2TcWrOj0gvixiRMZvTfVul3Vt1Rxmh5UtCFOpS6mb+U+/F2lazpg9V2
 o/HzpycplrPndaMylAmaJv6ndxuz87AzYkkJEbUJuxMAqLM3MJvnyycCJrfIOYC2tfjv
 hnXNtc9SMOIcokBzonMMU3MMWsW/aItRPXgraipIhFMYfZwbk+yqHMHVBK+07Rvxg4cG
 Q/NIWkYasFTyrnJxxFq5ANCqX+wqlblY5CIA5COvt0WHuKIKWxqH8ePXvsy/hr1Hdrhr
 uwtA==
MIME-Version: 1.0
X-Received: by 10.180.74.131 with SMTP id t3mr3879880wiv.26.1364310952925;
 Tue, 26 Mar 2013 08:15:52 -0700 (PDT)
Received: by 10.217.114.6 with HTTP; Tue, 26 Mar 2013 08:15:52 -0700 (PDT)
In-Reply-To: <51509C4D.9010509@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com>
 <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <83EA4AF5-E403-4CB1-971B-04C82078C183@gmail.com>
 <51509C4D.9010509@lexifi.com>
Date: Tue, 26 Mar 2013 15:15:52 +0000
Message-ID: <CALru5wV2n-+oo1Vy5J=RWKD966hGAFiQ4APKnVcLcNW0L+mxAQ@mail.gmail.com>
From: Mike McClurg <mike.mcclurg@gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=f46d043be130b65fcb04d8d5659b
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 15:08:28 -0000

--f46d043be130b65fcb04d8d5659b
Content-Type: text/plain; charset=ISO-8859-1

Hi Alain,

Thanks for writing up that proposal. Is the code in your extension_points
branch ready for testing at all yet?

On a separate note, might it be a good idea to add an opam-repo-dev
repository to github.com/ocaml, which would provide opam switches for all
the experimental OCaml branches, such as extension_points? Or is there such
an experimental opam repo out there already?

Mike


On Mon, Mar 25, 2013 at 6:49 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> On 03/25/2013 03:13 PM, jathdr wrote:
>
>> Could we get a summary of the current syntax proposal? I've been
>> following along, but I'm a bit lost as to what has been discussed,
>> accepted, rejected, etc.
>>
>
> This file describes the current syntax proposal:
>
> http://caml.inria.fr/cgi-bin/**viewvc.cgi/ocaml/branches/**
> extension_points/experimental/**frisch/extension_points.txt?**
> revision=HEAD&view=markup<http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/extension_points.txt?revision=HEAD&view=markup>
>
>
>
>  This is probably a bit off topic, but while we're talking about
>> interval patterns: I discovered the other day that interval patterns
>> only work for chars, while I always assumed they also worked for
>> ints. Is there a reason why they don't?
>>
>
> Currently, range patterns for characters are expanded in the parser. Doing
> so for integers as well could lead to huge or-patterns to be processed by
> the rest of the compiler.  Supporting range patterns directly in the
> compiler would add a little bit of extra complexity for type-checking
> (exhaustiveness check) and code generation.  I don't see any theoretical
> problem, though.
>
>
> -- Alain
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>

--f46d043be130b65fcb04d8d5659b
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div>Hi Alain,<br><br>Thanks for writing up that proposal.=
 Is the code in your extension_points branch ready for testing at all yet?<=
br><br>On a separate note, might it be a good idea to add an opam-repo-dev =
repository to <a href=3D"http://github.com/ocaml">github.com/ocaml</a>, whi=
ch would provide opam switches for all the experimental OCaml branches, suc=
h as extension_points? Or is there such an experimental opam repo out there=
 already?<br>
<br></div>Mike<br></div><div class=3D"gmail_extra"><br><br><div class=3D"gm=
ail_quote">On Mon, Mar 25, 2013 at 6:49 PM, Alain Frisch <span dir=3D"ltr">=
&lt;<a href=3D"mailto:alain.frisch@lexifi.com" target=3D"_blank">alain.fris=
ch@lexifi.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">On 03/25/2013 03:13 PM, ja=
thdr wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Could we get a summary of the current syntax proposal? I&#39;ve been<br>
following along, but I&#39;m a bit lost as to what has been discussed,<br>
accepted, rejected, etc.<br>
</blockquote>
<br></div>
This file describes the current syntax proposal:<br>
<br>
<a href=3D"http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension=
_points/experimental/frisch/extension_points.txt?revision=3DHEAD&amp;view=
=3Dmarkup" target=3D"_blank">http://caml.inria.fr/cgi-bin/<u></u>viewvc.cgi=
/ocaml/branches/<u></u>extension_points/experimental/<u></u>frisch/extensio=
n_points.txt?<u></u>revision=3DHEAD&amp;view=3Dmarkup</a><div class=3D"im">
<br>
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
This is probably a bit off topic, but while we&#39;re talking about<br>
interval patterns: I discovered the other day that interval patterns<br>
only work for chars, while I always assumed they also worked for<br>
ints. Is there a reason why they don&#39;t?<br>
</blockquote>
<br></div>
Currently, range patterns for characters are expanded in the parser. Doing =
so for integers as well could lead to huge or-patterns to be processed by t=
he rest of the compiler. =A0Supporting range patterns directly in the compi=
ler would add a little bit of extra complexity for type-checking (exhaustiv=
eness check) and code generation. =A0I don&#39;t see any theoretical proble=
m, though.<span class=3D"HOEnZb"><font color=3D"#888888"><br>

<br>
<br>
-- Alain</font></span><div class=3D"HOEnZb"><div class=3D"h5"><br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br></div>

--f46d043be130b65fcb04d8d5659b--

From anil@recoil.org  Tue Mar 26 15:15:41 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0A54D3C544
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 15:15:41 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1460549
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:23531
 helo=dark.recoil.org)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with smtp id 1UKViM-0006dn-Wf (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Tue, 26 Mar 2013 15:23:06 +0000
Received: (qmail 14652 invoked by uid 634); 26 Mar 2013 15:23:01 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from no-dns-yet.demon.co.uk (HELO [192.168.14.198]) (62.49.66.12)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Tue, 26 Mar 2013 15:22:56 +0000
Content-Type: text/plain; charset=iso-8859-1
Mime-Version: 1.0 (Mac OS X Mail 6.3 \(1503\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <CALru5wV2n-+oo1Vy5J=RWKD966hGAFiQ4APKnVcLcNW0L+mxAQ@mail.gmail.com>
Date: Tue, 26 Mar 2013 15:22:54 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <DAF0958C-4577-4694-9348-3BC7A37C8FD4@recoil.org>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <83EA4AF5-E403-4CB1-971B-04C82078C183@gmail.com>
 <51509C4D.9010509@lexifi.com>
 <CALru5wV2n-+oo1Vy5J=RWKD966hGAFiQ4APKnVcLcNW0L+mxAQ@mail.gmail.com>
To: Mike McClurg <mike.mcclurg@gmail.com>
X-Mailer: Apple Mail (2.1503)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org,
 "opam-devel@lists.ocaml.org" <opam-devel@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 15:15:41 -0000

There is no such OPAM remote at the moment, but I think it would be good =
to add one and move out some of the more experimental branches (e.g. =
allocation-profiling) from the main OPAM repo.

Thomas, any objections to me doing this rearrangement in =
OCamlPro/opam-repository?

-anil

On 26 Mar 2013, at 15:15, Mike McClurg <mike.mcclurg@gmail.com> wrote:

> Hi Alain,
>=20
> Thanks for writing up that proposal. Is the code in your =
extension_points branch ready for testing at all yet?
>=20
> On a separate note, might it be a good idea to add an opam-repo-dev =
repository to github.com/ocaml, which would provide opam switches for =
all the experimental OCaml branches, such as extension_points? Or is =
there such an experimental opam repo out there already?
>=20
> Mike
>=20
>=20
> On Mon, Mar 25, 2013 at 6:49 PM, Alain Frisch =
<alain.frisch@lexifi.com> wrote:
> On 03/25/2013 03:13 PM, jathdr wrote:
> Could we get a summary of the current syntax proposal? I've been
> following along, but I'm a bit lost as to what has been discussed,
> accepted, rejected, etc.
>=20
> This file describes the current syntax proposal:
>=20
> =
http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/ex=
perimental/frisch/extension_points.txt?revision=3DHEAD&view=3Dmarkup
>=20
>=20
>=20
> This is probably a bit off topic, but while we're talking about
> interval patterns: I discovered the other day that interval patterns
> only work for chars, while I always assumed they also worked for
> ints. Is there a reason why they don't?
>=20
> Currently, range patterns for characters are expanded in the parser. =
Doing so for integers as well could lead to huge or-patterns to be =
processed by the rest of the compiler.  Supporting range patterns =
directly in the compiler would add a little bit of extra complexity for =
type-checking (exhaustiveness check) and code generation.  I don't see =
any theoretical problem, though.
>=20
>=20
> -- Alain
>=20
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4


From thomas.gazagnaire@gmail.com  Tue Mar 26 15:18:22 2013
Return-Path: <thomas.gazagnaire@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B970B3C475;
 Tue, 26 Mar 2013 15:18:22 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1460549 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.177 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (thomas.gazagnaire[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f177.google.com ([74.125.82.177]:50454)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UKVkx-0007pJ-Yx (Exim 4.72)
 (return-path <thomas.gazagnaire@gmail.com>); Tue, 26 Mar 2013 15:25:48 +0000
Received: by mail-we0-f177.google.com with SMTP id o45so1562997wer.22
 for <multiple recipients>; Tue, 26 Mar 2013 08:25:47 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:sender:subject:mime-version:content-type:from
 :in-reply-to:date:cc:content-transfer-encoding:message-id:references
 :to:x-mailer; bh=PYTiFflnF5d6sjFG9hd32J6iCudcAC/WlU6BjIzhd0o=;
 b=nO98JTXzebOeD81xuqn5K33AeYecQNA+svXUIi6cQIUJphbm97GR0ifC8XXmzYGunH
 hhCdJb9U/SgyhRFAduaHLa58gnT5S5h0uUGDhd2zVoxSzs/OyUOHbrZ+Fcdak28cjFcC
 IjnUArU8ABBCRFouLfgiGfp00q6XuOB1PjwKsUkNBm1o2RvyLGqnPXfDte9ehaShsaDt
 85P8sx0D7pN3bIvegvud8GQsYnb8SpSUOl9z5o41Ku9u6dICSxXqsFJQRmDSGW/i5MQ3
 vlbxAu+FDHVpD/BveLqfnFHBHJyDcve74QFQwDf+sQWbDSidHn9szHHVp1H5WDKfXxnH
 AlVQ==
X-Received: by 10.180.10.105 with SMTP id h9mr3955416wib.34.1364311547491;
 Tue, 26 Mar 2013 08:25:47 -0700 (PDT)
Received: from [192.168.0.12] (gou06-3-88-170-165-56.fbx.proxad.net.
 [88.170.165.56])
 by mx.google.com with ESMTPS id dp5sm3584441wib.1.2013.03.26.08.25.45
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Tue, 26 Mar 2013 08:25:46 -0700 (PDT)
Sender: Thomas Gazagnaire <thomas.gazagnaire@gmail.com>
Mime-Version: 1.0 (Apple Message framework v1085)
Content-Type: text/plain; charset=us-ascii
From: Thomas Gazagnaire <thomas@ocamlpro.com>
In-Reply-To: <DAF0958C-4577-4694-9348-3BC7A37C8FD4@recoil.org>
Date: Tue, 26 Mar 2013 16:25:44 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <F67CCC6A-1F88-4092-9108-1B792FDE6757@ocamlpro.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <83EA4AF5-E403-4CB1-971B-04C82078C183@gmail.com>
 <51509C4D.9010509@lexifi.com>
 <CALru5wV2n-+oo1Vy5J=RWKD966hGAFiQ4APKnVcLcNW0L+mxAQ@mail.gmail.com>
 <DAF0958C-4577-4694-9348-3BC7A37C8FD4@recoil.org>
To: Anil Madhavapeddy <anil@recoil.org>
X-Mailer: Apple Mail (2.1085)
Cc: wg-camlp4@lists.ocaml.org,
 "opam-devel@lists.ocaml.org" <opam-devel@lists.ocaml.org>
Subject: Re: [wg-camlp4] [opam-devel]  Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 15:18:22 -0000

> Thomas, any objections to me doing this rearrangement in =
OCamlPro/opam-repository?

No pb. I am just a bit concerned with the list of compilers growing =
unbounded, but for now I think it's completely fine.

Thomas

>=20
> -anil
>=20
> On 26 Mar 2013, at 15:15, Mike McClurg <mike.mcclurg@gmail.com> wrote:
>=20
>> Hi Alain,
>>=20
>> Thanks for writing up that proposal. Is the code in your =
extension_points branch ready for testing at all yet?
>>=20
>> On a separate note, might it be a good idea to add an opam-repo-dev =
repository to github.com/ocaml, which would provide opam switches for =
all the experimental OCaml branches, such as extension_points? Or is =
there such an experimental opam repo out there already?
>>=20
>> Mike
>>=20
>>=20
>> On Mon, Mar 25, 2013 at 6:49 PM, Alain Frisch =
<alain.frisch@lexifi.com> wrote:
>> On 03/25/2013 03:13 PM, jathdr wrote:
>> Could we get a summary of the current syntax proposal? I've been
>> following along, but I'm a bit lost as to what has been discussed,
>> accepted, rejected, etc.
>>=20
>> This file describes the current syntax proposal:
>>=20
>> =
http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/ex=
perimental/frisch/extension_points.txt?revision=3DHEAD&view=3Dmarkup
>>=20
>>=20
>>=20
>> This is probably a bit off topic, but while we're talking about
>> interval patterns: I discovered the other day that interval patterns
>> only work for chars, while I always assumed they also worked for
>> ints. Is there a reason why they don't?
>>=20
>> Currently, range patterns for characters are expanded in the parser. =
Doing so for integers as well could lead to huge or-patterns to be =
processed by the rest of the compiler.  Supporting range patterns =
directly in the compiler would add a little bit of extra complexity for =
type-checking (exhaustiveness check) and code generation.  I don't see =
any theoretical problem, though.
>>=20
>>=20
>> -- Alain
>>=20
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>>=20
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
> _______________________________________________
> opam-devel mailing list
> opam-devel@lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From anil@recoil.org  Tue Mar 26 15:19:56 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 09DA73C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 15:19:56 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1460549
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:45703
 helo=dark.recoil.org)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with smtp id 1UKVmT-0008VF-Wi (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Tue, 26 Mar 2013 15:27:21 +0000
Received: (qmail 25433 invoked by uid 634); 26 Mar 2013 15:27:21 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from no-dns-yet.demon.co.uk (HELO [192.168.14.198]) (62.49.66.12)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Tue, 26 Mar 2013 15:27:20 +0000
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Mac OS X Mail 6.3 \(1503\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <F67CCC6A-1F88-4092-9108-1B792FDE6757@ocamlpro.com>
Date: Tue, 26 Mar 2013 15:27:19 +0000
Content-Transfer-Encoding: quoted-printable
Message-Id: <F7606EEE-F157-4128-8D1D-009028FD055C@recoil.org>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <83EA4AF5-E403-4CB1-971B-04C82078C183@gmail.com>
 <51509C4D.9010509@lexifi.com>
 <CALru5wV2n-+oo1Vy5J=RWKD966hGAFiQ4APKnVcLcNW0L+mxAQ@mail.gmail.com>
 <DAF0958C-4577-4694-9348-3BC7A37C8FD4@recoil.org>
 <F67CCC6A-1F88-4092-9108-1B792FDE6757@ocamlpro.com>
To: Thomas Gazagnaire <thomas@ocamlpro.com>
X-Mailer: Apple Mail (2.1503)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org,
 "opam-devel@lists.ocaml.org" <opam-devel@lists.ocaml.org>
Subject: Re: [wg-camlp4] [opam-devel]  Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 15:19:56 -0000

On 26 Mar 2013, at 15:25, Thomas Gazagnaire <thomas@ocamlpro.com> wrote:

>> Thomas, any objections to me doing this rearrangement in =
OCamlPro/opam-repository?
>=20
> No pb. I am just a bit concerned with the list of compilers growing =
unbounded, but for now I think it's completely fine.
>=20

Right, so this would reduce the number of compilers in =
OCamlPro/opam-repository and move them to this experimental one.

I wonder if it's time to have an OPAM remotes discovery service :-)

-anil



> Thomas
>=20
>>=20
>> -anil
>>=20
>> On 26 Mar 2013, at 15:15, Mike McClurg <mike.mcclurg@gmail.com> =
wrote:
>>=20
>>> Hi Alain,
>>>=20
>>> Thanks for writing up that proposal. Is the code in your =
extension_points branch ready for testing at all yet?
>>>=20
>>> On a separate note, might it be a good idea to add an opam-repo-dev =
repository to github.com/ocaml, which would provide opam switches for =
all the experimental OCaml branches, such as extension_points? Or is =
there such an experimental opam repo out there already?
>>>=20
>>> Mike
>>>=20
>>>=20
>>> On Mon, Mar 25, 2013 at 6:49 PM, Alain Frisch =
<alain.frisch@lexifi.com> wrote:
>>> On 03/25/2013 03:13 PM, jathdr wrote:
>>> Could we get a summary of the current syntax proposal? I've been
>>> following along, but I'm a bit lost as to what has been discussed,
>>> accepted, rejected, etc.
>>>=20
>>> This file describes the current syntax proposal:
>>>=20
>>> =
http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/ex=
perimental/frisch/extension_points.txt?revision=3DHEAD&view=3Dmarkup
>>>=20
>>>=20
>>>=20
>>> This is probably a bit off topic, but while we're talking about
>>> interval patterns: I discovered the other day that interval patterns
>>> only work for chars, while I always assumed they also worked for
>>> ints. Is there a reason why they don't?
>>>=20
>>> Currently, range patterns for characters are expanded in the parser. =
Doing so for integers as well could lead to huge or-patterns to be =
processed by the rest of the compiler.  Supporting range patterns =
directly in the compiler would add a little bit of extra complexity for =
type-checking (exhaustiveness check) and code generation.  I don't see =
any theoretical problem, though.
>>>=20
>>>=20
>>> -- Alain
>>>=20
>>> _______________________________________________
>>> wg-camlp4 mailing list
>>> wg-camlp4@lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/wg-camlp4
>>>=20
>>> _______________________________________________
>>> wg-camlp4 mailing list
>>> wg-camlp4@lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/wg-camlp4
>>=20
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
>=20


From alain.frisch@lexifi.com  Tue Mar 26 16:00:13 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9BFC33C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 16:00:13 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1460549 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:52304
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UKWPT-0001do-XE (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 26 Mar 2013 16:07:39 +0000
Received: from [192.168.1.120] ([92.151.4.52]) by mwinf5d28 with ME
 id GG7e1l00H17LM8k03G7eLn; Tue, 26 Mar 2013 17:07:39 +0100
Message-ID: <5151C7CE.7040500@lexifi.com>
Date: Tue, 26 Mar 2013 17:07:42 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Thomas Gazagnaire <thomas@ocamlpro.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
 <515195A2.5020501@lexifi.com>
 <9A9E5F6A-A828-457F-9030-4AAA88B2B8C7@ocamlpro.com>
In-Reply-To: <9A9E5F6A-A828-457F-9030-4AAA88B2B8C7@ocamlpro.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 16:00:13 -0000

On 03/26/2013 01:49 PM, Thomas Gazagnaire wrote:
> For the @@sexp and @@xml parts, you won't see that in real-codebases. Usually, all the types in a given module/file have their associated generators.

This is rather minor (especially considering that other use cases are 
sufficient to justify "item" attributes on individual types), but isn't 
it possible to provide a custom function for a specific type instead of 
asking the extension to generate the function?


-- Alain

From alain.frisch@lexifi.com  Tue Mar 26 16:03:59 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 041763C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 16:03:59 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1460549 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:47603
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UKWT6-0003E4-Xb (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 26 Mar 2013 16:11:24 +0000
Received: from [192.168.1.120] ([92.151.4.52]) by mwinf5d28 with ME
 id GGBQ1l00617LM8k03GBQYl; Tue, 26 Mar 2013 17:11:24 +0100
Message-ID: <5151C8B0.9000901@lexifi.com>
Date: Tue, 26 Mar 2013 17:11:28 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Mike McClurg <mike.mcclurg@gmail.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <83EA4AF5-E403-4CB1-971B-04C82078C183@gmail.com>
 <51509C4D.9010509@lexifi.com>
 <CALru5wV2n-+oo1Vy5J=RWKD966hGAFiQ4APKnVcLcNW0L+mxAQ@mail.gmail.com>
In-Reply-To: <CALru5wV2n-+oo1Vy5J=RWKD966hGAFiQ4APKnVcLcNW0L+mxAQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 16:03:59 -0000

On 03/26/2013 04:15 PM, Mike McClurg wrote:
> Hi Alain,
>
> Thanks for writing up that proposal. Is the code in your
> extension_points branch ready for testing at all yet?

Some more work will be done later, so if you write code now against the 
branch (-ppx rewriters or tools based on .cmt/.cmti files), it might 
break in the future.  But otherwise, yes, the branch is ready for 
testing and feedback will be appreciated.

The branch can be obtained with:

svn co http://caml.inria.fr/svn/ocaml/branches/extension_points


-- Alain

From lpw25@cam.ac.uk  Tue Mar 26 19:47:15 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7513C3C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 19:47:15 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from cpc2-cmbg14-2-0-cust33.5-4.cable.virginmedia.com
 ([86.26.0.34]:54773 helo=study.localdomain)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UKZxB-0002n1-qx (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Tue, 26 Mar 2013 19:54:41 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
Date: Tue, 26 Mar 2013 19:56:49 +0000
In-Reply-To: <515187C8.2030109@lexifi.com> (Alain Frisch's message of "Tue, 26
 Mar 2013 12:34:32 +0100")
Message-ID: <87620e6ike.fsf@study.localdomain>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 19:47:15 -0000

> On 03/25/2013 03:05 PM, Leo White wrote:
>> Another small clean-up I'd like would be to change "ptype_params" from
>> "string loc option list" to "core_type list" and the first part of
>> "pci_params" from "string loc list" to "core_type list".
>
> Would you change the parser to accept arbitrary types (instead of _ and type variables), and enforce the previous
> constraint in the type-checker?  

It might be better to get a syntax error there as it's probably
a common beginner mistake. On the other hand, if the error from the type
checker is nice and clear then it shouldn't be a problem. Either way, we
might as well support extensions and attributes there.

> I've committed this change, using {x| ... |x} instead of {x{ ... }x} (this just looks more readable to me; feel free to
> object).

I slightly prefer {{ ... }} but either seems fine.

> In this syntax, x is an arbitrary (possibly empty) sequence of lowercase letters, no whitespaces allowed
> between { and |.

It might be better for x to be a sequence of operator symbols (and maybe
numbers), since most lexical tokens in OCaml are all symbols or all
characters, but this is probably a matter of taste.

> Another change I've committed recently is an update to the Typedtree representation, to bring it closer to the current
> state of the Parsetree, including attributes.  This makes it possible for external tools to process attributes in
> .cmt/.cmti files.  I've committed an example of a "mini-ocamldoc" based on this technique:
>
>
> http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/minidoc.ml?revision=HEAD&view=markup
>
> http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/testdoc.mli?revision=HEAD&view=markup 
>
>
>
> Leo: you mentioned that you're working on a revised ocamldoc.  Do you have plans to have it rely on attributes?

My plans, which are about half implemented, are for the compiler (or
ocamldoc) to be able to produce a ".cmd" file describing the
documentation for a module. Then tools can combine this file with a
".cmt" file to produce the actual documentation.

The ".cmd" file is kept separate from the ".cmt" to make it easier to do
things like providing multiple translations for documentation, creating
documentation not related to a source file, or using a single
documentation article for multiple source files.

While I think that comments are a good place for documentation, and will
primarily support the current ocamldoc format, it would be very simple
to write a "-ppx" that created a ".cmd" file from attributes. It would
also be very easy to write a tool that extracted a ".cmd" file from the
attributes in a ".cmt" file.

From lpw25@cam.ac.uk  Tue Mar 26 19:48:56 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 339023C475
 for <wg-camlp4@lists.ocaml.org>; Tue, 26 Mar 2013 19:48:56 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from cpc2-cmbg14-2-0-cust33.5-4.cable.virginmedia.com
 ([86.26.0.34]:38275 helo=study.localdomain)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UKZyo-0007sU-Qy (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Tue, 26 Mar 2013 19:56:22 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <201C3856-0344-47E0-A506-879068D2865C@ocamlpro.com>
 <515195A2.5020501@lexifi.com>
 <9A9E5F6A-A828-457F-9030-4AAA88B2B8C7@ocamlpro.com>
 <5151C7CE.7040500@lexifi.com>
Date: Tue, 26 Mar 2013 19:58:31 +0000
In-Reply-To: <5151C7CE.7040500@lexifi.com> (Alain Frisch's message of "Tue, 26
 Mar 2013 17:07:42 +0100")
Message-ID: <871ub26ihk.fsf@study.localdomain>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 26 Mar 2013 19:48:56 -0000

> This is rather minor (especially considering that other use cases are sufficient to justify "item" attributes on
> individual types), but isn't it possible to provide a custom function for a specific type instead of asking the
> extension to generate the function?

You can, but it is difficult to do it for mutually recursive types since the
functions will probably also have to be mutually recursive.

From info@gerd-stolpmann.de  Thu Mar 28 16:06:06 2013
Return-Path: <info@gerd-stolpmann.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 85A7B3C170
 for <wg-camlp4@lists.ocaml.org>; Thu, 28 Mar 2013 16:06:06 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1461449 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.227.126.186 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from moutng.kundenserver.de ([212.227.126.186]:56020)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1ULFSM-0008Gm-qq (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <info@gerd-stolpmann.de>); Thu, 28 Mar 2013 16:13:39 +0000
Received: from office1.lan.sumadev.de (dslb-094-219-220-119.pools.arcor-ip.net
 [94.219.220.119])
 by mrelayeu.kundenserver.de (node=mrbap0) with ESMTP (Nemesis)
 id 0MXEu5-1U78RI0E0z-00WHz5; Thu, 28 Mar 2013 17:13:37 +0100
Received: from samsung (ip-5-146-55-186.unitymediagroup.de [5.146.55.186])
 by office1.lan.sumadev.de (Postfix) with ESMTPSA id A184AC00D0;
 Thu, 28 Mar 2013 17:13:36 +0100 (CET)
Date: Thu, 28 Mar 2013 17:13:36 +0100
From: Gerd Stolpmann <info@gerd-stolpmann.de>
To: Alain Frisch <alain.frisch@lexifi.com>
In-Reply-To: <51509C4D.9010509@lexifi.com> (from alain.frisch@lexifi.com on
 Mon Mar 25 19:49:49 2013)
X-Mailer: Balsa 2.4.11
Message-Id: <1364487216.14693.6@samsung>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii; DelSp=Yes; Format=Flowed
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable
X-Provags-ID: V02:K0:xIMCUeFo21eLR3JEvzhkdhoj83knUHgFxc9k52545Dw
 6hDyeiimbhDDOIPcOKNLaNcjj1de9Fp/SSl03x59TEILMbVek/
 49Z5D7HTvOG2Wd1kpgJHACnymGP+sinulfAb31UzN84RADbNfB
 hTYCqODveH+6D9o9+Mtsg/112tJAiOtKq8JrtPmScBzX9o0S7G
 vT4W2bEREKJgp5mVNLFk61zS9YjoXhMg6HncBMwWVSpxuLHuhY
 oisMA0gtBOXTOBkdJ2QsgtTel19Sn9+MVSKGt4tMEGbQVskS3Y
 2PkFeGossb5rZB29z0GkUGFSoL93Yl1NnvWGNvrjI4BeRIE5OW
 Le6SAyjIWLbkHr+88mYW0OE7LtGqjGyN0GyQNGGFE
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 28 Mar 2013 16:06:06 -0000

Am 25.03.2013 19:49:49 schrieb(en) Alain Frisch:
> On 03/25/2013 03:13 PM, jathdr wrote:
>> Could we get a summary of the current syntax proposal? I've been
>> following along, but I'm a bit lost as to what has been discussed,
>> accepted, rejected, etc.
>=20
> This file describes the current syntax proposal:
>=20
> http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/e=
xperimental/frisch/extension_points.txt?revision=3DHEAD&view=3Dmarkup

Two little comments:

  - So far, a begin/end pair can always be replaced by normal =20
parentheses.
    The "keyword" rules do not allow it so far - when we have
    begin [@foo] ... end, why not also allow ([@foo] ...) ?

    (Currently, it's even possible to use begin/end and parentheses
    in a mixed way, like ( ... end - maybe also get rid of this
    asymmetry, as we are at syntax?)

  - Am I right that we get a new form of commenting out code blocks?

    (* {ignore| commented out text can almost contain anything |ignore} =20
*)

    That would be helpful to comment out blocks that violate the lexing
    rules.



>=20
>> This is probably a bit off topic, but while we're talking about
>> interval patterns: I discovered the other day that interval patterns
>> only work for chars, while I always assumed they also worked for
>> ints. Is there a reason why they don't?
>=20
> Currently, range patterns for characters are expanded in the parser. =20
> Doing so for integers as well could lead to huge or-patterns to be =20
> processed by the rest of the compiler.  Supporting range patterns =20
> directly in the compiler would add a little bit of extra complexity =20
> for type-checking (exhaustiveness check) and code generation.  I =20
> don't see any theoretical problem, though.
>=20
>=20
> -- Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>=20


--=20
------------------------------------------------------------
Gerd Stolpmann, Darmstadt, Germany    gerd@gerd-stolpmann.de
Creator of GODI and camlcity.org.
Contact details:        http://www.camlcity.org/contact.html
Company homepage:       http://www.gerd-stolpmann.de
------------------------------------------------------------=

From alain.frisch@lexifi.com  Thu Mar 28 21:46:42 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B259D3C170
 for <wg-camlp4@lists.ocaml.org>; Thu, 28 Mar 2013 21:46:42 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1461449 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:34709)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1ULKlz-0008W8-R6 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 28 Mar 2013 21:54:15 +0000
Received: from [192.168.0.10] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id E6465A62B3;
 Thu, 28 Mar 2013 22:54:10 +0100 (CET)
Message-ID: <5154BC01.1060401@lexifi.com>
Date: Thu, 28 Mar 2013 22:54:09 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130307 Thunderbird/17.0.4
MIME-Version: 1.0
To: Gerd Stolpmann <info@gerd-stolpmann.de>
References: <1364487216.14693.6@samsung>
In-Reply-To: <1364487216.14693.6@samsung>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 28 Mar 2013 21:46:42 -0000

On 3/28/2013 5:13 PM, Gerd Stolpmann wrote:
>   - So far, a begin/end pair can always be replaced by normal parentheses.
>     The "keyword" rules do not allow it so far - when we have
>     begin [@foo] ... end, why not also allow ([@foo] ...) ?

This (and also (%foo ...)) used to be recognized, but there has been 
some resistance to it.  I don't have a strong opinion on this topic and 
it will always be possible to add more syntax if the current one turns 
out to be inconvenient in some cases.

>     (Currently, it's even possible to use begin/end and parentheses
>     in a mixed way, like ( ... end - maybe also get rid of this
>     asymmetry, as we are at syntax?)

I don't think that this mixed syntax is actually accepted.


>   - Am I right that we get a new form of commenting out code blocks?
>
>     (* {ignore| commented out text can almost contain anything |ignore} *)
>
>     That would be helpful to comment out blocks that violate the lexing
>     rules.

It is not currently supported in the branch (quoted strings are not 
recognized within comments), but this is a bug.  You're right that it 
will allow to embed non-lexable data (even binary, if you wish) in comments.

-- Alain

From lpw25@cam.ac.uk  Thu Mar 28 22:59:35 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5927F3C170
 for <wg-camlp4@lists.ocaml.org>; Thu, 28 Mar 2013 22:59:35 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from cpc2-cmbg14-2-0-cust33.5-4.cable.virginmedia.com
 ([86.26.0.34]:42188 helo=study.localdomain)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1ULLuW-0006Ok-rT (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Thu, 28 Mar 2013 23:07:08 +0000
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <1364487216.14693.6@samsung> <5154BC01.1060401@lexifi.com>
Date: Thu, 28 Mar 2013 23:09:19 +0000
In-Reply-To: <5154BC01.1060401@lexifi.com> (Alain Frisch's message of "Thu, 28
 Mar 2013 22:54:09 +0100")
Message-ID: <87ehezjf4w.fsf@study.localdomain>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 28 Mar 2013 22:59:35 -0000

>>   - So far, a begin/end pair can always be replaced by normal parentheses.
>>     The "keyword" rules do not allow it so far - when we have
>>     begin [@foo] ... end, why not also allow ([@foo] ...) ?
>
> This (and also (%foo ...)) used to be recognized, but there has been some resistance to it.  I don't have a strong
> opinion on this topic and it will always be possible to add more syntax if the current one turns out to be inconvenient
> in some cases.

Note that my objection was to "(% foo ...)", I have no problem with
"([@foo ...] ...)".

From alain.frisch@lexifi.com  Fri Mar 29 12:56:34 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 51CA33C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 12:56:34 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1461994 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:20173
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1ULYyX-0007Gg-WV (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 29 Mar 2013 13:04:09 +0000
Received: from [192.168.1.120] ([92.151.115.78]) by mwinf5d61 with ME
 id HR471l00o1hZWdG03R47rf; Fri, 29 Mar 2013 14:04:08 +0100
Message-ID: <51559149.2020900@lexifi.com>
Date: Fri, 29 Mar 2013 14:04:09 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Xavier Clerc <xavier.clerc@inria.fr>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr>
In-Reply-To: <5107F74E.8010603@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 29 Mar 2013 12:56:34 -0000

On 01/29/2013 05:22 PM, Alain Frisch wrote:
> On 01/29/2013 04:37 PM, Xavier Clerc wrote:
>> However, during development,
>> it was a time-saver to be able to easily express and experiment new
>> ideas by manipulating "bits of the actual language". Camlp4 was kind
>> enough to translate them for me into AST code which I had to check.
>
> What about having a tool (either stand-alone or part of the compilers)
> which dumps the Parsetree representation of some code fragment in as
> textual OCaml values (probably without locations)?
>
> So you can type your "model" as source code and obtain quickly the
> Parsetree representation, copy/paste it into a nice pattern and replace
> some parts with variables.

I've hacked a quick implementation of such a tool, reusing the generic 
value printer from the toplevel:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/tools/dump_ast.ml?revision=HEAD&view=markup

It parses either command-line arguments (currently, as types, 
expressions or patterns) or external .ml/.mli files, and shows the 
internal Parsetree representation.  By default, location and empty 
attribute fields are removed (they can be restored with command-line 
flags: -locs and -emptyattrs).

Examples:

$ ./ocamlast -w 50 -e "1 + x [@attr] * 2"
{pexp_desc =
   Pexp_apply
    ({pexp_desc = Pexp_ident {txt = Lident "*"}},
    [("",
      {pexp_desc =
        Pexp_apply
         ({pexp_desc =
            Pexp_ident {txt = Lident "+"}},
         [("",
           {pexp_desc =
             Pexp_constant (Const_int 1)});
          ("",
           {pexp_desc =
             Pexp_ident {txt = Lident "x"}})]);
       pexp_attributes =
        [("attr",
          {pexp_desc =
            Pexp_construct ({txt = Lident "()"},
             None, false)})]});
     ("",
      {pexp_desc = Pexp_constant (Const_int 2)})])}


$ ./ocamlast -w 50 -emptyattrs -t "int list * string"
{ptyp_desc =
   Ptyp_tuple
    [{ptyp_desc =
       Ptyp_constr ({txt = Lident "list"},
        [{ptyp_desc =
           Ptyp_constr ({txt = Lident "int"}, []);
          ptyp_attributes = []}]);
      ptyp_attributes = []};
     {ptyp_desc =
       Ptyp_constr ({txt = Lident "string"}, []);
      ptyp_attributes = []}];
  ptyp_attributes = []}


This should should simplify the learning curve of the Parsetree, and 
even allow quick copy/paste to write patterns/expressions on Parsetree. 
  That said, creating Parsetree fragments manually is quite tedious, and 
I've created a module to make this easier:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/parsing/ast_helper.mli?revision=HEAD&view=markup

Currently, this module exposes "builder functions" which are very close 
to Parsetree constructors/records (making locations and attributes 
optional), but one can easily improve its interface (either by changing 
the existing functions, e.g. to use optional and labelled arguments, or 
by exposing other function to cover common cases).


Alain

From gabriel.scherer@gmail.com  Fri Mar 29 13:39:53 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 916DE3C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 13:39:53 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1461994 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.172 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f172.google.com ([209.85.128.172]:35287)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1ULZeR-00026A-SW (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 29 Mar 2013 13:47:29 +0000
Received: by mail-ve0-f172.google.com with SMTP id oz10so547003veb.17
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 06:47:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=uDI3A1yttg5rgXgj8bTX9eX9+Cf6TH3rb9Jeyc9HWC0=;
 b=z+Urapw+nX5RXTH91ror12LjfVDaIPxRNEovSsfzMYVbNGJIuHYyxMZsDAimraN4mv
 jwvB8MmO/Cc2ZLsJO4QvnJ7ZGAt35UB3C40GBNNVFCI/GirN9WtsxQtgYEadUiA1MFCc
 Ms3k9cBj84CvrPiJwKEDAfam3uM/eVHDwEGD9kfpM7Pdd/eNTSQMG5u795Kna+35uwMo
 Htj9ALzw2xu/qinmYcPyBa3oaUNB9m/jlWLngo+J832rks0UrgGc+NFrsBJFWftZbzRp
 DD9U+uW5bqvM7VLHZmVdtmzRL0GatSt1irDv3BZe3b3HdWGrw39BZMmHoJSky4G/DZP/
 aFWg==
X-Received: by 10.52.245.6 with SMTP id xk6mr1489963vdc.114.1364564847102;
 Fri, 29 Mar 2013 06:47:27 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.58.233.13 with HTTP; Fri, 29 Mar 2013 06:46:47 -0700 (PDT)
In-Reply-To: <51559149.2020900@lexifi.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 29 Mar 2013 14:46:47 +0100
Message-ID: <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=089e0158b3aafc11fe04d9108221
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 29 Mar 2013 13:39:53 -0000

--089e0158b3aafc11fe04d9108221
Content-Type: text/plain; charset=ISO-8859-1

Would it be possible to use the extension mechanism itself for lightweight
quasiquotations?

I did a small experiment with -ppx recently (
http://gallium.inria.fr/blog/a-library-to-record-ocaml-backtraces/smartcatch_ppx.ml,
as a contribution to Jacques-Henri Jourdan's work on
http://gallium.inria.fr/blog/a-library-to-record-ocaml-backtraces/ ), and
frankly the absence of quasiquotations felt like a pain in the ass. Compare
the camlp4 part of the relevant code:

  let add_debug_expr _loc patvar e =
    <:expr<
        let _ = ExceptionHandling.register $lid:patvar$ in
        $e$
    >>

with the Ast_rewriter equivalent (the recommended solution alongside -ppx
right now):

let add_register patvar body =
  let open Ast_mapper in
  let register_fun = Location.mknoloc (Longident.parse
"ExceptionHandling.register") in
  (* let _ = <register_fun> <patvar> in <body> *)
  E.(let_ Nonrecursive
       [P.any (), apply (ident register_fun)  ["", ident patvar]]
       body)

There is a gap of readability, maintainability but also writability between
the two approaches. I suspect that the Ast_mapper.E domain-specific
language could be improved to reduce it, but I'm not sure quasiquotations
are not the best long-term solution. But maybe we can have quasiquotations
with the current extension mechanism?

let add_register patvar body =
  [%quote
    let _ = ExceptionHandling.register [%anti patvar] in [%anti body]
  ]


I'm rather interested in getting ideas of how this actually would work and
fleshing it out.

(Note that the problem here is to have a convenient way to write little
pieces of OCaml AST when you program AST-to-AST filters of any kind. This
is a restricted use case as compared to Camlp4 quasiquotations conventions,
that offer facilities for antiquotations inside foreign quotations
implementing a completely different syntax. I used the latter in Macaque,
and they are exposed to end-users, so user-friendliness of the
antiquotation syntax was important. Here it's only for extension *writers*,
so it's ok if it's *a bit* heavy.)

On Fri, Mar 29, 2013 at 2:04 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> On 01/29/2013 05:22 PM, Alain Frisch wrote:
>
>> On 01/29/2013 04:37 PM, Xavier Clerc wrote:
>>
>>> However, during development,
>>> it was a time-saver to be able to easily express and experiment new
>>> ideas by manipulating "bits of the actual language". Camlp4 was kind
>>> enough to translate them for me into AST code which I had to check.
>>>
>>
>> What about having a tool (either stand-alone or part of the compilers)
>> which dumps the Parsetree representation of some code fragment in as
>> textual OCaml values (probably without locations)?
>>
>> So you can type your "model" as source code and obtain quickly the
>> Parsetree representation, copy/paste it into a nice pattern and replace
>> some parts with variables.
>>
>
> I've hacked a quick implementation of such a tool, reusing the generic
> value printer from the toplevel:
>
> http://caml.inria.fr/cgi-bin/**viewvc.cgi/ocaml/branches/**
> extension_points/tools/dump_**ast.ml?revision=HEAD&view=**markup<http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/tools/dump_ast.ml?revision=HEAD&view=markup>
>
> It parses either command-line arguments (currently, as types, expressions
> or patterns) or external .ml/.mli files, and shows the internal Parsetree
> representation.  By default, location and empty attribute fields are
> removed (they can be restored with command-line flags: -locs and
> -emptyattrs).
>
> Examples:
>
> $ ./ocamlast -w 50 -e "1 + x [@attr] * 2"
> {pexp_desc =
>   Pexp_apply
>    ({pexp_desc = Pexp_ident {txt = Lident "*"}},
>    [("",
>      {pexp_desc =
>        Pexp_apply
>         ({pexp_desc =
>            Pexp_ident {txt = Lident "+"}},
>         [("",
>           {pexp_desc =
>             Pexp_constant (Const_int 1)});
>          ("",
>           {pexp_desc =
>             Pexp_ident {txt = Lident "x"}})]);
>       pexp_attributes =
>        [("attr",
>          {pexp_desc =
>            Pexp_construct ({txt = Lident "()"},
>             None, false)})]});
>     ("",
>      {pexp_desc = Pexp_constant (Const_int 2)})])}
>
>
> $ ./ocamlast -w 50 -emptyattrs -t "int list * string"
> {ptyp_desc =
>   Ptyp_tuple
>    [{ptyp_desc =
>       Ptyp_constr ({txt = Lident "list"},
>        [{ptyp_desc =
>           Ptyp_constr ({txt = Lident "int"}, []);
>          ptyp_attributes = []}]);
>      ptyp_attributes = []};
>     {ptyp_desc =
>       Ptyp_constr ({txt = Lident "string"}, []);
>      ptyp_attributes = []}];
>  ptyp_attributes = []}
>
>
> This should should simplify the learning curve of the Parsetree, and even
> allow quick copy/paste to write patterns/expressions on Parsetree.  That
> said, creating Parsetree fragments manually is quite tedious, and I've
> created a module to make this easier:
>
> http://caml.inria.fr/cgi-bin/**viewvc.cgi/ocaml/branches/**
> extension_points/parsing/ast_**helper.mli?revision=HEAD&view=**markup<http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/parsing/ast_helper.mli?revision=HEAD&view=markup>
>
> Currently, this module exposes "builder functions" which are very close to
> Parsetree constructors/records (making locations and attributes optional),
> but one can easily improve its interface (either by changing the existing
> functions, e.g. to use optional and labelled arguments, or by exposing
> other function to cover common cases).
>
>
>
> Alain
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>

--089e0158b3aafc11fe04d9108221
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div>Would it be possible to use the extension mechanism i=
tself for lightweight quasiquotations?<br><br>I did a small experiment with=
 -ppx recently ( <a href=3D"http://gallium.inria.fr/blog/a-library-to-recor=
d-ocaml-backtraces/smartcatch_ppx.ml" target=3D"_blank">http://gallium.inri=
a.fr/blog/a-library-to-record-ocaml-backtraces/smartcatch_ppx.ml</a>, as a =
contribution to Jacques-Henri Jourdan&#39;s work on <a href=3D"http://galli=
um.inria.fr/blog/a-library-to-record-ocaml-backtraces/" target=3D"_blank">h=
ttp://gallium.inria.fr/blog/a-library-to-record-ocaml-backtraces/</a> ), an=
d frankly the absence of quasiquotations felt like a pain in the ass. Compa=
re the camlp4 part of the relevant code:<br>



<br><pre>  let add_debug_expr _loc patvar e =3D
    &lt;:expr&lt;
        let _ =3D ExceptionHandling.register $lid:patvar$ in
        $e$
    &gt;&gt;<br></pre></div><div>with the Ast_rewriter equivalent (the reco=
mmended solution alongside -ppx right now):<br><pre>let add_register patvar=
 body =3D
  let open Ast_mapper in
  let register_fun =3D Location.mknoloc (Longident.parse &quot;ExceptionHan=
dling.register&quot;) in
  (* let _ =3D &lt;register_fun&gt; &lt;patvar&gt; in &lt;body&gt; *)
  E.(let_ Nonrecursive
       [P.any (), apply (ident register_fun)  [&quot;&quot;, ident patvar]]
       body)<br></pre></div><div>There is a gap of readability, maintainabi=
lity but also writability between the two approaches. I suspect that the As=
t_mapper.E domain-specific language could be improved to reduce it, but I&#=
39;m not sure quasiquotations are not the best long-term solution. But mayb=
e we can have quasiquotations with the current extension mechanism?<br>



</div><pre>let add_register patvar body =3D
  [%quote<br>   =A0let _ =3D ExceptionHandling.register [%anti patvar] in [=
%anti body]<br>  ]<br></pre><div class=3D"gmail_extra"><br></div><div class=
=3D"gmail_extra">I&#39;m rather interested in getting ideas of how this act=
ually would work and fleshing it out.<br>



<br></div><div class=3D"gmail_extra">(Note that the problem here is to have=
 a convenient way to write little pieces of OCaml AST when you program AST-=
to-AST filters of any kind. This is a restricted use case as compared to Ca=
mlp4 quasiquotations conventions, that offer facilities for antiquotations =
inside foreign quotations implementing a completely different syntax. I use=
d the latter in Macaque, and they are exposed to end-users, so user-friendl=
iness of the antiquotation syntax was important. Here it&#39;s only for ext=
ension *writers*, so it&#39;s ok if it&#39;s *a bit* heavy.)<br>



</div><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">On Fri, Mar=
 29, 2013 at 2:04 PM, Alain Frisch <span dir=3D"ltr">&lt;<a href=3D"mailto:=
alain.frisch@lexifi.com" target=3D"_blank">alain.frisch@lexifi.com</a>&gt;<=
/span> wrote:<br>



<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div>On 01/29/2013 05:22 PM, Alain Frisch wr=
ote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
On 01/29/2013 04:37 PM, Xavier Clerc wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
However, during development,<br>
it was a time-saver to be able to easily express and experiment new<br>
ideas by manipulating &quot;bits of the actual language&quot;. Camlp4 was k=
ind<br>
enough to translate them for me into AST code which I had to check.<br>
</blockquote>
<br>
What about having a tool (either stand-alone or part of the compilers)<br>
which dumps the Parsetree representation of some code fragment in as<br>
textual OCaml values (probably without locations)?<br>
<br>
So you can type your &quot;model&quot; as source code and obtain quickly th=
e<br>
Parsetree representation, copy/paste it into a nice pattern and replace<br>
some parts with variables.<br>
</blockquote>
<br></div>
I&#39;ve hacked a quick implementation of such a tool, reusing the generic =
value printer from the toplevel:<br>
<br>
<a href=3D"http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension=
_points/tools/dump_ast.ml?revision=3DHEAD&amp;view=3Dmarkup" target=3D"_bla=
nk">http://caml.inria.fr/cgi-bin/<u></u>viewvc.cgi/ocaml/branches/<u></u>ex=
tension_points/tools/dump_<u></u>ast.ml?revision=3DHEAD&amp;view=3D<u></u>m=
arkup</a><br>




<br>
It parses either command-line arguments (currently, as types, expressions o=
r patterns) or external .ml/.mli files, and shows the internal Parsetree re=
presentation. =A0By default, location and empty attribute fields are remove=
d (they can be restored with command-line flags: -locs and -emptyattrs).<br=
>




<br>
Examples:<br>
<br>
$ ./ocamlast -w 50 -e &quot;1 + x [@attr] * 2&quot;<br>
{pexp_desc =3D<br>
=A0 Pexp_apply<br>
=A0 =A0({pexp_desc =3D Pexp_ident {txt =3D Lident &quot;*&quot;}},<br>
=A0 =A0[(&quot;&quot;,<br>
=A0 =A0 =A0{pexp_desc =3D<br>
=A0 =A0 =A0 =A0Pexp_apply<br>
=A0 =A0 =A0 =A0 ({pexp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0Pexp_ident {txt =3D Lident &quot;+&quot;}},<br>
=A0 =A0 =A0 =A0 [(&quot;&quot;,<br>
=A0 =A0 =A0 =A0 =A0 {pexp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0 Pexp_constant (Const_int 1)});<br>
=A0 =A0 =A0 =A0 =A0(&quot;&quot;,<br>
=A0 =A0 =A0 =A0 =A0 {pexp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0 Pexp_ident {txt =3D Lident &quot;x&quot;}})]);<br>
=A0 =A0 =A0 pexp_attributes =3D<br>
=A0 =A0 =A0 =A0[(&quot;attr&quot;,<br>
=A0 =A0 =A0 =A0 =A0{pexp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0Pexp_construct ({txt =3D Lident &quot;()&quot;},<br>
=A0 =A0 =A0 =A0 =A0 =A0 None, false)})]});<br>
=A0 =A0 (&quot;&quot;,<br>
=A0 =A0 =A0{pexp_desc =3D Pexp_constant (Const_int 2)})])}<br>
<br>
<br>
$ ./ocamlast -w 50 -emptyattrs -t &quot;int list * string&quot;<br>
{ptyp_desc =3D<br>
=A0 Ptyp_tuple<br>
=A0 =A0[{ptyp_desc =3D<br>
=A0 =A0 =A0 Ptyp_constr ({txt =3D Lident &quot;list&quot;},<br>
=A0 =A0 =A0 =A0[{ptyp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 Ptyp_constr ({txt =3D Lident &quot;int&quot;}, []);<br>
=A0 =A0 =A0 =A0 =A0ptyp_attributes =3D []}]);<br>
=A0 =A0 =A0ptyp_attributes =3D []};<br>
=A0 =A0 {ptyp_desc =3D<br>
=A0 =A0 =A0 Ptyp_constr ({txt =3D Lident &quot;string&quot;}, []);<br>
=A0 =A0 =A0ptyp_attributes =3D []}];<br>
=A0ptyp_attributes =3D []}<br>
<br>
<br>
This should should simplify the learning curve of the Parsetree, and even a=
llow quick copy/paste to write patterns/expressions on Parsetree. =A0That s=
aid, creating Parsetree fragments manually is quite tedious, and I&#39;ve c=
reated a module to make this easier:<br>




<br>
<a href=3D"http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension=
_points/parsing/ast_helper.mli?revision=3DHEAD&amp;view=3Dmarkup" target=3D=
"_blank">http://caml.inria.fr/cgi-bin/<u></u>viewvc.cgi/ocaml/branches/<u><=
/u>extension_points/parsing/ast_<u></u>helper.mli?revision=3DHEAD&amp;view=
=3D<u></u>markup</a><br>




<br>
Currently, this module exposes &quot;builder functions&quot; which are very=
 close to Parsetree constructors/records (making locations and attributes o=
ptional), but one can easily improve its interface (either by changing the =
existing functions, e.g. to use optional and labelled arguments, or by expo=
sing other function to cover common cases).<div>



<div><br>
<br>
<br>
Alain<br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br></div></div>

--089e0158b3aafc11fe04d9108221--

From bobzhang1988@gmail.com  Fri Mar 29 13:57:28 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 447953C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 13:57:28 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.3 from SpamAssassin-3.3.2-1461994 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.182 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f182.google.com ([209.85.220.182]:35489)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1ULZvR-0005BK-YT (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Fri, 29 Mar 2013 14:05:03 +0000
Received: by mail-vc0-f182.google.com with SMTP id ht11so520096vcb.13
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 07:05:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=drIAEJMlw3FeDcfHrWKudVG2bWsDsA/L0Lo/kChMm/A=;
 b=tHIBya42nQ+Jvu24yIC+tP2V4ZFZPEw46IMq6uIbepjP/v7+kVngIOcx2+8FRu4c81
 JGdJB3Omake4ItUxSnEYJv6oDv5xNS3Zk/8zUyPhvljPjghR0A6qpfdJ/e7cSCWJQqIi
 vnPtw3g6PGpOSO6NAtdW1FrzVZMMoPKGGy3VaKcBrYeeBXN+w/5jqGrrWMBYoiUiFJ4w
 2qmURhx+V+lOeCygffGbsWxR50pmkRF0Z4Omv2RlSjWPsbtO3n3HhfIx3WGyoQNcnEJH
 nUPzAC6ButM2zl3ZBmbrbVxZsVQ8o5bmb+vUGfoh+1Gs5ElfJExuu6twH6BnPV+PlNqn
 pO9Q==
MIME-Version: 1.0
X-Received: by 10.52.174.84 with SMTP id bq20mr1542705vdc.128.1364565900863;
 Fri, 29 Mar 2013 07:05:00 -0700 (PDT)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Fri, 29 Mar 2013 07:05:00 -0700 (PDT)
In-Reply-To: <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
Date: Fri, 29 Mar 2013 10:05:00 -0400
X-Google-Sender-Auth: zTIVXU9WUiPiLvutJKEWET2ZwdM
Message-ID: <CANcqPu47Dtw90bn_3G24-GcDcrz83eGSqZ5Ac53U+kjb6CGJVA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: multipart/alternative; boundary=bcaec51b9c77cb31b604d910c12e
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 29 Mar 2013 13:57:28 -0000

--bcaec51b9c77cb31b604d910c12e
Content-Type: text/plain; charset=ISO-8859-1

Dear all,
    I just submitted a paper about the metaprogramming in OCaml, it's
available here:http://www.seas.upenn.edu/~hongboz/main.pdf. Hope you could
find something interesting.
    Thanks!


On Fri, Mar 29, 2013 at 9:46 AM, Gabriel Scherer
<gabriel.scherer@gmail.com>wrote:

> Would it be possible to use the extension mechanism itself for lightweight
> quasiquotations?
>
> I did a small experiment with -ppx recently (
> http://gallium.inria.fr/blog/a-library-to-record-ocaml-backtraces/smartcatch_ppx.ml,
> as a contribution to Jacques-Henri Jourdan's work on
> http://gallium.inria.fr/blog/a-library-to-record-ocaml-backtraces/ ), and
> frankly the absence of quasiquotations felt like a pain in the ass. Compare
> the camlp4 part of the relevant code:
>
>   let add_debug_expr _loc patvar e =
>     <:expr<
>         let _ = ExceptionHandling.register $lid:patvar$ in
>         $e$
>     >>
>
> with the Ast_rewriter equivalent (the recommended solution alongside -ppx
> right now):
>
> let add_register patvar body =
>   let open Ast_mapper in
>   let register_fun = Location.mknoloc (Longident.parse "ExceptionHandling.register") in
>   (* let _ = <register_fun> <patvar> in <body> *)
>   E.(let_ Nonrecursive
>        [P.any (), apply (ident register_fun)  ["", ident patvar]]
>        body)
>
> There is a gap of readability, maintainability but also writability
> between the two approaches. I suspect that the Ast_mapper.E domain-specific
> language could be improved to reduce it, but I'm not sure quasiquotations
> are not the best long-term solution. But maybe we can have quasiquotations
> with the current extension mechanism?
>
> let add_register patvar body =
>   [%quote
>     let _ = ExceptionHandling.register [%anti patvar] in [%anti body]
>   ]
>
>
> I'm rather interested in getting ideas of how this actually would work and
> fleshing it out.
>
> (Note that the problem here is to have a convenient way to write little
> pieces of OCaml AST when you program AST-to-AST filters of any kind. This
> is a restricted use case as compared to Camlp4 quasiquotations conventions,
> that offer facilities for antiquotations inside foreign quotations
> implementing a completely different syntax. I used the latter in Macaque,
> and they are exposed to end-users, so user-friendliness of the
> antiquotation syntax was important. Here it's only for extension *writers*,
> so it's ok if it's *a bit* heavy.)
>
> On Fri, Mar 29, 2013 at 2:04 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:
>
>> On 01/29/2013 05:22 PM, Alain Frisch wrote:
>>
>>> On 01/29/2013 04:37 PM, Xavier Clerc wrote:
>>>
>>>> However, during development,
>>>> it was a time-saver to be able to easily express and experiment new
>>>> ideas by manipulating "bits of the actual language". Camlp4 was kind
>>>> enough to translate them for me into AST code which I had to check.
>>>>
>>>
>>> What about having a tool (either stand-alone or part of the compilers)
>>> which dumps the Parsetree representation of some code fragment in as
>>> textual OCaml values (probably without locations)?
>>>
>>> So you can type your "model" as source code and obtain quickly the
>>> Parsetree representation, copy/paste it into a nice pattern and replace
>>> some parts with variables.
>>>
>>
>> I've hacked a quick implementation of such a tool, reusing the generic
>> value printer from the toplevel:
>>
>> http://caml.inria.fr/cgi-bin/**viewvc.cgi/ocaml/branches/**
>> extension_points/tools/dump_**ast.ml?revision=HEAD&view=**markup<http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/tools/dump_ast.ml?revision=HEAD&view=markup>
>>
>> It parses either command-line arguments (currently, as types, expressions
>> or patterns) or external .ml/.mli files, and shows the internal Parsetree
>> representation.  By default, location and empty attribute fields are
>> removed (they can be restored with command-line flags: -locs and
>> -emptyattrs).
>>
>> Examples:
>>
>> $ ./ocamlast -w 50 -e "1 + x [@attr] * 2"
>> {pexp_desc =
>>   Pexp_apply
>>    ({pexp_desc = Pexp_ident {txt = Lident "*"}},
>>    [("",
>>      {pexp_desc =
>>        Pexp_apply
>>         ({pexp_desc =
>>            Pexp_ident {txt = Lident "+"}},
>>         [("",
>>           {pexp_desc =
>>             Pexp_constant (Const_int 1)});
>>          ("",
>>           {pexp_desc =
>>             Pexp_ident {txt = Lident "x"}})]);
>>       pexp_attributes =
>>        [("attr",
>>          {pexp_desc =
>>            Pexp_construct ({txt = Lident "()"},
>>             None, false)})]});
>>     ("",
>>      {pexp_desc = Pexp_constant (Const_int 2)})])}
>>
>>
>> $ ./ocamlast -w 50 -emptyattrs -t "int list * string"
>> {ptyp_desc =
>>   Ptyp_tuple
>>    [{ptyp_desc =
>>       Ptyp_constr ({txt = Lident "list"},
>>        [{ptyp_desc =
>>           Ptyp_constr ({txt = Lident "int"}, []);
>>          ptyp_attributes = []}]);
>>      ptyp_attributes = []};
>>     {ptyp_desc =
>>       Ptyp_constr ({txt = Lident "string"}, []);
>>      ptyp_attributes = []}];
>>  ptyp_attributes = []}
>>
>>
>> This should should simplify the learning curve of the Parsetree, and even
>> allow quick copy/paste to write patterns/expressions on Parsetree.  That
>> said, creating Parsetree fragments manually is quite tedious, and I've
>> created a module to make this easier:
>>
>> http://caml.inria.fr/cgi-bin/**viewvc.cgi/ocaml/branches/**
>> extension_points/parsing/ast_**helper.mli?revision=HEAD&view=**markup<http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/parsing/ast_helper.mli?revision=HEAD&view=markup>
>>
>> Currently, this module exposes "builder functions" which are very close
>> to Parsetree constructors/records (making locations and attributes
>> optional), but one can easily improve its interface (either by changing the
>> existing functions, e.g. to use optional and labelled arguments, or by
>> exposing other function to cover common cases).
>>
>>
>>
>> Alain
>> ______________________________**_________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>>
>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>
>


-- 
-- Regards, Hongbo

--bcaec51b9c77cb31b604d910c12e
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Dear all,<div style>=A0 =A0 I just submitted a paper about=
 the metaprogramming in OCaml, it&#39;s available here:<a href=3D"http://ww=
w.seas.upenn.edu/~hongboz/main.pdf">http://www.seas.upenn.edu/~hongboz/main=
.pdf</a>. Hope you could find something interesting.</div>
<div style>=A0 =A0 Thanks!</div></div><div class=3D"gmail_extra"><br><br><d=
iv class=3D"gmail_quote">On Fri, Mar 29, 2013 at 9:46 AM, Gabriel Scherer <=
span dir=3D"ltr">&lt;<a href=3D"mailto:gabriel.scherer@gmail.com" target=3D=
"_blank">gabriel.scherer@gmail.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div dir=3D"ltr"><div>Would it be possible t=
o use the extension mechanism itself for lightweight quasiquotations?<br><b=
r>
I did a small experiment with -ppx recently ( <a href=3D"http://gallium.inr=
ia.fr/blog/a-library-to-record-ocaml-backtraces/smartcatch_ppx.ml" target=
=3D"_blank">http://gallium.inria.fr/blog/a-library-to-record-ocaml-backtrac=
es/smartcatch_ppx.ml</a>, as a contribution to Jacques-Henri Jourdan&#39;s =
work on <a href=3D"http://gallium.inria.fr/blog/a-library-to-record-ocaml-b=
acktraces/" target=3D"_blank">http://gallium.inria.fr/blog/a-library-to-rec=
ord-ocaml-backtraces/</a> ), and frankly the absence of quasiquotations fel=
t like a pain in the ass. Compare the camlp4 part of the relevant code:<br>




<br><pre>  let add_debug_expr _loc patvar e =3D
    &lt;:expr&lt;
        let _ =3D ExceptionHandling.register $lid:patvar$ in
        $e$
    &gt;&gt;<br></pre></div><div>with the Ast_rewriter equivalent (the reco=
mmended solution alongside -ppx right now):<br><pre>let add_register patvar=
 body =3D
  let open Ast_mapper in
  let register_fun =3D Location.mknoloc (Longident.parse &quot;ExceptionHan=
dling.register&quot;) in
  (* let _ =3D &lt;register_fun&gt; &lt;patvar&gt; in &lt;body&gt; *)
  E.(let_ Nonrecursive
       [P.any (), apply (ident register_fun)  [&quot;&quot;, ident patvar]]
       body)<br></pre></div><div>There is a gap of readability, maintainabi=
lity but also writability between the two approaches. I suspect that the As=
t_mapper.E domain-specific language could be improved to reduce it, but I&#=
39;m not sure quasiquotations are not the best long-term solution. But mayb=
e we can have quasiquotations with the current extension mechanism?<br>




</div><pre>let add_register patvar body =3D
  [%quote<br>   =A0let _ =3D ExceptionHandling.register [%anti patvar] in [=
%anti body]<br>  ]<br></pre><div class=3D"gmail_extra"><br></div><div class=
=3D"gmail_extra">I&#39;m rather interested in getting ideas of how this act=
ually would work and fleshing it out.<br>




<br></div><div class=3D"gmail_extra">(Note that the problem here is to have=
 a convenient way to write little pieces of OCaml AST when you program AST-=
to-AST filters of any kind. This is a restricted use case as compared to Ca=
mlp4 quasiquotations conventions, that offer facilities for antiquotations =
inside foreign quotations implementing a completely different syntax. I use=
d the latter in Macaque, and they are exposed to end-users, so user-friendl=
iness of the antiquotation syntax was important. Here it&#39;s only for ext=
ension *writers*, so it&#39;s ok if it&#39;s *a bit* heavy.)<br>




</div><div><div class=3D"h5"><div class=3D"gmail_extra"><br><div class=3D"g=
mail_quote">On Fri, Mar 29, 2013 at 2:04 PM, Alain Frisch <span dir=3D"ltr"=
>&lt;<a href=3D"mailto:alain.frisch@lexifi.com" target=3D"_blank">alain.fri=
sch@lexifi.com</a>&gt;</span> wrote:<br>




<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div>On 01/29/2013 05:22 PM, Alain Frisch wr=
ote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
On 01/29/2013 04:37 PM, Xavier Clerc wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
However, during development,<br>
it was a time-saver to be able to easily express and experiment new<br>
ideas by manipulating &quot;bits of the actual language&quot;. Camlp4 was k=
ind<br>
enough to translate them for me into AST code which I had to check.<br>
</blockquote>
<br>
What about having a tool (either stand-alone or part of the compilers)<br>
which dumps the Parsetree representation of some code fragment in as<br>
textual OCaml values (probably without locations)?<br>
<br>
So you can type your &quot;model&quot; as source code and obtain quickly th=
e<br>
Parsetree representation, copy/paste it into a nice pattern and replace<br>
some parts with variables.<br>
</blockquote>
<br></div>
I&#39;ve hacked a quick implementation of such a tool, reusing the generic =
value printer from the toplevel:<br>
<br>
<a href=3D"http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension=
_points/tools/dump_ast.ml?revision=3DHEAD&amp;view=3Dmarkup" target=3D"_bla=
nk">http://caml.inria.fr/cgi-bin/<u></u>viewvc.cgi/ocaml/branches/<u></u>ex=
tension_points/tools/dump_<u></u>ast.ml?revision=3DHEAD&amp;view=3D<u></u>m=
arkup</a><br>





<br>
It parses either command-line arguments (currently, as types, expressions o=
r patterns) or external .ml/.mli files, and shows the internal Parsetree re=
presentation. =A0By default, location and empty attribute fields are remove=
d (they can be restored with command-line flags: -locs and -emptyattrs).<br=
>





<br>
Examples:<br>
<br>
$ ./ocamlast -w 50 -e &quot;1 + x [@attr] * 2&quot;<br>
{pexp_desc =3D<br>
=A0 Pexp_apply<br>
=A0 =A0({pexp_desc =3D Pexp_ident {txt =3D Lident &quot;*&quot;}},<br>
=A0 =A0[(&quot;&quot;,<br>
=A0 =A0 =A0{pexp_desc =3D<br>
=A0 =A0 =A0 =A0Pexp_apply<br>
=A0 =A0 =A0 =A0 ({pexp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0Pexp_ident {txt =3D Lident &quot;+&quot;}},<br>
=A0 =A0 =A0 =A0 [(&quot;&quot;,<br>
=A0 =A0 =A0 =A0 =A0 {pexp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0 Pexp_constant (Const_int 1)});<br>
=A0 =A0 =A0 =A0 =A0(&quot;&quot;,<br>
=A0 =A0 =A0 =A0 =A0 {pexp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0 Pexp_ident {txt =3D Lident &quot;x&quot;}})]);<br>
=A0 =A0 =A0 pexp_attributes =3D<br>
=A0 =A0 =A0 =A0[(&quot;attr&quot;,<br>
=A0 =A0 =A0 =A0 =A0{pexp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0Pexp_construct ({txt =3D Lident &quot;()&quot;},<br>
=A0 =A0 =A0 =A0 =A0 =A0 None, false)})]});<br>
=A0 =A0 (&quot;&quot;,<br>
=A0 =A0 =A0{pexp_desc =3D Pexp_constant (Const_int 2)})])}<br>
<br>
<br>
$ ./ocamlast -w 50 -emptyattrs -t &quot;int list * string&quot;<br>
{ptyp_desc =3D<br>
=A0 Ptyp_tuple<br>
=A0 =A0[{ptyp_desc =3D<br>
=A0 =A0 =A0 Ptyp_constr ({txt =3D Lident &quot;list&quot;},<br>
=A0 =A0 =A0 =A0[{ptyp_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 Ptyp_constr ({txt =3D Lident &quot;int&quot;}, []);<br>
=A0 =A0 =A0 =A0 =A0ptyp_attributes =3D []}]);<br>
=A0 =A0 =A0ptyp_attributes =3D []};<br>
=A0 =A0 {ptyp_desc =3D<br>
=A0 =A0 =A0 Ptyp_constr ({txt =3D Lident &quot;string&quot;}, []);<br>
=A0 =A0 =A0ptyp_attributes =3D []}];<br>
=A0ptyp_attributes =3D []}<br>
<br>
<br>
This should should simplify the learning curve of the Parsetree, and even a=
llow quick copy/paste to write patterns/expressions on Parsetree. =A0That s=
aid, creating Parsetree fragments manually is quite tedious, and I&#39;ve c=
reated a module to make this easier:<br>





<br>
<a href=3D"http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension=
_points/parsing/ast_helper.mli?revision=3DHEAD&amp;view=3Dmarkup" target=3D=
"_blank">http://caml.inria.fr/cgi-bin/<u></u>viewvc.cgi/ocaml/branches/<u><=
/u>extension_points/parsing/ast_<u></u>helper.mli?revision=3DHEAD&amp;view=
=3D<u></u>markup</a><br>





<br>
Currently, this module exposes &quot;builder functions&quot; which are very=
 close to Parsetree constructors/records (making locations and attributes o=
ptional), but one can easily improve its interface (either by changing the =
existing functions, e.g. to use optional and labelled arguments, or by expo=
sing other function to cover common cases).<div>




<div><br>
<br>
<br>
Alain<br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br></div></div></div></div>
<br>_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
<br></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regar=
ds, Hongbo
</div>

--bcaec51b9c77cb31b604d910c12e--

From alain.frisch@lexifi.com  Fri Mar 29 14:27:27 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 48A973C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 14:27:27 +0000 (GMT)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1461994 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:18410
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1ULaOU-00067t-q1 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 29 Mar 2013 14:35:02 +0000
Received: from [192.168.1.120] ([92.151.115.78]) by mwinf5d61 with ME
 id HSb11l0091hZWdG03Sb14t; Fri, 29 Mar 2013 15:35:01 +0100
Message-ID: <5155A697.7050302@lexifi.com>
Date: Fri, 29 Mar 2013 15:35:03 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
In-Reply-To: <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 29 Mar 2013 14:27:27 -0000

On 03/29/2013 02:46 PM, Gabriel Scherer wrote:
> Would it be possible to use the extension mechanism itself for
> lightweight quasiquotations?
>
> I did a small experiment with -ppx recently (
> http://gallium.inria.fr/blog/a-library-to-record-ocaml-backtraces/smartcatch_ppx.ml,
> as a contribution to Jacques-Henri Jourdan's work on
> http://gallium.inria.fr/blog/a-library-to-record-ocaml-backtraces/ ),
> and frankly the absence of quasiquotations felt like a pain in the ass.
> Compare the camlp4 part of the relevant code:
>
>    let add_debug_expr _loc patvar e =
>      <:expr<
>          let _ = ExceptionHandling.register $lid:patvar$ in
>          $e$
>      >>
>
> with the Ast_rewriter equivalent (the recommended solution alongside
> -ppx right now):
>
> let add_register patvar body =
>    let open Ast_mapper in
>    let register_fun = Location.mknoloc (Longident.parse "ExceptionHandling.register") in
>    (* let _ = <register_fun> <patvar> in <body> *)
>    E.(let_ Nonrecursive
>         [P.any (), apply (ident register_fun)  ["", ident patvar]]
>         body)


I'd write it as:


let add_register e body =
   let_in [pany, app (evar "ExceptionHandling.register") [e]] body


which does not look so bad.  This relies on the following definitions, 
which could go e.g. in a Ast_helper.Convenience module:

let evar s = E.ident (mknoloc (Longident.parse s))
let let_in l body = E.let_ Nonrecursive l b
    (* maybe with an optional argument for the recursive case *)
let pany = P.any ()
let app f args = apply f (List.map (fun a -> "", a) args)



The rest of the code is interesting as well:

Camlp4:

   value rec map_handler =
     let patvar = "__exn" in
     fun
     [ <:match_case@_loc< $m1$ | $m2$ >> ->
         <:match_case< $map_handler m1$ | $map_handler m2$ >>
     | <:match_case@_loc< $p$ when $w$ -> $e$ >> ->
         <:match_case@_loc<
           ($p$ as $lid:patvar$) when $w$ -> $add_debug_expr _loc patvar 
e$ >>
     | m -> m ];

   value filter = object
     inherit Ast.map as super;
     method expr = fun
     [ <:expr@_loc< try $e$ with [ $h$ ] >> ->
       <:expr< try $e$ with [ $map_handler h$ ] >>
     | x -> super#expr x ];
   end;


PPX:

   method expr e =
     let e = super#expr e in
     { e with pexp_desc =
         match e.pexp_desc with
           | Pexp_try (body, handler) ->
             let instrument_case (pat, body) =
               let patvar_str =  "__exn" in
               let patvar = Location.mknoloc (Longident.parse patvar_str) in
               let pat = { pat with ppat_desc =
                 Ppat_alias (pat, Location.mknoloc patvar_str) } in
               (pat, add_register patvar body) in
             Pexp_try (body, List.map instrument_case handler)
           | other -> other
     }


This might be a matter of taste, but I prefer the PPX version, which I 
can read only by knowing about the Parsetree (which is required anyway 
to write any such code), a normal OCaml library.  The quotation and 
anti-quotations in the Camlp4 version look very noisy, and it relies on 
a syntax I'm not familiar with (revised syntax) and syntactic extensions 
(quotations/antiquotations), with their own conventions 
("<:match_case<", $lid:$).  Since I'm not writing extensions every day, 
I really prefer having to learn how to use simple OCaml data types and 
libraries (Parsetree, Ast_helper) rather than to learn new syntax and 
new concepts.  Also, I'd write the code above as:

(* --> in Ast_helper.Convenience *)
let palias p x = P.alias p (mknoloc x)
let evar s = E.ident (mknoloc (Longident.parse s))
...


   method expr e =
     let e = super#expr e in
     match e.pexp_desc with
     | Pexp_try (body, handler) ->
         let instrument_case (pat, body) =
           (palias pat "__exn", add_register (evar "__exn") body)
         in
         {e with pexp_desc = Pexp_try (body, List.map instrument_case 
handler)}
     | e -> e

> But maybe we
> can have quasiquotations with the current extension mechanism?
>
> let add_register patvar body =
>    [%quote
>      let _ = ExceptionHandling.register [%anti patvar] in [%anti body]
>    ]

Implementing this "quote" expander is not very difficult, just a little 
bit tedious (and this can be automated by parsing the definition of the 
Parsetree).  Note that nothing forces to use [%anti x] for 
antiquotations.  We could very well decide on a more lightweight 
convention, like prefixing identifiers, or using a dedicated operator:


     [%quote
       let _ = ExceptionHandling.register __patvar in __body
     ]

     [%quote
       let _ = ExceptionHandling.register !!patvar in !!body
     ]


But this approach would work nicely only for writing expressions or 
patterns on OCaml expressions, not on other syntactic categories 
(because the content of an extension node is an expression).  The 
problem is that AST-manipulating code tend to require to work a lot with 
many different categories (like "match cases") even to build expressions.

Quasi-quotations would be useful if the expanders had to generate big 
fragments of mostly static code, with only a few "dynamic" placeholders. 
  In my experience, this is rarely the case: you assemble the resulting 
OCaml code by combining many small fragments generated programmatically. 
  For these cases, a nice library of "AST constructors" seems better to me.



-- Alain

From gabriel.scherer@gmail.com  Fri Mar 29 15:05:49 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 60D543C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 15:05:49 +0000 (GMT)
X-Cam-SpamDetails: score 0.2 from SpamAssassin-3.3.2-1461994 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.174 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  0.9 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f174.google.com ([209.85.220.174]:59394)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1ULazb-0005OR-8s (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 29 Mar 2013 15:13:24 +0000
Received: by mail-vc0-f174.google.com with SMTP id hx10so577909vcb.33
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 08:13:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=VN99Vh2nmIQCvK/Si7pLj9m+ghkcEYfPDK1xbu5exjQ=;
 b=xojxtVA8Pq/+77iVWnf89LyupHc9SRnfrCCm4iM04yYYPPQEx/p9KPYTU5Xlr7B7Nm
 xlFqwXUxUr0ndSDf/eYUxr2E9YfBAbptUpvYnUj8BkcUU5qYR1DDq7CV0en2yj22OsMo
 R+nDBfQAY3jzkYalmQ9trzCmrc+v7BU3xIcC6gQ47HI2CUPYdG31MPoLVGRJy8CXuKVC
 XDddEGsHsx+I4riEgYWyREpEMbJa5RdUmFe0TkeQIbYn6W5RDmAbTMoOb0neeW4q0qxi
 6RabdJtZkRoKFt6a36Z1XOlKVmW3cfOwvbN2B6nnSllZFDopeWWHTYETzjaCl5FmOFjI
 MyFQ==
X-Received: by 10.58.232.98 with SMTP id tn2mr1966505vec.57.1364570003000;
 Fri, 29 Mar 2013 08:13:23 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.58.233.13 with HTTP; Fri, 29 Mar 2013 08:12:42 -0700 (PDT)
In-Reply-To: <5155A697.7050302@lexifi.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <5155A697.7050302@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 29 Mar 2013 16:12:42 +0100
Message-ID: <CAPFanBFhAkfqJ9DiyRuM6D0HBetFy2KtUyQAj1VmEJM3tj4rAw@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=047d7b414c2e4cd49f04d911b619
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 29 Mar 2013 15:05:49 -0000

--047d7b414c2e4cd49f04d911b619
Content-Type: text/plain; charset=ISO-8859-1

On Fri, Mar 29, 2013 at 3:35 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> I'd write it as:
>
> let add_register e body =
>   let_in [pany, app (evar "ExceptionHandling.register") [e]] body
>
> which does not look so bad.  This relies on the following definitions,
> which could go e.g. in a Ast_helper.Convenience module:
>
> let evar s = E.ident (mknoloc (Longident.parse s))
> let let_in l body = E.let_ Nonrecursive l b
>    (* maybe with an optional argument for the recursive case *)
> let pany = P.any ()
> let app f args = apply f (List.map (fun a -> "", a) args)
>

That is better indeed. I can only encourage you to add these kind of
conveniences in the E submodule (or maybe somewhere else) as usage suggests
that they are useful. I originally planned to report on that through proper
(?) channels, but that got lost in the noise of things to do, sorry.

I'm still not sure that quasi-quotations are not a better approach, because
the problem here is that the user has to learn a new interface to describe
code fragments instead of using the syntax he's already familiar with. You
have convincingly argued that the OCaml syntax cannot always be used to
describe AST fragments (even in Camlp4, if you use the classic syntax in
quotations some ambiguities force you to revert to plain AST constructors
from time to time), and I hear the argument about fitting lots of small
pieces together instead of inserting large chunks of code. I still have the
intuition that those arguments are more relevant to the expert extension
writer, and that for a large set of use cases that concern *simple*
extensions and beginner extension writers, quasiquotations are still
noticeably easier to use. That this feeling appears to be reflected by
Xavier Clerc, which is one of the other early-triers of -ppx, gives me a
hint that it may have some objective qualities.


>
> The rest of the code is interesting as well:
>
> Camlp4:
>
>   value rec map_handler =
>     let patvar = "__exn" in
>     fun
>     [ <:match_case@_loc< $m1$ | $m2$ >> ->
>         <:match_case< $map_handler m1$ | $map_handler m2$ >>
>     | <:match_case@_loc< $p$ when $w$ -> $e$ >> ->
>         <:match_case@_loc<
>           ($p$ as $lid:patvar$) when $w$ -> $add_debug_expr _loc patvar e$
> >>
>     | m -> m ];
>
>   value filter = object
>     inherit Ast.map as super;
>     method expr = fun
>     [ <:expr@_loc< try $e$ with [ $h$ ] >> ->
>       <:expr< try $e$ with [ $map_handler h$ ] >>
>     | x -> super#expr x ];
>   end;
>
>
> PPX:
>
>   method expr e =
>     let e = super#expr e in
>     { e with pexp_desc =
>         match e.pexp_desc with
>           | Pexp_try (body, handler) ->
>             let instrument_case (pat, body) =
>               let patvar_str =  "__exn" in
>               let patvar = Location.mknoloc (Longident.parse patvar_str) in
>               let pat = { pat with ppat_desc =
>                 Ppat_alias (pat, Location.mknoloc patvar_str) } in
>               (pat, add_register patvar body) in
>             Pexp_try (body, List.map instrument_case handler)
>           | other -> other
>     }
>
>
> This might be a matter of taste, but I prefer the PPX version, which I can
> read only by knowing about the Parsetree (which is required anyway to write
> any such code), a normal OCaml library.  The quotation and anti-quotations
> in the Camlp4 version look very noisy, and it relies on a syntax I'm not
> familiar with (revised syntax) and syntactic extensions
> (quotations/antiquotations), with their own conventions ("<:match_case<",
> $lid:$).  Since I'm not writing extensions every day, I really prefer
> having to learn how to use simple OCaml data types and libraries
> (Parsetree, Ast_helper) rather than to learn new syntax and new concepts.
>  Also, I'd write the code above as:
>
> (* --> in Ast_helper.Convenience *)
> let palias p x = P.alias p (mknoloc x)
> let evar s = E.ident (mknoloc (Longident.parse s))
> ...
>
>   method expr e =
>     let e = super#expr e in
>     match e.pexp_desc with
>     | Pexp_try (body, handler) ->
>         let instrument_case (pat, body) =
>           (palias pat "__exn", add_register (evar "__exn") body)
>         in
>         {e with pexp_desc = Pexp_try (body, List.map instrument_case
> handler)}
>     | e -> e



I used this example specifically to discuss the quasiquotation feature, not
as a general comparison of -ppx and Camlp4's extension writing facilities.
I do agree that, in this example, the AST traversal framework of -ppx is in
fact better than Camlp4's. This is related to the fact that the AST
structure is simpler and more closely reflect the way I logically think
about pieces of OCaml code: match only takes a (pattern * expr) list
instead of being a recursive expression of nested branches. That's a plus
for ppx's design (and I like your approach of improving the upstream AST
description to make it even better, at least while we don't have extension
writers with code that breaks when we change it).

That said, I think you're also a bit quick to jump to conclusions here. The
question of whether the extension uses classical or revised syntax is
largely orthogonal to the design of the extension itself (except
occasionally with quotation ambiguities concerns), and I could have used
the classic syntax to write the Camlp4 extension just as well. What
happened in practice is that I looked at the set of old Camlp4 extensions I
had lying around, copy-pasted the code of the one that looked most closely
like what I was looking for (traversing the "match" structure), and spent
the rest of the time wondering which output code to produce (the
"add_register" function I quoted, plus the pattern-alias stuff).

So the bottleneck in practice was in the code production part. It was just
as true for the -ppx version (the traversal part was easy to write), but my
experience producing code in the -ppx version was much less gratifying. Of
course, it was my first use of your Ast_mapper.E interface, so there was
some learning cost to take into account. But then I had type errors, I had
to look at the documentation again, and it was a bit painful. Finally, I
only handle Camlp4 extensions about once a year, so I have time to forget
most details about how they work, in particular I *always* look at the
documentation for the concrete AST constructor names in the (rare) cases
where I need them. I found that there was no such re-learning curve with
quasiquotations, they just work out of the box -- once you've been
rebrained, once and forall, to see those <:stuff< >> as structured code
rather than ASCII noise.

I think the small tool you just introduced (translating OCaml code into
AST-building ocaml code) may have made this "code production" part easier,
but I'm not fond of the idea of pasting auto-generated code in my own code.
In any case, it would be better if it produced code using the nice
high-level interface, rather than the hard-to-read AST definitions, but
that may be much more painful to implement so I'm not really asking for
that.



>  But maybe we
>> can have quasiquotations with the current extension mechanism?
>>
>> let add_register patvar body =
>>    [%quote
>>      let _ = ExceptionHandling.register [%anti patvar] in [%anti body]
>>    ]
>>
>
> Implementing this "quote" expander is not very difficult, just a little
> bit tedious (and this can be automated by parsing the definition of the
> Parsetree).


Isn't that essentially the same thing as the tool you implemented for
Xavier above? (Can you reuse code between both?)
If I understand correctly, this is also the "Meta" operation of Camlp4,
turning the AST for the expression <foo> into the AST for the OCaml
expression representing the AST for <foo>. When you say "automated by
parsing the definition of the Parsetree", do you have a realistic design in
mind for such boilerplate code generators, or do you plan in practice to
implement them by hand?

Note that nothing forces to use [%anti x] for antiquotations.  We could
> very well decide on a more lightweight convention, like prefixing
> identifiers, or using a dedicated operator:


>     [%quote
>       let _ = ExceptionHandling.register __patvar in __body
>     ]
>
>     [%quote
>       let _ = ExceptionHandling.register !!patvar in !!body
>     ]
>

Same old battle-horse: I dislike the idea that [%quote ] would change the
meaning of syntactically valid OCaml code such as __patvar or !!patvar. I
think I would with [%anti ] for now, or maybe just [%a ] if need be -- in
any case this is not part of the eventually-crowded extension namespace as
they really are only markers to be rewritten by the implementation of
%quote.


> But this approach would work nicely only for writing expressions or
> patterns on OCaml expressions, not on other syntactic categories (because
> the content of an extension node is an expression).  The problem is that
> AST-manipulating code tend to require to work a lot with many different
> categories (like "match cases") even to build expressions.
>

That's a good point.


> Quasi-quotations would be useful if the expanders had to generate big
> fragments of mostly static code, with only a few "dynamic" placeholders.
>  In my experience, this is rarely the case: you assemble the resulting
> OCaml code by combining many small fragments generated programmatically.
>  For these cases, a nice library of "AST constructors" seems better to me.
>

Maybe we need both, but if we eventually get nice constructor names for the
AST definitions (I know that doesn't depend on you) I think if we only had
time/energy/maintenance for two among (1) AST definitions (2) AST
combinator library and (3) quasiquotation mechanism, I would suggest we
keep (1) and (3) rather than (1) and (2).


>
>
>
> -- Alain
>

--047d7b414c2e4cd49f04d911b619
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><br><br><div class=3D"gmail_extra"><div class=3D"gmail_quo=
te">On Fri, Mar 29, 2013 at 3:35 PM, Alain Frisch <span dir=3D"ltr">&lt;<a =
href=3D"mailto:alain.frisch@lexifi.com" target=3D"_blank">alain.frisch@lexi=
fi.com</a>&gt;</span> wrote:<br>

<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">I&#39;d write it as:<br>
<br>
let add_register e body =3D<br>
=A0 let_in [pany, app (evar &quot;ExceptionHandling.register&quot;) [e]] bo=
dy<br>
<br>
which does not look so bad. =A0This relies on the following definitions, wh=
ich could go e.g. in a Ast_helper.Convenience module:<br>
<br>
let evar s =3D E.ident (mknoloc (Longident.parse s))<br>
let let_in l body =3D E.let_ Nonrecursive l b<br>
=A0 =A0(* maybe with an optional argument for the recursive case *)<br>
let pany =3D P.any ()<br>
let app f args =3D apply f (List.map (fun a -&gt; &quot;&quot;, a) args)<br=
></blockquote><div><br></div><div>That is better indeed. I can only encoura=
ge you to add these kind of conveniences in the E submodule (or maybe somew=
here else) as usage suggests that they are useful. I originally planned to =
report on that through proper (?) channels, but that got lost in the noise =
of things to do, sorry.<br>

<br></div><div>I&#39;m still not sure that quasi-quotations are not a bette=
r approach, because the problem here is that the user has to learn a new in=
terface to describe code fragments instead of using the syntax he&#39;s alr=
eady familiar with. You have convincingly argued that the OCaml syntax cann=
ot always be used to describe AST fragments (even in Camlp4, if you use the=
 classic syntax in quotations some ambiguities force you to revert to plain=
 AST constructors from time to time), and I hear the argument about fitting=
 lots of small pieces together instead of inserting large chunks of code. I=
 still have the intuition that those arguments are more relevant to the exp=
ert extension writer, and that for a large set of use cases that concern *s=
imple* extensions and beginner extension writers, quasiquotations are still=
 noticeably easier to use. That this feeling appears to be reflected by Xav=
ier Clerc, which is one of the other early-triers of -ppx, gives me a hint =
that it may have some objective qualities.<br>

</div><div>=A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0=
 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<br>
The rest of the code is interesting as well:<br>
<br>
Camlp4:<br>
<br>
=A0 value rec map_handler =3D<br>
=A0 =A0 let patvar =3D &quot;__exn&quot; in<br>
=A0 =A0 fun<br>
=A0 =A0 [ &lt;:match_case@_loc&lt; $m1$ | $m2$ &gt;&gt; -&gt;<br>
=A0 =A0 =A0 =A0 &lt;:match_case&lt; $map_handler m1$ | $map_handler m2$ &gt=
;&gt;<br>
=A0 =A0 | &lt;:match_case@_loc&lt; $p$ when $w$ -&gt; $e$ &gt;&gt; -&gt;<br=
>
=A0 =A0 =A0 =A0 &lt;:match_case@_loc&lt;<br>
=A0 =A0 =A0 =A0 =A0 ($p$ as $lid:patvar$) when $w$ -&gt; $add_debug_expr _l=
oc patvar e$ &gt;&gt;<br>
=A0 =A0 | m -&gt; m ];<br>
<br>
=A0 value filter =3D object<br>
=A0 =A0 inherit Ast.map as super;<br>
=A0 =A0 method expr =3D fun<br>
=A0 =A0 [ &lt;:expr@_loc&lt; try $e$ with [ $h$ ] &gt;&gt; -&gt;<br>
=A0 =A0 =A0 &lt;:expr&lt; try $e$ with [ $map_handler h$ ] &gt;&gt;<br>
=A0 =A0 | x -&gt; super#expr x ];<br>
=A0 end;<br>
<br>
<br>
PPX:<br>
<br>
=A0 method expr e =3D<br>
=A0 =A0 let e =3D super#expr e in<br>
=A0 =A0 { e with pexp_desc =3D<br>
=A0 =A0 =A0 =A0 match e.pexp_desc with<br>
=A0 =A0 =A0 =A0 =A0 | Pexp_try (body, handler) -&gt;<br>
=A0 =A0 =A0 =A0 =A0 =A0 let instrument_case (pat, body) =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 let patvar_str =3D =A0&quot;__exn&quot; in<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 let patvar =3D Location.mknoloc (Longident.pars=
e patvar_str) in<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 let pat =3D { pat with ppat_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 Ppat_alias (pat, Location.mknoloc patvar_st=
r) } in<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 (pat, add_register patvar body) in<br>
=A0 =A0 =A0 =A0 =A0 =A0 Pexp_try (body, List.map instrument_case handler)<b=
r>
=A0 =A0 =A0 =A0 =A0 | other -&gt; other<br>
=A0 =A0 }<br>
<br>
<br>
This might be a matter of taste, but I prefer the PPX version, which I can =
read only by knowing about the Parsetree (which is required anyway to write=
 any such code), a normal OCaml library. =A0The quotation and anti-quotatio=
ns in the Camlp4 version look very noisy, and it relies on a syntax I&#39;m=
 not familiar with (revised syntax) and syntactic extensions (quotations/an=
tiquotations), with their own conventions (&quot;&lt;:match_case&lt;&quot;,=
 $lid:$). =A0Since I&#39;m not writing extensions every day, I really prefe=
r having to learn how to use simple OCaml data types and libraries (Parsetr=
ee, Ast_helper) rather than to learn new syntax and new concepts. =A0Also, =
I&#39;d write the code above as:<br>


<br>
(* --&gt; in Ast_helper.Convenience *)<br>
let palias p x =3D P.alias p (mknoloc x)<br>
let evar s =3D E.ident (mknoloc (Longident.parse s))<br>
...<br>
<br>
=A0 method expr e =3D<br>
=A0 =A0 let e =3D super#expr e in<br>
=A0 =A0 match e.pexp_desc with<br>
=A0 =A0 | Pexp_try (body, handler) -&gt;<br>
=A0 =A0 =A0 =A0 let instrument_case (pat, body) =3D<br>
=A0 =A0 =A0 =A0 =A0 (palias pat &quot;__exn&quot;, add_register (evar &quot=
;__exn&quot;) body)<br>
=A0 =A0 =A0 =A0 in<br>
=A0 =A0 =A0 =A0 {e with pexp_desc =3D Pexp_try (body, List.map instrument_c=
ase handler)}<br>
=A0 =A0 | e -&gt; e</blockquote><div><br><br></div><div>I used this example=
 specifically to discuss the quasiquotation feature, not as a general compa=
rison of -ppx and Camlp4&#39;s extension writing facilities. I do agree tha=
t, in this example, the AST traversal framework of -ppx is in fact better t=
han Camlp4&#39;s. This is related to the fact that the AST structure is sim=
pler and more closely reflect the way I logically think about pieces of OCa=
ml code: match only takes a (pattern * expr) list instead of being a recurs=
ive expression of nested branches. That&#39;s a plus for ppx&#39;s design (=
and I like your approach of improving the upstream AST description to make =
it even better, at least while we don&#39;t have extension writers with cod=
e that breaks when we change it).<br>

</div><div><br></div><div>That said, I think you&#39;re also a bit quick to=
 jump to conclusions here. The question of whether the extension uses class=
ical or revised syntax is largely orthogonal to the design of the extension=
 itself (except occasionally with quotation ambiguities concerns), and I co=
uld have used the classic syntax to write the Camlp4 extension just as well=
. What happened in practice is that I looked at the set of old Camlp4 exten=
sions I had lying around, copy-pasted the code of the one that looked most =
closely like what I was looking for (traversing the &quot;match&quot; struc=
ture), and spent the rest of the time wondering which output code to produc=
e (the &quot;add_register&quot; function I quoted, plus the pattern-alias s=
tuff).<br>

</div><div><br>So the bottleneck in practice was in the code production par=
t. It was just as true for the -ppx version (the traversal part was easy to=
 write), but my experience producing code in the -ppx version was much less=
 gratifying. Of course, it was my first use of your Ast_mapper.E interface,=
 so there was some learning cost to take into account. But then I had type =
errors, I had to look at the documentation again, and it was a bit painful.=
 Finally, I only handle Camlp4 extensions about once a year, so I have time=
 to forget most details about how they work, in particular I *always* look =
at the documentation for the concrete AST constructor names in the (rare) c=
ases where I need them. I found that there was no such re-learning curve wi=
th quasiquotations, they just work out of the box -- once you&#39;ve been r=
ebrained, once and forall, to see those &lt;:stuff&lt; &gt;&gt; as structur=
ed code rather than ASCII noise.<br>

<br></div><div>I think the small tool you just introduced (translating OCam=
l code into AST-building ocaml code) may have made this &quot;code producti=
on&quot; part easier, but I&#39;m not fond of the idea of pasting auto-gene=
rated code in my own code. In any case, it would be better if it produced c=
ode using the nice high-level interface, rather than the hard-to-read AST d=
efinitions, but that may be much more painful to implement so I&#39;m not r=
eally asking for that. <br>

</div><div><br>=A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0=
 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div class=3D"im">
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
But maybe we<br>
can have quasiquotations with the current extension mechanism?<br>
<br>
let add_register patvar body =3D<br>
=A0 =A0[%quote<br>
=A0 =A0 =A0let _ =3D ExceptionHandling.register [%anti patvar] in [%anti bo=
dy]<br>
=A0 =A0]<br>
</blockquote>
<br></div>
Implementing this &quot;quote&quot; expander is not very difficult, just a =
little bit tedious (and this can be automated by parsing the definition of =
the Parsetree).</blockquote><br></div><div>Isn&#39;t that essentially the s=
ame thing as the tool you implemented for Xavier above? (Can you reuse code=
 between both?)<br>

If I understand correctly, this is also the &quot;Meta&quot; operation of C=
amlp4, turning the AST for the expression &lt;foo&gt; into the AST for the =
OCaml expression representing the AST for &lt;foo&gt;. When you say &quot;a=
utomated by parsing the definition of the Parsetree&quot;, do you have a re=
alistic design in mind for such boilerplate code generators, or do you plan=
 in practice to implement them by hand?<br>

<br></div><div class=3D"gmail_quote"><blockquote class=3D"gmail_quote" styl=
e=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">Note th=
at nothing forces to use [%anti x] for antiquotations. =A0We could very wel=
l decide on a more lightweight convention, like prefixing identifiers, or u=
sing a dedicated operator:=A0</blockquote>

<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
<br>
=A0 =A0 [%quote<br>
=A0 =A0 =A0 let _ =3D ExceptionHandling.register __patvar in __body<br>
=A0 =A0 ]<br>
<br>
=A0 =A0 [%quote<br>
=A0 =A0 =A0 let _ =3D ExceptionHandling.register !!patvar in !!body<br>
=A0 =A0 ]<br></blockquote><div><br></div><div>Same old battle-horse: I disl=
ike the idea that [%quote ] would change the meaning of syntactically valid=
 OCaml code such as __patvar or !!patvar. I think I would with [%anti ] for=
 now, or maybe just [%a ] if need be -- in any case this is not part of the=
 eventually-crowded extension namespace as they really are only markers to =
be rewritten by the implementation of %quote.<br>

</div><div>=A0<br></div><blockquote class=3D"gmail_quote" style=3D"margin:0=
 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
But this approach would work nicely only for writing expressions or pattern=
s on OCaml expressions, not on other syntactic categories (because the cont=
ent of an extension node is an expression). =A0The problem is that AST-mani=
pulating code tend to require to work a lot with many different categories =
(like &quot;match cases&quot;) even to build expressions.<br>

</blockquote><div><br></div><div>That&#39;s a good point.<br></div><div>=A0=
</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-l=
eft:1px #ccc solid;padding-left:1ex">
Quasi-quotations would be useful if the expanders had to generate big fragm=
ents of mostly static code, with only a few &quot;dynamic&quot; placeholder=
s. =A0In my experience, this is rarely the case: you assemble the resulting=
 OCaml code by combining many small fragments generated programmatically. =
=A0For these cases, a nice library of &quot;AST constructors&quot; seems be=
tter to me.<span class=3D"HOEnZb"><font color=3D"#888888"><br>

</font></span></blockquote><div><br></div><div>Maybe we need both, but if w=
e eventually get nice constructor names for the AST definitions (I know tha=
t doesn&#39;t depend on you) I think if we only had time/energy/maintenance=
 for two among (1) AST definitions (2) AST combinator library and (3) quasi=
quotation mechanism, I would suggest we keep (1) and (3) rather than (1) an=
d (2).<br>

</div><div>=A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0=
 .8ex;border-left:1px #ccc solid;padding-left:1ex"><span class=3D"HOEnZb"><=
font color=3D"#888888">
<br>
<br>
<br>
-- Alain<br>
</font></span></blockquote></div><br></div></div>

--047d7b414c2e4cd49f04d911b619--

From bobzhang1988@gmail.com  Fri Mar 29 15:25:34 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id F08923C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 15:25:33 +0000 (GMT)
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1461994 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.178 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f178.google.com ([209.85.128.178]:63590)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1ULbIh-0001N4-9J (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Fri, 29 Mar 2013 15:33:09 +0000
Received: by mail-ve0-f178.google.com with SMTP id db10so649942veb.9
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 08:33:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=GaMAHa5VvLxy9fPPke9zSYft0B7ZzvBL7a/quZwLqcc=;
 b=Ly/1I+IpYhHarQsogt8NWMGfLnIeSoY244F3xYF51EyLU7cGgPceXrosN4z2O7v6T/
 mpU9qAht7aT2VSkTAuhnNtbha71bFw3z8ir/jBOxAQq9o09wI8r5u2lD2OYVrqLJwK9t
 nvztGf0kJ0+isve21d2THx3CqD260O3d5puKj87ORi1Oi53rS4ZfT9AAbDNZDTFXA7D4
 lUbNrBFbiQtl56PjGSAG/Zth567tWa/drBZiBInTUwxskYboh0KK3xZDvJGz0UiiL/7I
 VkWOdlbu5u7ckppJG/g4DaP+20sseI6/gU8R7pc9ZoUf5MzzDmEN41PTXbLhPJEY3EEi
 +IfQ==
MIME-Version: 1.0
X-Received: by 10.52.75.65 with SMTP id a1mr1785322vdw.79.1364571187043; Fri,
 29 Mar 2013 08:33:07 -0700 (PDT)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Fri, 29 Mar 2013 08:33:06 -0700 (PDT)
In-Reply-To: <CAPFanBFhAkfqJ9DiyRuM6D0HBetFy2KtUyQAj1VmEJM3tj4rAw@mail.gmail.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <5155A697.7050302@lexifi.com>
 <CAPFanBFhAkfqJ9DiyRuM6D0HBetFy2KtUyQAj1VmEJM3tj4rAw@mail.gmail.com>
Date: Fri, 29 Mar 2013 11:33:06 -0400
X-Google-Sender-Auth: dkQkAl6Hqp_LWMzbPpwV8J_dqag
Message-ID: <CANcqPu4iJ9FRXUxu3r=999GyrnyN90hOenVwrdyqrhCSijY94A@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: multipart/alternative; boundary=20cf3071cf72dfe6a704d911fc13
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 29 Mar 2013 15:25:34 -0000

--20cf3071cf72dfe6a704d911fc13
Content-Type: text/plain; charset=ISO-8859-1

Writing metaprogramming either in quasiquotation or combinator is fine for
me, the problem is the
latter approach does not work well with IDE and it's hard to read (we read
code more than write)
About implementation, my experience is that quotation is very tedious but
not difficult, antiquotation is not easy to get correct. about map_handler,
it can be improved in Fan
let rec map_handler =
  let patvar = "__exn" in with match_case (* set the default language*)
   fun
   [ {| $m1 $ $m2 |} ->
     {| $(map_hander m1) | $(map_handler m2)  |}
   | {| $p when $w -> $e |} ->
     {| ($p as $lid:patvar) when $w -> $(add_debug_expr _loc patvar e)  |}
   | m -> m ];;

On Fri, Mar 29, 2013 at 11:12 AM, Gabriel Scherer <gabriel.scherer@gmail.com
> wrote:

>
>
> On Fri, Mar 29, 2013 at 3:35 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:
>
>> I'd write it as:
>>
>> let add_register e body =
>>   let_in [pany, app (evar "ExceptionHandling.register") [e]] body
>>
>> which does not look so bad.  This relies on the following definitions,
>> which could go e.g. in a Ast_helper.Convenience module:
>>
>> let evar s = E.ident (mknoloc (Longident.parse s))
>> let let_in l body = E.let_ Nonrecursive l b
>>    (* maybe with an optional argument for the recursive case *)
>> let pany = P.any ()
>> let app f args = apply f (List.map (fun a -> "", a) args)
>>
>
> That is better indeed. I can only encourage you to add these kind of
> conveniences in the E submodule (or maybe somewhere else) as usage suggests
> that they are useful. I originally planned to report on that through proper
> (?) channels, but that got lost in the noise of things to do, sorry.
>
> I'm still not sure that quasi-quotations are not a better approach,
> because the problem here is that the user has to learn a new interface to
> describe code fragments instead of using the syntax he's already familiar
> with. You have convincingly argued that the OCaml syntax cannot always be
> used to describe AST fragments (even in Camlp4, if you use the classic
> syntax in quotations some ambiguities force you to revert to plain AST
> constructors from time to time), and I hear the argument about fitting lots
> of small pieces together instead of inserting large chunks of code. I still
> have the intuition that those arguments are more relevant to the expert
> extension writer, and that for a large set of use cases that concern
> *simple* extensions and beginner extension writers, quasiquotations are
> still noticeably easier to use. That this feeling appears to be reflected
> by Xavier Clerc, which is one of the other early-triers of -ppx, gives me a
> hint that it may have some objective qualities.
>
>
>>
>> The rest of the code is interesting as well:
>>
>> Camlp4:
>>
>>   value rec map_handler =
>>     let patvar = "__exn" in
>>     fun
>>     [ <:match_case@_loc< $m1$ | $m2$ >> ->
>>         <:match_case< $map_handler m1$ | $map_handler m2$ >>
>>     | <:match_case@_loc< $p$ when $w$ -> $e$ >> ->
>>         <:match_case@_loc<
>>           ($p$ as $lid:patvar$) when $w$ -> $add_debug_expr _loc patvar
>> e$ >>
>>     | m -> m ];
>>
>>   value filter = object
>>     inherit Ast.map as super;
>>     method expr = fun
>>     [ <:expr@_loc< try $e$ with [ $h$ ] >> ->
>>       <:expr< try $e$ with [ $map_handler h$ ] >>
>>     | x -> super#expr x ];
>>   end;
>>
>>
>> PPX:
>>
>>   method expr e =
>>     let e = super#expr e in
>>     { e with pexp_desc =
>>         match e.pexp_desc with
>>           | Pexp_try (body, handler) ->
>>             let instrument_case (pat, body) =
>>               let patvar_str =  "__exn" in
>>               let patvar = Location.mknoloc (Longident.parse patvar_str)
>> in
>>               let pat = { pat with ppat_desc =
>>                 Ppat_alias (pat, Location.mknoloc patvar_str) } in
>>               (pat, add_register patvar body) in
>>             Pexp_try (body, List.map instrument_case handler)
>>           | other -> other
>>     }
>>
>>
>> This might be a matter of taste, but I prefer the PPX version, which I
>> can read only by knowing about the Parsetree (which is required anyway to
>> write any such code), a normal OCaml library.  The quotation and
>> anti-quotations in the Camlp4 version look very noisy, and it relies on a
>> syntax I'm not familiar with (revised syntax) and syntactic extensions
>> (quotations/antiquotations), with their own conventions ("<:match_case<",
>> $lid:$).  Since I'm not writing extensions every day, I really prefer
>> having to learn how to use simple OCaml data types and libraries
>> (Parsetree, Ast_helper) rather than to learn new syntax and new concepts.
>>  Also, I'd write the code above as:
>>
>> (* --> in Ast_helper.Convenience *)
>> let palias p x = P.alias p (mknoloc x)
>> let evar s = E.ident (mknoloc (Longident.parse s))
>> ...
>>
>>   method expr e =
>>     let e = super#expr e in
>>     match e.pexp_desc with
>>     | Pexp_try (body, handler) ->
>>         let instrument_case (pat, body) =
>>           (palias pat "__exn", add_register (evar "__exn") body)
>>         in
>>         {e with pexp_desc = Pexp_try (body, List.map instrument_case
>> handler)}
>>     | e -> e
>
>
>
> I used this example specifically to discuss the quasiquotation feature,
> not as a general comparison of -ppx and Camlp4's extension writing
> facilities. I do agree that, in this example, the AST traversal framework
> of -ppx is in fact better than Camlp4's. This is related to the fact that
> the AST structure is simpler and more closely reflect the way I logically
> think about pieces of OCaml code: match only takes a (pattern * expr) list
> instead of being a recursive expression of nested branches. That's a plus
> for ppx's design (and I like your approach of improving the upstream AST
> description to make it even better, at least while we don't have extension
> writers with code that breaks when we change it).
>
> That said, I think you're also a bit quick to jump to conclusions here.
> The question of whether the extension uses classical or revised syntax is
> largely orthogonal to the design of the extension itself (except
> occasionally with quotation ambiguities concerns), and I could have used
> the classic syntax to write the Camlp4 extension just as well. What
> happened in practice is that I looked at the set of old Camlp4 extensions I
> had lying around, copy-pasted the code of the one that looked most closely
> like what I was looking for (traversing the "match" structure), and spent
> the rest of the time wondering which output code to produce (the
> "add_register" function I quoted, plus the pattern-alias stuff).
>
> So the bottleneck in practice was in the code production part. It was just
> as true for the -ppx version (the traversal part was easy to write), but my
> experience producing code in the -ppx version was much less gratifying. Of
> course, it was my first use of your Ast_mapper.E interface, so there was
> some learning cost to take into account. But then I had type errors, I had
> to look at the documentation again, and it was a bit painful. Finally, I
> only handle Camlp4 extensions about once a year, so I have time to forget
> most details about how they work, in particular I *always* look at the
> documentation for the concrete AST constructor names in the (rare) cases
> where I need them. I found that there was no such re-learning curve with
> quasiquotations, they just work out of the box -- once you've been
> rebrained, once and forall, to see those <:stuff< >> as structured code
> rather than ASCII noise.
>
> I think the small tool you just introduced (translating OCaml code into
> AST-building ocaml code) may have made this "code production" part easier,
> but I'm not fond of the idea of pasting auto-generated code in my own code.
> In any case, it would be better if it produced code using the nice
> high-level interface, rather than the hard-to-read AST definitions, but
> that may be much more painful to implement so I'm not really asking for
> that.
>
>
>
>>  But maybe we
>>> can have quasiquotations with the current extension mechanism?
>>>
>>> let add_register patvar body =
>>>    [%quote
>>>      let _ = ExceptionHandling.register [%anti patvar] in [%anti body]
>>>    ]
>>>
>>
>> Implementing this "quote" expander is not very difficult, just a little
>> bit tedious (and this can be automated by parsing the definition of the
>> Parsetree).
>
>
> Isn't that essentially the same thing as the tool you implemented for
> Xavier above? (Can you reuse code between both?)
> If I understand correctly, this is also the "Meta" operation of Camlp4,
> turning the AST for the expression <foo> into the AST for the OCaml
> expression representing the AST for <foo>. When you say "automated by
> parsing the definition of the Parsetree", do you have a realistic design in
> mind for such boilerplate code generators, or do you plan in practice to
> implement them by hand?
>
> Note that nothing forces to use [%anti x] for antiquotations.  We could
>> very well decide on a more lightweight convention, like prefixing
>> identifiers, or using a dedicated operator:
>
>
>>     [%quote
>>       let _ = ExceptionHandling.register __patvar in __body
>>     ]
>>
>>     [%quote
>>       let _ = ExceptionHandling.register !!patvar in !!body
>>     ]
>>
>
> Same old battle-horse: I dislike the idea that [%quote ] would change the
> meaning of syntactically valid OCaml code such as __patvar or !!patvar. I
> think I would with [%anti ] for now, or maybe just [%a ] if need be -- in
> any case this is not part of the eventually-crowded extension namespace as
> they really are only markers to be rewritten by the implementation of
> %quote.
>
>
>> But this approach would work nicely only for writing expressions or
>> patterns on OCaml expressions, not on other syntactic categories (because
>> the content of an extension node is an expression).  The problem is that
>> AST-manipulating code tend to require to work a lot with many different
>> categories (like "match cases") even to build expressions.
>>
>
> That's a good point.
>
>
>> Quasi-quotations would be useful if the expanders had to generate big
>> fragments of mostly static code, with only a few "dynamic" placeholders.
>>  In my experience, this is rarely the case: you assemble the resulting
>> OCaml code by combining many small fragments generated programmatically.
>>  For these cases, a nice library of "AST constructors" seems better to me.
>>
>
> Maybe we need both, but if we eventually get nice constructor names for
> the AST definitions (I know that doesn't depend on you) I think if we only
> had time/energy/maintenance for two among (1) AST definitions (2) AST
> combinator library and (3) quasiquotation mechanism, I would suggest we
> keep (1) and (3) rather than (1) and (2).
>
>
>>
>>
>>
>> -- Alain
>>
>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>
>


-- 
-- Regards, Hongbo

--20cf3071cf72dfe6a704d911fc13
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Writing metaprogramming either in quasiquotation or combinator is fine for =
me, the problem is the=A0<div>latter approach does not work well with IDE a=
nd it&#39;s hard to read (we read code more than write)</div><div>About imp=
lementation, my experience is that quotation is very tedious but not diffic=
ult, antiquotation is not easy to get correct. about map_handler, it can be=
 improved in Fan</div>
<div>let rec map_handler =3D=A0</div><div>=A0 let patvar =3D &quot;__exn&qu=
ot; in with match_case (* set the default language*)</div><div>=A0 =A0fun=
=A0</div><div>=A0 =A0[ {| $m1 $ $m2 |} -&gt;=A0</div><div>=A0 =A0 =A0{| $(m=
ap_hander m1) | $(map_handler m2) =A0|}</div>
<div>=A0 =A0| {| $p when $w -&gt; $e |} -&gt; =A0</div><div>=A0 =A0 =A0{| (=
$p as $lid:patvar) when $w -&gt; $(add_debug_expr _loc patvar e) =A0|}</div=
><div>=A0 =A0| m -&gt; m ];;<br><br><div class=3D"gmail_quote">On Fri, Mar =
29, 2013 at 11:12 AM, Gabriel Scherer <span dir=3D"ltr">&lt;<a href=3D"mail=
to:gabriel.scherer@gmail.com" target=3D"_blank">gabriel.scherer@gmail.com</=
a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div dir=3D"ltr"><br><br><div class=3D"gmail=
_extra"><div class=3D"gmail_quote"><div class=3D"im">On Fri, Mar 29, 2013 a=
t 3:35 PM, Alain Frisch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain.frisc=
h@lexifi.com" target=3D"_blank">alain.frisch@lexifi.com</a>&gt;</span> wrot=
e:<br>


<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">I&#39;d write it as:<br>
<br>
let add_register e body =3D<br>
=A0 let_in [pany, app (evar &quot;ExceptionHandling.register&quot;) [e]] bo=
dy<br>
<br>
which does not look so bad. =A0This relies on the following definitions, wh=
ich could go e.g. in a Ast_helper.Convenience module:<br>
<br>
let evar s =3D E.ident (mknoloc (Longident.parse s))<br>
let let_in l body =3D E.let_ Nonrecursive l b<br>
=A0 =A0(* maybe with an optional argument for the recursive case *)<br>
let pany =3D P.any ()<br>
let app f args =3D apply f (List.map (fun a -&gt; &quot;&quot;, a) args)<br=
></blockquote><div><br></div></div><div>That is better indeed. I can only e=
ncourage you to add these kind of conveniences in the E submodule (or maybe=
 somewhere else) as usage suggests that they are useful. I originally plann=
ed to report on that through proper (?) channels, but that got lost in the =
noise of things to do, sorry.<br>


<br></div><div>I&#39;m still not sure that quasi-quotations are not a bette=
r approach, because the problem here is that the user has to learn a new in=
terface to describe code fragments instead of using the syntax he&#39;s alr=
eady familiar with. You have convincingly argued that the OCaml syntax cann=
ot always be used to describe AST fragments (even in Camlp4, if you use the=
 classic syntax in quotations some ambiguities force you to revert to plain=
 AST constructors from time to time), and I hear the argument about fitting=
 lots of small pieces together instead of inserting large chunks of code. I=
 still have the intuition that those arguments are more relevant to the exp=
ert extension writer, and that for a large set of use cases that concern *s=
imple* extensions and beginner extension writers, quasiquotations are still=
 noticeably easier to use. That this feeling appears to be reflected by Xav=
ier Clerc, which is one of the other early-triers of -ppx, gives me a hint =
that it may have some objective qualities.<br>


</div><div><div class=3D"h5"><div>=A0</div><blockquote class=3D"gmail_quote=
" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
<br>
The rest of the code is interesting as well:<br>
<br>
Camlp4:<br>
<br>
=A0 value rec map_handler =3D<br>
=A0 =A0 let patvar =3D &quot;__exn&quot; in<br>
=A0 =A0 fun<br>
=A0 =A0 [ &lt;:match_case@_loc&lt; $m1$ | $m2$ &gt;&gt; -&gt;<br>
=A0 =A0 =A0 =A0 &lt;:match_case&lt; $map_handler m1$ | $map_handler m2$ &gt=
;&gt;<br>
=A0 =A0 | &lt;:match_case@_loc&lt; $p$ when $w$ -&gt; $e$ &gt;&gt; -&gt;<br=
>
=A0 =A0 =A0 =A0 &lt;:match_case@_loc&lt;<br>
=A0 =A0 =A0 =A0 =A0 ($p$ as $lid:patvar$) when $w$ -&gt; $add_debug_expr _l=
oc patvar e$ &gt;&gt;<br>
=A0 =A0 | m -&gt; m ];<br>
<br>
=A0 value filter =3D object<br>
=A0 =A0 inherit Ast.map as super;<br>
=A0 =A0 method expr =3D fun<br>
=A0 =A0 [ &lt;:expr@_loc&lt; try $e$ with [ $h$ ] &gt;&gt; -&gt;<br>
=A0 =A0 =A0 &lt;:expr&lt; try $e$ with [ $map_handler h$ ] &gt;&gt;<br>
=A0 =A0 | x -&gt; super#expr x ];<br>
=A0 end;<br>
<br>
<br>
PPX:<br>
<br>
=A0 method expr e =3D<br>
=A0 =A0 let e =3D super#expr e in<br>
=A0 =A0 { e with pexp_desc =3D<br>
=A0 =A0 =A0 =A0 match e.pexp_desc with<br>
=A0 =A0 =A0 =A0 =A0 | Pexp_try (body, handler) -&gt;<br>
=A0 =A0 =A0 =A0 =A0 =A0 let instrument_case (pat, body) =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 let patvar_str =3D =A0&quot;__exn&quot; in<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 let patvar =3D Location.mknoloc (Longident.pars=
e patvar_str) in<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 let pat =3D { pat with ppat_desc =3D<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 Ppat_alias (pat, Location.mknoloc patvar_st=
r) } in<br>
=A0 =A0 =A0 =A0 =A0 =A0 =A0 (pat, add_register patvar body) in<br>
=A0 =A0 =A0 =A0 =A0 =A0 Pexp_try (body, List.map instrument_case handler)<b=
r>
=A0 =A0 =A0 =A0 =A0 | other -&gt; other<br>
=A0 =A0 }<br>
<br>
<br>
This might be a matter of taste, but I prefer the PPX version, which I can =
read only by knowing about the Parsetree (which is required anyway to write=
 any such code), a normal OCaml library. =A0The quotation and anti-quotatio=
ns in the Camlp4 version look very noisy, and it relies on a syntax I&#39;m=
 not familiar with (revised syntax) and syntactic extensions (quotations/an=
tiquotations), with their own conventions (&quot;&lt;:match_case&lt;&quot;,=
 $lid:$). =A0Since I&#39;m not writing extensions every day, I really prefe=
r having to learn how to use simple OCaml data types and libraries (Parsetr=
ee, Ast_helper) rather than to learn new syntax and new concepts. =A0Also, =
I&#39;d write the code above as:<br>



<br>
(* --&gt; in Ast_helper.Convenience *)<br>
let palias p x =3D P.alias p (mknoloc x)<br>
let evar s =3D E.ident (mknoloc (Longident.parse s))<br>
...<br>
<br>
=A0 method expr e =3D<br>
=A0 =A0 let e =3D super#expr e in<br>
=A0 =A0 match e.pexp_desc with<br>
=A0 =A0 | Pexp_try (body, handler) -&gt;<br>
=A0 =A0 =A0 =A0 let instrument_case (pat, body) =3D<br>
=A0 =A0 =A0 =A0 =A0 (palias pat &quot;__exn&quot;, add_register (evar &quot=
;__exn&quot;) body)<br>
=A0 =A0 =A0 =A0 in<br>
=A0 =A0 =A0 =A0 {e with pexp_desc =3D Pexp_try (body, List.map instrument_c=
ase handler)}<br>
=A0 =A0 | e -&gt; e</blockquote><div><br><br></div></div></div><div>I used =
this example specifically to discuss the quasiquotation feature, not as a g=
eneral comparison of -ppx and Camlp4&#39;s extension writing facilities. I =
do agree that, in this example, the AST traversal framework of -ppx is in f=
act better than Camlp4&#39;s. This is related to the fact that the AST stru=
cture is simpler and more closely reflect the way I logically think about p=
ieces of OCaml code: match only takes a (pattern * expr) list instead of be=
ing a recursive expression of nested branches. That&#39;s a plus for ppx&#3=
9;s design (and I like your approach of improving the upstream AST descript=
ion to make it even better, at least while we don&#39;t have extension writ=
ers with code that breaks when we change it).<br>


</div><div><br></div><div>That said, I think you&#39;re also a bit quick to=
 jump to conclusions here. The question of whether the extension uses class=
ical or revised syntax is largely orthogonal to the design of the extension=
 itself (except occasionally with quotation ambiguities concerns), and I co=
uld have used the classic syntax to write the Camlp4 extension just as well=
. What happened in practice is that I looked at the set of old Camlp4 exten=
sions I had lying around, copy-pasted the code of the one that looked most =
closely like what I was looking for (traversing the &quot;match&quot; struc=
ture), and spent the rest of the time wondering which output code to produc=
e (the &quot;add_register&quot; function I quoted, plus the pattern-alias s=
tuff).<br>


</div><div><br>So the bottleneck in practice was in the code production par=
t. It was just as true for the -ppx version (the traversal part was easy to=
 write), but my experience producing code in the -ppx version was much less=
 gratifying. Of course, it was my first use of your Ast_mapper.E interface,=
 so there was some learning cost to take into account. But then I had type =
errors, I had to look at the documentation again, and it was a bit painful.=
 Finally, I only handle Camlp4 extensions about once a year, so I have time=
 to forget most details about how they work, in particular I *always* look =
at the documentation for the concrete AST constructor names in the (rare) c=
ases where I need them. I found that there was no such re-learning curve wi=
th quasiquotations, they just work out of the box -- once you&#39;ve been r=
ebrained, once and forall, to see those &lt;:stuff&lt; &gt;&gt; as structur=
ed code rather than ASCII noise.<br>


<br></div><div>I think the small tool you just introduced (translating OCam=
l code into AST-building ocaml code) may have made this &quot;code producti=
on&quot; part easier, but I&#39;m not fond of the idea of pasting auto-gene=
rated code in my own code. In any case, it would be better if it produced c=
ode using the nice high-level interface, rather than the hard-to-read AST d=
efinitions, but that may be much more painful to implement so I&#39;m not r=
eally asking for that. <br>


</div><div class=3D"im"><div><br>=A0</div><blockquote class=3D"gmail_quote"=
 style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><d=
iv>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
But maybe we<br>
can have quasiquotations with the current extension mechanism?<br>
<br>
let add_register patvar body =3D<br>
=A0 =A0[%quote<br>
=A0 =A0 =A0let _ =3D ExceptionHandling.register [%anti patvar] in [%anti bo=
dy]<br>
=A0 =A0]<br>
</blockquote>
<br></div>
Implementing this &quot;quote&quot; expander is not very difficult, just a =
little bit tedious (and this can be automated by parsing the definition of =
the Parsetree).</blockquote><br></div></div><div>Isn&#39;t that essentially=
 the same thing as the tool you implemented for Xavier above? (Can you reus=
e code between both?)<br>


If I understand correctly, this is also the &quot;Meta&quot; operation of C=
amlp4, turning the AST for the expression &lt;foo&gt; into the AST for the =
OCaml expression representing the AST for &lt;foo&gt;. When you say &quot;a=
utomated by parsing the definition of the Parsetree&quot;, do you have a re=
alistic design in mind for such boilerplate code generators, or do you plan=
 in practice to implement them by hand?<br>


<br></div><div class=3D"gmail_quote"><div class=3D"im"><blockquote class=3D=
"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding=
-left:1ex">Note that nothing forces to use [%anti x] for antiquotations. =
=A0We could very well decide on a more lightweight convention, like prefixi=
ng identifiers, or using a dedicated operator:=A0</blockquote>


<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
<br>
=A0 =A0 [%quote<br>
=A0 =A0 =A0 let _ =3D ExceptionHandling.register __patvar in __body<br>
=A0 =A0 ]<br>
<br>
=A0 =A0 [%quote<br>
=A0 =A0 =A0 let _ =3D ExceptionHandling.register !!patvar in !!body<br>
=A0 =A0 ]<br></blockquote><div><br></div></div><div>Same old battle-horse: =
I dislike the idea that [%quote ] would change the meaning of syntactically=
 valid OCaml code such as __patvar or !!patvar. I think I would with [%anti=
 ] for now, or maybe just [%a ] if need be -- in any case this is not part =
of the eventually-crowded extension namespace as they really are only marke=
rs to be rewritten by the implementation of %quote.<br>


</div><div class=3D"im"><div>=A0<br></div><blockquote class=3D"gmail_quote"=
 style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
But this approach would work nicely only for writing expressions or pattern=
s on OCaml expressions, not on other syntactic categories (because the cont=
ent of an extension node is an expression). =A0The problem is that AST-mani=
pulating code tend to require to work a lot with many different categories =
(like &quot;match cases&quot;) even to build expressions.<br>


</blockquote><div><br></div></div><div>That&#39;s a good point.<br></div><d=
iv class=3D"im"><div>=A0</div><blockquote class=3D"gmail_quote" style=3D"ma=
rgin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
Quasi-quotations would be useful if the expanders had to generate big fragm=
ents of mostly static code, with only a few &quot;dynamic&quot; placeholder=
s. =A0In my experience, this is rarely the case: you assemble the resulting=
 OCaml code by combining many small fragments generated programmatically. =
=A0For these cases, a nice library of &quot;AST constructors&quot; seems be=
tter to me.<span><font color=3D"#888888"><br>


</font></span></blockquote><div><br></div></div><div>Maybe we need both, bu=
t if we eventually get nice constructor names for the AST definitions (I kn=
ow that doesn&#39;t depend on you) I think if we only had time/energy/maint=
enance for two among (1) AST definitions (2) AST combinator library and (3)=
 quasiquotation mechanism, I would suggest we keep (1) and (3) rather than =
(1) and (2).<br>


</div><div>=A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0=
 .8ex;border-left:1px #ccc solid;padding-left:1ex"><span><font color=3D"#88=
8888">
<br>
<br>
<br>
-- Alain<br>
</font></span></blockquote></div><br></div></div>
<br>_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
<br></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regar=
ds, Hongbo
</div>

--20cf3071cf72dfe6a704d911fc13--

From alain.frisch@lexifi.com  Fri Mar 29 19:10:31 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 88B5D3C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 19:10:31 +0000 (GMT)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1461994 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:50521)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1ULeoP-0006yy-8g (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 29 Mar 2013 19:18:07 +0000
Received: from [192.168.0.10] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id E2DDDA61EF;
 Fri, 29 Mar 2013 20:18:00 +0100 (CET)
Message-ID: <5155E8E9.1050905@lexifi.com>
Date: Fri, 29 Mar 2013 20:18:01 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130307 Thunderbird/17.0.4
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <5155A697.7050302@lexifi.com>
 <CAPFanBFhAkfqJ9DiyRuM6D0HBetFy2KtUyQAj1VmEJM3tj4rAw@mail.gmail.com>
In-Reply-To: <CAPFanBFhAkfqJ9DiyRuM6D0HBetFy2KtUyQAj1VmEJM3tj4rAw@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 29 Mar 2013 19:10:31 -0000

On 3/29/2013 4:12 PM, Gabriel Scherer wrote:
> That is better indeed. I can only encourage you to add these kind of
> conveniences in the E submodule (or maybe somewhere else) as usage
> suggests that they are useful.

I believe that a good design for a Convenience submodule will follow the 
adaptation of existing syntax extension into -ppx style.  A first list 
of convenience functions can be found in:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/print_gen.ml?revision=HEAD&view=markup

(a quick attempt to generate "variantizer" functions from type 
definitions, here taken from .cmi files)

> I'm still not sure that quasi-quotations are not a better approach,
> because the problem here is that the user has to learn a new interface
> to describe code fragments instead of using the syntax he's already
> familiar with.

I think it is very similar with quotations and antiquotations.  There 
are fewer names to know, but this can become more confusing.

For instance, in:

   <:expr<  $xxx:e$ >>

you need different antiquotations names to indicate at least that x is 
(i) an expression, or (ii) a string to be interpreted as a lower-case 
identifier, or (iii) a longident, or (iv) a string to be interpreted as 
a constructor name, or (v) a string to be interpreted as a string 
literal.  Each anti-quotation can be used only in specific contexts. 
Basically, one recreates a dedicated sub-language, with its own syntax 
and types, whereas OCaml is not *that* bad at manipulating ASTs.


> I still have the intuition that those arguments are more
> relevant to the expert extension writer, and that for a large set of use
> cases that concern *simple* extensions and beginner extension writers,
> quasiquotations are still noticeably easier to use.

I wouldn't trust a syntactic tool written by someone who is not quite 
familiar with the definition of the Parsetree.  That said, I've nothing 
against trying to make writing extensions as simple as possible. I'm 
personally more interested in providing tools and techniques to support 
writing robust "non trivial" extensions, but it's a nice observation 
that the current proposal with extension nodes supports quotation, and I 
encourage people interested in supporting "concrete syntax" ppx 
rewriters to push this idea further.


> The question of whether the extension uses classical or revised syntax
> is largely orthogonal to the design of the extension itself (except
> occasionally with quotation ambiguities concerns), and I could have used
> the classic syntax to write the Camlp4 extension just as well.

Including within quotations?  At some time, this was not supported; 
later it was supported but discouraged, because the standard syntax was 
not "regular" enough to support non-ambiguous quotations (I don't know 
the details).  But maybe that the status of quotations in regular syntax 
has changed.

> I found that
> there was no such re-learning curve with quasiquotations, they just work
> out of the box -- once you've been rebrained, once and forall, to see
> those <:stuff< >> as structured code rather than ASCII noise.

Can you tell without looking at the documentation or existing code how 
to write a function which maps a string s to an AST fragment 
representing a constructor of name s applied to a single argument, the 
string literal represented by s.  I.e. mapping "Foo" to the AST fragment 
corresponding to the expression

   Foo "Foo"

?

>     Implementing this "quote" expander is not very difficult, just a
>     little bit tedious (and this can be automated by parsing the
>     definition of the Parsetree).
>
>
> Isn't that essentially the same thing as the tool you implemented for
> Xavier above? (Can you reuse code between both?)

This tool relies on the toplevel value printer.  I'm not sure it will be 
easy to suport anti-quotations with this approach.

 > If I understand correctly, this is also the "Meta" operation of
 > Camlp4,
 > turning the AST for the expression <foo> into the AST for the OCaml
 > expression representing the AST for <foo>. When you say "automated by
 > parsing the definition of the Parsetree", do you have a realistic
 > design
 > in mind for such boilerplate code generators, or do you plan in
 > practice
 > to implement them by hand?

Something similar to 
branches/extension_points/experimental/frisch/print_gen.ml could be used 
to generate automatically an AST lifter.  The difficult part is to 
design anti-quotations, though, and since I'm not convinced by this 
approach, I'd rather put energy myself in other projects.

> Same old battle-horse: I dislike the idea that [%quote ] would change
> the meaning of syntactically valid OCaml code such as __patvar or
> !!patvar.

Point taken.  But since we are already under an "extension", I think 
this is less bad.

>     Quasi-quotations would be useful if the expanders had to generate
>     big fragments of mostly static code, with only a few "dynamic"
>     placeholders.  In my experience, this is rarely the case: you
>     assemble the resulting OCaml code by combining many small fragments
>     generated programmatically.  For these cases, a nice library of "AST
>     constructors" seems better to me.
>
>
> Maybe we need both, but if we eventually get nice constructor names for
> the AST definitions (I know that doesn't depend on you) I think if we
> only had time/energy/maintenance for two among (1) AST definitions (2)
> AST combinator library and (3) quasiquotation mechanism, I would suggest
> we keep (1) and (3) rather than (1) and (2).

My preference, as you understood, would be (1) and (2) rather than (1) 
and (3).

An interesting project would be to review existing syntax extension and 
see how much "almost static fragments" (where quasi-quotations shine) 
they have compared to code assembling tiny fragments (where combinators 
are betters).  I suspect that most interesting tools based on Camlp4 
don't have a lot of static fragments, but I might be wrong.


-- Alain


From gabriel.scherer@gmail.com  Fri Mar 29 19:35:15 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9A7C63C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 19:35:15 +0000 (GMT)
X-Cam-SpamDetails: score 0.2 from SpamAssassin-3.3.2-1461994 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.46 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  0.9 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f46.google.com ([209.85.214.46]:42812)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1ULfCL-0003LB-8R (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 29 Mar 2013 19:42:51 +0000
Received: by mail-bk0-f46.google.com with SMTP id je9so286644bkc.33
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 12:42:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=71pbOghmP8gizsDqxtutHb5ShD6XygwQ2RKyu/1sOEk=;
 b=f9E2r9YKgBizmvvtU+N7pimHZeJ9oC4Yb6MYMr/R8tat94KVgHnMRkeIorSZKCZe0U
 dKWeEh/GH81z+bf5UUIRFdEPAq34h+V2bFBbdDd6aswgcczN5D16oBhP22hYLUoG0qvJ
 NiHCDE95L8SoVc/zMxYhX2nqwklCmviHWN5lYBhtaqhRcfxKkyQ2PM2px3Q/wCFMIboI
 b4UFJGg5Xdvf07agFUgj3F5x00MAMv2AxazdrfUufxpAT3p9yYrgZ0HaPChw5ZFTkS0B
 ryYA8c8vccjCsrdO4BBUqfVUTiqFaMeIaM8RH27WsPy5CylbgfqMJpgpZ1vgbY3XExBu
 eV8g==
X-Received: by 10.204.173.204 with SMTP id q12mr1458119bkz.74.1364586169259;
 Fri, 29 Mar 2013 12:42:49 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Fri, 29 Mar 2013 12:42:08 -0700 (PDT)
In-Reply-To: <5155E8E9.1050905@lexifi.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <5155A697.7050302@lexifi.com>
 <CAPFanBFhAkfqJ9DiyRuM6D0HBetFy2KtUyQAj1VmEJM3tj4rAw@mail.gmail.com>
 <5155E8E9.1050905@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 29 Mar 2013 20:42:08 +0100
Message-ID: <CAPFanBF7aOGBN4WQkKTEYeQAkWOFo9CpdNa=MB_DLnpCMcmh9w@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=bcaec52c5cfde292bf04d91579e9
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 29 Mar 2013 19:35:15 -0000

--bcaec52c5cfde292bf04d91579e9
Content-Type: text/plain; charset=ISO-8859-1

Agreed: let's get a bit more experience with which syntax extensions can be
expressed with extension and attribute nodes before drawing more
conclusions on quasiquotations.


On Fri, Mar 29, 2013 at 8:18 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> On 3/29/2013 4:12 PM, Gabriel Scherer wrote:
>
>> That is better indeed. I can only encourage you to add these kind of
>> conveniences in the E submodule (or maybe somewhere else) as usage
>> suggests that they are useful.
>>
>
> I believe that a good design for a Convenience submodule will follow the
> adaptation of existing syntax extension into -ppx style.  A first list of
> convenience functions can be found in:
>
> http://caml.inria.fr/cgi-bin/**viewvc.cgi/ocaml/branches/**
> extension_points/experimental/**frisch/print_gen.ml?revision=**
> HEAD&view=markup<http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/print_gen.ml?revision=HEAD&view=markup>
>
> (a quick attempt to generate "variantizer" functions from type
> definitions, here taken from .cmi files)
>
>
>  I'm still not sure that quasi-quotations are not a better approach,
>> because the problem here is that the user has to learn a new interface
>> to describe code fragments instead of using the syntax he's already
>> familiar with.
>>
>
> I think it is very similar with quotations and antiquotations.  There are
> fewer names to know, but this can become more confusing.
>
> For instance, in:
>
>   <:expr<  $xxx:e$ >>
>
> you need different antiquotations names to indicate at least that x is (i)
> an expression, or (ii) a string to be interpreted as a lower-case
> identifier, or (iii) a longident, or (iv) a string to be interpreted as a
> constructor name, or (v) a string to be interpreted as a string literal.
>  Each anti-quotation can be used only in specific contexts. Basically, one
> recreates a dedicated sub-language, with its own syntax and types, whereas
> OCaml is not *that* bad at manipulating ASTs.
>
>
>
>  I still have the intuition that those arguments are more
>> relevant to the expert extension writer, and that for a large set of use
>> cases that concern *simple* extensions and beginner extension writers,
>> quasiquotations are still noticeably easier to use.
>>
>
> I wouldn't trust a syntactic tool written by someone who is not quite
> familiar with the definition of the Parsetree.  That said, I've nothing
> against trying to make writing extensions as simple as possible. I'm
> personally more interested in providing tools and techniques to support
> writing robust "non trivial" extensions, but it's a nice observation that
> the current proposal with extension nodes supports quotation, and I
> encourage people interested in supporting "concrete syntax" ppx rewriters
> to push this idea further.
>
>
>
>  The question of whether the extension uses classical or revised syntax
>> is largely orthogonal to the design of the extension itself (except
>> occasionally with quotation ambiguities concerns), and I could have used
>> the classic syntax to write the Camlp4 extension just as well.
>>
>
> Including within quotations?  At some time, this was not supported; later
> it was supported but discouraged, because the standard syntax was not
> "regular" enough to support non-ambiguous quotations (I don't know the
> details).  But maybe that the status of quotations in regular syntax has
> changed.
>
>
>  I found that
>> there was no such re-learning curve with quasiquotations, they just work
>> out of the box -- once you've been rebrained, once and forall, to see
>> those <:stuff< >> as structured code rather than ASCII noise.
>>
>
> Can you tell without looking at the documentation or existing code how to
> write a function which maps a string s to an AST fragment representing a
> constructor of name s applied to a single argument, the string literal
> represented by s.  I.e. mapping "Foo" to the AST fragment corresponding to
> the expression
>
>   Foo "Foo"
>
>
> ?
>
>      Implementing this "quote" expander is not very difficult, just a
>>     little bit tedious (and this can be automated by parsing the
>>     definition of the Parsetree).
>>
>>
>> Isn't that essentially the same thing as the tool you implemented for
>> Xavier above? (Can you reuse code between both?)
>>
>
> This tool relies on the toplevel value printer.  I'm not sure it will be
> easy to suport anti-quotations with this approach.
>
>
> > If I understand correctly, this is also the "Meta" operation of
> > Camlp4,
> > turning the AST for the expression <foo> into the AST for the OCaml
> > expression representing the AST for <foo>. When you say "automated by
> > parsing the definition of the Parsetree", do you have a realistic
> > design
> > in mind for such boilerplate code generators, or do you plan in
> > practice
> > to implement them by hand?
>
> Something similar to branches/extension_points/**experimental/frisch/
> print_gen.**ml <http://print_gen.ml> could be used to generate
> automatically an AST lifter.  The difficult part is to design
> anti-quotations, though, and since I'm not convinced by this approach, I'd
> rather put energy myself in other projects.
>
>
>  Same old battle-horse: I dislike the idea that [%quote ] would change
>> the meaning of syntactically valid OCaml code such as __patvar or
>> !!patvar.
>>
>
> Point taken.  But since we are already under an "extension", I think this
> is less bad.
>
>
>      Quasi-quotations would be useful if the expanders had to generate
>>     big fragments of mostly static code, with only a few "dynamic"
>>     placeholders.  In my experience, this is rarely the case: you
>>     assemble the resulting OCaml code by combining many small fragments
>>     generated programmatically.  For these cases, a nice library of "AST
>>     constructors" seems better to me.
>>
>>
>> Maybe we need both, but if we eventually get nice constructor names for
>> the AST definitions (I know that doesn't depend on you) I think if we
>> only had time/energy/maintenance for two among (1) AST definitions (2)
>> AST combinator library and (3) quasiquotation mechanism, I would suggest
>> we keep (1) and (3) rather than (1) and (2).
>>
>
> My preference, as you understood, would be (1) and (2) rather than (1) and
> (3).
>
> An interesting project would be to review existing syntax extension and
> see how much "almost static fragments" (where quasi-quotations shine) they
> have compared to code assembling tiny fragments (where combinators are
> betters).  I suspect that most interesting tools based on Camlp4 don't have
> a lot of static fragments, but I might be wrong.
>
>
> -- Alain
>
>

--bcaec52c5cfde292bf04d91579e9
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Agreed: let&#39;s get a bit more experience with which syn=
tax extensions can be expressed with extension and attribute nodes before d=
rawing more conclusions on quasiquotations.<br><div><div></div></div></div>

<div class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Fri, Mar 2=
9, 2013 at 8:18 PM, Alain Frisch <span dir=3D"ltr">&lt;<a href=3D"mailto:al=
ain.frisch@lexifi.com" target=3D"_blank">alain.frisch@lexifi.com</a>&gt;</s=
pan> wrote:<br>

<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">On 3/29/2013 4:12 PM, Gabr=
iel Scherer wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
That is better indeed. I can only encourage you to add these kind of<br>
conveniences in the E submodule (or maybe somewhere else) as usage<br>
suggests that they are useful.<br>
</blockquote>
<br></div>
I believe that a good design for a Convenience submodule will follow the ad=
aptation of existing syntax extension into -ppx style. =A0A first list of c=
onvenience functions can be found in:<br>
<br>
<a href=3D"http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension=
_points/experimental/frisch/print_gen.ml?revision=3DHEAD&amp;view=3Dmarkup"=
 target=3D"_blank">http://caml.inria.fr/cgi-bin/<u></u>viewvc.cgi/ocaml/bra=
nches/<u></u>extension_points/experimental/<u></u>frisch/print_gen.ml?revis=
ion=3D<u></u>HEAD&amp;view=3Dmarkup</a><br>


<br>
(a quick attempt to generate &quot;variantizer&quot; functions from type de=
finitions, here taken from .cmi files)<div class=3D"im"><br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
I&#39;m still not sure that quasi-quotations are not a better approach,<br>
because the problem here is that the user has to learn a new interface<br>
to describe code fragments instead of using the syntax he&#39;s already<br>
familiar with.<br>
</blockquote>
<br></div>
I think it is very similar with quotations and antiquotations. =A0There are=
 fewer names to know, but this can become more confusing.<br>
<br>
For instance, in:<br>
<br>
=A0 &lt;:expr&lt; =A0$xxx:e$ &gt;&gt;<br>
<br>
you need different antiquotations names to indicate at least that x is (i) =
an expression, or (ii) a string to be interpreted as a lower-case identifie=
r, or (iii) a longident, or (iv) a string to be interpreted as a constructo=
r name, or (v) a string to be interpreted as a string literal. =A0Each anti=
-quotation can be used only in specific contexts. Basically, one recreates =
a dedicated sub-language, with its own syntax and types, whereas OCaml is n=
ot *that* bad at manipulating ASTs.<div class=3D"im">

<br>
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
I still have the intuition that those arguments are more<br>
relevant to the expert extension writer, and that for a large set of use<br=
>
cases that concern *simple* extensions and beginner extension writers,<br>
quasiquotations are still noticeably easier to use.<br>
</blockquote>
<br></div>
I wouldn&#39;t trust a syntactic tool written by someone who is not quite f=
amiliar with the definition of the Parsetree. =A0That said, I&#39;ve nothin=
g against trying to make writing extensions as simple as possible. I&#39;m =
personally more interested in providing tools and techniques to support wri=
ting robust &quot;non trivial&quot; extensions, but it&#39;s a nice observa=
tion that the current proposal with extension nodes supports quotation, and=
 I encourage people interested in supporting &quot;concrete syntax&quot; pp=
x rewriters to push this idea further.<div class=3D"im">

<br>
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
The question of whether the extension uses classical or revised syntax<br>
is largely orthogonal to the design of the extension itself (except<br>
occasionally with quotation ambiguities concerns), and I could have used<br=
>
the classic syntax to write the Camlp4 extension just as well.<br>
</blockquote>
<br></div>
Including within quotations? =A0At some time, this was not supported; later=
 it was supported but discouraged, because the standard syntax was not &quo=
t;regular&quot; enough to support non-ambiguous quotations (I don&#39;t kno=
w the details). =A0But maybe that the status of quotations in regular synta=
x has changed.<div class=3D"im">

<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
I found that<br>
there was no such re-learning curve with quasiquotations, they just work<br=
>
out of the box -- once you&#39;ve been rebrained, once and forall, to see<b=
r>
those &lt;:stuff&lt; &gt;&gt; as structured code rather than ASCII noise.<b=
r>
</blockquote>
<br></div>
Can you tell without looking at the documentation or existing code how to w=
rite a function which maps a string s to an AST fragment representing a con=
structor of name s applied to a single argument, the string literal represe=
nted by s. =A0I.e. mapping &quot;Foo&quot; to the AST fragment correspondin=
g to the expression<br>


<br>
=A0 Foo &quot;Foo&quot;<div class=3D"im"><br>
<br>
?<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
=A0 =A0 Implementing this &quot;quote&quot; expander is not very difficult,=
 just a<br>
=A0 =A0 little bit tedious (and this can be automated by parsing the<br>
=A0 =A0 definition of the Parsetree).<br>
<br>
<br>
Isn&#39;t that essentially the same thing as the tool you implemented for<b=
r>
Xavier above? (Can you reuse code between both?)<br>
</blockquote>
<br></div>
This tool relies on the toplevel value printer. =A0I&#39;m not sure it will=
 be easy to suport anti-quotations with this approach.<div class=3D"im"><br=
>
<br>
&gt; If I understand correctly, this is also the &quot;Meta&quot; operation=
 of<br>
&gt; Camlp4,<br>
&gt; turning the AST for the expression &lt;foo&gt; into the AST for the OC=
aml<br>
&gt; expression representing the AST for &lt;foo&gt;. When you say &quot;au=
tomated by<br>
&gt; parsing the definition of the Parsetree&quot;, do you have a realistic=
<br>
&gt; design<br>
&gt; in mind for such boilerplate code generators, or do you plan in<br>
&gt; practice<br>
&gt; to implement them by hand?<br>
<br></div>
Something similar to branches/extension_points/<u></u>experimental/frisch/<=
a href=3D"http://print_gen.ml" target=3D"_blank">print_gen.<u></u>ml</a> co=
uld be used to generate automatically an AST lifter. =A0The difficult part =
is to design anti-quotations, though, and since I&#39;m not convinced by th=
is approach, I&#39;d rather put energy myself in other projects.<div class=
=3D"im">

<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Same old battle-horse: I dislike the idea that [%quote ] would change<br>
the meaning of syntactically valid OCaml code such as __patvar or<br>
!!patvar.<br>
</blockquote>
<br></div>
Point taken. =A0But since we are already under an &quot;extension&quot;, I =
think this is less bad.<div class=3D"im"><br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
=A0 =A0 Quasi-quotations would be useful if the expanders had to generate<b=
r>
=A0 =A0 big fragments of mostly static code, with only a few &quot;dynamic&=
quot;<br>
=A0 =A0 placeholders. =A0In my experience, this is rarely the case: you<br>
=A0 =A0 assemble the resulting OCaml code by combining many small fragments=
<br>
=A0 =A0 generated programmatically. =A0For these cases, a nice library of &=
quot;AST<br>
=A0 =A0 constructors&quot; seems better to me.<br>
<br>
<br>
Maybe we need both, but if we eventually get nice constructor names for<br>
the AST definitions (I know that doesn&#39;t depend on you) I think if we<b=
r>
only had time/energy/maintenance for two among (1) AST definitions (2)<br>
AST combinator library and (3) quasiquotation mechanism, I would suggest<br=
>
we keep (1) and (3) rather than (1) and (2).<br>
</blockquote>
<br></div>
My preference, as you understood, would be (1) and (2) rather than (1) and =
(3).<br>
<br>
An interesting project would be to review existing syntax extension and see=
 how much &quot;almost static fragments&quot; (where quasi-quotations shine=
) they have compared to code assembling tiny fragments (where combinators a=
re betters). =A0I suspect that most interesting tools based on Camlp4 don&#=
39;t have a lot of static fragments, but I might be wrong.<span class=3D"HO=
EnZb"><font color=3D"#888888"><br>


<br>
<br>
-- Alain<br>
<br>
</font></span></blockquote></div><br></div>

--bcaec52c5cfde292bf04d91579e9--

From bobzhang1988@gmail.com  Sat Mar 30 04:53:02 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 681CF3C548
 for <wg-camlp4@lists.ocaml.org>; Sat, 30 Mar 2013 04:53:02 +0000 (GMT)
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1462428 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.220.182 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vc0-f182.google.com ([209.85.220.182]:59334)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1ULnuA-0005Xv-8Y (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Sat, 30 Mar 2013 05:00:39 +0000
Received: by mail-vc0-f182.google.com with SMTP id ht11so1000507vcb.41
 for <wg-camlp4@lists.ocaml.org>; Fri, 29 Mar 2013 22:00:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=H07QEiCwZX/sot1kdaQswMiD+YvkYb6uUNVwq6xPqMw=;
 b=wW4YjcUH5wVw3U+Yndjc44Jli5BPv3coQAvIt3ouabXqlC1U0LRBQ/AcLtfJaKKOvW
 DmCkRxUXRe0Nes/6nBOYRJgNs0JtvKclss19bOV4tweqahXxcuNGQtpHdwa++B9W9c5O
 QnPVIFW/YNw3rlk/4qH4R0LaPfpTmqR8ZT6DTcwffL1YPbkPE7GDUIj0Q2n0BTd4eMCT
 upaVopVO0ni8LbusTc7NAgM1Dtf3M4fEATOas1xzhxIB0eMuKD75Bo6xSRzYuV0aWWID
 /WhITxOlG0znm9UjGOTCrTzzgJwjWfrwLwJ8RiUsSGctTJThhJdDlXe+YfKNE3IkFiwR
 lK8A==
MIME-Version: 1.0
X-Received: by 10.52.174.84 with SMTP id bq20mr3034210vdc.128.1364619637857;
 Fri, 29 Mar 2013 22:00:37 -0700 (PDT)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Fri, 29 Mar 2013 22:00:37 -0700 (PDT)
In-Reply-To: <5155A697.7050302@lexifi.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <5155A697.7050302@lexifi.com>
Date: Sat, 30 Mar 2013 01:00:37 -0400
X-Google-Sender-Auth: 8DSa0C3f57TC45jR5h3_yYpXF9g
Message-ID: <CANcqPu6wv+26UvPX-c7FKkcykotyfW=VixdXrZpodNMJKwZ5Jw@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=bcaec51b9c77c4a76b04d91d4428
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 30 Mar 2013 04:53:02 -0000

--bcaec51b9c77c4a76b04d91d4428
Content-Type: text/plain; charset=ISO-8859-1

> This might be a matter of taste, but I prefer the PPX version, which I can
> read only by knowing about the Parsetree (which is required anyway to write
> any such code), a normal OCaml library.  The quotation and anti-quotations
> in the Camlp4 version look very noisy, and it relies on a syntax I'm not
> familiar with (revised syntax) and syntactic extensions
> (quotations/antiquotations), with their own conventions ("<:match_case<",
> $lid:$).

This is an interesting point. Actually I have an idea to make it more named
antiquotation more tractable, that's instead of allowing antiquote
everything, only a lower identifier is allowed to be antiquoted. so
{:exp| .... $x ....|} (*allowed *)
{:exp| ...  $(arbitrary expression ) ||} (* Disallowed*)
let a = (arbitrary expression) in
{:exp| ...    $a .... |}                             (* written this way*)

Based on such simplified antiquotation, named antiquotation is no longer
context-sensitive, which means for all syntax categories:
$lid:x    -> `Lid (_loc,x)
$uid:x   -> `Uid (_loc,x)
....

Such rules should not be hard to remember and quite intuitive. In terms of
implementation, I think this is already available in Fan, Camlp4's
antiquotation uses both Ant constructor and string mangling, it make some
time to implement, but should not be too difficult.





>
>
> -- Alain
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>



-- 
-- Regards, Hongbo

--bcaec51b9c77c4a76b04d91d4428
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><br><div class=3D"gmail_extra"><div class=3D"gmail_quote">=
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
This might be a matter of taste, but I prefer the PPX version, which I can =
read only by knowing about the Parsetree (which is required anyway to write=
 any such code), a normal OCaml library. =A0The quotation and anti-quotatio=
ns in the Camlp4 version look very noisy, and it relies on a syntax I&#39;m=
 not familiar with (revised syntax) and syntactic extensions (quotations/an=
tiquotations), with their own conventions (&quot;&lt;:match_case&lt;&quot;,=
 $lid:$).=A0</blockquote>
<div style>This is an interesting point. Actually I have an idea to make it=
 more named antiquotation more tractable, that&#39;s instead of allowing an=
tiquote everything, only a lower identifier is allowed to be antiquoted. so=
</div>
<div style>{:exp| .... $x ....|} (*allowed *)</div><div style>{:exp| ... =
=A0$(arbitrary expression ) ||} (* Disallowed*)</div><div style>let a =3D (=
arbitrary expression) in=A0</div><div style>{:exp| ... =A0 =A0$a .... |} =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 (* written this way=
*)=A0</div>
<div style><br></div><div style>Based on such simplified antiquotation, nam=
ed antiquotation is no longer context-sensitive, which means for all syntax=
 categories:</div><div style>$lid:x =A0 =A0-&gt; `Lid (_loc,x)</div><div st=
yle>
$uid:x =A0 -&gt; `Uid (_loc,x)</div><div style>....</div><div style><br></d=
iv><div style>Such rules should not be hard to remember and quite intuitive=
. In terms of implementation, I think this is already available in Fan, Cam=
lp4&#39;s antiquotation uses both Ant constructor and string mangling, it m=
ake some time to implement, but should not be too difficult.</div>
<div style><br></div><div style><br></div><div style><br></div><div style>=
=A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;borde=
r-left:1px #ccc solid;padding-left:1ex"><span class=3D"HOEnZb"><font color=
=3D"#888888"><br>

<br>
-- Alain</font></span><div class=3D"HOEnZb"><div class=3D"h5"><br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo
</div></div>

--bcaec51b9c77c4a76b04d91d4428--

From alain.frisch@lexifi.com  Wed Apr  3 17:43:44 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 37C213C007
 for <wg-camlp4@lists.ocaml.org>; Wed,  3 Apr 2013 17:43:44 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1462718 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:38395
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UNQuN-0007y4-SX (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 03 Apr 2013 17:51:36 +0100
Received: from [192.168.1.109] ([92.151.37.47]) by mwinf5d06 with ME
 id KUra1l00F1120CC03UraWH; Wed, 03 Apr 2013 18:51:35 +0200
Message-ID: <515C5E17.6050409@lexifi.com>
Date: Wed, 03 Apr 2013 18:51:35 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
In-Reply-To: <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 03 Apr 2013 16:43:44 -0000

On 03/29/2013 02:46 PM, Gabriel Scherer wrote:
> Would it be possible to use the extension mechanism itself for
> lightweight quasiquotations?

On 03/29/2013 08:18 PM, Alain Frisch wrote:
> Something similar to
> branches/extension_points/experimental/frisch/print_gen.ml could be
> used to generate automatically an AST lifter.  The difficult part is
> to design anti-quotations, though, and since I'm not convinced by
> this approach, I'd rather put energy myself in other projects.

Ok, as usual, I've been sidetracked by your clever idea :-)

I've created a meta quotation expander (or should it be called 
"quasiquotation" ?), allowing to write AST builders using concrete 
syntax as in:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/metaquot_test.ml?revision=HEAD&view=markup


The code for the ppx rewriter supporting this style is:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/metaquot.ml?revision=HEAD&view=markup

It relies on a "Parsetree lifter" class (Ast_lifter.lifter). The same 
Parsetree lifter can also be used to write a Parsetree printer like the 
tool ocamlast I've described previously, but now without relying on the 
toplevel printer (which requires runtime access to parsetree.cmi, etc). 
  The code for such a printer is in:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/dumpast.ml?revision=HEAD&view=markup


Ast_lifter.lifter is a partial parametrized class, whose type parameter 
describes which output is to be produced (Outcometree.value for the 
printer; Parsetree.expression for the meta quotation expander).  This 
class needs to be extended (through inheritance) in order to provide 
"builder functions" for that type, and potentially to override the 
default behavior for some type under Parsetree.  For instance, the 
printer decides to map all locations of Oval_ellipsis.  Similarly, the 
meta quotation expander detects uses of "anti-quotations" and maps them 
to the identity instead of the default lifting behavior.

The code of ast_lifter.ml looks like:

class virtual ['res] lifter =
   object (this)
     method lift_Parsetree_expression : Parsetree.expression -> 'res=
       fun
         { Parsetree.pexp_desc = pexp_desc; Parsetree.pexp_loc = pexp_loc;
           Parsetree.pexp_attributes = pexp_attributes }
          ->
         this#record "Parsetree.expression"
           [("pexp_desc", (this#lift_Parsetree_expression_desc pexp_desc));
           ("pexp_loc", (this#lift_Location_t pexp_loc));
           ("pexp_attributes",
             (this#list
                (List.map this#lift_Parsetree_attribute pexp_attributes)))]
     method lift_Parsetree_expression_desc :
       Parsetree.expression_desc -> 'res=
       function
       | Parsetree.Pexp_ident x0 ->
           this#constr "Parsetree.expression_desc"
             ("Pexp_ident", [this#lift_Asttypes_loc 
this#lift_Longident_t x0])
       | Parsetree.Pexp_constant x0 ->
           this#constr "Parsetree.expression_desc"
             ("Pexp_constant", [this#lift_Asttypes_constant x0])
       .....

which is very tedious to write by hand (and to maintain when the 
Parsetree evolves).  Of course, this code is not written by hand, it is 
generated from the definition of the Parsetree using a small tool:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/dumpast.ml?revision=HEAD&view=markup

which is executed once to produce ast_lifter.ml:

./genlifter.exe -I ../../parsing -I ../../stdlib Parsetree.expression > 
ast_lifter.ml

All that can be tried by typing "make lifter" in experimental/frisch (on 
the extension_points branch, of course, after a successful "make world").

Now, one could go crazy (Camlp4-style) and use the metaquot ppx rewriter 
within genlifter.ml itself, and then get for free nasty bootstrapping 
problems :-)



Alain

From alain@frisch.fr  Wed Apr  3 17:51:26 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 3B4B33C007
 for <wg-camlp4@lists.ocaml.org>; Wed,  3 Apr 2013 17:51:26 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1462718 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:36421
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UNR1p-00058g-qT (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Wed, 03 Apr 2013 17:59:18 +0100
Received: from [192.168.1.109] ([92.151.37.47]) by mwinf5d06 with ME
 id KUzG1l00X1120CC03UzGVP; Wed, 03 Apr 2013 18:59:16 +0200
Message-ID: <515C5FE5.6050304@frisch.fr>
Date: Wed, 03 Apr 2013 18:59:17 +0200
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <515C5E17.6050409@lexifi.com>
In-Reply-To: <515C5E17.6050409@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Matching on concrete syntax (was: Re: Camlp4 uses)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 03 Apr 2013 16:51:26 -0000

On 04/03/2013 06:51 PM, Alain Frisch wrote:
> which is very tedious to write by hand (and to maintain when the
> Parsetree evolves).  Of course, this code is not written by hand, it is
> generated from the definition of the Parsetree using a small tool:
>
> http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/dumpast.ml?revision=HEAD&view=markup

Sorry, this link should be:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/genlifter.ml?revision=HEAD&view=markup 


-- Alain

From alain.frisch@lexifi.com  Wed Apr  3 18:08:47 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 761583C007
 for <wg-camlp4@lists.ocaml.org>; Wed,  3 Apr 2013 18:08:47 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.2 from SpamAssassin-3.3.2-1462718 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
 *  1.2 MISSING_HEADERS Missing To: header
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:50863
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UNRId-00012a-RO (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 03 Apr 2013 18:16:39 +0100
Received: from [192.168.1.109] ([92.151.37.47]) by mwinf5d06 with ME
 id KVGf1l0011120CC03VGf7J; Wed, 03 Apr 2013 19:16:39 +0200
Message-ID: <515C63F7.4020602@lexifi.com>
Date: Wed, 03 Apr 2013 19:16:39 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
CC: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <515C5E17.6050409@lexifi.com> <515C5FE5.6050304@frisch.fr>
In-Reply-To: <515C5FE5.6050304@frisch.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] Extension developers: we need you!
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 03 Apr 2013 17:08:47 -0000

Now is a good time to start collecting more concrete feedback from 
extension developers on the current proposal (ppx + extension_points). 
Are there people on this list interested in porting their existing 
extensions (or other tools which can benefit from attributes)?   This 
will be greatly helpful if the current design can be validated by real 
extension developers.  Porting real extensions will also help to isolate 
a good set of "convenience" functions to build or deconstruct AST 
fragments in a light way.

(Disclaimer: there will still be some more cleanups to the Parsetree 
definition and helper modules (Ast_mapper, Ast_helper), so the code 
written now will need to be adjusted for the final version, but I expect 
those changes to be quite easy.)


-- Alain

From alain.frisch@lexifi.com  Wed Apr  3 18:47:51 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id CC69A3C007
 for <wg-camlp4@lists.ocaml.org>; Wed,  3 Apr 2013 18:47:51 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.2 from SpamAssassin-3.3.2-1462718 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
 *  1.2 MISSING_HEADERS Missing To: header
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:31854
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UNRuR-0001Xt-ZH (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 03 Apr 2013 18:55:44 +0100
Received: from [192.168.1.109] ([92.151.37.47]) by mwinf5d06 with ME
 id KVvj1l00B1120CC03VvjYn; Wed, 03 Apr 2013 19:55:43 +0200
Message-ID: <515C6D20.5000907@lexifi.com>
Date: Wed, 03 Apr 2013 19:55:44 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
CC: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <515C5E17.6050409@lexifi.com> <515C5FE5.6050304@frisch.fr>
 <515C63F7.4020602@lexifi.com>
In-Reply-To: <515C63F7.4020602@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] Support for extension points in Camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 03 Apr 2013 17:47:51 -0000

Another topic where help would be much appreciated is the support of 
extension points in Camlp4.  Even if one of the goal of all this 
discussion is to replace some uses of Camlp4, there is no reason Camlp4 
could not support itself the three new syntactic features (attributes, 
extension nodes, quoted strings) in its parsers and its custom 
representation of the OCaml AST.  In addition to simplifying a migration 
phase (combining some Camp4 extensions and some -ppx rewriters), 
supporting extensions points in Camlp4 makes sense even for people who 
want (or will have) to continue using Camlp4:

  - AST mappers can then be written not only with -ppx but also as 
Camlp4 AST filters (which supports concrete syntax patterns and 
expressions).

  - It can be imagined that some extensions are split into an AST 
transformation part (to be processed by -ppx) and a change to the 
concrete syntax (with a Camlp4 extension which would only adds 
attributes and extension nodes to the AST).  This would make it possible 
to use the core feature of the extension without camlp4 and still 
provide ad hoc concrete syntax for those who insist on it.

  - Some external tools (a la Bisect) might start using attributes found 
in the parsetree or typedtree, and projects built with Camlp4 will need 
a way to embed such attributes in the source files.


The current state is that Camlp4 has been adapted to the new Parsetree 
(i.e. it generate valid fragments), but its internal representation of 
the OCaml AST and its parsers do not support the new features.  Adding 
this support should not be very difficult for someone familiar enough 
with the implementation of Camlp4.  Any volunteer?


Alain

From yminsky@janestreet.com  Wed Apr  3 20:40:27 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AD2303C007
 for <wg-camlp4@lists.ocaml.org>; Wed,  3 Apr 2013 20:40:27 +0100 (BST)
X-Cam-SpamDetails: score -2.3 from SpamAssassin-3.3.2-1462718 
 * -2.3 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:43496
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UNTfJ-0003bv-8r (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Wed, 03 Apr 2013 20:48:20 +0100
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1UNTex-00058H-0H
 for wg-camlp4@lists.ocaml.org; Wed, 03 Apr 2013 15:47:51 -0400
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1UNTew-0000Vs-Vn
 for wg-camlp4@lists.ocaml.org; Wed, 03 Apr 2013 15:47:50 -0400
Received: from mail-lb0-f200.google.com ([209.85.217.200])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1UNTew-0001W3-QY
 for wg-camlp4@lists.ocaml.org; Wed, 03 Apr 2013 15:47:50 -0400
Received: by mail-lb0-f200.google.com with SMTP id t12so2941533lbi.11
 for <wg-camlp4@lists.ocaml.org>; Wed, 03 Apr 2013 12:47:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type;
 bh=OxLnI2KBVXHoQuNOeHC3YKmEiNKej9kYjDQjEhP5p8w=;
 b=g9ie7pPtEUhRn2WPCduzOMrrZ+CMGj+s0b/wLj6V+PJgLNV/6XK+/E+IBxcOhj+DDd
 RKvdrRfl2C7I3VgiFBEx1U5qoRz2ZDheU0sObRnxqxPZrXvDyZ+eV8KUze/gHqbGNBMf
 8SRy2VbAh3KZ7wq+nhPzrh3mVr/DkcpE7ZAMg=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type:x-gm-message-state;
 bh=OxLnI2KBVXHoQuNOeHC3YKmEiNKej9kYjDQjEhP5p8w=;
 b=WOTSq41atLF8oKyJopLyzsrjxEgk/hPvTkmAThjIhFbH4N9YOlTFVi4l+uWPShakf3
 ZS1hFIeHZClBXSnH/FZ1DqtziqNkRc0ZS/lRazuUBgsdopxOoOlE0H+X1WTDQEEDu7kG
 iOTL4GdGkr8gJYpRoB7Pw5na2n1xnds3c8XhGC2N++hJ8ygGkVk1b90FV17PAIaT/CvN
 iMJ2qnyk3mvgxfSOoRw+E+WlBqDX+KwUhKchkNEPdgaWkPkI4wKqdq8DymUmEk4PUAw5
 uYkNpCSAPlKY/JA9gNqZ2lRLNUub0oFE+pYEoBfbv5Zle4Jo2yO5/w4BHxQuI5K/PdY9
 3h5A==
X-Received: by 10.204.80.140 with SMTP id t12mr2275906bkk.85.1365018469875;
 Wed, 03 Apr 2013 12:47:49 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.204.80.140 with SMTP id t12mr2275898bkk.85.1365018469709;
 Wed, 03 Apr 2013 12:47:49 -0700 (PDT)
Received: by 10.204.226.78 with HTTP; Wed, 3 Apr 2013 12:47:49 -0700 (PDT)
In-Reply-To: <515C63F7.4020602@lexifi.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <515C5E17.6050409@lexifi.com> <515C5FE5.6050304@frisch.fr>
 <515C63F7.4020602@lexifi.com>
Date: Wed, 3 Apr 2013 15:47:49 -0400
Message-ID: <CACLX4jSN9yoAxF1NSuQsXGkWOmypEvCGiyCFVwQNYqm6sdbMYw@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQmLefRIeYhX64zDCxZIEXe6syQAx3vCFaJ+zOXIp+S5ym6nnJIT291PFQbzLUXwUzwvPZvI6XsSxWCU0q66e9/qOV78gHxKRXiwZvzeforjPnFAHU0BPI9ASlyAL1WYZBkF2c1PXukaj0YAyliCvsU28N8W9A==
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Extension developers: we need you!
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 03 Apr 2013 19:40:27 -0000

Alain, if we were to do some experimentation, which branch of the
compiler should we try it on?

y

On Wed, Apr 3, 2013 at 1:16 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> Now is a good time to start collecting more concrete feedback from extension
> developers on the current proposal (ppx + extension_points). Are there
> people on this list interested in porting their existing extensions (or
> other tools which can benefit from attributes)?   This will be greatly
> helpful if the current design can be validated by real extension developers.
> Porting real extensions will also help to isolate a good set of
> "convenience" functions to build or deconstruct AST fragments in a light
> way.
>
> (Disclaimer: there will still be some more cleanups to the Parsetree
> definition and helper modules (Ast_mapper, Ast_helper), so the code written
> now will need to be adjusted for the final version, but I expect those
> changes to be quite easy.)
>
>
> -- Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From bobzhang1988@gmail.com  Thu Apr  4 01:57:46 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 00B033C007
 for <wg-camlp4@lists.ocaml.org>; Thu,  4 Apr 2013 01:57:46 +0100 (BST)
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1462718 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.45 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f45.google.com ([209.85.212.45]:61223)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UNYcQ-0008QR-82 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 04 Apr 2013 02:05:39 +0100
Received: by mail-vb0-f45.google.com with SMTP id w15so931916vbf.32
 for <wg-camlp4@lists.ocaml.org>; Wed, 03 Apr 2013 18:05:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=wLOfAvzvtB7bBSIFD9rcPihP6xdLzs6ohH08/fEUIFA=;
 b=C+qluEf2Ub7Y+JBwoUXBpGeTrICaCK94RpSyemRqW8Q36qTkyaXK+G25+wgxvwPBqc
 hkR6vTkOnb1F4pYJ729DrBZ8zBcUel/isMWDispCFFCXLoRlTe7jTJKYIATtmzsBFujE
 /mnMRUXAQ9xrNa7d/iTajl1YgISzbjQ0PtgKg3X33ZBgxb+pgmB2qFvmJadRymdX4UBk
 G84NVUx5nCsR3Qdy/3vzK5Fd2LqvRvIIXTbpO9EzJimB254lrTg/xx9+WmzZDTUgda0X
 xbFosTlqBL5PPx/nhdfMo1oIK7bqCaHIy4CfKfBME/V7VcK5T6S6GBUVhmSUwDWt9bRa
 pdpg==
MIME-Version: 1.0
X-Received: by 10.52.177.161 with SMTP id cr1mr2687092vdc.64.1365037533659;
 Wed, 03 Apr 2013 18:05:33 -0700 (PDT)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Wed, 3 Apr 2013 18:05:33 -0700 (PDT)
In-Reply-To: <515C6D20.5000907@lexifi.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <515C5E17.6050409@lexifi.com> <515C5FE5.6050304@frisch.fr>
 <515C63F7.4020602@lexifi.com> <515C6D20.5000907@lexifi.com>
Date: Wed, 3 Apr 2013 21:05:33 -0400
X-Google-Sender-Auth: oECtC9fYGuA7-zzJyfrIHYV9VJY
Message-ID: <CANcqPu6unzvPANSead2Uq3P5gRsWKa_n0UZ8VmRAnbX8CH9Gwg@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=20cf3071ceac4c8bc304d97e9109
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Support for extension points in Camlp4
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 04 Apr 2013 00:57:46 -0000

--20cf3071ceac4c8bc304d97e9109
Content-Type: text/plain; charset=ISO-8859-1

Hi Alain,
  I would definitely like to help, but I think it is  a bit too early to
adapt P4.


On Wed, Apr 3, 2013 at 1:55 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> Another topic where help would be much appreciated is the support of
> extension points in Camlp4.  Even if one of the goal of all this discussion
> is to replace some uses of Camlp4, there is no reason Camlp4 could not
> support itself the three new syntactic features (attributes, extension
> nodes, quoted strings) in its parsers and its custom representation of the
> OCaml AST.  In addition to simplifying a migration phase (combining some
> Camp4 extensions and some -ppx rewriters), supporting extensions points in
> Camlp4 makes sense even for people who want (or will have) to continue
> using Camlp4:
>
>  - AST mappers can then be written not only with -ppx but also as Camlp4
> AST filters (which supports concrete syntax patterns and expressions).
>
>  - It can be imagined that some extensions are split into an AST
> transformation part (to be processed by -ppx) and a change to the concrete
> syntax (with a Camlp4 extension which would only adds attributes and
> extension nodes to the AST).  This would make it possible to use the core
> feature of the extension without camlp4 and still provide ad hoc concrete
> syntax for those who insist on it.
>
>  - Some external tools (a la Bisect) might start using attributes found in
> the parsetree or typedtree, and projects built with Camlp4 will need a way
> to embed such attributes in the source files.
>
>
> The current state is that Camlp4 has been adapted to the new Parsetree
> (i.e. it generate valid fragments), but its internal representation of the
> OCaml AST and its parsers do not support the new features.  Adding this
> support should not be very difficult for someone familiar enough with the
> implementation of Camlp4.  Any volunteer?
>
>
> Alain
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>



-- 
-- Regards, Hongbo

--20cf3071ceac4c8bc304d97e9109
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Hi Alain,=A0<div>=A0 I would definitely like to help, but =
I think it is =A0a bit too early to adapt P4.=A0</div></div><div class=3D"g=
mail_extra"><br><br><div class=3D"gmail_quote">On Wed, Apr 3, 2013 at 1:55 =
PM, Alain Frisch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain.frisch@lexif=
i.com" target=3D"_blank">alain.frisch@lexifi.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">Another topic where help would be much appre=
ciated is the support of extension points in Camlp4. =A0Even if one of the =
goal of all this discussion is to replace some uses of Camlp4, there is no =
reason Camlp4 could not support itself the three new syntactic features (at=
tributes, extension nodes, quoted strings) in its parsers and its custom re=
presentation of the OCaml AST. =A0In addition to simplifying a migration ph=
ase (combining some Camp4 extensions and some -ppx rewriters), supporting e=
xtensions points in Camlp4 makes sense even for people who want (or will ha=
ve) to continue using Camlp4:<br>

<br>
=A0- AST mappers can then be written not only with -ppx but also as Camlp4 =
AST filters (which supports concrete syntax patterns and expressions).<br>
<br>
=A0- It can be imagined that some extensions are split into an AST transfor=
mation part (to be processed by -ppx) and a change to the concrete syntax (=
with a Camlp4 extension which would only adds attributes and extension node=
s to the AST). =A0This would make it possible to use the core feature of th=
e extension without camlp4 and still provide ad hoc concrete syntax for tho=
se who insist on it.<br>

<br>
=A0- Some external tools (a la Bisect) might start using attributes found i=
n the parsetree or typedtree, and projects built with Camlp4 will need a wa=
y to embed such attributes in the source files.<br>
<br>
<br>
The current state is that Camlp4 has been adapted to the new Parsetree (i.e=
. it generate valid fragments), but its internal representation of the OCam=
l AST and its parsers do not support the new features. =A0Adding this suppo=
rt should not be very difficult for someone familiar enough with the implem=
entation of Camlp4. =A0Any volunteer?<br>

<br>
<br>
Alain<br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regards, =
Hongbo
</div>

--20cf3071ceac4c8bc304d97e9109--

From alain.frisch@lexifi.com  Thu Apr  4 08:27:03 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id EF54E3C568
 for <wg-camlp4@lists.ocaml.org>; Thu,  4 Apr 2013 08:27:02 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1462718 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:48177
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UNehD-0005Do-qg (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 04 Apr 2013 08:34:57 +0100
Received: from [192.168.1.109] ([92.151.37.47]) by mwinf5d54 with ME
 id Kjau1l00L1120CC03jauoc; Thu, 04 Apr 2013 09:34:55 +0200
Message-ID: <515D2D1E.5090306@lexifi.com>
Date: Thu, 04 Apr 2013 09:34:54 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Yaron Minsky <yminsky@janestreet.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <515C5E17.6050409@lexifi.com> <515C5FE5.6050304@frisch.fr>
 <515C63F7.4020602@lexifi.com>
 <CACLX4jSN9yoAxF1NSuQsXGkWOmypEvCGiyCFVwQNYqm6sdbMYw@mail.gmail.com>
In-Reply-To: <CACLX4jSN9yoAxF1NSuQsXGkWOmypEvCGiyCFVwQNYqm6sdbMYw@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Extension developers: we need you!
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 04 Apr 2013 07:27:03 -0000

Hi Yaron,

All the development has been done on the extension_points branch in the 
SVN.  Don't hesitate to comment early or ask for support if you start 
some experimentation!

Alain


On 04/03/2013 09:47 PM, Yaron Minsky wrote:
> Alain, if we were to do some experimentation, which branch of the
> compiler should we try it on?
>
> y
>
> On Wed, Apr 3, 2013 at 1:16 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
>> Now is a good time to start collecting more concrete feedback from extension
>> developers on the current proposal (ppx + extension_points). Are there
>> people on this list interested in porting their existing extensions (or
>> other tools which can benefit from attributes)?   This will be greatly
>> helpful if the current design can be validated by real extension developers.
>> Porting real extensions will also help to isolate a good set of
>> "convenience" functions to build or deconstruct AST fragments in a light
>> way.
>>
>> (Disclaimer: there will still be some more cleanups to the Parsetree
>> definition and helper modules (Ast_mapper, Ast_helper), so the code written
>> now will need to be adjusted for the final version, but I expect those
>> changes to be quite easy.)
>>
>>
>> -- Alain
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4


From alain.frisch@lexifi.com  Thu Apr  4 13:50:26 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 04F2B3C087
 for <wg-camlp4@lists.ocaml.org>; Thu,  4 Apr 2013 13:50:26 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1462718 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:34650
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UNjkC-0005VE-rj (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 04 Apr 2013 13:58:21 +0100
Received: from [192.168.1.109] ([92.151.37.47]) by mwinf5d54 with ME
 id KoyK1l00W1120CC03oyKLV; Thu, 04 Apr 2013 14:58:20 +0200
Message-ID: <515D78ED.2040705@lexifi.com>
Date: Thu, 04 Apr 2013 14:58:21 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Caml-Devel <caml-devel@yquem.inria.fr>, 
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] About 'a loc in the Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 04 Apr 2013 12:50:26 -0000

Dear all (caml-devel + wg-camlp4),

I'd like to discuss the use of the 'a loc type (string loc and 
Longident.loc) in the definition of the Parsetree.  I think this type 
was introduced as part of the "binannot" project, in order to keep more 
location information in the Typedtree, to be used by external tools 
reading .cmt files.

First, some "unlocated" identifiers remain in the Parsetree
(cf Ptyp_var, Ptyp_alias, Ptyp_poly, Pfield, Pexp_send, Pexp_newtype, 
Pctf_val, Pctf_virt, Pctf_meth, Pcf_inher).  I assume this is simply an 
oversight. Or is there any deeper reason for keeping locations for some 
identifiers but not all of them?

Second, some locations are redundant for constructions whose syntax is 
just the identifier (Ppat_var, Pexp_ident, Pmty_ident, Pmod_ident).  The 
same location is store in the 'a loc record and in pexp_loc/ppat_loc/etc 
field.  I guess that the rationale is that some imaginary alternative 
concrete syntax for the language would use a different representation 
for those constructions.  Another argument is uniformity of 
representation.  But those redundant location introduce some overhead 
when building and deconstructing very common fragments of Parsetrees. 
For building fragments, this can be largely accommodated by the use of 
constructor functions, but for pattern matching on AST, there is no such 
easy solution.  One could consider getting rid of those redundant "'a 
loc" wrappers.  Any opinion on this topic?


Alain


From gabriel.scherer@gmail.com  Thu Apr  4 15:44:33 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0F56B3C087
 for <wg-camlp4@lists.ocaml.org>; Thu,  4 Apr 2013 15:44:33 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.6 from SpamAssassin-3.3.2-1462718 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.47 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f47.google.com ([209.85.214.47]:56158)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UNlWd-0004O6-rd (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 04 Apr 2013 15:52:28 +0100
Received: by mail-bk0-f47.google.com with SMTP id ik5so1539232bkc.6
 for <wg-camlp4@lists.ocaml.org>; Thu, 04 Apr 2013 07:52:27 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:sender:in-reply-to:references:from:date
 :x-google-sender-auth:message-id:subject:to:cc:content-type;
 bh=JI+vtYM3M8HWsjINMl0Ml6bvNMiXP4dRWBk1kLH4Y/A=;
 b=w6km917zDqJFuC9eYDqxMsV/tryrouOAsDzARf+VSdiBNP2ZtjVSC4MFAQrUud5ffW
 s0bNLOLR1oZ9pZZnpWYJJx1dTkB0dO0zZLsSgbjamaBSNDaFG9puSL3JJGzB2O+X+24H
 8c+dkwSbg7Y59m2U3JLyEgpzMIY/VcxpiMNz5vzdXE4ZL0ai1+LqOrPKaZqFs0Awqi2n
 CSpG3m7LUyRzqd2UKw+BizpGWc7Anyaqi/RbcdUZ955qFeLLr+DUveH95ZlG0uufyko2
 w5x4gIOpUYH50YbFLzUpeS730WEb8aWICuMTneEWxJktUnUkfdHZ/PZu0x5T4+8Ly3fL
 C5CQ==
X-Received: by 10.204.188.81 with SMTP id cz17mr4611546bkb.91.1365087147075;
 Thu, 04 Apr 2013 07:52:27 -0700 (PDT)
MIME-Version: 1.0
Sender: gabriel.scherer@gmail.com
Received: by 10.205.83.144 with HTTP; Thu, 4 Apr 2013 07:51:45 -0700 (PDT)
In-Reply-To: <515D78ED.2040705@lexifi.com>
References: <515D78ED.2040705@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@inria.fr>
Date: Thu, 4 Apr 2013 16:51:45 +0200
X-Google-Sender-Auth: vErckS0vsuKbOzRJscYPZ-jJfjk
Message-ID: <CAPFanBGw5y-r5aL6xVEcUJR6UxmS-=8JEOGAVNpY9eXGrGGyEA@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] About 'a loc in the Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 04 Apr 2013 14:44:33 -0000

I think the bin-annot code is recent enough (sic) to be changed
without worries as long as you maintain the feature set.
I would suspect the addition of 'a loc were directed by the needs of
existing tools making use of identifier information (.annot and
ctags/browserish prototypes), with the understanding to add more later
if needed.

Adding locations to the missing places, and removing them where
they're redundant seems the right thing to do, and we'd better do it
sooner than later.

(How good is your coverage of the existing codebase, in the
distribution, that depends on the parsetree and typedtree structure?
There is Camlp4 of course, and in this case I think you could easily
make it compatible to your changes. I am a bit more worried about the
not-clearly-defined stuff that was added with bin-annot, (printing
typedtree and stuff), some of which in tools/, some in other places,
that I'm not sure are all exercised or even compiled by the usual
"make world.opt" drill.)

On Thu, Apr 4, 2013 at 2:58 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> Dear all (caml-devel + wg-camlp4),
>
> I'd like to discuss the use of the 'a loc type (string loc and
> Longident.loc) in the definition of the Parsetree.  I think this type was
> introduced as part of the "binannot" project, in order to keep more location
> information in the Typedtree, to be used by external tools reading .cmt
> files.
>
> First, some "unlocated" identifiers remain in the Parsetree
> (cf Ptyp_var, Ptyp_alias, Ptyp_poly, Pfield, Pexp_send, Pexp_newtype,
> Pctf_val, Pctf_virt, Pctf_meth, Pcf_inher).  I assume this is simply an
> oversight. Or is there any deeper reason for keeping locations for some
> identifiers but not all of them?
>
> Second, some locations are redundant for constructions whose syntax is just
> the identifier (Ppat_var, Pexp_ident, Pmty_ident, Pmod_ident).  The same
> location is store in the 'a loc record and in pexp_loc/ppat_loc/etc field.
> I guess that the rationale is that some imaginary alternative concrete
> syntax for the language would use a different representation for those
> constructions.  Another argument is uniformity of representation.  But those
> redundant location introduce some overhead when building and deconstructing
> very common fragments of Parsetrees. For building fragments, this can be
> largely accommodated by the use of constructor functions, but for pattern
> matching on AST, there is no such easy solution.  One could consider getting
> rid of those redundant "'a loc" wrappers.  Any opinion on this topic?
>
>
> Alain
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From wojciech.meyer@gmail.com  Thu Apr  4 16:52:04 2013
Return-Path: <wojciech.meyer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E791D3C087
 for <wg-camlp4@lists.ocaml.org>; Thu,  4 Apr 2013 16:52:04 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1463883 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.172 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (wojciech.meyer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f172.google.com ([209.85.212.172]:52499)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UNmZy-0007ms-Yo (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <wojciech.meyer@gmail.com>); Thu, 04 Apr 2013 17:00:00 +0100
Received: by mail-wi0-f172.google.com with SMTP id hr17so4861243wib.17
 for <wg-camlp4@lists.ocaml.org>; Thu, 04 Apr 2013 08:59:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:from:to:cc:subject:references:date:in-reply-to
 :message-id:user-agent:mime-version:content-type;
 bh=wNCt6GRDzQeGqQImYXJ3wWaFpOHHZqfkuyAxfPYJwmI=;
 b=k8mPWJzyjJ4LIsmlI4JSZBBCVRYnHG4dSIJdjV82vR5m8BQQzrUCEPD2KHsyLdfM2P
 OE86RXD0oUgNyIc1+Mdxq7KsW7dNC1grCNYdJ8oLyHEYMu7mjoXASTc+F+MSGsdbg2EE
 se6SFtYPtCbvcG3n5QF8h0TFvkCxpkquuezEdEvKP1Uhd39Jb5CpYiBFCFtftV4U5cOS
 pO7uAJaT9sChYsiSRew0wgZKpuTOKRTUSoMf24AzfvxfkjJgUU1IVirRcIrsVvz0QUZC
 zCl2Iv1bPPFJcmYAH6BpUGM7htEbpYe1jfkKm7rhj1skRfv4XbZZ0DJfmdsLp7MXmclg
 q+Ig==
X-Received: by 10.180.39.207 with SMTP id r15mr8428378wik.16.1365091198239;
 Thu, 04 Apr 2013 08:59:58 -0700 (PDT)
Received: from spec-desktop.danmey.org
 (cpc2-cmbg12-0-0-cust796.5-4.cable.virginmedia.com. [86.9.203.29])
 by mx.google.com with ESMTPS id bq19sm17010631wib.7.2013.04.04.08.59.56
 (version=TLSv1.1 cipher=RC4-SHA bits=128/128);
 Thu, 04 Apr 2013 08:59:56 -0700 (PDT)
From: Wojciech Meyer <wojciech.meyer@gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <515C5E17.6050409@lexifi.com> <515C5FE5.6050304@frisch.fr>
 <515C63F7.4020602@lexifi.com>
Date: Thu, 04 Apr 2013 16:59:58 +0100
In-Reply-To: <515C63F7.4020602@lexifi.com> (Alain Frisch's message of "Wed, 03
 Apr 2013 19:16:39 +0200")
Message-ID: <wfbo9u477l.fsf@gmail.com>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/24.2 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Extension developers: we need you!
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 04 Apr 2013 15:52:05 -0000

Hi Alain,

I did consider already early testing of your branch, and even write some
code to try it. Currently out of power to do this, because loads of work
at the moment. I can however uncover what can be done with the
extension_points. So the idea wast to write FFI bindings generator using
the attributes to generate needed meta information for this
purpose. Because everybody knows, that generating FFI is possible in
most cases, and most likely you will look at architecture of Haskell's
"greencard" tool [1], you will find you really want to annotate the
ml/mli files, and generate both implementation files and C files from
it. This is nice trade of versus ocaml-idl, that have a separate DSL
(and btw, we should really use this tool when it's possible and I do
consider reusing some of the code out there). This reduces burden of
implementing all this boilerplate, but I'm not convinced yet if that
will work in all the cases that should be considered. (the interesting
one are for instance closures callable from C and exceptions).

[1] http://www.haskell.org/nhc98/greencard.html

Alain Frisch <alain.frisch@lexifi.com> writes:

> Now is a good time to start collecting more concrete feedback from
> extension developers on the current proposal (ppx +
> extension_points). Are there people on this list interested in porting
> their existing extensions (or other tools which can benefit from
> attributes)?   This will be greatly helpful if the current design can
> be validated by real extension developers.  Porting real extensions
> will also help to isolate a good set of "convenience" functions to
> build or deconstruct AST fragments in a light way.
>
> (Disclaimer: there will still be some more cleanups to the Parsetree
> definition and helper modules (Ast_mapper, Ast_helper), so the code
> written now will need to be adjusted for the final version, but I
> expect those changes to be quite easy.)
>
>
> -- Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

--
Wojciech Meyer
http://danmey.org

From alain.frisch@lexifi.com  Thu Apr  4 19:27:01 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8AF963C087
 for <wg-camlp4@lists.ocaml.org>; Thu,  4 Apr 2013 19:27:01 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1463883 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.3 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp3-g21.free.fr ([212.27.42.3]:44117)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UNozw-00068v-SF (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 04 Apr 2013 19:34:57 +0100
Received: from [192.168.0.11] (unknown [78.192.0.38])
 by smtp3-g21.free.fr (Postfix) with ESMTP id 209BCA62EF;
 Thu,  4 Apr 2013 20:34:51 +0200 (CEST)
Message-ID: <515DC7CE.9070407@lexifi.com>
Date: Thu, 04 Apr 2013 20:34:54 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130307 Thunderbird/17.0.4
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@inria.fr>
References: <515D78ED.2040705@lexifi.com>
 <CAPFanBGw5y-r5aL6xVEcUJR6UxmS-=8JEOGAVNpY9eXGrGGyEA@mail.gmail.com>
In-Reply-To: <CAPFanBGw5y-r5aL6xVEcUJR6UxmS-=8JEOGAVNpY9eXGrGGyEA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] About 'a loc in the Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 04 Apr 2013 18:27:01 -0000

On 4/4/2013 4:51 PM, Gabriel Scherer wrote:
> (How good is your coverage of the existing codebase, in the
> distribution, that depends on the parsetree and typedtree structure?
> There is Camlp4 of course, and in this case I think you could easily
> make it compatible to your changes.

"make world opt opt.opt" is ok. It means in particular that Camlp4 has 
been minimally adapted to target the revised Parsetree only; it hasn't 
been extended to support new syntactic features in its parser and own 
representation of the OCaml AST.  As I mentioned in my email to 
wg-camlp4 (not caml-devel), any help in updating Camlp4 will be much 
appreciated, and I think it's better to work on this quite soon in order 
to evaluate possible migration plans and inter-operation between camlp4 
and ppx + extension_points.  For instance, if Jane Street starts porting 
some of their extensions to ppx in order to experiment with 
extension_points and provide feedback, they will need camlp4 to support 
attributes/extensions to be able to apply those ppx filters to their 
real code base, which also depends on other camlp4 extensions.

Ocamldoc compiles but I haven't tried it.  Maybe it works fine, maybe it 
needs to be adapted to report in a clean way new features. Also even 
without big refactoring plans, it would probably be easy to have it 
support attributes in addition to the current syntax for comments (thus 
making it possible for -ppx rewriters to generate documentations snippet).

> I am a bit more worried about the
> not-clearly-defined stuff that was added with bin-annot, (printing
> typedtree and stuff), some of which in tools/, some in other places,
> that I'm not sure are all exercised or even compiled by the usual
> "make world.opt" drill.)

pprintast (the pretty-printer of the Parsetree in "source syntax") 
compiles but fails on or does not print properly new constructions.

I'm not aware of other new fancy stuff depending on the Parsetree.


Alain

From alain.frisch@lexifi.com  Tue Apr  9 15:31:26 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 56A823C059
 for <wg-camlp4@lists.ocaml.org>; Tue,  9 Apr 2013 15:31:26 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1463883 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:59604
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UPZhx-0006SI-rT (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 09 Apr 2013 15:39:38 +0100
Received: from [192.168.1.109] ([92.151.37.47]) by mwinf5d38 with ME
 id Mqfc1l00R1120CC03qfcAi; Tue, 09 Apr 2013 16:39:37 +0200
Message-ID: <5164282C.5010507@lexifi.com>
Date: Tue, 09 Apr 2013 16:39:40 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>, 
 Caml-Devel <caml-devel@yquem.inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] About Ptyp_poly nodes in the Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 09 Apr 2013 14:31:26 -0000

Dear all,

I'd like to get your opinion about the representation of "polymorphic 
types" (Ptyp_poly) nodes in the Parsetree.  Such nodes can only appear 
on specific places (currently as record field type or method type), but 
this invariant is not enforced by the Parsetree definition, thus making 
it possible for AST rewriters breaking it (problem I).  Currently, the 
type-checker would accept such ill-formed types (and probably complain 
later with weird error messages).  Dually, where the type-checker 
supports a Ptyp_poly node, the Parsetree has to be such a node, even if 
the list of quantified variable is empty.  This is enforced by 
parser.mly, but again, AST rewriters can break this invariant (problem II).

Problem II is probably the most serious one in practice, since it forces 
authors of ppx rewriters to insert explicitly Ptyp_poly nodes where needed.

In this commit:

http://caml.inria.fr/cgi-bin/viewvc.cgi?view=revision&sortby=date&revision=13491

I've addressed problem II by pushing to the type-checker the 
responsibility to add "empty" Ptyp_poly quantification wherever needed 
(if the Parsetree is not already a Ptyp_poly node).


Do you think this is enough, or should we do something about problem I 
as well?

A simple option would be to add runtime checks, i.e. ensure that the 
type-checker fails with a proper error message is a Ptyp_poly node is 
found in a context where it is not supported.  This would probably allow 
authors of ppx rewriters to identify problems quickly.  A stricter 
approach would be to encode in the Parsetree definition itself the 
invariant about where Ptyp_poly node can appear.  Concretely, one could 
simply define a type:

  poly_type = string list * core_type

remove the Ptyp_poly constructor, and use poly_type instead of core_type 
where applicable.

This approach is more robust, of course, but also less flexible: tools 
which manipulate Parsetree need to explicitly wrap core_types into 
poly_types where applicable.  And if OCaml ever supports poly types in 
more contexts (e.g. as sum type constructor arguments, which should not 
pose any theoretical problem), the code of the tools will need to be 
changed accordingly.

A variant would be to "inline" the "string list" in the surrounding 
structure (e.g. as an extra field in label_declaration), and use an 
optional argument in Ast_helper to facilitate the creation of those 
structures for the case where the list is empty.

What's your opinion?


Alain

From alain.frisch@lexifi.com  Wed Apr 10 13:43:37 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 12DE73C568
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 13:43:37 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1463883 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:54324
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UPuVC-0004Yd-R8 (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 10 Apr 2013 13:51:51 +0100
Received: from [192.168.1.109] ([86.195.22.55]) by mwinf5d20 with ME
 id NCrp1l0081BJsxy03CrpHr; Wed, 10 Apr 2013 14:51:50 +0200
Message-ID: <51656068.9060908@lexifi.com>
Date: Wed, 10 Apr 2013 14:51:52 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <87620e6ike.fsf@study.localdomain>
In-Reply-To: <87620e6ike.fsf@study.localdomain>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 10 Apr 2013 12:43:37 -0000

On 03/26/2013 08:56 PM, Leo White wrote:
>> On 03/25/2013 03:05 PM, Leo White wrote:
>>> Another small clean-up I'd like would be to change "ptype_params" from
>>> "string loc option list" to "core_type list" and the first part of
>>> "pci_params" from "string loc list" to "core_type list".
>>
>> Would you change the parser to accept arbitrary types (instead of _ and type variables), and enforce the previous
>> constraint in the type-checker?
>
> It might be better to get a syntax error there as it's probably
> a common beginner mistake. On the other hand, if the error from the type
> checker is nice and clear then it shouldn't be a problem. Either way, we
> might as well support extensions and attributes there.

I think we should keep the Parsetree type as close as possible (at 
reasonable costs) to the set of ASTs that can be produced by the parser. 
  This will reduce the risk of generating Parsetree fragments which 
cannot be pretty-printed (as source code) faithfully.

So, if we want to move from "string loc list" to "core_type list" (which 
will give attributes for free on parameters), we should accept arbitrary 
types in the parser and fail in the type-checker.  (There is no real 
drawback for the end-user.)  The problem is that this  introduces 
conflicts in the grammar.  The simpler way I've found to address them 
without changing the parser too much is to add the variance prefixes (+ 
and -) as new constructors in core_type (with corresponding grammar 
rules), but this is not very nice.

Leo: do you have an opinion on what to do?

-- Alain

From gabriel.scherer@gmail.com  Wed Apr 10 14:26:36 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A33C53C568
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 14:26:36 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1463883 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.44 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f44.google.com ([209.85.214.44]:62573)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UPvAo-0001cA-ZT (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Wed, 10 Apr 2013 14:34:51 +0100
Received: by mail-bk0-f44.google.com with SMTP id jk13so236365bkc.3
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 06:34:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=Tiwy48499a2QuRbWZwSAh4+Lmzugr9XmuZH75h1Xg9c=;
 b=b0yBqeIJ2UH2SPBYK0NVZZDa+5VtOXfRD9BxxM/hNG3MeHbrZysCZsAzUwGVeNpQ6l
 pgEW/jlmS64UFj8Y2DDBpsHe97UOEOOkXA32iYGNoxm1qXYNoig/9f98h22kNZaQ2I8o
 TM/LFmYcYzZnrepcPb7t2rjbBgXcJbIbwLiJh+BOOtkVkYhyjcbRgaQemaqxUnELPUYV
 xI0uJjtZ03l8JLdC5++md46bwJnEYyqD++BNIjO4tgXyx7AVxYTmoebulU8SbWmmHoFw
 JNiTD14rqNAsziQQzyphgZPWqRbdS1nrEG73vw9BjQY8k70hQeBriZuDdMb/9Oi24L6q
 ryJA==
X-Received: by 10.204.188.81 with SMTP id cz17mr764203bkb.91.1365600890626;
 Wed, 10 Apr 2013 06:34:50 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Wed, 10 Apr 2013 06:34:10 -0700 (PDT)
In-Reply-To: <51656068.9060908@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <87620e6ike.fsf@study.localdomain> <51656068.9060908@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Wed, 10 Apr 2013 15:34:10 +0200
Message-ID: <CAPFanBFH5KH+k1+ovSk6xO3UrnaT4t0+j=mZJkosVrzL_K4S5g@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 10 Apr 2013 13:26:36 -0000

I think that having additional constructors in core_type that are
semantically meaningless (the variance annotations) will not help
third-party extension writers either. What are the reasons for having
the whole core_type in place where type variables are expected?

On Wed, Apr 10, 2013 at 2:51 PM, Alain Frisch <alain.frisch@lexifi.com> wrote:
> On 03/26/2013 08:56 PM, Leo White wrote:
>>>
>>> On 03/25/2013 03:05 PM, Leo White wrote:
>>>>
>>>> Another small clean-up I'd like would be to change "ptype_params" from
>>>> "string loc option list" to "core_type list" and the first part of
>>>> "pci_params" from "string loc list" to "core_type list".
>>>
>>>
>>> Would you change the parser to accept arbitrary types (instead of _ and
>>> type variables), and enforce the previous
>>> constraint in the type-checker?
>>
>>
>> It might be better to get a syntax error there as it's probably
>> a common beginner mistake. On the other hand, if the error from the type
>> checker is nice and clear then it shouldn't be a problem. Either way, we
>> might as well support extensions and attributes there.
>
>
> I think we should keep the Parsetree type as close as possible (at
> reasonable costs) to the set of ASTs that can be produced by the parser.
> This will reduce the risk of generating Parsetree fragments which cannot be
> pretty-printed (as source code) faithfully.
>
> So, if we want to move from "string loc list" to "core_type list" (which
> will give attributes for free on parameters), we should accept arbitrary
> types in the parser and fail in the type-checker.  (There is no real
> drawback for the end-user.)  The problem is that this  introduces conflicts
> in the grammar.  The simpler way I've found to address them without changing
> the parser too much is to add the variance prefixes (+ and -) as new
> constructors in core_type (with corresponding grammar rules), but this is
> not very nice.
>
> Leo: do you have an opinion on what to do?
>
> -- Alain
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From alain.frisch@lexifi.com  Wed Apr 10 15:16:54 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4F5A83C568
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 15:16:54 +0100 (BST)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1463883 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:17735
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UPvxV-0005oJ-6d (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 10 Apr 2013 15:25:09 +0100
Received: from [192.168.1.109] ([86.195.22.55]) by mwinf5d20 with ME
 id NER81l00F1BJsxy03ER8V5; Wed, 10 Apr 2013 16:25:08 +0200
Message-ID: <51657648.2050509@lexifi.com>
Date: Wed, 10 Apr 2013 16:25:12 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <87620e6ike.fsf@study.localdomain> <51656068.9060908@lexifi.com>
 <CAPFanBFH5KH+k1+ovSk6xO3UrnaT4t0+j=mZJkosVrzL_K4S5g@mail.gmail.com>
In-Reply-To: <CAPFanBFH5KH+k1+ovSk6xO3UrnaT4t0+j=mZJkosVrzL_K4S5g@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 10 Apr 2013 14:16:54 -0000

On 04/10/2013 03:34 PM, Gabriel Scherer wrote:
> I think that having additional constructors in core_type that are
> semantically meaningless (the variance annotations) will not help
> third-party extension writers either. What are the reasons for having
> the whole core_type in place where type variables are expected?

I can see the following reasons:

  - It's actually not only type variables.  Since the introduction of 
GADT, you can also use "_" as a type parameter (only for type 
declarations, not classes).  This is currently encoded as a "string loc 
option", which is not very self-describing.

  - Using core_type gives attributes for free. Otherwise, we need to 
complexify to Parsetree definition and the parser to allow attributes 
explicitly.

  - If we represent variance information +/- as constructors of 
core_type, it further simplifies the definition in the Parsetree (from 
"(variance * string loc option) list" to "core_type list"), thus making 
it sometimes simpler to match or create fragments of ASTs.

  - I see it generally as a good thing that fragments with identical 
syntax are represented in the same way in the Parsetree.  Of course, 
this is far from being the case because there are lots of duplication 
between the various syntactic categories, but since a "'a" as a type 
parameter will also be used with the same syntax "'a" as a type 
expression close to it (in the same type declaration), one could argue 
that they should be of the same "kind".

But I'm not pushing too much in this direction.  Leo made the request, 
so I'd let him comment!

Alain

From lpw25@cam.ac.uk  Wed Apr 10 20:12:22 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 178453C40C
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 20:12:22 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from cpc2-cmbg14-2-0-cust33.5-4.cable.virginmedia.com
 ([86.26.0.34]:34344 helo=netbook)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UQ0ZR-0006Fi-YW (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Wed, 10 Apr 2013 20:20:37 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <87620e6ike.fsf@study.localdomain> <51656068.9060908@lexifi.com>
Date: Wed, 10 Apr 2013 20:21:31 +0100
In-Reply-To: <51656068.9060908@lexifi.com> (Alain Frisch's message of "Wed, 10
 Apr 2013 14:51:52 +0200")
Message-ID: <86fvyytcn8.fsf@cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 10 Apr 2013 19:12:22 -0000

> I think we should keep the Parsetree type as close as possible (at reasonable costs) to the set of ASTs that can be
> produced by the parser. This will reduce the risk of generating Parsetree fragments which cannot be pretty-printed (as
> source code) faithfully.

In general I agree with this, however there are always going to be
places where the Parsetree accepts more values than the parser. 

> So, if we want to move from "string loc list" to "core_type list" (which will give attributes for free on parameters),
> we should accept arbitrary types in the parser and fail in the type-checker.  (There is no real drawback for the
> end-user.)  The problem is that this  introduces conflicts in the grammar.  The simpler way I've found to address them
> without changing the parser too much is to add the variance prefixes (+ and -) as new constructors in core_type (with
> corresponding grammar rules), but this is not very nice.

Adding variance constructors to core_type seems like it will create more
problems than it solves.  I think it would be simpler to have type
parameters only accept Ptyp_any, Ptyp_var and Ptyp_extension.

From bobzhang1988@gmail.com  Wed Apr 10 20:24:22 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 175B33C40C
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 20:24:22 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -0.3 from SpamAssassin-3.3.2-1463883 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.53 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f53.google.com ([209.85.212.53]:64343)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UQ0l3-00083W-pj (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Wed, 10 Apr 2013 20:32:37 +0100
Received: by mail-vb0-f53.google.com with SMTP id i3so663979vbh.26
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 12:32:36 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=FLoXnhGqljgG4iD8MJQ5sJa1WKoLaf+TewKi+3KOfpA=;
 b=xrl9hTHCeOLr40g9BLt+PMBweZil6K0ZPSa6rWNCAK4wsZDTGkcGAEUCdIMGJB0UOo
 mJgUnqJbTu9cu0Ft8pcLiycVrrkarD5/elh53GqNoUMo5nWAINl/TCnln8VUUA/wj3v7
 SAl/POslPLTdovLC5ru1Oxc9tzZKXc/MOz3rvC31yrNPYg+I0ycKpwyeT8K4yCPc1oVD
 r2KevPORhFVvVW6wfNpx50ZBSRthA7gUuTEPRfA9t/EypYysVcy95mOpLr9yb7Y4TQZQ
 GAwuwpZAt8IU/dPdlSGHw3mQoWg38im2bQYCBn+fedxIXKjjDKduzKg89BvXPpbO+KVf
 pLwQ==
MIME-Version: 1.0
X-Received: by 10.52.21.175 with SMTP id w15mr2243707vde.100.1365622356277;
 Wed, 10 Apr 2013 12:32:36 -0700 (PDT)
Sender: bobzhang1988@gmail.com
Received: by 10.220.151.147 with HTTP; Wed, 10 Apr 2013 12:32:36 -0700 (PDT)
In-Reply-To: <86fvyytcn8.fsf@cam.ac.uk>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com>
 <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk>
 <515187C8.2030109@lexifi.com> <87620e6ike.fsf@study.localdomain>
 <51656068.9060908@lexifi.com> <86fvyytcn8.fsf@cam.ac.uk>
Date: Wed, 10 Apr 2013 15:32:36 -0400
X-Google-Sender-Auth: zCRvaevlQ5ui_xDz1iBjNqoSIok
Message-ID: <CANcqPu7=KzXA+mJqixeGGj66TS6_bznvjtwWORJeZb=cJo56JA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=20cf307c9bba71b52c04da06bb9d
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 10 Apr 2013 19:24:22 -0000

--20cf307c9bba71b52c04da06bb9d
Content-Type: text/plain; charset=ISO-8859-1

On Wed, Apr 10, 2013 at 3:21 PM, Leo White <lpw25@cam.ac.uk> wrote:

> > I think we should keep the Parsetree type as close as possible (at
> reasonable costs) to the set of ASTs that can be
> > produced by the parser. This will reduce the risk of generating
> Parsetree fragments which cannot be pretty-printed (as
> > source code) faithfully.
>
> In general I agree with this, however there are always going to be
> places where the Parsetree accepts more values than the parser.
>
Actually, that's the value of polymorphic variants,  you can make the type
definitions
as precise as the parser while not complicate the type definitions too much

>
> > So, if we want to move from "string loc list" to "core_type list" (which
> will give attributes for free on parameters),
> > we should accept arbitrary types in the parser and fail in the
> type-checker.  (There is no real drawback for the
> > end-user.)  The problem is that this  introduces conflicts in the
> grammar.  The simpler way I've found to address them
> > without changing the parser too much is to add the variance prefixes (+
> and -) as new constructors in core_type (with
> > corresponding grammar rules), but this is not very nice.
>
> Adding variance constructors to core_type seems like it will create more
> problems than it solves.  I think it would be simpler to have type
> parameters only accept Ptyp_any, Ptyp_var and Ptyp_extension.
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>



-- 
-- Regards, Hongbo

--20cf307c9bba71b52c04da06bb9d
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><br><div class=3D"gmail_extra"><br><br><div class=3D"gmail=
_quote">On Wed, Apr 10, 2013 at 3:21 PM, Leo White <span dir=3D"ltr">&lt;<a=
 href=3D"mailto:lpw25@cam.ac.uk" target=3D"_blank">lpw25@cam.ac.uk</a>&gt;<=
/span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">&gt; I think we should kee=
p the Parsetree type as close as possible (at reasonable costs) to the set =
of ASTs that can be<br>

&gt; produced by the parser. This will reduce the risk of generating Parset=
ree fragments which cannot be pretty-printed (as<br>
&gt; source code) faithfully.<br>
<br>
</div>In general I agree with this, however there are always going to be<br=
>
places where the Parsetree accepts more values than the parser.<br></blockq=
uote><div>Actually, that&#39;s the value of polymorphic variants,=A0 you ca=
n make the type definitions <br></div><div>as precise as the parser while n=
ot complicate the type definitions too much<br>
</div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-l=
eft:1px #ccc solid;padding-left:1ex">
<div class=3D"im"><br>
&gt; So, if we want to move from &quot;string loc list&quot; to &quot;core_=
type list&quot; (which will give attributes for free on parameters),<br>
&gt; we should accept arbitrary types in the parser and fail in the type-ch=
ecker. =A0(There is no real drawback for the<br>
&gt; end-user.) =A0The problem is that this =A0introduces conflicts in the =
grammar. =A0The simpler way I&#39;ve found to address them<br>
&gt; without changing the parser too much is to add the variance prefixes (=
+ and -) as new constructors in core_type (with<br>
&gt; corresponding grammar rules), but this is not very nice.<br>
<br>
</div>Adding variance constructors to core_type seems like it will create m=
ore<br>
problems than it solves. =A0I think it would be simpler to have type<br>
parameters only accept Ptyp_any, Ptyp_var and Ptyp_extension.<br>
<div class=3D"HOEnZb"><div class=3D"h5">___________________________________=
____________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><br>-- <br>-- Regards,=
 Hongbo
</div></div>

--20cf307c9bba71b52c04da06bb9d--

From lpw25@cam.ac.uk  Wed Apr 10 20:25:18 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0CD353C40C
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 20:25:18 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from cpc2-cmbg14-2-0-cust33.5-4.cable.virginmedia.com
 ([86.26.0.34]:37050 helo=netbook)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UQ0lx-00006g-s7 (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Wed, 10 Apr 2013 20:33:33 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <87620e6ike.fsf@study.localdomain> <51656068.9060908@lexifi.com>
 <CAPFanBFH5KH+k1+ovSk6xO3UrnaT4t0+j=mZJkosVrzL_K4S5g@mail.gmail.com>
Date: Wed, 10 Apr 2013 20:34:22 +0100
In-Reply-To: <CAPFanBFH5KH+k1+ovSk6xO3UrnaT4t0+j=mZJkosVrzL_K4S5g@mail.gmail.com>
 (Gabriel Scherer's message of "Wed, 10 Apr 2013 15:34:10 +0200")
Message-ID: <86bo9mtc1t.fsf@cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 10 Apr 2013 19:25:18 -0000

> I think that having additional constructors in core_type that are
> semantically meaningless (the variance annotations) will not help
> third-party extension writers either. What are the reasons for having
> the whole core_type in place where type variables are expected?

In addition to the reasons Alain gave, type parameters should be
core_types because, in the Typedtree, they have a corresponding
Types.type_expr. Although they are syntactically always a Ptyp_var or
Ptyp_any, after constraints have been taken into account they represent
a general type expression. 

For example:

  type 'a t constraint 'a = 'b list

is morally equivalent to:

  type 'b list t

By representing type parameters as core_types in the Typedtree they can include a
reference to the corresponding type_expr. For consistency they should be
represented as core_types in the Parsetree as well.


From gabriel.scherer@gmail.com  Wed Apr 10 20:39:59 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 110533C40C
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 20:39:59 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1463883 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.46 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f46.google.com ([209.85.214.46]:49072)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UQ109-00073U-Ru (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Wed, 10 Apr 2013 20:48:14 +0100
Received: by mail-bk0-f46.google.com with SMTP id je9so447655bkc.19
 for <wg-camlp4@lists.ocaml.org>; Wed, 10 Apr 2013 12:48:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=VdM4PMbshY1RTO/Aqqoq5YMrn5e+2xQWv6o9Ljb3Wys=;
 b=JJL3/t/8eaHaCJaQw2T9X+Jwcx+Yq7rfX2tpvJsTteCIuQUvKtF2qqad3nHMzicHLs
 qYySmD8end/K0ojkphKHlEXyZUfRKC61jrbqhvRg5EI7tPLv5MnwSBy7rJ3lAETHrv1O
 iWufwr+gcCi7KloxRKtvWBZ2yxcANmNFHd5weeCX10ponB15v5zDmLYuuocK+bBBUiqQ
 3Ar/2KLlcLtBfpegETrbYuSON1VfEb3rlI76zVF1HBiInAIAZ9rbKDfK31/+60DoKDXs
 81Qrtb9vdJBz+L0Ouk+AOpaFkxgL1o5SmQ1WONpRF9+471eXH1VjVhdZjRQCe2dUT7Mg
 ExxQ==
X-Received: by 10.205.33.81 with SMTP id sn17mr1386874bkb.53.1365623293310;
 Wed, 10 Apr 2013 12:48:13 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Wed, 10 Apr 2013 12:47:33 -0700 (PDT)
In-Reply-To: <86bo9mtc1t.fsf@cam.ac.uk>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <87620e6ike.fsf@study.localdomain> <51656068.9060908@lexifi.com>
 <CAPFanBFH5KH+k1+ovSk6xO3UrnaT4t0+j=mZJkosVrzL_K4S5g@mail.gmail.com>
 <86bo9mtc1t.fsf@cam.ac.uk>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Wed, 10 Apr 2013 21:47:33 +0200
Message-ID: <CAPFanBEZeG17cAwM2CxgTz4=L=3bBVyf1aZSjQqDJ1erSJ_ExA@mail.gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 10 Apr 2013 19:39:59 -0000

> By representing type parameters as core_types in the Typedtree they can include a
> reference to the corresponding type_expr. For consistency they should be
> represented as core_types in the Parsetree as well.

I certainly miss some information for a better understanding, but I
don't see what the argument is here. The typetree structure is adapted
to type-checking and therefore different from the bare AST structure,
I get that. Why should we change the AST structure to make it more
adapted to type-checking, when precisely we're trying to make more
suitable to purely syntactic manipulations? I'd rather say that the
parsetree should be suited to syntactic representation, and the
typetree to representation of type information.

(I see an argument for keeping the type-checker as simple as possible,
begin a critical and more fragile part of the compiler, and if that
was necessary decide to make the parsetree a bit more complex for this
reason. In that case, however, it doesn't look like using core_type in
the parsetree would make the type-checker much more readable or
robust.)

Hongbo: I am personally wary of use of polymorphic variants for large
ASTs as they tend to result in error messages and inference behavior
that are hard to understand, and require a fair amount of type
annotations to be tamed. I've done designs with and without
polymorphic variant, and my experience has been that keeping simple
algebraic datatypes is often a better choice on the long run (it's a
compromise between safety and simplicity). I'm curious about how your
own experiment with polymorphic variants in Fan has been going on, but
maybe it's not reasonable for the core parsetree representation.

On Wed, Apr 10, 2013 at 9:34 PM, Leo White <lpw25@cam.ac.uk> wrote:
>> I think that having additional constructors in core_type that are
>> semantically meaningless (the variance annotations) will not help
>> third-party extension writers either. What are the reasons for having
>> the whole core_type in place where type variables are expected?
>
> In addition to the reasons Alain gave, type parameters should be
> core_types because, in the Typedtree, they have a corresponding
> Types.type_expr. Although they are syntactically always a Ptyp_var or
> Ptyp_any, after constraints have been taken into account they represent
> a general type expression.
>
> For example:
>
>   type 'a t constraint 'a = 'b list
>
> is morally equivalent to:
>
>   type 'b list t
>
> By representing type parameters as core_types in the Typedtree they can include a
> reference to the corresponding type_expr. For consistency they should be
> represented as core_types in the Parsetree as well.
>

From alain.frisch@lexifi.com  Thu Apr 11 08:19:25 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6A0423C568
 for <wg-camlp4@lists.ocaml.org>; Thu, 11 Apr 2013 08:19:25 +0100 (BST)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1463883 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:30965
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UQBv4-00010F-80 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 11 Apr 2013 08:27:42 +0100
Received: from [192.168.1.109] ([86.195.22.55]) by mwinf5d45 with ME
 id NXTh1l00V1BJsxy03XThnP; Thu, 11 Apr 2013 09:27:42 +0200
Message-ID: <516665ED.5090007@lexifi.com>
Date: Thu, 11 Apr 2013 09:27:41 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>, Gabriel Scherer <gabriel.scherer@gmail.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <87620e6ike.fsf@study.localdomain> <51656068.9060908@lexifi.com>
 <CAPFanBFH5KH+k1+ovSk6xO3UrnaT4t0+j=mZJkosVrzL_K4S5g@mail.gmail.com>
 <86bo9mtc1t.fsf@cam.ac.uk>
In-Reply-To: <86bo9mtc1t.fsf@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 11 Apr 2013 07:19:25 -0000

On 04/10/2013 09:34 PM, Leo White wrote:
> For example:
>
>    type 'a t constraint 'a = 'b list
>
> is morally equivalent to:
>
>    type 'b list t

We use sometimes the following pattern:

class virtual ['a] foo = object
   constraint 'a = #bar
   method private virtual bar: 'a
   ...
end

and indeed, it could make sense to allow writing this directly as:

class virtual [#bar as 'a] foo = object
   method private virtual bar: 'a
end

Do you know if it would be difficult to adapt the type-checker to 
support arbitrary types in place of parameters (with the same semantics 
as constraints, I guess)?  If this fits nicely in the current 
type-checker, it would be a good argument to support arbitrary types in 
the Parsetree and the concrete syntax.


Alain

From lpw25@cam.ac.uk  Thu Apr 11 11:19:09 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1385D3C57F
 for <wg-camlp4@lists.ocaml.org>; Thu, 11 Apr 2013 11:19:09 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:58452)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UQEj0-0000AU-s6 (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Thu, 11 Apr 2013 11:27:26 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <87620e6ike.fsf@study.localdomain> <51656068.9060908@lexifi.com>
 <CAPFanBFH5KH+k1+ovSk6xO3UrnaT4t0+j=mZJkosVrzL_K4S5g@mail.gmail.com>
 <86bo9mtc1t.fsf@cam.ac.uk>
 <CAPFanBEZeG17cAwM2CxgTz4=L=3bBVyf1aZSjQqDJ1erSJ_ExA@mail.gmail.com>
Date: Thu, 11 Apr 2013 11:27:26 +0100
In-Reply-To: <CAPFanBEZeG17cAwM2CxgTz4=L=3bBVyf1aZSjQqDJ1erSJ_ExA@mail.gmail.com>
 (Gabriel Scherer's message of "Wed, 10 Apr 2013 21:47:33 +0200")
Message-ID: <87wqs9pdkh.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 11 Apr 2013 10:19:09 -0000

> I certainly miss some information for a better understanding, but I
> don't see what the argument is here. The typetree structure is adapted
> to type-checking and therefore different from the bare AST structure,
> I get that. Why should we change the AST structure to make it more
> adapted to type-checking, when precisely we're trying to make more
> suitable to purely syntactic manipulations? I'd rather say that the
> parsetree should be suited to syntactic representation, and the
> typetree to representation of type information.
>

I think that my point is that the type parameters are semantically
core_types (as evidenced by having a corresponding
Types.type_expr). They are also, as Alain has pointed out, syntactically
core_types (albeit a restricted class of core_types). To me this
indicates that they should be represented as a core_type in the Parsetree.

In practical terms, it is only a small change to use Ptyp_var/Ptyp_any
instead of Some/None. It also makes it easy to access the corresponding
Types.type_expr from the Typedtree. Alain's other points about it
being more self-documenting etc. are also good reasons to change it.

From lpw25@cam.ac.uk  Thu Apr 11 11:25:25 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 347163C57F
 for <wg-camlp4@lists.ocaml.org>; Thu, 11 Apr 2013 11:25:25 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: not scanned
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:58453)
 by ppsw-50.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1:DHE-RSA-AES128-SHA:128)
 id 1UQEp4-0002wF-sb (Exim 4.72)
 (return-path <lpw25@cam.ac.uk>); Thu, 11 Apr 2013 11:33:42 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <87r4jh3nnj.fsf@kingston.cl.cam.ac.uk>
 <1625554563.3446096.1363346665809.JavaMail.root@lexifi.com>
 <CAPFanBG+2necpa3XvjQLhLiYM0rc1m9tpj=6yJ60i2GDaS3h-g@mail.gmail.com>
 <87sj3wojlp.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBFgNn1knLyafsAh6bxy5V_O--cyuvfUJ-ba-MBRfrKLmg@mail.gmail.com>
 <514ACFC1.5090705@lexifi.com> <87ppytm53s.fsf@kingston.cl.cam.ac.uk>
 <CAPFanBHi473eqdtW8hpoH1xk+buMjiRQ_xLgH3SiJOE1gu67ag@mail.gmail.com>
 <514C424A.6070905@lexifi.com> <51503841.7040708@lexifi.com>
 <87mwtrh8w9.fsf@kingston.cl.cam.ac.uk> <515187C8.2030109@lexifi.com>
 <87620e6ike.fsf@study.localdomain> <51656068.9060908@lexifi.com>
 <CAPFanBFH5KH+k1+ovSk6xO3UrnaT4t0+j=mZJkosVrzL_K4S5g@mail.gmail.com>
 <86bo9mtc1t.fsf@cam.ac.uk> <516665ED.5090007@lexifi.com>
Date: Thu, 11 Apr 2013 11:33:42 +0100
In-Reply-To: <516665ED.5090007@lexifi.com> (Alain Frisch's message of "Thu, 11
 Apr 2013 09:27:41 +0200")
Message-ID: <87sj2xpda1.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Changes to the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 11 Apr 2013 10:25:25 -0000

> Do you know if it would be difficult to adapt the type-checker to support arbitrary types in place of parameters (with
> the same semantics as constraints, I guess)?  If this fits nicely in the current type-checker, it would be a good
> argument to support arbitrary types in the Parsetree and the concrete syntax.

I don't think that it is difficult for the type-checker to support it,
but it is awkward for the parser. I'm also not sure that it is a
desirable change. I think that

  type 'a t constraint 'a = 'b list

is probably more readable than

  type 'a list t

From alain.frisch@lexifi.com  Thu Apr 11 15:11:00 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C963C3C579
 for <wg-camlp4@lists.ocaml.org>; Thu, 11 Apr 2013 15:11:00 +0100 (BST)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1463883 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.214 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa05.smtpout.orange.fr ([193.252.23.214]:32098
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UQILM-0001Zu-8k (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 11 Apr 2013 15:19:17 +0100
Received: from [192.168.1.109] ([86.195.22.55]) by mwinf5d45 with ME
 id NeKF1l0281BJsxy03eKGTn; Thu, 11 Apr 2013 16:19:16 +0200
Message-ID: <5166C667.3070405@lexifi.com>
Date: Thu, 11 Apr 2013 16:19:19 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:20.0) Gecko/20100101 Thunderbird/20.0
MIME-Version: 1.0
To: Hendrik Tews <tews@os.inf.tu-dresden.de>, wg-camlp4@lists.ocaml.org
References: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
In-Reply-To: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] My no-use of camlp4 syntax extensions for Otags
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 11 Apr 2013 14:11:00 -0000

On 02/22/2013 01:32 PM, Hendrik Tews wrote:
> I would therefore strongly suggest to provide complete
> documentation for the ast that preprocessors must process with
> the _beta_ release of the next version.

Do you have a suggestion for the form such a documentation should take? 
  I can imagine describing how each fragment of concrete syntax is 
represented in the abstract syntax, but this would not be really 
different from paraphrasing the code of the parser.

The new tool "ocamlast" gives you an easy way to see how a piece of 
concrete syntax is represented:

~/ocaml/extension_points $ tools/ocamlast -e "1 + 3"
{pexp_desc =
   Pexp_apply ({pexp_desc = Pexp_ident {txt = Lident "+"}},
    [("", {pexp_desc = Pexp_constant (Const_int 1)});
     ("", {pexp_desc = Pexp_constant (Const_int 3)})])}

~/ocaml/extension_points $ tools/ocamlast -p "'0'..'3'"
{ppat_desc =
   Ppat_or ({ppat_desc = Ppat_constant (Const_char '0')},
    {ppat_desc =
      Ppat_or ({ppat_desc = Ppat_constant (Const_char '1')},
       {ppat_desc =
         Ppat_or ({ppat_desc = Ppat_constant (Const_char '2')},
          {ppat_desc = Ppat_constant (Const_char '3')})})})}

(locations and empty attribute lists are omitted by default)

It seems to me that such a tool is actually a good replacement for an 
explicit documentation of the Parsetree, both for the user and for the 
maintainers.  Do you agree?


-- Alain

From tews@os.inf.tu-dresden.de  Fri Apr 12 10:18:40 2013
Return-Path: <tews@os.inf.tu-dresden.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 60DBD3C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 12 Apr 2013 10:18:40 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -4.7 from SpamAssassin-3.3.2-1463883 
 * -2.4 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -2.3 RCVD_IN_DNSWL_MED RBL: Sender listed at http://www.dnswl.org/,
 *      medium trust
 *      [141.76.48.99 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from os.inf.tu-dresden.de ([141.76.48.99]:35070)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UQaG4-0004cA-Rg (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <tews@os.inf.tu-dresden.de>); Fri, 12 Apr 2013 10:27:01 +0100
Received: from [2002:8d4c:3001:48:222:68ff:fe19:71d]
 (helo=blau.inf.tu-dresden.de)
 by os.inf.tu-dresden.de with esmtpsa (TLSv1:DHE-RSA-AES128-SHA:128) (Exim
 4.80.1) id 1UQaG4-0007JM-2K
 for wg-camlp4@lists.ocaml.org; Fri, 12 Apr 2013 11:27:00 +0200
Received: from tews by blau.inf.tu-dresden.de with local (Exim 4.80)
 (envelope-from <tews@os.inf.tu-dresden.de>) id 1UQaG3-0005Ap-2i
 for wg-camlp4@lists.ocaml.org; Fri, 12 Apr 2013 11:26:59 +0200
From: Hendrik Tews <tews@os.inf.tu-dresden.de>
To: wg-camlp4@lists.ocaml.org
References: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
 <5166C667.3070405@lexifi.com>
Date: Fri, 12 Apr 2013 11:26:58 +0200
In-Reply-To: <5166C667.3070405@lexifi.com> (Alain Frisch's message of "Thu, 11
 Apr 2013 16:19:19 +0200")
Message-ID: <6x4nfchzfh.fsf@blau.inf.tu-dresden.de>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Subject: Re: [wg-camlp4] My no-use of camlp4 syntax extensions for Otags
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 12 Apr 2013 09:18:40 -0000

Hi, 

I have suggestions, but it is a bit lengthy. In short: ocamlast
is great, but I don't believe it will satisfy all documentation
needs. 


Alain Frisch <alain.frisch@lexifi.com> writes:

   On 02/22/2013 01:32 PM, Hendrik Tews wrote:
   > I would therefore strongly suggest to provide complete
   > documentation for the ast that preprocessors must process with
   > the _beta_ release of the next version.

   Do you have a suggestion for the form such a documentation should
   take? I can imagine describing how each fragment of concrete syntax is
   represented in the abstract syntax, but this would not be really
   different from paraphrasing the code of the parser.

You are right, but only from the insider's point of view. You
have to remember that potential preprocessor programmers (like
myself) have never seen the parser before and they don't want to
became an parsing/parser.mly expert before starting. For
instance, when I look at parser.mly, I see

  | pattern BAR pattern
      { mkpat(Ppat_or($1, $3)) }

and nothing is clear. When I look up mkpat, then all I know is
that an or-pattern is not a Ppat_or node, it is some record, for
which I don't even know the type. So I would have to search for
ppat_desc, and select the right one of the 100 matches that grep
reports. Note that I have been lucky here, because mkpat is very
simple and is defined in parser.mly . There are surely more
complicated functions that are elsewhere defined.

>From my point of view the parser is not a documentation.


I believe there are (at least) two documentation needs:

(1) getting the ast tree for some concrete syntax

(2) understanding which concrete syntax a given ast node
    represents


For (1) the ocamlast tool is really great! (I've been using my
own camlp4ast tool quite a lot.) I agree that with ocamlast a
description of how each piece of concrete syntax is represented
is not necessary. 

There might however be cases with the danger of wrong
generalization. What I mean with this is the following: The
ocamlast tool only works on correct OCaml code. I cannot feed
it with "assert _ " in order to get the most general ast
tree for assertions. So instead I have to feed it with, for
instance, "assert true" and get Pexp_assert ... I might now
believe that "assert false" is also represented with Pexp_assert,
which is wrong. 

So, if there are cases, where similar looking concrete syntax is
represented differently, then they should be listed somewhere.


For documentation need (2), ocamlast is not really a help. For
(2) I would suggest to annotate each constructor in parsetree.mli
with the concrete syntax. For instance 

  | Pexp_while of expression * expression
     (** while <expression> do <expression> done *)

This annotation should of course include the types that occur in
the ast but are outside of parsetree.mli, such as Longident.t or
constant. 

There are probably a lot of side conditions. For
instance, "expr_1; expr_2; expr_3" is 
Pexp_sequence(expr_1, Pexp_sequence (expr_2, expr3) and not
Pexp_sequence( Pexp_sequence(expr_1, expr_2), expr3) (or vice
versa). 

Another kind of side condition is that certain nodes do not and
must not occur inside other nodes. For instance, the left
expression in Pexp_sequence is never a Pexp_sequence. (This is
probably wrong, but you get the idea.)

Such side conditions should be described somehow for those who
need to construct ast's and those who need to pattern match on
ast's. 


You could write the documentation for (1) and (2) in comments or
ocamldoc comments in the source files. However, I would prefer
something like a wiki page, where we users can immediately
contribute. I, for instance, used the camlp4 wiki [1] a lot to
remember my own findings at a place where it could benefit
others.

[1] http://brion.inria.fr/gallium/index.php/Abstract_Syntax_Tree


Bye,

Hendrik

From tews@os.inf.tu-dresden.de  Fri Apr 12 10:24:44 2013
Return-Path: <tews@os.inf.tu-dresden.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D03CC3C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 12 Apr 2013 10:24:44 +0100 (BST)
X-Cam-SpamDetails: score -4.8 from SpamAssassin-3.3.2-1463883 
 * -2.3 RCVD_IN_DNSWL_MED RBL: Sender listed at http://www.dnswl.org/,
 *      medium trust
 *      [141.76.48.99 listed in list.dnswl.dnsbl.ja.net]
 * -2.4 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from os.inf.tu-dresden.de ([141.76.48.99]:52489)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UQaLw-0005Ep-9Z (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <tews@os.inf.tu-dresden.de>); Fri, 12 Apr 2013 10:33:05 +0100
Received: from [2002:8d4c:3001:48:222:68ff:fe19:71d]
 (helo=blau.inf.tu-dresden.de)
 by os.inf.tu-dresden.de with esmtpsa (TLSv1:DHE-RSA-AES128-SHA:128) (Exim
 4.80.1) id 1UQaLw-0007Ui-Ii
 for wg-camlp4@lists.ocaml.org; Fri, 12 Apr 2013 11:33:04 +0200
Received: from tews by blau.inf.tu-dresden.de with local (Exim 4.80)
 (envelope-from <tews@os.inf.tu-dresden.de>) id 1UQaLv-0005BG-T0
 for wg-camlp4@lists.ocaml.org; Fri, 12 Apr 2013 11:33:03 +0200
From: Hendrik Tews <tews@os.inf.tu-dresden.de>
To: "wg-camlp4\@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <515C5E17.6050409@lexifi.com> <515C5FE5.6050304@frisch.fr>
 <515C63F7.4020602@lexifi.com>
Date: Fri, 12 Apr 2013 11:33:03 +0200
In-Reply-To: <515C63F7.4020602@lexifi.com> (Alain Frisch's message of "Wed, 03
 Apr 2013 19:16:39 +0200")
Message-ID: <6xzjx4gkkw.fsf@blau.inf.tu-dresden.de>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Subject: Re: [wg-camlp4] Extension developers: we need you!
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 12 Apr 2013 09:24:44 -0000


I will probably eventually port otags, but I wait until the first
version of documentation for case (2) (see
http://lists.ocaml.org/pipermail/wg-camlp4/2013-April/000400.html)
is available.

Bye,

Hendrik

From gabriel.scherer@gmail.com  Fri Apr 12 10:35:33 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6E3D13C548
 for <wg-camlp4@lists.ocaml.org>; Fri, 12 Apr 2013 10:35:33 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1463883 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.43 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f43.google.com ([209.85.214.43]:43425)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UQaWP-0006uO-sG (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 12 Apr 2013 10:43:54 +0100
Received: by mail-bk0-f43.google.com with SMTP id jm2so1291471bkc.30
 for <wg-camlp4@lists.ocaml.org>; Fri, 12 Apr 2013 02:43:53 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type:content-transfer-encoding;
 bh=lQSLze5EBsTD5MypbqZVFAXzUo6nWXPtGEolNAJoinA=;
 b=XoxO3JRtCatG15Im/vJY5V+U5k5E0ySUMBx8JwL9QaQ63BOGKntFHWpmj9dtC5xlWF
 BsLxSTnbB4Wz3fgeHFfKzeJlmURjcZ/klg1hEGf+ycfk3N5O9htkR7O9knG89oQxAOwC
 akCSlcH+BmGL0NOV1MtEV+fwe23XYdxTgPmYDDav219yHwr9qRKaq2Xg8xSq9nN/epWK
 oBS586EvEla1u57PH81STkGUwMUKFAunTNVWt57SFtzekJSU1TFyMOM7Dy65Rftp0VeV
 /XrvrmKhnUSbZWVIwY4VX6XT8jL+1ccbqH1+rz6DyzaOaGYrIdcTxIg4gDWPgedjcpVa
 f2wg==
X-Received: by 10.205.33.81 with SMTP id sn17mr3877012bkb.53.1365759833454;
 Fri, 12 Apr 2013 02:43:53 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Fri, 12 Apr 2013 02:43:13 -0700 (PDT)
In-Reply-To: <515C63F7.4020602@lexifi.com>
References: <687334906.960850.1359473842585.JavaMail.root@inria.fr>
 <5107F74E.8010603@frisch.fr> <51559149.2020900@lexifi.com>
 <CAPFanBEDhSAqq97uV6_vf675Q6Oz_18OptR9dU4JadeC5REe6A@mail.gmail.com>
 <515C5E17.6050409@lexifi.com> <515C5FE5.6050304@frisch.fr>
 <515C63F7.4020602@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 12 Apr 2013 11:43:13 +0200
Message-ID: <CAPFanBHqUrYRkQSjrsH4qCXANvyuT4UE8S87TRN4ba9aTt=Y8A@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Extension developers: we need you!
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 12 Apr 2013 09:35:33 -0000

A small remark requesting no immediate action, but maybe suggestions
of things to work on (not necessarily for Alain) in the future.

I remarked in a recent extension example by Alain (
https://github.com/ocaml/ocaml/commit/f7fee51ae33e357714b03f7f9b025a1a48182=
549
) that a non-neglectible portion of the code logic is dedicated to
"option processing". Alain uses optional attributes to tune the code
generation of his -ppx extension, and he has to process them very much
like command-line options in an application: get the value of them,
turn that into program-specific logic, handle options that don't make
sense when provided both at the same time, etc.

>From his commit:

+(*
[...]
+  We recognize some special attributes on record fields (or their associat=
ed
+  type) and on constructor argument types:
+
+  - [@label id]: specify a label for the parameter of the builder function
+    (for records, it is set automatically from the label name
+    but it can be overridden).
+
+  - [@opt]: the parameter is optional (this assume that the field/argument
+    has an option type).
+
+  - [@default expr]: the parameter is optional, with a default value
+    (cannot be used with [@opt]).
+*)

[...]

+  let param named name loc attrs =3D
+    let default =3D find_attr "default" attrs in
+    let opt =3D has_attr "opt" attrs in
+    let label =3D
+      match find_attr "label" attrs with
+      | None -> if named then name else ""
+      | Some e ->
+          match get_lid e with
+          | Some s -> s
+          | None -> fatal e.pexp_loc "'label' attribute must be a
string literal"
+    in
+    let label =3D
+      if default <> None || opt then
+        if label =3D "" then fatal loc "Optional arguments must be
named" else "?" ^ label
+      else label
+    in
+    if default <> None && opt then fatal loc "Cannot have both 'opt'
and 'default' attributes";
+    lam ~label ?default (pvar name), (name, evar name)

I expect that we will see similarly-looking pieces of code in most
extensions using attributes to tune behavior, and that would be a good
candidate for a proper library abstraction allowing a more declarative
style of programming.

What are the right abstraction to describe such optional attributes?
Can we reuse libraries dedicated to command-line processing, or only
their ideas?

As far as I know, the most advanced work in this direction in the
OCaml community is Daniel B=FCnzli's Cmdliner library:
  http://erratique.ch/software/cmdliner/doc/Cmdliner
Can we reuse Cmdliner for -ppx extensions?

(On the paper that is work that would also apply to Camlp4/Fan
extensions, but in practice I haven't encountered this kind of
optional parametrizations in mainstream Camlp4 extension, and I
suspect Alain's attribute model is a necessary and sufficient feature
for them to gain wider use.)

Consider this email as a TODO list item: at some point, we would need
someone to invest time to think about that, and produce a reusable
library for this aspect of extension development.

PS: Alain, type-driven code generation is a terrible name to qualify
this particular extension, as I was expecting code generation driven
by type information in a typedtree. This is code generated from
(syntactic) type *definitions*. If "type-definition-driven code
generation" is too long, maybe "deriving-style extension" would be
reasonable.

On Wed, Apr 3, 2013 at 7:16 PM, Alain Frisch <alain.frisch@lexifi.com> wrot=
e:
> Now is a good time to start collecting more concrete feedback from extens=
ion
> developers on the current proposal (ppx + extension_points). Are there
> people on this list interested in porting their existing extensions (or
> other tools which can benefit from attributes)?   This will be greatly
> helpful if the current design can be validated by real extension develope=
rs.
> Porting real extensions will also help to isolate a good set of
> "convenience" functions to build or deconstruct AST fragments in a light
> way.
>
> (Disclaimer: there will still be some more cleanups to the Parsetree
> definition and helper modules (Ast_mapper, Ast_helper), so the code writt=
en
> now will need to be adjusted for the final version, but I expect those
> changes to be quite easy.)
>
>
> -- Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From alain.frisch@lexifi.com  Fri Apr 12 17:11:40 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D6CBE3C568
 for <wg-camlp4@lists.ocaml.org>; Fri, 12 Apr 2013 17:11:40 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1463883 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:34899
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UQghm-0001Bw-Wg (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 12 Apr 2013 17:20:02 +0100
Received: from [192.168.1.109] ([86.195.22.55]) by mwinf5d04 with ME
 id P4Kz1l0081BJsxy034Kz6l; Fri, 12 Apr 2013 18:20:01 +0200
Message-ID: <51683434.9050907@lexifi.com>
Date: Fri, 12 Apr 2013 18:20:04 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:21.0) Gecko/20100101 Thunderbird/21.0
MIME-Version: 1.0
To: Hendrik Tews <tews@os.inf.tu-dresden.de>, wg-camlp4@lists.ocaml.org
References: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
 <5166C667.3070405@lexifi.com> <6x4nfchzfh.fsf@blau.inf.tu-dresden.de>
In-Reply-To: <6x4nfchzfh.fsf@blau.inf.tu-dresden.de>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] My no-use of camlp4 syntax extensions for Otags
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 12 Apr 2013 16:11:40 -0000

On 04/12/2013 11:26 AM, Hendrik Tews wrote:
> and nothing is clear. When I look up mkpat, then all I know is
> that an or-pattern is not a Ppat_or node, it is some record, for
> which I don't even know the type. So I would have to search for
> ppat_desc, and select the right one of the 100 matches that grep
> reports. Note that I have been lucky here, because mkpat is very
> simple and is defined in parser.mly . There are surely more
> complicated functions that are elsewhere defined.

In order to write robust AST rewriters, you'll need to be quite familiar 
with the definition of the Parsetree structure, so reading parsetree.mli 
once will be more or less necessary anyway.

The fact that most fragments are represented with a record containing a 
"location" field, a "description" field (and now, an "attributes" field) 
is pretty uniform.  I agree that the Parsetree definition would deserve 
some documentation and some introductory content will be useful as well, 
but even without any further documentation, finding the information 
relative to "Ppat_or" is not very difficult if you read parsetree.mli.

> There might however be cases with the danger of wrong
> generalization. What I mean with this is the following: The
> ocamlast tool only works on correct OCaml code. I cannot feed
> it with "assert _ " in order to get the most general ast
> tree for assertions. So instead I have to feed it with, for
> instance, "assert true" and get Pexp_assert ... I might now
> believe that "assert false" is also represented with Pexp_assert,
> which is wrong.
>
> So, if there are cases, where similar looking concrete syntax is
> represented differently, then they should be listed somewhere.

It makes sense to list all such weird cases, or, when it makes sense, to 
fix them.  For this specific examples (Pexp_assertfalse), Romain Bardou 
(email on Jan. 28) argued that it should stay as of today.  Do other 
people agree?

> For documentation need (2), ocamlast is not really a help. For
> (2) I would suggest to annotate each constructor in parsetree.mli
> with the concrete syntax. For instance
>
>    | Pexp_while of expression * expression
>       (** while <expression> do <expression> done *)

Good idea. I've started with type expressions:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/parsing/parsetree.mli?r1=13512&r2=13517

Do you feel this brings useful information in this form?

> There are probably a lot of side conditions. For
> instance, "expr_1; expr_2; expr_3" is
> Pexp_sequence(expr_1, Pexp_sequence (expr_2, expr3) and not
> Pexp_sequence( Pexp_sequence(expr_1, expr_2), expr3) (or vice
> versa).

(e1; e2; e3) is indeed parsed as (e1; (e2; e3)), but ((e1; e2); e3) will 
be represented as you expect (confirmed by ocamlast).  I don't think it 
is worth documenting again the definition of the Parsetree 
disambiguation and associativity rules; this is already done in the 
manual, and rules can be discovered with ocamlast.

Moreover, I'd argue that authors of ppx extensions don't really need to 
be familiar with this topic, since they operate on abstract syntax. 
What's important is rather to specify invariants on the Parsetree data 
structure, especially those which are not checked by the type-checker. 
(And we should probably strengthen the type-checker to test more of 
those conditions such as the validity of identifier strings, etc.)

> Another kind of side condition is that certain nodes do not and
> must not occur inside other nodes. For instance, the left
> expression in Pexp_sequence is never a Pexp_sequence. (This is
> probably wrong, but you get the idea.)

Indeed, this is wrong, but I get the idea :-)  Luckily, there aren't 
many such structural invariants, and it should not be too difficult to 
list them.

> You could write the documentation for (1) and (2) in comments or
> ocamldoc comments in the source files. However, I would prefer
> something like a wiki page, where we users can immediately
> contribute.

Authors of ppx extensions are probably going to have parsetree.mli under 
they eyes quite often.  It seems good to me to put some documentation 
directly there.  Which is not to say that an external wiki won't be 
useful as well.


Alain

From alain.frisch@lexifi.com  Fri Apr 12 17:43:05 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6185E3C568
 for <wg-camlp4@lists.ocaml.org>; Fri, 12 Apr 2013 17:43:05 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1463883 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:48287
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UQhC9-0006pT-sp (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 12 Apr 2013 17:51:27 +0100
Received: from [192.168.1.109] ([86.195.22.55]) by mwinf5d04 with ME
 id P4rR1l0081BJsxy034rRyE; Fri, 12 Apr 2013 18:51:25 +0200
Message-ID: <51683B92.30508@lexifi.com>
Date: Fri, 12 Apr 2013 18:51:30 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:21.0) Gecko/20100101 Thunderbird/21.0
MIME-Version: 1.0
To: Caml-Devel <caml-devel@yquem.inria.fr>, 
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Nicolas Pouillard <np@nicolaspouillard.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] About the "bool" argument fo Ppat_construct and
	Pexp_construct
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 12 Apr 2013 16:43:05 -0000

Dear all,

The Ppat_construct and Pexp_construct constructors in Parsetree have a 
"bool" argument supposed to encode the fact that if the argument is a 
tuple of length N, then it actually represents the N arguments of an 
N-ary constructor, so that it won't type-check if the constructor is 
declared with a single argument being a N-tuple type.  (In the normal 
OCaml syntax, this cannot be distinguished.)

I believe this was introduced to give better error messages with Camlp4 
revised syntax, but the behavior seems to be disabled by default (can 
anyone confirm?) and I don't see how to enable it.  The following is 
accepted if we compile with camlp4:

=======================================
type t = [C of (int * int)];

value f = fun [ C x y -> x + y ];
=======================================

and I believe rejecting this was the reason to introduce the Boolean.


Does anyone object to removing the Boolean?

Alain

From alain.frisch@lexifi.com  Tue Apr 16 16:42:06 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B39043C046
 for <wg-camlp4@lists.ocaml.org>; Tue, 16 Apr 2013 16:42:06 +0100 (BST)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.3.2-1467901 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:44905
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1US89X-0001SK-9E (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 16 Apr 2013 16:50:41 +0100
Received: from [192.168.1.109] ([92.151.118.133]) by mwinf5d63 with ME
 id Qfqe1l00C2smPok03fqeAM; Tue, 16 Apr 2013 17:50:39 +0200
Message-ID: <516D734D.2060307@lexifi.com>
Date: Tue, 16 Apr 2013 17:50:37 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:21.0) Gecko/20100101 Thunderbird/21.0
MIME-Version: 1.0
To: Romain Bardou <romain.bardou@inria.fr>, wg-camlp4@lists.ocaml.org
References: <51069877.5070307@lexifi.com> <51069CB5.6000706@inria.fr>
In-Reply-To: <51069CB5.6000706@inria.fr>
Content-Type: text/plain; charset=windows-1252; format=flowed
Content-Transfer-Encoding: 8bit
Subject: Re: [wg-camlp4] Improvements to the OCaml Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 16 Apr 2013 15:42:06 -0000

On 01/28/2013 04:43 PM, Romain Bardou wrote:
> About assert false as a special node: I think it should stay like this.
>
> It may add a case to treat, but the treatment will usually be trivial.
> If it is not, then it will probably be an instance of the assert case,
> in which case you can just call the assert case with <<false>> as an
> argument. Else it means that you have a very different treatment for
> false and in this case, youre glad that they are separate.
>
> Moreover, this case really is a special case as it is typed differently.
> I think it is better if the parse tree reflects this, so that the
> programmer is conscious of this when transforming assertions.

I've given it some thought, and I'm no longer convinced by the argument. 
  I can see two concrete reasons for treating "assert false" in the 
type-checker:

  - -ppx rewriters could very well produce an assert node with a "false" 
expression and it would behave differently from an "assert false" in the 
source code.  This would be quite puzzling, and round-tripping with the 
concrete syntax becomes impossible.

  - It is not clear what to do with "assert (false[@foo])".


I don't think we should insist to keep the Parsetree as close as 
possible to the concrete syntax if this adds extra complexity (e.g. 
keeping parentheses and other syntactic details does not seem very 
useful), but this seems to be a case where there is no strong reason to 
not do it and it will actually simplify the Parsetree to do so.

So unless someone strongly objects to it, I'll get rid of 
Pexp_assertfalse and add support for the special case in the type-checker.


Alain

From alain.frisch@lexifi.com  Wed Apr 17 13:47:25 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5BB973C407
 for <wg-camlp4@lists.ocaml.org>; Wed, 17 Apr 2013 13:47:25 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1468327 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:45333
 helo=msa.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1USRu6-0003vr-Sh (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 17 Apr 2013 13:56:03 +0100
Received: from [192.168.1.109] ([92.151.118.133]) by mwinf5d55 with ME
 id R0w11l00R2smPok030w2cr; Wed, 17 Apr 2013 14:56:02 +0200
Message-ID: <516E9BE4.8050301@lexifi.com>
Date: Wed, 17 Apr 2013 14:56:04 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:21.0) Gecko/20100101 Thunderbird/21.0
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>, 
 Caml-Devel <caml-devel@yquem.inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] Changes to the Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 17 Apr 2013 12:47:25 -0000

Dear all,

Here is a list of the most important recent changes I've applied to the 
Parsetree in the extension_points branch.  The primary goals are to 
reduce the number of implicit invariants (not represented in the data 
structure itself) and make the Parsetree more user-friendly.

  - Splitting Pexp_constraint into two constructors, one to represent 
type constraints (e : t), another one to represent type coercion (e : t1 
:> t2) or (e :> t).

  - Splitting Pexp_function into two constructors, one for "function P1 
-> E1 | ... | Pn -> En", another for "fun P -> E / fun ~l:P -> E / fun 
?l:P -> E / fun ?l:(P = E) -> E".  (And removing support for "fun P when 
E -> E".)

  - Merging Pexp_assertfalse into Pexp_assert.

  - Keeping an explicit representation of interval patterns.

  - Explicit representation of "when" guards for function/match/try in a 
new "case" record type {pc_lhs: pattern; pc_guard: expression option; 
pc_rhs: expression}, instead of Pexp_when.

  - And a few more, listed in extension_points.txt.


Don't hesitate to comment on those changes, or to suggest other ones.

Also, the Parsetree module now documents all constructions and tries to 
list required invariants.


Alain

From tews@os.inf.tu-dresden.de  Thu Apr 18 11:15:21 2013
Return-Path: <tews@os.inf.tu-dresden.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 463DD3C087
 for <wg-camlp4@lists.ocaml.org>; Thu, 18 Apr 2013 11:15:21 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -3.0 from SpamAssassin-3.3.2-1468800 
 * -2.3 RCVD_IN_DNSWL_MED RBL: Sender listed at http://www.dnswl.org/,
 *      medium trust
 *      [141.76.48.99 listed in list.dnswl.dnsbl.ja.net]
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from os.inf.tu-dresden.de ([141.76.48.99]:33985)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1USm0X-0007LG-SC (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <tews@os.inf.tu-dresden.de>); Thu, 18 Apr 2013 11:24:02 +0100
Received: from [2002:8d4c:3001:48:222:68ff:fe19:71d]
 (helo=blau.inf.tu-dresden.de)
 by os.inf.tu-dresden.de with esmtpsa (TLSv1:DHE-RSA-AES128-SHA:128) (Exim
 4.80.1) id 1USm0X-0001ky-Bp
 for wg-camlp4@lists.ocaml.org; Thu, 18 Apr 2013 12:24:01 +0200
Received: from tews by blau.inf.tu-dresden.de with local (Exim 4.80)
 (envelope-from <tews@os.inf.tu-dresden.de>) id 1USm0U-000751-Rv
 for wg-camlp4@lists.ocaml.org; Thu, 18 Apr 2013 12:23:58 +0200
From: Hendrik Tews <tews@os.inf.tu-dresden.de>
To: wg-camlp4@lists.ocaml.org
References: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
 <5166C667.3070405@lexifi.com> <6x4nfchzfh.fsf@blau.inf.tu-dresden.de>
 <51683434.9050907@lexifi.com>
Date: Thu, 18 Apr 2013 12:23:58 +0200
In-Reply-To: <51683434.9050907@lexifi.com> (Alain Frisch's message of "Fri, 12
 Apr 2013 18:20:04 +0200")
Message-ID: <6xwqs0i1c1.fsf@blau.inf.tu-dresden.de>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Subject: Re: [wg-camlp4] My no-use of camlp4 syntax extensions for Otags
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 18 Apr 2013 10:15:21 -0000

Alain Frisch <alain.frisch@lexifi.com> writes:

   > There might however be cases with the danger of wrong
   > generalization. What I mean with this is the following: The
   > ocamlast tool only works on correct OCaml code. I cannot feed
   > it with "assert _ " in order to get the most general ast
   > tree for assertions. So instead I have to feed it with, for
   > instance, "assert true" and get Pexp_assert ... I might now
   > believe that "assert false" is also represented with Pexp_assert,
   > which is wrong.

I forgot to note, that "assert false" is of course a bad example.
With Pexp_assertfalse standing next to Pexp_assert, everything is
clear in this case.

   > For documentation need (2), ocamlast is not really a help. For
   > (2) I would suggest to annotate each constructor in parsetree.mli
   > with the concrete syntax. For instance
   >
   >    | Pexp_while of expression * expression
   >       (** while <expression> do <expression> done *)

   Good idea. I've started with type expressions:

This is precisely the kind of documentation that I was asking
for. Good that you also integrated side conditions, eg n >=2 for
Ptyp_tuple. 

   > There are probably a lot of side conditions. For
   > instance, "expr_1; expr_2; expr_3" is
   > Pexp_sequence(expr_1, Pexp_sequence (expr_2, expr3) and not
   > Pexp_sequence( Pexp_sequence(expr_1, expr_2), expr3) (or vice
   > versa).

   (e1; e2; e3) is indeed parsed as (e1; (e2; e3)), but ((e1; e2); e3)
   will be represented as you expect (confirmed by ocamlast).  I don't
   think it is worth documenting again the definition of the Parsetree
   disambiguation and associativity rules; this is already done in the
   manual, and rules can be discovered with ocamlast.

   Moreover, I'd argue that authors of ppx extensions don't really need
   to be familiar with this topic, since they operate on abstract syntax.
   What's important is rather to specify invariants on the Parsetree data
   structure, especially those which are not checked by the type-checker.
   (And we should probably strengthen the type-checker to test more of
   those conditions such as the validity of identifier strings, etc.)

The sequence example is bad. I simply mean that 
side conditions / invariants should be mentioned. First, for
constructing ast's that will not cause the compiler to crash. But
also for ignoring irrelevant cases when pattern matching on an
ast.

   > You could write the documentation for (1) and (2) in comments or
   > ocamldoc comments in the source files. However, I would prefer
   > something like a wiki page, where we users can immediately
   > contribute.

   Authors of ppx extensions are probably going to have parsetree.mli
   under they eyes quite often.  It seems good to me to put some
   documentation directly there.  Which is not to say that an external
   wiki won't be useful as well.

I suggested a wiki because, in the past, it took sometimes ages
to get the documentation fixed. But if the documentation in
parsetree.mli is complete and if changes are integrated in
reasonable time, then a wiki is superfluous.

Bye,

Hendrik

From tews@os.inf.tu-dresden.de  Thu Apr 18 12:31:04 2013
Return-Path: <tews@os.inf.tu-dresden.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9C7823C007
 for <wg-camlp4@lists.ocaml.org>; Thu, 18 Apr 2013 12:31:04 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-SpamDetails: score -3.0 from SpamAssassin-3.3.2-1468800 
 * -2.3 RCVD_IN_DNSWL_MED RBL: Sender listed at http://www.dnswl.org/,
 *      medium trust
 *      [141.76.48.99 listed in list.dnswl.dnsbl.ja.net]
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from os.inf.tu-dresden.de ([141.76.48.99]:55738)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1USnBp-0003Ws-qP (Exim 4.72) for wg-camlp4@lists.ocaml.org
 (return-path <tews@os.inf.tu-dresden.de>); Thu, 18 Apr 2013 12:39:45 +0100
Received: from [2002:8d4c:3001:48:222:68ff:fe19:71d]
 (helo=blau.inf.tu-dresden.de)
 by os.inf.tu-dresden.de with esmtpsa (TLSv1:DHE-RSA-AES128-SHA:128) (Exim
 4.80.1) id 1USnBo-0004Rt-RE; Thu, 18 Apr 2013 13:39:44 +0200
Received: from tews by blau.inf.tu-dresden.de with local (Exim 4.80)
 (envelope-from <tews@os.inf.tu-dresden.de>)
 id 1USnBo-0007Az-2v; Thu, 18 Apr 2013 13:39:44 +0200
From: Hendrik Tews <tews@os.inf.tu-dresden.de>
To: "wg-camlp4\@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
References: <5164282C.5010507@lexifi.com>
Date: Thu, 18 Apr 2013 13:39:44 +0200
In-Reply-To: <5164282C.5010507@lexifi.com> (Alain Frisch's message of "Tue, 09
 Apr 2013 16:39:40 +0200")
Message-ID: <6xsj2ohxtr.fsf@blau.inf.tu-dresden.de>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Subject: Re: [wg-camlp4] About Ptyp_poly nodes in the Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 18 Apr 2013 11:31:04 -0000

Alain Frisch <alain.frisch@lexifi.com> writes:

   I'd like to get your opinion about the representation of "polymorphic
   types" (Ptyp_poly) nodes in the Parsetree.

Personally, I don't think that I or II is a problem. Well, II is
a bit inconvenient, and it is nice that it is fixed now.

Besides I and II there are probably more 
side conditions / invariants for the ast that are not enforced by
the type of the ast. I would view I and II as a specific instance
of how to deal with incorrect ast's. 

>From the extension developers point of view it would be nice if
the type checker would enforce all invariants. Alternatively, one
could have an ast-checker extension, that checks all invariants.
One could put the ast-checker extension into the extension pipe
whenever something is strange.


Bye,

Hendrik

From alain.frisch@lexifi.com  Thu Apr 18 16:47:59 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5F7253C007
 for <wg-camlp4@lists.ocaml.org>; Thu, 18 Apr 2013 16:47:59 +0100 (BST)
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:29477
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1USrAW-0005nh-9A (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 18 Apr 2013 16:56:41 +0100
Received: from [192.168.1.106] ([86.195.23.217]) by mwinf5d41 with ME
 id RTug1l00C4h25tS03Tugjy; Thu, 18 Apr 2013 17:54:40 +0200
Message-ID: <51701746.9010008@lexifi.com>
Date: Thu, 18 Apr 2013 17:54:46 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:21.0) Gecko/20100101 Thunderbird/21.0
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] Next steps
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 18 Apr 2013 15:47:59 -0000

Dear all,

Here are some remaining tasks where some help would be appreciated:

- Starting to port some Camp4 extensions to -ppx with extension_points 
and report on the experience.

(Some examples of tiny ppx filters exist in the experimental/frisch 
directory on the extension_points branch:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/branches/extension_points/experimental/frisch/Makefile?view=markup
)

- Extend Ast_helper.Convenience with useful functions, as detected while 
rewriting some Camlp4 extensions.

- Update parsing/pprintast.ml to support attributes/extensions.  It is 
the code used when passing "-dsource" to the compiler and it is very 
useful to debug -ppx filters (and other AST-based tools).

- Update Camlp4 (its parsers and its own OCaml AST) to support 
attributes/extensions.


Alain

From romain.bardou@inria.fr  Fri Apr 26 17:13:27 2013
Return-Path: <romain.bardou@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 050073CA1E
 for <wg-camlp4@lists.ocaml.org>; Fri, 26 Apr 2013 17:13:27 +0100 (BST)
X-Cam-SpamDetails: score -5.0 from SpamAssassin-3.3.2-1475675 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:3376)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UVlPt-0007ep-9W (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <romain.bardou@inria.fr>); Fri, 26 Apr 2013 17:22:34 +0100
X-IronPort-AV: E=Sophos;i="4.87,559,1363129200"; d="scan'208";a="12355024"
Received: from unknown (HELO [10.1.202.3]) ([194.254.61.161])
 by mail3-relais-sop.national.inria.fr with ESMTP/TLS/DHE-RSA-CAMELLIA256-SHA;
 26 Apr 2013 18:22:33 +0200
Message-ID: <517AA9C8.8080109@inria.fr>
Date: Fri, 26 Apr 2013 18:22:32 +0200
From: Romain Bardou <romain.bardou@inria.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <51069877.5070307@lexifi.com> <51069CB5.6000706@inria.fr>
 <516D734D.2060307@lexifi.com>
In-Reply-To: <516D734D.2060307@lexifi.com>
X-Enigmail-Version: 1.4.1
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: 8bit
Subject: Re: [wg-camlp4] Improvements to the OCaml Parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 26 Apr 2013 16:13:27 -0000

Le 16/04/2013 17:50, Alain Frisch a crit :
> On 01/28/2013 04:43 PM, Romain Bardou wrote:
>> About assert false as a special node: I think it should stay like this.
>>
>> It may add a case to treat, but the treatment will usually be trivial.
>> If it is not, then it will probably be an instance of the assert case,
>> in which case you can just call the assert case with <<false>> as an
>> argument. Else it means that you have a very different treatment for
>> false and in this case, youre glad that they are separate.
>>
>> Moreover, this case really is a special case as it is typed differently.
>> I think it is better if the parse tree reflects this, so that the
>> programmer is conscious of this when transforming assertions.
> 
> I've given it some thought, and I'm no longer convinced by the argument.
>  I can see two concrete reasons for treating "assert false" in the
> type-checker:
> 
>  - -ppx rewriters could very well produce an assert node with a "false"
> expression and it would behave differently from an "assert false" in the
> source code.  This would be quite puzzling, and round-tripping with the
> concrete syntax becomes impossible.

Sorry for the delay, I was not paying attention to the list at the time
(and the personal copy was sent to my list folder automatically as well).

Not that I strongly object at all, but I would just point out that the
reverse is also true: one may not understand why some expression
sometimes has type 'a and sometimes has type, well, something else.

For instance, let's imagine a rewriter expands:

let check () =
  check_platform_is[@32]

into either:

let check () =
  assert false (* if on 64bits *)

or:

let check () =
  () (* if on 32bits *)

Now, imagine the programmer does not realize this, and puts the
following type in the .mli:

val check: 'a (* or anything except unit *)

If he does not actually call this function, the programmer will only see
the error when compiling for another platform, and he may be quite
puzzled as well.

Now, that's maybe not a strong enough argument against simplification
though. Just an interesting fact.

>  - It is not clear what to do with "assert (false[@foo])".

That's very true.

-- 
Romain Bardou

From gabriel.scherer@gmail.com  Wed May  1 15:36:08 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8FCF53C046
 for <wg-camlp4@lists.ocaml.org>; Wed,  1 May 2013 15:36:08 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1477509 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.42 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f42.google.com ([209.85.214.42]:42375)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UXYHi-0007Fm-0s (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Wed, 01 May 2013 15:45:30 +0100
Received: by mail-bk0-f42.google.com with SMTP id jf3so658463bkc.29
 for <wg-camlp4@lists.ocaml.org>; Wed, 01 May 2013 07:45:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:from:date:message-id:subject:to:cc
 :content-type; bh=3j6WNDyStmenNFpav5WRlMc1U1Y5lwaopUpCVormcPY=;
 b=Czwse873Y9VblSRrt5WwzNAOYAxBEy9so/7z00V3bGYtd5y3E2tiT9VTsI0MGRxrDb
 p3vI1TQ+lf3LO2+9gR5PHDgdROikHGwiszmbgGZKI1YwHC8MW23jHiDlDh0zJSh87pmb
 yzYmlj6bpK+vSi9YEj94fEEsLhkUG7cNVuY1xdUtHvc68N7Y5OxU+0gncjKLiKG7f7mk
 xLW5frdWgb9dna9Cq1/mF/7g5GTj7cZXWDwm+yURZ3LCckZDFu15q9ranjSMuaQ1U/M1
 O+C2384+B3HEKEbOGQr3zLQY4XOy4bvWo7MUgS717kXJlSihoezjQiHCZ0+Uo77bwtF5
 EjbA==
X-Received: by 10.204.188.81 with SMTP id cz17mr924862bkb.91.1367419529792;
 Wed, 01 May 2013 07:45:29 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Wed, 1 May 2013 07:44:48 -0700 (PDT)
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Wed, 1 May 2013 16:44:48 +0200
Message-ID: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: multipart/mixed; boundary=20cf302923f655501504dba92b44
Cc: rixed@happyleptic.org
Subject: [wg-camlp4] Negative field report: extension points unsuited for
	(matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 01 May 2013 14:36:08 -0000

--20cf302923f655501504dba92b44
Content-Type: text/plain; charset=ISO-8859-1

The recent caml-list message by rixed (archived below) motivated me to
get pa_matches in shape (it lacked support for "when ..."), and try to
see how a similar extension could be implemented with the new
extension_points branch.

The Camlp4 extension allows a new syntax for expressions, (matches
<pattern>) or (matches <pattern> when <expr>), that desugars into a
test function returning a boolean: (function <pattern> when <expr> ->
true | _ -> false). I have attached to this mail the relevant code,
called pa_matches.ml (pa_ is a traditional prefix for Camlp4 *parser*
extensions).

I quickly found out that extension points as currently implemented in
Alain's branch are ill-suited for this task, because the piece of code
we want to parse (<patt> when <expr>) is not syntactically an
expression. [%matches <patt> when <expr>] would be rejected by the
parser.

Note that this is just an experience report, and not a value judgment
on the extension_points approach itself. I think the choice to only
accept syntactically valid expressions (in fact structure items) has a
lot of merits (notably wrt. toolability). The price to pay is that
potential extension have to be massaged into syntactically correct
pieces, with a potential loss of concision when compared to
domain-specific syntax designs. This indicates, I think, that
extension_points is not always suited for "syntax changes in the
small", where a very concise syntax is given to an otherwise
expressible expression (and concision is thus essential for the
purpose of the extension), except when this extension exactly fits the
syntactic form of the more high-level OCaml syntactic classes.

For the purpose of experimentation, I still decided to do an
implementation based on a horrible hack, namely using (the new syntax
for) string literals that had been presented as a way to get "foreign
language quotations" in this context, with the syntax [%matches {|
<patt> when <expr> |}]. I believe this course of action should be
discouraged; in particular, there is no proper error handling. It
seems that deploying extensions based on this principle would
constitute a regression from the current Camlp4 situation.

Note that this implementation technique might be made slightly more
reasonable if the following ingredients were present:
- a simple and correct way to add location information from a lexing
buffer obtained from "Lexing.from_string", to inform the lexer of
where in the file it's picking up tokens (note that in the above case,
this is not enough as the quoted string is prefixed with some code to
make it a valid expression)
- more entry points in the parser for eg. patterns and match actions
- maybe support from the ppx wrapper to catch and re-route OCaml errors

I think this is all rather cumbersome and we should rather understand
and accept the limitations of extension points -- and make unruly
users respect them!

On Sat, Apr 27, 2013 at 10:04 AM, Gabriel Scherer
<gabriel.scherer@gmail.com> wrote:
> This is a subset of Richard Jones' "matches" syntax extension, turning
> an pattern matching on 'a into a ('a -> bool) function:
>
>   if (matches Some x when x > 15) variable then ...
>
> (The original extension did not handle "when", but it would be quite
> easy to add.)
>
> On Sat, Apr 27, 2013 at 9:18 AM,  <rixed@happyleptic.org> wrote:
>> Wouldnt it be nice if, as a special form of the = operator,
>> "variable = pattern when condition" were equivalent to
>> "match variable with pattern when condition -> true | _ -> false" ?
>>
>> So that one could easily check optional values for instance:
>>
>> if variable = Some x when x > 15 then blabla
>>
>> What do you think?
>>
>>
>> --
>> Caml-list mailing list.  Subscription management and archives:
>> https://sympa.inria.fr/sympa/arc/caml-list
>> Beginner's list: http://groups.yahoo.com/group/ocaml_beginners
>> Bug reports: http://caml.inria.fr/bin/caml-bugs

--20cf302923f655501504dba92b44
Content-Type: application/octet-stream; name="pa_matches.ml"
Content-Disposition: attachment; filename="pa_matches.ml"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hg6l4pyh0

KCogbWF0Y2hlcyBrZXl3b3JkLgogICogQ29weXJpZ2h0IChDKSAyMDA4IFJlZCBIYXQgSW5jLiwg
UmljaGFyZCBXLk0uIEpvbmVzCiAgKiBDb3B5cmlnaHQgKEMpIDIwMTMgR2FicmllbCBTY2hlcmVy
CiAgKgogICogVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmli
dXRlIGl0IGFuZC9vcgogICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExl
c3NlciBHZW5lcmFsIFB1YmxpYwogICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUg
U29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCiAgKiB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2Us
IG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAgKgogICogVGhpcyBsaWJy
YXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAg
KiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJy
YW50eSBvZgogICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQ
VVJQT1NFLiAgU2VlIHRoZSBHTlUKICAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZv
ciBtb3JlIGRldGFpbHMuCiAgKgogICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBv
ZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogICogTGljZW5zZSBhbG9uZyB3aXRoIHRo
aXMgbGlicmFyeTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQogICogRm91bmRh
dGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAw
MjExMC0xMzAxIFVTQQogICoKICAqIEV4YW1wbGUgOiBMaXN0LmZpbHRlciAobWF0Y2hlcyAnYScg
Li4gJ3onKSB0ZXh0CiAgKiBPdXRwdXQgOiBMaXN0LmZpbHRlcgogICogICAgICAgICAgICAoZnVu
Y3Rpb24gJ2EnIC4uICd6JyB3aGVuIHRydWUgLT4gdHJ1ZSB8IF8gLT4gZmFsc2UpIHRleHQKICAq
IAogICoKICAqIENvbXBpbGUgd2l0aDoKICAqICAgb2NhbWxmaW5kIG9jYW1sYyAtcGFja2FnZSBj
YW1scDQgLXBwIGNhbWxwNG9mIC1jIHBhX21hdGNoZXMubWwKICAqIFRlc3Qgd2l0aDoKICAqICAg
Y2FtbHA0byBwYV9tYXRjaGVzLmNtbyB0ZXN0X3BhLm1sCiAgKiBvcgogICogICBvY2FtbGZpbmQg
b2NhbWxjIC1wcCAiY2FtbHA0byBwYV9tYXRjaGVzLmNtbyIgdGVzdF9wYS5tbCAtbyB0ZXN0CiAg
KikKIApvcGVuIENhbWxwNAogCm1vZHVsZSBJZCA6IFNpZy5JZCA9IHN0cnVjdAogIGxldCBuYW1l
ID0gIk1hdGNoZXMiCiAgbGV0IHZlcnNpb24gPSAiMC4zIgplbmQKCm1vZHVsZSBNYWtlIChTeW50
YXggOiBTaWcuQ2FtbHA0U3ludGF4KSA9IHN0cnVjdAogIGluY2x1ZGUgU3ludGF4CgogIGxldCBv
dXRwdXRfbWF0Y2hlcyBfbG9jIHBhdHQgZ3VhcmQgPQogICAgbGV0IGd1YXJkID0gbWF0Y2ggZ3Vh
cmQgd2l0aAogICAgICB8IE5vbmUgLT4gPDpleHByPCB0cnVlID4+CiAgICAgICAgKCogTkI6ICJ3
aGVuIHRydWUiIGF2b2lkcyB0aGUgd2FybmluZyAidGhpcyBtYXRjaCBjYXNlIGlzIHVudXNlZCIg
KikKICAgICAgfCBTb21lIGUgLT4gZSBpbgogICAgPDpleHByPCBmdW5jdGlvbiAkcGF0dCQgd2hl
biAkZ3VhcmQkIC0+IHRydWUgfCBfIC0+IGZhbHNlID4+CiAgICAgIAogIEVYVEVORCBHcmFtCiAg
ICBleHByOiBMRVZFTCAiOyJbWwogICAgICAibWF0Y2hlcyI7IHAgPSBwYXR0OyBndWFyZCA9IE9Q
VCBbICJ3aGVuIjsgZSA9IGV4cHIgLT4gZSBdIC0+CiAgICAgICAgb3V0cHV0X21hdGNoZXMgX2xv
YyBwIGd1YXJkCiAgICBdXTsKICBFTkQKZW5kCgpsZXQgbW9kdWxlIE0gPSBSZWdpc3Rlci5PQ2Ft
bFN5bnRheEV4dGVuc2lvbihJZCkoTWFrZSkgaW4gKCkK
--20cf302923f655501504dba92b44
Content-Type: application/octet-stream; name="ppx_matches.ml"
Content-Disposition: attachment; filename="ppx_matches.ml"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hg6l4tnc1

KCoKICBFeGFtcGxlIDogTGlzdC5maWx0ZXIgWyVtYXRjaGVze3wgJ2EnIC4uICd6JyB8fV0gdGV4
dAogIE91dHB1dCA6IExpc3QuZmlsdGVyCiAgICAgICAgICAgICAoZnVuY3Rpb24gJ2EnIC4uICd6
JyB3aGVuIHRydWUgLT4gdHJ1ZSB8IF8gLT4gZmFsc2UpIHRleHQKICAKICBDb21waWxhdGlvbjoK
ICAgIG9jYW1sZmluZCBvY2FtbGMgLXBhY2thZ2UgY29tcGlsZXItbGlicy5jb21tb24gLWxpbmtw
a2cgcHB4X21hdGNoZXMubWwgLW8gcHB4X21hdGNoZXMuZXhlCiAgVGVzdDoKICAgIG9jYW1sYyAt
cHB4IC4vcHB4X21hdGNoZXMuZXhlIC1kc291cmNlIHRlc3RfcHB4Lm1sCiopCgpvcGVuIEFzdHR5
cGVzCm9wZW4gUGFyc2V0cmVlCgpsZXQgbWFwcGVyID0KICBvYmplY3QodGhpcykKICAgIGluaGVy
aXQgQXN0X21hcHBlci5tYXBwZXIgYXMgc3VwZXIKCiAgICBtZXRob2QhIGV4cHIgZSA9CiAgICAg
IGxldCBsb2MgPSBlLnBleHBfbG9jIGluCiAgICAgIG1hdGNoIGUucGV4cF9kZXNjIHdpdGgKICAg
ICAgfCBQZXhwX2V4dGVuc2lvbih7dHh0PSJtYXRjaGVzIjtffSwgW3twc3RyX2Rlc2M9UHN0cl9l
dmFsIChlLCBfKTtffV0pIC0+CiAgICAgICAgYmVnaW4gbWF0Y2ggZS5wZXhwX2Rlc2Mgd2l0aAog
ICAgICAgICAgfCBQZXhwX2NvbnN0YW50IChDb25zdF9zdHJpbmcgKHBhdCwgXykpIC0+CiAgICAg
ICAgICAgICgqIGV4cGVjdCBhIHt8Li4ufH0gY29uc3RhbnQgb2YgdGhlIGZvcm0ge3w8cGF0dGVy
bj4gd2hlbiA8ZXhwcj58fSAqKQogICAgICAgICAgICBsZXQgYm9keSA9IFByaW50Zi5zcHJpbnRm
ICJmdW5jdGlvbiAlcyAtPiB0cnVlIHwgXyAtPiBmYWxzZSIgcGF0IGluCiAgICAgICAgICAgIFBh
cnNlLmV4cHJlc3Npb24gKExleGluZy5mcm9tX3N0cmluZyBib2R5KQogICAgICAgICAgfCBfIC0+
CiAgICAgICAgICAgICgqIGVycm9yIGhhbmRsaW5nIGluc3BpcmVkIGZyb20gZXhwZXJpbWVudGFs
L2ZyaXNjaC9tZXRhcXVvdC5tbCAqKQogICAgICAgICAgICBGb3JtYXQuZXByaW50ZiAiJWF7fDxw
YXR0Pnx9IG9yIHt8PHBhdHQ+IHdoZW4gPGV4cHI+fH0gZXhwZWN0ZWQuQC4iCiAgICAgICAgICAg
ICAgTG9jYXRpb24ucHJpbnRfZXJyb3IgbG9jOwogICAgICAgICAgICBleGl0IDIKICAgICAgICBl
bmQKICAgICAgfCBfIC0+IHN1cGVyI2V4cHIgZQogIGVuZAoKbGV0ICgpID0gQXN0X21hcHBlci5t
YWluIG1hcHBlcgo=
--20cf302923f655501504dba92b44--

From bobzhang1988@gmail.com  Wed May  1 16:03:56 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7EB193C046
 for <wg-camlp4@lists.ocaml.org>; Wed,  1 May 2013 16:03:56 +0100 (BST)
X-Cam-SpamDetails: score -0.3 from SpamAssassin-3.3.2-1477509 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.51 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f51.google.com ([209.85.212.51]:33666)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UXYic-0007iF-iI (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Wed, 01 May 2013 16:13:20 +0100
Received: by mail-vb0-f51.google.com with SMTP id x16so1286023vbf.38
 for <wg-camlp4@lists.ocaml.org>; Wed, 01 May 2013 08:13:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=+FY8LwdcD4OeOBBbedpzAxzkiaMS5QERiUqiSXHWT6Y=;
 b=pZBhuWZo7bMHjd7c+jP2AejccfGyeqOFWkZtwwFMB/xKjKyqeNMMkC7Z3XilVyHWqb
 XB10Z2xRTV9eopjkcMxeRrARJvY3bxNAqCclB5VgllgpNc1lWK/nnf7x5XLgvm8fSL0V
 Q0AWE1asOqHMhO0JOXTY+r3L17gjQ8ggr1D0kmySqjoUrUbF3WuHpST8Y3EQvJPvdvQb
 ZZMyDdHiUJP/M/ja3vlpTFk7h43jo5jKhQEoUadCZ/1pECwyELGM98nc3ReflJA+CLR3
 UpCGGxbWr1hvKIrPp0kVtje9LYsYQ9cIPNDydTiSdg4j419iB8c1iC0cHzaIIiqwaCOf
 vNaQ==
MIME-Version: 1.0
X-Received: by 10.52.120.8 with SMTP id ky8mr789828vdb.128.1367421197833; Wed,
 01 May 2013 08:13:17 -0700 (PDT)
Sender: bobzhang1988@gmail.com
Received: by 10.220.68.198 with HTTP; Wed, 1 May 2013 08:13:17 -0700 (PDT)
In-Reply-To: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
Date: Wed, 1 May 2013 11:13:17 -0400
X-Google-Sender-Auth: GCF1Mr2oWJMlXNRTx_iuzB_g7Eo
Message-ID: <CANcqPu65O+Z8oQWKJTQqKEg9MKjcdXMSnXy-7sUa3oSvQhNQ_Q@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: multipart/alternative; boundary=089e013a1ba8c1940f04dba98e11
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Chapi Chapo <rixed@happyleptic.org>
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
 for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 01 May 2013 15:03:56 -0000

--089e013a1ba8c1940f04dba98e11
Content-Type: text/plain; charset=ISO-8859-1

I just wrote a similar extension in fan

open Syntax;
{:create|Gram pred|};;
{:extend|
pred:
  [pat{p};"when"; exp{e} -> {:exp| function | $pat:p when $e -> true |_ ->
false |}
  |pat{p} -> {:exp| function | $pat:p -> true | _ -> false |} ]
|};;

---- test----
let a = {:pred|('a'|'b' as x) when x='a'|} 'a';;

if a then print_string "true" else print_string "false";;
(*true *)
------------------------------------

Compared with Camlp4, it's guaranteed to be functional and you could see
some work is put into make Fan's syntax a subset of OCaml's original syntax.





On Wed, May 1, 2013 at 10:44 AM, Gabriel Scherer
<gabriel.scherer@gmail.com>wrote:

> The recent caml-list message by rixed (archived below) motivated me to
> get pa_matches in shape (it lacked support for "when ..."), and try to
> see how a similar extension could be implemented with the new
> extension_points branch.
>
> The Camlp4 extension allows a new syntax for expressions, (matches
> <pattern>) or (matches <pattern> when <expr>), that desugars into a
> test function returning a boolean: (function <pattern> when <expr> ->
> true | _ -> false). I have attached to this mail the relevant code,
> called pa_matches.ml (pa_ is a traditional prefix for Camlp4 *parser*
> extensions).
>
> I quickly found out that extension points as currently implemented in
> Alain's branch are ill-suited for this task, because the piece of code
> we want to parse (<patt> when <expr>) is not syntactically an
> expression. [%matches <patt> when <expr>] would be rejected by the
> parser.
>
> Note that this is just an experience report, and not a value judgment
> on the extension_points approach itself. I think the choice to only
> accept syntactically valid expressions (in fact structure items) has a
> lot of merits (notably wrt. toolability). The price to pay is that
> potential extension have to be massaged into syntactically correct
> pieces, with a potential loss of concision when compared to
> domain-specific syntax designs. This indicates, I think, that
> extension_points is not always suited for "syntax changes in the
> small", where a very concise syntax is given to an otherwise
> expressible expression (and concision is thus essential for the
> purpose of the extension), except when this extension exactly fits the
> syntactic form of the more high-level OCaml syntactic classes.
>
> For the purpose of experimentation, I still decided to do an
> implementation based on a horrible hack, namely using (the new syntax
> for) string literals that had been presented as a way to get "foreign
> language quotations" in this context, with the syntax [%matches {|
> <patt> when <expr> |}]. I believe this course of action should be
> discouraged; in particular, there is no proper error handling. It
> seems that deploying extensions based on this principle would
> constitute a regression from the current Camlp4 situation.
>
> Note that this implementation technique might be made slightly more
> reasonable if the following ingredients were present:
> - a simple and correct way to add location information from a lexing
> buffer obtained from "Lexing.from_string", to inform the lexer of
> where in the file it's picking up tokens (note that in the above case,
> this is not enough as the quoted string is prefixed with some code to
> make it a valid expression)
> - more entry points in the parser for eg. patterns and match actions
> - maybe support from the ppx wrapper to catch and re-route OCaml errors
>
> I think this is all rather cumbersome and we should rather understand
> and accept the limitations of extension points -- and make unruly
> users respect them!
>
> On Sat, Apr 27, 2013 at 10:04 AM, Gabriel Scherer
> <gabriel.scherer@gmail.com> wrote:
> > This is a subset of Richard Jones' "matches" syntax extension, turning
> > an pattern matching on 'a into a ('a -> bool) function:
> >
> >   if (matches Some x when x > 15) variable then ...
> >
> > (The original extension did not handle "when", but it would be quite
> > easy to add.)
> >
> > On Sat, Apr 27, 2013 at 9:18 AM,  <rixed@happyleptic.org> wrote:
> >> Wouldnt it be nice if, as a special form of the = operator,
> >> "variable = pattern when condition" were equivalent to
> >> "match variable with pattern when condition -> true | _ -> false" ?
> >>
> >> So that one could easily check optional values for instance:
> >>
> >> if variable = Some x when x > 15 then blabla
> >>
> >> What do you think?
> >>
> >>
> >> --
> >> Caml-list mailing list.  Subscription management and archives:
> >> https://sympa.inria.fr/sympa/arc/caml-list
> >> Beginner's list: http://groups.yahoo.com/group/ocaml_beginners
> >> Bug reports: http://caml.inria.fr/bin/caml-bugs
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>
>


-- 
-- Regards, Hongbo

--089e013a1ba8c1940f04dba98e11
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">I just wrote a similar extension in fan<div><div><br></div=
><div>open Syntax;</div><div>{:create|Gram pred|};;</div><div>{:extend|</di=
v><div>pred:</div><div>=A0 [pat{p};&quot;when&quot;; exp{e} -&gt; {:exp| fu=
nction | $pat:p when $e -&gt; true |_ -&gt; false |}</div>
<div>=A0 |pat{p} -&gt; {:exp| function | $pat:p -&gt; true | _ -&gt; false =
|} ]</div><div>|};;</div><div><br></div><div>---- test----</div><div style>=
<div>let a =3D {:pred|(&#39;a&#39;|&#39;b&#39; as x) when x=3D&#39;a&#39;|}=
 &#39;a&#39;;;</div>
<div><br></div><div>if a then print_string &quot;true&quot; else print_stri=
ng &quot;false&quot;;;</div><div>(*true *)</div><div>----------------------=
--------------</div><div><br></div><div style>Compared with Camlp4, it&#39;=
s guaranteed to be functional and you could see some work is put into make =
Fan&#39;s syntax a subset of OCaml&#39;s original syntax.</div>
<div style><br></div><div style><br></div></div><div><br></div></div></div>=
<div class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Wed, May 1=
, 2013 at 10:44 AM, Gabriel Scherer <span dir=3D"ltr">&lt;<a href=3D"mailto=
:gabriel.scherer@gmail.com" target=3D"_blank">gabriel.scherer@gmail.com</a>=
&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">The recent caml-list message by rixed (archi=
ved below) motivated me to<br>
get pa_matches in shape (it lacked support for &quot;when ...&quot;), and t=
ry to<br>
see how a similar extension could be implemented with the new<br>
extension_points branch.<br>
<br>
The Camlp4 extension allows a new syntax for expressions, (matches<br>
&lt;pattern&gt;) or (matches &lt;pattern&gt; when &lt;expr&gt;), that desug=
ars into a<br>
test function returning a boolean: (function &lt;pattern&gt; when &lt;expr&=
gt; -&gt;<br>
true | _ -&gt; false). I have attached to this mail the relevant code,<br>
called <a href=3D"http://pa_matches.ml" target=3D"_blank">pa_matches.ml</a>=
 (pa_ is a traditional prefix for Camlp4 *parser*<br>
extensions).<br>
<br>
I quickly found out that extension points as currently implemented in<br>
Alain&#39;s branch are ill-suited for this task, because the piece of code<=
br>
we want to parse (&lt;patt&gt; when &lt;expr&gt;) is not syntactically an<b=
r>
expression. [%matches &lt;patt&gt; when &lt;expr&gt;] would be rejected by =
the<br>
parser.<br>
<br>
Note that this is just an experience report, and not a value judgment<br>
on the extension_points approach itself. I think the choice to only<br>
accept syntactically valid expressions (in fact structure items) has a<br>
lot of merits (notably wrt. toolability). The price to pay is that<br>
potential extension have to be massaged into syntactically correct<br>
pieces, with a potential loss of concision when compared to<br>
domain-specific syntax designs. This indicates, I think, that<br>
extension_points is not always suited for &quot;syntax changes in the<br>
small&quot;, where a very concise syntax is given to an otherwise<br>
expressible expression (and concision is thus essential for the<br>
purpose of the extension), except when this extension exactly fits the<br>
syntactic form of the more high-level OCaml syntactic classes.<br>
<br>
For the purpose of experimentation, I still decided to do an<br>
implementation based on a horrible hack, namely using (the new syntax<br>
for) string literals that had been presented as a way to get &quot;foreign<=
br>
language quotations&quot; in this context, with the syntax [%matches {|<br>
&lt;patt&gt; when &lt;expr&gt; |}]. I believe this course of action should =
be<br>
discouraged; in particular, there is no proper error handling. It<br>
seems that deploying extensions based on this principle would<br>
constitute a regression from the current Camlp4 situation.<br>
<br>
Note that this implementation technique might be made slightly more<br>
reasonable if the following ingredients were present:<br>
- a simple and correct way to add location information from a lexing<br>
buffer obtained from &quot;Lexing.from_string&quot;, to inform the lexer of=
<br>
where in the file it&#39;s picking up tokens (note that in the above case,<=
br>
this is not enough as the quoted string is prefixed with some code to<br>
make it a valid expression)<br>
- more entry points in the parser for eg. patterns and match actions<br>
- maybe support from the ppx wrapper to catch and re-route OCaml errors<br>
<br>
I think this is all rather cumbersome and we should rather understand<br>
and accept the limitations of extension points -- and make unruly<br>
users respect them!<br>
<br>
On Sat, Apr 27, 2013 at 10:04 AM, Gabriel Scherer<br>
&lt;<a href=3D"mailto:gabriel.scherer@gmail.com">gabriel.scherer@gmail.com<=
/a>&gt; wrote:<br>
&gt; This is a subset of Richard Jones&#39; &quot;matches&quot; syntax exte=
nsion, turning<br>
&gt; an pattern matching on &#39;a into a (&#39;a -&gt; bool) function:<br>
&gt;<br>
&gt; =A0 if (matches Some x when x &gt; 15) variable then ...<br>
&gt;<br>
&gt; (The original extension did not handle &quot;when&quot;, but it would =
be quite<br>
&gt; easy to add.)<br>
&gt;<br>
&gt; On Sat, Apr 27, 2013 at 9:18 AM, =A0&lt;<a href=3D"mailto:rixed@happyl=
eptic.org">rixed@happyleptic.org</a>&gt; wrote:<br>
&gt;&gt; Wouldnt it be nice if, as a special form of the =3D operator,<br>
&gt;&gt; &quot;variable =3D pattern when condition&quot; were equivalent to=
<br>
&gt;&gt; &quot;match variable with pattern when condition -&gt; true | _ -&=
gt; false&quot; ?<br>
&gt;&gt;<br>
&gt;&gt; So that one could easily check optional values for instance:<br>
&gt;&gt;<br>
&gt;&gt; if variable =3D Some x when x &gt; 15 then blabla<br>
&gt;&gt;<br>
&gt;&gt; What do you think?<br>
&gt;&gt;<br>
<span class=3D"HOEnZb"><font color=3D"#888888">&gt;&gt;<br>
&gt;&gt; --<br>
&gt;&gt; Caml-list mailing list. =A0Subscription management and archives:<b=
r>
&gt;&gt; <a href=3D"https://sympa.inria.fr/sympa/arc/caml-list" target=3D"_=
blank">https://sympa.inria.fr/sympa/arc/caml-list</a><br>
&gt;&gt; Beginner&#39;s list: <a href=3D"http://groups.yahoo.com/group/ocam=
l_beginners" target=3D"_blank">http://groups.yahoo.com/group/ocaml_beginner=
s</a><br>
&gt;&gt; Bug reports: <a href=3D"http://caml.inria.fr/bin/caml-bugs" target=
=3D"_blank">http://caml.inria.fr/bin/caml-bugs</a><br>
</font></span><br>_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
<br></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>-- Regar=
ds, Hongbo
</div>

--089e013a1ba8c1940f04dba98e11--

From alain.frisch@lexifi.com  Thu May  2 08:24:28 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B6A763C087
 for <wg-camlp4@lists.ocaml.org>; Thu,  2 May 2013 08:24:28 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1477933 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:43945
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UXo1a-0008JH-6o (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 02 May 2013 08:33:54 +0100
Received: from [192.168.1.106] ([86.195.153.11]) by mwinf5d05 with ME
 id WvZs1l00f0F12tA03vZs90; Thu, 02 May 2013 09:33:53 +0200
Message-ID: <518216E0.1080007@lexifi.com>
Date: Thu, 02 May 2013 09:33:52 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:21.0) Gecko/20100101 Thunderbird/21.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>, 
 wg-camlp4@lists.ocaml.org
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
In-Reply-To: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Cc: rixed@happyleptic.org
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
 for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 02 May 2013 07:24:28 -0000

Hi Gabriel,

Thanks for the feedback.

I think it is to be understood that -ppx and extension_point do not 
target "syntax extension in the small", as you say.  I'd go as far as to 
say that they are not really about "syntax extension", since the whole 
idea is not to touch the concrete syntax.  Compared to Camlp4, Camlp5 or 
Fan, indeed, we loose the ability to provide nice little convenient 
syntactic shortcuts, and for this reason, there will still be some space 
for those tools, for people actually interested in changing the concrete 
syntax (and accepting the price to pay for it, in particular having to 
adapt their editor mode).  Luckily, I believe that most of the 
wide-spread current uses of Camlp4 don't fall in this category where the 
syntactic compactness is the ultimate goal:

   - code generation driven by type declaration;

   - code instrumentation ( la Bisect);

   - macro/conditional compilation;

   - monadic syntax (--> e.g. suggested syntax for lwt: let%W p = ...)

   - custom pattern matching (bitstring, ulex).


As a side note, I've recently changed the syntactic category accepted as 
arguments of attributes/extensions from expressions to structures, which 
are strictly more general (an expression is also syntactically a valid 
structure item, and thus a structure, in itself).

It was also discussed, some time ago, to merge the syntactic categories 
of expressions and patterns (patterns are already "almost" a 
sub-category of expressions).  This could have helped in your case (not 
for the "when" part, though).

On 05/01/2013 04:44 PM, Gabriel Scherer wrote:
> For the purpose of experimentation, I still decided to do an
> implementation based on a horrible hack, namely using (the new syntax
> for) string literals that had been presented as a way to get "foreign
> language quotations" in this context, with the syntax [%matches {|
> <patt> when <expr> |}]. I believe this course of action should be
> discouraged; in particular, there is no proper error handling. It
> seems that deploying extensions based on this principle would
> constitute a regression from the current Camlp4 situation.


I know that you're allergic to this approach, but you could also have 
adopted the following syntax:

{matches|<patt>|}
{matches|<patt> when <expr>|}

i.e. reusing syntax for an otherwise valid expression (a string 
literal).  Indeed, the "marker" for new string literals is kept in the 
Parsetree.  And those string literals have the nice property that a 
position within the string literal can be mapped to a location in the 
source code (just shift by N+2 characters, where N is the length of the 
string market, 7 in that case).  Indeed, no character within the string 
literal is interpreted in a special way (no escaping or special 
character) and whitespaces are not allowed around the marker.  This 
would support exact error reporting.

Leo has proposed to provide a combined syntax for extension node + 
quotation. This would give a cleaner way, of course, compared to 
piggy-backing valid syntax.



Alain

From jdimino@janestreet.com  Thu May  2 12:26:13 2013
Return-Path: <jdimino@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9A4B73C407
 for <wg-camlp4@lists.ocaml.org>; Thu,  2 May 2013 12:26:13 +0100 (BST)
X-Cam-SpamDetails: score -2.4 from SpamAssassin-3.3.2-1477933 
 * -2.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:49360
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UXrnS-0005vq-hD (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <jdimino@janestreet.com>); Thu, 02 May 2013 12:35:39 +0100
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <jdimino@janestreet.com>) id 1UXrn6-0003m4-Ns
 for wg-camlp4@lists.ocaml.org; Thu, 02 May 2013 07:35:12 -0400
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <jdimino@janestreet.com>) id 1UXrn6-0003Cp-N3
 for wg-camlp4@lists.ocaml.org; Thu, 02 May 2013 07:35:12 -0400
Received: from mail-ob0-f199.google.com ([209.85.214.199])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <jdimino@janestreet.com>) id 1UXrn6-0001Iu-KZ
 for wg-camlp4@lists.ocaml.org; Thu, 02 May 2013 07:35:12 -0400
Received: by mail-ob0-f199.google.com with SMTP id 16so2711974obc.10
 for <wg-camlp4@lists.ocaml.org>; Thu, 02 May 2013 04:35:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=x-received:mime-version:x-received:date:message-id:subject:from:to
 :content-type; bh=UWSUQNe7f+t4EWjzN0MpqfwNOxxACBu8RAs+sPDUbfA=;
 b=Uto5wQercIGMrCkrucVaGTxcSA1iwDE6blkntxrLUkbGs1rpurGaXUI6fy0v9XzQ5e
 RjTTCQ1sJmM9ZshKfbRkcXM8JWOjoH30s/NDZAO01JaS8DOU+uCLLNjcW6TxcBU7oawX
 +X5MXzsoHOcL8lg/QNyAYyASndWFYmg3YJtk4=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=x-received:mime-version:x-received:date:message-id:subject:from:to
 :content-type:x-gm-message-state;
 bh=UWSUQNe7f+t4EWjzN0MpqfwNOxxACBu8RAs+sPDUbfA=;
 b=FzI8fMpzx8Fcno5xTgwnNh8iZMEmqPl5BGwoD/NNCkHZZdbnB0Y8stzaIJX0MHVWEx
 LX0a7vkTxNnlbfBmdwvQsGiz44EzKgc9J6Q9QRlKigqSKwWGJ1ecNNgca6lBq5MNBSM2
 ZATgeV5FjtJTSMjOSEIyPgVHT5C2j9Ej3tSigLbXs5volACvRRU3QwzSLAnUoztXoQyt
 W5On95FrbmL4GTyE2NNplGPEO6Di5AKMelmn6WkkBYOqe3OoN7O4k5bzVgsT6z9J/WoO
 djAO/lzI2DacKI/Xs4BSduAgUiBFOre4Km5LJlMWY45b++Cq3snKwyv0oRnCsoI3quYx
 3Hxw==
X-Received: by 10.50.49.65 with SMTP id s1mr3713852ign.26.1367494512272;
 Thu, 02 May 2013 04:35:12 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.50.49.65 with SMTP id s1mr3713848ign.26.1367494512101; Thu,
 02 May 2013 04:35:12 -0700 (PDT)
Received: by 10.50.50.171 with HTTP; Thu, 2 May 2013 04:35:11 -0700 (PDT)
Date: Thu, 2 May 2013 12:35:11 +0100
Message-ID: <CANhEzE6iCKy55i1ysRJYibcCwhcpoF6q3JFj7J4QjtkYkzRTTw@mail.gmail.com>
From: Jeremie Dimino <jdimino@janestreet.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQkIvLKdJ+QMXXYd6a0v3adUFTkOqzlxfZJsKplOzYia2zwcVbdjMaiysZ4bUS2bVdusxGTk/mL4Wv+hlPbfCTpK7YEEcXgvmKfuc3hg+b81YKQNpzrCDhmlnkEZxOIWymZpizzWpOo3negeP26w7uwcOFQq8A==
Subject: [wg-camlp4] Raw representation of literals in the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 02 May 2013 11:26:13 -0000

Hi,

We recently felt the need to write a new extension that would check
integer literals.  The goal is to verify that ones containing
underscores match a specific regular expression.  Namely digits are
grouped by 3.

We can do that for instance with a camlp4 token filter, but we wanted
to try with ppx.  It is currently not possible to do it by looking at
the parsetree since constants are already evaluated (integers are
represented by an OCaml int) and the raw form is lost.

One solution would be to add the raw representation of constants in
the parsetree. For instance by changing Asttypes.constant to:

,----
| type constant_value =
|     Const_int of int
|   | Const_char of char
|   | Const_string of string
|   | Const_float of string
|   | Const_int32 of int32
|   | Const_int64 of int64
|   | Const_nativeint of nativeint
|
| type constant = constant_value * string
`----

I believe it could also be useful for other rewriters, especially ones
dealing with strings since they would be able to compute the correct
location inside a string. And maybe also for printing: Pprintast could
use the representation choosed by the programmer instead of a
standardized one.

Do people thinks that this a reasonable thing to add to the OCaml
parsetree? If yes I can do the modification.

Jeremie

From gabriel.scherer@gmail.com  Thu May  2 13:51:21 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 2EA883C407
 for <wg-camlp4@lists.ocaml.org>; Thu,  2 May 2013 13:51:21 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1477933 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.46 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f46.google.com ([209.85.214.46]:60123)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UXt7v-0001eB-6u (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Thu, 02 May 2013 14:00:47 +0100
Received: by mail-bk0-f46.google.com with SMTP id w5so249270bku.33
 for <wg-camlp4@lists.ocaml.org>; Thu, 02 May 2013 06:00:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:mime-version:in-reply-to:references:from:date:message-id
 :subject:to:cc:content-type;
 bh=exR7G60AJmBTojQz5hJv0spYPOw7CSMZA/gUOkLIgrk=;
 b=00+kBPf39AE+KYZvuzDzOQMWYaXGBGpW3zbLtxYdqM4FTtWr9cWc0S8QnbYs6E0pUx
 5aC6Pa+ToX1a+aI5kxUTtUXzL27wweGpBrXlOemLx4LZyFpCBjmtcTuD5c3EjKaMOQFc
 q/daksOAyq8P0oSuzgblj0KAWXAkTjecdC3PgHm6NBR2UOanCORsRdFOv/UsWzdnm3tD
 z3CPcIj+r0FZabbkz0adU/ZVEBSiCVzh7iyv0h9Zim5nuWKu88SqMrL8Bg2aRjI6C/HB
 Sk7fRXw9siEH93JRYqaxfeh5czbWezB2jRdo8N9nVaJi4fQ2tmT+RdyQhFmZ7kuOLUui
 5JsA==
X-Received: by 10.204.183.204 with SMTP id ch12mr240437bkb.5.1367499646608;
 Thu, 02 May 2013 06:00:46 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.205.83.144 with HTTP; Thu, 2 May 2013 06:00:06 -0700 (PDT)
In-Reply-To: <CANhEzE6iCKy55i1ysRJYibcCwhcpoF6q3JFj7J4QjtkYkzRTTw@mail.gmail.com>
References: <CANhEzE6iCKy55i1ysRJYibcCwhcpoF6q3JFj7J4QjtkYkzRTTw@mail.gmail.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Thu, 2 May 2013 15:00:06 +0200
Message-ID: <CAPFanBF-S2o_wLDMWMsHyQjViD4T-1M6r4RSEnH3uZQmAQafqQ@mail.gmail.com>
To: Jeremie Dimino <jdimino@janestreet.com>
Content-Type: text/plain; charset=ISO-8859-1
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Raw representation of literals in the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 02 May 2013 12:51:21 -0000

I think it is very reasonable, and would be a good fit for Alain's branch.

On Thu, May 2, 2013 at 1:35 PM, Jeremie Dimino <jdimino@janestreet.com> wrote:
> Hi,
>
> We recently felt the need to write a new extension that would check
> integer literals.  The goal is to verify that ones containing
> underscores match a specific regular expression.  Namely digits are
> grouped by 3.
>
> We can do that for instance with a camlp4 token filter, but we wanted
> to try with ppx.  It is currently not possible to do it by looking at
> the parsetree since constants are already evaluated (integers are
> represented by an OCaml int) and the raw form is lost.
>
> One solution would be to add the raw representation of constants in
> the parsetree. For instance by changing Asttypes.constant to:
>
> ,----
> | type constant_value =
> |     Const_int of int
> |   | Const_char of char
> |   | Const_string of string
> |   | Const_float of string
> |   | Const_int32 of int32
> |   | Const_int64 of int64
> |   | Const_nativeint of nativeint
> |
> | type constant = constant_value * string
> `----
>
> I believe it could also be useful for other rewriters, especially ones
> dealing with strings since they would be able to compute the correct
> location inside a string. And maybe also for printing: Pprintast could
> use the representation choosed by the programmer instead of a
> standardized one.
>
> Do people thinks that this a reasonable thing to add to the OCaml
> parsetree? If yes I can do the modification.
>
> Jeremie
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From bobzhang1988@gmail.com  Thu May  2 14:30:47 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id CC2033C407
 for <wg-camlp4@lists.ocaml.org>; Thu,  2 May 2013 14:30:47 +0100 (BST)
X-Cam-SpamDetails: score -0.3 from SpamAssassin-3.3.2-1477933 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.180 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f180.google.com ([209.85.128.180]:52968)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UXtk5-0002Jq-8I (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 02 May 2013 14:40:14 +0100
Received: by mail-ve0-f180.google.com with SMTP id pa12so489625veb.11
 for <wg-camlp4@lists.ocaml.org>; Thu, 02 May 2013 06:40:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=v58+yThmM3Z/VMyNUsWyzdjECrfO8DPKVzKV01cTUAo=;
 b=Y9NJG53TRBlzQpfIXAr9cO6XkEyA8DF8MNYCANqf70OLo/6tz5VftRshcQ+ZZp5fdf
 XBeivyggrYT9HAi972qVpTIqmUs8YEhfEN8jB67Xbs86CCjlTT9GoQS7CejsNvqCcxr/
 Tjecd/lJLhamIZcgIwHM6/ftPKzHXlMRUYR28uRYK/1lYsGVsWEiCCdOSq4Fyxw64VSc
 ACp6oJDy8Y8O+JjU2NPUQQnUoYE5XvHyyohlCPvKMv5tXAQaWVCzLaTqki1t+grpe8x5
 UvtKZ8P+5pYQgQA6A3T/GtIJg9uahysfGvoCp2qD/WegGlrOCy+q9t+WWUiR5Dn7mLUr
 xo8w==
MIME-Version: 1.0
X-Received: by 10.52.228.129 with SMTP id si1mr1836407vdc.79.1367502012735;
 Thu, 02 May 2013 06:40:12 -0700 (PDT)
Sender: bobzhang1988@gmail.com
Received: by 10.220.68.198 with HTTP; Thu, 2 May 2013 06:40:12 -0700 (PDT)
In-Reply-To: <518216E0.1080007@lexifi.com>
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
 <518216E0.1080007@lexifi.com>
Date: Thu, 2 May 2013 09:40:12 -0400
X-Google-Sender-Auth: rgrlF8dx3I3k1HK9XV_9EjiBYmQ
Message-ID: <CANcqPu5nTiOyDjPmFn6za3m8og+9sBufamJN-jZmFYrYWP+yTA@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=089e01183fc4b2e8b204dbbc5f40
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Chapi Chapo <rixed@happyleptic.org>
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
 for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 02 May 2013 13:30:47 -0000

--089e01183fc4b2e8b204dbbc5f40
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

I would be very happy to see some killer applications written using
extension_point to be convinced that extension_point is awesome for
metaprogramming.

Currently, I am building a c code generation framework and continuing
jaked's work on ocamljs on top of Fan. I really learned a lot during the
development and did fix some bad designs of Fan, such a way of learning may
also benefit the design of extension_point.



On Thu, May 2, 2013 at 3:33 AM, Alain Frisch <alain.frisch@lexifi.com>wrote=
:

> Hi Gabriel,
>
> Thanks for the feedback.
>
> I think it is to be understood that -ppx and extension_point do not targe=
t
> "syntax extension in the small", as you say.  I'd go as far as to say tha=
t
> they are not really about "syntax extension", since the whole idea is not
> to touch the concrete syntax.  Compared to Camlp4, Camlp5 or Fan, indeed,
> we loose the ability to provide nice little convenient syntactic shortcut=
s,
> and for this reason, there will still be some space for those tools, for
> people actually interested in changing the concrete syntax (and accepting
> the price to pay for it, in particular having to adapt their editor mode)=
.
>  Luckily, I believe that most of the wide-spread current uses of Camlp4
> don't fall in this category where the syntactic compactness is the ultima=
te
> goal:
>
>   - code generation driven by type declaration;
>
>   - code instrumentation (=E0 la Bisect);
>
>   - macro/conditional compilation;
>
>   - monadic syntax (--> e.g. suggested syntax for lwt: let%W p =3D ...)
>
>   - custom pattern matching (bitstring, ulex).
>
>
> As a side note, I've recently changed the syntactic category accepted as
> arguments of attributes/extensions from expressions to structures, which
> are strictly more general (an expression is also syntactically a valid
> structure item, and thus a structure, in itself).
>
> It was also discussed, some time ago, to merge the syntactic categories o=
f
> expressions and patterns (patterns are already "almost" a sub-category of
> expressions).  This could have helped in your case (not for the "when"
> part, though).
>
>
> On 05/01/2013 04:44 PM, Gabriel Scherer wrote:
>
>> For the purpose of experimentation, I still decided to do an
>> implementation based on a horrible hack, namely using (the new syntax
>> for) string literals that had been presented as a way to get "foreign
>> language quotations" in this context, with the syntax [%matches {|
>> <patt> when <expr> |}]. I believe this course of action should be
>> discouraged; in particular, there is no proper error handling. It
>> seems that deploying extensions based on this principle would
>> constitute a regression from the current Camlp4 situation.
>>
>
>
> I know that you're allergic to this approach, but you could also have
> adopted the following syntax:
>
> {matches|<patt>|}
> {matches|<patt> when <expr>|}
>
> i.e. reusing syntax for an otherwise valid expression (a string literal).
>  Indeed, the "marker" for new string literals is kept in the Parsetree.
>  And those string literals have the nice property that a position within
> the string literal can be mapped to a location in the source code (just
> shift by N+2 characters, where N is the length of the string market, 7 in
> that case).  Indeed, no character within the string literal is interprete=
d
> in a special way (no escaping or special character) and whitespaces are n=
ot
> allowed around the marker.  This would support exact error reporting.
>
> Leo has proposed to provide a combined syntax for extension node +
> quotation. This would give a cleaner way, of course, compared to
> piggy-backing valid syntax.
>
>
>
> Alain
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listin=
fo/wg-camlp4>
>



--=20
-- Regards, Hongbo

--089e01183fc4b2e8b204dbbc5f40
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">I would be very happy to see some killer applications writ=
ten using extension_point to be convinced that extension_point is awesome f=
or metaprogramming.<div style><br></div><div style>Currently, I am building=
 a c code generation framework and continuing jaked&#39;s work on ocamljs o=
n top of Fan. I really learned a lot during the development and did fix som=
e bad designs of Fan, such a way of learning may also benefit the design of=
 extension_point.</div>
<div style><br></div></div><div class=3D"gmail_extra"><br><br><div class=3D=
"gmail_quote">On Thu, May 2, 2013 at 3:33 AM, Alain Frisch <span dir=3D"ltr=
">&lt;<a href=3D"mailto:alain.frisch@lexifi.com" target=3D"_blank">alain.fr=
isch@lexifi.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">Hi Gabriel,<br>
<br>
Thanks for the feedback.<br>
<br>
I think it is to be understood that -ppx and extension_point do not target =
&quot;syntax extension in the small&quot;, as you say. =A0I&#39;d go as far=
 as to say that they are not really about &quot;syntax extension&quot;, sin=
ce the whole idea is not to touch the concrete syntax. =A0Compared to Camlp=
4, Camlp5 or Fan, indeed, we loose the ability to provide nice little conve=
nient syntactic shortcuts, and for this reason, there will still be some sp=
ace for those tools, for people actually interested in changing the concret=
e syntax (and accepting the price to pay for it, in particular having to ad=
apt their editor mode). =A0Luckily, I believe that most of the wide-spread =
current uses of Camlp4 don&#39;t fall in this category where the syntactic =
compactness is the ultimate goal:<br>

<br>
=A0 - code generation driven by type declaration;<br>
<br>
=A0 - code instrumentation (=E0 la Bisect);<br>
<br>
=A0 - macro/conditional compilation;<br>
<br>
=A0 - monadic syntax (--&gt; e.g. suggested syntax for lwt: let%W p =3D ...=
)<br>
<br>
=A0 - custom pattern matching (bitstring, ulex).<br>
<br>
<br>
As a side note, I&#39;ve recently changed the syntactic category accepted a=
s arguments of attributes/extensions from expressions to structures, which =
are strictly more general (an expression is also syntactically a valid stru=
cture item, and thus a structure, in itself).<br>

<br>
It was also discussed, some time ago, to merge the syntactic categories of =
expressions and patterns (patterns are already &quot;almost&quot; a sub-cat=
egory of expressions). =A0This could have helped in your case (not for the =
&quot;when&quot; part, though).<div class=3D"im">
<br>
<br>
On 05/01/2013 04:44 PM, Gabriel Scherer wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
For the purpose of experimentation, I still decided to do an<br>
implementation based on a horrible hack, namely using (the new syntax<br>
for) string literals that had been presented as a way to get &quot;foreign<=
br>
language quotations&quot; in this context, with the syntax [%matches {|<br>
&lt;patt&gt; when &lt;expr&gt; |}]. I believe this course of action should =
be<br>
discouraged; in particular, there is no proper error handling. It<br>
seems that deploying extensions based on this principle would<br>
constitute a regression from the current Camlp4 situation.<br>
</blockquote>
<br>
<br></div>
I know that you&#39;re allergic to this approach, but you could also have a=
dopted the following syntax:<br>
<br>
{matches|&lt;patt&gt;|}<br>
{matches|&lt;patt&gt; when &lt;expr&gt;|}<br>
<br>
i.e. reusing syntax for an otherwise valid expression (a string literal). =
=A0Indeed, the &quot;marker&quot; for new string literals is kept in the Pa=
rsetree. =A0And those string literals have the nice property that a positio=
n within the string literal can be mapped to a location in the source code =
(just shift by N+2 characters, where N is the length of the string market, =
7 in that case). =A0Indeed, no character within the string literal is inter=
preted in a special way (no escaping or special character) and whitespaces =
are not allowed around the marker. =A0This would support exact error report=
ing.<br>

<br>
Leo has proposed to provide a combined syntax for extension node + quotatio=
n. This would give a cleaner way, of course, compared to piggy-backing vali=
d syntax.<span class=3D"HOEnZb"><font color=3D"#888888"><br>
<br>
<br>
<br>
Alain</font></span><div class=3D"HOEnZb"><div class=3D"h5"><br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo
</div>

--089e01183fc4b2e8b204dbbc5f40--

From alain@frisch.fr  Fri May  3 09:53:50 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1C9B23C087
 for <wg-camlp4@lists.ocaml.org>; Fri,  3 May 2013 09:53:50 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1478301 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:31177
 helo=msa.smtpout.orange.fr)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UYBtf-0005Qp-0J (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Fri, 03 May 2013 10:03:19 +0100
Received: from [192.168.1.106] ([81.249.36.236]) by mwinf5d65 with ME
 id XM3J1l00955hsoH03M3JNc; Fri, 03 May 2013 11:03:18 +0200
Message-ID: <51837D56.80506@frisch.fr>
Date: Fri, 03 May 2013 11:03:18 +0200
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:21.0) Gecko/20100101 Thunderbird/21.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>, 
 wg-camlp4@lists.ocaml.org
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
 <518216E0.1080007@lexifi.com>
In-Reply-To: <518216E0.1080007@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: rixed@happyleptic.org
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
 for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 03 May 2013 08:53:50 -0000

On 05/02/2013 09:33 AM, Alain Frisch wrote:
> {matches|<patt>|}
> {matches|<patt> when <expr>|}

Sorry, this would be:

{matches|<patt>|matches}
{matches|<patt> when <expr>|matches}


-- Alain

From lpw25@cam.ac.uk  Sat May  4 14:16:58 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C46833C087
 for <wg-camlp4@lists.ocaml.org>; Sat,  4 May 2013 14:16:58 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from 207-38-128-64.c3-0.avec-ubr2.nyr-avec.ny.cable.rcn.com
 ([207.38.128.64]:35740 helo=netbook)
 by ppsw-32.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1UYcTv-0002XG-0X (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@cam.ac.uk>); Sat, 04 May 2013 14:26:31 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
 <518216E0.1080007@lexifi.com>
Date: Sat, 04 May 2013 14:27:31 +0100
In-Reply-To: <518216E0.1080007@lexifi.com> (Alain Frisch's message of "Thu, 02
 May 2013 09:33:52 +0200")
Message-ID: <86li7udge4.fsf@cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org, rixed@happyleptic.org
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
	for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 04 May 2013 13:16:58 -0000

> As a side note, I've recently changed the syntactic category accepted as arguments of attributes/extensions from
> expressions to structures, which are strictly more general (an expression is also syntactically a valid structure item,
> and thus a structure, in itself).

I've been going through the uses of camlp4 in opam and recording how
each of their syntaxes could be adjusted to fit ppx. (I've been doing it
on and off for a few weeks, and am about half-way through them). One
group of extensions that would currently need quotations are those that
create types from other types. For example, the following quotation from
shcaml:

  <| seq: Line.present; source: Line.present >

this quotation is supposed to be a type expression, where the body of
the quotation is essentially an object type.

For cases like these, I thought it would be a good idea to change from
having expressions as bodies, to having the bodies be like a
simple type constraint:

  [%id expr : core_type]

where both the expression and the "constraint" are optional. This would
allow the example above to be represented as:

  [%line: < seq: Line.present; source: Line.present >]

Do you think that we could support this form as well as structures? If
not, did you have any specific cases that you wanted to use structures
for? I could imagine structures being useful for top-level extensions,
maybe we could have:

  [%%id struture]

and

  [%id expr : core_type]

From bobzhang1988@gmail.com  Sat May 11 14:53:16 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 998DC3CA1E
 for <wg-camlp4@lists.ocaml.org>; Sat, 11 May 2013 14:53:16 +0100 (BST)
X-Cam-SpamDetails: score 0.9 from SpamAssassin-3.3.2-1480936 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.174 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f174.google.com ([209.85.128.174]:63346)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UbAOF-0006Ac-hP (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Sat, 11 May 2013 15:03:13 +0100
Received: by mail-ve0-f174.google.com with SMTP id pb11so4603969veb.5
 for <wg-camlp4@lists.ocaml.org>; Sat, 11 May 2013 07:03:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:date:message-id:subject:from:to
 :content-type; bh=qSAsQL81hCZBKv8hIwYaXKCqPS4Sw1MTGYlI2midzbY=;
 b=G4kEFpxYI4/Nhpe6Pi9br2rYs/HJBzki5j8oKkwRy4ksCMdYc176hYCdZ/12K8ZJt+
 m6+fTVjNDey8WzQQ3EhnzOoNZLePvRcYDg0nkLKpJb/DXzEzLjwem1cvnA7jrrnCxf4W
 n8Lb3HgECIi6mTtca7bkszbK3QbpnXJZ648guFpH7qwG8xAm0CKuQ2BvR/uIRNXZb9m0
 V3s/2/EYnWm4ND6nLZyvldMoldAIwJdUOs4rAtgs8jFhy1h2l3jjAHzVaE6OMFaxoHHJ
 sExTT9OD0VIXBlbQyT0zq88UUQzTcJXXaiR5k2K7iS/MANZ2iAe3n4x/p/mOw6raVbIj
 mo5w==
MIME-Version: 1.0
X-Received: by 10.58.54.101 with SMTP id i5mr14006984vep.43.1368280990681;
 Sat, 11 May 2013 07:03:10 -0700 (PDT)
Received: by 10.220.68.198 with HTTP; Sat, 11 May 2013 07:03:10 -0700 (PDT)
Date: Sat, 11 May 2013 10:03:10 -0400
Message-ID: <CANcqPu7A-_0AqpPa2Em2JLAwQXTwNUd8H=m8EhP3bj+N_dprZw@mail.gmail.com>
From: Bob Zhang <bobzhang1988@gmail.com>
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: multipart/alternative; boundary=089e013a020e67208604dc71be6c
Subject: [wg-camlp4] nested quotation lexing problem?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 11 May 2013 13:53:16 -0000

--089e013a020e67208604dc71be6c
Content-Type: text/plain; charset=ISO-8859-1

Hi all,
   I have came across a nasty bug when lexing the nested quotations. I
would like to have your opinions about this problem.

   Sample 1:
   {:q|  "|}" |}
       Shall we accept this or reject it? the intuition is that this is a
legal quotation, however, if we treat the contents inside the quotation in
a verbatim way, this is illegal...
  Sample 2:
  {:q| '"' |}
     If we treat " inside the quotation specially, the quotation above
seems to be illegal (a non-terminated string).

   If we treat both ' and " inside quotation in a special way, which is
good in most cases, then we lose some use cases, for example, the contents
inside the quotation have to follow the same string char lexical convention
as OCaml.. what do you think?
-- 
Regards
-- Bob

--089e013a020e67208604dc71be6c
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><br clear=3D"all"><div style>Hi all,</div><div style>=A0 =
=A0I have came across a nasty bug when lexing the nested quotations. I woul=
d like to have your opinions about this problem.</div><div style><br></div>=
<div style>
=A0 =A0Sample 1:</div><div style>=A0 =A0{:q| =A0&quot;|}&quot; |}</div><div=
 style>=A0 =A0 =A0 =A0Shall we accept this or reject it? the intuition is t=
hat this is a legal quotation, however, if we treat the contents inside the=
 quotation in a verbatim way, this is illegal...</div>
<div style>=A0 Sample 2:</div><div style>=A0 {:q| &#39;&quot;&#39; |} =A0 =
=A0</div><div style>=A0 =A0 =A0If we treat &quot; inside the quotation spec=
ially, the quotation above seems to be illegal (a non-terminated string).</=
div><div style>
<br></div><div style>=A0 =A0If we treat both &#39; and &quot; inside quotat=
ion in a special way, which is good in most cases, then we lose some use ca=
ses, for example, the contents inside the quotation have to follow the same=
 string char lexical convention as OCaml.. what do you think?</div>
-- <br><div>Regards</div>-- Bob
</div>

--089e013a020e67208604dc71be6c--

From bobzhang1988@gmail.com  Sat May 11 14:56:48 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5F72F3CA1E
 for <wg-camlp4@lists.ocaml.org>; Sat, 11 May 2013 14:56:48 +0100 (BST)
X-Cam-SpamDetails: score 0.9 from SpamAssassin-3.3.2-1480936 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.171 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f171.google.com ([209.85.128.171]:48911)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UbARg-0000Lu-83 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Sat, 11 May 2013 15:06:44 +0100
Received: by mail-ve0-f171.google.com with SMTP id m1so1487575ves.2
 for <wg-camlp4@lists.ocaml.org>; Sat, 11 May 2013 07:06:43 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:content-type;
 bh=wUxjEzC3/DqG8mOCfCesbbZq5fzcEO/LkmDwAoQzysM=;
 b=a6SuaXXh8qHtstoTD5fzZmfyaJ/fd1Wki19pVq381kRg7tyztgSkM20bGjnpXcK00A
 u9IPfxH8q9xHgqSZfpDml5n2PotRYa7HcQ6T84Xy7jvYGEVxx2G3EjBy5MV7BGne3unY
 2nzB57YS/39DAsScYntQb2s9j+44m3vkRGjQvEIOku8fdzjtnAVl2vEnKkIekRltA4G3
 lEcSxufutaCNZKz9EMAHs0/hZTls6zKoW7cHoHyPCtvbvFnsGnZYRjcWcIHubKLlo6DA
 hvWQKYtgZ0xsc1zKG+3TvZQHi0VbPAvzIRUX1FtJaBA1Osa40PZJ01F/7TX0mQMKSaXg
 o7yw==
MIME-Version: 1.0
X-Received: by 10.52.182.71 with SMTP id ec7mr11620463vdc.64.1368281203816;
 Sat, 11 May 2013 07:06:43 -0700 (PDT)
Received: by 10.220.68.198 with HTTP; Sat, 11 May 2013 07:06:43 -0700 (PDT)
In-Reply-To: <CANcqPu7A-_0AqpPa2Em2JLAwQXTwNUd8H=m8EhP3bj+N_dprZw@mail.gmail.com>
References: <CANcqPu7A-_0AqpPa2Em2JLAwQXTwNUd8H=m8EhP3bj+N_dprZw@mail.gmail.com>
Date: Sat, 11 May 2013 10:06:43 -0400
Message-ID: <CANcqPu61nnGG9fkCuXdjZr=Wzra2Xtn1NRNRRHKhDOPY4Y5vXw@mail.gmail.com>
From: Bob Zhang <bobzhang1988@gmail.com>
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: multipart/alternative; boundary=bcaec548a5e11b3ed304dc71cbd6
Subject: Re: [wg-camlp4] nested quotation lexing problem?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 11 May 2013 13:56:48 -0000

--bcaec548a5e11b3ed304dc71cbd6
Content-Type: text/plain; charset=ISO-8859-1

Sorry, the outlook of second sample is a bit ambiguous, its a char `"'
between`''  and `''


On Sat, May 11, 2013 at 10:03 AM, Bob Zhang <bobzhang1988@gmail.com> wrote:

>
> Hi all,
>    I have came across a nasty bug when lexing the nested quotations. I
> would like to have your opinions about this problem.
>
>    Sample 1:
>    {:q|  "|}" |}
>        Shall we accept this or reject it? the intuition is that this is a
> legal quotation, however, if we treat the contents inside the quotation in
> a verbatim way, this is illegal...
>   Sample 2:
>   {:q| '"' |}
>      If we treat " inside the quotation specially, the quotation above
> seems to be illegal (a non-terminated string).
>
>    If we treat both ' and " inside quotation in a special way, which is
> good in most cases, then we lose some use cases, for example, the contents
> inside the quotation have to follow the same string char lexical convention
> as OCaml.. what do you think?
> --
> Regards
> -- Bob
>



-- 
Regards
-- Bob

--bcaec548a5e11b3ed304dc71cbd6
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Sorry, the outlook of second sample is a bit=A0ambiguous, =
its a char `&quot;&#39; between`&#39;&#39; =A0and `&#39;&#39;</div><div cla=
ss=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Sat, May 11, 2013 =
at 10:03 AM, Bob Zhang <span dir=3D"ltr">&lt;<a href=3D"mailto:bobzhang1988=
@gmail.com" target=3D"_blank">bobzhang1988@gmail.com</a>&gt;</span> wrote:<=
br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div dir=3D"ltr"><br clear=3D"all"><div>Hi a=
ll,</div><div>=A0 =A0I have came across a nasty bug when lexing the nested =
quotations. I would like to have your opinions about this problem.</div>
<div><br></div><div>
=A0 =A0Sample 1:</div><div>=A0 =A0{:q| =A0&quot;|}&quot; |}</div><div>=A0 =
=A0 =A0 =A0Shall we accept this or reject it? the intuition is that this is=
 a legal quotation, however, if we treat the contents inside the quotation =
in a verbatim way, this is illegal...</div>

<div>=A0 Sample 2:</div><div>=A0 {:q| &#39;&quot;&#39; |} =A0 =A0</div><div=
>=A0 =A0 =A0If we treat &quot; inside the quotation specially, the quotatio=
n above seems to be illegal (a non-terminated string).</div><div>
<br></div><div>=A0 =A0If we treat both &#39; and &quot; inside quotation in=
 a special way, which is good in most cases, then we lose some use cases, f=
or example, the contents inside the quotation have to follow the same strin=
g char lexical convention as OCaml.. what do you think?</div>
<span class=3D"HOEnZb"><font color=3D"#888888">
-- <br><div>Regards</div>-- Bob
</font></span></div>
</blockquote></div><br><br clear=3D"all"><div><br></div>-- <br><div>Regards=
</div>-- Bob
</div>

--bcaec548a5e11b3ed304dc71cbd6--

From wojciech.meyer@gmail.com  Sat May 11 15:32:37 2013
Return-Path: <wojciech.meyer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id BAD643CA1E
 for <wg-camlp4@lists.ocaml.org>; Sat, 11 May 2013 15:32:37 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1480936 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.50 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (wojciech.meyer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f50.google.com ([74.125.82.50]:57926)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UbB0M-0007Jv-6W (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <wojciech.meyer@gmail.com>); Sat, 11 May 2013 15:42:34 +0100
Received: by mail-wg0-f50.google.com with SMTP id m15so4814045wgh.17
 for <wg-camlp4@lists.ocaml.org>; Sat, 11 May 2013 07:42:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=x-received:from:to:cc:subject:references:date:in-reply-to
 :message-id:user-agent:mime-version:content-type
 :content-transfer-encoding;
 bh=GP90Lx6xydehCpAjjyRT0VgjxJMELUEKKh5iR6jwtOo=;
 b=gNaBKFJbXG6MN4+W+GKw2QYld/p8mWHXb7JfqohFm0k/3uxFj2lFMLopfxJbLeU0ay
 EQ280IPmcuYcdvW6Ej/AVBQvPf2eaXxVQDFWjTvwM9erZCC2g80sQpCObv9voXgzpz+o
 9ETUd808aUqYwz1sg8LyUMpGZhsKKlFUq8/zq/Ro6KKZG75bnkoOVhz5iiHSoIKDxwnh
 VX2D3xeDQ0fnPiFpHNDlEOH0MhMxih4dzCB2kyhN4r4QBReWGjDfIlRzphfX0jnDIl9v
 9hPoSEcgTJ7jq3VjYBQXA1JAlfscgcLAnvXwAVtA4cDW3OftcUE55t/hqFI8mvsopnwZ
 7uFg==
X-Received: by 10.194.109.103 with SMTP id hr7mr25108104wjb.0.1368283353757;
 Sat, 11 May 2013 07:42:33 -0700 (PDT)
Received: from spec-desktop.danmey.org
 (cpc2-cmbg12-0-0-cust796.5-4.cable.virginmedia.com. [86.9.203.29])
 by mx.google.com with ESMTPSA id a4sm4544235wic.5.2013.05.11.07.42.31
 for <multiple recipients>
 (version=TLSv1.1 cipher=RC4-SHA bits=128/128);
 Sat, 11 May 2013 07:42:32 -0700 (PDT)
From: Wojciech Meyer <wojciech.meyer@gmail.com>
To: Bob Zhang <bobzhang1988@gmail.com>
References: <CANcqPu7A-_0AqpPa2Em2JLAwQXTwNUd8H=m8EhP3bj+N_dprZw@mail.gmail.com>
Date: Sat, 11 May 2013 15:42:34 +0100
In-Reply-To: <CANcqPu7A-_0AqpPa2Em2JLAwQXTwNUd8H=m8EhP3bj+N_dprZw@mail.gmail.com>
 (Bob Zhang's message of "Sat, 11 May 2013 10:03:10 -0400")
Message-ID: <wfhai9zig5.fsf@gmail.com>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/24.2 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] nested quotation lexing problem?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 11 May 2013 14:32:37 -0000

Hi,

Bob Zhang <bobzhang1988@gmail.com> writes:

> =C2=A0 =C2=A0Sample 1:
> =C2=A0 =C2=A0{:q| =C2=A0"|}" |}
> =C2=A0 =C2=A0 =C2=A0 =C2=A0Shall we accept this or reject it? the intuiti=
on is that this
> is a legal quotation, however, if we treat the contents inside the
> quotation in a verbatim way, this is illegal...

I think quotation engine should lex something in between quotes as a
string, therefore I believe it ought to be accepted. From what I can
think, " pair is already so special that it makes sense to lex it always
as string. It might be a bit more difficult to do, but I think it's
worth.

> =C2=A0 Sample 2:
> =C2=A0 {:q| '"' |} =C2=A0 =C2=A0
> =C2=A0 =C2=A0 =C2=A0If we treat " inside the quotation specially, the quo=
tation above
> seems to be illegal (a non-terminated string).

Again pair of ' is also special, and the lexer should be aware always
about this.

> =C2=A0 =C2=A0If we treat both ' and " inside quotation in a special way, =
which
> is good in most cases, then we lose some use cases, for example, the
> contents inside the quotation have to follow the same string char
> lexical convention as OCaml.. what do you think?

I'd make it following OCaml convention, but also make it plugable so the
user can choose how to lex the contents, because string can contain
arbitrary text, and I've never seen a computer language that had
different delimiters (apart from Python ''') so it all makes sense. On
other hand allowing strings between other delimiters would be good to.

Now it's time to say, you would love how the PEG packrat parses, because
it does not have lexing pass so you would not have this problem. (but
has some slightly different).

Wojciech

From bobzhang1988@gmail.com  Sat May 11 15:58:55 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0CAE73CA1E
 for <wg-camlp4@lists.ocaml.org>; Sat, 11 May 2013 15:58:55 +0100 (BST)
X-Cam-SpamDetails: score 0.9 from SpamAssassin-3.3.2-1480936 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.52 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f52.google.com ([209.85.212.52]:50939)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UbBPm-0000iB-3D (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Sat, 11 May 2013 16:08:51 +0100
Received: by mail-vb0-f52.google.com with SMTP id p13so4163331vbe.39
 for <wg-camlp4@lists.ocaml.org>; Sat, 11 May 2013 08:08:50 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:x-received:in-reply-to:references:date:message-id
 :subject:from:to:cc:content-type;
 bh=Uw86AnQQCv2Z7/osRg7fUQ2Eip/XUzQxKZtm1+Fnd9I=;
 b=NICf+kLo34Zr1wAjN9IXSdTQMtsMM7gqEtdlZ2U90b4q3w73tLIhbBqNC9uTojm0s1
 J7q3kF3sqCrsMndBvCLAnXWRJ4M9BzVNPs18JwfikFQh7vmyIKEvolXmu3/WPKYJ66cr
 yOMJD6XcKoC2NFy7HKSuStpI/J04WKx0es2Gt4Heiz7rIOlOv6RGrvBaDrxIdk4x1T7V
 DEMqb4yCahCfS3vFcXrcTQqnUMX6Ft4h5dosSqGD1tlXRj5RuEGZQVKHuzs+gArnXAXv
 GXrFHhXGXsC16DjKNEHsJQKjX5jnO4HqSMyXrLFt3nvjJvV18r9+AdoRbMF906JC5tz3
 Altw==
MIME-Version: 1.0
X-Received: by 10.220.215.73 with SMTP id hd9mr14264104vcb.19.1368284930314;
 Sat, 11 May 2013 08:08:50 -0700 (PDT)
Received: by 10.220.68.198 with HTTP; Sat, 11 May 2013 08:08:50 -0700 (PDT)
In-Reply-To: <wfhai9zig5.fsf@gmail.com>
References: <CANcqPu7A-_0AqpPa2Em2JLAwQXTwNUd8H=m8EhP3bj+N_dprZw@mail.gmail.com>
 <wfhai9zig5.fsf@gmail.com>
Date: Sat, 11 May 2013 11:08:50 -0400
Message-ID: <CANcqPu60nHQ7YOxpaTTa=5gqFjf+1xQiU3597yjgOD_SwwSVLg@mail.gmail.com>
From: Bob Zhang <bobzhang1988@gmail.com>
To: Wojciech Meyer <wojciech.meyer@gmail.com>
Content-Type: multipart/alternative; boundary=bcaec54ee374391deb04dc72a90f
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] nested quotation lexing problem?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 11 May 2013 14:58:55 -0000

--bcaec54ee374391deb04dc72a90f
Content-Type: text/plain; charset=ISO-8859-1

Hi,


On Sat, May 11, 2013 at 10:42 AM, Wojciech Meyer
<wojciech.meyer@gmail.com>wrote:

> Hi,
>
> I'd make it following OCaml convention, but also make it plugable so the
> user can choose how to lex the contents, because string can contain
> arbitrary text, and I've never seen a computer language that had
> different delimiters (apart from Python ''') so it all makes sense. On
> other hand allowing strings between other delimiters would be good to.
>
> Yes, I think the requirement  for the string convention is reasonable, but
the requirement for char convention is a bit loose. So,
   {:q| "|}" |} (* accepted*)
   {:q| '"' |}  (* accepted *)
   {:q| '     '  |} (* accepted as well, the char check is intended to be
loose *)

Now even the lexer generator is embedded in Fan and bootstrapped by Fan
itself,
check out :
 https://github.com/bobzhang/Fan/blob/master/src/FLexer.ml

The advantaged compared with ocamllex is that it works in toplevel :-)


> Now it's time to say, you would love how the PEG packrat parses, because
> it does not have lexing pass so you would not have this problem. (but
> has some slightly different).
>
> Wojciech
>



-- 
Regards
-- Bob

--bcaec54ee374391deb04dc72a90f
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Hi,<div class=3D"gmail_extra"><br><br><div class=3D"gmail_=
quote">On Sat, May 11, 2013 at 10:42 AM, Wojciech Meyer <span dir=3D"ltr">&=
lt;<a href=3D"mailto:wojciech.meyer@gmail.com" target=3D"_blank">wojciech.m=
eyer@gmail.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-=
left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;p=
adding-left:1ex">Hi,<br>
<div class=3D"im"><br></div>I&#39;d make it following OCaml convention, but=
 also make it plugable so the<br>
user can choose how to lex the contents, because string can contain<br>
arbitrary text, and I&#39;ve never seen a computer language that had<br>
different delimiters (apart from Python &#39;&#39;&#39;) so it all makes se=
nse. On<br>
other hand allowing strings between other delimiters would be good to.<br>
<br></blockquote><div style>Yes, I think the requirement =A0for the string =
convention is reasonable, but the requirement for char convention is a bit =
loose. So,</div><div style>=A0 =A0{:q| &quot;|}&quot; |} (* accepted*)</div=
>
<div style>=A0 =A0{:q| &#39;&quot;&#39; |} =A0(* accepted *)</div><div styl=
e>=A0 =A0{:q| &#39; =A0 =A0 &#39; =A0|} (* accepted as well, the char check=
 is intended to be loose *)</div><div style><br></div><div style>Now even t=
he lexer generator is embedded in Fan and bootstrapped by Fan itself,=A0</d=
iv>
<div style>check out :</div><div style>=A0<a href=3D"https://github.com/bob=
zhang/Fan/blob/master/src/FLexer.ml">https://github.com/bobzhang/Fan/blob/m=
aster/src/FLexer.ml</a></div><div style><br></div><div style>The advantaged=
 compared with ocamllex is that it works in toplevel :-)</div>
<div style>=A0 =A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0=
px 0px 0px 0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);b=
order-left-style:solid;padding-left:1ex">
Now it&#39;s time to say, you would love how the PEG packrat parses, becaus=
e<br>
it does not have lexing pass so you would not have this problem. (but<br>
has some slightly different).<br>
<span class=3D""><font color=3D"#888888"><br>
Wojciech<br>
</font></span></blockquote></div><br><br clear=3D"all"><div><br></div>-- <b=
r><div>Regards</div>-- Bob
</div></div>

--bcaec54ee374391deb04dc72a90f--

From alain.frisch@lexifi.com  Mon May 13 12:35:50 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B29ED3C555
 for <wg-camlp4@lists.ocaml.org>; Mon, 13 May 2013 12:35:50 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1481494 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:38494
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UbrCS-00055p-9D (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 13 May 2013 12:45:53 +0100
Received: from [192.168.1.108] ([92.151.33.108]) by mwinf5d25 with ME
 id bPlr1l00L2KynzQ03Plrgm; Mon, 13 May 2013 13:45:52 +0200
Message-ID: <5190D26D.30000@lexifi.com>
Date: Mon, 13 May 2013 13:45:49 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:21.0) Gecko/20100101 Thunderbird/21.0
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>	<518216E0.1080007@lexifi.com>
 <86li7udge4.fsf@cam.ac.uk>
In-Reply-To: <86li7udge4.fsf@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, rixed@happyleptic.org
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
 for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 13 May 2013 11:35:50 -0000

On 05/04/2013 03:27 PM, Leo White wrote:
> I've been going through the uses of camlp4 in opam and recording how
> each of their syntaxes could be adjusted to fit ppx. (I've been doing it
> on and off for a few weeks, and am about half-way through them). One
> group of extensions that would currently need quotations are those that
> create types from other types. For example, the following quotation from
> shcaml:
>
>    <| seq: Line.present; source: Line.present >
>
> this quotation is supposed to be a type expression, where the body of
> the quotation is essentially an object type.

Possible syntaxes:

  [%sh (seq: Line.present); (source: Line.present)]

  < seq: Line.present; source: Line.present > [@sh]

  [%sh] * < seq: Line.present; source: Line.present >

But, in that specific case, is the syntactic sugar worthwhile at all? 
Reading the shcaml documentation 
(http://www.eecs.harvard.edu/~tov/code/shcaml/doc/),  I can see this 
syntax used only in inferred types, and not documented.  Do the users 
really need to write those types?

Can you give other examples of these extensions which would benefit from 
the ability to use type expressions as arguments of extensions or 
attributes?

> For cases like these, I thought it would be a good idea to change from
> having expressions as bodies, to having the bodies be like a
> simple type constraint:
>
>    [%id expr : core_type]
>
> where both the expression and the "constraint" are optional.

Just to be sure that I understand your proposal correctly, you would 
support:

   expr
   expr : core_type
   : core_type

Do you have concrete examples where the second form would be nice? 
(Adding parentheses makes it a valid expression anyway.)

Gabriel reported a case (pa_matches) where allowing patterns (and also 
patterns with a "when" guard) would be useful as well.  Would you 
suggest to allow patterns (with a dedicated syntax) as well?

> Do you think that we could support this form as well as structures?  If
> not, did you have any specific cases that you wanted to use structures
> for?

In addition to top-level extensions and a more natural support for empty 
arguments (the empty structure), I can imagine a general form
of "local structure items":

   let [%local STR] = () in e
====>
   let module LOCAL001 = struct STR let res = e end in
   LOCAL001.res

to allow, for instance:

  let [%local exception M] = () in
  ....

  let [%local type t = {x: int; y: string}] = () in
  ....




Alain

From lpw25@cam.ac.uk  Tue May 14 11:39:31 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 72D013CA17
 for <wg-camlp4@lists.ocaml.org>; Tue, 14 May 2013 11:39:31 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:45229)
 by ppsw-52.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1UcCnZ-0006cF-D1 (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@cam.ac.uk>); Tue, 14 May 2013 11:49:37 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
 <518216E0.1080007@lexifi.com> <86li7udge4.fsf@cam.ac.uk>
 <5190D26D.30000@lexifi.com>
Date: Tue, 14 May 2013 11:49:36 +0100
In-Reply-To: <5190D26D.30000@lexifi.com> (Alain Frisch's message of "Mon, 13
 May 2013 13:45:49 +0200")
Message-ID: <87vc6ln8e7.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org, rixed@happyleptic.org
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
	for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 14 May 2013 10:39:31 -0000

> Possible syntaxes:
>
>  [%sh (seq: Line.present); (source: Line.present)]

This won't work, because you need to be able to replace Line.present
with an arbitrary type expression.

>  < seq: Line.present; source: Line.present > [@sh]

This isn't an extension node, so may be silently ignored.

>  [%sh] * < seq: Line.present; source: Line.present >

This doesn't make it clear that "< seq: Line.present; source:
Line.present >" is not actually an object type, but an argument to the
sh extension.

> But, in that specific case, is the syntactic sugar worthwhile at all? Reading the shcaml documentation
> (http://www.eecs.harvard.edu/~tov/code/shcaml/doc/),  I can see this syntax used only in inferred types, and not
> documented.  Do the users really need to write those types?

I don't really know about that specific example. It looks a bit like the
syntax extension was never really deployed for users.

> Can you give other examples of these extensions which would benefit from the ability to use type expressions as
> arguments of extensions or attributes?

Not off the top of my head, but I would have thought that extension
nodes in type expressions would often want to be built from other type
expressions, and there is no easy way to do that at the moment.

> Just to be sure that I understand your proposal correctly, you would support:
>
>   expr
>   expr : core_type
>   : core_type
>
> Do you have concrete examples where the second form would be nice? (Adding parentheses makes it a valid expression
> anyway.)

I see two uses:

i) Type extensions that take some arguments that are not types:

  [%foo true: 'a list] list

ii) Extensions that define values (although in this case the extra
brackets are fine):

  [%def foo : int list]

> Gabriel reported a case (pa_matches) where allowing patterns (and also patterns with a "when" guard) would be useful as
> well.  Would you suggest to allow patterns (with a dedicated syntax) as well?

So far, I've found that (with the exception of Gabriel's extension)
pattern extensions can be easily changed into "match" and "let"
extensions:

  match%ext foo with
    Pattern _ [@ext transform] -> ...
  | ...

>> Do you think that we could support this form as well as structures?  If
>> not, did you have any specific cases that you wanted to use structures
>> for?
>
> In addition to top-level extensions and a more natural support for empty arguments (the empty structure), I can imagine
> a general form
> of "local structure items":
>
>   let [%local STR] = () in e
> ====>
>   let module LOCAL001 = struct STR let res = e end in
>   LOCAL001.res
>
> to allow, for instance:
>
>  let [%local exception M] = () in
>  ....
>
>  let [%local type t = {x: int; y: string}] = () in
>  ....
>

I suspect that this specific extension is a very unusual case, and it
would be better integrated into the language proper.

From alain.frisch@lexifi.com  Tue May 14 12:55:16 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B8E073C508
 for <wg-camlp4@lists.ocaml.org>; Tue, 14 May 2013 12:55:16 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1481731 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:43594
 helo=msa.smtpout.orange.fr)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UcDyr-00066I-EZ (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 14 May 2013 13:05:22 +0100
Received: from [192.168.1.108] ([92.151.119.16]) by mwinf5d61 with ME
 id bo5L1l0090MK2Vo03o5LtG; Tue, 14 May 2013 14:05:21 +0200
Message-ID: <51922883.7030009@lexifi.com>
Date: Tue, 14 May 2013 14:05:23 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:21.0) Gecko/20100101 Thunderbird/21.0
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>	<518216E0.1080007@lexifi.com>
 <86li7udge4.fsf@cam.ac.uk>	<5190D26D.30000@lexifi.com>
 <87vc6ln8e7.fsf@kingston.cl.cam.ac.uk>
In-Reply-To: <87vc6ln8e7.fsf@kingston.cl.cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, rixed@happyleptic.org
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
 for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 14 May 2013 11:55:16 -0000

On 05/14/2013 12:49 PM, Leo White wrote:
>> Possible syntaxes:
>>
>>   [%sh (seq: Line.present); (source: Line.present)]
>
> This won't work, because you need to be able to replace Line.present
> with an arbitrary type expression.

Well, it would work with this syntax, wouldn't it?

>>   < seq: Line.present; source: Line.present > [@sh]
>
> This isn't an extension node, so may be silently ignored.
>
>>   [%sh] * < seq: Line.present; source: Line.present >
>
> This doesn't make it clear that "< seq: Line.present; source:
> Line.present >" is not actually an object type, but an argument to the
> sh extension.

 From a superficial reading, it seems that this is really an object 
type, where some fields are implicit.

>> But, in that specific case, is the syntactic sugar worthwhile at all? Reading the shcaml documentation
>> (http://www.eecs.harvard.edu/~tov/code/shcaml/doc/),  I can see this syntax used only in inferred types, and not
>> documented.  Do the users really need to write those types?
>
> I don't really know about that specific example. It looks a bit like the
> syntax extension was never really deployed for users.
>
>> Can you give other examples of these extensions which would benefit from the ability to use type expressions as
>> arguments of extensions or attributes?
>
> Not off the top of my head, but I would have thought that extension
> nodes in type expressions would often want to be built from other type
> expressions, and there is no easy way to do that at the moment.

We should probably wait for more widely used examples of extensions 
which would benefit from "type expressions" as arguments.  Of course, 
it's always possible to write:

   [%sh ((): type_expr)]

>
>> Just to be sure that I understand your proposal correctly, you would support:
>>
>>    expr
>>    expr : core_type
>>    : core_type
>>
>> Do you have concrete examples where the second form would be nice? (Adding parentheses makes it a valid expression
>> anyway.)
>
> I see two uses:
>
> i) Type extensions that take some arguments that are not types:
>
>    [%foo true: 'a list] list

Do you know any actual such extensions?   One can also imagine 
extensions expecting several types are arguments, or a combination of 
types, patterns, etc.  All can be encoded, with more or less syntactic 
overhead inside expressions.  Hard-coding better support for some 
specific cases should be motivated by real examples.

>> of "local structure items":
>>
>>    let [%local STR] = () in e
>> ====>
>>    let module LOCAL001 = struct STR let res = e end in
>>    LOCAL001.res
>>
>> to allow, for instance:
>>
>>   let [%local exception M] = () in
>>   ....
>>
>>   let [%local type t = {x: int; y: string}] = () in
>>   ....
>>
>
> I suspect that this specific extension is a very unusual case, and it
> would be better integrated into the language proper.

( http://caml.inria.fr/mantis/view.php?id=5955 )


-- Alain

From lpw25@cam.ac.uk  Tue May 14 17:25:26 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 929713C508
 for <wg-camlp4@lists.ocaml.org>; Tue, 14 May 2013 17:25:26 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from kingston.cl.cam.ac.uk ([128.232.64.15]:45411)
 by ppsw-52.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1UcICK-0006q5-Fy (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@cam.ac.uk>); Tue, 14 May 2013 17:35:32 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
 <518216E0.1080007@lexifi.com> <86li7udge4.fsf@cam.ac.uk>
 <5190D26D.30000@lexifi.com> <87vc6ln8e7.fsf@kingston.cl.cam.ac.uk>
 <51922883.7030009@lexifi.com>
Date: Tue, 14 May 2013 17:35:32 +0100
In-Reply-To: <51922883.7030009@lexifi.com> (Alain Frisch's message of "Tue, 14
 May 2013 14:05:23 +0200")
Message-ID: <878v3hmsdn.fsf@kingston.cl.cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: wg-camlp4@lists.ocaml.org, rixed@happyleptic.org
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
	for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 14 May 2013 16:25:26 -0000

>>> Possible syntaxes:
>>>
>>>   [%sh (seq: Line.present); (source: Line.present)]
>>
>> This won't work, because you need to be able to replace Line.present
>> with an arbitrary type expression.
>
> Well, it would work with this syntax, wouldn't it?

You're right. I did not read the example closely enough.

>> This doesn't make it clear that "< seq: Line.present; source:
>> Line.present >" is not actually an object type, but an argument to the
>> sh extension.
>
> From a superficial reading, it seems that this is really an object type, where some fields are implicit.

Probably, I haven't looked at it too closely, but my point was that 

  < seq: Line.present; source: Line.present > 

was not being used as the object type 

  < seq: Line.present; source: Line.present >

but as an argument to an extension (which happens to produce a
*different* object type).

>
> We should probably wait for more widely used examples of extensions which would benefit from "type expressions" as
> arguments.  Of course, it's always possible to write:
>
>   [%sh ((): type_expr)]
>

Fair enough, although there is an argument that such extensions will not be
written if the syntax doesn't support them well.

From jdimino@janestreet.com  Thu May 23 16:16:07 2013
Return-Path: <jdimino@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id EDA0E3CBF9
 for <wg-camlp4@lists.ocaml.org>; Thu, 23 May 2013 16:16:06 +0100 (BST)
X-Cam-SpamDetails: score -1.0 from SpamAssassin-3.3.2-1485119 
 * -1.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:58446
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UfXPZ-0002A7-1C (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <jdimino@janestreet.com>); Thu, 23 May 2013 16:26:43 +0100
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <jdimino@janestreet.com>) id 1UfXPE-00067X-NN
 for wg-camlp4@lists.ocaml.org; Thu, 23 May 2013 11:26:16 -0400
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <jdimino@janestreet.com>) id 1UfXPE-00025F-Md
 for wg-camlp4@lists.ocaml.org; Thu, 23 May 2013 11:26:16 -0400
Received: from mail-ie0-f176.google.com ([209.85.223.176])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <jdimino@janestreet.com>) id 1UfXPE-0001cQ-Jq
 for wg-camlp4@lists.ocaml.org; Thu, 23 May 2013 11:26:16 -0400
Received: by mail-ie0-f176.google.com with SMTP id at1so8797501iec.7
 for <wg-camlp4@lists.ocaml.org>; Thu, 23 May 2013 08:26:16 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type;
 bh=nOQ2B9v9e+Nfdfyt4Iy8a0AS8Bj27g5hy/hhkrWBfxE=;
 b=KHnBykVuwcuIqPwF9IFn3ZoMTf1W3y8cm63TuNNNo/0r2p8J/9edxKhJu2ZaVpyKyy
 EIacm7fx9NtecLXWUMPfIwHiZLOBe75BKbxbFgIkqzzL1GW17MOagEibqbzRS9Sushld
 Wrs1CPbBjHw9MVYxtePJRtup9IS77Q+aZ8qr8=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type:x-gm-message-state;
 bh=nOQ2B9v9e+Nfdfyt4Iy8a0AS8Bj27g5hy/hhkrWBfxE=;
 b=h3ekM0FKb9eDHMm9JV+1c+DMb1y+i7XVCZDzLfIn8DIpnFbBHNbFbKB4DoSJdxSB5U
 d0p37XvoL/HJvZV8UxnfU6GLk2mlpSAElAp5hszionGCejiJu3gsyQOsl47Tba1/kZCO
 xq971jyn04Mn2qYxASN5SOafSwDZXZzm4R6BIFGRcEXd4gxLNa9CyEn9YNsJ1fXj+pK0
 fpEpe4UAAAH5VEbJrDI2Pvm1jXdiWHabNONV+CU5vv5PQ+jUmubOntNfqyGpIk4q+4O9
 W8groOnyQSXOdf2MMOVBUW5kIyp1SEO1B58xB4sKAH8003dm1cg6SdqhtsY4neUv/ARD
 AbUg==
X-Received: by 10.43.93.1 with SMTP id bs1mr2499628icc.18.1369322776275;
 Thu, 23 May 2013 08:26:16 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.43.93.1 with SMTP id bs1mr2499619icc.18.1369322776160; Thu,
 23 May 2013 08:26:16 -0700 (PDT)
Received: by 10.50.159.229 with HTTP; Thu, 23 May 2013 08:26:16 -0700 (PDT)
In-Reply-To: <CAPFanBF-S2o_wLDMWMsHyQjViD4T-1M6r4RSEnH3uZQmAQafqQ@mail.gmail.com>
References: <CANhEzE6iCKy55i1ysRJYibcCwhcpoF6q3JFj7J4QjtkYkzRTTw@mail.gmail.com>
 <CAPFanBF-S2o_wLDMWMsHyQjViD4T-1M6r4RSEnH3uZQmAQafqQ@mail.gmail.com>
Date: Thu, 23 May 2013 16:26:16 +0100
Message-ID: <CANhEzE669gfDxfFwaJ+x-1rNhU3qy6wAqsxqP7L0SAjS-RezLw@mail.gmail.com>
From: Jeremie Dimino <jdimino@janestreet.com>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQnrjBNP407jqv8X0mWbM/IwKfRkV0IrUCOI0US27d+xHpOzFxo2yyHFylviKnqJ8v5W6bgAuDb8pfoFVfPt0RUASSIxyjht33qmR5qi1AsMhMwrXcLIM81NR8rs9eXGlPdnUICJNkP7dp145FoUQ3Vg1sV8XA==
Cc: wg-camlp4@lists.ocaml.org
Subject: Re: [wg-camlp4] Raw representation of literals in the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 23 May 2013 15:16:07 -0000

We discussed it further with Alain but it turns out it doesn't work
very well.  A constant may be composed of several tokens so it is not
possible to have the exact raw representation.  And for strings one
can use the new quoted strings which are already treated as raw
strings.

Another possibility would be to modify the lexer so that it doesn't
'evaluate' tokens immediately and let the parser do it.  At least it
would avoid this kind of thing:

  # max_int;;
  - : int = 4611686018427387903
  # 4611686018427387904;;
  - : int = -4611686018427387904

On Thu, May 2, 2013 at 2:00 PM, Gabriel Scherer
<gabriel.scherer@gmail.com> wrote:
> I think it is very reasonable, and would be a good fit for Alain's branch.
>
> On Thu, May 2, 2013 at 1:35 PM, Jeremie Dimino <jdimino@janestreet.com> wrote:
>> Hi,
>>
>> We recently felt the need to write a new extension that would check
>> integer literals.  The goal is to verify that ones containing
>> underscores match a specific regular expression.  Namely digits are
>> grouped by 3.
>>
>> We can do that for instance with a camlp4 token filter, but we wanted
>> to try with ppx.  It is currently not possible to do it by looking at
>> the parsetree since constants are already evaluated (integers are
>> represented by an OCaml int) and the raw form is lost.
>>
>> One solution would be to add the raw representation of constants in
>> the parsetree. For instance by changing Asttypes.constant to:
>>
>> ,----
>> | type constant_value =
>> |     Const_int of int
>> |   | Const_char of char
>> |   | Const_string of string
>> |   | Const_float of string
>> |   | Const_int32 of int32
>> |   | Const_int64 of int64
>> |   | Const_nativeint of nativeint
>> |
>> | type constant = constant_value * string
>> `----
>>
>> I believe it could also be useful for other rewriters, especially ones
>> dealing with strings since they would be able to compute the correct
>> location inside a string. And maybe also for printing: Pprintast could
>> use the representation choosed by the programmer instead of a
>> standardized one.
>>
>> Do people thinks that this a reasonable thing to add to the OCaml
>> parsetree? If yes I can do the modification.
>>
>> Jeremie
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4

-- 
Jeremie

From bobzhang1988@gmail.com  Thu May 23 17:04:37 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8CCF23CBF9
 for <wg-camlp4@lists.ocaml.org>; Thu, 23 May 2013 17:04:37 +0100 (BST)
X-Cam-SpamDetails: score -0.3 from SpamAssassin-3.3.2-1485119 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.54 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-vb0-f54.google.com ([209.85.212.54]:49775)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UfYAa-00063C-Fk (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Thu, 23 May 2013 17:15:13 +0100
Received: by mail-vb0-f54.google.com with SMTP id f13so2327840vbg.13
 for <wg-camlp4@lists.ocaml.org>; Thu, 23 May 2013 09:15:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:sender:in-reply-to:references:date
 :x-google-sender-auth:message-id:subject:from:to:cc:content-type;
 bh=ruzLVj5Xr7Woqzq94vugrtOPJJKdw1hmVpE9SAmu5eo=;
 b=JWwLnE0a+Z7UwpgW1dLNt5NWKeUKRZpZgInLs19w1uL7PHFQbpYkAkCjXmx/czqULb
 lntHpf9g0V9prZZ+BhyiAA+8giAdqPx/roB7zOg13XEZfX1ur3zZIN318PNz76hGYkMr
 HDaIMKx0NttoO/W0Du9VhScIjkPP4lL/jB9SbY28RWDfXpqh7TMowBHP2yLNgz2vvN9M
 M/aG0+qItA1HpVq19XyfpR0aK+h+7ObSX5nIoSM83MxuqAlLcubpKRd0GfxzClEXwx4y
 8t7vIbM2SGvlM4aSaaP4xQuLzN7y8/jtw4poW25XqSYIhha6+CaOHJO3UhNa3ziAEyuY
 5PMg==
MIME-Version: 1.0
X-Received: by 10.52.228.129 with SMTP id si1mr4921436vdc.79.1369325712099;
 Thu, 23 May 2013 09:15:12 -0700 (PDT)
Sender: bobzhang1988@gmail.com
Received: by 10.220.68.198 with HTTP; Thu, 23 May 2013 09:15:11 -0700 (PDT)
In-Reply-To: <CANhEzE669gfDxfFwaJ+x-1rNhU3qy6wAqsxqP7L0SAjS-RezLw@mail.gmail.com>
References: <CANhEzE6iCKy55i1ysRJYibcCwhcpoF6q3JFj7J4QjtkYkzRTTw@mail.gmail.com>
 <CAPFanBF-S2o_wLDMWMsHyQjViD4T-1M6r4RSEnH3uZQmAQafqQ@mail.gmail.com>
 <CANhEzE669gfDxfFwaJ+x-1rNhU3qy6wAqsxqP7L0SAjS-RezLw@mail.gmail.com>
Date: Thu, 23 May 2013 12:15:11 -0400
X-Google-Sender-Auth: dfUytuYMylBBOMs0v4yjHqWYiR0
Message-ID: <CANcqPu4EqvbcLZtaWoU8iT_LOcmN27hEtzSHOKejyfy5i9-LmQ@mail.gmail.com>
From: Hongbo Zhang <hongboz@seas.upenn.edu>
To: Jeremie Dimino <jdimino@janestreet.com>
Content-Type: multipart/alternative; boundary=089e01183fc4a6d84b04dd64fc03
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Raw representation of literals in the parsetree
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 23 May 2013 16:04:37 -0000

--089e01183fc4a6d84b04dd64fc03
Content-Type: text/plain; charset=ISO-8859-1

Hi, Jeremie, I think it's reasonable to change the lexer.
FYI, camlp4's lexer works this way


On Thu, May 23, 2013 at 11:26 AM, Jeremie Dimino <jdimino@janestreet.com>wrote:

> We discussed it further with Alain but it turns out it doesn't work
> very well.  A constant may be composed of several tokens so it is not
> possible to have the exact raw representation.  And for strings one
> can use the new quoted strings which are already treated as raw
> strings.
>
> Another possibility would be to modify the lexer so that it doesn't
> 'evaluate' tokens immediately and let the parser do it.  At least it
> would avoid this kind of thing:
>
>   # max_int;;
>   - : int = 4611686018427387903
>   # 4611686018427387904;;
>   - : int = -4611686018427387904
>
> On Thu, May 2, 2013 at 2:00 PM, Gabriel Scherer
> <gabriel.scherer@gmail.com> wrote:
> > I think it is very reasonable, and would be a good fit for Alain's
> branch.
> >
> > On Thu, May 2, 2013 at 1:35 PM, Jeremie Dimino <jdimino@janestreet.com>
> wrote:
> >> Hi,
> >>
> >> We recently felt the need to write a new extension that would check
> >> integer literals.  The goal is to verify that ones containing
> >> underscores match a specific regular expression.  Namely digits are
> >> grouped by 3.
> >>
> >> We can do that for instance with a camlp4 token filter, but we wanted
> >> to try with ppx.  It is currently not possible to do it by looking at
> >> the parsetree since constants are already evaluated (integers are
> >> represented by an OCaml int) and the raw form is lost.
> >>
> >> One solution would be to add the raw representation of constants in
> >> the parsetree. For instance by changing Asttypes.constant to:
> >>
> >> ,----
> >> | type constant_value =
> >> |     Const_int of int
> >> |   | Const_char of char
> >> |   | Const_string of string
> >> |   | Const_float of string
> >> |   | Const_int32 of int32
> >> |   | Const_int64 of int64
> >> |   | Const_nativeint of nativeint
> >> |
> >> | type constant = constant_value * string
> >> `----
> >>
> >> I believe it could also be useful for other rewriters, especially ones
> >> dealing with strings since they would be able to compute the correct
> >> location inside a string. And maybe also for printing: Pprintast could
> >> use the representation choosed by the programmer instead of a
> >> standardized one.
> >>
> >> Do people thinks that this a reasonable thing to add to the OCaml
> >> parsetree? If yes I can do the modification.
> >>
> >> Jeremie
> >> _______________________________________________
> >> wg-camlp4 mailing list
> >> wg-camlp4@lists.ocaml.org
> >> http://lists.ocaml.org/listinfo/wg-camlp4
>
> --
> Jeremie
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>



-- 
-- Regards, Hongbo

--089e01183fc4a6d84b04dd64fc03
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Hi, Jeremie, I think it&#39;s reasonable to change the lex=
er.<div style>FYI, camlp4&#39;s lexer works this way</div></div><div class=
=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Thu, May 23, 2013 at=
 11:26 AM, Jeremie Dimino <span dir=3D"ltr">&lt;<a href=3D"mailto:jdimino@j=
anestreet.com" target=3D"_blank">jdimino@janestreet.com</a>&gt;</span> wrot=
e:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">We discussed it further with Alain but it tu=
rns out it doesn&#39;t work<br>
very well. =A0A constant may be composed of several tokens so it is not<br>
possible to have the exact raw representation. =A0And for strings one<br>
can use the new quoted strings which are already treated as raw<br>
strings.<br>
<br>
Another possibility would be to modify the lexer so that it doesn&#39;t<br>
&#39;evaluate&#39; tokens immediately and let the parser do it. =A0At least=
 it<br>
would avoid this kind of thing:<br>
<br>
=A0 # max_int;;<br>
=A0 - : int =3D 4611686018427387903<br>
=A0 # 4611686018427387904;;<br>
=A0 - : int =3D -4611686018427387904<br>
<div><div class=3D"h5"><br>
On Thu, May 2, 2013 at 2:00 PM, Gabriel Scherer<br>
&lt;<a href=3D"mailto:gabriel.scherer@gmail.com">gabriel.scherer@gmail.com<=
/a>&gt; wrote:<br>
&gt; I think it is very reasonable, and would be a good fit for Alain&#39;s=
 branch.<br>
&gt;<br>
&gt; On Thu, May 2, 2013 at 1:35 PM, Jeremie Dimino &lt;<a href=3D"mailto:j=
dimino@janestreet.com">jdimino@janestreet.com</a>&gt; wrote:<br>
&gt;&gt; Hi,<br>
&gt;&gt;<br>
&gt;&gt; We recently felt the need to write a new extension that would chec=
k<br>
&gt;&gt; integer literals. =A0The goal is to verify that ones containing<br=
>
&gt;&gt; underscores match a specific regular expression. =A0Namely digits =
are<br>
&gt;&gt; grouped by 3.<br>
&gt;&gt;<br>
&gt;&gt; We can do that for instance with a camlp4 token filter, but we wan=
ted<br>
&gt;&gt; to try with ppx. =A0It is currently not possible to do it by looki=
ng at<br>
&gt;&gt; the parsetree since constants are already evaluated (integers are<=
br>
&gt;&gt; represented by an OCaml int) and the raw form is lost.<br>
&gt;&gt;<br>
&gt;&gt; One solution would be to add the raw representation of constants i=
n<br>
&gt;&gt; the parsetree. For instance by changing Asttypes.constant to:<br>
&gt;&gt;<br>
&gt;&gt; ,----<br>
&gt;&gt; | type constant_value =3D<br>
&gt;&gt; | =A0 =A0 Const_int of int<br>
&gt;&gt; | =A0 | Const_char of char<br>
&gt;&gt; | =A0 | Const_string of string<br>
&gt;&gt; | =A0 | Const_float of string<br>
&gt;&gt; | =A0 | Const_int32 of int32<br>
&gt;&gt; | =A0 | Const_int64 of int64<br>
&gt;&gt; | =A0 | Const_nativeint of nativeint<br>
&gt;&gt; |<br>
&gt;&gt; | type constant =3D constant_value * string<br>
&gt;&gt; `----<br>
&gt;&gt;<br>
&gt;&gt; I believe it could also be useful for other rewriters, especially =
ones<br>
&gt;&gt; dealing with strings since they would be able to compute the corre=
ct<br>
&gt;&gt; location inside a string. And maybe also for printing: Pprintast c=
ould<br>
&gt;&gt; use the representation choosed by the programmer instead of a<br>
&gt;&gt; standardized one.<br>
&gt;&gt;<br>
&gt;&gt; Do people thinks that this a reasonable thing to add to the OCaml<=
br>
&gt;&gt; parsetree? If yes I can do the modification.<br>
&gt;&gt;<br>
&gt;&gt; Jeremie<br>
&gt;&gt; _______________________________________________<br>
&gt;&gt; wg-camlp4 mailing list<br>
&gt;&gt; <a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml=
.org</a><br>
&gt;&gt; <a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_b=
lank">http://lists.ocaml.org/listinfo/wg-camlp4</a><br>
<br>
</div></div>--<br>
<div class=3D"HOEnZb"><div class=3D"h5">Jeremie<br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
-- Regards, Hongbo
</div>

--089e01183fc4a6d84b04dd64fc03--

From anil@recoil.org  Mon May 27 11:36:42 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id CB26C3C4DE
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 11:36:42 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1485974
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:43394
 helo=dark.recoil.org)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with smtp id 1Uguxe-0006Cc-1F (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Mon, 27 May 2013 11:47:31 +0100
Received: (qmail 22318 invoked by uid 634); 27 May 2013 10:47:30 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from cpc7-cmbg14-2-0-cust238.5-4.cable.virginmedia.com (HELO
 [192.168.1.48]) (86.30.244.239)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Mon, 27 May 2013 11:47:29 +0100
From: Anil Madhavapeddy <anil@recoil.org>
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: quoted-printable
Date: Mon, 27 May 2013 11:47:27 +0100
Message-Id: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
To: "ocaml-core@googlegroups.com" <ocaml-core@googlegroups.com>,
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Mime-Version: 1.0 (Mac OS X Mail 6.3 \(1503\))
X-Mailer: Apple Mail (2.1503)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: "Richard W.M. Jones" <rich@annexia.org>
Subject: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 27 May 2013 10:36:42 -0000

Core currently hides two functions needed by the Bitstring syntax =
extension: Char.code and String.unsafe_get.  I'm not sure what the best =
way to work around this is. Possibilities are:

- Core.Std.Caml has the original namespace from OCaml, so add a camlp4 =
flag to pa_bitstring to locally open Caml if the flag is specified.

- Add Char.code and String.unsafe_get to Core -- but there will be more =
similar incompatibilities lurking.

- Do nothing, and wait for the more explicit extension_points to show =
up.

- The below hack to get it to compile. Ugh.

--
open Core.Std

module Char =3D struct
  include Char
  let code =3D to_int
end

module String =3D struct
  include String
  let unsafe_get =3D Caml.String.unsafe_get
end

let show_gif_info filename () =3D
  let bits =3D Bitstring.bitstring_of_file filename in

  bitmatch bits with
  | { ("GIF87a"|"GIF89a") : 6*8 : string; (* GIF magic. *)
      width : 16 : littleendian;
      height : 16 : littleendian;
      colormap : 1;                     (* Has colormap? *)
      colorbits : 3;                    (* Color res =3D colorbits+1 *)
      sortflag : 1;
      bps : 3;                          (* Bits/pixel =3D bps+1 *)
      bg : 8;                           (* Background colour. *)
      aspectratio : 8 } ->
      printf "%s: GIF image:\n" filename;
      printf "  size %d %d\n" width height;
      printf "  has global colormap? %b\n" colormap;
      printf "  colorbits %d\n" (colorbits+1);
      printf "  global colormap is sorted? %b\n" sortflag;
      printf "  bits/pixel %d\n" (bps+1);
      printf "  background color index %d\n" bg;
      printf "  aspect ratio %d\n" aspectratio

  | { _ } ->
      eprintf "%s: Not a GIF image\n" filename

let () =3D
  Command.basic ~summary:"Display information about GIF file"
    Command.Spec.(
      empty +>
      anon ("filename" %: file)
    )
    show_gif_info
  |> Command.run


From dhouse@janestreet.com  Mon May 27 11:50:13 2013
Return-Path: <dhouse@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4FEE53C4DE
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 11:50:13 +0100 (BST)
X-Cam-SpamDetails: score -1.0 from SpamAssassin-3.3.2-1485974 
 * -1.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:39249
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UgvAd-0006cu-F6 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <dhouse@janestreet.com>); Mon, 27 May 2013 12:01:01 +0100
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <dhouse@janestreet.com>) id 1UgvAH-0005er-PQ
 for wg-camlp4@lists.ocaml.org; Mon, 27 May 2013 07:00:33 -0400
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <dhouse@janestreet.com>) id 1UgvAH-0007oH-Nj
 for wg-camlp4@lists.ocaml.org; Mon, 27 May 2013 07:00:33 -0400
Received: from mail-oa0-f54.google.com ([209.85.219.54])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <dhouse@janestreet.com>) id 1UgvAH-00057a-KJ
 for wg-camlp4@lists.ocaml.org; Mon, 27 May 2013 07:00:33 -0400
Received: by mail-oa0-f54.google.com with SMTP id o17so8526201oag.41
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 04:00:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type;
 bh=olYqmQinPTlw5W90i06/Jce75V08huQmCV5imlHJkAY=;
 b=fAmyWxiKnfQ+88hcxD1Deo6eG4J5xsiqB/HZd3mLQ/JZyXzxBtP+pKHfS8IkHW2cAk
 x8QU6MF2rF8/8M+tNKdNK6z9cjrkVFKiShRoIw0Pmxhr3bEfl8t/+VLBZuT4Ed77mN8d
 XOtMjKO9QzQFzzqe/FvgjoMbtUyY6ds757BmQ=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type:x-gm-message-state;
 bh=olYqmQinPTlw5W90i06/Jce75V08huQmCV5imlHJkAY=;
 b=iqi+eeQwcMPuhd/3wE3qgZ9up5LlX99+lSOJ/5lzCs77h0RvSU3C1I/Lz+IoPCpLWw
 kq4LJl4xVOfZSncfoqXUWce9hIlnk8I56yoygdxyeCVQ9YSe+OmJVj1V77NzbnHuiLlF
 LiUCvT7wDpFc/ywq/jUgxjTpmlyAOhqISjtAw0G5qOMY8hEg3Tn/L7QjORn3HzLjwhcg
 XJXYhlziTDXUdaShhW2opTogO9ke8YK8/Xwd5ZX/aMXmgFQu6+eyVK0BHSXqsHaeSJeV
 4xrrvRiQVUKJJldHZSnIAu1giX+FrBD2rm0dHW5TgVWSk2P5jbMBKCG+XjWyqTfJK8St
 KNLg==
X-Received: by 10.60.140.166 with SMTP id rh6mr17730891oeb.97.1369652433297;
 Mon, 27 May 2013 04:00:33 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.60.140.166 with SMTP id rh6mr17730887oeb.97.1369652433225;
 Mon, 27 May 2013 04:00:33 -0700 (PDT)
Received: by 10.76.144.234 with HTTP; Mon, 27 May 2013 04:00:33 -0700 (PDT)
In-Reply-To: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
Date: Mon, 27 May 2013 12:00:33 +0100
Message-ID: <CAK=fH+gS7FHCwj50+Dfe+cQ3BSgzBDVvSB=vN0QaYHq8b_uWaw@mail.gmail.com>
From: David House <dhouse@janestreet.com>
To: ocaml-core@googlegroups.com
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQkqaCbP8pfiUPZnJIOa0rk/ACOOmL9ELfKROZRKdXMJUSCPrAMEFla+opkh79UArZYZdNbkKkoCcXuU9O7ijT8u79ErE3wZZGoFuF0B4yi/WE5o3k/fTLrLPP/MSr9X1QK7l6l4wQh+moRcl1Tn8ILqn8+F6g==
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 "Richard W.M. Jones" <rich@annexia.org>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 27 May 2013 10:50:13 -0000

I think it's totally reasonable to expose String.unsafe_get.

Char.code is a bit uglier, since we already have Core.to_int. But, we
could probably put up with it, particularly if it were a temporary
measure.

On 27 May 2013 11:47, Anil Madhavapeddy <anil@recoil.org> wrote:
> Core currently hides two functions needed by the Bitstring syntax extension: Char.code and String.unsafe_get.  I'm not sure what the best way to work around this is. Possibilities are:
>
> - Core.Std.Caml has the original namespace from OCaml, so add a camlp4 flag to pa_bitstring to locally open Caml if the flag is specified.
>
> - Add Char.code and String.unsafe_get to Core -- but there will be more similar incompatibilities lurking.
>
> - Do nothing, and wait for the more explicit extension_points to show up.
>
> - The below hack to get it to compile. Ugh.
>
> --
> open Core.Std
>
> module Char = struct
>   include Char
>   let code = to_int
> end
>
> module String = struct
>   include String
>   let unsafe_get = Caml.String.unsafe_get
> end
>
> let show_gif_info filename () =
>   let bits = Bitstring.bitstring_of_file filename in
>
>   bitmatch bits with
>   | { ("GIF87a"|"GIF89a") : 6*8 : string; (* GIF magic. *)
>       width : 16 : littleendian;
>       height : 16 : littleendian;
>       colormap : 1;                     (* Has colormap? *)
>       colorbits : 3;                    (* Color res = colorbits+1 *)
>       sortflag : 1;
>       bps : 3;                          (* Bits/pixel = bps+1 *)
>       bg : 8;                           (* Background colour. *)
>       aspectratio : 8 } ->
>       printf "%s: GIF image:\n" filename;
>       printf "  size %d %d\n" width height;
>       printf "  has global colormap? %b\n" colormap;
>       printf "  colorbits %d\n" (colorbits+1);
>       printf "  global colormap is sorted? %b\n" sortflag;
>       printf "  bits/pixel %d\n" (bps+1);
>       printf "  background color index %d\n" bg;
>       printf "  aspect ratio %d\n" aspectratio
>
>   | { _ } ->
>       eprintf "%s: Not a GIF image\n" filename
>
> let () =
>   Command.basic ~summary:"Display information about GIF file"
>     Command.Spec.(
>       empty +>
>       anon ("filename" %: file)
>     )
>     show_gif_info
>   |> Command.run
>
> --
> You received this message because you are subscribed to the Google Groups "ocaml-core" group.
> To unsubscribe from this group and stop receiving emails from it, send an email to ocaml-core+unsubscribe@googlegroups.com.
> For more options, visit https://groups.google.com/groups/opt_out.
>
>

From gabriel.scherer@gmail.com  Mon May 27 13:53:54 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B42A83C560
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 13:53:54 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1485974 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.44 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f44.google.com ([209.85.214.44]:59217)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1Ugx6P-0002ot-hT (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Mon, 27 May 2013 14:04:43 +0100
Received: by mail-bk0-f44.google.com with SMTP id jc3so3638995bkc.3
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 06:04:41 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:from:date:message-id:subject:to
 :cc:content-type;
 bh=TSAtWaZu7QWy7zMfUjW0K7WbA127LlNQgcWYKqAZooA=;
 b=Do3OeqPjQbvyz1yOeQZ8ncfNuXYkAJrbpwXwrC+sIdcCz3z+QTL6t3svp/ZXManaDL
 WzZ49VE2IQk8SMnFcPWLU48pnLR4cV7S1LvQ0K0Ndqgp7qiRumBHPq2xKdDl4sofpz/F
 2vcZM8KaoCwn/U1o4GLBj5lGTPhDJuQ0rLfPtYrXHYpN4b8ut5SOuPy/njV2U8gBRg7a
 357Tv/HQG0ZP0girtYRb+fTwq16NoF2hZ1MBDYODmJkvZbRdP7KawPeT+lkDs/4lkJrJ
 2Q+uI5dFOiHpymWMweySYACPUFBzOfIv2zJg1Q8GcqjCyCPfK/mEHq532TgRGfJ1FTDL
 cwQA==
X-Received: by 10.204.190.17 with SMTP id dg17mr856685bkb.25.1369659881087;
 Mon, 27 May 2013 06:04:41 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.35.75 with HTTP; Mon, 27 May 2013 06:04:00 -0700 (PDT)
In-Reply-To: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Mon, 27 May 2013 15:04:00 +0200
Message-ID: <CAPFanBF1wQ9ehYeHqyD5N42CnhPLNCX7Wv95Mu0sXmpuxirWTA@mail.gmail.com>
To: Anil Madhavapeddy <anil@recoil.org>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 "Richard W.M. Jones" <rich@annexia.org>,
 "ocaml-core@googlegroups.com" <ocaml-core@googlegroups.com>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 27 May 2013 12:53:54 -0000

Regarding your name-rebinding workaround, wouldn't it be enough to ask
that any use of bitmatch..with be protected by an "let open Caml in"?

On Mon, May 27, 2013 at 12:47 PM, Anil Madhavapeddy <anil@recoil.org> wrote:
> Core currently hides two functions needed by the Bitstring syntax extension: Char.code and String.unsafe_get.  I'm not sure what the best way to work around this is. Possibilities are:
>
> - Core.Std.Caml has the original namespace from OCaml, so add a camlp4 flag to pa_bitstring to locally open Caml if the flag is specified.
>
> - Add Char.code and String.unsafe_get to Core -- but there will be more similar incompatibilities lurking.
>
> - Do nothing, and wait for the more explicit extension_points to show up.
>
> - The below hack to get it to compile. Ugh.
>
> --
> open Core.Std
>
> module Char = struct
>   include Char
>   let code = to_int
> end
>
> module String = struct
>   include String
>   let unsafe_get = Caml.String.unsafe_get
> end
>
> let show_gif_info filename () =
>   let bits = Bitstring.bitstring_of_file filename in
>
>   bitmatch bits with
>   | { ("GIF87a"|"GIF89a") : 6*8 : string; (* GIF magic. *)
>       width : 16 : littleendian;
>       height : 16 : littleendian;
>       colormap : 1;                     (* Has colormap? *)
>       colorbits : 3;                    (* Color res = colorbits+1 *)
>       sortflag : 1;
>       bps : 3;                          (* Bits/pixel = bps+1 *)
>       bg : 8;                           (* Background colour. *)
>       aspectratio : 8 } ->
>       printf "%s: GIF image:\n" filename;
>       printf "  size %d %d\n" width height;
>       printf "  has global colormap? %b\n" colormap;
>       printf "  colorbits %d\n" (colorbits+1);
>       printf "  global colormap is sorted? %b\n" sortflag;
>       printf "  bits/pixel %d\n" (bps+1);
>       printf "  background color index %d\n" bg;
>       printf "  aspect ratio %d\n" aspectratio
>
>   | { _ } ->
>       eprintf "%s: Not a GIF image\n" filename
>
> let () =
>   Command.basic ~summary:"Display information about GIF file"
>     Command.Spec.(
>       empty +>
>       anon ("filename" %: file)
>     )
>     show_gif_info
>   |> Command.run
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From anil@recoil.org  Mon May 27 13:59:41 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1C7BE3C560
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 13:59:41 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1485974
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:2212
 helo=dark.recoil.org)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with smtp id 1UgxBw-00054w-24 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Mon, 27 May 2013 14:10:29 +0100
Received: (qmail 18910 invoked by uid 634); 27 May 2013 13:10:24 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from host81-149-102-120.in-addr.btopenworld.com (HELO clink-4.home)
 (81.149.102.120)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Mon, 27 May 2013 14:10:23 +0100
Content-Type: text/plain; charset=iso-8859-1
Mime-Version: 1.0 (Mac OS X Mail 6.3 \(1503\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <CAPFanBF1wQ9ehYeHqyD5N42CnhPLNCX7Wv95Mu0sXmpuxirWTA@mail.gmail.com>
Date: Mon, 27 May 2013 14:10:22 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <0C775EE4-5CC3-40C1-B82F-A0585ADEBFC2@recoil.org>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
 <CAPFanBF1wQ9ehYeHqyD5N42CnhPLNCX7Wv95Mu0sXmpuxirWTA@mail.gmail.com>
To: ocaml-core@googlegroups.com
X-Mailer: Apple Mail (2.1503)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 "Richard W.M. Jones" <rich@annexia.org>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 27 May 2013 12:59:41 -0000

No, as you would have to re-open Core.Std in each of the pattern =
applications if you do it around the bitmatch.

-anil

On 27 May 2013, at 14:04, Gabriel Scherer <gabriel.scherer@gmail.com> =
wrote:

> Regarding your name-rebinding workaround, wouldn't it be enough to ask
> that any use of bitmatch..with be protected by an "let open Caml in"?
>=20
> On Mon, May 27, 2013 at 12:47 PM, Anil Madhavapeddy <anil@recoil.org> =
wrote:
>> Core currently hides two functions needed by the Bitstring syntax =
extension: Char.code and String.unsafe_get.  I'm not sure what the best =
way to work around this is. Possibilities are:
>>=20
>> - Core.Std.Caml has the original namespace from OCaml, so add a =
camlp4 flag to pa_bitstring to locally open Caml if the flag is =
specified.
>>=20
>> - Add Char.code and String.unsafe_get to Core -- but there will be =
more similar incompatibilities lurking.
>>=20
>> - Do nothing, and wait for the more explicit extension_points to show =
up.
>>=20
>> - The below hack to get it to compile. Ugh.
>>=20
>> --
>> open Core.Std
>>=20
>> module Char =3D struct
>>  include Char
>>  let code =3D to_int
>> end
>>=20
>> module String =3D struct
>>  include String
>>  let unsafe_get =3D Caml.String.unsafe_get
>> end
>>=20
>> let show_gif_info filename () =3D
>>  let bits =3D Bitstring.bitstring_of_file filename in
>>=20
>>  bitmatch bits with
>>  | { ("GIF87a"|"GIF89a") : 6*8 : string; (* GIF magic. *)
>>      width : 16 : littleendian;
>>      height : 16 : littleendian;
>>      colormap : 1;                     (* Has colormap? *)
>>      colorbits : 3;                    (* Color res =3D colorbits+1 =
*)
>>      sortflag : 1;
>>      bps : 3;                          (* Bits/pixel =3D bps+1 *)
>>      bg : 8;                           (* Background colour. *)
>>      aspectratio : 8 } ->
>>      printf "%s: GIF image:\n" filename;
>>      printf "  size %d %d\n" width height;
>>      printf "  has global colormap? %b\n" colormap;
>>      printf "  colorbits %d\n" (colorbits+1);
>>      printf "  global colormap is sorted? %b\n" sortflag;
>>      printf "  bits/pixel %d\n" (bps+1);
>>      printf "  background color index %d\n" bg;
>>      printf "  aspect ratio %d\n" aspectratio
>>=20
>>  | { _ } ->
>>      eprintf "%s: Not a GIF image\n" filename
>>=20
>> let () =3D
>>  Command.basic ~summary:"Display information about GIF file"
>>    Command.Spec.(
>>      empty +>
>>      anon ("filename" %: file)
>>    )
>>    show_gif_info
>>  |> Command.run
>>=20
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>=20
> --=20
> You received this message because you are subscribed to the Google =
Groups "ocaml-core" group.
> To unsubscribe from this group and stop receiving emails from it, send =
an email to ocaml-core+unsubscribe@googlegroups.com.
> For more options, visit https://groups.google.com/groups/opt_out.
>=20
>=20


From rich@annexia.org  Mon May 27 14:43:38 2013
Return-Path: <rich@annexia.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AD6FB3C560
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 14:43:38 +0100 (BST)
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.3 from SpamAssassin-3.3.2-1485974 
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [80.68.91.176] (port=59529 helo=furbychan.cocan.org)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UgxsU-00050q-Dr (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <rich@annexia.org>); Mon, 27 May 2013 14:54:27 +0100
Received: from rich by furbychan.cocan.org with local (Exim 4.72)
 (envelope-from <rich@annexia.org>)
 id 1Ugxs3-0007WY-88; Mon, 27 May 2013 14:53:55 +0100
Date: Mon, 27 May 2013 14:53:55 +0100
From: "Richard W.M. Jones" <rich@annexia.org>
To: Anil Madhavapeddy <anil@recoil.org>
Message-ID: <20130527135355.GT19868@annexia.org>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
User-Agent: Mutt/1.5.20 (2009-06-14)
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 "ocaml-core@googlegroups.com" <ocaml-core@googlegroups.com>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 27 May 2013 13:43:38 -0000

On Mon, May 27, 2013 at 11:47:27AM +0100, Anil Madhavapeddy wrote:
> Core currently hides two functions needed by the Bitstring syntax
> extension: Char.code and String.unsafe_get.  I'm not sure what the
> best way to work around this is. Possibilities are:

I guess, *why* are they hidden?  Bitstring should use both functions
in a safe way.

Rich.

-- 
Richard Jones
Red Hat

From alain.frisch@lexifi.com  Mon May 27 18:12:41 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 2D7093C560
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 18:12:41 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1485974 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:38054
 helo=msa.smtpout.orange.fr)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1Uh18s-0001se-Dl (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 27 May 2013 18:23:30 +0100
Received: from [192.168.1.116] ([86.195.151.231]) by mwinf5d54 with ME
 id h5PQ1l00V4zoLnJ035PQQh; Mon, 27 May 2013 19:23:29 +0200
Message-ID: <51A3968E.40109@lexifi.com>
Date: Mon, 27 May 2013 19:23:26 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:22.0) Gecko/20100101 Thunderbird/22.0
MIME-Version: 1.0
To: Anil Madhavapeddy <anil@recoil.org>, 
 "ocaml-core@googlegroups.com" <ocaml-core@googlegroups.com>,
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
In-Reply-To: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "Richard W.M. Jones" <rich@annexia.org>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 27 May 2013 17:12:41 -0000

On 05/27/2013 12:47 PM, Anil Madhavapeddy wrote:
> - Do nothing, and wait for the more explicit extension_points to show up.

I believe the situation would be very similar with a version of 
bitstring based on extension_points.  A system of namespaces allowing to 
access components from the stdlib explicitly (even if shadowed by Core) 
would solve the issue, but this is not directly related to extension_points.

Btw, bitstring would be an interesting use case for extension_points, 
and looking at pa_bitstring.ml, it seems porting should not be too 
difficult. Any volunteer?


-- Alain

From xavier.clerc@inria.fr  Mon May 27 18:55:02 2013
Return-Path: <xavier.clerc@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D25783C560
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 18:55:02 +0100 (BST)
X-Cam-SpamDetails: score -6.1 from SpamAssassin-3.3.2-1485974 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -1.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:55412)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1Uh1ns-0006h3-0C (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <xavier.clerc@inria.fr>); Mon, 27 May 2013 19:05:52 +0100
X-IronPort-AV: E=Sophos;i="4.87,752,1363129200"; d="scan'208";a="15854511"
Received: from zmbs4.inria.fr ([128.93.142.17])
 by mail3-relais-sop.national.inria.fr with ESMTP; 27 May 2013 20:05:51 +0200
Date: Mon, 27 May 2013 20:05:51 +0200 (CEST)
From: Xavier Clerc <xavier.clerc@inria.fr>
To: Alain Frisch <alain.frisch@lexifi.com>
Message-ID: <1072644905.5044229.1369677951274.JavaMail.root@inria.fr>
In-Reply-To: <51A3968E.40109@lexifi.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
X-Originating-IP: [86.132.84.118]
X-Mailer: Zimbra 7.2.2_GA_2857 (ZimbraWebClient - SAF3 (Mac)/7.2.2_GA_2852)
Cc: wg-camlp4@lists.ocaml.org, ocaml-core@googlegroups.com,
 "Richard W.M. Jones" <rich@annexia.org>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 27 May 2013 17:55:02 -0000

----- Mail original -----
> On 05/27/2013 12:47 PM, Anil Madhavapeddy wrote:
> > - Do nothing, and wait for the more explicit extension_points to
> > show up.
> 
> I believe the situation would be very similar with a version of
> bitstring based on extension_points.  A system of namespaces allowing
> to
> access components from the stdlib explicitly (even if shadowed by
> Core)
> would solve the issue, but this is not directly related to
> extension_points.

I concur.

However, in this particular case, there seems to be a workaround
as the two functions to be accessed are indeed externals. As a
consequence, bitstring could "access them explicitly" in module
"Bitstring" through:
  external string_unsafe_get : string -> int -> char = "%string_unsafe_get"
  external char_code : char -> int = "%identity"
and then emit code where "String.unsafe_get" (respectively "Char.code")
is replaced by "Bitstring.string_unsafe_get" (respectively "Bitstring.char_code).

I acknowledge that it not very elegant, though.


My two cents,

Xavier

From yminsky@janestreet.com  Mon May 27 19:13:02 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id F07473C560
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 19:13:01 +0100 (BST)
X-Cam-SpamDetails: score -1.0 from SpamAssassin-3.3.2-1485974 
 * -1.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:56913
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1Uh25A-0004mq-9e (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Mon, 27 May 2013 19:23:51 +0100
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1Uh24o-0002Tu-Dm
 for wg-camlp4@lists.ocaml.org; Mon, 27 May 2013 14:23:22 -0400
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1Uh24l-0007NL-Cb
 for wg-camlp4@lists.ocaml.org; Mon, 27 May 2013 14:23:19 -0400
Received: from mail-ea0-f179.google.com ([209.85.215.179])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1Uh24l-0001yK-8O
 for wg-camlp4@lists.ocaml.org; Mon, 27 May 2013 14:23:19 -0400
Received: by mail-ea0-f179.google.com with SMTP id z16so4076755ead.24
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 May 2013 11:23:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type;
 bh=pQ3T9jwNeW2YHWU02sryrbcjw3nCQ2dtCjgsh0DhjwY=;
 b=qAMdzCrb/w1z2zszMU8+PrIBTyVr1l+Z8WyyADsUTqeDoE5/czgJ+3cw0GwjpgJCE8
 2oZzYOOpusuQRN/HtWL6GY1uGxt7CMq+V3IsvAYzmEWIloQ235pTRiZTDN6SL56xhZ2Y
 gYKCGSX+diC5vZb4Bb0S18aoBQWdRcMXJ7HAk=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type:x-gm-message-state;
 bh=pQ3T9jwNeW2YHWU02sryrbcjw3nCQ2dtCjgsh0DhjwY=;
 b=eG3FPvQTKgKdZuDb9vgod8g1WzEhIrgM1QK7kf5CqW0tOzECpBVAvGfJ74UK1TGw/P
 /d4A5BdxvhV+Yt319YbVp0thSmp9D1AS4zQPzMJhjrWItqrfwXzqJqe5iyKECzQ9rj1/
 wGmVRL39XEhUCTB2N5JaKv8euq5ZD7uhfchH3yEGlHsl7L95bUCiNMtDHh1Mc+MpVJna
 NOqC0r6pMISmbv9hw+d2N+gDaZG0HMfMLuF02gjmmfq//ez/7bugHgHLVQcB9OGbXrMj
 ytydPMmz4/PbhAme+89/1AjG0pEmXhBK9rWNI3LO0/tFUFc2lfsj5xjivCY2yvY2L8m1
 RDwQ==
X-Received: by 10.14.29.7 with SMTP id h7mr10900063eea.90.1369678998636;
 Mon, 27 May 2013 11:23:18 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.14.29.7 with SMTP id h7mr10900049eea.90.1369678998495; Mon,
 27 May 2013 11:23:18 -0700 (PDT)
Received: by 10.223.43.14 with HTTP; Mon, 27 May 2013 11:23:18 -0700 (PDT)
In-Reply-To: <20130527135355.GT19868@annexia.org>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
 <20130527135355.GT19868@annexia.org>
Date: Mon, 27 May 2013 14:23:18 -0400
Message-ID: <CACLX4jQQDWvVgvzDnDYEAU_fD-iWjuS8tPmD1kzOV_c8N_1VcA@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: "Richard W.M. Jones" <rich@annexia.org>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQmcweeVGGIeF3m3UyR3d5/UHq2ipWsSvnkMbWS3+QI+o3syjkC04qNdHWsliFVvQhrLJWxM83sgiI+oB9IAkP6z6Og14lTAwk3rFjjfzbUQ0YhdLek08sUOUA0mBKSe3aO9H5FMCNY+S4T/Lt9yYnyKBnzaJQ==
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 "ocaml-core@googlegroups.com" <ocaml-core@googlegroups.com>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 27 May 2013 18:13:02 -0000

The basic issue is that Core is a new library, not an overlay on the
stdlib.  As such, it has its own interface conventions, and so we have
Char.to_int and Char.of_int rather than Char.code and Char.chr.

Hiding unsafe_set and unsafe_get is another issue, and I agree those
can just be shown.  And I don't even mind adding Char.code as a
temporary measure.  But in the end, there should be a way for syntax
extensions to refer to the standard library without confusion.
Namespaces I believe should help here.

y

On Mon, May 27, 2013 at 9:53 AM, Richard W.M. Jones <rich@annexia.org> wrote:
> On Mon, May 27, 2013 at 11:47:27AM +0100, Anil Madhavapeddy wrote:
>> Core currently hides two functions needed by the Bitstring syntax
>> extension: Char.code and String.unsafe_get.  I'm not sure what the
>> best way to work around this is. Possibilities are:
>
> I guess, *why* are they hidden?  Bitstring should use both functions
> in a safe way.
>
> Rich.
>
> --
> Richard Jones
> Red Hat
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From sweeks@janestreet.com  Tue May 28 16:52:52 2013
Return-Path: <sweeks@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0AEFC3C4DE
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 16:52:52 +0100 (BST)
X-Cam-SpamDetails: score -1.0 from SpamAssassin-3.3.2-1485974 
 * -1.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:45776
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UhMN8-0003re-6d (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <sweeks@janestreet.com>); Tue, 28 May 2013 17:03:44 +0100
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <sweeks@janestreet.com>) id 1UhMMg-00059C-Md
 for wg-camlp4@lists.ocaml.org; Tue, 28 May 2013 12:03:10 -0400
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <sweeks@janestreet.com>) id 1UhMMg-0007kv-Ln
 for wg-camlp4@lists.ocaml.org; Tue, 28 May 2013 12:03:10 -0400
Received: from mail-ve0-f175.google.com ([209.85.128.175])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <sweeks@janestreet.com>) id 1UhMMg-0002gN-JU
 for wg-camlp4@lists.ocaml.org; Tue, 28 May 2013 12:03:10 -0400
Received: by mail-ve0-f175.google.com with SMTP id da11so1415201veb.6
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 09:03:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type;
 bh=oRjnYzRHk/PT0O37JqvemE/HVGc3+DIA54cQWXiWw90=;
 b=iHrs9wVNIpxafX3x7HXon4VyHdTDD3Fw+MsNdP8SnDmU0N4mbFU6AKhtvKQRHtsqmd
 rgHZKOe5t6xX9iTRUuPW8npsk3OZpDGxXpfMvEyAtMwDQOeA2iw8iOr4Sr2clBFGticc
 1nfyPU0ZFu+aeGx0IiBXOUA7iV+749T15qe3c=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type:x-gm-message-state;
 bh=oRjnYzRHk/PT0O37JqvemE/HVGc3+DIA54cQWXiWw90=;
 b=a58JWEA6BjeOjSerVvLSSDuJzo53Tp9iyUbfBh468LJya987rUPQSVx2TzRodk6TIl
 +56Va4L6pH2P59ApbaclT/bbOgNmdELRRNnvA9a9Gmy54E1nm8s4iY7DRihNxa+US0DT
 yaOMFnMdt5SasyjMG4Z1d7ZV6PZSpZNcyfBc3X5mNN8B05d9P5VMOwKnzPEd19BLUmzF
 PhHyBf2mazKJeER2AyKqC5CnGJ/emh79ndfPXhKhgDeqx/8ZHZ1obSMJS/86rAWLt9dW
 vAAzJN33ox69jFO8ZNCGbwmHZ4HkVrKqP/Ywg1hmOgJlcAzRXvQjuMXRKgG4770KuUuK
 4+6w==
X-Received: by 10.220.166.69 with SMTP id l5mr8095005vcy.26.1369756990396;
 Tue, 28 May 2013 09:03:10 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.220.166.69 with SMTP id l5mr8094981vcy.26.1369756990019;
 Tue, 28 May 2013 09:03:10 -0700 (PDT)
Received: by 10.220.62.79 with HTTP; Tue, 28 May 2013 09:03:09 -0700 (PDT)
In-Reply-To: <CACLX4jQQDWvVgvzDnDYEAU_fD-iWjuS8tPmD1kzOV_c8N_1VcA@mail.gmail.com>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
 <20130527135355.GT19868@annexia.org>
 <CACLX4jQQDWvVgvzDnDYEAU_fD-iWjuS8tPmD1kzOV_c8N_1VcA@mail.gmail.com>
Date: Tue, 28 May 2013 12:03:09 -0400
Message-ID: <CAPYVAiK5eBTygqb=g6pXAv7n4QeMrjchr=_Hj0mpT9aObzptZw@mail.gmail.com>
From: Stephen Weeks <sweeks@janestreet.com>
To: "ocaml-core@googlegroups.com" <ocaml-core@googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQn0Nd9Thu/lIImPc16X5lSvju+SreDq5m/cwgrZgQm83PswF/4W5Njlab6hnoTNtQT57267nok5FTrMuEnVwaaqjqHvpAgt9jyjv8i+UrrsGq2So+URHKjyKGxl7px8xJISPCkMyp5ZgteGi4Uexzf/Xysh0A==
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 "Richard W.M. Jones" <rich@annexia.org>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 28 May 2013 15:52:52 -0000

We'll add [String.unsafe_{get,set}] to Core.  We'll also add
[Char.code] as a temporary measure.  Please speak up if there's
anything else.

It seems to me that it should be easy for someone to tweak the
bitstring preprocessor to accept a -core switch so that all references
to variables in OCaml's standard library are of the form
[Core.Std.Caml.x].  I don't see a need to wait for namespaces.

On Mon, May 27, 2013 at 2:23 PM, Yaron Minsky  wrote:
> The basic issue is that Core is a new library, not an overlay on the
> stdlib.  As such, it has its own interface conventions, and so we have
> Char.to_int and Char.of_int rather than Char.code and Char.chr.
>
> Hiding unsafe_set and unsafe_get is another issue, and I agree those
> can just be shown.  And I don't even mind adding Char.code as a
> temporary measure.  But in the end, there should be a way for syntax
> extensions to refer to the standard library without confusion.
> Namespaces I believe should help here.
>
> y
>
> On Mon, May 27, 2013 at 9:53 AM, Richard W.M. Jones  wrote:
>> On Mon, May 27, 2013 at 11:47:27AM +0100, Anil Madhavapeddy wrote:
>>> Core currently hides two functions needed by the Bitstring syntax
>>> extension: Char.code and String.unsafe_get.  I'm not sure what the
>>> best way to work around this is. Possibilities are:
>>
>> I guess, *why* are they hidden?  Bitstring should use both functions
>> in a safe way.
>>
>> Rich.
>>
>> --
>> Richard Jones
>> Red Hat
>> _______________________________________________
>> wg-camlp4 mailing list
>> wg-camlp4@lists.ocaml.org
>> http://lists.ocaml.org/listinfo/wg-camlp4
>
> --
> You received this message because you are subscribed to the Google Groups "ocaml-core" group.
> To unsubscribe from this group and stop receiving emails from it, send an email to ocaml-core+unsubscribe@googlegroups.com.
> For more options, visit https://groups.google.com/groups/opt_out.
>
>

From anil@recoil.org  Tue May 28 17:05:09 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C58F83C4DE
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 17:05:09 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1485974
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:25995
 helo=dark.recoil.org)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with smtp id 1UhMZ7-0005Me-Ff (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Tue, 28 May 2013 17:16:02 +0100
Received: (qmail 26164 invoked by uid 634); 28 May 2013 16:16:01 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from no-dns-yet.demon.co.uk (HELO [192.168.15.174]) (62.49.66.12)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Tue, 28 May 2013 17:16:00 +0100
Content-Type: text/plain; charset=iso-8859-1
Mime-Version: 1.0 (Mac OS X Mail 6.3 \(1503\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <CAPYVAiK5eBTygqb=g6pXAv7n4QeMrjchr=_Hj0mpT9aObzptZw@mail.gmail.com>
Date: Tue, 28 May 2013 17:15:58 +0100
Content-Transfer-Encoding: 7bit
Message-Id: <EB3332B0-1EC2-49B2-9606-4DBC487F962B@recoil.org>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
 <20130527135355.GT19868@annexia.org>
 <CACLX4jQQDWvVgvzDnDYEAU_fD-iWjuS8tPmD1kzOV_c8N_1VcA@mail.gmail.com>
 <CAPYVAiK5eBTygqb=g6pXAv7n4QeMrjchr=_Hj0mpT9aObzptZw@mail.gmail.com>
To: ocaml-core@googlegroups.com
X-Mailer: Apple Mail (2.1503)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 "Richard W.M. Jones" <rich@annexia.org>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 28 May 2013 16:05:09 -0000


On 28 May 2013, at 17:03, Stephen Weeks <sweeks@janestreet.com> wrote:

> We'll add [String.unsafe_{get,set}] to Core.  We'll also add
> [Char.code] as a temporary measure.  Please speak up if there's
> anything else.
> 
> It seems to me that it should be easy for someone to tweak the
> bitstring preprocessor to accept a -core switch so that all references
> to variables in OCaml's standard library are of the form
> [Core.Std.Caml.x].  I don't see a need to wait for namespaces.

It's the build system integration that fills me with dread (figuring
out the ocamlfind META runes, how to plumb this through to ocamlbuild,
OASIS and OMake, and activate it only for files that use Core).

Not insurmountable, but not my highest priority to figure out right
now.  If anyone else does know the ocamlfind META format off-hand,
I'd be happy to patch Cow in a similar way.

-anil

From sweeks@janestreet.com  Tue May 28 17:30:08 2013
Return-Path: <sweeks@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 04AB63C4DE
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 17:30:08 +0100 (BST)
X-Cam-SpamDetails: score -1.0 from SpamAssassin-3.3.2-1485974 
 * -1.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:45587
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UhMxD-0006Ez-D0 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <sweeks@janestreet.com>); Tue, 28 May 2013 17:41:00 +0100
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <sweeks@janestreet.com>) id 1UhMwr-0000mm-QW
 for wg-camlp4@lists.ocaml.org; Tue, 28 May 2013 12:40:33 -0400
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <sweeks@janestreet.com>) id 1UhMwr-0001St-Oh
 for wg-camlp4@lists.ocaml.org; Tue, 28 May 2013 12:40:33 -0400
Received: from mail-ve0-f169.google.com ([209.85.128.169])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <sweeks@janestreet.com>) id 1UhMwr-00046W-Mq
 for wg-camlp4@lists.ocaml.org; Tue, 28 May 2013 12:40:33 -0400
Received: by mail-ve0-f169.google.com with SMTP id jw11so6149960veb.28
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 09:40:33 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type;
 bh=FopMevzvql09R1/s/JZ631nLBBbBXgAgg/Ire3fARVM=;
 b=h35US4NKNtht36fdWntE0krgfaX3y3yk60QeweyFzVnWMXpgTRJh6I89O0/cTmlVBa
 IejAN/TKTFMCpdkmYoc8GvUzeUNxvBoOAzIliNAOT8ILIEI4PxuPcmegYArgHZ5UduFT
 +aIOQLIYToXxFRiGsGtYNydhidhfq6M6CInd0=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20120113;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type:x-gm-message-state;
 bh=FopMevzvql09R1/s/JZ631nLBBbBXgAgg/Ire3fARVM=;
 b=jjICCytMsJ7nrWJzlxh8fIl9CAGuYYLxHg+K9d0neuoZGyiNFgqtCedQSa6e0/TbLT
 BBXXTR0vK08H04U/WUe7hLJeAJtTB5SezMOUh8TEiUz5oH+od+RV1fhJYAIoNdmjz3Jo
 C9sHAJBIx1BCgZoYurbinyK5oUr01CyYoezFC2ykANydcer2V1Rl7ntoEwCuIrgMufHE
 Ke0Zg7smOxafhZ3fjHZbo3L+BiqeVVUgA0rZTONpF3CkOTnibztlHYUU6Wa0jUjn64Zm
 Kq0GgqTXpoKdVZ3F1DYJa3U0QJujQe143IjlALPlOSd9T0AM3zPzguBZ7tTlcbycoIvV
 xqbQ==
X-Received: by 10.220.109.66 with SMTP id i2mr18323439vcp.51.1369759233521;
 Tue, 28 May 2013 09:40:33 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.220.109.66 with SMTP id i2mr18323435vcp.51.1369759233457;
 Tue, 28 May 2013 09:40:33 -0700 (PDT)
Received: by 10.220.62.79 with HTTP; Tue, 28 May 2013 09:40:33 -0700 (PDT)
In-Reply-To: <EB3332B0-1EC2-49B2-9606-4DBC487F962B@recoil.org>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
 <20130527135355.GT19868@annexia.org>
 <CACLX4jQQDWvVgvzDnDYEAU_fD-iWjuS8tPmD1kzOV_c8N_1VcA@mail.gmail.com>
 <CAPYVAiK5eBTygqb=g6pXAv7n4QeMrjchr=_Hj0mpT9aObzptZw@mail.gmail.com>
 <EB3332B0-1EC2-49B2-9606-4DBC487F962B@recoil.org>
Date: Tue, 28 May 2013 12:40:33 -0400
Message-ID: <CAPYVAiKnvHL2D0mka6oA=1regBy-mpLV5oh0_8YJYnEMkdMq9g@mail.gmail.com>
From: Stephen Weeks <sweeks@janestreet.com>
To: "ocaml-core@googlegroups.com" <ocaml-core@googlegroups.com>
Content-Type: text/plain; charset=ISO-8859-1
X-Gm-Message-State: ALoCoQkGR3GoUpu0/U1BI4lI8H6xVSddBD7cy2h5vs3b4Cf4T9luqIL12wkjulYs1ldB9JtWpVPXACUQETHp52bEpi5pMurb46fkRFJGvKlr6k9uGQ7Xy4fxvJ1Ac6VmEZBgh7x57ljoz6mEWKsmnWUtMVYZbJ0XNw==
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 "Richard W.M. Jones" <rich@annexia.org>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 28 May 2013 16:30:08 -0000

> It's the build system integration that fills me with dread (figuring
> out the ocamlfind META runes, how to plumb this through to ocamlbuild,
> OASIS and OMake, and activate it only for files that use Core).

I see.  Waiting for namespaces might be the way to go then.

One way that might simplify the build-system nightmare a bit would be
to always have the Caml module in scope and to have bitstring always
generate references to it, whether or not one is compiling against
Core.

From mmatalka@gmail.com  Tue May 28 17:35:23 2013
Return-Path: <mmatalka@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 28FBB3C4DE
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 17:35:23 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1485974 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.182 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (mmatalka[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f182.google.com ([74.125.82.182]:44746)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UhN2M-0003Kw-8k (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <mmatalka@gmail.com>); Tue, 28 May 2013 17:46:15 +0100
Received: by mail-we0-f182.google.com with SMTP id q57so5257246wes.41
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 09:46:14 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type;
 bh=UCDZjxDx5vSZHAh/4RNlCcj88ectDhLaeNYTe2fFUWY=;
 b=bC56uZdlrnXnTJnK2wXen0lEUonAsMhZ9gb4KkV5dCBU/wPxPgjLHj/MXL/vWIKBCR
 Xh9DzHJSry+UxSJ+R3xdJ59DWLDFpI6mE2pDllKxBipd6SfoYTP6Dd/fFt5DW8koJVnT
 D+3gNB+HM6unDT1/65eid5P/x3a7qOzhkmctG94SRioX5VXNsbnPOXvsI84o0jvDsaha
 U74f7nUHWG5oHyTyPKZwHX8UOUwcCheGJ3iSv2jY7SHJk9zwN1Xl/ttypJ1gM4SRpxmw
 0TvpBHfAHRoSYpkcjwPzKxAXBgmvPJCLmjeHbs7tWLJugufGaFJNum+yzersfTtXQFos
 ASZQ==
MIME-Version: 1.0
X-Received: by 10.180.9.80 with SMTP id x16mr12629308wia.63.1369759574447;
 Tue, 28 May 2013 09:46:14 -0700 (PDT)
Received: by 10.194.123.231 with HTTP; Tue, 28 May 2013 09:46:14 -0700 (PDT)
Received: by 10.194.123.231 with HTTP; Tue, 28 May 2013 09:46:14 -0700 (PDT)
In-Reply-To: <CAPYVAiKnvHL2D0mka6oA=1regBy-mpLV5oh0_8YJYnEMkdMq9g@mail.gmail.com>
References: <0B92F09D-D94B-4DCF-8E07-ED278A27B058@recoil.org>
 <20130527135355.GT19868@annexia.org>
 <CACLX4jQQDWvVgvzDnDYEAU_fD-iWjuS8tPmD1kzOV_c8N_1VcA@mail.gmail.com>
 <CAPYVAiK5eBTygqb=g6pXAv7n4QeMrjchr=_Hj0mpT9aObzptZw@mail.gmail.com>
 <EB3332B0-1EC2-49B2-9606-4DBC487F962B@recoil.org>
 <CAPYVAiKnvHL2D0mka6oA=1regBy-mpLV5oh0_8YJYnEMkdMq9g@mail.gmail.com>
Date: Tue, 28 May 2013 18:46:14 +0200
Message-ID: <CAKziXDWB71Exxh1bDf9V78i6Et82qbFQSWG8e0x0-2BfgMke+w@mail.gmail.com>
From: Malcolm Matalka <mmatalka@gmail.com>
To: ocaml-core@googlegroups.com
Content-Type: multipart/alternative; boundary=001a11c21f84dcdd0904ddca00f5
Cc: wg-camlp4@lists.ocaml.org, "Richard W.M. Jones" <rich@annexia.org>
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 28 May 2013 16:35:23 -0000

--001a11c21f84dcdd0904ddca00f5
Content-Type: text/plain; charset=ISO-8859-1

I solved this for myself may by limiting the bitstring specific stuff to
their own function "let module Char = ...".
IMO the bigger issue is the error messages not making any sense than the
actual problem.

/Malcolm
 On May 28, 2013 6:40 PM, "Stephen Weeks" <sweeks@janestreet.com> wrote:

> > It's the build system integration that fills me with dread (figuring
> > out the ocamlfind META runes, how to plumb this through to ocamlbuild,
> > OASIS and OMake, and activate it only for files that use Core).
>
> I see.  Waiting for namespaces might be the way to go then.
>
> One way that might simplify the build-system nightmare a bit would be
> to always have the Caml module in scope and to have bitstring always
> generate references to it, whether or not one is compiling against
> Core.
>
> --
> You received this message because you are subscribed to the Google Groups
> "ocaml-core" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to ocaml-core+unsubscribe@googlegroups.com.
> For more options, visit https://groups.google.com/groups/opt_out.
>
>
>

--001a11c21f84dcdd0904ddca00f5
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<p dir=3D"ltr">I solved this for myself may by limiting the bitstring speci=
fic stuff to their own function &quot;let module Char =3D ...&quot;.<br>
IMO the bigger issue is the error messages not making any sense than the ac=
tual problem.</p>
<p dir=3D"ltr">/Malcolm<br>
</p>
<div class=3D"gmail_quote">On May 28, 2013 6:40 PM, &quot;Stephen Weeks&quo=
t; &lt;<a href=3D"mailto:sweeks@janestreet.com">sweeks@janestreet.com</a>&g=
t; wrote:<br type=3D"attribution"><blockquote class=3D"gmail_quote" style=
=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
&gt; It&#39;s the build system integration that fills me with dread (figuri=
ng<br>
&gt; out the ocamlfind META runes, how to plumb this through to ocamlbuild,=
<br>
&gt; OASIS and OMake, and activate it only for files that use Core).<br>
<br>
I see. =A0Waiting for namespaces might be the way to go then.<br>
<br>
One way that might simplify the build-system nightmare a bit would be<br>
to always have the Caml module in scope and to have bitstring always<br>
generate references to it, whether or not one is compiling against<br>
Core.<br>
<br>
--<br>
You received this message because you are subscribed to the Google Groups &=
quot;ocaml-core&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:ocaml-core%2Bunsubscribe@googlegroups.com">ocaml-=
core+unsubscribe@googlegroups.com</a>.<br>
For more options, visit <a href=3D"https://groups.google.com/groups/opt_out=
" target=3D"_blank">https://groups.google.com/groups/opt_out</a>.<br>
<br>
<br>
</blockquote></div>

--001a11c21f84dcdd0904ddca00f5--

From Christophe.TROESTLER@umons.ac.be  Tue May 28 18:43:01 2013
Return-Path: <Christophe.TROESTLER@umons.ac.be>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9BE603C4DE
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 18:43:01 +0100 (BST)
X-Cam-SpamDetails: score -1.1 from SpamAssassin-3.3.2-1485974 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.190.208.48 listed in list.dnswl.dnsbl.ja.net]
 * -1.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from tmgm2.umons.ac.be ([193.190.208.48]:7211)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1UhO5q-0007D6-0J (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <Christophe.TROESTLER@umons.ac.be>);
 Tue, 28 May 2013 18:53:54 +0100
Received: from EXCHANGEHUB1.umons.ac.be (10.104.2.76) by TMGM2.umons.ac.be
 (10.104.2.75) with Microsoft SMTP Server (TLS) id 14.3.123.3; Tue, 28 May
 2013 19:08:20 +0200
Received: from poincare (10.104.2.68) by smtp.umons.ac.be (10.104.2.84) with
 Microsoft SMTP Server (TLS) id 14.3.123.3; Tue, 28 May 2013 19:08:20 +0200
Received: from localhost ([::1])	by poincare with esmtp (Exim 4.80)
 (envelope-from <Christophe.Troestler@umons.ac.be>)	id 1UhNOG-0002rO-4f; Tue,
 28 May 2013 19:08:52 +0200
Date: Tue, 28 May 2013 19:08:51 +0200
Message-ID: <20130528.190851.152544037903305590.Christophe.Troestler@umons.ac.be>
To: <sweeks@janestreet.com>
From: Christophe TROESTLER <Christophe.Troestler@umons.ac.be>
In-Reply-To: <CAPYVAiKnvHL2D0mka6oA=1regBy-mpLV5oh0_8YJYnEMkdMq9g@mail.gmail.com>
References: <CAPYVAiK5eBTygqb=g6pXAv7n4QeMrjchr=_Hj0mpT9aObzptZw@mail.gmail.com>
 <EB3332B0-1EC2-49B2-9606-4DBC487F962B@recoil.org>
 <CAPYVAiKnvHL2D0mka6oA=1regBy-mpLV5oh0_8YJYnEMkdMq9g@mail.gmail.com>
X-Face: #2fb%mPx>rRL@4ff~TVgZ"<[:,oL"`TUEGK/[8/qb58~C>jR(x4A+v/n)7BgpEtIph_neoLKJBq0JBY9:<qMr[nclFSC*8GVW;
 &@q*7^R?u"i{y>}8v|j
Organization: Universite de Mons (http://math.umons.ac.be/anum/)
X-Mailer: Mew version 6.5 on Emacs 24.3 / Mule 6.0 (HANACHIRUSATO)
MIME-Version: 1.0
Content-Type: text/plain; charset="iso-8859-15"
Content-Transfer-Encoding: 8bit
X-Originating-IP: [10.104.2.68]
Cc: wg-camlp4@lists.ocaml.org, rich@annexia.org, ocaml-core@googlegroups.com
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 28 May 2013 17:43:01 -0000

On Tue, 28 May 2013 12:40:33 -0400, Stephen Weeks wrote:
> 
> > It's the build system integration that fills me with dread (figuring
> > out the ocamlfind META runes, how to plumb this through to ocamlbuild,
> > OASIS and OMake, and activate it only for files that use Core).
> 
> I see.  Waiting for namespaces might be the way to go then.
> 
> One way that might simplify the build-system nightmare a bit would be
> to always have the Caml module in scope and to have bitstring always
> generate references to it, whether or not one is compiling against
> Core.

How about that bitstring (automatically) inserts aliases of the
Prevasive modules it needs at the beginning of the file (thus, before
Core is opened) and refers to these?  It will then work regardless of
the modules that are shadowed.

My 0.02,
C.

From rich@annexia.org  Tue May 28 18:48:35 2013
Return-Path: <rich@annexia.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7D2CC3C4DE
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 18:48:35 +0100 (BST)
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.3 from SpamAssassin-3.3.2-1485974 
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [80.68.91.176] (port=44710 helo=furbychan.cocan.org)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UhOB8-0006S1-DJ (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <rich@annexia.org>); Tue, 28 May 2013 18:59:28 +0100
Received: from rich by furbychan.cocan.org with local (Exim 4.80)
 (envelope-from <rich@annexia.org>)
 id 1UhOAg-0004z3-BW; Tue, 28 May 2013 18:58:54 +0100
Date: Tue, 28 May 2013 18:58:54 +0100
From: "Richard W.M. Jones" <rich@annexia.org>
To: Christophe TROESTLER <Christophe.Troestler@umons.ac.be>
Message-ID: <20130528175854.GX19868@annexia.org>
References: <CAPYVAiK5eBTygqb=g6pXAv7n4QeMrjchr=_Hj0mpT9aObzptZw@mail.gmail.com>
 <EB3332B0-1EC2-49B2-9606-4DBC487F962B@recoil.org>
 <CAPYVAiKnvHL2D0mka6oA=1regBy-mpLV5oh0_8YJYnEMkdMq9g@mail.gmail.com>
 <20130528.190851.152544037903305590.Christophe.Troestler@umons.ac.be>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20130528.190851.152544037903305590.Christophe.Troestler@umons.ac.be>
User-Agent: Mutt/1.5.20 (2009-06-14)
Cc: wg-camlp4@lists.ocaml.org, sweeks@janestreet.com,
 ocaml-core@googlegroups.com
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 28 May 2013 17:48:35 -0000

On Tue, May 28, 2013 at 07:08:51PM +0200, Christophe TROESTLER wrote:
> On Tue, 28 May 2013 12:40:33 -0400, Stephen Weeks wrote:
> > 
> > > It's the build system integration that fills me with dread (figuring
> > > out the ocamlfind META runes, how to plumb this through to ocamlbuild,
> > > OASIS and OMake, and activate it only for files that use Core).
> > 
> > I see.  Waiting for namespaces might be the way to go then.
> > 
> > One way that might simplify the build-system nightmare a bit would be
> > to always have the Caml module in scope and to have bitstring always
> > generate references to it, whether or not one is compiling against
> > Core.
> 
> How about that bitstring (automatically) inserts aliases of the
> Prevasive modules it needs at the beginning of the file (thus, before
> Core is opened) and refers to these?  It will then work regardless of
> the modules that are shadowed.

I think I tried to have a camlp4 extension insert something at
the beginning of the output, and concluded it wasn't possible.

Or perhaps I'm mis-remembering ...?

Rich.

-- 
Richard Jones
Red Hat

From sebastien.mondet@gmail.com  Tue May 28 18:59:54 2013
Return-Path: <sebastien.mondet@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 7443A3C4DE
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 18:59:54 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1485974 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.176 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (sebastien.mondet[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f176.google.com ([209.85.212.176]:35936)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UhOMA-0001X4-Ek (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <sebastien.mondet@gmail.com>); Tue, 28 May 2013 19:10:47 +0100
Received: by mail-wi0-f176.google.com with SMTP id hr14so2782993wib.15
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 11:10:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:from:date:message-id:subject:to
 :cc:content-type;
 bh=VulmhC/dRVWWmwGmW2rCnbVvqyOhmo1EcuY3k9CCoNE=;
 b=o5lf/+CyM9aCtlK4T9CQHaAieLFX6AKN6ce3QQLWSBpIfhjlLeVGd1HxRy16CaPDvI
 gmWmTBPnv5Gz9cN9k6cP35vUGsgrzs2cMo+dwmaA0vCfFi0A8jocD/yEXL+phshH0uLf
 n5S4mBp0xhU9w/SS+7zkAwlOz8rJbren2tPrbrAtMMQlLIZu+0ROoB3DYDsBcd25qjhN
 3FSOTXYyNZL9UZbGUxc62yDFIgYADexgZc28VKKNU45OBWIei3np3jsByA5T8IgGfz+w
 h7iZzYa03HwdhXw5QqDUbq1oDMwvtmXUrrIUN4ncQuxazGyWc/Z8RniUUwAJaU4jJAAK
 hUbg==
X-Received: by 10.180.87.33 with SMTP id u1mr13258231wiz.34.1369764646268;
 Tue, 28 May 2013 11:10:46 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.194.134.201 with HTTP; Tue, 28 May 2013 11:10:26 -0700 (PDT)
In-Reply-To: <20130528175854.GX19868@annexia.org>
References: <CAPYVAiK5eBTygqb=g6pXAv7n4QeMrjchr=_Hj0mpT9aObzptZw@mail.gmail.com>
 <EB3332B0-1EC2-49B2-9606-4DBC487F962B@recoil.org>
 <CAPYVAiKnvHL2D0mka6oA=1regBy-mpLV5oh0_8YJYnEMkdMq9g@mail.gmail.com>
 <20130528.190851.152544037903305590.Christophe.Troestler@umons.ac.be>
 <20130528175854.GX19868@annexia.org>
From: Sebastien Mondet <sebastien.mondet@gmail.com>
Date: Tue, 28 May 2013 14:10:26 -0400
Message-ID: <CALScVYk13=e7JY-1vOgxkCQ3YoPeZLFR4ScXs6DovTw1h+Ep=g@mail.gmail.com>
To: "Richard W.M. Jones" <rich@annexia.org>
Content-Type: multipart/alternative; boundary=f46d044402b02ab3f404ddcb2f90
Cc: wg-camlp4@lists.ocaml.org, sweeks@janestreet.com,
 ocaml-core@googlegroups.com
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 28 May 2013 17:59:54 -0000

--f46d044402b02ab3f404ddcb2f90
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Hi

What would be wrong with Xavier's solution?
(having Bitstring =C2=AD=C2=ADcall only functions Bitstring.something)

It looks the most hygienic and future-proof to me, and could work for all
syntax extensions =E2=80=94 or code generators =E2=80=94 that have a librar=
y to work with
 (BTW, we had the same problem with PG'OCaml generating code with
String.concat which is different in Core).


cheers
seb




On Tue, May 28, 2013 at 1:58 PM, Richard W.M. Jones <rich@annexia.org>wrote=
:

> On Tue, May 28, 2013 at 07:08:51PM +0200, Christophe TROESTLER wrote:
> > On Tue, 28 May 2013 12:40:33 -0400, Stephen Weeks wrote:
> > >
> > > > It's the build system integration that fills me with dread (figurin=
g
> > > > out the ocamlfind META runes, how to plumb this through to
> ocamlbuild,
> > > > OASIS and OMake, and activate it only for files that use Core).
> > >
> > > I see.  Waiting for namespaces might be the way to go then.
> > >
> > > One way that might simplify the build-system nightmare a bit would be
> > > to always have the Caml module in scope and to have bitstring always
> > > generate references to it, whether or not one is compiling against
> > > Core.
> >
> > How about that bitstring (automatically) inserts aliases of the
> > Prevasive modules it needs at the beginning of the file (thus, before
> > Core is opened) and refers to these?  It will then work regardless of
> > the modules that are shadowed.
>
> I think I tried to have a camlp4 extension insert something at
> the beginning of the output, and concluded it wasn't possible.
>
> Or perhaps I'm mis-remembering ...?
>
> Rich.
>
> --
> Richard Jones
> Red Hat
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>

--f46d044402b02ab3f404ddcb2f90
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Hi<div><br><div style>What would be wrong with Xavier&#39;=
s solution?</div><div style>(having Bitstring =C2=AD=C2=ADcall only functio=
ns Bitstring.something)<br></div><div style><br></div><div style>It looks t=
he most hygienic and future-proof to me, and could work for all syntax exte=
nsions =E2=80=94 or code generators =E2=80=94 that have a library to work w=
ith</div>

<div style>=C2=A0(BTW, we had the same problem with PG&#39;OCaml generating=
 code with String.concat which is different in Core).</div><div style><br><=
/div><div style><br></div><div style>cheers</div><div style>seb</div><div s=
tyle>

<br></div><div style><br></div></div></div><div class=3D"gmail_extra"><br><=
br><div class=3D"gmail_quote">On Tue, May 28, 2013 at 1:58 PM, Richard W.M.=
 Jones <span dir=3D"ltr">&lt;<a href=3D"mailto:rich@annexia.org" target=3D"=
_blank">rich@annexia.org</a>&gt;</span> wrote:<br>

<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">On Tue, May 28, 2013 at 07=
:08:51PM +0200, Christophe TROESTLER wrote:<br>
&gt; On Tue, 28 May 2013 12:40:33 -0400, Stephen Weeks wrote:<br>
&gt; &gt;<br>
&gt; &gt; &gt; It&#39;s the build system integration that fills me with dre=
ad (figuring<br>
&gt; &gt; &gt; out the ocamlfind META runes, how to plumb this through to o=
camlbuild,<br>
&gt; &gt; &gt; OASIS and OMake, and activate it only for files that use Cor=
e).<br>
&gt; &gt;<br>
&gt; &gt; I see. =C2=A0Waiting for namespaces might be the way to go then.<=
br>
&gt; &gt;<br>
&gt; &gt; One way that might simplify the build-system nightmare a bit woul=
d be<br>
&gt; &gt; to always have the Caml module in scope and to have bitstring alw=
ays<br>
&gt; &gt; generate references to it, whether or not one is compiling agains=
t<br>
&gt; &gt; Core.<br>
&gt;<br>
&gt; How about that bitstring (automatically) inserts aliases of the<br>
&gt; Prevasive modules it needs at the beginning of the file (thus, before<=
br>
&gt; Core is opened) and refers to these? =C2=A0It will then work regardles=
s of<br>
&gt; the modules that are shadowed.<br>
<br>
</div>I think I tried to have a camlp4 extension insert something at<br>
the beginning of the output, and concluded it wasn&#39;t possible.<br>
<br>
Or perhaps I&#39;m mis-remembering ...?<br>
<div class=3D"HOEnZb"><div class=3D"h5"><br>
Rich.<br>
<br>
--<br>
Richard Jones<br>
Red Hat<br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br></div>

--f46d044402b02ab3f404ddcb2f90--

From rich@annexia.org  Tue May 28 20:03:08 2013
Return-Path: <rich@annexia.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id DE27D3C4DE
 for <wg-camlp4@lists.ocaml.org>; Tue, 28 May 2013 20:03:08 +0100 (BST)
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.3 from SpamAssassin-3.3.2-1485974 
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [80.68.91.176] (port=43726 helo=furbychan.cocan.org)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1UhPLI-0006h8-89 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <rich@annexia.org>); Tue, 28 May 2013 20:14:01 +0100
Received: from rich by furbychan.cocan.org with local (Exim 4.80)
 (envelope-from <rich@annexia.org>)
 id 1UhPKr-0005DL-7x; Tue, 28 May 2013 20:13:29 +0100
Date: Tue, 28 May 2013 20:13:29 +0100
From: "Richard W.M. Jones" <rich@annexia.org>
To: Sebastien Mondet <sebastien.mondet@gmail.com>
Message-ID: <20130528191329.GY19868@annexia.org>
References: <CAPYVAiK5eBTygqb=g6pXAv7n4QeMrjchr=_Hj0mpT9aObzptZw@mail.gmail.com>
 <EB3332B0-1EC2-49B2-9606-4DBC487F962B@recoil.org>
 <CAPYVAiKnvHL2D0mka6oA=1regBy-mpLV5oh0_8YJYnEMkdMq9g@mail.gmail.com>
 <20130528.190851.152544037903305590.Christophe.Troestler@umons.ac.be>
 <20130528175854.GX19868@annexia.org>
 <CALScVYk13=e7JY-1vOgxkCQ3YoPeZLFR4ScXs6DovTw1h+Ep=g@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <CALScVYk13=e7JY-1vOgxkCQ3YoPeZLFR4ScXs6DovTw1h+Ep=g@mail.gmail.com>
User-Agent: Mutt/1.5.20 (2009-06-14)
Cc: wg-camlp4@lists.ocaml.org, sweeks@janestreet.com,
 ocaml-core@googlegroups.com
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 28 May 2013 19:03:08 -0000

On Tue, May 28, 2013 at 02:10:26PM -0400, Sebastien Mondet wrote:
> Hi
> 
> What would be wrong with Xavier's solution?
> (having Bitstring call only functions Bitstring.something)

This seems like a good solution to me.

As ever, patches are welcome ...

Rich.

-- 
Richard Jones
Red Hat

From Christophe.TROESTLER@umons.ac.be  Wed May 29 22:44:13 2013
Return-Path: <Christophe.TROESTLER@umons.ac.be>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C5B6B3C508
 for <wg-camlp4@lists.ocaml.org>; Wed, 29 May 2013 22:44:13 +0100 (BST)
X-Cam-SpamDetails: score -1.1 from SpamAssassin-3.3.2-1485974 
 * -1.1 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from tmgm1.umons.ac.be ([193.190.208.47]:59923)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1UhoKr-0000WL-hc (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <Christophe.TROESTLER@umons.ac.be>);
 Wed, 29 May 2013 22:55:10 +0100
Received: from EXCHANGEHUB1.umons.ac.be (10.104.2.76) by TMGM1.umons.ac.be
 (10.104.2.74) with Microsoft SMTP Server (TLS) id 14.3.123.3; Tue, 28 May
 2013 21:44:26 +0200
Received: from poincare (10.104.2.68) by smtp.umons.ac.be (10.104.2.84) with
 Microsoft SMTP Server (TLS) id 14.3.123.3; Tue, 28 May 2013 21:44:26 +0200
Received: from localhost ([::1])	by poincare with esmtp (Exim 4.80)
 (envelope-from <Christophe.Troestler@umons.ac.be>)	id 1UhPpV-0004m8-0H; Tue,
 28 May 2013 21:45:09 +0200
Date: Tue, 28 May 2013 21:45:08 +0200
Message-ID: <20130528.214508.1024658094749643084.Christophe.Troestler@umons.ac.be>
To: <sebastien.mondet@gmail.com>
From: Christophe TROESTLER <Christophe.Troestler@umons.ac.be>
In-Reply-To: <CALScVYk13=e7JY-1vOgxkCQ3YoPeZLFR4ScXs6DovTw1h+Ep=g@mail.gmail.com>
References: <20130528.190851.152544037903305590.Christophe.Troestler@umons.ac.be>
 <20130528175854.GX19868@annexia.org>
 <CALScVYk13=e7JY-1vOgxkCQ3YoPeZLFR4ScXs6DovTw1h+Ep=g@mail.gmail.com>
X-Face: #2fb%mPx>rRL@4ff~TVgZ"<[:,oL"`TUEGK/[8/qb58~C>jR(x4A+v/n)7BgpEtIph_neoLKJBq0JBY9:<qMr[nclFSC*8GVW;
 &@q*7^R?u"i{y>}8v|j
Organization: Universite de Mons (http://math.umons.ac.be/anum/)
X-Mailer: Mew version 6.5 on Emacs 24.3 / Mule 6.0 (HANACHIRUSATO)
MIME-Version: 1.0
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: 8bit
X-Originating-IP: [10.104.2.68]
Cc: wg-camlp4@lists.ocaml.org, sweeks@janestreet.com, rich@annexia.org,
 ocaml-core@googlegroups.com
Subject: Re: [wg-camlp4] getting bitstring to work with Core
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 29 May 2013 21:44:13 -0000

On Tue, 28 May 2013 14:10:26 -0400, Sebastien Mondet wrote:
> 
> What would be wrong with Xavier's solution?
> (having Bitstring call only functions Bitstring.something)

Yes, aliasing the needed functions in Bitstring is also a good
solution.  I think it is even better than my suggestion.

> On Tue, May 28, 2013 at 1:58 PM, Richard W.M. Jones <rich@annexia.org> wrote:
> 
> > 
> On Tue, May 28, 2013 at 07:08:51PM +0200, Christophe TROESTLER wrote:
> > > On Tue, 28 May 2013 12:40:33 -0400, Stephen Weeks wrote:
> > > >
> > > > > It's the build system integration that fills me with dread (figuring
> > > > > out the ocamlfind META runes, how to plumb this through to ocamlbuild,
> > > > > OASIS and OMake, and activate it only for files that use Core).
> > > >
> > > > I see.  Waiting for namespaces might be the way to go then.
> > > >
> > > > One way that might simplify the build-system nightmare a bit would be
> > > > to always have the Caml module in scope and to have bitstring always
> > > > generate references to it, whether or not one is compiling against
> > > > Core.
> > >
> > > How about that bitstring (automatically) inserts aliases of the
> > > Prevasive modules it needs at the beginning of the file (thus, before
> > > Core is opened) and refers to these?  It will then work regardless of
> > > the modules that are shadowed.
> > 
> > 
> I think I tried to have a camlp4 extension insert something at
> > the beginning of the output, and concluded it wasn't possible.
> > 
> > Or perhaps I'm mis-remembering ...?

It is possible.

Best,
C.

From romain.bardou@inria.fr  Tue Jun  4 09:57:23 2013
Return-Path: <romain.bardou@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6FC463C506
 for <wg-camlp4@lists.ocaml.org>; Tue,  4 Jun 2013 09:57:23 +0100 (BST)
X-Cam-SpamDetails: score -5.5 from SpamAssassin-3.3.2-1488897 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.104 listed in list.dnswl.dnsbl.ja.net]
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail3-relais-sop.national.inria.fr ([192.134.164.104]:32018)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1UjnEL-0003r4-EF (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <romain.bardou@inria.fr>); Tue, 04 Jun 2013 10:08:38 +0100
X-IronPort-AV: E=Sophos;i="4.87,798,1363129200"; d="scan'208";a="16681921"
Received: from unknown (HELO [10.1.202.3]) ([194.254.61.161])
 by mail3-relais-sop.national.inria.fr with ESMTP/TLS/DHE-RSA-CAMELLIA256-SHA;
 04 Jun 2013 11:08:36 +0200
Message-ID: <51ADAE94.1050106@inria.fr>
Date: Tue, 04 Jun 2013 11:08:36 +0200
From: Romain Bardou <romain.bardou@inria.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:10.0.12) Gecko/20130116 Icedove/10.0.12
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
X-Enigmail-Version: 1.4.1
Content-Type: text/plain; charset=windows-1252
Content-Transfer-Encoding: 8bit
Subject: [wg-camlp4] Status of extension_points extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 04 Jun 2013 08:57:23 -0000

Dear wg-camlp4,

Recently Alain has impressively shown great examples of extension_points
in action.

- An extension to generate .mli files from .ml files with annotations
such as "this type should be abstract":

[@@mli abstract]

(Alain does *not* endorse the idea of generating .mli files
automatically, this is just a proof-of-concept!)

- an extension to put ocamldoc-like comments, added not as comments but
as extension points (making it more clear that the comment is attached
to a given node in the parsetree):

[@@doc "This is an internal module."]

- an extension to copy a type definition from the .mli to the .ml

type t = [%copy_typedef]

The syntax makes it very clear that extensions are not part of the
language and are extensions. This is good. However, it also means that
if the extension proves so useful that we want it part of the actual
language, we are left with the following choices:
- provide the extension as-is;
- reprogram the extension with a dedicated syntax.

If we provide the extension as-is, the fact that the syntax says it is
an extension suddenly is a problem because it is not actually an
extension anymore if it is part of the language. Moreover the syntax may
not be ideal. And if this approach is used, and several extensions are
included, we may end up with programs which are cluttered with brackets,
so to speak.

If, on the other hand, we reprogram the extension, we are able to
provide a nicer syntax. For instance, just write "abstract" instead of
"[@@mli abstract]". But it means more work and we would not know what to
do with programs that used the extension before: rewrite them with the
new syntax? Keep using the extension, which will probably no longer be
maintained if it is part of the language?

Until now, I saw extension_points as a very nice way to experiment with
language extensions, and to provide custom, project-local extensions.
But Alain just showed how powerful it is and my fear is now that,
paradoxically, we and up with a lot of very useful extensions that would
almost become need-to-haves and with the drawback that for many of them
the syntax would not be ideal.

Has this issue already been discussed?

That being said, it is a problem which is rather good to have.

Cheers,

-- 
Romain Bardou

From alain.frisch@lexifi.com  Wed Jun  5 09:17:22 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 722753C3EF
 for <wg-camlp4@lists.ocaml.org>; Wed,  5 Jun 2013 09:17:22 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1489338 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:19767
 helo=msa.smtpout.orange.fr)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1Uk95D-0001da-FZ (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 05 Jun 2013 09:28:40 +0100
Received: from [192.168.1.116] ([92.151.120.247]) by mwinf5d54 with ME
 id kYUd1l00N5LMejg03YUehK; Wed, 05 Jun 2013 10:28:39 +0200
Message-ID: <51AEF6B5.3050404@lexifi.com>
Date: Wed, 05 Jun 2013 10:28:37 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:22.0) Gecko/20100101 Thunderbird/22.0
MIME-Version: 1.0
To: Romain Bardou <romain.bardou@inria.fr>, wg-camlp4@lists.ocaml.org
References: <51ADAE94.1050106@inria.fr>
In-Reply-To: <51ADAE94.1050106@inria.fr>
Content-Type: text/plain; charset=windows-1252; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] Status of extension_points extensions
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 05 Jun 2013 08:17:22 -0000

On 06/04/2013 11:08 AM, Romain Bardou wrote:
> The syntax makes it very clear that extensions are not part of the
> language and are extensions. This is good. However, it also means that
> if the extension proves so useful that we want it part of the actual
> language, we are left with the following choices:
> - provide the extension as-is;
> - reprogram the extension with a dedicated syntax.

I don't think that many of the syntactic tools implemented currently 
with Camlp4 or later with -ppx/extension_points will be seriously 
considered for integration into OCaml.

If we look at existing Camlp4 extensions, very few made their way into 
the language.  I can actually only think of one example, pa_open_in => 
"let open ... in" (the syntax changed lightly).  And I don't see any 
obvious other candidates for integration into the language.

So I'm not sure the question you raise will be of huge practical importance.

> If we provide the extension as-is, the fact that the syntax says it is
> an extension suddenly is a problem because it is not actually an
> extension anymore if it is part of the language. Moreover the syntax may
> not be ideal. And if this approach is used, and several extensions are
> included, we may end up with programs which are cluttered with brackets,
> so to speak.

For "extension nodes", indeed, it would be very weird to have some of 
them supported natively.  For attributes, I'm less sure.  Java or C#, 
for instance, have notions of attributes/meta-data attached to methods 
and classes; some of them are interpreted by external tools, but some of 
them are given a built-in interpretation by the compiler.  I wouldn't be 
shocked if, at some point, the OCaml compilers started to interpret some 
attributes to drive optimizations or to tweak the OCaml FFI calling 
convention, for instance.  This needs to be discussed, though.

> If, on the other hand, we reprogram the extension, we are able to
> provide a nicer syntax. For instance, just write "abstract" instead of
> "[@@mli abstract]". But it means more work and we would not know what to
> do with programs that used the extension before: rewrite them with the
> new syntax? Keep using the extension, which will probably no longer be
> maintained if it is part of the language?

The extension will probably become straightforward, mapping directly to 
the new built-in construction; so maintaining it would be very simple.

> Until now, I saw extension_points as a very nice way to experiment with
> language extensions, and to provide custom, project-local extensions.

Extension_points can certainly help to experiment with new language 
features, but maybe not in the way you suggest.  In particular, most new 
interesting language features expect some special support in the 
type-checker and/or the backend.  Extension_points can help by allowing 
the people working on such an extension to focus on the interesting part 
(type-checker / back-end) without having to adapt the parser, the 
Parsetree and all the code relying on it (including Camlp4 if they want 
to be able to try their new extension on large code base which require 
Camlp4).

Project-local extensions are also certainly a good candidate for using 
extension_points.  But the main goal of extension_points, in my mind, is 
to support "syntactic tools" which, most of the time, clearly don't 
deserve to be part of the core language, and where a slightly "foreign" 
syntax is not a big deal.  These tools can be code generators (such as 
type-conv/deriving, or bitstring/ulex), code analyzers which require 
some annotations (such as Bisect), or tools which need to extract 
(annotated) information for external use (such as ocamldoc, or an FFI 
generator).



Cheers,

Alain

From alain@frisch.fr  Mon Jul 22 16:14:06 2013
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A080B3C1C6
 for <wg-camlp4@lists.ocaml.org>; Mon, 22 Jul 2013 16:14:06 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1505312 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:34922
 helo=msa.smtpout.orange.fr)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1V1I1m-0000uz-Db (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Mon, 22 Jul 2013 16:27:59 +0100
Received: from [192.168.1.111] ([92.151.112.23]) by mwinf5d48 with ME
 id 3TTx1m0070WLdRo03TTxnU; Mon, 22 Jul 2013 17:27:57 +0200
Message-ID: <51ED4F7C.60000@frisch.fr>
Date: Mon, 22 Jul 2013 17:27:56 +0200
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:23.0) Gecko/20100101 Thunderbird/23.0
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
In-Reply-To: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
 for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 22 Jul 2013 15:14:06 -0000

On 05/01/2013 04:44 PM, Gabriel Scherer wrote:
> the piece of code
> we want to parse (<patt> when <expr>) is not syntactically an
> expression. [%matches <patt> when <expr>] would be rejected by the
> parser.

On 05/04/2013 03:27 PM, Leo White wrote:
 > This would
 > allow the example above to be represented as:
 >
 >    [%line: < seq: Line.present; source: Line.present >]


I've extended the branch to support more kinds of payload to 
attributes/extension nodes.  The payload can now be:

   - a structure (including the case of an empty payload and a payload 
reduced to a single expression);

   - a type expression prefixed with ':';

   - a pattern expression prefixed with '?' and optionally followed by a 
'when' clause.

A sum type is used internally to represent the three cases in the Parsetree.

Gabriel's examples could now be written

    [%matches? <patt>]
    [%matches? <patt> when <expr>]

and Leo's example works as-is:

    [%line: < seq: Line.present; source: Line.present >]



-- Alain

From tews@os.inf.tu-dresden.de  Thu Aug 22 13:05:58 2013
Return-Path: <tews@os.inf.tu-dresden.de>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 645773C350
 for <wg-camlp4@lists.ocaml.org>; Thu, 22 Aug 2013 13:05:58 +0100 (BST)
X-Cam-SpamDetails: score -5.1 from SpamAssassin-3.3.2-1516113 
 * -2.8 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 * -2.3 RCVD_IN_DNSWL_MED RBL: Sender listed at http://www.dnswl.org/,
 *      medium trust
 *      [141.76.48.99 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from os.inf.tu-dresden.de ([141.76.48.99]:46196)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1VCTtK-0000Tv-FR (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <tews@os.inf.tu-dresden.de>); Thu, 22 Aug 2013 13:21:32 +0100
Received: from [2002:8d4c:3001:48:222:68ff:fe19:71d]
 (helo=blau.inf.tu-dresden.de)
 by os.inf.tu-dresden.de with esmtpsa (TLSv1:DHE-RSA-AES128-SHA:128) (Exim
 4.80.1) id 1VCTtK-00015S-Bs
 for wg-camlp4@lists.ocaml.org; Thu, 22 Aug 2013 14:21:30 +0200
Received: from tews by blau.inf.tu-dresden.de with local (Exim 4.80)
 (envelope-from <tews@os.inf.tu-dresden.de>) id 1VCTtJ-0007MX-LE
 for wg-camlp4@lists.ocaml.org; Thu, 22 Aug 2013 14:21:29 +0200
From: Hendrik Tews <tews@os.inf.tu-dresden.de>
To: wg-camlp4@lists.ocaml.org
References: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
 <512B2F2C.9090308@lexifi.com>
Date: Thu, 22 Aug 2013 14:21:29 +0200
In-Reply-To: <512B2F2C.9090308@lexifi.com> (Alain Frisch's message of "Mon, 25
 Feb 2013 10:30:20 +0100")
Message-ID: <6x38q1ykza.fsf_-_@blau.inf.tu-dresden.de>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Subject: [wg-camlp4] parse_with_ppx [was: My no-use of camlp4 syntax
	extensions for Otags]
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 22 Aug 2013 12:05:58 -0000

Hi,

a long time ago I asked about function parse_with_ppx, that takes
a file name, applies -pp preprocessors, parses the result,
applies -ppx preprocessors and returns the syntax tree.

Is such a function available in 4.01 beta? Or, could somebody
point me to the relevant code in ocamlc/ocamlopt that does that?

(I need this functionality to port otags from camlp4 to -ppx.)


Here is some background from the "my no-use ..." thread:

I wrote:

   > ... it would be nice, if the compilerlibs could
   > provide a function parse_with_ppx, or everything that is needed
   > for writing it. parse_with_ppx takes a filename and a list of
   > preprocessor names, parses the file, runs all preprocessors and
   > returns the ast.

Alain ansered:

   This is already the case, you can do something like:

     let inputfile = Pparse.preprocess sourcefile in
     let ast =
      Pparse.file ppf inputfile Parse.implementation ast_impl_magic_number
     in
     ...
     Pparse.remove_preprocessed inputfile

   Maybe we should encapsulate the code above as a single function (with
   proper support for errors, i.e. removing the temporary file produced
   by the -pp preprocessor in case of error).

I answered again:

   I would prefer something that automatically deals with temporary
   files but raises errors as exceptions together with a function
   that converts these exceptions into proper error messages. 


Bye,

Hendrik

From alain.frisch@lexifi.com  Thu Aug 29 12:45:10 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4664F3C0BA
 for <wg-camlp4@lists.ocaml.org>; Thu, 29 Aug 2013 12:45:10 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1518106 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:24745
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VF0uQ-0008Cc-8A (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 29 Aug 2013 13:01:06 +0100
Received: from [192.168.1.118] ([92.151.8.47]) by mwinf5d38 with ME
 id Jc141m00M10tCGU03c15G7; Thu, 29 Aug 2013 14:01:05 +0200
Message-ID: <521F3802.1030708@lexifi.com>
Date: Thu, 29 Aug 2013 14:01:06 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.0
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>, 
 Caml-Devel <caml-devel@yquem.inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] extension_points merged in trunk
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 29 Aug 2013 11:45:10 -0000

Dear all,

I've merged the extension_points back into the trunk.  This does not 
mean that the work on it is finished, nor that the syntax and other 
design choices are necessarily final.  Merging the branch now will give 
it more visibility and avoid merge conflicts.  The next official release 
created from the trunk (which will be called 4.02) will probably happen 
in about one year, which gives ample time to polish the work and 
document it.

One of the most important remaining task is to adapt Camlp4.  Nothing 
critical in itself, since it works fine, but it doesn't fully support 
the new syntactic features.  Currently, its AST and parsers support 
attributes only on some syntactic categories.  This needs to be cleaned 
up and finished.  I hope some people will be able to contribute!  (Hongbo?)


Alain

From alain.frisch@lexifi.com  Fri Aug 30 15:42:23 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0AD963C342
 for <wg-camlp4@lists.ocaml.org>; Fri, 30 Aug 2013 15:42:23 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1518538 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.211 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa02.smtpout.orange.fr ([193.252.23.211]:16907
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VFQ9W-0004MU-7I (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 30 Aug 2013 15:58:23 +0100
Received: from [192.168.1.118] ([92.151.8.47]) by mwinf5d26 with ME
 id K2yF1m00G10tCGU032yFzR; Fri, 30 Aug 2013 16:58:16 +0200
Message-ID: <5220B302.7060406@lexifi.com>
Date: Fri, 30 Aug 2013 16:58:10 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>, 
 wg-camlp4@lists.ocaml.org
References: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
In-Reply-To: <CAPFanBG3iR850B=sKRzbcJ2j1mphQM2Xo5ipEbvbvrqco7q=yA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: rixed@happyleptic.org
Subject: Re: [wg-camlp4] Negative field report: extension points unsuited
 for (matches p when e)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 30 Aug 2013 14:42:23 -0000

On 05/01/2013 04:44 PM, Gabriel Scherer wrote:
 > The recent caml-list message by rixed (archived below) motivated me to
 > get pa_matches in shape (it lacked support for "when ..."), and try to
 > see how a similar extension could be implemented with the new
 > extension_points branch.

Here is a version of ppx_matches using the new form of payload for 
extension nodes:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/experimental/frisch/ppx_matches.ml?revision=HEAD&view=markup

and an example using it:

http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/experimental/frisch/test_matches.ml?revision=HEAD&view=markup

Alain

From anil@recoil.org  Mon Sep  9 10:58:59 2013
Return-Path: <anil@recoil.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 40B093C0A0
 for <wg-camlp4@lists.ocaml.org>; Mon,  9 Sep 2013 10:58:59 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1520845
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from recoil.dh.bytemark.co.uk ([89.16.177.154]:20281
 helo=dark.recoil.org)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with smtp id 1VIyVG-0005Ro-iA (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <anil@recoil.org>); Mon, 09 Sep 2013 11:15:31 +0100
Received: (qmail 11790 invoked by uid 634); 9 Sep 2013 10:15:29 -0000
X-Spam-Level: *
X-Spam-Status: No, hits=-1.0 required=5.0
	tests=ALL_TRUSTED
X-Spam-Check-By: dark.recoil.org
Received: from volstagg-0.srg.cl.cam.ac.uk (HELO clink.office) (128.232.32.232)
 (smtp-auth username remote@recoil.org, mechanism cram-md5)
 by dark.recoil.org (qpsmtpd/0.84) with ESMTPA; Mon, 09 Sep 2013 11:15:28 +0100
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Mac OS X Mail 6.5 \(1508\))
From: Anil Madhavapeddy <anil@recoil.org>
In-Reply-To: <521F3802.1030708@lexifi.com>
Date: Mon, 9 Sep 2013 11:15:29 +0100
Content-Transfer-Encoding: quoted-printable
Message-Id: <AF919896-C05A-4808-BEF2-F33A734AC4D9@recoil.org>
References: <521F3802.1030708@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1508)
X-Virus-Checked: Checked by ClamAV on dark.recoil.org
Cc: wg-camlp4@lists.ocaml.org, Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] extension_points merged in trunk
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 09 Sep 2013 09:58:59 -0000

On 29 Aug 2013, at 13:01, Alain Frisch <alain.frisch@lexifi.com> wrote:

> Dear all,
>=20
> I've merged the extension_points back into the trunk.  This does not =
mean that the work on it is finished, nor that the syntax and other =
design choices are necessarily final.  Merging the branch now will give =
it more visibility and avoid merge conflicts.  The next official release =
created from the trunk (which will be called 4.02) will probably happen =
in about one year, which gives ample time to polish the work and =
document it.
>=20
> One of the most important remaining task is to adapt Camlp4.  Nothing =
critical in itself, since it works fine, but it doesn't fully support =
the new syntactic features.  Currently, its AST and parsers support =
attributes only on some syntactic categories.  This needs to be cleaned =
up and finished.  I hope some people will be able to contribute!  =
(Hongbo?)

Great news!  I'll do some garbage collection on the OPAM switches then =
-- we no longer need the 4.01.0dev+extension_points switch, so I'll =
remove that in favour of the vanilla 4.02.0dev trunk unless you have any =
objections.

-anil=

From alain.frisch@lexifi.com  Mon Sep  9 12:01:10 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 40CC73C250
 for <wg-camlp4@lists.ocaml.org>; Mon,  9 Sep 2013 12:01:10 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1520845 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.215 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa06.smtpout.orange.fr ([193.252.23.215]:48412
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VIzTS-00081O-82 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 09 Sep 2013 12:17:42 +0100
Received: from [192.168.1.112] ([92.151.61.120]) by mwinf5d21 with ME
 id NzHg1m0032bfMm403zHgkY; Mon, 09 Sep 2013 13:17:41 +0200
Message-ID: <522DAE56.5010602@lexifi.com>
Date: Mon, 09 Sep 2013 13:17:42 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.0
MIME-Version: 1.0
To: Anil Madhavapeddy <anil@recoil.org>
References: <521F3802.1030708@lexifi.com>
 <AF919896-C05A-4808-BEF2-F33A734AC4D9@recoil.org>
In-Reply-To: <AF919896-C05A-4808-BEF2-F33A734AC4D9@recoil.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] extension_points merged in trunk
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 09 Sep 2013 11:01:10 -0000

On 09/09/2013 12:15 PM, Anil Madhavapeddy wrote:
> Great news!  I'll do some garbage collection on the OPAM switches
> then -- we no longer need the 4.01.0dev+extension_points switch, so
> I'll remove that in favour of the vanilla 4.02.0dev trunk unless you
> have any objections.

It's definitely a good idea.  The branch is indeed closed and remaining 
work will be done on the trunk.


-- Alain

From wojciech.meyer@gmail.com  Mon Sep  9 14:07:54 2013
Return-Path: <wojciech.meyer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 12BBB3C250
 for <wg-camlp4@lists.ocaml.org>; Mon,  9 Sep 2013 14:07:54 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1520845 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.182 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (wojciech.meyer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ob0-f182.google.com ([209.85.214.182]:46104)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1VJ1S6-00076G-0Y (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <wojciech.meyer@gmail.com>); Mon, 09 Sep 2013 14:24:26 +0100
Received: by mail-ob0-f182.google.com with SMTP id wo10so5803895obc.41
 for <wg-camlp4@lists.ocaml.org>; Mon, 09 Sep 2013 06:24:25 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type;
 bh=4ONoyMGXPaGQ4FP09l5noKukLkFOYyLOU/Ckmy4PPiA=;
 b=zFqIDzFNaSR9gReVsyEg2rjV6f9L+BRXfWbnk3KN8r+JYqY+hqEQ2tk8J7xOiX47JE
 9DCCHrMcu6Oin1xuPLh3aGmjoPZvj5qBI8ZyAnLb074WOalyMwQPrhapQvPCXkucQAVA
 J4Qv0ezFqBp/HqXtDY8MFmp51P7lGWG4ESwY1A0CIjQePQc87ujwyUGSS8jhvF7xySyb
 sGKmoeGgfklGlnsruxsQw08V6tjvsRIGZrfOhXyN35A2ZlbrlB2Wa+mnMgphQVJ4MxlW
 wOBygtal7HeKKduv+uM6J52jGoufzIzhL59CHV1b1ndrN707N5JFIodaNOqan5zf7UXp
 REQQ==
MIME-Version: 1.0
X-Received: by 10.60.42.3 with SMTP id j3mr66920oel.70.1378733065117; Mon, 09
 Sep 2013 06:24:25 -0700 (PDT)
Received: by 10.182.120.102 with HTTP; Mon, 9 Sep 2013 06:24:25 -0700 (PDT)
In-Reply-To: <522DAE56.5010602@lexifi.com>
References: <521F3802.1030708@lexifi.com>
 <AF919896-C05A-4808-BEF2-F33A734AC4D9@recoil.org>
 <522DAE56.5010602@lexifi.com>
Date: Mon, 9 Sep 2013 14:24:25 +0100
Message-ID: <CAOg1smBazGaF88MQNGWK8DXk0_Ewwe=OS7c0LihJ2enn6_J4YA@mail.gmail.com>
From: Wojciech Meyer <wojciech.meyer@gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=089e0149540296388204e5f34ee1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] extension_points merged in trunk
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 09 Sep 2013 13:07:54 -0000

--089e0149540296388204e5f34ee1
Content-Type: text/plain; charset=ISO-8859-1

Hi Alain & Anil,

Is anybody is planing to host a wiki (on github?) how to use new
language extension engine? It would be good to as soon as possible so
people may start writing new extensions, or porting old Camlp4. I know
there is a document in experimental directory.

Alain Frisch <alain.frisch@lexifi.com> writes:

> On 09/09/2013 12:15 PM, Anil Madhavapeddy wrote:
>> Great news!  I'll do some garbage collection on the OPAM switches
>> then -- we no longer need the 4.01.0dev+extension_points switch, so
>> I'll remove that in favour of the vanilla 4.02.0dev trunk unless you
>> have any objections.
>
> It's definitely a good idea.  The branch is indeed closed and
> remaining work will be done on the trunk.
>
>
> -- Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

--
Wojciech



On Mon, Sep 9, 2013 at 12:17 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> On 09/09/2013 12:15 PM, Anil Madhavapeddy wrote:
>
>> Great news!  I'll do some garbage collection on the OPAM switches
>> then -- we no longer need the 4.01.0dev+extension_points switch, so
>> I'll remove that in favour of the vanilla 4.02.0dev trunk unless you
>> have any objections.
>>
>
> It's definitely a good idea.  The branch is indeed closed and remaining
> work will be done on the trunk.
>
>
> -- Alain
>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>

--089e0149540296388204e5f34ee1
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div>Hi Alain &amp; Anil,</div><div><br></div><div>Is anyb=
ody is planing to host a wiki (on github?) how to use new</div><div>languag=
e extension engine? It would be good to as soon as possible so</div><div>pe=
ople may start writing new extensions, or porting old Camlp4. I know</div>
<div>there is a document in experimental directory.</div><div><br></div><di=
v>Alain Frisch &lt;<a href=3D"mailto:alain.frisch@lexifi.com">alain.frisch@=
lexifi.com</a>&gt; writes:</div><div><br></div><div>&gt; On 09/09/2013 12:1=
5 PM, Anil Madhavapeddy wrote:</div>
<div>&gt;&gt; Great news! =A0I&#39;ll do some garbage collection on the OPA=
M switches</div><div>&gt;&gt; then -- we no longer need the 4.01.0dev+exten=
sion_points switch, so</div><div>&gt;&gt; I&#39;ll remove that in favour of=
 the vanilla 4.02.0dev trunk unless you</div>
<div>&gt;&gt; have any objections.</div><div>&gt;</div><div>&gt; It&#39;s d=
efinitely a good idea. =A0The branch is indeed closed and</div><div>&gt; re=
maining work will be done on the trunk.</div><div>&gt;</div><div>&gt;</div>
<div>&gt; -- Alain</div><div>&gt; _________________________________________=
______</div><div>&gt; wg-camlp4 mailing list</div><div>&gt; <a href=3D"mail=
to:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a></div><div>&gt; =
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4">http://lists.ocaml.or=
g/listinfo/wg-camlp4</a></div>
<div><br></div><div>--</div><div>Wojciech</div><div><br></div></div><div cl=
ass=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Mon, Sep 9, 2013 =
at 12:17 PM, Alain Frisch <span dir=3D"ltr">&lt;<a href=3D"mailto:alain.fri=
sch@lexifi.com" target=3D"_blank">alain.frisch@lexifi.com</a>&gt;</span> wr=
ote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">On 09/09/2013 12:15 PM, An=
il Madhavapeddy wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Great news! =A0I&#39;ll do some garbage collection on the OPAM switches<br>
then -- we no longer need the 4.01.0dev+extension_points switch, so<br>
I&#39;ll remove that in favour of the vanilla 4.02.0dev trunk unless you<br=
>
have any objections.<br>
</blockquote>
<br></div>
It&#39;s definitely a good idea. =A0The branch is indeed closed and remaini=
ng work will be done on the trunk.<span class=3D"HOEnZb"><font color=3D"#88=
8888"><br>
<br>
<br>
-- Alain</font></span><div class=3D"HOEnZb"><div class=3D"h5"><br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br></div>

--089e0149540296388204e5f34ee1--

From alain.frisch@lexifi.com  Tue Sep 10 15:06:11 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 6CF9A3C0A0
 for <wg-camlp4@lists.ocaml.org>; Tue, 10 Sep 2013 15:06:11 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1520997 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:36226
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VJOq7-000385-6j (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Tue, 10 Sep 2013 15:22:47 +0100
Received: from [192.168.1.112] ([92.151.61.120]) by mwinf5d25 with ME
 id PSNl1m00G2bfMm403SNlnN; Tue, 10 Sep 2013 16:22:46 +0200
Message-ID: <522F2B32.4060809@lexifi.com>
Date: Tue, 10 Sep 2013 16:22:42 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.0
MIME-Version: 1.0
To: Hendrik Tews <tews@os.inf.tu-dresden.de>, wg-camlp4@lists.ocaml.org
References: <20775.25929.388649.943057@blau.inf.tu-dresden.de>
 <512B2F2C.9090308@lexifi.com> <6x38q1ykza.fsf_-_@blau.inf.tu-dresden.de>
In-Reply-To: <6x38q1ykza.fsf_-_@blau.inf.tu-dresden.de>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] parse_with_ppx [was: My no-use of camlp4 syntax
 extensions for Otags]
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 10 Sep 2013 14:06:11 -0000

On 08/22/2013 02:21 PM, Hendrik Tews wrote:
> a long time ago I asked about function parse_with_ppx, that takes
> a file name, applies -pp preprocessors, parses the result,
> applies -ppx preprocessors and returns the syntax tree.
>
> Is such a function available in 4.01 beta? Or, could somebody
> point me to the relevant code in ocamlc/ocamlopt that does that?

The functionality is now in trunk and will be part of 4.02. The 
functions to use are in the module Pparse:

   val parse_implementation: formatter -> string -> Parsetree.structure

   val parse_interface: formatter -> string -> Parsetree.signature


You need to parse the command-line to detect -pp/-ppx flags and also 
deal with error reporting, though.

Example:

https://github.com/alainfrisch/ppx_tools/blob/master/dumpast.ml


Alain

From alain.frisch@lexifi.com  Wed Sep 18 10:17:00 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id C725B3C0BB
 for <wg-camlp4@lists.ocaml.org>; Wed, 18 Sep 2013 10:17:00 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1523956 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:44435
 helo=msa.smtpout.orange.fr)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1VME93-0001VN-ih (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 18 Sep 2013 10:34:02 +0100
Received: from [192.168.1.112] ([92.151.37.227]) by mwinf5d03 with ME
 id SZa01m00C4u310C03Za0Vc; Wed, 18 Sep 2013 11:34:01 +0200
Message-ID: <52397389.9070402@lexifi.com>
Date: Wed, 18 Sep 2013 11:34:01 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.0
MIME-Version: 1.0
To: Caml-Devel <caml-devel@yquem.inria.fr>, 
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] Keeping attributes in .cmi files?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 18 Sep 2013 09:17:00 -0000

Dear all,

Attributes are currently kept in .cmt and .cmti files, which are dumps 
of the Typedtree counterparts of .ml and .mli files.  This allows 
external tools to access those attributes together with the output of 
the type-checker.  But this does not easily allow the compiler itself 
(which doesn't parse the .cmti file) to see attributes from external units.

If we keep attributes also in the internal structure of the 
type-checker, which is dumped in the .cmi file, we can make the compiler 
aware, for instance, of attributes put on value declarations.

As an example, see the following discussion about having the compiler 
report a warning when a value marked as deprecated is being used:

http://caml.inria.fr/mantis/view.php?id=5854

Attributes give a natural way to mark values as deprecated, and as I 
suggest in the discussion, the simplest way to use this information is 
to keep it in the Types.value_description record (and thus in .cmi files).

If we start having the compiler understand some specific attributes, it 
makes sense, in my opinion, to keep them even in .cmi files (at least 
for attributes on "declarations", not necessarily on type expressions). 
  Do you agree?  Would anyone object to the patch I proposed on the 
ticket above?


Alain

From garrigue@math.nagoya-u.ac.jp  Thu Sep 19 01:08:49 2013
Return-Path: <garrigue@math.nagoya-u.ac.jp>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B64583C1EB
 for <wg-camlp4@lists.ocaml.org>; Thu, 19 Sep 2013 01:08:49 +0100 (BST)
X-Cam-SpamDetails: score -0.6 from SpamAssassin-3.3.2-1523956 
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from rabbit.math.nagoya-u.ac.jp ([133.6.130.5]:48306
 helo=mailhost.math.nagoya-u.ac.jp)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1VMS48-0002EB-DH (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <garrigue@math.nagoya-u.ac.jp>); Thu, 19 Sep 2013 01:25:53 +0100
Received: from mailhost.math.nagoya-u.ac.jp (localhost [127.0.0.1])
 by mailhost.math.nagoya-u.ac.jp (Postfix) with ESMTP id 2CCF4635F;
 Thu, 19 Sep 2013 09:25:47 +0900 (JST)
Received: from mailhost.math.nagoya-u.ac.jp (localhost [127.0.0.1])
 by mailhost.math.nagoya-u.ac.jp (Postfix) with ESMTP id E542B3A0E;
 Thu, 19 Sep 2013 09:25:46 +0900 (JST)
DomainKey-Signature: h=Received:Content-Type:Mime-Version:Subject:From:In-Reply-To:Date:Cc:Content-Transfer-Encoding:Message-Id:References:To:X-Mailer;
 b=; c=nofws; d=math.nagoya-u.ac.jp; q=; s=alpha
Received: from tet.garrigue.jp (58x158x128x157.ap58.ftth.ucom.ne.jp
 [58.158.128.157])
 by mailhost.math.nagoya-u.ac.jp (Postfix) with ESMTPSA id 62886251A;
 Thu, 19 Sep 2013 09:25:46 +0900 (JST)
Content-Type: text/plain; charset=us-ascii
Mime-Version: 1.0 (Mac OS X Mail 6.6 \(1510\))
From: Jacques Garrigue <garrigue@math.nagoya-u.ac.jp>
In-Reply-To: <52397389.9070402@lexifi.com>
Date: Thu, 19 Sep 2013 09:25:46 +0900
Content-Transfer-Encoding: quoted-printable
Message-Id: <993DE9A5-E774-4F3D-8DB3-BA4F2CE72F08@math.nagoya-u.ac.jp>
References: <52397389.9070402@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1510)
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 19 Sep 2013 00:08:49 -0000

On 2013/09/18, at 18:34, Alain Frisch <alain.frisch@lexifi.com> wrote:

> Dear all,
>=20
> Attributes are currently kept in .cmt and .cmti files, which are dumps =
of the Typedtree counterparts of .ml and .mli files.  This allows =
external tools to access those attributes together with the output of =
the type-checker.  But this does not easily allow the compiler itself =
(which doesn't parse the .cmti file) to see attributes from external =
units.
>=20
> If we keep attributes also in the internal structure of the =
type-checker, which is dumped in the .cmi file, we can make the compiler =
aware, for instance, of attributes put on value declarations.
>=20
> As an example, see the following discussion about having the compiler =
report a warning when a value marked as deprecated is being used:
>=20
> http://caml.inria.fr/mantis/view.php?id=3D5854
>=20
> Attributes give a natural way to mark values as deprecated, and as I =
suggest in the discussion, the simplest way to use this information is =
to keep it in the Types.value_description record (and thus in .cmi =
files).
>=20
> If we start having the compiler understand some specific attributes, =
it makes sense, in my opinion, to keep them even in .cmi files (at least =
for attributes on "declarations", not necessarily on type expressions).  =
Do you agree?  Would anyone object to the patch I proposed on the ticket =
above?
>=20

On the principle, I have nothing against keeping attribute in .cmi =
files, since they are not supposed to change.
But to be honest I have not followed the discussion on attributes, and =
the inclusion in trunk was kind of sudden.
It might have been better to wait for the upcoming meeting.

I am a bit concerned by the fact the syntax tree is now completely =
mutually recursive:
an attribute appearing in a type may contain a structure.
What is the rationale behind that ?
And for pattern attributes in types ?
Does it mean that you want to include whole structures in .cmi files ?
Wouldn't it be better to restrict attributes to type expressions, =
constants, and identifiers/paths ?
Should all nodes allow all attributes ?

	Jacques=

From alain.frisch@lexifi.com  Thu Sep 19 08:38:29 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E9CCD3C350
 for <wg-camlp4@lists.ocaml.org>; Thu, 19 Sep 2013 08:38:29 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1524337 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:54774
 helo=msa.smtpout.orange.fr)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1VMZ5K-0006jQ-hB (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 19 Sep 2013 08:55:34 +0100
Received: from [192.168.1.101] ([92.151.78.110]) by mwinf5d09 with ME
 id SvvX1m00B2Nnnrw03vvYyd; Thu, 19 Sep 2013 09:55:33 +0200
Message-ID: <523AADF3.9090501@lexifi.com>
Date: Thu, 19 Sep 2013 09:55:31 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.0
MIME-Version: 1.0
To: Jacques Garrigue <garrigue@math.nagoya-u.ac.jp>
References: <52397389.9070402@lexifi.com>
 <993DE9A5-E774-4F3D-8DB3-BA4F2CE72F08@math.nagoya-u.ac.jp>
In-Reply-To: <993DE9A5-E774-4F3D-8DB3-BA4F2CE72F08@math.nagoya-u.ac.jp>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 19 Sep 2013 07:38:30 -0000

On 09/19/2013 02:25 AM, Jacques Garrigue wrote:
> On the principle, I have nothing against keeping attribute in .cmi files, since they are not supposed to change.
> But to be honest I have not followed the discussion on attributes, and the inclusion in trunk was kind of sudden.

I announced my intention to integrate the branch to caml-devel in the 
trunk on Jul. 22 ("Landing extension_points?"), nobody complained, and I 
did the merge more than one month later (Aug. 29).  The branch itself 
has been created on Feb. 28, extensively discussed on the wg-camlp4 list 
during the first months.  Then for some months, the branch has been 
stable and the discussion more quiet.

As I explained, nothing is frozen yet and the goals of landing the 
branch early are to avoid tricky conflicts in the future (considering 
that there are a lot of changes to the Parsetree) and to gather more 
feedback (this goal, at least, is achieved :-)).

> I am a bit concerned by the fact the syntax tree is now completely mutually recursive:
> an attribute appearing in a type may contain a structure.
> What is the rationale behind that ?

The intention is to allow greater flexibility in the content of 
attributes (while still keeping a fixed syntax to enable editor support 
and allow interactions between tools).   It is not clear exactly what 
will be needed for specific use cases, and allowing structure + patterns 
(with an optional guard) + type expressions cover a lot of possibly 
useful syntax fragments (in particular, structures cover both the empty 
case and expressions).

Allowing expressions as arguments is useful to support scenario where 
type declaration need to be annotation by code, such as the 
"sexp_drop_if" attribute in sexplib.  Since expression can already 
contain structures, I just found more convenient to allow arbitrary 
structures.  Of course, a specific tool or extension can put arbitrary 
constraints of what is exactly supported as the attribute argument.

> And for pattern attributes in types ?
> Does it mean that you want to include whole structures in .cmi files ?
> Wouldn't it be better to restrict attributes to type expressions, constants, and identifiers/paths ?
> Should all nodes allow all attributes ?

It's just easier and more uniform if the argument of attribute can 
always be the same, independently on the attribute target (and we use 
the same definition for the content of extension nodes).  I don't see 
any technical problem with it, this is just uninterpreted syntax.  What 
are your concerns?

Just as an example, a pattern in a type could be useful to specify 
"invariants" (used to generate assertions or proof obligations).

  type t =
     | A of bool * bool
     | B of int list
     [@@invariant? A (true, _) | A (_, true) | B (_ :: _)]

type s = (char [@invariant? 'a'..'z']) list

An expression in a type can be useful for conditional compilation:

   type flags =
     | Foo
     | Bar [@if os = "Windows"]
     | Baz

It's hard to predict exactly how attributes and extension nodes will be 
used, so I think it's better to be quite general, considering that it 
doesn't bring any additional complexity.


Alain

From garrigue@math.nagoya-u.ac.jp  Thu Sep 19 09:50:29 2013
Return-Path: <garrigue@math.nagoya-u.ac.jp>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 564303C204
 for <wg-camlp4@lists.ocaml.org>; Thu, 19 Sep 2013 09:50:29 +0100 (BST)
X-Cam-SpamDetails: score -0.5 from SpamAssassin-3.3.2-1524337 
 * -0.6 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from rabbit.math.nagoya-u.ac.jp ([133.6.130.5]:40241
 helo=mailhost.math.nagoya-u.ac.jp)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VMaCz-0003YI-8H (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <garrigue@math.nagoya-u.ac.jp>); Thu, 19 Sep 2013 10:07:34 +0100
Received: from mailhost.math.nagoya-u.ac.jp (localhost [127.0.0.1])
 by mailhost.math.nagoya-u.ac.jp (Postfix) with ESMTP id 175B2639E;
 Thu, 19 Sep 2013 18:07:30 +0900 (JST)
Received: from mailhost.math.nagoya-u.ac.jp (localhost [127.0.0.1])
 by mailhost.math.nagoya-u.ac.jp (Postfix) with ESMTP id B6D4B40D0;
 Thu, 19 Sep 2013 18:07:29 +0900 (JST)
DomainKey-Signature: h=Received:Subject:Mime-Version:Content-Type:From:In-Reply-To:Date:Cc:Content-Transfer-Encoding:Message-Id:References:To:X-Mailer;
 b=; c=nofws; d=math.nagoya-u.ac.jp; q=; s=alpha
Received: from tet.garrigue.jp (58x158x128x157.ap58.ftth.ucom.ne.jp
 [58.158.128.157])
 by mailhost.math.nagoya-u.ac.jp (Postfix) with ESMTPSA id 9399140CF;
 Thu, 19 Sep 2013 18:07:29 +0900 (JST)
Mime-Version: 1.0 (Mac OS X Mail 6.6 \(1510\))
Content-Type: text/plain; charset=iso-8859-1
From: Jacques Garrigue <garrigue@math.nagoya-u.ac.jp>
In-Reply-To: <523AADF3.9090501@lexifi.com>
Date: Thu, 19 Sep 2013 18:07:28 +0900
Content-Transfer-Encoding: quoted-printable
Message-Id: <C4B8882F-84D4-4C0E-A852-F98FC19FB29B@math.nagoya-u.ac.jp>
References: <52397389.9070402@lexifi.com>
 <993DE9A5-E774-4F3D-8DB3-BA4F2CE72F08@math.nagoya-u.ac.jp>
 <523AADF3.9090501@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1510)
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 19 Sep 2013 08:50:29 -0000

On 2013/09/19, at 16:55, Alain Frisch <alain.frisch@lexifi.com> wrote:

> On 09/19/2013 02:25 AM, Jacques Garrigue wrote:
>> On the principle, I have nothing against keeping attribute in .cmi =
files, since they are not supposed to change.
>> But to be honest I have not followed the discussion on attributes, =
and the inclusion in trunk was kind of sudden.
>=20
> I announced my intention to integrate the branch to caml-devel in the =
trunk on Jul. 22 ("Landing extension_points?"), nobody complained, and I =
did the merge more than one month later (Aug. 29).  The branch itself =
has been created on Feb. 28, extensively discussed on the wg-camlp4 list =
during the first months.  Then for some months, the branch has been =
stable and the discussion more quiet.

OK, I'm not of the wg-camlp4 list, which explains my surprise.

> As I explained, nothing is frozen yet and the goals of landing the =
branch early are to avoid tricky conflicts in the future (considering =
that there are a lot of changes to the Parsetree) and to gather more =
feedback (this goal, at least, is achieved :-)).

Sure, it's always difficult to discuss something that is not available =
in trunk.

>> I am a bit concerned by the fact the syntax tree is now completely =
mutually recursive:
>> an attribute appearing in a type may contain a structure.
>> What is the rationale behind that ?
>=20
> The intention is to allow greater flexibility in the content of =
attributes (while still keeping a fixed syntax to enable editor support =
and allow interactions between tools).   It is not clear exactly what =
will be needed for specific use cases, and allowing structure + patterns =
(with an optional guard) + type expressions cover a lot of possibly =
useful syntax fragments (in particular, structures cover both the empty =
case and expressions).
>=20
> Allowing expressions as arguments is useful to support scenario where =
type declaration need to be annotation by code, such as the =
"sexp_drop_if" attribute in sexplib.  Since expression can already =
contain structures, I just found more convenient to allow arbitrary =
structures.  Of course, a specific tool or extension can put arbitrary =
constraints of what is exactly supported as the attribute argument.

OK, I see why you can want arbitrary things.
Now, if I understand correctly, you are just reusing syntactic =
categories, but there is no semantics.
This creates a problem if you want to keep them in the .cmi.
Clearly, just dumping the syntax tree seems a bit verbose.
You should at least drop the locations.
Is it important to keep the format compatible with the syntax tree ?

>> And for pattern attributes in types ?
>> Does it mean that you want to include whole structures in .cmi files =
?
>> Wouldn't it be better to restrict attributes to type expressions, =
constants, and identifiers/paths ?
>> Should all nodes allow all attributes ?
>=20
> It's just easier and more uniform if the argument of attribute can =
always be the same, independently on the attribute target (and we use =
the same definition for the content of extension nodes).  I don't see =
any technical problem with it, this is just uninterpreted syntax.  What =
are your concerns?
>=20
> Just as an example, a pattern in a type could be useful to specify =
"invariants" (used to generate assertions or proof obligations).
>=20
> type t =3D
>    | A of bool * bool
>    | B of int list
>    [@@invariant? A (true, _) | A (_, true) | B (_ :: _)]
>=20
> type s =3D (char [@invariant? 'a'..'z']) list

You could also write this
@@invariant (function A (true, _) | A (_, true) | B (_ :: _) -> true | _ =
-> false)
can we see this just a short-hand?

I say this because having 3 categories with no semantics can be =
confusing.

> It's hard to predict exactly how attributes and extension nodes will =
be used, so I think it's better to be quite general, considering that it =
doesn't bring any additional complexity.

OK, but it makes it a bit harder to see the interactions with the type =
system.
If we keep them in types, I'm afraid of the interaction with =
unification.
Or do you just want a way to keep another version of the type =
definitions?

	Jacques=

From alain.frisch@lexifi.com  Thu Sep 19 12:59:22 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 0CE103C0BB
 for <wg-camlp4@lists.ocaml.org>; Thu, 19 Sep 2013 12:59:22 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1524337 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:33008
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VMd9n-0006ME-7K (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 19 Sep 2013 13:16:27 +0100
Received: from [192.168.1.101] ([92.151.78.110]) by mwinf5d29 with ME
 id T0GH1m00A2Nnnrw030GHLJ; Thu, 19 Sep 2013 14:16:18 +0200
Message-ID: <523AEB13.7010203@lexifi.com>
Date: Thu, 19 Sep 2013 14:16:19 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.0
MIME-Version: 1.0
To: Jacques Garrigue <garrigue@math.nagoya-u.ac.jp>
References: <52397389.9070402@lexifi.com>
 <993DE9A5-E774-4F3D-8DB3-BA4F2CE72F08@math.nagoya-u.ac.jp>
 <523AADF3.9090501@lexifi.com>
 <C4B8882F-84D4-4C0E-A852-F98FC19FB29B@math.nagoya-u.ac.jp>
In-Reply-To: <C4B8882F-84D4-4C0E-A852-F98FC19FB29B@math.nagoya-u.ac.jp>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 19 Sep 2013 11:59:22 -0000

On 09/19/2013 11:07 AM, Jacques Garrigue wrote:
> Now, if I understand correctly, you are just reusing syntactic categories, but there is no semantics.

Indeed. In important point, though, is that the default mapper class 
(Ast_mapper) traverses attributes and extension nodes.  I.e., unless it 
decides otherwise, a ppx rewriter would typically applies its rewriting 
to the arguments of attributes and extension nodes he's not aware of. 
This allows, for instance, to benefits from the services of a 
conditional compilation (or macro expander) ppx filter in the arguments 
of attributes to be processed by other ppx filters.

> This creates a problem if you want to keep them in the .cmi.
> Clearly, just dumping the syntax tree seems a bit verbose.
> You should at least drop the locations.

I expect arguments of attributes to be rather small fragments of syntax, 
so I don't see any real problem here.  Are you concerned by the size of 
.cmi file on disk, the time to read them?

About locations: we could indeed turn all locations into Location.none 
before saving the attributes in the .cmi.

> Is it important to keep the format compatible with the syntax tree ?

Internally (for ppx filters), it's useful that attributes are indeed 
real fragments of the Parsetree, so that an attribute's parameter can be 
injected in the Parsetree easily if needed.  We could turn to a 
different representation for the .cmi, but this would require to 
duplicate a big data type, and I don't see the benefits.

> You could also write this
> @@invariant (function A (true, _) | A (_, true) | B (_ :: _) -> true | _ -> false)
> can we see this just a short-hand?

What would be the translation for [@foo: type_expr]?

Of course, one could simplify the internal representation of "payloads" 
(attribute and extension node arguments) to a single case in the 
internal representation, and keep alternative syntaxes only as sugar, 
but what is the benefit?

> OK, but it makes it a bit harder to see the interactions with the type system.
> If we keep them in types, I'm afraid of the interaction with unification.
> Or do you just want a way to keep another version of the type definitions?

I think it would only make sense to keep attributes in type expressions 
within declarations (type definitions, and maybe also value definitions, 
e.g. to be able to specify some properties of individual parameters of a 
function).  *If* we represent them in the internal type algebra, this 
could be a special kind of node which would be ignored by the 
unification (or dropped from the representation as soon as a type is 
instanciated).



Alain

From garrigue@math.nagoya-u.ac.jp  Thu Sep 19 14:47:41 2013
Return-Path: <garrigue@math.nagoya-u.ac.jp>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E8D883C0BB
 for <wg-camlp4@lists.ocaml.org>; Thu, 19 Sep 2013 14:47:41 +0100 (BST)
X-Cam-SpamDetails: score -0.5 from SpamAssassin-3.3.2-1524337 
 * -0.6 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from rabbit.math.nagoya-u.ac.jp ([133.6.130.5]:54123
 helo=mailhost.math.nagoya-u.ac.jp)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1VMeqc-00017K-EO (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <garrigue@math.nagoya-u.ac.jp>); Thu, 19 Sep 2013 15:04:47 +0100
Received: from mailhost.math.nagoya-u.ac.jp (localhost [127.0.0.1])
 by mailhost.math.nagoya-u.ac.jp (Postfix) with ESMTP id 05A48638D;
 Thu, 19 Sep 2013 23:04:43 +0900 (JST)
Received: from mailhost.math.nagoya-u.ac.jp (localhost [127.0.0.1])
 by mailhost.math.nagoya-u.ac.jp (Postfix) with ESMTP id CFA3140CF;
 Thu, 19 Sep 2013 23:04:42 +0900 (JST)
DomainKey-Signature: h=Received:Content-Type:Mime-Version:Subject:From:In-Reply-To:Date:Cc:Content-Transfer-Encoding:Message-Id:References:To:X-Mailer;
 b=; c=nofws; d=math.nagoya-u.ac.jp; q=; s=alpha
Received: from tet.garrigue.jp (58x158x128x157.ap58.ftth.ucom.ne.jp
 [58.158.128.157])
 by mailhost.math.nagoya-u.ac.jp (Postfix) with ESMTPSA id B1E072502;
 Thu, 19 Sep 2013 23:04:42 +0900 (JST)
Content-Type: text/plain; charset=windows-1252
Mime-Version: 1.0 (Mac OS X Mail 6.6 \(1510\))
From: Jacques Garrigue <garrigue@math.nagoya-u.ac.jp>
In-Reply-To: <523AEB13.7010203@lexifi.com>
Date: Thu, 19 Sep 2013 23:04:42 +0900
Content-Transfer-Encoding: quoted-printable
Message-Id: <13278AE5-2455-475A-BEA8-9742BE181C23@math.nagoya-u.ac.jp>
References: <52397389.9070402@lexifi.com>
 <993DE9A5-E774-4F3D-8DB3-BA4F2CE72F08@math.nagoya-u.ac.jp>
 <523AADF3.9090501@lexifi.com>
 <C4B8882F-84D4-4C0E-A852-F98FC19FB29B@math.nagoya-u.ac.jp>
 <523AEB13.7010203@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1510)
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 19 Sep 2013 13:47:42 -0000

On 2013/09/19, at 21:16, Alain Frisch <alain.frisch@lexifi.com> wrote:

> On 09/19/2013 11:07 AM, Jacques Garrigue wrote:
>> Now, if I understand correctly, you are just reusing syntactic =
categories, but there is no semantics.
>=20
> Indeed. In important point, though, is that the default mapper class =
(Ast_mapper) traverses attributes and extension nodes.  I.e., unless it =
decides otherwise, a ppx rewriter would typically applies its rewriting =
to the arguments of attributes and extension nodes he's not aware of. =
This allows, for instance, to benefits from the services of a =
conditional compilation (or macro expander) ppx filter in the arguments =
of attributes to be processed by other ppx filters.

But what are the scoping rules?
Do you mean that the annotations are actually open terms? Interesting.

>> This creates a problem if you want to keep them in the .cmi.
>> Clearly, just dumping the syntax tree seems a bit verbose.
>> You should at least drop the locations.
>=20
> I expect arguments of attributes to be rather small fragments of =
syntax, so I don't see any real problem here.  Are you concerned by the =
size of .cmi file on disk, the time to read them?

Both, as they are connected. Also the fact that this might keep some =
unnecessary details.

> About locations: we could indeed turn all locations into Location.none =
before saving the attributes in the .cmi.

Yes, the reason is not only the size, but also that they make the md5 of =
the cmi fragile.

>> Is it important to keep the format compatible with the syntax tree ?
>=20
> Internally (for ppx filters), it's useful that attributes are indeed =
real fragments of the Parsetree, so that an attribute's parameter can be =
injected in the Parsetree easily if needed.  We could turn to a =
different representation for the .cmi, but this would require to =
duplicate a big data type, and I don't see the benefits.
>=20
>> You could also write this
>> @@invariant (function A (true, _) | A (_, true) | B (_ :: _) -> true =
| _ -> false)
>> can we see this just a short-hand?
>=20
> What would be the translation for [@foo: type_expr]?

No, I was just trying to understand the semantics. It is clear that =
types need to be handled differently.

> Of course, one could simplify the internal representation of =
"payloads" (attribute and extension node arguments) to a single case in =
the internal representation, and keep alternative syntaxes only as =
sugar, but what is the benefit?

A more uniform semantics ?
Again, I do not say that this should be the representation used, but =
saying that the two are equivalent clarifies the semantics.

>> OK, but it makes it a bit harder to see the interactions with the =
type system.
>> If we keep them in types, I'm afraid of the interaction with =
unification.
>> Or do you just want a way to keep another version of the type =
definitions?
>=20
> I think it would only make sense to keep attributes in type =
expressions within declarations (type definitions, and maybe also value =
definitions, e.g. to be able to specify some properties of individual =
parameters of a function).  *If* we represent them in the internal type =
algebra, this could be a special kind of node which would be ignored by =
the unification (or dropped from the representation as soon as a type is =
instanciated).

Dropping on instantiation might work.
Ignoring during the unification does not seem to be a good solution, =
because what remains becomes nondeterministic.
Keep in mind that all this is pretty fragile, as typedecl relies on =
unification too=85

	Jacques=

From alain.frisch@lexifi.com  Thu Sep 19 16:38:36 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D11DF3C0BB
 for <wg-camlp4@lists.ocaml.org>; Thu, 19 Sep 2013 16:38:36 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1524337 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.212 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa03.smtpout.orange.fr ([193.252.23.212]:32789
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VMgZy-0003kW-80 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Thu, 19 Sep 2013 16:55:42 +0100
Received: from [192.168.1.101] ([92.151.78.110]) by mwinf5d29 with ME
 id T3vg1m0012Nnnrw033vgF8; Thu, 19 Sep 2013 17:55:42 +0200
Message-ID: <523B1E7F.9000300@lexifi.com>
Date: Thu, 19 Sep 2013 17:55:43 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.0
MIME-Version: 1.0
To: Jacques Garrigue <garrigue@math.nagoya-u.ac.jp>
References: <52397389.9070402@lexifi.com>	<993DE9A5-E774-4F3D-8DB3-BA4F2CE72F08@math.nagoya-u.ac.jp>	<523AADF3.9090501@lexifi.com>	<C4B8882F-84D4-4C0E-A852-F98FC19FB29B@math.nagoya-u.ac.jp>	<523AEB13.7010203@lexifi.com>
 <13278AE5-2455-475A-BEA8-9742BE181C23@math.nagoya-u.ac.jp>
In-Reply-To: <13278AE5-2455-475A-BEA8-9742BE181C23@math.nagoya-u.ac.jp>
Content-Type: text/plain; charset=windows-1252; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 19 Sep 2013 15:38:36 -0000

On 09/19/2013 04:04 PM, Jacques Garrigue wrote:
> But what are the scoping rules?
> Do you mean that the annotations are actually open terms? Interesting.

There is no semantics, no binding structure, the payload of attributes 
and extension points are just fragments of surface syntax.  The meaning 
is given by the tools which manipulate them.

>> I expect arguments of attributes to be rather small fragments of syntax, so I don't see any real problem here.  Are you concerned by the size of .cmi file on disk, the time to read them?
>
> Both, as they are connected. Also the fact that this might keep some unnecessary details.

I really think performance is a non-issue here.  For usual cases, each 
attribute will add a few bytes to the .cmi file.

>> Of course, one could simplify the internal representation of "payloads" (attribute and extension node arguments) to a single case in the internal representation, and keep alternative syntaxes only as sugar, but what is the benefit?
>
> A more uniform semantics ?
> Again, I do not say that this should be the representation used, but saying that the two are equivalent clarifies the semantics.

They are not currently equivalent: a ppx filter could very well react 
properly on:

  [@invariant? A | B]

and fail on:

  [@invariant (function A | B -> true | _ -> false)]

If we decide to consider the first form as syntactic sugar second for 
the second form, then yes, they become equivalent!



Alain

From lpw25@cam.ac.uk  Fri Oct 11 17:17:55 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A1ABA3C0CC
 for <wg-camlp4@lists.ocaml.org>; Fri, 11 Oct 2013 17:17:55 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from 88-105-52-148.dynamic.dsl.as9105.com ([88.105.52.148]:34118
 helo=netbook)
 by ppsw-52.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1VUfhF-0005xd-Df (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@cam.ac.uk>); Fri, 11 Oct 2013 17:36:13 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <51701746.9010008@lexifi.com>
X-Face: "XWxb[u_Z\PA_Y?9@|IA!!+jTb(/290-*ea/Un$I0B98.$n%eL.;
 2w<l)q>*,z]WR#T:,p[
 NBd++M7l]#7zj7!{<NUTKJA{}Ox<uO[wb-s<\6jzp.r]-AE[W%E+ckCQ'2WZS@Zu/PJU$~~oy|>~iw
 $W-"/=|dVjhT[D{4~gE}gK<2`.6fs!;uqqud]vs2N/3^m7{aS1V,
Date: Fri, 11 Oct 2013 17:39:05 +0100
In-Reply-To: <51701746.9010008@lexifi.com> (Alain Frisch's message of "Thu, 18
 Apr 2013 17:54:46 +0200")
Message-ID: <86hacnrcd2.fsf@cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 11 Oct 2013 16:17:55 -0000

Hi,

I've been looking recently at encoding inline documentation
(i.e. ocamldoc comments) within attributes, as part of my work on
opam-doc. Mostly this works fine, but there is an issue with comments
that are not attached to any item (e.g. section headers).

I had thought that the existing support for "structure/signature
attributes" would be sufficient. By these I mean attributes like:

  ;;[@@doc "Hello World"]

which are parsed as separate structure/signature items rather than
attached to an existing structure/signature item.

The problem is that unattached attributes can appear in a number of
places that structure attributes cannot. Some examples:

  type t = Foo of s

  (** {3 Section} *)

  and s = Bin of t option

  class type foo = object
    method a : int

    (** Some comment *)

    method b : int
  end

and so on.

In both these cases it is hard to add support for structure items in
those locations because that would require supporting ';;' in those
locations as well.

I have also heard a number of complaints about the ";;[@@ foo]"
syntax. Firstly, that it is ugly and its meaning is not particularly
obvious, and secondly that users may be confused when

  type t;;
  [@@ sexp]

silently does not work.

So my suggestion would be to (reluctantly) add a third form of
attribute:

  [@@@ foo]

which means basically the same as:

 ;;[@@ foo]

does now. This could be supported in the additional locations that I
mentioned above, and would allow for a syntax error for the ";;[@@sexp]"
mistake.

Since this follows the existing pattern of [@...] and [@@...], it should
not be too much trouble to tell users about [@@@ ...], and certainly no
worse than explaining ";;[@@...]" to them.

Regards,

Leo

From gabriel.scherer@gmail.com  Fri Oct 11 18:08:37 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 00B593C0CC
 for <wg-camlp4@lists.ocaml.org>; Fri, 11 Oct 2013 18:08:37 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1530876 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.41 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f41.google.com ([209.85.214.41]:62947)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VUgUI-0000d3-9f (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Fri, 11 Oct 2013 18:26:55 +0100
Received: by mail-bk0-f41.google.com with SMTP id na10so1699025bkb.14
 for <wg-camlp4@lists.ocaml.org>; Fri, 11 Oct 2013 10:26:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:from:date:message-id:subject:to
 :cc:content-type;
 bh=TD3vdUNsRCx4H6uI7UHy8YKy3SeS65QDXbbhuS6/mhU=;
 b=eBGT14fYUE97s1lsDtjQJ452Omu3IESw1y4rdwXpmeyW5L3BkdO5rt3xaoT3qgvBcO
 C10GjZRUQ5tSDMomv16Rpp/H7PMJLehzrzAfZhUb/9D/+VuufJEonwgBMSZmqXwuJRal
 dZBaxXqwDBccOvMOIn7IVrrubVLfmYRfy9zv/UI1Lki8HpaTPhwxUxisAHaEodZDHj0P
 plyzImgdd3KN8gJmNx7K8LQGi0eHuJmKgTMZUwOJzAWlgIzxBfNQ5IyjSXMhKYP/r99H
 co887LwfwrRfHSBs2uQtEj3Skgsaamt2uqnNpXSc5FfChjH0FHnUU/I5IbcIdjPq77yq
 XtLQ==
X-Received: by 10.204.63.7 with SMTP id z7mr18730884bkh.23.1381512414455; Fri,
 11 Oct 2013 10:26:54 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.236.193 with HTTP; Fri, 11 Oct 2013 10:26:14 -0700 (PDT)
In-Reply-To: <86hacnrcd2.fsf@cam.ac.uk>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Fri, 11 Oct 2013 19:26:14 +0200
Message-ID: <CAPFanBG=oCO8SUr31QVTcTj0diJo+94aHv9gPhY5-SKPf_4amg@mail.gmail.com>
To: Leo White <lpw25@cam.ac.uk>
Content-Type: multipart/alternative; boundary=001a11c37828b79a3e04e87a6c5e
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 11 Oct 2013 17:08:37 -0000

--001a11c37828b79a3e04e87a6c5e
Content-Type: text/plain; charset=ISO-8859-1

I would count as one of the people not being fond of ';;'. However, there
is something I don't understand about your proposal: where in the AST tree
would you attach those floating attributes?

My understanding of Alain's ";;[@..]" was that he introduced a specific
"empty item" in the AST of the current structure/signature. Extending this
technique to the example you've shown would require adding such phony items
in a few more syntactic positions, which may or may not be a good idea.


On Fri, Oct 11, 2013 at 6:39 PM, Leo White <lpw25@cam.ac.uk> wrote:

> Hi,
>
> I've been looking recently at encoding inline documentation
> (i.e. ocamldoc comments) within attributes, as part of my work on
> opam-doc. Mostly this works fine, but there is an issue with comments
> that are not attached to any item (e.g. section headers).
>
> I had thought that the existing support for "structure/signature
> attributes" would be sufficient. By these I mean attributes like:
>
>   ;;[@@doc "Hello World"]
>
> which are parsed as separate structure/signature items rather than
> attached to an existing structure/signature item.
>
> The problem is that unattached attributes can appear in a number of
> places that structure attributes cannot. Some examples:
>
>   type t = Foo of s
>
>   (** {3 Section} *)
>
>   and s = Bin of t option
>
>   class type foo = object
>     method a : int
>
>     (** Some comment *)
>
>     method b : int
>   end
>
> and so on.
>
> In both these cases it is hard to add support for structure items in
> those locations because that would require supporting ';;' in those
> locations as well.
>
> I have also heard a number of complaints about the ";;[@@ foo]"
> syntax. Firstly, that it is ugly and its meaning is not particularly
> obvious, and secondly that users may be confused when
>
>   type t;;
>   [@@ sexp]
>
> silently does not work.
>
> So my suggestion would be to (reluctantly) add a third form of
> attribute:
>
>   [@@@ foo]
>
> which means basically the same as:
>
>  ;;[@@ foo]
>
> does now. This could be supported in the additional locations that I
> mentioned above, and would allow for a syntax error for the ";;[@@sexp]"
> mistake.
>
> Since this follows the existing pattern of [@...] and [@@...], it should
> not be too much trouble to tell users about [@@@ ...], and certainly no
> worse than explaining ";;[@@...]" to them.
>
> Regards,
>
> Leo
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>

--001a11c37828b79a3e04e87a6c5e
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div><div>I would count as one of the people not being fon=
d of &#39;;;&#39;. However, there is something I don&#39;t understand about=
 your proposal: where in the AST tree would you attach those floating attri=
butes?<br>

<br></div>My understanding of Alain&#39;s &quot;;;[@..]&quot; was that he i=
ntroduced a specific &quot;empty item&quot; in the AST of the current struc=
ture/signature. Extending this technique to the example you&#39;ve shown wo=
uld require adding such phony items in a few more syntactic positions, whic=
h may or may not be a good idea.<br>

</div><div><div><div><div><div></div></div></div></div></div></div><div cla=
ss=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Fri, Oct 11, 2013 =
at 6:39 PM, Leo White <span dir=3D"ltr">&lt;<a href=3D"mailto:lpw25@cam.ac.=
uk" target=3D"_blank">lpw25@cam.ac.uk</a>&gt;</span> wrote:<br>

<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">Hi,<br>
<br>
I&#39;ve been looking recently at encoding inline documentation<br>
(i.e. ocamldoc comments) within attributes, as part of my work on<br>
opam-doc. Mostly this works fine, but there is an issue with comments<br>
that are not attached to any item (e.g. section headers).<br>
<br>
I had thought that the existing support for &quot;structure/signature<br>
attributes&quot; would be sufficient. By these I mean attributes like:<br>
<br>
=A0 ;;[@@doc &quot;Hello World&quot;]<br>
<br>
which are parsed as separate structure/signature items rather than<br>
attached to an existing structure/signature item.<br>
<br>
The problem is that unattached attributes can appear in a number of<br>
places that structure attributes cannot. Some examples:<br>
<br>
=A0 type t =3D Foo of s<br>
<br>
=A0 (** {3 Section} *)<br>
<br>
=A0 and s =3D Bin of t option<br>
<br>
=A0 class type foo =3D object<br>
=A0 =A0 method a : int<br>
<br>
=A0 =A0 (** Some comment *)<br>
<br>
=A0 =A0 method b : int<br>
=A0 end<br>
<br>
and so on.<br>
<br>
In both these cases it is hard to add support for structure items in<br>
those locations because that would require supporting &#39;;;&#39; in those=
<br>
locations as well.<br>
<br>
I have also heard a number of complaints about the &quot;;;[@@ foo]&quot;<b=
r>
syntax. Firstly, that it is ugly and its meaning is not particularly<br>
obvious, and secondly that users may be confused when<br>
<br>
=A0 type t;;<br>
=A0 [@@ sexp]<br>
<br>
silently does not work.<br>
<br>
So my suggestion would be to (reluctantly) add a third form of<br>
attribute:<br>
<br>
=A0 [@@@ foo]<br>
<br>
which means basically the same as:<br>
<br>
=A0;;[@@ foo]<br>
<br>
does now. This could be supported in the additional locations that I<br>
mentioned above, and would allow for a syntax error for the &quot;;;[@@sexp=
]&quot;<br>
mistake.<br>
<br>
Since this follows the existing pattern of [@...] and [@@...], it should<br=
>
not be too much trouble to tell users about [@@@ ...], and certainly no<br>
worse than explaining &quot;;;[@@...]&quot; to them.<br>
<br>
Regards,<br>
<br>
Leo<br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</blockquote></div><br></div>

--001a11c37828b79a3e04e87a6c5e--

From lpw25@cam.ac.uk  Fri Oct 11 18:43:25 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 2589F3C0CC
 for <wg-camlp4@lists.ocaml.org>; Fri, 11 Oct 2013 18:43:25 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from 88-105-52-148.dynamic.dsl.as9105.com ([88.105.52.148]:45532
 helo=netbook)
 by ppsw-52.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1VUh1z-000377-Eh (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@cam.ac.uk>); Fri, 11 Oct 2013 19:01:43 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <CAPFanBG=oCO8SUr31QVTcTj0diJo+94aHv9gPhY5-SKPf_4amg@mail.gmail.com>
X-Face: "XWxb[u_Z\PA_Y?9@|IA!!+jTb(/290-*ea/Un$I0B98.$n%eL.;
 2w<l)q>*,z]WR#T:,p[
 NBd++M7l]#7zj7!{<NUTKJA{}Ox<uO[wb-s<\6jzp.r]-AE[W%E+ckCQ'2WZS@Zu/PJU$~~oy|>~iw
 $W-"/=|dVjhT[D{4~gE}gK<2`.6fs!;uqqud]vs2N/3^m7{aS1V,
Date: Fri, 11 Oct 2013 19:04:33 +0100
In-Reply-To: <CAPFanBG=oCO8SUr31QVTcTj0diJo+94aHv9gPhY5-SKPf_4amg@mail.gmail.com>
 (Gabriel Scherer's message of "Fri, 11 Oct 2013 19:26:14 +0200")
Message-ID: <86wqlj65vy.fsf@cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 11 Oct 2013 17:43:25 -0000

> My understanding of Alain's ";;[@..]" was that he introduced a specific "empty item" in the AST of the current
> structure/signature. Extending this technique to the example you've shown would require adding such phony items in a
> few more syntactic positions, which may or may not be a good idea.

Yes, there would need to be some additional phony items. In some cases,
like between class items, this is not a large change. For others, like
recursive type definitions, it means adding an extra layer of variants
which is a bit annoying.

There may be some alternative methods of attaching these annotations to
the right part of the AST, but I don't think any of them will be
particularly nicer than this one.

Regards,

Leo

From alain.frisch@lexifi.com  Fri Oct 11 21:32:57 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id E4BC63C0CC
 for <wg-camlp4@lists.ocaml.org>; Fri, 11 Oct 2013 21:32:56 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1530876 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.6 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp6-g21.free.fr ([212.27.42.6]:44182)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1VUjg1-0006Ql-Er (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 11 Oct 2013 21:51:15 +0100
Received: from [192.168.0.16] (unknown [78.192.0.38])
 by smtp6-g21.free.fr (Postfix) with ESMTP id 986DE82311;
 Fri, 11 Oct 2013 22:51:08 +0200 (CEST)
Message-ID: <525864BB.6030409@lexifi.com>
Date: Fri, 11 Oct 2013 22:51:07 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130801 Thunderbird/17.0.8
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <CAPFanBG=oCO8SUr31QVTcTj0diJo+94aHv9gPhY5-SKPf_4amg@mail.gmail.com>
In-Reply-To: <CAPFanBG=oCO8SUr31QVTcTj0diJo+94aHv9gPhY5-SKPf_4amg@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 11 Oct 2013 20:32:57 -0000

On 10/11/2013 7:26 PM, Gabriel Scherer wrote:
> My understanding of Alain's ";;[@..]" was that he introduced a specific
> "empty item" in the AST of the current structure/signature.

Attributes attached to signature/structure items are actually attached, 
in the Parsetree representation, to individual declarations, not items, 
because a group of mutually recursive type declarations count as a 
single item in the current definition of the Parsetree but one really 
wants to be able to attach attributes to each of them.  Floating 
attributes are just a new kind of structure/signature items in the 
Parsetree.


Concretely, we have today:


and signature_item_desc =
   | Psig_value of value_description
   | Psig_type of type_declaration list
   ...
   | Psig_include of module_type * attributes
   ...
   | Psig_attribute of attribute


and value_description =
     {
      ...
      pval_attributes: attributes;
     }

and type_declaration =
     {
      ...
      ptype_attributes: attributes;
     }


Another approach would be to split groups of declarations into 
successive items, as in the Types representation:

and signature_item =
     Sig_value of Ident.t * value_description
   | Sig_type of Ident.t * type_declaration * rec_status
   ...

(where rec_status indicates if the declaration is in the same group as 
the previous one)


This adds some invariants which are not represented in the data 
structure (a Trec_next Sig_type must immediately follow another 
Sig_type), but it allows for a more uniform representation of 
attributes.  (That said, it's also very useful to have attributes 
directly represented in the value_description/type_declaration/... 
records, especially in the Typedtree representation.)


Alain

From alain.frisch@lexifi.com  Fri Oct 11 21:32:59 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id AE2AA3C0CC
 for <wg-camlp4@lists.ocaml.org>; Fri, 11 Oct 2013 21:32:59 +0100 (BST)
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp6-g21.free.fr ([212.27.42.6]:56157)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VUjg6-0002Kj-8S (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 11 Oct 2013 21:51:18 +0100
Received: from [192.168.0.16] (unknown [78.192.0.38])
 by smtp6-g21.free.fr (Postfix) with ESMTP id 62378822D8;
 Fri, 11 Oct 2013 22:51:14 +0200 (CEST)
Message-ID: <525864C1.80908@lexifi.com>
Date: Fri, 11 Oct 2013 22:51:13 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130801 Thunderbird/17.0.8
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
In-Reply-To: <86hacnrcd2.fsf@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 11 Oct 2013 20:32:59 -0000

Hi Leo,

On 10/11/2013 6:39 PM, Leo White wrote:
> Since this follows the existing pattern of [@...] and [@@...], it should
> not be too much trouble to tell users about [@@@ ...], and certainly no
> worse than explaining ";;[@@...]" to them.

I was also reluctant to introduce a different syntax for those 
"floating" attributes, but you convinced me it's probably the best thing 
to do.

Beside this syntactic question, you're also interested in supporting 
those attributes in more places.  Within class signatures and 
structures, I don't see any problem, but I'm more concerned by floating 
attributes between declarations in a group.  Are you asking for allowing:

  type t = ...

  [@@@doc.section ....]

  and s = ...


?

Honestly, I'm not yet convinced this is really necessary.  Do we really 
need to split documentation sections in such places?  But if we go this 
way, I'd be inclined to look again at an early proposal of considering 
groups of declarations as successive items (similarly to Types), so that 
attached item attributes can be represented more uniformly (in the 
signature_item and structure_item records).


Alain

From lpw25@cam.ac.uk  Fri Oct 11 21:58:46 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 4679A3C0CC
 for <wg-camlp4@lists.ocaml.org>; Fri, 11 Oct 2013 21:58:46 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from 88-105-52-148.dynamic.dsl.as9105.com ([88.105.52.148]:60431
 helo=netbook)
 by ppsw-52.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1VUk53-0004Z1-DP (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@cam.ac.uk>); Fri, 11 Oct 2013 22:17:05 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com>
X-Face: "XWxb[u_Z\PA_Y?9@|IA!!+jTb(/290-*ea/Un$I0B98.$n%eL.;
 2w<l)q>*,z]WR#T:,p[
 NBd++M7l]#7zj7!{<NUTKJA{}Ox<uO[wb-s<\6jzp.r]-AE[W%E+ckCQ'2WZS@Zu/PJU$~~oy|>~iw
 $W-"/=|dVjhT[D{4~gE}gK<2`.6fs!;uqqud]vs2N/3^m7{aS1V,
Date: Fri, 11 Oct 2013 22:19:54 +0100
In-Reply-To: <525864C1.80908@lexifi.com> (Alain Frisch's message of "Fri, 11
 Oct 2013 22:51:13 +0200")
Message-ID: <86vc13mrnp.fsf@cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 11 Oct 2013 20:58:46 -0000

> Are you asking for allowing:
>
>  type t = ...
>
>  [@@@doc.section ....]
>
>  and s = ...
>
>
> ?

Yes

> Honestly, I'm not yet convinced this is really necessary.  Do we really need to split documentation sections in such
> places?  

I think that large files of recursive type definitions, as are quite
common in OCaml, are quite likely to want section headers. I am also
hoping to be backwards-compatible with existing OCamldoc, which I think
supports such comments.

> But if we go this way, I'd be inclined to look again at an early proposal of considering groups of declarations
> as successive items (similarly to Types), so that attached item attributes can be represented more uniformly (in the
> signature_item and structure_item records).

I think that will be more work than making type_declaration a variant
type with a Ptyp_attribute constructor. However it may be a little
neater.

Regards,

Leo

From alain.frisch@lexifi.com  Sat Oct 12 06:41:26 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 9C1563C37C
 for <wg-camlp4@lists.ocaml.org>; Sat, 12 Oct 2013 06:41:26 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1531229 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [212.27.42.5 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp5-g21.free.fr ([212.27.42.5]:44452)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1VUsEs-00007z-Du (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Sat, 12 Oct 2013 06:59:46 +0100
Received: from [192.168.0.16] (unknown [78.192.0.38])
 by smtp5-g21.free.fr (Postfix) with ESMTP id CCA22D4805C;
 Sat, 12 Oct 2013 07:59:41 +0200 (CEST)
Message-ID: <5258E54C.5050701@lexifi.com>
Date: Sat, 12 Oct 2013 07:59:40 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:17.0) Gecko/20130801 Thunderbird/17.0.8
MIME-Version: 1.0
To: Leo White <lpw25@cam.ac.uk>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
In-Reply-To: <86vc13mrnp.fsf@cam.ac.uk>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 12 Oct 2013 05:41:26 -0000

What about using regular item attributes for section headers?  This 
might be not so nice conceptually, but would there be actual problems 
with this approach?

-- Alain

On 10/11/2013 11:19 PM, Leo White wrote:
>> Are you asking for allowing:
>>
>>   type t = ...
>>
>>   [@@@doc.section ....]
>>
>>   and s = ...
>>
>>
>> ?
>
> Yes
>
>> Honestly, I'm not yet convinced this is really necessary.  Do we really need to split documentation sections in such
>> places?
>
> I think that large files of recursive type definitions, as are quite
> common in OCaml, are quite likely to want section headers. I am also
> hoping to be backwards-compatible with existing OCamldoc, which I think
> supports such comments.
>
>> But if we go this way, I'd be inclined to look again at an early proposal of considering groups of declarations
>> as successive items (similarly to Types), so that attached item attributes can be represented more uniformly (in the
>> signature_item and structure_item records).
>
> I think that will be more work than making type_declaration a variant
> type with a Ptyp_attribute constructor. However it may be a little
> neater.
>
> Regards,
>
> Leo
>


From gabriel.scherer@gmail.com  Sat Oct 12 10:18:29 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-mx-f.csi.cam.ac.uk [131.111.8.149])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1CC733CC50
 for <wg-camlp4@lists.ocaml.org>; Sat, 12 Oct 2013 10:18:29 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1531229 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.50 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f50.google.com ([209.85.214.50]:61305)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VUvcv-0002Mb-7S (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Sat, 12 Oct 2013 10:36:50 +0100
Received: by mail-bk0-f50.google.com with SMTP id mz11so1956719bkb.37
 for <wg-camlp4@lists.ocaml.org>; Sat, 12 Oct 2013 02:36:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:from:date:message-id:subject:to
 :cc:content-type;
 bh=zaPC9/ur+4JO1KyapMoqEy3jBvbAUnW+/OsSwVmPJk4=;
 b=tF6VmAcDttDUru+NAFO3cZ96ZtLjEIWR0YTE91RkvyRR8W8rJOlEgx5nxqJQfnhuD8
 TAfuaoAjhd3BkaxCrdr1SkUVlIJwJ0lq4cp445SlAkusQEVuv9g50uf/yiNvemvBfqQh
 YOSDTJBXr3PPdEDpW9Ad+sz3UJ6EeQmJQZpSu1sXHt30b2sfe6Rk5ZAIWEmB+8VrvZOp
 gIMryAVfLvK7go1tdXbRcglr1P/9eSJC2QHmR+poaDsIlMHUrI/AninHWcpWff+gLz55
 C2L6Cskmsw+bTq7KAIBQlWfDErzyCDaJvrR2MzY4Uu62aJX+qpxqEbqbUg2ZkFAevC2J
 qqZg==
X-Received: by 10.204.103.199 with SMTP id l7mr21452003bko.11.1381570608770;
 Sat, 12 Oct 2013 02:36:48 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.204.236.193 with HTTP; Sat, 12 Oct 2013 02:36:07 -0700 (PDT)
In-Reply-To: <5258E54C.5050701@lexifi.com>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Sat, 12 Oct 2013 11:36:07 +0200
Message-ID: <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=001a113351945e634904e887f951
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 12 Oct 2013 09:18:29 -0000

--001a113351945e634904e887f951
Content-Type: text/plain; charset=ISO-8859-1

I think the major benefits of extension-points for documentation, compared
to ocamldoc comments, is that they are unambiguously attached to an AST
node. We get in trouble for section headers because they don't fit that
framework very well; they're not semantically attached to a precise node,
and even if you would consider them as attached to a set of nods (the ones
in the section), this set apparently has no reason to respect the AST
structure. So we get an impedance mismatch here.

I don't think that the use case of putting free-floating section nodes in
between mutually recursive declarations is important enough to provoke
large changes to the AST structure. Alain's suggestion to not have any
special syntax for this seems sensible. Once we take a few step back to
contemplate the purpose of sections, one may even consider more flexible
approaches, such as:

();; [@doc.declarations [
  firstpart, {{First Part of my API}};
  second, {{The More Specialized Rest}};
]]

type a = ... [@doc {{...}}][@doc.section firstpart]
and b = ... [@doc {{...}] (* implicitly it's still in section "firstpart" *)
and c = .... [@doc {{...}}]
and d = ... [@doc {{...}}][@doc.section second]
and e = [@doc {{...}}]
and f = ... [@doc {{...}}][@doc.section firstpart]
  (* for some reason I want to display [f] in the first section, but didn't
want to move the actual  code around *)





On Sat, Oct 12, 2013 at 7:59 AM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> What about using regular item attributes for section headers?  This might
> be not so nice conceptually, but would there be actual problems with this
> approach?
>
> -- Alain
>
>
> On 10/11/2013 11:19 PM, Leo White wrote:
>
>> Are you asking for allowing:
>>>
>>>   type t = ...
>>>
>>>   [@@@doc.section ....]
>>>
>>>   and s = ...
>>>
>>>
>>> ?
>>>
>>
>> Yes
>>
>>  Honestly, I'm not yet convinced this is really necessary.  Do we really
>>> need to split documentation sections in such
>>> places?
>>>
>>
>> I think that large files of recursive type definitions, as are quite
>> common in OCaml, are quite likely to want section headers. I am also
>> hoping to be backwards-compatible with existing OCamldoc, which I think
>> supports such comments.
>>
>>  But if we go this way, I'd be inclined to look again at an early
>>> proposal of considering groups of declarations
>>> as successive items (similarly to Types), so that attached item
>>> attributes can be represented more uniformly (in the
>>> signature_item and structure_item records).
>>>
>>
>> I think that will be more work than making type_declaration a variant
>> type with a Ptyp_attribute constructor. However it may be a little
>> neater.
>>
>> Regards,
>>
>> Leo
>>
>>
> ______________________________**_________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/**listinfo/wg-camlp4<http://lists.ocaml.org/listinfo/wg-camlp4>
>

--001a113351945e634904e887f951
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div><div><div><div><div><div><div><div>I think the major =
benefits of extension-points for documentation, compared to ocamldoc commen=
ts, is that they are unambiguously attached to an AST node. We get in troub=
le for section headers because they don&#39;t fit that framework very well;=
 they&#39;re not semantically attached to a precise node, and even if you w=
ould consider them as attached to a set of nods (the ones in the section), =
this set apparently has no reason to respect the AST structure. So we get a=
n impedance mismatch here.<br>

<br></div>I don&#39;t think that the use case of putting free-floating sect=
ion nodes in between mutually recursive declarations is important enough to=
 provoke large changes to the AST structure. Alain&#39;s suggestion to not =
have any special syntax for this seems sensible. Once we take a few step ba=
ck to contemplate the purpose of sections, one may even consider more flexi=
ble approaches, such as:<br>

<br></div>();; [@doc.declarations [<br></div>=A0 firstpart, {{First Part of=
 my API}};<br></div>=A0 second, {{The More Specialized Rest}};<br>]]<br><br=
></div>type a =3D ... [@doc {{...}}][@doc.section firstpart]<br></div>and b=
 =3D ... [@doc {{...}] (* implicitly it&#39;s still in section &quot;firstp=
art&quot; *)<br>

</div><div>and c =3D .... [@doc {{...}}]<br></div>and d =3D ... [@doc {{...=
}}][@doc.section second]<br></div><div>and e =3D [@doc {{...}}]<br></div>an=
d f =3D ... [@doc {{...}}][@doc.section firstpart] <br>=A0 (* for some reas=
on I want to display [f] in the first section, but didn&#39;t want to move =
the actual=A0 code around *)<br>

<div><div><div><div><div><div><div><br><br><br></div></div></div></div></di=
v></div></div></div><div class=3D"gmail_extra"><br><br><div class=3D"gmail_=
quote">On Sat, Oct 12, 2013 at 7:59 AM, Alain Frisch <span dir=3D"ltr">&lt;=
<a href=3D"mailto:alain.frisch@lexifi.com" target=3D"_blank">alain.frisch@l=
exifi.com</a>&gt;</span> wrote:<br>

<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">What about using regular item attributes for=
 section headers? =A0This might be not so nice conceptually, but would ther=
e be actual problems with this approach?<span class=3D"HOEnZb"><font color=
=3D"#888888"><br>


<br>
-- Alain</font></span><div class=3D"HOEnZb"><div class=3D"h5"><br>
<br>
On 10/11/2013 11:19 PM, Leo White wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><blockquote class=3D"gmail_quote" style=3D"m=
argin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
Are you asking for allowing:<br>
<br>
=A0 type t =3D ...<br>
<br>
=A0 [@@@doc.section ....]<br>
<br>
=A0 and s =3D ...<br>
<br>
<br>
?<br>
</blockquote>
<br>
Yes<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Honestly, I&#39;m not yet convinced this is really necessary. =A0Do we real=
ly need to split documentation sections in such<br>
places?<br>
</blockquote>
<br>
I think that large files of recursive type definitions, as are quite<br>
common in OCaml, are quite likely to want section headers. I am also<br>
hoping to be backwards-compatible with existing OCamldoc, which I think<br>
supports such comments.<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
But if we go this way, I&#39;d be inclined to look again at an early propos=
al of considering groups of declarations<br>
as successive items (similarly to Types), so that attached item attributes =
can be represented more uniformly (in the<br>
signature_item and structure_item records).<br>
</blockquote>
<br>
I think that will be more work than making type_declaration a variant<br>
type with a Ptyp_attribute constructor. However it may be a little<br>
neater.<br>
<br>
Regards,<br>
<br>
Leo<br>
<br>
</blockquote>
<br>
______________________________<u></u>_________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org" target=3D"_blank">wg-camlp4@li=
sts.ocaml.org</a><br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/<u></u>listinfo/wg-camlp4</a><br>
</div></div></blockquote></div><br></div>

--001a113351945e634904e887f951--

From lpw25@cam.ac.uk  Sat Oct 12 18:16:36 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 32CB43C1FF
 for <wg-camlp4@lists.ocaml.org>; Sat, 12 Oct 2013 18:16:36 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from host86-133-163-25.range86-133.btcentralplus.com
 ([86.133.163.25]:60207 helo=study.localdomain)
 by ppsw-32.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.156]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1VV35d-0005TI-2m (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@cam.ac.uk>); Sat, 12 Oct 2013 18:34:58 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
 <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
X-Face: "XWxb[u_Z\PA_Y?9@|IA!!+jTb(/290-*ea/Un$I0B98.$n%eL.;
 2w<l)q>*,z]WR#T:,p[
 NBd++M7l]#7zj7!{<NUTKJA{}Ox<uO[wb-s<\6jzp.r]-AE[W%E+ckCQ'2WZS@Zu/PJU$~~oy|>~iw
 $W-"/=|dVjhT[D{4~gE}gK<2`.6fs!;uqqud]vs2N/3^m7{aS1V,
Date: Sat, 12 Oct 2013 18:41:56 +0100
In-Reply-To: <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
 (Gabriel Scherer's message of "Sat, 12 Oct 2013 11:36:07 +0200")
Message-ID: <874n8mfkt7.fsf@study.localdomain>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 12 Oct 2013 17:16:36 -0000

> I think the major benefits of extension-points for documentation, compared to ocamldoc comments, is that they are
> unambiguously attached to an AST node. We get in trouble for section headers because they don't fit that framework very
> well; they're not semantically attached to a precise node, and even if you would consider them as attached to a set of
> nods (the ones in the section), this set apparently has no reason to respect the AST structure. So we get an impedance
> mismatch here.

To be clear, I don't think writing documentation directly as
extension-points is a good idea. However, I do think that it is a good
idea to store the documentation (taken from ocamldoc comments) as
extension-points within the AST.

As a side note, this part of the AST would also need to be rewritten if
we wanted to support mutually recursive definitions of different
sorts. For example:

    type t = #foo list
    and class type foo = object method x : t end

which I know has been previously requested.

From lpw25@cam.ac.uk  Sat Oct 12 18:19:09 2013
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id D5CB43C1FF
 for <wg-camlp4@lists.ocaml.org>; Sat, 12 Oct 2013 18:19:09 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from host86-133-163-25.range86-133.btcentralplus.com
 ([86.133.163.25]:49040 helo=study.localdomain)
 by ppsw-52.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.158]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1VV386-0000fG-Dn (Exim 4.80_167-5a66dd3)
 (return-path <lpw25@cam.ac.uk>); Sat, 12 Oct 2013 18:37:31 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
X-Face: "XWxb[u_Z\PA_Y?9@|IA!!+jTb(/290-*ea/Un$I0B98.$n%eL.;
 2w<l)q>*,z]WR#T:,p[
 NBd++M7l]#7zj7!{<NUTKJA{}Ox<uO[wb-s<\6jzp.r]-AE[W%E+ckCQ'2WZS@Zu/PJU$~~oy|>~iw
 $W-"/=|dVjhT[D{4~gE}gK<2`.6fs!;uqqud]vs2N/3^m7{aS1V,
Date: Sat, 12 Oct 2013 18:44:19 +0100
In-Reply-To: <5258E54C.5050701@lexifi.com> (Alain Frisch's message of "Sat, 12
 Oct 2013 07:59:40 +0200")
Message-ID: <87zjqee64s.fsf@study.localdomain>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 12 Oct 2013 17:19:10 -0000

[Sorry for repeat Alain: I accidently dropped wg-camlp4 from the reply]

> What about using regular item attributes for section headers?  This might be not so nice conceptually, but would there
> be actual problems with this approach?

For my use case it is probably ok, although I would prefer a cleaner
system. I imagine at some point someone will get a surprising section
header in the wrong place due to an incorrectly written ppx processor,
but perhaps that is fine.

From alain.frisch@lexifi.com  Fri Oct 18 14:54:49 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 35FA83C371
 for <wg-camlp4@lists.ocaml.org>; Fri, 18 Oct 2013 14:54:49 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1533008 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:51879
 helo=msa.smtpout.orange.fr)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1VXAny-0003VC-DB (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Fri, 18 Oct 2013 15:13:30 +0100
Received: from [192.168.1.116] ([92.151.70.202]) by mwinf5d30 with ME
 id eeDU1m00w4MrDJL03eDVmr; Fri, 18 Oct 2013 16:13:29 +0200
Message-ID: <52614209.2000006@lexifi.com>
Date: Fri, 18 Oct 2013 16:13:29 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
 <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
In-Reply-To: <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 18 Oct 2013 13:54:49 -0000

On 10/12/2013 11:36 AM, Gabriel Scherer wrote:
> I don't think that the use case of putting free-floating section nodes
> in between mutually recursive declarations is important enough to
> provoke large changes to the AST structure. Alain's suggestion to not
> have any special syntax for this seems sensible.

Leo mentioned the risk that by using normal item attributes for sections 
can yield to suprising results if -ppx rewriter start moving declaration 
around or inserting new ones.

I think it makes sense to keep floating attributes in general.  They are 
useful also to turn warnings on/off, for instance.  And it is fine to 
use them for ocamldoc section as well (and also to specify an initial 
header, before the first item).   Now if there is really a need to split 
sections in the middle of a group of mutally recursive declarations, 
using attributes on each declaration is probably fine.

Do you agree?


Alain

From yminsky@janestreet.com  Sat Nov  2 17:02:17 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id DDF8A3C371
 for <wg-camlp4@lists.ocaml.org>; Sat,  2 Nov 2013 17:02:17 +0000 (GMT)
X-Cam-SpamDetails: score -0.4 from SpamAssassin-3.3.2-1537852 
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:49551
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1VcetL-0004D3-hI (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Sat, 02 Nov 2013 17:21:49 +0000
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1Vcesy-0001YT-W1
 for wg-camlp4@lists.ocaml.org; Sat, 02 Nov 2013 13:21:20 -0400
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1Vcesy-0000K4-V9
 for wg-camlp4@lists.ocaml.org; Sat, 02 Nov 2013 13:21:20 -0400
Received: from mail-ee0-f50.google.com ([74.125.83.50])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1Vcesy-00077B-QA
 for wg-camlp4@lists.ocaml.org; Sat, 02 Nov 2013 13:21:20 -0400
Received: by mail-ee0-f50.google.com with SMTP id l10so334951eei.9
 for <wg-camlp4@lists.ocaml.org>; Sat, 02 Nov 2013 10:21:20 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=mime-version:date:message-id:subject:from:to:content-type;
 bh=j5/6fNxzYjcyCpbH0o4ZuV7uNy4Vv4iSCh3BJ+unlwI=;
 b=gZimZg81J3iRwIy34JbVmj0IlJOixV847+dKhwhIlJHGPP0uOGnRauVdxGBpJecffo
 lmuLUdJZvQzbXAbPithNsa85U/VZzxeD23bAVaXqK91YU+79PYJvW5pPKbdWTYDpQmEn
 om8ED+p0RBB0r2G2gUvHzikA0QG/2jPMIFJ78=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20130820;
 h=x-gm-message-state:mime-version:date:message-id:subject:from:to
 :content-type;
 bh=j5/6fNxzYjcyCpbH0o4ZuV7uNy4Vv4iSCh3BJ+unlwI=;
 b=csXZv1pprdG1SYa16Bcom3S8y9ffDa7xnUpuoGzvO3FxIpwI1Waa0eR42UlG3Uznd2
 +UJX/6QIsPuukNvi+LUuX4CKASlmaPgalehuJbeK0djjcwq9yeqRdLYNbQ1Z+Aq5tAvo
 fY82FjA6hPxUBJCe0RpC1MgAojukX/Am+xsQVB4pfaTkr7qjYzaKmnt4yHDvXk22OxPr
 KH7v/wu3SXT7bHPx7ngmHHjaxtNlC6Fh6pxGQBW+FqZbcfbShDiD0lBa06qw5KXDJ/qO
 UUMybEZP/vMXUUgC8jUKbRSh3t8azd8h2ZGIYPKSZEy397VSzoabWncgYt8U6vMrgMKY
 75bg==
X-Gm-Message-State: ALoCoQkvWwAbZfrHsS4Eon3MYNYOtcOO2GrGPQDMNos1Nf2ydiIX4/ZCJn6zscGZRKi9OQb8bMBTwkgTOfWRtaF/PQSmc8FPoI7xxi/8Ff4EMXlcZ8mM3FzYKzOrXe1HUo9w54v82GwJ0IybFanYfpIhG30NwelEklFZUUBaSPYdtxf7jRthYFI=
X-Received: by 10.15.54.199 with SMTP id t47mr8502315eew.46.1383412880197;
 Sat, 02 Nov 2013 10:21:20 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.15.54.199 with SMTP id t47mr8502306eew.46.1383412880075;
 Sat, 02 Nov 2013 10:21:20 -0700 (PDT)
Received: by 10.223.180.138 with HTTP; Sat, 2 Nov 2013 10:21:19 -0700 (PDT)
Date: Sat, 2 Nov 2013 13:21:19 -0400
Message-ID: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 =?ISO-8859-1?Q?Fr=E9d=E9ric_Bour?= <defree@gmail.com>, 
 thomas.refis@gmail.com
Content-Type: text/plain; charset=ISO-8859-1
Subject: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 02 Nov 2013 17:02:18 -0000

I've been playing using Merlin more and more for personal projects,
and have started to wonder about how we're going to make Merlin work
effectively in a ppx world.  In some ways, ppx simplifies Merlin's
job, since there's now just one concrete syntax to parse.

But there are still problems to solve.  In particular, you will still
need to be able to apply AST-transformers to the partial ASTs that
Merlin generates in order to run it through the type-inference stage,
or to determine the environment.

Obviously, Merlin could just reimplement a bunch of common AST
transformers, as it does now for some common camlp4 extensions.  But
this seems like a situation that is too painful to maintain in the
long term.

A better idea, perhaps, would be to have some libraries or standards
about how to present an AST transformer so that it's suitable for
running against a partial AST.  I don't really know the details of how
Merlin works, but I understand it does a first pass to parse
expressions into top-level units, the parsing of which is done
independently.  AST transformers that operate on those units would
naturally gain some level of incrementality.  Another, perhaps more
intrustive approach would be to write PPX transformers against
Merlin's version of the AST.

I don't quite know what the right solution is, but when 4.02 comes out
we're all going to be writing a bunch of new AST transformers, and if
we really want Merlin to be a success, we should have a plan for how
those transformers will integrate with it.

y

From alain.frisch@lexifi.com  Mon Nov  4 08:48:05 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 851603C1DF
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 08:48:05 +0000 (GMT)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1538327 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:17826
 helo=msa.smtpout.orange.fr)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1VdG8L-0004i8-2j (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Nov 2013 09:07:42 +0000
Received: from [192.168.1.112] ([92.151.113.54]) by mwinf5d15 with ME
 id lM7c1m00Z1AUm6L03M7eo0; Mon, 04 Nov 2013 10:07:41 +0100
Message-ID: <527763D8.4060300@lexifi.com>
Date: Mon, 04 Nov 2013 10:07:36 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:25.0) Gecko/20100101 Thunderbird/25.0
MIME-Version: 1.0
To: Yaron Minsky <yminsky@janestreet.com>, 
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 =?ISO-8859-1?Q?Fr=E9d=E9ric_Bour?= <defree@gmail.com>, 
 thomas.refis@gmail.com
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
In-Reply-To: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 08:48:05 -0000

On 11/02/2013 06:21 PM, Yaron Minsky wrote:
> A better idea, perhaps, would be to have some libraries or standards
> about how to present an AST transformer so that it's suitable for
> running against a partial AST.  I don't really know the details of how
> Merlin works, but I understand it does a first pass to parse
> expressions into top-level units, the parsing of which is done
> independently.  AST transformers that operate on those units would
> naturally gain some level of incrementality.

I don't know anything about Merlin.  I assume that it uses a special 
representation of the AST which is more robust w.r.t. ill-formed 
fragments (syntax errors).  Is that right?   Could this representation 
of partial ASTs be encoded in the official Parsetree using extension 
nodes to denote invalid fragments?  Independently of the question of 
supporting ppx transformers, anything which brings Merlin closer to the 
official system is likely to make it more future-proof.


Alain

From defree@gmail.com  Mon Nov  4 12:21:33 2013
Return-Path: <defree@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 72D1B3C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 12:21:33 +0000 (GMT)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1538327 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.42 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (defree[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f42.google.com ([74.125.82.42]:35926)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VdJSv-0006F6-8h (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <defree@gmail.com>); Mon, 04 Nov 2013 12:41:10 +0000
Received: by mail-wg0-f42.google.com with SMTP id n12so1712081wgh.5
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Nov 2013 04:41:08 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=message-id:date:from:user-agent:mime-version:to:subject:references
 :in-reply-to:content-type:content-transfer-encoding;
 bh=iRNAKKbnYF28KzFhADlnJ8LPLh1AoqDTV2+Je4gMdJk=;
 b=jjkmzU70lJfAwEmllp9+TaBZFoC7XEHoLXxfmazSeAD34kBgGiW/bpjeGjzGT77OFG
 dp6AeNt84J/McqdS+8GNNxGgmreUI7Lux49OjNB0pfN4FrYaZHOO7npVfX+EdD3biMC/
 0cjc8wFG0EyRbGullrXwV3+s7AKUPy6QZdl99gcLVdbqGzLj8qIvkchh0xzZKYwyx+/M
 NqafatCmhraqW1BP7dydmyXAFgxpLWU9PypzuB5gcEVcwTJ615KVsMGD25Grc6nfhVUE
 zQRaDlWDZFR9mWVxBsg0cOWmJLLsmE8caq1K7Tn+1WP/vJUJyFtY7ctFIDQMycSODFx5
 BxXg==
X-Received: by 10.180.87.69 with SMTP id v5mr12044727wiz.45.1383568868551;
 Mon, 04 Nov 2013 04:41:08 -0800 (PST)
Received: from ?IPv6:2a01:e34:ecec:5220:222:15ff:feea:66ed?
 ([2a01:e34:ecec:5220:222:15ff:feea:66ed])
 by mx.google.com with ESMTPSA id w10sm3533498wia.4.2013.11.04.04.41.07
 for <multiple recipients>
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Mon, 04 Nov 2013 04:41:07 -0800 (PST)
Message-ID: <52779579.3060000@gmail.com>
Date: Mon, 04 Nov 2013 13:39:21 +0100
From: =?UTF-8?B?RnLDqWTDqXJpYyBCb3Vy?= <defree@gmail.com>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.1.0
MIME-Version: 1.0
To: Alain Frisch <alain.frisch@lexifi.com>, 
 Yaron Minsky <yminsky@janestreet.com>,
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>, =?UTF-8?B?RnLDqQ==?=
 =?UTF-8?B?ZMOpcmljIEJvdXI=?= <defree@gmail.com>, thomas.refis@gmail.com
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <527763D8.4060300@lexifi.com>
In-Reply-To: <527763D8.4060300@lexifi.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 12:21:33 -0000

On 04/11/2013 10:07, Alain Frisch wrote:
> On 11/02/2013 06:21 PM, Yaron Minsky wrote:
>> A better idea, perhaps, would be to have some libraries or standards
>> about how to present an AST transformer so that it's suitable for
>> running against a partial AST. I don't really know the details of how
>> Merlin works, but I understand it does a first pass to parse
>> expressions into top-level units, the parsing of which is done
>> independently. AST transformers that operate on those units would
>> naturally gain some level of incrementality.
>
> I don't know anything about Merlin. I assume that it uses a special 
> representation of the AST which is more robust w.r.t. ill-formed 
> fragments (syntax errors). Is that right? Could this representation of 
> partial ASTs be encoded in the official Parsetree using extension 
> nodes to denote invalid fragments? Independently of the question of 
> supporting ppx transformers, anything which brings Merlin closer to 
> the official system is likely to make it more future-proof.

Merlin uses the original AST definition, so that the typer can be used 
with minimal modifications.
Internally the Ocaml AST for a given file is split in a list of chunks 
(around one per definition plus a special case for entering/exiting 
sub-structures).

The two changes wrt to ASTs produced by original ocaml are:
 an hack to store more positional information in AST Nodes, by 
working-around ocaml value representation.
 when detected and recoverable, ill-formed expressions are replaced by 
an expression of type "forall 'a .'a".

The first case could obviously be made less hacky through extension nodes.

>
> Alain
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4


From defree@gmail.com  Mon Nov  4 12:44:46 2013
Return-Path: <defree@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id EEE353C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 12:44:45 +0000 (GMT)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1538327 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.49 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (defree[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f49.google.com ([74.125.82.49]:51561)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1VdJpO-0003dK-2X (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <defree@gmail.com>); Mon, 04 Nov 2013 13:04:23 +0000
Received: by mail-wg0-f49.google.com with SMTP id x12so1988645wgg.4
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Nov 2013 05:04:22 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=message-id:date:from:user-agent:mime-version:to:subject:references
 :in-reply-to:content-type:content-transfer-encoding;
 bh=INL8oRQn9k+N5tie2D90DMYw8I0bpYDS1t360GXMUvk=;
 b=eaXPpXKaYCGASJXAl09YL0oGKzPHfh8KaLt/TihEQQCuxRwHC9phN3Fh8NwxxP1HGd
 QwA8/6pGBfwGcxLGToWlzjt68dQtneuq2HivRhnr0enpssOVvAoZqxLzckdqFf+bs1sM
 D+phY73XTe/sDbo8sjcc1sKXM4XZBOAGgRfB6bVcOAa9iEU9d/GRyF18uQoeEy5OfAyd
 YIz+cSyoN8JBMSx/xQ5hEKezZzn0rWuHGMJmkn0850pduwEEE/R9o0PQq5GMUgRjM+1a
 Jy6ZaoZidtWwJb99sEf2Wb4uPmEs2ElXlZKSvxefZncccvfEHWbyzs5UVCBGHy3I3rtW
 PmPw==
X-Received: by 10.194.78.141 with SMTP id b13mr5060742wjx.32.1383570262548;
 Mon, 04 Nov 2013 05:04:22 -0800 (PST)
Received: from ?IPv6:2a01:e34:ecec:5220:222:15ff:feea:66ed?
 ([2a01:e34:ecec:5220:222:15ff:feea:66ed])
 by mx.google.com with ESMTPSA id q3sm3798171wib.5.2013.11.04.05.04.20
 for <multiple recipients>
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Mon, 04 Nov 2013 05:04:21 -0800 (PST)
Message-ID: <52779AEB.2050402@gmail.com>
Date: Mon, 04 Nov 2013 14:02:35 +0100
From: =?UTF-8?B?RnLDqWTDqXJpYyBCb3Vy?= <defree@gmail.com>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.1.0
MIME-Version: 1.0
To: Yaron Minsky <yminsky@janestreet.com>, 
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 thomas.refis@gmail.com
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
In-Reply-To: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 12:44:46 -0000

On 02/11/2013 18:21, Yaron Minsky wrote:
> I've been playing using Merlin more and more for personal projects,
> and have started to wonder about how we're going to make Merlin work
> effectively in a ppx world.  In some ways, ppx simplifies Merlin's
> job, since there's now just one concrete syntax to parse.
>
> But there are still problems to solve.  In particular, you will still
> need to be able to apply AST-transformers to the partial ASTs that
> Merlin generates in order to run it through the type-inference stage,
> or to determine the environment.
Those partial ASTs are still represented with the same type as OCaml 
"normal" ASTs.
There should be no difference for the transformers at this stage.

> Obviously, Merlin could just reimplement a bunch of common AST
> transformers, as it does now for some common camlp4 extensions.  But
> this seems like a situation that is too painful to maintain in the
> long term.
Indeed, ppx seems to be the opportunity to stop hardcoding extensions in 
merlin.

> A better idea, perhaps, would be to have some libraries or standards
> about how to present an AST transformer so that it's suitable for
> running against a partial AST.  I don't really know the details of how
> Merlin works, but I understand it does a first pass to parse
> expressions into top-level units, the parsing of which is done
> independently.  AST transformers that operate on those units would
> naturally gain some level of incrementality.  Another, perhaps more
> intrustive approach would be to write PPX transformers against
> Merlin's version of the AST.
The work done by the transformer when invoked by merlin or by the 
toplevel should be the same: the AST is given chunk-by-chunk, each chunk 
being passed for transformation.

Under the assumption that, for a given transformer t and without 
imposing an order of transformation:
t (def1;; def2) ~= t(def1) ;; t(def2)
using this transformer in merlin should not require specific work.

That being said, I don't know much about ppx. Here are the cases I see 
that could be problematic in general:
 the transformer relies on some global state, that has to be threaded 
across different invocations.
 the toplevel works only in a sequential way, and backtrack only if the 
current definition fails to type. merlin can rollback to arbitrary point 
in files, which could break assumptions in the transformer if there is a 
state.
 merlin also split definitions inside modules, which means that pieces 
of ast could be extracted and transformed either separately or not in 
the expected order (e.g. the signature constraining a structure can be 
extracted by merlin and transformed as if it was an independent 
declaration, then reinjected in the AST).

>
> I don't quite know what the right solution is, but when 4.02 comes out
> we're all going to be writing a bunch of new AST transformers, and if
> we really want Merlin to be a success, we should have a plan for how
> those transformers will integrate with it.
>
> y


From alain.frisch@lexifi.com  Mon Nov  4 13:05:43 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 5A8DB3C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 13:05:43 +0000 (GMT)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1538327 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:30294
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VdK9g-0001ud-7O (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Nov 2013 13:25:20 +0000
Received: from [192.168.1.112] ([92.151.8.164]) by mwinf5d56 with ME
 id lRRJ1m00W3YLrng03RRJ8C; Mon, 04 Nov 2013 14:25:19 +0100
Message-ID: <5277A03F.8020704@lexifi.com>
Date: Mon, 04 Nov 2013 14:25:19 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:25.0) Gecko/20100101 Thunderbird/25.0
MIME-Version: 1.0
To: =?UTF-8?B?RnLDqWTDqXJpYyBCb3Vy?= <defree@gmail.com>, 
 Yaron Minsky <yminsky@janestreet.com>,
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>, 
 thomas.refis@gmail.com
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com>
In-Reply-To: <52779AEB.2050402@gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 13:05:43 -0000

On 11/04/2013 02:02 PM, Frdric Bour wrote:
>  the transformer relies on some global state, that has to be threaded
> across different invocations.

This will indeed be the case for some transformers -- think about a 
macro system with macros defined in the same unit.

But if you use the same representation as the compiler for the AST, 
couldn't you simply apply the transformers to the whole AST?  Why do you 
need to apply them to individual chunks?


Alain

From defree@gmail.com  Mon Nov  4 13:28:27 2013
Return-Path: <defree@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B51B73C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 13:28:27 +0000 (GMT)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1538327 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.42 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (defree[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f42.google.com ([74.125.82.42]:62480)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VdKVg-0003gw-8f (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <defree@gmail.com>); Mon, 04 Nov 2013 13:48:05 +0000
Received: by mail-wg0-f42.google.com with SMTP id n12so1782417wgh.1
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Nov 2013 05:48:04 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=message-id:date:from:user-agent:mime-version:to:cc:subject
 :references:in-reply-to:content-type:content-transfer-encoding;
 bh=SveLFs5XlgjTOwnLSguqKXyLAGYEWaTF2pAvdusxfX4=;
 b=zl/2obgPLR/aeXowpWC2/pDH6uCHunO9T1wSNDVeS3qRMdZgxkIj2ASVmDv7MoB8lj
 EoBT+x7DP6Lfd6ZeNbX5rVF+Lg/hh5VO5G1g84yH7sk6AkhXBz8nSNOObiSyhod5n7Of
 Wfvv6nBNHAx6wiwvcst8zgEidwr03YHgLzksEjl/+KHAlTle0MY1OQkmc5iBDgyL9eBz
 0dEVjKvHmqY8iOkIHmX9WaO0WVoGQw+GPyvdTQ7fWmbaHtTRCKr+1E0CyR9Kvy2O0f9H
 JDVGi2AJEs20kGp8qugc4lBCO+1H3JHPs4MUYF/Zon7ZUJ7/zqk0P7lj1xSENeUtcuY8
 SflA==
X-Received: by 10.194.47.209 with SMTP id f17mr1670855wjn.55.1383572884353;
 Mon, 04 Nov 2013 05:48:04 -0800 (PST)
Received: from ?IPv6:2a01:e34:ecec:5220:222:15ff:feea:66ed?
 ([2a01:e34:ecec:5220:222:15ff:feea:66ed])
 by mx.google.com with ESMTPSA id fr4sm4151480wib.0.2013.11.04.05.48.02
 for <multiple recipients>
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Mon, 04 Nov 2013 05:48:03 -0800 (PST)
Message-ID: <5277A529.9010707@gmail.com>
Date: Mon, 04 Nov 2013 14:46:17 +0100
From: =?UTF-8?B?RnLDqWTDqXJpYyBCb3Vy?= <defree@gmail.com>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.1.0
MIME-Version: 1.0
To: Alain Frisch <alain.frisch@lexifi.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com> <5277A03F.8020704@lexifi.com>
In-Reply-To: <5277A03F.8020704@lexifi.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 thomas.refis@gmail.com
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 13:28:27 -0000

Le lun. 04 nov. 2013 14:25:19 CET, Alain Frisch a crit :
> On 11/04/2013 02:02 PM, Frdric Bour wrote:
>>  the transformer relies on some global state, that has to be threaded
>> across different invocations.
>
> This will indeed be the case for some transformers -- think about a
> macro system with macros defined in the same unit.
>
> But if you use the same representation as the compiler for the AST,
> couldn't you simply apply the transformers to the whole AST?  Why do
> you need to apply them to individual chunks?

Merlin is used in an interactive context (were we expect a response in 
less than ~ 60ms, on average).

If we retransform the whole AST during each invocation, we also need to 
retype the whole AST after. Then an "open Core.Std" alone is enough to 
blow up the time budget. (And this existimation is done on a desktop 
computer, some users have EEE).

However, I wonder how this state threading would be handled in the 
REPL?

>
>
> Alain

From yminsky@janestreet.com  Mon Nov  4 13:41:12 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 198873C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 13:41:12 +0000 (GMT)
X-Cam-SpamDetails: score 0.1 from SpamAssassin-3.3.2-1538327 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:40080
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1VdKhv-0005g1-iM (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Mon, 04 Nov 2013 14:00:49 +0000
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1VdKha-0007O2-KT
 for wg-camlp4@lists.ocaml.org; Mon, 04 Nov 2013 09:00:22 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1VdKha-0004Km-JW
 for wg-camlp4@lists.ocaml.org; Mon, 04 Nov 2013 09:00:22 -0500
Received: from mail-ea0-f170.google.com ([209.85.215.170])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1VdKha-0000qI-DR
 for wg-camlp4@lists.ocaml.org; Mon, 04 Nov 2013 09:00:22 -0500
Received: by mail-ea0-f170.google.com with SMTP id q10so2836049eaj.29
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Nov 2013 06:00:21 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type:content-transfer-encoding;
 bh=9IumMu93VsEnsGSDvI1v5YYJrsRbHh9ZaoRJpeCgdm0=;
 b=F3KP1KY2ZSGQrfd3RL1812OpH5HzJnQKKbsprZ40x8gjsXLRryfZUlEPU5xapBJf91
 qppV3Cs7KQc9C9q5TYsSjtJnJ4bhQtMxa5fAYfXYWW6pRymcOS4JgCRmpDTUWh4wqGAb
 LifvcMZUpLA2XO4oyi2QxmWrtSILReJOU0juI=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20130820;
 h=x-gm-message-state:mime-version:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type
 :content-transfer-encoding;
 bh=9IumMu93VsEnsGSDvI1v5YYJrsRbHh9ZaoRJpeCgdm0=;
 b=P6qEU4OA2Y/hOFMxlIjJ8f9UB+L6FKJ2SaTPodVWiDLuRFsB6xTSWvlRLsh6p7mJjH
 Scg8Oswco6cKa2ACRLGdg9WY/yJ1AmpYb6sd9FR9tIS1klqEO7SsDgyBfHUlfPbzNFZ0
 px2RRVVfVaKLrPvv8mdEB0vRd0SnTG5vouFE2MqmvWwLGlcucdo/rSPNUHCBzGwddbR3
 3E8a5YmoN+gGj2FYJmq8qKKkWnMLwYD1D9+0LvYG7w3ib6XR+Xst6d0XGQmU5TxSN4rw
 niltwDn5fut4+DWfuHPtnmy2tCEY2vLnVc8GM6CvagqEOHExOBT+YVJkpmha57v/evl5
 74Gg==
X-Gm-Message-State: ALoCoQnF49Tl1kf/YC9CloUqOZ0dHu5r69ss4BSY8dObQpT2BIUFehQnG2V2XikUgKHrNwEq5d4w3yPsyM08GsuBy2mx+3m7f0NK3SZ6Fom6Kqj6HzqPereb3xP+fB4N4w1QKNBs/+6u9qOGVeid7sK42wRH+l6eyl2pWHy/7R6J0ZjMVEtIKqc=
X-Received: by 10.14.207.132 with SMTP id n4mr239305eeo.102.1383573621834;
 Mon, 04 Nov 2013 06:00:21 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.14.207.132 with SMTP id n4mr239288eeo.102.1383573621714;
 Mon, 04 Nov 2013 06:00:21 -0800 (PST)
Received: by 10.223.180.138 with HTTP; Mon, 4 Nov 2013 06:00:21 -0800 (PST)
In-Reply-To: <5277A529.9010707@gmail.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com> <5277A03F.8020704@lexifi.com>
 <5277A529.9010707@gmail.com>
Date: Mon, 4 Nov 2013 09:00:21 -0500
Message-ID: <CACLX4jQh4PK9OB+nUhJbBJ4FaCMV7U-ECZfOw1O3xh_G1drA=A@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: =?ISO-8859-1?Q?Fr=E9d=E9ric_Bour?= <defree@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 thomas.refis@gmail.com
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 13:41:12 -0000

I very much hope that the Core.Std problem will be gone in 4.02.
Module aliases look likely to land by then, and they should _greatly_
reduce the cost.

y

On Mon, Nov 4, 2013 at 8:46 AM, Fr=E9d=E9ric Bour <defree@gmail.com> wrote:
> Le lun. 04 nov. 2013 14:25:19 CET, Alain Frisch a =E9crit :
>
>> On 11/04/2013 02:02 PM, Fr=E9d=E9ric Bour wrote:
>>>
>>> - the transformer relies on some global state, that has to be threaded
>>> across different invocations.
>>
>>
>> This will indeed be the case for some transformers -- think about a
>> macro system with macros defined in the same unit.
>>
>> But if you use the same representation as the compiler for the AST,
>> couldn't you simply apply the transformers to the whole AST?  Why do
>> you need to apply them to individual chunks?
>
>
> Merlin is used in an interactive context (were we expect a response in le=
ss
> than ~ 60ms, on average).
>
> If we retransform the whole AST during each invocation, we also need to
> retype the whole AST after. Then an "open Core.Std" alone is enough to bl=
ow
> up the time budget. (And this existimation is done on a desktop computer,
> some users have EEE).
>
> However, I wonder how this state threading would be handled in the REPL ?
>
>>
>>
>> Alain

From yminsky@janestreet.com  Mon Nov  4 13:42:24 2013
Return-Path: <yminsky@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 1DDE13C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 13:42:24 +0000 (GMT)
X-Cam-SpamDetails: score 0.1 from SpamAssassin-3.3.2-1538327 
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mx5.janestreet.com ([38.105.200.229]:55468
 helo=tot-dmz-mxout1.janestreet.com)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1VdKj5-0007F9-FQ (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <yminsky@janestreet.com>); Mon, 04 Nov 2013 14:02:01 +0000
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by tot-dmz-mxout1.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1VdKil-0007aN-1V
 for wg-camlp4@lists.ocaml.org; Mon, 04 Nov 2013 09:01:35 -0500
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <yminsky@janestreet.com>) id 1VdKik-0004so-Vh
 for wg-camlp4@lists.ocaml.org; Mon, 04 Nov 2013 09:01:34 -0500
Received: from mail-ea0-f169.google.com ([209.85.215.169])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <yminsky@janestreet.com>) id 1VdKik-0000sn-Pc
 for wg-camlp4@lists.ocaml.org; Mon, 04 Nov 2013 09:01:34 -0500
Received: by mail-ea0-f169.google.com with SMTP id k11so3497240eaj.28
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Nov 2013 06:01:34 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type:content-transfer-encoding;
 bh=9d0bmAv4Lp1H8c9MWliFJCpLtVYbk+u78LCybS7lQkU=;
 b=02DfnvGVHxnfgzYiPEFVeIcC0XM39q3YuShC//Ae1p+atovjEX4IiiLJOY0eC/SG7g
 Uc6/jFKHnQV0MB/N9Ix5OrAr36uDF/dyTyvmWnrSrBoygM2ZBLk0vUuur8pZc2aTim6v
 9puNEY6g1m3zknWp9HdAl+GkswzywGew5SvuA=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20130820;
 h=x-gm-message-state:mime-version:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type
 :content-transfer-encoding;
 bh=9d0bmAv4Lp1H8c9MWliFJCpLtVYbk+u78LCybS7lQkU=;
 b=KXE+IZkmJvBgG0EgQZ7IcMKENnvrCWqZZvLcH8aYSGPJDJiQndCXtjgYxGKicZ/yDY
 +r+ubw/Ya7wxGo8M23DN9aXbJ37izApUZMZ8YzQ/5EXiyFaOc6XDGLiaIVdPJKuSPHo4
 YZteZnsZDeqbIipMHEosJ+qv/OM3FEpMEp5tWRkJyU+2IexuqsYoFmb4BY/g+BKlUpBC
 2+q3iqSr8jPjOK5kTATeNcQkGV6Al74fAQ3fDfaHaSLtoO/AtKh1AV2I+IX7jaFmQZgo
 V1BTtpup2cypkAWkV4J5CXqlNpX0uDNDM3LOQek2R2zxRJ+DXf0RvJERnQNWv8+acpqn
 2hQg==
X-Gm-Message-State: ALoCoQmEsdCgsBtpokGJaFOxBef9FYFXIRzUsZXlB9/cjfH3vO7Bj+N2j3wKMyxTKl8krr7A/NrBq5X/ZFSwMHGU7kKHXRv4XtbfOsH11XG95pisebc4XBzhlOHE0TC8rpTPDUiT+4JZPar40rDkdm+Re7uFmX0kK3PhXkjb0IVVy/jtYGa0m5I=
X-Received: by 10.15.74.197 with SMTP id j45mr8176702eey.40.1383573694281;
 Mon, 04 Nov 2013 06:01:34 -0800 (PST)
MIME-Version: 1.0
X-Received: by 10.15.74.197 with SMTP id j45mr8176694eey.40.1383573694205;
 Mon, 04 Nov 2013 06:01:34 -0800 (PST)
Received: by 10.223.180.138 with HTTP; Mon, 4 Nov 2013 06:01:34 -0800 (PST)
In-Reply-To: <52779AEB.2050402@gmail.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com>
Date: Mon, 4 Nov 2013 09:01:34 -0500
Message-ID: <CACLX4jT5wVu518G2r9Q4yDFRWZd_nMWvbcogNX4rXS7_F0EPEw@mail.gmail.com>
From: Yaron Minsky <yminsky@janestreet.com>
To: =?ISO-8859-1?Q?Fr=E9d=E9ric_Bour?= <defree@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 thomas.refis@gmail.com
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 13:42:24 -0000

On Mon, Nov 4, 2013 at 8:02 AM, Fr=E9d=E9ric Bour <defree@gmail.com> wrote:
> On 02/11/2013 18:21, Yaron Minsky wrote:
>>
>> I've been playing using Merlin more and more for personal projects,
>> and have started to wonder about how we're going to make Merlin work
>> effectively in a ppx world.  In some ways, ppx simplifies Merlin's
>> job, since there's now just one concrete syntax to parse.
>>
>> But there are still problems to solve.  In particular, you will still
>> need to be able to apply AST-transformers to the partial ASTs that
>> Merlin generates in order to run it through the type-inference stage,
>> or to determine the environment.
>
> Those partial ASTs are still represented with the same type as OCaml
> "normal" ASTs.
> There should be no difference for the transformers at this stage.
>
>
>> Obviously, Merlin could just reimplement a bunch of common AST
>> transformers, as it does now for some common camlp4 extensions.  But
>> this seems like a situation that is too painful to maintain in the
>> long term.
>
> Indeed, ppx seems to be the opportunity to stop hardcoding extensions in
> merlin.
>
>
>> A better idea, perhaps, would be to have some libraries or standards
>> about how to present an AST transformer so that it's suitable for
>> running against a partial AST.  I don't really know the details of how
>> Merlin works, but I understand it does a first pass to parse
>> expressions into top-level units, the parsing of which is done
>> independently.  AST transformers that operate on those units would
>> naturally gain some level of incrementality.  Another, perhaps more
>> intrustive approach would be to write PPX transformers against
>> Merlin's version of the AST.
>
> The work done by the transformer when invoked by merlin or by the topleve=
l
> should be the same: the AST is given chunk-by-chunk, each chunk being pas=
sed
> for transformation.

Does this work for sub-modules as well?  It's not rare in my
experience to do quite a bit of programming within a sub-module.  In a
top-level, you'd have to do that as one top-level chunk, which seems
like the wrong solution for merlin.

> Under the assumption that, for a given transformer t and without imposing=
 an
> order of transformation:
> t (def1;; def2) ~=3D t(def1) ;; t(def2)
> using this transformer in merlin should not require specific work.
>
> That being said, I don't know much about ppx. Here are the cases I see th=
at
> could be problematic in general:
> - the transformer relies on some global state, that has to be threaded
> across different invocations.
> - the toplevel works only in a sequential way, and backtrack only if the
> current definition fails to type. merlin can rollback to arbitrary point =
in
> files, which could break assumptions in the transformer if there is a sta=
te.
> - merlin also split definitions inside modules, which means that pieces o=
f
> ast could be extracted and transformed either separately or not in the
> expected order (e.g. the signature constraining a structure can be extrac=
ted
> by merlin and transformed as if it was an independent declaration, then
> reinjected in the AST).
>
>
>>
>> I don't quite know what the right solution is, but when 4.02 comes out
>> we're all going to be writing a bunch of new AST transformers, and if
>> we really want Merlin to be a success, we should have a plan for how
>> those transformers will integrate with it.
>>
>> y
>
>

From alain.frisch@lexifi.com  Mon Nov  4 13:46:41 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id ABB453C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 13:46:41 +0000 (GMT)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1538327 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:55032
 helo=msa.smtpout.orange.fr)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1VdKnK-0000oL-Dz (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Nov 2013 14:06:18 +0000
Received: from [192.168.1.112] ([92.151.8.164]) by mwinf5d56 with ME
 id lS6H1m0053YLrng03S6HST; Mon, 04 Nov 2013 15:06:17 +0100
Message-ID: <5277A9DA.7040206@lexifi.com>
Date: Mon, 04 Nov 2013 15:06:18 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:25.0) Gecko/20100101 Thunderbird/25.0
MIME-Version: 1.0
To: =?UTF-8?B?RnLDqWTDqXJpYyBCb3Vy?= <defree@gmail.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com> <5277A03F.8020704@lexifi.com>
 <5277A529.9010707@gmail.com>
In-Reply-To: <5277A529.9010707@gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 thomas.refis@gmail.com
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 13:46:41 -0000

On 11/04/2013 02:46 PM, Frdric Bour wrote:
> Merlin is used in an interactive context (were we expect a response in
> less than ~ 60ms, on average).
>
> If we retransform the whole AST during each invocation, we also need to
> retype the whole AST after.

I assume there is already some logic to detect from which point the code 
has changed, and to resume type-checking from the start of the phrase, 
using some kind of snapshot.  Couldn't this logic be applied after the 
preprocessing?

Still, calling the PPX transformers as external processes might already 
be too slow (there is always the option to link them in).

 > Then an "open Core.Std" alone is enough to
> blow up the time budget. (And this existimation is done on a desktop
> computer, some users have EEE).

For this specific example, this patch might help:

http://caml.inria.fr/mantis/view.php?id=5916

(I'm still waiting for a reproducible case before accepting the patch...)

> However, I wonder how this state threading would be handled in the REPL ?

Currently, it's not.  See:

http://caml.inria.fr/mantis/view.php?id=5904#c8797


Even though some rewriters might need to maintain state (or even have 
access to the whole unit), many of them (and in particular those 
corresponding to the extensions currently supported by Merlin) won't 
probably need it.


Alain

From defree@gmail.com  Mon Nov  4 13:53:28 2013
Return-Path: <defree@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 8536F3C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 13:53:28 +0000 (GMT)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1538327 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.179 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (defree[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-we0-f179.google.com ([74.125.82.179]:36753)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VdKtt-0007ei-7q (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <defree@gmail.com>); Mon, 04 Nov 2013 14:13:05 +0000
Received: by mail-we0-f179.google.com with SMTP id w61so2064874wes.24
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Nov 2013 06:13:05 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=message-id:date:from:user-agent:mime-version:to:cc:subject
 :references:in-reply-to:content-type:content-transfer-encoding;
 bh=rT/AWXj4jdRnMxOsZppmmE4bEnAdJt5VUoeND+DxwN8=;
 b=GiiVcyyUbkLngdCtRVn/LbOPDGUHAi/XA1L+OJq6xMUNr6kYhEEUkDsZGJnOu9Oso0
 hzBu2b8QdjycEl9JNsDt1y5qOIPtYFZf3pqpz4z+QcgPNwYLivtf/zV21+/j2/XebqNA
 CAcA7Nm5OD/9xacm+JpAlQwUgiJl8Gl9KmnyGzQSo2WEFrmV0u2/qwVlKGpmKkmXIzdv
 qnvNtfYG2Ar3v5CWm7Tq1sZX/AGt1M71cNaV0CEYL9VXmU7Xxgax3ijEN/JxArWWld4X
 +41o+hqNw9rWF6lz6/Ap/jNLqdelONkYXEYxfP90BDxIVx11ZFlJ7E9SY830Jd0t51EZ
 d63w==
X-Received: by 10.194.77.41 with SMTP id p9mr498527wjw.66.1383574385001;
 Mon, 04 Nov 2013 06:13:05 -0800 (PST)
Received: from ?IPv6:2a01:e34:ecec:5220:222:15ff:feea:66ed?
 ([2a01:e34:ecec:5220:222:15ff:feea:66ed])
 by mx.google.com with ESMTPSA id c10sm4501773wie.11.2013.11.04.06.13.03
 for <multiple recipients>
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Mon, 04 Nov 2013 06:13:04 -0800 (PST)
Message-ID: <5277AB05.8070808@gmail.com>
Date: Mon, 04 Nov 2013 15:11:17 +0100
From: =?windows-1252?Q?Fr=E9d=E9ric_Bour?= <defree@gmail.com>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.1.0
MIME-Version: 1.0
To: Yaron Minsky <yminsky@janestreet.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>	<52779AEB.2050402@gmail.com>
 <CACLX4jT5wVu518G2r9Q4yDFRWZd_nMWvbcogNX4rXS7_F0EPEw@mail.gmail.com>
In-Reply-To: <CACLX4jT5wVu518G2r9Q4yDFRWZd_nMWvbcogNX4rXS7_F0EPEw@mail.gmail.com>
Content-Type: text/plain; charset=windows-1252; format=flowed
Content-Transfer-Encoding: 8bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 thomas.refis@gmail.com
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 13:53:28 -0000


On 04/11/2013 15:01, Yaron Minsky wrote:
> On Mon, Nov 4, 2013 at 8:02 AM, Frdric Bour <defree@gmail.com> wrote:
>> On 02/11/2013 18:21, Yaron Minsky wrote:
>>> I've been playing using Merlin more and more for personal projects,
>>> and have started to wonder about how we're going to make Merlin work
>>> effectively in a ppx world.  In some ways, ppx simplifies Merlin's
>>> job, since there's now just one concrete syntax to parse.
>>>
>>> But there are still problems to solve.  In particular, you will still
>>> need to be able to apply AST-transformers to the partial ASTs that
>>> Merlin generates in order to run it through the type-inference stage,
>>> or to determine the environment.
>> Those partial ASTs are still represented with the same type as OCaml
>> "normal" ASTs.
>> There should be no difference for the transformers at this stage.
>>
>>
>>> Obviously, Merlin could just reimplement a bunch of common AST
>>> transformers, as it does now for some common camlp4 extensions.  But
>>> this seems like a situation that is too painful to maintain in the
>>> long term.
>> Indeed, ppx seems to be the opportunity to stop hardcoding extensions in
>> merlin.
>>
>>
>>> A better idea, perhaps, would be to have some libraries or standards
>>> about how to present an AST transformer so that it's suitable for
>>> running against a partial AST.  I don't really know the details of how
>>> Merlin works, but I understand it does a first pass to parse
>>> expressions into top-level units, the parsing of which is done
>>> independently.  AST transformers that operate on those units would
>>> naturally gain some level of incrementality.  Another, perhaps more
>>> intrustive approach would be to write PPX transformers against
>>> Merlin's version of the AST.
>> The work done by the transformer when invoked by merlin or by the toplevel
>> should be the same: the AST is given chunk-by-chunk, each chunk being passed
>> for transformation.
> Does this work for sub-modules as well?  It's not rare in my
> experience to do quite a bit of programming within a sub-module.  In a
> top-level, you'd have to do that as one top-level chunk, which seems
> like the wrong solution for merlin.

In merlin, yes.
This work for modules of the form "module A (P0 : S0)  (Pn : Sn) : S = 
struct  end".
In this case, merlin adds (P0 : S0),  (Pn : Sn) to the environment, 
then work with definitions inside "struct  end" as it would do in the 
top-level context.

All cases are not handled (like completing inside the argument of a 
functor application, constraining the signature after the structure, not 
during the binding).

>> Under the assumption that, for a given transformer t and without imposing an
>> order of transformation:
>> t (def1;; def2) ~= t(def1) ;; t(def2)
>> using this transformer in merlin should not require specific work.
>>
>> That being said, I don't know much about ppx. Here are the cases I see that
>> could be problematic in general:
>> - the transformer relies on some global state, that has to be threaded
>> across different invocations.
>> - the toplevel works only in a sequential way, and backtrack only if the
>> current definition fails to type. merlin can rollback to arbitrary point in
>> files, which could break assumptions in the transformer if there is a state.
>> - merlin also split definitions inside modules, which means that pieces of
>> ast could be extracted and transformed either separately or not in the
>> expected order (e.g. the signature constraining a structure can be extracted
>> by merlin and transformed as if it was an independent declaration, then
>> reinjected in the AST).
>>
>>
>>> I don't quite know what the right solution is, but when 4.02 comes out
>>> we're all going to be writing a bunch of new AST transformers, and if
>>> we really want Merlin to be a success, we should have a plan for how
>>> those transformers will integrate with it.
>>>
>>> y
>>


From defree@gmail.com  Mon Nov  4 14:38:50 2013
Return-Path: <defree@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 252003C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 14:38:50 +0000 (GMT)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1538327 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [74.125.82.47 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (defree[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wg0-f47.google.com ([74.125.82.47]:42246)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1VdLbm-0000JG-j6 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <defree@gmail.com>); Mon, 04 Nov 2013 14:58:27 +0000
Received: by mail-wg0-f47.google.com with SMTP id c11so2139447wgh.2
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Nov 2013 06:58:26 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=message-id:date:from:user-agent:mime-version:to:cc:subject
 :references:in-reply-to:content-type:content-transfer-encoding;
 bh=NLH8oY22nYvL9+RyqwENCZ4MV5cI4hLhRRa9Jx/z6pI=;
 b=q46MOiqGq4H6fRuuI1hUUH7aS4ZHY1tHQkLuf3LPNdEH10Vf3M5iaC8rnyAGndv80c
 do7XekEr3FVcNzu0+aak3to6YMug2n3UVfx9nymNDrwu4EUDkUpEkOEmGXgr28b3MI6S
 1p+AciGWvWGxBGkGuoF+rLwj4uUlv5zjofO1auR7vKHr2ZMNBs9OtVk4o+Icc9XESetK
 wCWfkzGSTeglXnXbXQWiNBbQtKJMavWEEiRvc5g2rxLzMLDdiWdgTYlN//6ki5fhh0Zh
 +ML/0Aeb6d4NjBeB2bLL5Mi/EMcEDu63clyhcQmODUinlIUujXKuD+flcVQcWGVHy5es
 EHyg==
X-Received: by 10.180.211.71 with SMTP id na7mr12925744wic.5.1383577106663;
 Mon, 04 Nov 2013 06:58:26 -0800 (PST)
Received: from ?IPv6:2a01:e34:ecec:5220:222:15ff:feea:66ed?
 ([2a01:e34:ecec:5220:222:15ff:feea:66ed])
 by mx.google.com with ESMTPSA id q3sm4745890wib.5.2013.11.04.06.58.24
 for <multiple recipients>
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Mon, 04 Nov 2013 06:58:25 -0800 (PST)
Message-ID: <5277B5A6.7080207@gmail.com>
Date: Mon, 04 Nov 2013 15:56:38 +0100
From: =?UTF-8?B?RnLDqWTDqXJpYyBCb3Vy?= <defree@gmail.com>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.1.0
MIME-Version: 1.0
To: Alain Frisch <alain.frisch@lexifi.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com> <5277A03F.8020704@lexifi.com>
 <5277A529.9010707@gmail.com> <5277A9DA.7040206@lexifi.com>
In-Reply-To: <5277A9DA.7040206@lexifi.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 thomas.refis@gmail.com
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 14:38:50 -0000


On 04/11/2013 15:06, Alain Frisch wrote:
> On 11/04/2013 02:46 PM, Frdric Bour wrote:
>> Merlin is used in an interactive context (were we expect a response in
>> less than ~ 60ms, on average).
>>
>> If we retransform the whole AST during each invocation, we also need to
>> retype the whole AST after.
>
> I assume there is already some logic to detect from which point the 
> code has changed, and to resume type-checking from the start of the 
> phrase, using some kind of snapshot.  Couldn't this logic be applied 
> after the preprocessing?

The process is roughly the following:
 Each chunk has an ending position.
 The editor tells the coordinates of the first character that changed.
 Merlin drops everything ending after that position then notify the 
editor of the ending position of the last chunk on merlin side.
 The editor is expected to tell the rest of the buffer (up to the 
cursor) starting from this last chunk.

So the "detection logic" has more to do with the editor than with the AST.
> Still, calling the PPX transformers as external processes might 
> already be too slow (there is always the option to link them in).
Constantly invoking external processes should be fast enough in merlin's 
case, as long as the work to do is not proportional to the size of the file.

>
> > Then an "open Core.Std" alone is enough to
>> blow up the time budget. (And this existimation is done on a desktop
>> computer, some users have EEE).
>
> For this specific example, this patch might help:
> http://caml.inria.fr/mantis/view.php?id=5916
> (I'm still waiting for a reproducible case before accepting the patch...)

Merlin's actually use a patch to make substitution lazy, guaranteeing 
"open" time proportional to the number of identifier introduced, not to 
the number of path substituted.
So "open Core.Std" is instantaneous (except on cold start, where the 
vast majority of the time is spent unmarshalling data on C-side).

I can't tell if this is the same approach as in the patch you linked, 
but it works well for Merlin.

>
>> However, I wonder how this state threading would be handled in the 
>> REPL ?
>
> Currently, it's not.  See:
>
> http://caml.inria.fr/mantis/view.php?id=5904#c8797
>
>
> Even though some rewriters might need to maintain state (or even have 
> access to the whole unit), many of them (and in particular those 
> corresponding to the extensions currently supported by Merlin) won't 
> probably need it.

Ok. So if some work had to be done to ensure proper compatibility 
between merlin and ppx, it would be for supporting stateful rewriters.

>
>
> Alain


From gabriel.scherer@gmail.com  Mon Nov  4 14:57:01 2013
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id A92B83C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 14:57:01 +0000 (GMT)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1538327 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.214.53 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-bk0-f53.google.com ([209.85.214.53]:64019)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1VdLtO-0001CQ-1Q (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Mon, 04 Nov 2013 15:16:39 +0000
Received: by mail-bk0-f53.google.com with SMTP id w11so2441328bkz.12
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Nov 2013 07:16:38 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:from:date:message-id:subject:to
 :cc:content-type:content-transfer-encoding;
 bh=7ttaIdHm7J/E5BBIRUlKQk23XwwylF6Wa+Lrb5mKntE=;
 b=opufPChqPBJvPLin7jB8tsnPTYHEvsYogB1C1Gpya/i+0amH8l/oQTSru62ZZetdUm
 L6yfnooTJUXPAiBH3FSXDAYt8ldPxy1ahCDm/eLhEFtNQ45Z0D0ca1jLsZOGBpzWP+ET
 CKeuohfG8XVgnoRN/gGTFbDM69z15yCUnfcygcSqzkI/1WVqYSF+Ah8VEei0aj7HX797
 B876yLESmK/YeG2MDpSgt16lHd9K25gF2l1hQx1fzNSBoSDgu8dro7eR9fjbcijBfRQ/
 3OWlTSpu6d8OWp8rwNlYRGXe1EPxnsiZixufMSKkss5f9kKaNBiAPOpQLVV03pkTJjf5
 rxWw==
X-Received: by 10.204.69.202 with SMTP id a10mr2123951bkj.36.1383578198004;
 Mon, 04 Nov 2013 07:16:38 -0800 (PST)
MIME-Version: 1.0
Received: by 10.204.122.72 with HTTP; Mon, 4 Nov 2013 07:15:57 -0800 (PST)
In-Reply-To: <5277B5A6.7080207@gmail.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com> <5277A03F.8020704@lexifi.com>
 <5277A529.9010707@gmail.com> <5277A9DA.7040206@lexifi.com>
 <5277B5A6.7080207@gmail.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Mon, 4 Nov 2013 16:15:57 +0100
Message-ID: <CAPFanBHjDBdWZ8fJuxrGvQE-J=mq7dn-rjHeKm9O3eZcGA4cXQ@mail.gmail.com>
To: =?ISO-8859-1?Q?Fr=E9d=E9ric_Bour?= <defree@gmail.com>
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Thomas Refis <thomas.refis@gmail.com>
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 14:57:01 -0000

> If we retransform the whole AST during each invocation, we also need to r=
etype the whole AST after.

You could probably write a function that takes two AST, and compare
them left-to-right, to cut them into a common prefix and a new chunk.
You would lose incremental syntax-extension processing but still
regain incremental type-checking afterwards (assuming the rewriter
modifications are local enough: adding stuff at the toplevel would
break that property). This would also help a lot to implement merlin
frontend for editors with broken buffer-change support (you can send
the whole buffer to the parser and still save on the type-checking
time).

> Ok. So if some work had to be done to ensure proper compatibility between
> merlin and ppx, it would be for supporting stateful rewriters.

I think we should consider making statefulness explicit in the
rewriters API, that is asking stateful rewriter to use a marshallable
state type and express their transform in the state monad (state * AST
-> state * result), instead of silently initializing internal state.
This would be compatible with an imperative style in the code of the
rewriter themselves (you just need to reify the state at the end of
the transformation).

On Mon, Nov 4, 2013 at 3:56 PM, Fr=E9d=E9ric Bour <defree@gmail.com> wrote:
>
> On 04/11/2013 15:06, Alain Frisch wrote:
>>
>> On 11/04/2013 02:46 PM, Fr=E9d=E9ric Bour wrote:
>>>
>>> Merlin is used in an interactive context (were we expect a response in
>>> less than ~ 60ms, on average).
>>>
>>> If we retransform the whole AST during each invocation, we also need to
>>> retype the whole AST after.
>>
>>
>> I assume there is already some logic to detect from which point the code
>> has changed, and to resume type-checking from the start of the phrase, u=
sing
>> some kind of snapshot.  Couldn't this logic be applied after the
>> preprocessing?
>
>
> The process is roughly the following:
> - Each chunk has an ending position.
> - The editor tells the coordinates of the first character that changed.
> - Merlin drops everything ending after that position then notify the edit=
or
> of the ending position of the last chunk on merlin side.
> - The editor is expected to tell the rest of the buffer (up to the cursor=
)
> starting from this last chunk.
>
> So the "detection logic" has more to do with the editor than with the AST=
.
>
>> Still, calling the PPX transformers as external processes might already =
be
>> too slow (there is always the option to link them in).
>
> Constantly invoking external processes should be fast enough in merlin's
> case, as long as the work to do is not proportional to the size of the fi=
le.
>
>
>>
>> > Then an "open Core.Std" alone is enough to
>>>
>>> blow up the time budget. (And this existimation is done on a desktop
>>> computer, some users have EEE).
>>
>>
>> For this specific example, this patch might help:
>> http://caml.inria.fr/mantis/view.php?id=3D5916
>> (I'm still waiting for a reproducible case before accepting the patch...=
)
>
>
> Merlin's actually use a patch to make substitution lazy, guaranteeing "op=
en"
> time proportional to the number of identifier introduced, not to the numb=
er
> of path substituted.
> So "open Core.Std" is instantaneous (except on cold start, where the vast
> majority of the time is spent unmarshalling data on C-side).
>
> I can't tell if this is the same approach as in the patch you linked, but=
 it
> works well for Merlin.
>
>
>>
>>> However, I wonder how this state threading would be handled in the REPL=
 ?
>>
>>
>> Currently, it's not.  See:
>>
>> http://caml.inria.fr/mantis/view.php?id=3D5904#c8797
>>
>>
>> Even though some rewriters might need to maintain state (or even have
>> access to the whole unit), many of them (and in particular those
>> corresponding to the extensions currently supported by Merlin) won't
>> probably need it.
>
>
> Ok. So if some work had to be done to ensure proper compatibility between
> merlin and ppx, it would be for supporting stateful rewriters.
>
>
>>
>>
>> Alain
>
>
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4

From francois.bobot@cea.fr  Mon Nov  4 15:21:09 2013
Return-Path: <francois.bobot@cea.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-52.csi.cam.ac.uk (ppsw-52.csi.cam.ac.uk [131.111.8.152])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id CCE553C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 15:21:09 +0000 (GMT)
X-Cam-SpamDetails: score -5.0 from SpamAssassin-3.3.2-1538327 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [132.167.192.142 listed in list.dnswl.dnsbl.ja.net]
 * -0.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from cirse-out.extra.cea.fr ([132.167.192.142]:35722)
 by ppsw-52.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1VdMGl-0006RA-Cv (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <francois.bobot@cea.fr>); Mon, 04 Nov 2013 15:40:47 +0000
Received: from pisaure.intra.cea.fr (pisaure.intra.cea.fr [132.166.88.21])
 by cirse.extra.cea.fr (8.14.2/8.14.2/CEAnet-Internet-out-2.3) with ESMTP id
 rA4FekDP001778
 for <wg-camlp4@lists.ocaml.org>; Mon, 4 Nov 2013 16:40:46 +0100
Received: from pisaure.intra.cea.fr (localhost [127.0.0.1])
 by localhost (Postfix) with SMTP id E61E4203465
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 16:40:46 +0100 (CET)
Received: from muguet1.intra.cea.fr (muguet1.intra.cea.fr [132.166.192.6])
 by pisaure.intra.cea.fr (Postfix) with ESMTP id D35C7203456
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 16:40:46 +0100 (CET)
Received: from [10.8.32.80] (is222783.intra.cea.fr [10.8.32.80])
 by muguet1.intra.cea.fr (8.13.8/8.13.8/CEAnet-Intranet-out-1.2) with ESMTP id
 rA4FekPb018535
 for <wg-camlp4@lists.ocaml.org>; Mon, 4 Nov 2013 16:40:46 +0100
Message-ID: <5277C614.8010704@cea.fr>
Date: Mon, 04 Nov 2013 17:06:44 +0100
From: =?ISO-8859-1?Q?Fran=E7ois_Bobot?= <francois.bobot@cea.fr>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:17.0) Gecko/20131005 Icedove/17.0.9
MIME-Version: 1.0
To: wg-camlp4@lists.ocaml.org
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com> <5277A03F.8020704@lexifi.com>
 <5277A529.9010707@gmail.com> <5277A9DA.7040206@lexifi.com>
 <5277B5A6.7080207@gmail.com>
 <CAPFanBHjDBdWZ8fJuxrGvQE-J=mq7dn-rjHeKm9O3eZcGA4cXQ@mail.gmail.com>
In-Reply-To: <CAPFanBHjDBdWZ8fJuxrGvQE-J=mq7dn-rjHeKm9O3eZcGA4cXQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 15:21:10 -0000

On 04/11/2013 16:15, Gabriel Scherer wrote:
>> Ok. So if some work had to be done to ensure proper compatibility between
>> merlin and ppx, it would be for supporting stateful rewriters.
>
> I think we should consider making statefulness explicit in the
> rewriters API, that is asking stateful rewriter to use a marshallable
> state type and express their transform in the state monad (state * AST
> -> state * result), instead of silently initializing internal state.
> This would be compatible with an imperative style in the code of the
> rewriter themselves (you just need to reify the state at the end of
> the transformation).
>

It is a nice idea to explicit the state but I'm not sure it is 
compatible with an imperative style since merlin needs a persistent 
state between every declaration. Since merlin needs only to backtrack, 
it is sufficient for the rewriters to give a push/pop interface.

-- 
Franois


From alain.frisch@lexifi.com  Mon Nov  4 15:58:07 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id B51813C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 15:58:07 +0000 (GMT)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1538327 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:54259
 helo=msa.smtpout.orange.fr)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VdMqW-0003Uq-7z (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Nov 2013 16:17:45 +0000
Received: from [192.168.1.112] ([92.151.8.164]) by mwinf5d56 with ME
 id lUHj1m00L3YLrng03UHjzw; Mon, 04 Nov 2013 17:17:44 +0100
Message-ID: <5277C8A9.3080006@lexifi.com>
Date: Mon, 04 Nov 2013 17:17:45 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:25.0) Gecko/20100101 Thunderbird/25.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>, =?ISO-8859-1?Q?Fr=E9d=E9?=
 =?ISO-8859-1?Q?ric_Bour?= <defree@gmail.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com> <5277A03F.8020704@lexifi.com>
 <5277A529.9010707@gmail.com> <5277A9DA.7040206@lexifi.com>
 <5277B5A6.7080207@gmail.com>
 <CAPFanBHjDBdWZ8fJuxrGvQE-J=mq7dn-rjHeKm9O3eZcGA4cXQ@mail.gmail.com>
In-Reply-To: <CAPFanBHjDBdWZ8fJuxrGvQE-J=mq7dn-rjHeKm9O3eZcGA4cXQ@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Thomas Refis <thomas.refis@gmail.com>
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 15:58:07 -0000

On 11/04/2013 04:15 PM, Gabriel Scherer wrote:
> I think we should consider making statefulness explicit in the
> rewriters API, that is asking stateful rewriter to use a marshallable
> state type and express their transform in the state monad (state * AST
> -> state * result), instead of silently initializing internal state.

We probably need to turn "state" into "state option" for the first 
invocation of the rewriter.  This is a nice idea, but it would require 
to change the current format of AST files (shared with Camlp4), and 
introduce some unsafe behavior (the state will be untyped in the 
external representation).

Moreover, it would not cover all possible cases.  The problem is so much 
that a rewriter can have an internal state, but rather than it can be 
completely non compositional.  For instance, sedlex collects all lexer 
specifications and generate shared transition tables/functions at the 
beginning of the unit.  Admittedly, this is just an optimization (and it 
works fine to process phrase by phrase), but other examples of ppx 
rewriters could really do non-local processing which cannot be simply 
captured by a state threaded sequentially.


Alain

From defree@gmail.com  Mon Nov  4 16:40:41 2013
Return-Path: <defree@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-42.csi.cam.ac.uk (ppsw-42.csi.cam.ac.uk [131.111.8.142])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id EF8A63C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 16:40:40 +0000 (GMT)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1538327 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.170 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (defree[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f170.google.com ([209.85.212.170]:56699)
 by ppsw-42.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1VdNVi-0007Xr-7W (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <defree@gmail.com>); Mon, 04 Nov 2013 17:00:18 +0000
Received: by mail-wi0-f170.google.com with SMTP id ex4so2183570wid.3
 for <wg-camlp4@lists.ocaml.org>; Mon, 04 Nov 2013 09:00:18 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=message-id:date:from:user-agent:mime-version:to:cc:subject
 :references:in-reply-to:content-type:content-transfer-encoding;
 bh=bPEX7+PdIIld7qJP5IYt7KHikLFX5MCOQE0NR3euDIU=;
 b=sGUYlLSXc2KtbHrZUwf8DQEw40zqrGa+PYuuE/atDWhffoiaw3dF7ICRJLqsZO+pfG
 EW2+TDSS8sErxpeDkSB1K/CdASOgSiDT1JLz9ThNlwau5j4cGejLJa55QUVOmJqgucSz
 I9HWI1Ezgoo1EzoBJaQCpACJtvLvILPL+WHDIK/St7TUcvY6yu5Nyia8VldogHFaLeM2
 +90fO3Th+I+whwjgIGtTSq3RJG+JNWUeZloTfttSO76QPTsSFMWvphOqHF9+P7Rd1GZ3
 ZC+uFuTVKqHrRg8FSJF630yDIvAKGih5ZULDam3mTZ084ymD2EEkzpxa40bVAK2xXvXu
 HOXA==
X-Received: by 10.194.237.226 with SMTP id vf2mr2328314wjc.58.1383584418049;
 Mon, 04 Nov 2013 09:00:18 -0800 (PST)
Received: from ?IPv6:2a01:e34:ecec:5220:222:15ff:feea:66ed?
 ([2a01:e34:ecec:5220:222:15ff:feea:66ed])
 by mx.google.com with ESMTPSA id e1sm5757806wij.6.2013.11.04.09.00.16
 for <multiple recipients>
 (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
 Mon, 04 Nov 2013 09:00:17 -0800 (PST)
Message-ID: <5277D236.8030806@gmail.com>
Date: Mon, 04 Nov 2013 17:58:30 +0100
From: =?UTF-8?B?RnLDqWTDqXJpYyBCb3Vy?= <defree@gmail.com>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.1.0
MIME-Version: 1.0
To: Alain Frisch <alain.frisch@lexifi.com>, 
 Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com> <5277A03F.8020704@lexifi.com>
 <5277A529.9010707@gmail.com> <5277A9DA.7040206@lexifi.com>
 <5277B5A6.7080207@gmail.com>
 <CAPFanBHjDBdWZ8fJuxrGvQE-J=mq7dn-rjHeKm9O3eZcGA4cXQ@mail.gmail.com>
 <5277C8A9.3080006@lexifi.com>
In-Reply-To: <5277C8A9.3080006@lexifi.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Thomas Refis <thomas.refis@gmail.com>
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 16:40:41 -0000


On 04/11/2013 17:17, Alain Frisch wrote:
> On 11/04/2013 04:15 PM, Gabriel Scherer wrote:
>> I think we should consider making statefulness explicit in the
>> rewriters API, that is asking stateful rewriter to use a marshallable
>> state type and express their transform in the state monad (state * AST
>> -> state * result), instead of silently initializing internal state.
>
> We probably need to turn "state" into "state option" for the first 
> invocation of the rewriter. This is a nice idea, but it would require 
> to change the current format of AST files (shared with Camlp4), and 
> introduce some unsafe behavior (the state will be untyped in the 
> external representation).

Correct me if I am wrong, but the current code already relies on 
marshalling and this is where the unsafety lies  the external state can 
just be seen as an abstract type ?

> Moreover, it would not cover all possible cases. The problem is so 
> much that a rewriter can have an internal state, but rather than it 
> can be completely non compositional. For instance, sedlex collects all 
> lexer specifications and generate shared transition tables/functions 
> at the beginning of the unit. Admittedly, this is just an optimization 
> (and it works fine to process phrase by phrase), but other examples of 
> ppx rewriters could really do non-local processing which cannot be 
> simply captured by a state threaded sequentially.

Right. The point is that some extensions (like eliom) don't fit in the 
framework that merlin or the toplevel could expect for working 
incrementally.

I think that we should focus on providing a simple API for the most 
common cases (stateless transformers, then state monad, then 
backtracking stack, etc.). As long as the plugin informs its host of the 
way it is intended to be used, it is possible to provide graceful 
degradation.

Non compositional transformers are likely to be the exception rather 
than the rule (optimizations aside).
Also, I may stress that in the specific case of merlin, we are not 
interested by the implementation produced by a transformer, only by the 
interface, and this is how extensions are reimplemented right now. So as 
a last resort, plugins could be provide specific support for use inside 
an editor.

From alain.frisch@lexifi.com  Mon Nov  4 17:20:55 2013
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTP id 946BB3C4E2
 for <wg-camlp4@lists.ocaml.org>; Mon,  4 Nov 2013 17:20:55 +0000 (GMT)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1538327 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.210 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa01.smtpout.orange.fr ([193.252.23.210]:42999
 helo=msa.smtpout.orange.fr)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1VdO8f-0006H7-g6 (Exim 4.80_167-5a66dd3) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 04 Nov 2013 17:40:33 +0000
Received: from [192.168.1.112] ([92.151.8.164]) by mwinf5d56 with ME
 id lVgX1m00b3YLrng03VgXt4; Mon, 04 Nov 2013 18:40:32 +0100
Message-ID: <5277DC12.7060203@lexifi.com>
Date: Mon, 04 Nov 2013 18:40:34 +0100
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:25.0) Gecko/20100101 Thunderbird/25.0
MIME-Version: 1.0
To: =?UTF-8?B?RnLDqWTDqXJpYyBCb3Vy?= <defree@gmail.com>, 
 Gabriel Scherer <gabriel.scherer@gmail.com>
References: <CACLX4jTxtLHN+4iU=hxwh-6QUfKxWEY9Ni=WTVXXQ2P-b_3+Eg@mail.gmail.com>
 <52779AEB.2050402@gmail.com> <5277A03F.8020704@lexifi.com>
 <5277A529.9010707@gmail.com> <5277A9DA.7040206@lexifi.com>
 <5277B5A6.7080207@gmail.com>
 <CAPFanBHjDBdWZ8fJuxrGvQE-J=mq7dn-rjHeKm9O3eZcGA4cXQ@mail.gmail.com>
 <5277C8A9.3080006@lexifi.com> <5277D236.8030806@gmail.com>
In-Reply-To: <5277D236.8030806@gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Thomas Refis <thomas.refis@gmail.com>
Subject: Re: [wg-camlp4] Reconciling Merlin and ppx
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 04 Nov 2013 17:20:55 -0000

On 11/04/2013 05:58 PM, Frdric Bour wrote:
> Correct me if I am wrong, but the current code already relies on
> marshalling and this is where the unsafety lies  the external state can
> just be seen as an abstract type ?

Currently, the marshaled data has always the same type (and we are 
supposed to change its magic number if the format changes), so all the 
I/O logic for PPX transformers is wrapped in a type-safe API.

Here, we are talking about allowing a specific PPX transformer to return 
an extra piece of arbitrary data (unless we want to specify the type of 
the state).  The data only makes sense for a specific (version of a) PPX 
transformer, and it cannot be protected by a magic number.

> Right. The point is that some extensions (like eliom) don't fit in the
> framework that merlin or the toplevel could expect for working
> incrementally.

Did you do some benchmarks?  I really don't know, but it could be the 
case that parsing + preprocessing the whole unit is fast enough.  For 
type-checking, I'm less sure, but a mechanism to reuse the result from 
the previous run on the common prefix should not be too difficult to 
support.  With such an approach, you could deal with a wider range of 
PPX rewriters without any custom support.


> I think that we should focus on providing a simple API for the most
> common cases (stateless transformers, then state monad, then
> backtracking stack, etc.). As long as the plugin informs its host of the
> way it is intended to be used, it is possible to provide graceful
> degradation.

The "state monad" API would work in the toplevel, but I believe you 
would need something more fine-grained for Merlin, in order to inform 
the rewriter about entering/leaving structures decomposed by Merlin 
itself.  Consider a rewriter which maintains a current "path" 
(collecting the M in "module M = struct ... end" for the current scope).


-- Alain

From bobzhang1988@gmail.com  Sun Dec  1 03:38:28 2013
Return-Path: <bobzhang1988@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id DB8623CC75
 for <wg-camlp4@lists.ocaml.org>; Sun,  1 Dec 2013 03:38:28 +0000 (GMT)
X-Cam-SpamDetails: score 0.9 from SpamAssassin-3.3.2-1546520 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.170 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (bobzhang1988[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (bobzhang1988[at]gmail.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f170.google.com ([209.85.128.170]:54042)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtps (TLSv1:RC4-SHA:128)
 id 1VmyBy-0002Av-2U (Exim 4.82_3-c0e5623) for wg-camlp4@lists.ocaml.org
 (return-path <bobzhang1988@gmail.com>); Sun, 01 Dec 2013 03:59:35 +0000
Received: by mail-ve0-f170.google.com with SMTP id oy12so8139448veb.1
 for <wg-camlp4@lists.ocaml.org>; Sat, 30 Nov 2013 19:59:33 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:date:message-id:subject:from:to:content-type;
 bh=XHCsP76JcaMGScYzGVVs0pCl518fBOPNUaTuVrd4uCo=;
 b=BJTcBPN9oagxCEKVfwRjiuaOVabGZklrXNSK9jdvfRS7nMwuaju9aVi6saUafL9bsQ
 NQq4Br78M2pv+QOO67t54gBpgicwgeEg+bYR/fFaBj0PXM9MAU3cirjyvIdpOemFHorv
 nhZXwAV0xR4AnKIl9OkYNRYzx8FPbJCYowZD/CiAXCNIOjeD3nViuXjdq6Z6oFEPYIas
 aXuvgvhIxK3WTIYD7vlrh8gxj3XbCQJkBknapVYddb01Lqn5UAXL97zBD5K+B1h1GWIq
 2Lj6lvhh8msq75EsfmO/duyxgwdxgkP/8IFwAm13B27lQ15r+Ttc/EK8H00krIli9nhh
 fUtA==
MIME-Version: 1.0
X-Received: by 10.221.40.10 with SMTP id to10mr3746156vcb.22.1385870373544;
 Sat, 30 Nov 2013 19:59:33 -0800 (PST)
Received: by 10.220.169.143 with HTTP; Sat, 30 Nov 2013 19:59:33 -0800 (PST)
Date: Sat, 30 Nov 2013 22:59:33 -0500
Message-ID: <CANcqPu4UsfisaYvpBiiWeNhUhO4YaWAtre5kq3wURVppXGoTPw@mail.gmail.com>
From: Bob Zhang <bobzhang1988@gmail.com>
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Content-Type: text/plain; charset=ISO-8859-1
Subject: [wg-camlp4] Monadic computation in Fan
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sun, 01 Dec 2013 03:38:29 -0000

Dear List

     I am very glad to let you know that I have incorporated a very
cool feature in Fan. a new DDSL l 'local_extend', which mutate the
parser inside the quotation, but restored all the parser it mutated
outside the quotation.
    The use case is when you really need to mutate a tiny part of the
grammar -- copy alone can not work, since parsers are mutually
recursive -- now we can limit  the mutation scope, however.

The ten lines below show how we introduce computation expression (F#
style) in Fan by *local_extend* DDSL, the introduced DDSL is called
"cexp"

```
  let f (loc:Locf.t) meta content =
    let module_name =
    match meta with
    | None -> Locf.failf loc "cexp module name must be specified via @"
    | Some x -> String.capitalize x in
  %local_extend{
    exp: 10 RA
    ["let"; "!" ; bind as bi ; "in"; exp as x %{
     let pat_exps  =  Ast_basic.list_of_and bi [] in
     List.fold_right
       (fun pat_exp acc ->
         match pat_exp with
         | %bind{ $p = $e} ->
             %exp{$uid:module_name.bind $e (fun $p -> $acc)}
         | _ -> assert false
                     ) pat_exps x }
   ]
    ${Gramlib.parse_string_eoi exp ~loc content}}

 let d = Ns.lang in
  begin
    Ast_quotation.add {domain = d; name="cexp";} Dyn_tag.exp f;
  end
```

Test case
```
let v = %cexp@option{
 let! a = Some 3  in
 let! b = Some 4 in
 Some (a + b)
 }
```
--
Regards
-- Bob


-- 
Regards
-- Bob

From alain.frisch@lexifi.com  Mon Apr 14 15:29:17 2014
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-40.csi.cam.ac.uk (ppsw-40.csi.cam.ac.uk [131.111.8.140])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id C5E823C0D8
 for <wg-camlp4@lists.ocaml.org>; Mon, 14 Apr 2014 15:29:17 +0100 (BST)
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.0 from SpamAssassin-3.3.2-1586838 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [80.12.242.128 listed in rbl-plus.mail-abuse.ja.net]
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [80.12.242.128 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp06.smtpout.orange.fr ([80.12.242.128]:30764
 helo=msa.smtpout.orange.fr)
 by ppsw-40.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1WZiKR-00087U-kW (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 14 Apr 2014 15:57:52 +0100
Received: from [192.168.1.133] ([92.151.96.149]) by mwinf5d41 with ME
 id pqxS1n00D3DNUj803qxSjc; Mon, 14 Apr 2014 16:57:26 +0200
X-ME-Helo: [192.168.1.133]
X-ME-Auth: bGV4aWZpQHdhbmFkb28uZnI=
X-ME-Date: Mon, 14 Apr 2014 16:57:26 +0200
X-ME-IP: 92.151.96.149
Message-ID: <534BF75B.4030006@lexifi.com>
Date: Mon, 14 Apr 2014 16:57:31 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.4.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
 <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
 <52614209.2000006@lexifi.com>
In-Reply-To: <52614209.2000006@lexifi.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] Structure/signature attributes suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 14 Apr 2014 14:29:17 -0000

On 10/18/2013 04:13 PM, Alain Frisch wrote:
> I think it makes sense to keep floating attributes in general.  They are
> useful also to turn warnings on/off, for instance.

Leo sent me a gentle reminder about this discussion on "floating 
attributes", i.e. attributes in position of a structure or signature 
item (not attached *to* such an item).  Previously the syntax was the 
same as for item attributes [@@id arg], and floating attributes were 
recognized at the beginning of signatures and structures, and after ";;".

I've introduced a new dedicated syntax:

   [@@@id arg]

for such attributes.  This is much more robust: it was just too easy to 
forget ";;" and have such an attribute attached by mistake to the 
previous item.  And it was quite ugly having to systematically prefix 
such an attribute with ";;".


If anyone strongly objects with this change, speak now!


Damien: if you synchronize your branch with the trunk, you'll have to 
use [@@@warning ....] instead of [@@warning ...].

-- Alain

From alain.frisch@lexifi.com  Mon Apr 14 15:50:41 2014
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-40.csi.cam.ac.uk (ppsw-40.csi.cam.ac.uk [131.111.8.140])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 30D783C0D8
 for <wg-camlp4@lists.ocaml.org>; Mon, 14 Apr 2014 15:50:41 +0100 (BST)
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.0 from SpamAssassin-3.3.2-1586838 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [80.12.242.128 listed in rbl-plus.mail-abuse.ja.net]
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [80.12.242.128 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp06.smtpout.orange.fr ([80.12.242.128]:25464
 helo=msa.smtpout.orange.fr)
 by ppsw-40.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1WZif8-0003Ry-kD (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 14 Apr 2014 16:19:16 +0100
Received: from [192.168.1.133] ([92.151.96.149]) by mwinf5d41 with ME
 id prJp1n00Z3DNUj803rJpld; Mon, 14 Apr 2014 17:18:49 +0200
X-ME-Helo: [192.168.1.133]
X-ME-Auth: bGV4aWZpQHdhbmFkb28uZnI=
X-ME-Date: Mon, 14 Apr 2014 17:18:49 +0200
X-ME-IP: 92.151.96.149
Message-ID: <534BFC5F.9030509@lexifi.com>
Date: Mon, 14 Apr 2014 17:18:55 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.4.0
MIME-Version: 1.0
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>, 
 Caml-Devel <caml-devel@yquem.inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: [wg-camlp4] Built-in attributes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 14 Apr 2014 14:50:41 -0000

Dear all,

In order to mark cleanly which warnings are understood in a special way 
by the compiler, I've added an ocaml.* prefix to them.   Currently, the 
only such attributes are ocaml.deprecated and ocaml.warning.

I'm planning to add (with a low priority) a new warning to report uses 
of unknown ocaml.* warnings (or known warnings applied to a wrong 
object).  This will allow to catch typos such as writing ocaml.warnings 
instead of ocaml.warning.


Alain

From damien.doligez@inria.fr  Mon Apr 14 16:12:14 2014
Return-Path: <damien.doligez@inria.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 4D8313C0D8
 for <wg-camlp4@lists.ocaml.org>; Mon, 14 Apr 2014 16:12:14 +0100 (BST)
X-Cam-SpamDetails: score -6.0 from SpamAssassin-3.3.2-1586838 
 * -5.0 RCVD_IN_DNSWL_HI RBL: Sender listed at http://www.dnswl.org/, high
 *      trust
 *      [192.134.164.83 listed in list.dnswl.dnsbl.ja.net]
 * -1.0 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail2-relais-roc.national.inria.fr ([192.134.164.83]:11173)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtps (TLSv1:RC4-SHA:128)
 id 1WZj01-0006zd-sJ (Exim 4.82_3-c0e5623) for wg-camlp4@lists.ocaml.org
 (return-path <damien.doligez@inria.fr>); Mon, 14 Apr 2014 16:40:49 +0100
X-IronPort-AV: E=Sophos;i="4.97,857,1389740400"; d="scan'208";a="68184936"
Received: from wifi-eduroam-161136.inria.fr ([128.93.161.136])
 by mail2-relais-roc.national.inria.fr with ESMTP/TLS/AES128-SHA;
 14 Apr 2014 17:40:45 +0200
Mime-Version: 1.0 (Apple Message framework v1283)
Content-Type: text/plain; charset=us-ascii
From: Damien Doligez <damien.doligez@inria.fr>
In-Reply-To: <534BF75B.4030006@lexifi.com>
Date: Mon, 14 Apr 2014 17:40:44 +0200
Content-Transfer-Encoding: quoted-printable
Message-Id: <06269D19-0BB2-406F-94BB-4DB58F59B9F4@inria.fr>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
 <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
 <52614209.2000006@lexifi.com> <534BF75B.4030006@lexifi.com>
To: Alain Frisch <alain.frisch@lexifi.com>
X-Mailer: Apple Mail (2.1283)
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Structure/signature attributes
	suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 14 Apr 2014 15:12:14 -0000

IIUC, we now have three kinds of attributes:

[@foo]   attached to an expression
[@@foo]  attached to a structure item
[@@@foo] attached to the whole module (with location being significant?)

I like this change.

BTW I won't have to use [@@@warning] because I don't use [@@warning] =
yet...

-- Damien



On 2014-04-14, at 16:57, Alain Frisch wrote:

> On 10/18/2013 04:13 PM, Alain Frisch wrote:
>> I think it makes sense to keep floating attributes in general.  They =
are
>> useful also to turn warnings on/off, for instance.
>=20
> Leo sent me a gentle reminder about this discussion on "floating =
attributes", i.e. attributes in position of a structure or signature =
item (not attached *to* such an item).  Previously the syntax was the =
same as for item attributes [@@id arg], and floating attributes were =
recognized at the beginning of signatures and structures, and after =
";;".
>=20
> I've introduced a new dedicated syntax:
>=20
>  [@@@id arg]
>=20
> for such attributes.  This is much more robust: it was just too easy =
to forget ";;" and have such an attribute attached by mistake to the =
previous item.  And it was quite ugly having to systematically prefix =
such an attribute with ";;".
>=20
>=20
> If anyone strongly objects with this change, speak now!
>=20
>=20
> Damien: if you synchronize your branch with the trunk, you'll have to =
use [@@@warning ....] instead of [@@warning ...].
>=20
> -- Alain
>=20
> _______________________________________________
> Caml-devel mailing list
> Caml-devel@yquem.inria.fr
> http://yquem.inria.fr/cgi-bin/mailman/listinfo/caml-devel


From alain.frisch@lexifi.com  Mon Apr 14 16:19:29 2014
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 178753C0D8
 for <wg-camlp4@lists.ocaml.org>; Mon, 14 Apr 2014 16:19:29 +0100 (BST)
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.0 from SpamAssassin-3.3.2-1586838 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [80.12.242.128 listed in list.dnswl.dnsbl.ja.net]
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [80.12.242.128 listed in rbl-plus.mail-abuse.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp06.smtpout.orange.fr ([80.12.242.128]:53956
 helo=msa.smtpout.orange.fr)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1WZj70-0002RZ-sb (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Mon, 14 Apr 2014 16:48:04 +0100
Received: from [192.168.1.133] ([92.151.96.149]) by mwinf5d41 with ME
 id prne1n0033DNUj803rnemF; Mon, 14 Apr 2014 17:47:38 +0200
X-ME-Helo: [192.168.1.133]
X-ME-Auth: bGV4aWZpQHdhbmFkb28uZnI=
X-ME-Date: Mon, 14 Apr 2014 17:47:38 +0200
X-ME-IP: 92.151.96.149
Message-ID: <534C031F.4010508@lexifi.com>
Date: Mon, 14 Apr 2014 17:47:43 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.4.0
MIME-Version: 1.0
To: Damien Doligez <damien.doligez@inria.fr>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
 <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
 <52614209.2000006@lexifi.com> <534BF75B.4030006@lexifi.com>
 <06269D19-0BB2-406F-94BB-4DB58F59B9F4@inria.fr>
In-Reply-To: <06269D19-0BB2-406F-94BB-4DB58F59B9F4@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Structure/signature attributes
	suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 14 Apr 2014 15:19:29 -0000

On 04/14/2014 05:40 PM, Damien Doligez wrote:
> IIUC, we now have three kinds of attributes:
>
> [@foo]   attached to an expression
> [@@foo]  attached to a structure item
> [@@@foo] attached to the whole module (with location being significant?)

[@@@foo] is part of the flow of structure items.  An application can 
certainly interpret it as attached to the whole unit (or just the 
current structure), but in general the location is significant.  This is 
the case in particular for [@@warning] which you can use several times 
in the same unit; and it applies only from the point it appears.


Alain

From gabriel.scherer@gmail.com  Mon Apr 14 22:30:12 2014
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 61C703C0D8
 for <wg-camlp4@lists.ocaml.org>; Mon, 14 Apr 2014 22:30:12 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1586838 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.128.173 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ve0-f173.google.com ([209.85.128.173]:60747)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtps (TLSv1:RC4-SHA:128)
 id 1WZotr-0003fm-rm (Exim 4.82_3-c0e5623) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Mon, 14 Apr 2014 22:58:48 +0100
Received: by mail-ve0-f173.google.com with SMTP id oy12so8114112veb.18
 for <wg-camlp4@lists.ocaml.org>; Mon, 14 Apr 2014 14:58:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:from:date:message-id:subject:to
 :cc:content-type;
 bh=czzuNyR7s6X/F1euS9aKUt6e/86sA49wLMyvRwh7EbQ=;
 b=mEJIE7wq5XLJk/TmqOoV2SmVv17HQqmnTLf53yXZSozp15pw6kWAxircXW+8VkjODV
 zcXAUQI6jty4SHSvCdi4HNLUm4lq2aXFyZshYVWkiUrmR3F56YAhrqLwokITPCYHlCgg
 2zg4k6xd0HvZr8Pu/raF73wMvKTJgsNmMLqZF8uM1OqQxmJzO76zUQFaSleg6DC+QKYU
 Tc0Lw1536rpBowS3CbjR/MQzUd1Yv5C7guN5REJijXxSiOvXKNebUpn0LtOH4Z+dT3IR
 E9y+ls+3104cARVvle1IOpKIW1KefQMSco3NB6dY94Qozc9ytOLsThHcasmbSYSiSWL9
 Zaag==
X-Received: by 10.52.78.231 with SMTP id e7mr3602042vdx.28.1397512726397; Mon,
 14 Apr 2014 14:58:46 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.58.96.5 with HTTP; Mon, 14 Apr 2014 14:58:06 -0700 (PDT)
In-Reply-To: <534BFC5F.9030509@lexifi.com>
References: <534BFC5F.9030509@lexifi.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Mon, 14 Apr 2014 23:58:06 +0200
Message-ID: <CAPFanBG0nQMU+aFusmUPnvxiiLonOrn2f0aqy0LiTQk=-QzhZg@mail.gmail.com>
To: Alain Frisch <alain.frisch@lexifi.com>
Content-Type: multipart/alternative; boundary=001a1134044ea05b2104f707c981
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Built-in attributes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 14 Apr 2014 21:30:12 -0000

--001a1134044ea05b2104f707c981
Content-Type: text/plain; charset=UTF-8

I'm not convinced this is the good change.
- I see the point of namespacing to avoid conflicts but I suspect
conciseness is also important here, if we want to use warning-tweaking
directives in a fine-grained enough way
- I suspect that the idea of warning over unknown ocaml.foo attributes is
papering over the real difficulty, which is the fact that it's very easy to
make a mistake if warnings are ignored by default. While giving more
structure to an "ocaml" namespace solves the particular problem Damien had
with deprecated, chances are users will still have their problems with the
warnings they define on their own (or what about [@@OCaml.warning]). We may
want to think harder about resilience to user mistakes to aim for a less
ad-hoc solution.


On Mon, Apr 14, 2014 at 5:18 PM, Alain Frisch <alain.frisch@lexifi.com>wrote:

> Dear all,
>
> In order to mark cleanly which warnings are understood in a special way by
> the compiler, I've added an ocaml.* prefix to them.   Currently, the only
> such attributes are ocaml.deprecated and ocaml.warning.
>
> I'm planning to add (with a low priority) a new warning to report uses of
> unknown ocaml.* warnings (or known warnings applied to a wrong object).
>  This will allow to catch typos such as writing ocaml.warnings instead of
> ocaml.warning.
>
>
> Alain
>
> _______________________________________________
> Caml-devel mailing list
> Caml-devel@yquem.inria.fr
> http://yquem.inria.fr/cgi-bin/mailman/listinfo/caml-devel
>

--001a1134044ea05b2104f707c981
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">I&#39;m not convinced this is the good change.=C2=A0<div>-=
 I see the point of namespacing to avoid conflicts but I suspect concisenes=
s is also important here, if we want to use warning-tweaking directives in =
a fine-grained enough way</div>

<div>- I suspect that the idea of warning over unknown ocaml.foo attributes=
 is papering over the real difficulty, which is the fact that it&#39;s very=
 easy to make a mistake if warnings are ignored by default. While giving mo=
re structure to an &quot;ocaml&quot; namespace solves the particular proble=
m Damien had with deprecated, chances are users will still have their probl=
ems with the warnings they define on their own (or what about [@@OCaml.warn=
ing]). We may want to think harder about resilience to user mistakes to aim=
 for a less ad-hoc solution.</div>

</div><div class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Mon,=
 Apr 14, 2014 at 5:18 PM, Alain Frisch <span dir=3D"ltr">&lt;<a href=3D"mai=
lto:alain.frisch@lexifi.com" target=3D"_blank">alain.frisch@lexifi.com</a>&=
gt;</span> wrote:<br>

<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">Dear all,<br>
<br>
In order to mark cleanly which warnings are understood in a special way by =
the compiler, I&#39;ve added an ocaml.* prefix to them. =C2=A0 Currently, t=
he only such attributes are ocaml.deprecated and ocaml.warning.<br>
<br>
I&#39;m planning to add (with a low priority) a new warning to report uses =
of unknown ocaml.* warnings (or known warnings applied to a wrong object). =
=C2=A0This will allow to catch typos such as writing ocaml.warnings instead=
 of ocaml.warning.<br>


<br>
<br>
Alain<br>
<br>
______________________________<u></u>_________________<br>
Caml-devel mailing list<br>
<a href=3D"mailto:Caml-devel@yquem.inria.fr" target=3D"_blank">Caml-devel@y=
quem.inria.fr</a><br>
<a href=3D"http://yquem.inria.fr/cgi-bin/mailman/listinfo/caml-devel" targe=
t=3D"_blank">http://yquem.inria.fr/cgi-bin/<u></u>mailman/listinfo/caml-dev=
el</a><br>
</blockquote></div><br></div>

--001a1134044ea05b2104f707c981--

From mshinwell@janestreet.com  Tue Apr 15 06:35:44 2014
Return-Path: <mshinwell@janestreet.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 8A9F23C1C4
 for <wg-camlp4@lists.ocaml.org>; Tue, 15 Apr 2014 06:35:44 +0100 (BST)
X-Cam-SpamScore: s
X-Cam-SpamDetails: score 1.4 from SpamAssassin-3.3.2-1587163 
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [38.105.200.229] (port=37170 helo=mxout3.mail.janestreet.com)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtps (TLSv1:DHE-RSA-AES256-SHA:256)
 id 1WZwTg-0005FF-Wc (Exim 4.82_3-c0e5623) for wg-camlp4@lists.ocaml.org
 (return-path <mshinwell@janestreet.com>); Tue, 15 Apr 2014 07:04:21 +0100
Received: from tot-oib-smtp1.delacy.com ([172.27.22.15] helo=tot-smtp)
 by mxout3.mail.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <mshinwell@janestreet.com>) id 1WZwT4-0005q6-OF
 for wg-camlp4@lists.ocaml.org; Tue, 15 Apr 2014 02:03:38 -0400
Received: from tot-dmz-mxgoog1.delacy.com ([172.27.224.14]
 helo=mxgoog2.janestreet.com)
 by tot-smtp with esmtps (TLSv1:AES256-SHA:256) (Exim 4.72)
 (envelope-from <mshinwell@janestreet.com>) id 1WZwT4-0008VB-Mc
 for wg-camlp4@lists.ocaml.org; Tue, 15 Apr 2014 02:03:38 -0400
Received: from mail-vc0-f182.google.com ([209.85.220.182])
 by mxgoog2.janestreet.com with esmtp (Exim 4.76)
 (envelope-from <mshinwell@janestreet.com>) id 1WZwT4-00084f-JP
 for wg-camlp4@lists.ocaml.org; Tue, 15 Apr 2014 02:03:38 -0400
Received: by mail-vc0-f182.google.com with SMTP id ib6so8910687vcb.27
 for <wg-camlp4@lists.ocaml.org>; Mon, 14 Apr 2014 23:03:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=janestreet.com; s=google;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type;
 bh=aE9hWhQ5oC95c8Py9GmXZCmgCJoaox1n5YNrY2j/qPQ=;
 b=Q6hS+ndXge31FuQITfmNQLgqfhtpceH7JHPBmPId6xyS/fWIByn408udblmDgEFqQL
 1zlUZ90pObcAppQlyDfrSccId81oGfyH4wzjcWjAftgoFvuTlWNaKwOP/RObS5oHe4Cu
 u3q05ZnRHOfbp0/29LYdYhQu8X+dobBKK4DMI=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20130820;
 h=x-gm-message-state:mime-version:in-reply-to:references:date
 :message-id:subject:from:to:cc:content-type;
 bh=aE9hWhQ5oC95c8Py9GmXZCmgCJoaox1n5YNrY2j/qPQ=;
 b=IE2vx3vEti5zszXEzC88xvL4L46lCyGcZKUJ1ru9lnOsj80RRA6wpPtabxf6ZP3+CH
 r28tQKpODZ+EJJA1sSgs8MsRiutARQA1QPAS8NaMFYcGKq5eoZvocEFCQxnUzVC+BeVg
 n60KmYkLkND2/zfzpbDfjfotkHq/D0yp2Lod3OQhzKljXtqOPERDX4VGiPUbaeYtC5b7
 kX7L656U66oeqvNK+uwslDOtG6m9m4y0zDT+XdrPkdGp5mE/gVkw0eHvFxHN5u0usLhm
 H9y0pYpG/YXDsdb62rXVGbId/J2WVhAKurYrH/7rDw+kxAtfMzRJC5TyTpSUS3H1QZiD
 xbMA==
X-Gm-Message-State: ALoCoQkfQmuutTgQ2m+l1Z1InJv7zS3/R+MVaIPK7UhiqHy2nUoanw8P9lud/5+PXo7RIL1pXxBPxjliWGj73YKOGnRaJ4WoMvWvHlYYo/Nt+QWTbZbDl9W42+p4qISrPx82nBc5F8lL
X-Received: by 10.221.58.144 with SMTP id wk16mr6472912vcb.23.1397541818397;
 Mon, 14 Apr 2014 23:03:38 -0700 (PDT)
MIME-Version: 1.0
X-Received: by 10.221.58.144 with SMTP id wk16mr6472906vcb.23.1397541818319;
 Mon, 14 Apr 2014 23:03:38 -0700 (PDT)
Received: by 10.58.218.9 with HTTP; Mon, 14 Apr 2014 23:03:38 -0700 (PDT)
In-Reply-To: <06269D19-0BB2-406F-94BB-4DB58F59B9F4@inria.fr>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
 <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
 <52614209.2000006@lexifi.com> <534BF75B.4030006@lexifi.com>
 <06269D19-0BB2-406F-94BB-4DB58F59B9F4@inria.fr>
Date: Tue, 15 Apr 2014 07:03:38 +0100
Message-ID: <CAM3Ki77cU3LHFUpsbe4caDq6t-dgABxXm-eiB4CB+6PPBktHUg@mail.gmail.com>
From: Mark Shinwell <mshinwell@janestreet.com>
To: Damien Doligez <damien.doligez@inria.fr>
Content-Type: text/plain; charset=ISO-8859-1
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Structure/signature attributes
	suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 15 Apr 2014 05:35:44 -0000

On 14 April 2014 16:40, Damien Doligez <damien.doligez@inria.fr> wrote:
> IIUC, we now have three kinds of attributes:
>
> [@foo]   attached to an expression
> [@@foo]  attached to a structure item
> [@@@foo] attached to the whole module (with location being significant?)

Seems like a nice hierarchy, but: doesn't anyone else find this syntax
increasingly ugly?  I do!

Mark

From drupyog+caml@zoho.com  Tue Apr 15 10:19:43 2014
Return-Path: <drupyog+caml@zoho.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id A4D0C3C150
 for <wg-camlp4@lists.ocaml.org>; Tue, 15 Apr 2014 10:19:43 +0100 (BST)
X-Cam-SpamDetails: score -0.6 from SpamAssassin-3.3.2-1587163 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [72.5.230.95 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (drupyog+caml[at]zoho.com)
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from sender1.zohomail.com ([72.5.230.95]:63376)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1WZzyW-0005KF-Qp (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <drupyog+caml@zoho.com>); Tue, 15 Apr 2014 10:48:21 +0100
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=zapps768; d=zoho.com; 
 h=message-id:date:from:user-agent:mime-version:to:cc:subject:references:in-reply-to:content-type;
 b=lLAsmkDMTQdGTSy2Qy0DuY34kYDssBvOfkVTB65cJD1etpOsm83eghUih5d+17NrUBAJV337AJXb
 ERilq2snTGM2b6sAllkyOjAWIcMpzLJYBAEfkKMDK2NKLSCX8zOw  
Received: from [130.190.41.47] (eduroam-041047.grenet.fr [130.190.41.47]) by
 mx.zohomail.com with SMTPS id 1397555293160609.5314610589343;
 Tue, 15 Apr 2014 02:48:13 -0700 (PDT)
Message-ID: <534D0059.2030305@zoho.com>
Date: Tue, 15 Apr 2014 11:48:09 +0200
From: Drup <drupyog+caml@zoho.com>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.4.0
MIME-Version: 1.0
To: Mark Shinwell <mshinwell@janestreet.com>, 
 Damien Doligez <damien.doligez@inria.fr>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
 <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
 <52614209.2000006@lexifi.com> <534BF75B.4030006@lexifi.com>
 <06269D19-0BB2-406F-94BB-4DB58F59B9F4@inria.fr>
 <CAM3Ki77cU3LHFUpsbe4caDq6t-dgABxXm-eiB4CB+6PPBktHUg@mail.gmail.com>
In-Reply-To: <CAM3Ki77cU3LHFUpsbe4caDq6t-dgABxXm-eiB4CB+6PPBktHUg@mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
X-ZohoMailClient: External
X-Zoho-Virus-Status: 2
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Structure/signature attributes
	suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 15 Apr 2014 09:19:43 -0000

I agree, but the added verbosity with all those additional brackets 
bother me even more, especially for attributes. I wonder if we could 
drop some brackets when there is no added expression : "x@foo" instead 
of "x[@foo]" .

Also, to follow some shortcuts with extension nodes on keyword, would it 
be possible to add those syntax :

1) "let%foo x = 3" => "[%%foo let x = 3]"
Since "let ... " is not an expression (but a toplevel declaration), the 
%foo doesn't work on them.
We could use %% for consistency, but the added symbol doesn't bring any 
added value, since the % character is already specific enough.

2) "( ... )%foo"
It would be equivalent to "begin%foo ... end" or [%foo ... ] but (imho) 
easier on the eyes and closer to a natural ocaml syntax, even it  it's 
not much shorter, character wise.

My use cases for those are top level server and client declarations and 
client values in eliom.

Le 15/04/2014 08:03, Mark Shinwell a crit :
> On 14 April 2014 16:40, Damien Doligez <damien.doligez@inria.fr> wrote:
>> IIUC, we now have three kinds of attributes:
>>
>> [@foo]   attached to an expression
>> [@@foo]  attached to a structure item
>> [@@@foo] attached to the whole module (with location being significant?)
> Seems like a nice hierarchy, but: doesn't anyone else find this syntax
> increasingly ugly?  I do!
>
> Mark
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4



From alain@frisch.fr  Tue Apr 15 12:15:50 2014
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-40.csi.cam.ac.uk (ppsw-40.csi.cam.ac.uk [131.111.8.140])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 79E173C316
 for <wg-camlp4@lists.ocaml.org>; Tue, 15 Apr 2014 12:15:50 +0100 (BST)
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.0 from SpamAssassin-3.3.2-1587163 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [80.12.242.127 listed in rbl-plus.mail-abuse.ja.net]
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [80.12.242.127 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp05.smtpout.orange.fr ([80.12.242.127]:51763
 helo=msa.smtpout.orange.fr)
 by ppsw-40.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1Wa1mp-0007jF-jS (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 15 Apr 2014 12:44:28 +0100
Received: from [192.168.1.133] ([92.151.96.149]) by mwinf5d61 with ME
 id qBk11n00r3DNUj803Bk1Pg; Tue, 15 Apr 2014 13:44:02 +0200
X-ME-Helo: [192.168.1.133]
X-ME-Auth: bGV4aWZpQHdhbmFkb28uZnI=
X-ME-Date: Tue, 15 Apr 2014 13:44:02 +0200
X-ME-IP: 92.151.96.149
Message-ID: <534D1B84.5060802@frisch.fr>
Date: Tue, 15 Apr 2014 13:44:04 +0200
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.4.0
MIME-Version: 1.0
To: Drup <drupyog+caml@zoho.com>, Mark Shinwell <mshinwell@janestreet.com>,
 Damien Doligez <damien.doligez@inria.fr>
References: <51701746.9010008@lexifi.com> <86hacnrcd2.fsf@cam.ac.uk>
 <525864C1.80908@lexifi.com> <86vc13mrnp.fsf@cam.ac.uk>
 <5258E54C.5050701@lexifi.com>
 <CAPFanBFQaHS094YgSQJPwJuWDR7E5ZSgyJv-T0AXOzPBnrf0LA@mail.gmail.com>
 <52614209.2000006@lexifi.com> <534BF75B.4030006@lexifi.com>
 <06269D19-0BB2-406F-94BB-4DB58F59B9F4@inria.fr>
 <CAM3Ki77cU3LHFUpsbe4caDq6t-dgABxXm-eiB4CB+6PPBktHUg@mail.gmail.com>
 <534D0059.2030305@zoho.com>
In-Reply-To: <534D0059.2030305@zoho.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Structure/signature attributes
	suggestion
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 15 Apr 2014 11:15:50 -0000

On 04/15/2014 11:48 AM, Drup wrote:
> I agree, but the added verbosity with all those additional brackets
> bother me even more, especially for attributes. I wonder if we could
> drop some brackets when there is no added expression : "x@foo" instead
> of "x[@foo]" .

Since @ is a binary operator, x@foo would not be available for 
expressions. I don't think it is worth supporting it for other kinds of 
syntactic categories.

>
> Also, to follow some shortcuts with extension nodes on keyword, would it
> be possible to add those syntax :
>
> 1) "let%foo x = 3" => "[%%foo let x = 3]"
> Since "let ... " is not an expression (but a toplevel declaration), the
> %foo doesn't work on them.
> We could use %% for consistency, but the added symbol doesn't bring any
> added value, since the % character is already specific enough.

Good idea.  I've committed it to trunk, rev 14600.  Here we benefit from 
the fact that the payload of extension nodes can be arbitrary 
structures, not just expressions.

(Attributes are still not supported on let-binding structure items: 
let[@foo] x = 3.)

> 2) "( ... )%foo"
> It would be equivalent to "begin%foo ... end" or [%foo ... ] but (imho)
> easier on the eyes and closer to a natural ocaml syntax, even it  it's
> not much shorter, character wise.

Same as above: (%) is a valid infix operator.


-- Alain

From darioteixeira@yahoo.com  Tue Apr 15 17:25:58 2014
Return-Path: <darioteixeira@yahoo.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-40.csi.cam.ac.uk (ppsw-40.csi.cam.ac.uk [131.111.8.140])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 8BB613C316
 for <wg-camlp4@lists.ocaml.org>; Tue, 15 Apr 2014 17:25:58 +0100 (BST)
X-Cam-SpamDetails: score 0.7 from SpamAssassin-3.3.2-1587163 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [98.138.90.159 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (darioteixeira[at]yahoo.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from nm11-vm2.bullet.mail.ne1.yahoo.com ([98.138.90.159]:31549)
 by ppsw-40.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtps (TLSv1:DHE-RSA-AES256-SHA:256)
 id 1Wa6d2-00085N-ka (Exim 4.82_3-c0e5623) for wg-camlp4@lists.ocaml.org
 (return-path <darioteixeira@yahoo.com>); Tue, 15 Apr 2014 17:54:37 +0100
Received: from [98.138.226.180] by nm11.bullet.mail.ne1.yahoo.com with NNFMP;
 15 Apr 2014 16:54:34 -0000
Received: from [98.138.101.173] by tm15.bullet.mail.ne1.yahoo.com with NNFMP;
 15 Apr 2014 16:54:34 -0000
Received: from [127.0.0.1] by omp1084.mail.ne1.yahoo.com with NNFMP;
 15 Apr 2014 16:54:34 -0000
X-Yahoo-Newman-Property: ymail-3
X-Yahoo-Newman-Id: 500008.23630.bm@omp1084.mail.ne1.yahoo.com
Received: (qmail 91484 invoked by uid 60001); 15 Apr 2014 16:54:34 -0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoo.com; s=s1024;
 t=1397580874; bh=H2KpjfnWPoKNiQaD1dzrFZRXtQm2qNPfQejvrs59CLE=;
 h=X-YMail-OSG:Received:X-Rocket-MIMEInfo:X-Mailer:References:Message-ID:Date:From:Reply-To:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
 b=fT3Kv5L3exiTjXHihIggDN5r3y3Ce4WeoJ6zrUNwS51SVYdKdj2ZUawB4uIAauIUk4ZB0rQPkgzQj8GKAAp3BmD4wVkhEFLuarig7OnLO82noTSXVx+kfqlAI2oWWDYYqLhZaxFKOMKFr7IOXk1aUk7RmnNW3mtwY+N5SYNiyvk=
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws; s=s1024; d=yahoo.com;
 h=X-YMail-OSG:Received:X-Rocket-MIMEInfo:X-Mailer:References:Message-ID:Date:From:Reply-To:Subject:To:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
 b=uX+iK7tgReTaYXtQMlBNuvJjuE9ZqLGhsXRh+6F6i8FKO1fl6Vsn4u1UfHsHUf/4xbDcwAWkyph/y9jbwbdL0t8sLfQ8RvkRyHjoDI0DSuW+k/QJRUVEa0/6sPQVKBcaVK/ejrc79ebOmaph+BmSOQ5barMA+cQUtcrr5DLRCQM=;
X-YMail-OSG: UW9zmaMVM1kjjnox_RQc8djpDyij51fp_7AQP0pXBAu1sok
 R0xpfucbTwwniphfnLw6Gn3UmfvbTLavugWYlFduJOHdKU6S5yK8hfm1xQua
 KuPIly2DtuXh699NKNWRPRkZ6uGd5zS7B6AG6lnQWgbUS1y1fuLuejhm06fj
 gBRo3CzFnfETfapNFtR.1vhqVdpUKyAlaSqBgOIy7fJFLQRH1Bbl7p.gfK5S
 ZyVL.7rWoJuv3mV6KFPGNgYU_trV9bYtNl_9CDWegc4cVO5lCsBf0nKZbY5F
 4siEUMd0rkmZ0R0M2oELvurFy5T1D17lLrgZ1Kmy3EO8BhZHpHtAk2iJYx1V
 8oupM1A6WkQmfPwkEyENnnmvBcSbwrL3FL9auWzKwQ0ZyUwik0nR_Tkewzni
 m.VlYeI4.5d2RK0LYfvnpH_B_579pxFsyFmS1aysM9oMur0Ji5uZKTEz8ZEJ
 W7IPKfOVEt5L4BCeqnlHQcmDfrAD52JHZDepHs7FAhyb55ShpT7QN2mhOHNb
 vDruxQyo7we09e7Dkw2cueKfT97xxnbXVmy81zIGYzNw7hb8uLvtgNjWhtep
 zkjYSdvC_oSIB_Mm4m944rKkRqHVwVVxsJQ--
Received: from [195.23.39.42] by web121701.mail.ne1.yahoo.com via HTTP;
 Tue, 15 Apr 2014 09:54:34 PDT
X-Rocket-MIMEInfo: 002.001,
 SGksCgo.IC0gSSBzZWUgdGhlIHBvaW50IG9mIG5hbWVzcGFjaW5nIHRvIGF2b2lkIGNvbmZsaWN0cyBidXQgSSBzdXNwZWN0IGNvbmNpc2VuZXNzIGlzCj4gYWxzbyBpbXBvcnRhbnQgaGVyZSwgaWYgd2Ugd2FudCB0byB1c2Ugd2FybmluZy10d2Vha2luZyBkaXJlY3RpdmVzIGluIGEgZmluZS1ncmFpbmVkCj4gZW5vdWdoIHdheQo.Cj4gLSBJIHN1c3BlY3QgdGhhdCB0aGUgaWRlYSBvZiB3YXJuaW5nIG92ZXIgdW5rbm93biBvY2FtbC5mb28gYXR0cmlidXRlcyBpcyBwYXBlcmluZwo.IG92ZXIgdGhlIHJlYWwBMAEBAQE-
X-Mailer: YahooMailWebService/0.8.185.657
References: <534BFC5F.9030509@lexifi.com>
 <CAPFanBG0nQMU+aFusmUPnvxiiLonOrn2f0aqy0LiTQk=-QzhZg@mail.gmail.com>
Message-ID: <1397580874.77042.YahooMailNeo@web121701.mail.ne1.yahoo.com>
Date: Tue, 15 Apr 2014 09:54:34 -0700 (PDT)
From: Dario Teixeira <darioteixeira@yahoo.com>
To: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
In-Reply-To: <CAPFanBG0nQMU+aFusmUPnvxiiLonOrn2f0aqy0LiTQk=-QzhZg@mail.gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] [Caml-devel] Built-in attributes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
Reply-To: Dario Teixeira <darioteixeira@yahoo.com>
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 15 Apr 2014 16:25:58 -0000

Hi,=0A=0A> - I see the point of namespacing to avoid conflicts but I suspec=
t conciseness is=0A> also important here, if we want to use warning-tweakin=
g directives in a fine-grained=0A> enough way=0A>=0A> - I suspect that the =
idea of warning over unknown ocaml.foo attributes is papering=0A> over the =
real difficulty, which is the fact that it's very easy to make a mistake if=
=0A> warnings are ignored by default. While giving more structure to an "oc=
aml" namespace=0A> solves the particular problem Damien had with deprecated=
, chances are users will=0A> still have their problems with the warnings th=
ey define on their own (or what about=0A> [@@OCaml.warning]). We may want t=
o think harder about resilience to user mistakes to=0A> aim for a less ad-h=
oc solution.=0A=0AGabriel has a point here.=A0=A0As I see it, there are thr=
ee broad approaches to namespacing:=0A=0A=A0 1) Namespace nothing.=A0 Use s=
ocial norms to avoid name clashes between different projects.=0A=0A=A0 2) N=
amespace everything, including compiler extensions.=A0=A0Compiler can even =
enforce this=0A=A0=A0=A0=A0 usage by requiring extension points to be of th=
e form "ns.name".=0A=0A=A0 3) No namespacing for generic and builtin attrib=
utes, such as "default", "warning",=0A=A0=A0=A0=A0 or "author", but sociall=
y-enforced namespacing for extension-specific attributes.=0A=0AHere's my pr=
oblem with solution 2: how do we deal with generic attributes that could be=
=0Aused by more than one extension?=A0=A0(For instance, attribute "default"=
 used by Sexplib=0Aor Bin-prot, or documentation attributes such as "author=
" used by tools such as Ocamldoc).=0AThis is why I'm leaning more towards s=
olution 3.=A0=A0This approach would require a centrally=0Amaintained list o=
f non-namespaced attributes (a disadvantage, I admit), but this list=0Awoul=
d be small and fairly static (we could require broad community approval bef=
ore=0Aadding another attribute).=A0=A0All other attributes would be namespa=
ced, though I imagine=0Athat the namespacing could itself be a social conve=
ntion (eg. "proj.attr") instead=0Aof being enforced by the compiler.=0A=0AA=
s for the other problem Gabriel raised -- typos going unnoticed -- I reckon=
 tooling=0Aoutside the compiler could be of help.=A0=A0A tool that went thr=
ough the code base and=0Achecked each usage of an extension point against a=
 project whitelist would catch typos,=0Afor instance.=0A=0ABest regards,=0A=
Dario Teixeira=0A

From alain.frisch@lexifi.com  Wed Apr 16 09:05:40 2014
Return-Path: <alain.frisch@lexifi.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-40.csi.cam.ac.uk (ppsw-40.csi.cam.ac.uk [131.111.8.140])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id AB6873C1C4
 for <wg-camlp4@lists.ocaml.org>; Wed, 16 Apr 2014 09:05:40 +0100 (BST)
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.0 from SpamAssassin-3.3.2-1587475 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [80.12.242.127 listed in rbl-plus.mail-abuse.ja.net]
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [80.12.242.127 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp05.smtpout.orange.fr ([80.12.242.127]:56351
 helo=msa.smtpout.orange.fr)
 by ppsw-40.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1WaLIO-000605-jY (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain.frisch@lexifi.com>); Wed, 16 Apr 2014 09:34:21 +0100
Received: from [192.168.1.133] ([92.151.96.149]) by mwinf5d52 with ME
 id qYZu1n01d3DNUj803YZvnT; Wed, 16 Apr 2014 10:33:55 +0200
X-ME-Helo: [192.168.1.133]
X-ME-Auth: bGV4aWZpQHdhbmFkb28uZnI=
X-ME-Date: Wed, 16 Apr 2014 10:33:55 +0200
X-ME-IP: 92.151.96.149
Message-ID: <534E4073.5020005@lexifi.com>
Date: Wed, 16 Apr 2014 10:33:55 +0200
From: Alain Frisch <alain.frisch@lexifi.com>
Organization: LexiFi
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.4.0
MIME-Version: 1.0
To: Gabriel Scherer <gabriel.scherer@gmail.com>
References: <534BFC5F.9030509@lexifi.com>
 <CAPFanBG0nQMU+aFusmUPnvxiiLonOrn2f0aqy0LiTQk=-QzhZg@mail.gmail.com>
In-Reply-To: <CAPFanBG0nQMU+aFusmUPnvxiiLonOrn2f0aqy0LiTQk=-QzhZg@mail.gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Built-in attributes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 16 Apr 2014 08:05:40 -0000

On 04/14/2014 11:58 PM, Gabriel Scherer wrote:
> - I see the point of namespacing to avoid conflicts but I suspect
> conciseness is also important here, if we want to use warning-tweaking
> directives in a fine-grained enough way

I don't particularly want to encourage that.  The standard use for 
[ocaml.warning] I have in mind is to control warnings for an entire 
compilation unit (thus simplifying the build system and making the unit 
more self-contained), maybe for a "section" of it (hence the warning on 
expressions, to allow begin[@ocaml.warning "..."] .... end), especially 
during development.  It would be a mess if people start to decorate 
their code with long-lasting warning-tweaking directives all over the 
place, in my opinion.  (Especially from a readability point of view: 
numbered warnings are quite unfriendly.)

> - I suspect that the idea of warning over unknown ocaml.foo attributes
> is papering over the real difficulty, which is the fact that it's very
> easy to make a mistake if warnings are ignored by default. While giving
> more structure to an "ocaml" namespace solves the particular problem
> Damien had with deprecated, chances are users will still have their
> problems with the warnings they define on their own (or what about
> [@@OCaml.warning]). We may want to think harder about resilience to user
> mistakes to aim for a less ad-hoc solution.

A tool which checks for correct use of warnings could be useful, and not 
too difficult if one restrict to a "white-list" of known attributes 
(maybe some information about where they can be used, and potentially 
with some "typing" information).  Each tool operating on attributes (ppx 
or others) could come with a description of what it understands, to be 
processed by this checking tool.

That said, I wouldn't be surprised if code made available publicly 
contains attributes to be interpreted by tools which are not necessarily 
available where that code is compiled.  For instance, a company could 
publish code containing some internal "code review markers" (implemented 
as attributes).


Alain

From lpw25@cam.ac.uk  Wed Apr 16 10:20:41 2014
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id C19173C1C4
 for <wg-camlp4@lists.ocaml.org>; Wed, 16 Apr 2014 10:20:41 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from host81-153-163-84.range81-153.btcentralplus.com
 ([81.153.163.84]:39352 helo=netbook)
 by ppsw-51.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.159]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1WaMT4-0007id-WZ (Exim 4.82_3-c0e5623)
 (return-path <lpw25@cam.ac.uk>); Wed, 16 Apr 2014 10:49:22 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain.frisch@lexifi.com>
References: <534BFC5F.9030509@lexifi.com>
 <CAPFanBG0nQMU+aFusmUPnvxiiLonOrn2f0aqy0LiTQk=-QzhZg@mail.gmail.com>
 <534E4073.5020005@lexifi.com>
X-Face: "XWxb[u_Z\PA_Y?9@|IA!!+jTb(/290-*ea/Un$I0B98.$n%eL.;
 2w<l)q>*,z]WR#T:,p[
 NBd++M7l]#7zj7!{<NUTKJA{}Ox<uO[wb-s<\6jzp.r]-AE[W%E+ckCQ'2WZS@Zu/PJU$~~oy|>~iw
 $W-"/=|dVjhT[D{4~gE}gK<2`.6fs!;uqqud]vs2N/3^m7{aS1V,
Date: Wed, 16 Apr 2014 10:49:20 +0100
In-Reply-To: <534E4073.5020005@lexifi.com> (Alain Frisch's message of "Wed, 16
 Apr 2014 10:33:55 +0200")
Message-ID: <86zjjl4na7.fsf@cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel] Built-in attributes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 16 Apr 2014 09:20:41 -0000

> I don't particularly want to encourage that.  The standard use for [ocaml.warning] I have in mind is to control warnings
> for an entire compilation unit (thus simplifying the build system and making the unit more self-contained), maybe for a
> "section" of it (hence the warning on expressions, to allow begin[@ocaml.warning "..."] .... end), especially during
> development.  It would be a mess if people start to decorate their code with long-lasting warning-tweaking directives
> all over the place, in my opinion.  (Especially from a readability point of view: numbered warnings are quite
> unfriendly.)
>

While this might be true for `[@warning]` it probably won't be true for
every attribute the compiler will understand. I think `[@ocaml.foo]`
could get pretty annoying pretty fast.

Regards,

Leo

From alain@frisch.fr  Tue May  6 04:59:20 2014
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id C64233C04E
 for <wg-camlp4@lists.ocaml.org>; Tue,  6 May 2014 04:59:20 +0100 (BST)
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.0 from SpamAssassin-3.3.2-1588424 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [80.12.242.124 listed in rbl-plus.mail-abuse.ja.net]
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [80.12.242.124 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp02.smtpout.orange.fr ([80.12.242.124]:20086
 helo=smtp.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1WhX07-0005HB-WV (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 06 May 2014 05:29:07 +0100
Received: from [192.168.1.27] ([81.249.123.176]) by mwinf5d55 with ME
 id yUV41n0053oTwKV03UV5Jm; Tue, 06 May 2014 06:29:06 +0200
X-ME-Helo: [192.168.1.27]
X-ME-Auth: ZnJpc2NoLmFsYWluQHdhbmFkb28uZnI=
X-ME-Date: Tue, 06 May 2014 06:29:06 +0200
X-ME-IP: 81.249.123.176
Message-ID: <53686514.8070200@frisch.fr>
Date: Tue, 06 May 2014 06:29:08 +0200
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:24.0) Gecko/20100101 Thunderbird/24.5.0
MIME-Version: 1.0
To: Peter Zotov <whitequark@whitequark.org>, caml-list <caml-list@inria.fr>,
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
References: <6232dace806569a16f7fbfaa1689ef42@whitequark.org>
In-Reply-To: <6232dace806569a16f7fbfaa1689ef42@whitequark.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] [Caml-list] [ANN] ppx_protobuf
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 06 May 2014 03:59:20 -0000

On 5/2/2014 4:29 PM, Peter Zotov wrote:
> I have just released the first version of ppx_protobuf, a complete
> Protocol Buffers implementation.

This is a very cool project, and a good first public use of extension 
points!

An aspect of attributes that is not fully settled is how to use 
namespacing in order to ensure that multiple tools interact nicely.
This topic will hopefully be explored by the community to reach a good 
consensus.

For instance, ppx_protobuf relies on attributes with quite generic names 
such as @default or @key, that might also be useful to other tools.  It 
might very well be the case that the same @default attribute (with the 
same value) would actually be useful to both ppx_protobuf and another 
deriving-like extension.  This is good, since attributes are not 
designed to be necessarily targeted to only one specific tool.  But in 
some cases, one might want to use a different @default attribute for 
different tools.  What about supporting both a short form @default and a 
more qualified one @protobuf.default?  This should support both situations.

Another point: for record fields, you interpret attributes at the 
toplevel of their type. I did not look precisely at the semantics of 
ppx_protobuf, but it seems that it might be more logical to attach them 
to the field directly (do you confirm?):

   type defaults = {
      results [@key 1] [@default 10]: int;
   } [@@protobuf]

I understand that this form is syntactically "more intrusive" in the 
non-decorated type definition.  Is it the reason to use:

   type defaults = {
      results : int [@key 1] [@default 10];
   } [@@protobuf]

?

I don't see anything wrong with doing so, although it might be worth 
supporting both forms.


-- Alain

From alain@frisch.fr  Tue May  6 05:22:14 2014
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 2B7053C04E
 for <wg-camlp4@lists.ocaml.org>; Tue,  6 May 2014 05:22:14 +0100 (BST)
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.0 from SpamAssassin-3.3.2-1588424 
 *  2.0 RCVD_IN_MAPS_RBL RBL: Relay in RBL,
 *      http://www.mail-abuse.com/enduserinfo_rbl.html
 *      [80.12.242.124 listed in rbl-plus.mail-abuse.ja.net]
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [80.12.242.124 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from smtp02.smtpout.orange.fr ([80.12.242.124]:56485
 helo=smtp.smtpout.orange.fr)
 by ppsw-41.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtp id 1WhXMG-0005gU-RN (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 06 May 2014 05:52:00 +0100
Received: from [192.168.1.27] ([81.249.123.176]) by mwinf5d55 with ME
 id yUrz1n00M3oTwKV03UrzCP; Tue, 06 May 2014 06:52:00 +0200
X-ME-Helo: [192.168.1.27]
X-ME-Auth: ZnJpc2NoLmFsYWluQHdhbmFkb28uZnI=
X-ME-Date: Tue, 06 May 2014 06:52:00 +0200
X-ME-IP: 81.249.123.176
Message-ID: <53686A73.3070403@frisch.fr>
Date: Tue, 06 May 2014 06:52:03 +0200
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64;
 rv:24.0) Gecko/20100101 Thunderbird/24.5.0
MIME-Version: 1.0
To: Dario Teixeira <darioteixeira@yahoo.com>, 
 "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
References: <534BFC5F.9030509@lexifi.com>
 <CAPFanBG0nQMU+aFusmUPnvxiiLonOrn2f0aqy0LiTQk=-QzhZg@mail.gmail.com>
 <1397580874.77042.YahooMailNeo@web121701.mail.ne1.yahoo.com>
In-Reply-To: <1397580874.77042.YahooMailNeo@web121701.mail.ne1.yahoo.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Subject: Re: [wg-camlp4] [Caml-devel]   Built-in attributes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 06 May 2014 04:22:14 -0000

On 4/15/2014 6:54 PM, Dario Teixeira wrote:
> As I see it, there are three broad approaches to namespacing:
>
>    1) Namespace nothing.  Use social norms to avoid name clashes between different projects.
>
>    2) Namespace everything, including compiler extensions.  Compiler can even enforce this
>       usage by requiring extension points to be of the form "ns.name".
>
>    3) No namespacing for generic and builtin attributes, such as "default", "warning",
>       or "author", but socially-enforced namespacing for extension-specific attributes.
>
> Here's my problem with solution 2: how do we deal with generic attributes that could be
> used by more than one extension?  (For instance, attribute "default" used by Sexplib
> or Bin-prot, or documentation attributes such as "author" used by tools such as Ocamldoc).
> This is why I'm leaning more towards solution 3.  This approach would require a centrally
> maintained list of non-namespaced attributes (a disadvantage, I admit), but this list
> would be small and fairly static (we could require broad community approval before
> adding another attribute).  All other attributes would be namespaced, though I imagine
> that the namespacing could itself be a social convention (eg. "proj.attr") instead
> of being enforced by the compiler.

A variant of solution 2 is to have each tool accept both qualified and 
unqualified attributes, as I propose in my email about ppx_protobuf.

This gives some flexibility regarding the list of non-namespaced 
attributes, since there is always a way for users to resolve conflicts 
by switching to the qualified form.  It's hard to know in advance if the 
same @default attribute, even if it is recognized by multiple tools, 
would also have the same payload for all of them if used on the same 
code base.

If we apply this to OCaml, we would support both @@ocaml.deprecated and 
@@deprecated.

Opinions?


-- Alain

From whitequark@whitequark.org  Tue May  6 05:30:06 2014
Return-Path: <whitequark@whitequark.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-40.csi.cam.ac.uk (ppsw-40.csi.cam.ac.uk [131.111.8.140])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id F2D1C3C04E
 for <wg-camlp4@lists.ocaml.org>; Tue,  6 May 2014 05:30:05 +0100 (BST)
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1588424 
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from fehu.whitequark.org ([176.58.103.125]:33669
 helo=mail.whitequark.org)
 by ppsw-40.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1WhXTp-0003l0-kg (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <whitequark@whitequark.org>); Tue, 06 May 2014 05:59:52 +0100
Received: by mail.whitequark.org (Postfix, from userid 33)
 id 790134D72B; Tue,  6 May 2014 04:59:48 +0000 (UTC)
To: Alain Frisch <alain@frisch.fr>
X-PHP-Originating-Script: 1000:rcube.php
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII;
 format=flowed
Content-Transfer-Encoding: 7bit
Date: Tue, 06 May 2014 08:59:48 +0400
From: Peter Zotov <whitequark@whitequark.org>
In-Reply-To: <53686514.8070200@frisch.fr>
References: <6232dace806569a16f7fbfaa1689ef42@whitequark.org>
 <53686514.8070200@frisch.fr>
Message-ID: <5c5c8af234151e7fdc529a63ce305dab@whitequark.org>
X-Sender: whitequark@whitequark.org
User-Agent: Roundcube Webmail/1.0.0
Cc: wg-camlp4@lists.ocaml.org, caml-list <caml-list@inria.fr>
Subject: Re: [wg-camlp4] =?utf-8?q?=5BCaml-list=5D_=5BANN=5D_ppx=5Fprotobuf?=
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 06 May 2014 04:30:06 -0000

On 2014-05-06 08:29, Alain Frisch wrote:
> On 5/2/2014 4:29 PM, Peter Zotov wrote:
>> I have just released the first version of ppx_protobuf, a complete
>> Protocol Buffers implementation.
> 
> This is a very cool project, and a good first public use of extension 
> points!

Thanks!

> 
> An aspect of attributes that is not fully settled is how to use
> namespacing in order to ensure that multiple tools interact nicely.
> This topic will hopefully be explored by the community to reach a good
> consensus.
> 
> (a suggestion to recognize both [@x] and [@protobuf.x])

I have designed ppx_protobuf's usage of attributes with exactly this in 
mind;
[@default] especially would be useful for a wide range of type-driven 
code
generators.

I actually intended to release it with the support for namespaced 
attribute
variants ([@protobuf.key]), it has simply been forgotten. I'll include 
it
in the next release.

> 
> Another point: for record fields, you interpret attributes at the
> toplevel of their type. I did not look precisely at the semantics of
> ppx_protobuf, but it seems that it might be more logical to attach
> them to the field directly (do you confirm?):
> 
>   type defaults = {
>      results [@key 1] [@default 10]: int;
>   } [@@protobuf]
> 
> I understand that this form is syntactically "more intrusive" in the
> non-decorated type definition.  Is it the reason to use:
> 
>   type defaults = {
>      results : int [@key 1] [@default 10];
>   } [@@protobuf]
> 
> ?
> 
> I don't see anything wrong with doing so, although it might be worth
> supporting both forms.

The issue here is that I want to support "immediate tuples" (i.e.
"field : int * int", or, more importantly, "A of int * int", which
are semantically equivalent to and represented as a Protobuf message.
As such, I felt it would be only consistent to have the same syntax
for specifying options on an immediate tuple of several elements:

   results : int [@encoding zigzag] * int [@encoding bits32]

and for specifying options on a "tuple of one element":

   results : int [@encoding zigzag]

I'm not entirely happy with this scheme; the way it gives rise to the 
message
structure is at best confusing, as adding or removing a tuple element 
can
add or remove nesting and thus break protocol compatibility. In 
addition,
the [@key] attribute on, for example, a field itself would currently be 
ignored.
While this behavior can be fixed for the most common misplacements, I 
feel like
it's a drawback intrinsic to the extension points mechanism: misplaced 
or misnamed
attributes are going to be silently ignored.

Do you have any ideas for a solution? I have toyed with an idea of
a "verifier extension" which would ascertain the lack of attributes 
after
all the rewriter passes have presumably removed the attributes known
to them, but it wouldn't work  with generic attributes like [@default] 
that
must be shared between extensions.

> 
> 
> -- Alain

-- 
Peter Zotov
sip:whitequark@sipnet.ru


From alain@frisch.fr  Tue May  6 08:04:07 2014
Return-Path: <alain@frisch.fr>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 4A8B63C250
 for <wg-camlp4@lists.ocaml.org>; Tue,  6 May 2014 08:04:07 +0100 (BST)
X-Cam-SpamDetails: score 0.0 from SpamAssassin-3.3.2-1588424 
 * -0.0 RCVD_IN_DNSWL_NONE RBL: Sender listed at http://www.dnswl.org/, no
 *      trust
 *      [193.252.23.213 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from msa04.smtpout.orange.fr ([193.252.23.213]:28602
 helo=msa.smtpout.orange.fr)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1WhZsv-0006MP-Z2 (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <alain@frisch.fr>); Tue, 06 May 2014 08:33:54 +0100
Received: from [192.168.1.133] ([92.151.12.96]) by mwinf5d31 with ME
 id yXZk1n00F24LMec03XZnmT; Tue, 06 May 2014 09:33:53 +0200
X-ME-Helo: [192.168.1.133]
X-ME-Auth: bGV4aWZpQHdhbmFkb28uZnI=
X-ME-Date: Tue, 06 May 2014 09:33:53 +0200
X-ME-IP: 92.151.12.96
Message-ID: <53689057.5010802@frisch.fr>
Date: Tue, 06 May 2014 09:33:43 +0200
From: Alain Frisch <alain@frisch.fr>
User-Agent: Mozilla/5.0 (X11; Linux i686 on x86_64;
 rv:24.0) Gecko/20100101 Thunderbird/24.5.0
MIME-Version: 1.0
To: Peter Zotov <whitequark@whitequark.org>
References: <6232dace806569a16f7fbfaa1689ef42@whitequark.org>
 <53686514.8070200@frisch.fr>
 <5c5c8af234151e7fdc529a63ce305dab@whitequark.org>
In-Reply-To: <5c5c8af234151e7fdc529a63ce305dab@whitequark.org>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Cc: wg-camlp4@lists.ocaml.org, caml-list <caml-list@inria.fr>
Subject: Re: [wg-camlp4] [Caml-list] [ANN] ppx_protobuf
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 06 May 2014 07:04:07 -0000

On 05/06/2014 06:59 AM, Peter Zotov wrote:
> While this behavior can be fixed for the most common misplacements, I
> feel like
> it's a drawback intrinsic to the extension points mechanism: misplaced
> or misnamed
> attributes are going to be silently ignored.

Indeed.

> Do you have any ideas for a solution? I have toyed with an idea of
> a "verifier extension" which would ascertain the lack of attributes after
> all the rewriter passes have presumably removed the attributes known
> to them, but it wouldn't work  with generic attributes like [@default] that
> must be shared between extensions.

I'm not convinced by the idea of checking the absence of attributes 
after -ppx rewriters are applied.  You mention one reason (generic 
attributes, which shouldn't be discarded by any specific -ppx), but 
there are others:

  - Even non-generic attributes might be better left in the Parsetree 
sent to OCaml, so that they appear in particular in the dumped typedtree 
(.cmt/.cmti), which could be useful for further processing (e.g. a 
version of ocamldoc based on .cmti files).

  - Attributes are not only designed to support -ppx rewriters.  They 
can also be used by tools which inspect compiled .cmt/.cmti/.cmi files, 
or stand-alone tools which work on source files but are not used as 
preprocessors.

  - There is also the case of "optional" -ppx rewriters (e.g. a code 
instrumentation tool which could be applied or not).


An "attribute checker" (either integrated in a generic style-checking 
tool such as Mascot or as a stand-alone tool,  or maybe even as an 
"identity" -ppx so that it is always included in the compilation chain) 
would need some way to know which attributes are allowed and in which 
context (it's fair to let each tool check the advanced conditions on the 
payload and constraints such as nesting conditions).  For instance, each 
tool could come with a small text file describing the attributes it 
recognizes (and in which contexts), maybe also with a rough description 
of admissible payloads and -- why not -- some succinct documentation 
about the attribute.  This information could be useful not only for the 
attribute checker, but potentially by other tools as well (e.g. an IDE).


-- Alain

From mmatalka@gmail.com  Tue May  6 11:12:32 2014
Return-Path: <mmatalka@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 0AC533C329
 for <wg-camlp4@lists.ocaml.org>; Tue,  6 May 2014 11:12:32 +0100 (BST)
X-Cam-SpamDetails: score 0.6 from SpamAssassin-3.3.2-1588424 
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.216.169 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (mmatalka[at]gmail.com)
 *  0.0 DKIM_ADSP_CUSTOM_MED No valid author signature, adsp_override is
 *      CUSTOM_MED
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 *  0.0 T_DKIM_INVALID DKIM-Signature header exists but is not valid
 *  1.2 NML_ADSP_CUSTOM_MED ADSP custom_med hit, and not from a mailing
 *      list
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-qc0-f169.google.com ([209.85.216.169]:36641)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtps (TLSv1:RC4-SHA:128)
 id 1Whcp5-0004kR-qe (Exim 4.82_3-c0e5623) for wg-camlp4@lists.ocaml.org
 (return-path <mmatalka@gmail.com>); Tue, 06 May 2014 11:42:19 +0100
Received: by mail-qc0-f169.google.com with SMTP id e16so6647785qcx.0
 for <wg-camlp4@lists.ocaml.org>; Tue, 06 May 2014 03:42:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:date:message-id:subject:from:to
 :cc:content-type;
 bh=9c1whzu7KsNLxxyTQgV10i+Nbx+3LM5iptkcQ/C1DHo=;
 b=bsIkHUK1SRbghtIZI7bNHnsxrorcv0KryQge0b/fhJq5Hv7enGqbjipc42NpP41rDr
 fkO6+TX52rPvr6fYJRjNzpS4tsZ+iSfReeS70v5AQxPEhSy2y30uZ6+QDspQHA1xcEVV
 SzGA0FbSsYl8erpL/+/JeHRUzAQtIwywnWVtqHTdFCuiOrXk3THoZTyQ/qbWrtAihctJ
 eQteYnmFHkGGqkMeNsSXEpIPaaIwRnspKioIIZ5KFeYi1HiFCT2bssxpZ3+8zKOL8PnT
 yOifbrguNJuTPbPUZFhSbopOjarNdQgH70XKlTF/2YC1hwqQ9xp1lVpBZGuyjeox0Rsx
 9a0A==
MIME-Version: 1.0
X-Received: by 10.229.220.197 with SMTP id hz5mr48751259qcb.9.1399372926073;
 Tue, 06 May 2014 03:42:06 -0700 (PDT)
Received: by 10.140.38.147 with HTTP; Tue, 6 May 2014 03:42:05 -0700 (PDT)
Received: by 10.140.38.147 with HTTP; Tue, 6 May 2014 03:42:05 -0700 (PDT)
In-Reply-To: <53686514.8070200@frisch.fr>
References: <6232dace806569a16f7fbfaa1689ef42@whitequark.org>
 <53686514.8070200@frisch.fr>
Date: Tue, 6 May 2014 12:42:05 +0200
Message-ID: <CAKziXDWNkdrQ_9H+LvyOzBVeVR526idMR6eYK+rAgubFBaYVcQ@mail.gmail.com>
From: Malcolm Matalka <mmatalka@gmail.com>
To: Alain Frisch <alain@frisch.fr>
Content-Type: multipart/alternative; boundary=001a11346f6a2b01dc04f8b8e6fa
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Peter Zotov <whitequark@whitequark.org>, caml-list <caml-list@inria.fr>
Subject: Re: [wg-camlp4] [Caml-list] [ANN] ppx_protobuf
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 06 May 2014 10:12:32 -0000

--001a11346f6a2b01dc04f8b8e6fa
Content-Type: text/plain; charset=UTF-8

I think making the application of a ppx look more like a functor
application solves the name spacing issue for the most part.
Den 6 maj 2014 06:29 skrev "Alain Frisch" <alain@frisch.fr>:

> On 5/2/2014 4:29 PM, Peter Zotov wrote:
>
>> I have just released the first version of ppx_protobuf, a complete
>> Protocol Buffers implementation.
>>
>
> This is a very cool project, and a good first public use of extension
> points!
>
> An aspect of attributes that is not fully settled is how to use
> namespacing in order to ensure that multiple tools interact nicely.
> This topic will hopefully be explored by the community to reach a good
> consensus.
>
> For instance, ppx_protobuf relies on attributes with quite generic names
> such as @default or @key, that might also be useful to other tools.  It
> might very well be the case that the same @default attribute (with the same
> value) would actually be useful to both ppx_protobuf and another
> deriving-like extension.  This is good, since attributes are not designed
> to be necessarily targeted to only one specific tool.  But in some cases,
> one might want to use a different @default attribute for different tools.
>  What about supporting both a short form @default and a more qualified one
> @protobuf.default?  This should support both situations.
>
> Another point: for record fields, you interpret attributes at the toplevel
> of their type. I did not look precisely at the semantics of ppx_protobuf,
> but it seems that it might be more logical to attach them to the field
> directly (do you confirm?):
>
>   type defaults = {
>      results [@key 1] [@default 10]: int;
>   } [@@protobuf]
>
> I understand that this form is syntactically "more intrusive" in the
> non-decorated type definition.  Is it the reason to use:
>
>   type defaults = {
>      results : int [@key 1] [@default 10];
>   } [@@protobuf]
>
> ?
>
> I don't see anything wrong with doing so, although it might be worth
> supporting both forms.
>
>
> -- Alain
>
> --
> Caml-list mailing list.  Subscription management and archives:
> https://sympa.inria.fr/sympa/arc/caml-list
> Beginner's list: http://groups.yahoo.com/group/ocaml_beginners
> Bug reports: http://caml.inria.fr/bin/caml-bugs
>

--001a11346f6a2b01dc04f8b8e6fa
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<p dir=3D"ltr">I think making the application of a ppx look more like a fun=
ctor application solves the name spacing issue for the most part.</p>
<div class=3D"gmail_quote">Den 6 maj 2014 06:29 skrev &quot;Alain Frisch&qu=
ot; &lt;<a href=3D"mailto:alain@frisch.fr">alain@frisch.fr</a>&gt;:<br type=
=3D"attribution"><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8=
ex;border-left:1px #ccc solid;padding-left:1ex">
On 5/2/2014 4:29 PM, Peter Zotov wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
I have just released the first version of ppx_protobuf, a complete<br>
Protocol Buffers implementation.<br>
</blockquote>
<br>
This is a very cool project, and a good first public use of extension point=
s!<br>
<br>
An aspect of attributes that is not fully settled is how to use namespacing=
 in order to ensure that multiple tools interact nicely.<br>
This topic will hopefully be explored by the community to reach a good cons=
ensus.<br>
<br>
For instance, ppx_protobuf relies on attributes with quite generic names su=
ch as @default or @key, that might also be useful to other tools. =C2=A0It =
might very well be the case that the same @default attribute (with the same=
 value) would actually be useful to both ppx_protobuf and another deriving-=
like extension. =C2=A0This is good, since attributes are not designed to be=
 necessarily targeted to only one specific tool. =C2=A0But in some cases, o=
ne might want to use a different @default attribute for different tools. =
=C2=A0What about supporting both a short form @default and a more qualified=
 one @protobuf.default? =C2=A0This should support both situations.<br>

<br>
Another point: for record fields, you interpret attributes at the toplevel =
of their type. I did not look precisely at the semantics of ppx_protobuf, b=
ut it seems that it might be more logical to attach them to the field direc=
tly (do you confirm?):<br>

<br>
=C2=A0 type defaults =3D {<br>
=C2=A0 =C2=A0 =C2=A0results [@key 1] [@default 10]: int;<br>
=C2=A0 } [@@protobuf]<br>
<br>
I understand that this form is syntactically &quot;more intrusive&quot; in =
the non-decorated type definition. =C2=A0Is it the reason to use:<br>
<br>
=C2=A0 type defaults =3D {<br>
=C2=A0 =C2=A0 =C2=A0results : int [@key 1] [@default 10];<br>
=C2=A0 } [@@protobuf]<br>
<br>
?<br>
<br>
I don&#39;t see anything wrong with doing so, although it might be worth su=
pporting both forms.<br>
<br>
<br>
-- Alain<br>
<br>
-- <br>
Caml-list mailing list. =C2=A0Subscription management and archives:<br>
<a href=3D"https://sympa.inria.fr/sympa/arc/caml-list" target=3D"_blank">ht=
tps://sympa.inria.fr/sympa/<u></u>arc/caml-list</a><br>
Beginner&#39;s list: <a href=3D"http://groups.yahoo.com/group/ocaml_beginne=
rs" target=3D"_blank">http://groups.yahoo.com/group/<u></u>ocaml_beginners<=
/a><br>
Bug reports: <a href=3D"http://caml.inria.fr/bin/caml-bugs" target=3D"_blan=
k">http://caml.inria.fr/bin/caml-<u></u>bugs</a><br>
</blockquote></div>

--001a11346f6a2b01dc04f8b8e6fa--

From lpw25@cam.ac.uk  Tue May  6 13:17:57 2014
Return-Path: <lpw25@cam.ac.uk>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-41.csi.cam.ac.uk (ppsw-41.csi.cam.ac.uk [131.111.8.141])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 0EBC23C293
 for <wg-camlp4@lists.ocaml.org>; Tue,  6 May 2014 13:17:57 +0100 (BST)
X-Cam-AntiVirus: no malware found
X-Cam-ScannerInfo: http://www.cam.ac.uk/cs/email/scanner/
Received: from host81-153-161-113.range81-153.btcentralplus.com
 ([81.153.161.113]:33462 helo=netbook)
 by ppsw-41.csi.cam.ac.uk (smtp.hermes.cam.ac.uk [131.111.8.157]:587)
 with esmtpsa (PLAIN:lpw25) (TLSv1.2:DHE-RSA-AES128-SHA:128)
 id 1Wheme-0006kq-RY (Exim 4.82_3-c0e5623)
 (return-path <lpw25@cam.ac.uk>); Tue, 06 May 2014 13:47:44 +0100
From: Leo White <lpw25@cam.ac.uk>
To: Alain Frisch <alain@frisch.fr>
References: <534BFC5F.9030509@lexifi.com>
 <CAPFanBG0nQMU+aFusmUPnvxiiLonOrn2f0aqy0LiTQk=-QzhZg@mail.gmail.com>
 <1397580874.77042.YahooMailNeo@web121701.mail.ne1.yahoo.com>
 <53686A73.3070403@frisch.fr>
X-Face: "XWxb[u_Z\PA_Y?9@|IA!!+jTb(/290-*ea/Un$I0B98.$n%eL.;
 2w<l)q>*,z]WR#T:,p[
 NBd++M7l]#7zj7!{<NUTKJA{}Ox<uO[wb-s<\6jzp.r]-AE[W%E+ckCQ'2WZS@Zu/PJU$~~oy|>~iw
 $W-"/=|dVjhT[D{4~gE}gK<2`.6fs!;uqqud]vs2N/3^m7{aS1V,
Date: Tue, 06 May 2014 13:47:43 +0100
In-Reply-To: <53686A73.3070403@frisch.fr> (Alain Frisch's message of "Tue, 06
 May 2014 06:52:03 +0200")
Message-ID: <86a9av13bk.fsf@cam.ac.uk>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.4 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>,
 Caml-Devel <caml-devel@yquem.inria.fr>
Subject: Re: [wg-camlp4] [Caml-devel]   Built-in attributes
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 06 May 2014 12:17:57 -0000

> If we apply this to OCaml, we would support both @@ocaml.deprecated and @@deprecated.
>
> Opinions?
>

Very good idea.

Regards,

Leo

From whitequark@whitequark.org  Thu May 15 14:13:48 2014
Return-Path: <whitequark@whitequark.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 6F85E3C250
 for <wg-camlp4@lists.ocaml.org>; Thu, 15 May 2014 14:13:48 +0100 (BST)
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1588424 
 * -0.7 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from fehu.whitequark.org ([176.58.103.125]:32937
 helo=mail.whitequark.org)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1Wkvx4-0001dE-ZP (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <whitequark@whitequark.org>); Thu, 15 May 2014 14:44:06 +0100
Received: by mail.whitequark.org (Postfix, from userid 33)
 id D080E4E5A4; Thu, 15 May 2014 13:44:01 +0000 (UTC)
To: Gerd Stolpmann <info@gerd-stolpmann.de>
X-PHP-Originating-Script: 1000:rcube.php
MIME-Version: 1.0
Content-Type: text/plain; charset=US-ASCII;
 format=flowed
Content-Transfer-Encoding: 7bit
Date: Thu, 15 May 2014 17:44:01 +0400
From: Peter Zotov <whitequark@whitequark.org>
In-Reply-To: <1399919898.3512.24.camel@e130>
References: <655b5045f95df522f800feccdc5e5a2c@whitequark.org>
 <1399919898.3512.24.camel@e130>
Message-ID: <e453a94676f28b1ae543c2df07da2bba@whitequark.org>
X-Sender: whitequark@whitequark.org
User-Agent: Roundcube Webmail/1.0.1
Cc: wg-camlp4@lists.ocaml.org, sylvain@le-gall.net
Subject: Re: [wg-camlp4] ocamlfind and -ppx option
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 15 May 2014 13:13:48 -0000

On 2014-05-12 22:38, Gerd Stolpmann wrote:
> I think the user should simply invoke a ppx with
> 
> ocamlfind ... -syntax ppx_tools ...
> 
> (maybe with a subpackage ppx_tools.ppx_metaquot if there are several
> commands in the same package), just in the same way as it is currently
> possible with camlp4. findlib would have to figure out what to do. For
> constructing the -pp switch findlib is looking for a
> 
> preprocessor = ...
> 
> setting in the package or some ancestor. Similarly, it could look for a
> 
> ppx = ...
> 
> setting to construct the -ppx switch.

There is a valid point against that solution. Currently, the idiom for
invoking camlp4 extensions is to pass "-package foo.syntax", which
would internally specify the correct options to the camlp4 invocation.

As such, both the users and the tooling expect that it is possible to
fully activate an extension by passing a single -package option, which
would then require all the necessary components and pass all the flags.

In particular, OASIS makes it very convenient to pass -package options
(the BuildDepends: field), but not -syntax ones (you have to use both
ByteOpt: and NativeOpt: fields).

In addition, it's much more user-friendly if you consider the toplevel:
a single #require "package.syntax";; is much better than a disparate 
combo
of #require and #syntax.

This also avoids the need to disambiguate -syntax for camlp4 and ppx
extensions, and is simpler conceptually.

I have implemented this solution in a patchset:

1. Do not install safe_camlp4 if configured without it
https://github.com/whitequark/ocaml-findlib/commit/26d24392738c0232893115977b0c6b165dd89acb.diff
2. Interpret ppx directive in META files
https://github.com/whitequark/ocaml-findlib/commit/7862f3c7047376d6fa8cebfecadf71adc8b3d8e7.diff
3. Topfind support for ppx directive
https://github.com/whitequark/ocaml-findlib/commit/e45dd0a19b15d4697f15addae44a0f37802004b3.diff

Additionally, I have implemented a -ppxopt option, whose job is similar
to -ppopt: it passes additional arguments to ppx preprocessors. The 
syntax
is -ppxopt pkg,opt1,opt2,...:
https://github.com/whitequark/ocaml-findlib/commit/a24d53c04610efe204c7e9461d3b60e63b2d65de.diff

-- 
Peter Zotov
sip:whitequark@sipnet.ru


From bounce@ebr-catalog.com  Wed Apr 22 13:14:04 2015
Return-Path: <bounce@ebr-catalog.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-40.csi.cam.ac.uk (ppsw-40.csi.cam.ac.uk [131.111.8.140])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 5A0193C02D
 for <wg-camlp4@lists.ocaml.org>; Wed, 22 Apr 2015 13:14:04 +0100 (BST)
X-Cam-SpamScore: sssss
X-Cam-SpamDetails: score 5.3 from SpamAssassin-3.3.2-1675065 
 *   60 CLAMAV ClamAV detected the following pattern
 * [Sanesecurity.Spam.12011.Pdf.BReg(5b43b3cd4bbca90cf547c2eaf4c61f4f:11657)]
 *  -56 CLAMAV_SANESECURITY Matches signature from Sanesecurity
 *  0.0 T_OBFU_PDF_ATTACH BODY: PDF attachment with generic MIME type
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [198.8.81.194] (port=35223 helo=ebrguide.net)
 by ppsw-40.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtp id 1YktaB-0007Cy-k1 (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <bounce@ebr-catalog.com>); Wed, 22 Apr 2015 13:16:52 +0100
Received: (qmail 1285 invoked by uid 0); 22 Apr 2015 08:02:03 -0400
Date: Wed, 22 Apr 2015 14:02:03 +0200
To: wg-camlp4@lists.ocaml.org
From: EU Business Register <register@ebr-catalog.com>
Message-ID: <970e92044f4a91bc9e066facf995ebc0@localhost.localdomain>
X-Priority: 3
X-Mailer: PHPMailer 5.1 (phpmailer.sourceforge.net)
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="b1_970e92044f4a91bc9e066facf995ebc0"
Subject: [wg-camlp4] Business Register 2015/2016
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
Reply-To: EU Business Register <register@ebr-catalog.com>
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 22 Apr 2015 12:14:04 -0000


--b1_970e92044f4a91bc9e066facf995ebc0
Content-Type: text/plain; charset = "iso-8859-1"
Content-Transfer-Encoding: 8bit

Madam/Sir,

In order to have your company inserted in our Register for 2015/2016 print, complete and submit the attached form (PDF) to the following address:

EU BUSINESS REGISTER
PO BOX 3079
3502 GB UTRECHT
THE NETHERLANDS

Fax: 0031 205 248107

You can also attach the completed form in a reply to this email.

Updating is free of charge!

--b1_970e92044f4a91bc9e066facf995ebc0
Content-Type: application/octet-stream; name="EBR-form.pdf"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="EBR-form.pdf"

JVBERi0xLjQNCiWhs8XXDQoxIDAgb2JqDQo8PC9UeXBlIC9DYXRhbG9nIC9QYWdlcyA0IDAgUiA+
PmVuZG9iag0KDQozIDAgb2JqDQo8PC9Qcm9kdWNlciAoUERGIEVkaXRvciABIC0gRm94aXQgU29m
dHdhcmUpL0F1dGhvciAoVGVzdCkvQ3JlYXRpb25EYXRlIChEOjIwMTAwNzE0MTE1NjM5KS9Nb2RE
YXRlIChEOjIwMTAwNzE0MTE1NjM5KT4+ZW5kb2JqDQoNCjQgMCBvYmoNCjw8L1R5cGUgL1BhZ2Vz
IC9LaWRzIDUgMCBSIC9Db3VudCAxID4+ZW5kb2JqDQoNCjUgMCBvYmoNCls2IDAgUiBdZW5kb2Jq
DQoNCjYgMCBvYmoNCjw8L1R5cGUgL1BhZ2UgL1BhcmVudCA0IDAgUiAvTWVkaWFCb3ggWzAgMCA1
OTUgODQyIF0vQ3JvcEJveCBbMCAwIDU5NSA4NDIgXS9SZXNvdXJjZXMgPDwvRm9udCA8PC9GWEYx
IDcgMCBSIC9GWEYyIDExIDAgUiAvRlhGMyAxMiAwIFIgPj4vQ29sb3JTcGFjZSA8PC9GWEMxIDgg
MCBSIC9GWEMyIDkgMCBSID4+Pj4vQ29udGVudHMgMTAgMCBSID4+ZW5kb2JqDQoNCjcgMCBvYmoN
Cjw8L1R5cGUgL0ZvbnQgL1N1YnR5cGUgL1R5cGUxIC9CYXNlRm9udCAvSGVsdmV0aWNhIC9FbmNv
ZGluZyAvV2luQW5zaUVuY29kaW5nID4+ZW5kb2JqDQoNCjggMCBvYmoNClsvU2VwYXJhdGlvbiAv
UEFOVE9ORSMyMDEzMCMyMEMgL0RldmljZUNNWUsgPDwvUmFuZ2UgWzAgMSAwIDEgMCAxIDAgMSBd
L04gMSAvRG9tYWluIFswIDEgXS9GdW5jdGlvblR5cGUgMiAvQzAgWzAgMCAwIDAgXS9DMSBbMCAw
LjMwMDAwMyAxIDAgXT4+XWVuZG9iag0KDQo5IDAgb2JqDQpbL1NlcGFyYXRpb24gL1BBTlRPTkUj
MjAyODcjMjBDIC9EZXZpY2VSR0IgPDwvUmFuZ2UgWzAgMSAwIDEgMCAxIF0vTiAxIC9Eb21haW4g
WzAgMSBdL0Z1bmN0aW9uVHlwZSAyIC9DMCBbMSAxIDEgXS9DMSBbMCAwLjMyNDE4OCAwLjYwNzg2
NCBdPj5dZW5kb2JqDQoNCjEwIDAgb2JqDQo8PC9MZW5ndGggNTg5NiAvRmlsdGVyIC9GbGF0ZURl
Y29kZSA+PnN0cmVhbQ0KeJztXdtyGzl6vvdT4HK3IvY0To1u3VFkS+JEFhWSsuzK5oIj0TYzFKWQ
1DjOY2T3XfJ6+X4AfSQoUbY1u1uacpXVPxrAfz4A3Q3+dPy+x9n1mnG2vl6yn/qz3+bXs5PV9Cvr
jVnMxr1z3Jqz/8L/Mf5xJnUWJUYxk5pIiYxd39obt286IpJc4nLxphNHKslYh6OHIphHXAKWUSJT
wHFkEsHsgASgiBKdVHd5lKW1wTJKgSa2N7SwF268iATnBFEb+/xGxVGqOOO4KwQIkmmkZQkv6L4E
4VkkMkIjs8jEhpkoTiXd5VESK5ZGKtYEykihW3lXgIq0HKsUZFCfGqwkNdDNxUWUSekw1yiztMpI
4JZj4ZbGK2NYHMWx788TVYECF4mTiJtdgi8rL+NIpbmsOElgSkdcZLX7Ctrg1fAkkpi2nFxGWVaH
KrqIUAnxm4QJEXFuSKgSFynjWZTFpDsJ1iDFCoYyFWDI0QpOQpsQOk8ikRAxfj5uIg0lA9aRIUmW
90E8ia4cn0SZ0rX5IXkpanCDPqIYI5V0HVIQnMD0VAEu3hiQo9302oISzRY7UQP9EnIQl5GoOOwW
YqHbRBv0pyCccjD0K4j2Ym78TeoQzVUQ1iTLmkAUw6I6ZBSGzJVHhlcw2b0mrwASninrJal1C2iT
rF5FBgLqcAkLpfmTKAFR5e0kirmojTZRqnVtdh1pJWuwnw4ukziwThyRC1Fwb+KSvJ2DPVHA5JKJ
SuAf0rk/pFa4DoeCeOlX0qq7uAdj8mMUXCWtpoMVFa5bzVH6U4MWIk5wGyQEFAVl376B1Mm8BLFh
ZYfpY16DIbVEknLITy1sACJAWFkW00ElVpWkNandfds9tuPK4bAIQ9OV0/MohtjqcI08Ivjjm39j
PyH2iir2tsKsgSdCoSZLQbqpwiz931EQPiePJ51qqJbcm6hFLIco0YjgZ5xH1yBpfbFjfUyS/CgI
GzABMsowSqTV6ECYF4htJtOR0i06XIiGF0A20KtmEvOQlnDZERQjSZoUiIhahAZHUqsBZGgiJKV5
YA1keBjMYU9NqloS+sel7B9FdyaFwWorIY2g2ZKQNiScBKyBa8RQWKsmGhBCDMRjOdU2DDYbMsoj
HRgzRRZuSVSR1FbCNQhTw6c6SBCCnJyyaQd+lsGD/hmMzZdCvbcf/pV8NPb/Ap6qbGhVGSZBSqrR
3JE29pOmOak6SVJG/2cFcP1GaFhAJosGhAqUVzEvu4uE24hcTOXBmIb6awkjsDG7aFAUtBFt/ExI
6ZTRPSIHXb9xdDiIwi2R6KC4mCAupn7U1mNiP/kO9gVya419mKzSFfsoL7KkYt+Bjn13XWPfNZTs
u5kq9gnR97P/aNTWBq7CNf7C+pHN29JInd97cWStP9eooRMQQQbqWhbUkqA2LHuiTkFS4dV0Ho7d
aAcgOkhbGlct0hbrxWxcR9YdPTYHYgKHxIE02tLqwLiYIy6mf8wsROYEASFAqPJbBaG2BCFbklAt
Sai6JJRN2XVJoKUhCbKMmiiUB0tRiKYohBeFKEQhQqJoh44ooUEIUJr+l1RtI5TX1lu2J623wj1p
EYa4hYrpC1PsbdvmwJiAThOE6Uxl3yBq7RcUlag1qkhVdRWIxeVcuHYixoWhukm5IYAShAIKrn64
QdSPaWHiEXi4FK6HS+l6OC4miov5K/GO6x6IVZJ+bNn6BZa6JS4ZuyqOIzlql2M63C1glQ0yEFvi
dO+k5gBQbIhyByE5wQCsXfkGBB+yVqgCARi2FGfcVt8SVW0Bk9AMamMUrUUT8Q4muaqNEgbIKFT7
OUvYI7XTuCaU+1C6t9CqLQUjlBT9zB2uYU1Jwkr0ZQvFUVoD6aoJ4RC9VL2XMMJVH8XUtQaHH/MU
TWUoLxq86/hJ4TMeo7Ui/kfK/SPlPpVy946nTUFxg7gD+9cGC3pRS0KdDPE7Vm6vyl93KMIqu51U
XsLUI446cashrm07PctykXRi2hojkhRVws8P1rhqpEUsD9KyYOhIbvNtMZkHrav5a1rM2i2BokFQ
X1cT00wFBv/X/6lnRILrKZHguJgmLhDs1uGTmU77RPfK5Tb+llpiryTIEYwzGL2WKIKofqk8A0E7
0d4z3PUuz9CJ3G74fs8ASVhAvw4N/0jPeE1ye1nPSCmFZxpFSsszUiNLz6DrjqvKS8+Q3hHs44x2
w3d7BpEkEvE6NPwDPeNVye0lPYNHCosBhdUdT7NmNaWFKasput6VM2Laims3fL9nEEma/900LNsa
5k0Ny6aGZUvDsqVhWWiYFxqWL+QZr0luL+sZCVbqKsbq2qRNzzA8KT2DrsM5Ays6Lrcbvt8z6Pmg
3N4UMg0Npw0Np20Np20Np00Nm90a1m0Ny6aGdVPDuqVh3dKwLjQsCw3rF/KM1yS3l/WMDDlD6hR/
Td0z6NlokTPc9S7P0EXOqDd8t2dYksT2Fv3vpeGtqkD+mKqg1PALVVOvSm4v6RkikkoyyY3dzGt4
RrU3paq9qYBncKG2G77fM4gkvr3H8ntpWLQ0HGdNDTcV3NJvS71eu3FWaPexvcXv8YrXIrOX9Agg
TelhQ4Lhqu4RWL+p1HuEuw57BL12IbYbnuER32QOYTeyfMT6j0D5/WZhHy5IUCFl0yxSVVpFuitM
iihJ0+2G7w6TRJDO/n4u/89aQLwqub2kXyi76OSoEbQQdb9I7KsXzjHcddgzeHvRyX/MopNICj2k
yeoaNnUFm5Z+TUu9pqndbKd207SdCHVDu7qZCXUrFepWLtRlMtReu2n6Ml7xamTWeIPj0a8Ogmb/
x4tF3/AgXKQ8ovc4Ek5vw9c3qOgVdv+WuKUGUs2stJQUFSzsztWi6I7lurKfcbA04v7qG8KFSEmV
giWxsS/7P1uVsC27E1JpUri32AtFaphITY8O9C8v2Wsui72WosH4hOBmKjD4v/5P9aJc1txr8XBc
TBMXCJ4IGU5/TpWMnsyK3QHjVUrt5dLo7+oaTdRK80igUtFxGqVS11HLNEq42+QqgfAjlSTSxZKn
3tDO4dvfcHEssZQhzPWllsJw6Zda/rrC23x6Q2QpsQU/jllpmLdJPWbZxCyKFw/89S6OUyG2G57G
axLOwBDwmpasuVaVrAkIYzZ2S3ir4QlZwzAUUqfK4kjFzR1lej/M2Yj9AkBYIQv7WU8TLDta8AmE
IrEf0lmEzWc7MHGVbeMTW2DZMbh+br+MVzwx32aQPnjh+zBYdtyHQa2QLEWYQWHkfgz6jvswiATP
7euGIQZ5GpBoiEHfcR8GU2k/TAhr0H72tg8+13EffJmJwuyhKpEB9tQWWHa04FO+yO13kEqRL/KG
L2b+FdxFBeyKAvSkbathj+gjmeKEuBUDpH+trwTCayYEG7MF7xkBJAk4bQnYfbNZCJi3FFqDy67P
iQFBlNx+zdhGKbbhsutzwoBFmbS51DUuedbksg6XXZ8TCJ4h2CCXlWD3jgVBlHEi99Wl7/qcaBAQ
rLKv3+4l2LLr/gEhyGMaFKvahsuu+4QEDKaPykM80moqC/CotuGy6z4oBe0Zmh0o06C9BlGmem8u
Fb19v8NDwhj5NqztJk0BPhXwFMrXMMrEfvS2jVJsw5S80hJ8AmWC8Jk8z0OC1lN5yJNyTYWtVHeE
nqCHBFSp7fkFe6K0G2t8B5eqkTQf5VLtnTY1R4BNd6URneztlroGPoESPhJrs4vLVLwAl8j69H1M
ECPWvPuGdF0Dn8Co6QOAXVnEyBCTwZDuu+4RX3Vi7Ne3vyNKW3TB32W6VfvQWrBcazrAFji6qn10
UWJpud2wZ/UTb/Oa2G8TK15li9caXHZ9TvUTRtnwFNkyohpcdn1O9RNAqe3RCHtxSRp9bvETxEif
R+3FZNn1OcVPECWd67Avk2ZvVRbFT5hLHlJlEGXF5Z7FzzNsR23DddvZu/gJouRxSJNBlL7rc4qf
OFQXiKAmgyiF2TeXFMVPEGNjeSCq6mYLTmrLg72LnzDKoO0Ew0CFcu/iJ4iSB8NAWJUq2VeuRfET
RtnYnXgcZbp36VwUP0GUL+IjZfET5rJRFzzhI2ZflEXx8zui9MXPM6wnaLCV9exd/OxQpQygDGfn
vdezZfHzjNgTRCn2xai0sLu69OpiKtJW8aNVVhU/BOz8qke1v+pR21/1bGOWiLNIYcCctDAbVSE2
akfRRSehyO2Gp/GmdLxLltrN8RpehOHivVt/vevtwqy+CVY0fPPLAa/tm+36QygrmB/0etlrkmPo
sV/NwJ537MPr/Gj+x9vfaxIkGeDR5I0X2+jkyJsg1iQksH1eX/np+P2xYMhVk48YkhqDlbgXJf0/
ubXyVQn8BfOZNLUvjU76//6n/JIdXY4H5/l4/Of/mPyMVJcKmSkVGI2CTCs6gCWLqAONHuUng/Ek
H9mhjgieOiIyJelp29Y0wkDpKTMZxANd0Cy9u9v76fIr6083U9a7W25Wdws3Y9C8gIazjLCEppeY
HutbQ493PY/92XTFPJIDz2WWZrEJj08ScGfoeL3McXk1Y9PVjF1jhvlivvzE5suPd6vb6WZ+t2S4
YpvPM1YTJCvEErGrmcUXRqSp8jOoUDLYECG6W93MMNsdW8zXG/b17mFlkZJsgImwDJab2Wo521i0
hPJhPV/O1uvZ+oD95wMGfZwvFh7lnPwLWqMXCgTWRVQiEpbr6ZLdTn+dOQT3qzuMmbGHe0J8M93M
2HzNfputvrIvswXQz6JyPg7Zxhm9uAXhcFizl87m83T5K01nyfJ0393PVlZE1XhkeetxFNQVd8Mn
d0Bt0Tb49WQdsPvFbLqeAZ4vNwf29mKGztPlDVvNNg+rZY26WNIJifRKiKbdIJoevM6X69mqIoR0
b0TIwgW9RJUxrDrsiTo0/Mt8/Znk8gsw/gIp4dIpn91BHVYFjuL5bI0edw8bVvOFzPtjJtzHFjV8
QidRgjKRkNExRoTMCmB6vZn/Nt9gvnIiXkwUIlykSZQlTaoj2MlOu1NRDL9IMjI7YbvPlzVxWjMj
DiPWhR6mNzdzkt10AZuB7c1xcfcxxGNqZJs0hZIYvphk7h0UwtXQcpvDFrl02BBKwgatZGubIlIh
iNlX9lssapQvRgkrkpgnXiTD5eIrW88/wSA+Wlv9Ml1uSKH3i+l10E1lnAGHsvPQuac0z+YzvMOJ
p6ReOuqpsqex1O0vf7oko7bBAv1Xsxmkxq4/T1efZn/5cz1cxo7xuTvsUJH9SgmyMyevC2f+5Naw
vFI5pSMsvh7UlTcnjg5Ll0hUpDM6dYtOV0x8xH8oowYbzT4h0sxWlYfSocCJPfE1ozMMLQnRMDoa
voc4TFZ27Njz2eyaSSEqJM6CpcYyDwnscjLKe6eTmn6NNRPG3TlYNWXJmA5QFu5Q2cxH3FpkK2k8
YEQIKyhhLVwHbHKas/Mc/4/Ouuf9ccSOu+8P2b+AfUoE9EEHIuBBPWqy8WxFCWbNzua3883sxopy
4qN5mwCbBJZ3G8h6MaXOsB0bmlef4P//49IB4h/izWa+eXDgR5ccHlYIh4hFl0vfCenodr5el1Gp
mf25/VdkO1hJkdkV51nAqSWdk0meIjJbuJMMB8sbJASEcZjNl8/z68/NAAuz/HK3+hUW+oQXWrPI
UIcIjsBtosybxfh+dj3/+JX9spourz/XTbogViQm5J7SGOueSNOIXCpk5g1Kb2ab6XyxPnyqJEh3
EA/hJJkBPjrwU7hw0K3lSI14SKtfxemYGm7vH1WGToykhk5FphO3uXTS7dUmkFLRKaUdZU/sdSG4
X7uvkkxnDkFstLuf1xFoA8unelW7CEAdjhsUxCIzmcXAVebkf1I5baQkp7NTU4GyK3EcDmquigwT
0wMXDM9oNUX3f7b387LufMY3Ka/pm6OPjeK8aXbWuOgBAXKEyNwxeCTa0z1E+8c3YN/+rcsPWSxV
idce3JYqxIfEHvlt3Rc1GAVn1j1k3U+r+fXDAvl1ugjE6gp5aRQdG1QSxJoOHasvdHPOo0P2dr4s
I++jrLjKwE5HmsiwiJQtEnuHtGhCqH+4ppxTCzxGx/bURQQegSVhc1gfVEyXDx9RcD6sCmI89XHM
BRmOG9jClx+yCWL++v5utbFJ78Bms4fl/NqC64P6VIhs0h7iSORoV9Tki9n1BkI9YCfTtc25Y2TQ
zRTJqsjI9SloEQNzVPQFv18ylsQcH7Krz3eL2XqK6hxk3czKkbyQWpD9k0MkdkostVEUHoU9wLmd
Q+hEOK4TuLku3byc6vSQHc+XyIJYrgyW6wdKiG6FMpqhXM7XENPOdaChL6sM2T6tPHlz5sFhQCCO
L+XyiZAtYn4+ZBcPvyzm16x7cwsrg11MS7N4OntinU9HH6QGkc3YBzA7cn21vqR3Feuk7Oxs1eHz
oPeJXX19J78w2tGrI4r1KGRni8hH0ZM3iKY1PNq37Tm7qKjsLK68c0fnoE3umtiTnD4pDBfRSg26
jx9RIdPvi2hXYJ1Pb2dFNbq1BCuqDGkye+ozLrXfLOje3KxQBNc1I+kt99RVKRd36w2m2vI61ezW
u3tYohRt1DzUi47ioR1d47x6MlvM7j/fLWfNAJLyOLXn0Gvua8/j6X/XjVDbL6skhVruFxC38OzQ
LLTcEEL6nYtfaH3b5I9Wx7HUjn7jpUebUoiT7H62WtciLO1h0U+ypMJ+xmJ7zjdfazqpLe/ooHz7
gVyMste7ynDUr22eFaskyC3joc0pLAwz+lUQru0PcFiRYdEzHpycD85P2PAYa6DBmPWHvcu3+fmE
jfKLUT7G1dgujrq9Xn4x6Z73ctc1Z8fDs7PhFY3tDc/7g8lgeD5mWDzZm7Wm8aQ7yftscM7+Sncm
+eit61frczwcocM4HxH4NzY8t5Nc5UfsonuSH/oAm9A+gQgtCiB4Yk0lqFad7V1dXUX5ZbGrVm6q
9YZvI1bnGyyf5Sfds7MP7GgAetBEtJ0M3uVj9mF4aTuPBienE+K7e16RSRzRzeH5GXCwfnfSPeqO
S/GE9vQO2NXpoHfKepjnyMl0PIZs3g26dszgHJ2wDC02GlNYRohfEcEgsCSlX17waxLQ3GW9fmc0
fMuuBpNT4B8NL3JC5KkAP2D2ZNQFkv4BA8vEAWiAIVm92mFeeZNRtzcJaHH4PC1ua1CLHassrEG4
/a0etZf+3nXPBhA56WEyeFtKvSR9QGY7ynP2Ie+OHKVgYQRr9saVk05PobYPrHuMqUuLqE8TebWU
Ki8F2BpE84/yXj54B8gza2KRpknQXFH1owAW9JtN3hPrrnf0wZloPno3gF4uRsN3gz7tCA/YaT7K
cdv6PhQ+vjwa90aDC0tcqb/2wIYt+psw+0k/Yn8NmenfCNPVAAZy2n2Xt41+MmQDiLG0d2i91C5P
THDRjuBKvzzENerTIvaUynFCvhhZkkEtNZKkyYJZhqLJMdVkFcSRB11Ohm9hBT3rwPn7SX7eh27y
d/nog5uHbLJ7PqSdHdtwwC7Pz6wcLvLe4HjQY1ejwQTjGDoRBYOxVyTm2aEIVnJseCrjHRFJ219B
MfbLuTLaOiaOMMfkasjewsxOx2AEVObOKt9fDEbOrL1F1/mOKCKNrOhLEYBYsoa+l+JZ10Xony9H
g3F/0CsiVff8A+sPxheXE0gNt3zsC7H3v3CXfh/B32umNGcpRMick0jCzLMsShNfo3dPoFxnyvnk
Ks/Pw2IskkVNKuRgw3cUBEvp/9hUwnYHlkDqDSk2o4oD2bTINP2qQJ/bQ+TpB3NsjZL5BeHZ7BNK
edo+nmK5NGM/FQ+UGKr72/tQGdYRCrGdFoH0S1G0DWsrprOcPG6UTy5H4Gt4GNxrfGKzk3W2dzv/
j6EqsvudKHJZjErJ7XgGqxGs1aNE0hfuWLf7HafWjMUmxv8DyTHl8g0KZW5kc3RyZWFtIGVuZG9i
ag0KDQoxMSAwIG9iag0KPDwvVHlwZSAvRm9udCAvU3VidHlwZSAvVHlwZTEgL0Jhc2VGb250IC9I
ZWx2ZXRpY2EtQm9sZCAvRW5jb2RpbmcgL1dpbkFuc2lFbmNvZGluZyA+PmVuZG9iag0KDQoxMiAw
IG9iag0KPDwvVHlwZSAvRm9udCAvU3VidHlwZSAvVHlwZTEgL0Jhc2VGb250IC9IZWx2ZXRpY2Et
Qm9sZE9ibGlxdWUgL0VuY29kaW5nIC9XaW5BbnNpRW5jb2RpbmcgPj5lbmRvYmoNCg0KeHJlZg0K
MCAxMw0KMDAwMDAwMDAwMCA2NTUzNiBmDQowMDAwMDAwMDE3IDAwMDAwIG4NCjAwMDAwMDAwMDAg
MDAwMDAgZg0KMDAwMDAwMDA2OCAwMDAwMCBuDQowMDAwMDAwMjA1IDAwMDAwIG4NCjAwMDAwMDAy
NjIgMDAwMDAgbg0KMDAwMDAwMDI4OSAwMDAwMCBuDQowMDAwMDAwNTA1IDAwMDAwIG4NCjAwMDAw
MDA2MDQgMDAwMDAgbg0KMDAwMDAwMDc2NyAwMDAwMCBuDQowMDAwMDAwOTI4IDAwMDAwIG4NCjAw
MDAwMDY5MDIgMDAwMDAgbg0KMDAwMDAwNzAwNyAwMDAwMCBuDQp0cmFpbGVyDQo8PC9TaXplIDEz
IC9Sb290IDEgMCBSIC9JbmZvIDMgMCBSID4+DQpzdGFydHhyZWYNCjcxMTkNCiUlRU9GDQo=


--b1_970e92044f4a91bc9e066facf995ebc0--

From n.oje.bar@gmail.com  Wed Apr 22 17:33:28 2015
Return-Path: <n.oje.bar@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-40.csi.cam.ac.uk (ppsw-40.csi.cam.ac.uk [131.111.8.140])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 24DF33C02D
 for <wg-camlp4@lists.ocaml.org>; Wed, 22 Apr 2015 17:33:28 +0100 (BST)
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1675065 
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (n.oje.bar[at]gmail.com)
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.212.177 listed in list.dnswl.dnsbl.ja.net]
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-wi0-f177.google.com ([209.85.212.177]:38643)
 by ppsw-40.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with esmtps (TLSv1.2:AES128-GCM-SHA256:128)
 id 1YkxdD-0006k6-mJ (Exim 4.82_3-c0e5623) for wg-camlp4@lists.ocaml.org
 (return-path <n.oje.bar@gmail.com>); Wed, 22 Apr 2015 17:36:17 +0100
Received: by wiun10 with SMTP id n10so63931385wiu.1
 for <wg-camlp4@lists.ocaml.org>; Wed, 22 Apr 2015 09:36:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:sender:date:message-id:subject:from:to:content-type;
 bh=CsXl/7gNgufqwgW+94nIWBE1EMAKCvY6zGCLH637Cmg=;
 b=j/8irouHO24Yz6MOaM9a72Gx1kAH1+CK7oUM+L40l14597R5d5w8C9mDyGOCyXqixL
 uPBlmm3IuQU08NK7zmviHtw+tMRRjoC8uPBnvflWglWCG8LQS0wnF/mZ3h3IdZU1blMx
 9933hdpf2V5yxqzYEvx+nNdkc9ZS8Jmv17dNJQrRMfEgkHDV2FS7ki3Iv72SKzNeNwW/
 2N9Wm5ZiSKqGaCSXBJOEVYA/FgWMAsPblk+7ciYyWx/Rrou53roCZAtn2G57j7m9EJP5
 o7xHOzQMoDrUiR/p9d9qz86TwFiPAs4TE6ASsezbW45P+i9W0AEycwZCa+iG6dJmmhbW
 CKRQ==
MIME-Version: 1.0
X-Received: by 10.194.92.137 with SMTP id cm9mr53291133wjb.133.1429720571389; 
 Wed, 22 Apr 2015 09:36:11 -0700 (PDT)
Sender: n.oje.bar@gmail.com
Received: by 10.27.126.138 with HTTP; Wed, 22 Apr 2015 09:36:11 -0700 (PDT)
Date: Wed, 22 Apr 2015 17:36:11 +0100
X-Google-Sender-Auth: M15hB_kh5hseauTlhu0UX-t0QeI
Message-ID: <CAPunWhB=NNVApqqknL-Uyo=sX9sGXpOZ4MnwOF-utgpfeRBUAw@mail.gmail.com>
From: Nicolas Ojeda Bar <no263@dpmms.cam.ac.uk>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain; charset=UTF-8
Subject: [wg-camlp4] expressions in pattern position ?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 22 Apr 2015 16:33:28 -0000

Hi,

I am currently working on porting ocaml-bitstring to ppx.

<https://code.google.com/p/bitstring/>

The camlp4 version of this syntax extension extends the syntax to allow
expressions in "pattern" positions.  For example:

bitmatch bits with
| { <patt> : <expr> : bind <expr> } -> ...

I am considering the following concrete ppx syntax to emulate this:

match%bitstring bits with
| x, [%len <expr>], [%bind <expr>] ->

(the [%len] annotation can be skipped if the payload is a literal constant).

I find this syntax a little too heavy and am thinking about ways to improve it.

I seem to remember some time ago there was a discussion about having the parser
allow expression in pattern positions and reject those which are not
patterns during
typechecking.  I don't actually like this option, but was wondering if
there had been any
conclusions on the issue.

Another possibility would be to use the {| ... |} annotation, as in:

match%bitstring bits with
| {| x : <expr> : bind <expr> |} -> ...

The problem then is that one needs to write a parser for the thing
inside {| ... |}.  I thought
about splitting the payload on the delimiter ':' and then calling the
OCaml parser to parse
the individual subparts (here: "x", "<expr>", and "bind <expr>").

What do you think ?

Thanks!

Best wishes,
Nicolas

From gabriel.scherer@gmail.com  Wed Apr 22 17:49:43 2015
Return-Path: <gabriel.scherer@gmail.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 77F9F3C02D
 for <wg-camlp4@lists.ocaml.org>; Wed, 22 Apr 2015 17:49:43 +0100 (BST)
X-Cam-SpamDetails: score -0.7 from SpamAssassin-3.3.2-1675065 
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (gabriel.scherer[at]gmail.com)
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [209.85.223.174 listed in list.dnswl.dnsbl.ja.net]
 *  0.0 HTML_MESSAGE BODY: HTML included in message
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from mail-ie0-f174.google.com ([209.85.223.174]:36579)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtps (TLSv1.2:AES128-GCM-SHA256:128)
 id 1Ykxt1-0004ze-Yx (Exim 4.82_3-c0e5623) for wg-camlp4@lists.ocaml.org
 (return-path <gabriel.scherer@gmail.com>); Wed, 22 Apr 2015 17:52:32 +0100
Received: by iebrs15 with SMTP id rs15so42050252ieb.3
 for <wg-camlp4@lists.ocaml.org>; Wed, 22 Apr 2015 09:52:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20120113;
 h=mime-version:in-reply-to:references:from:date:message-id:subject:to
 :cc:content-type;
 bh=eQAuAC9NaN7m6H4ClQ1XtCAzshPWY2yBrQL1d0Pn3vo=;
 b=p32C6ONgm0FzkurB+02+99GjZ8SOOeNDIQN5V1B7VRpZxLK46pyNC00YVM5vpzHIh0
 V1O0VivWtD+897PZxFvUkcRb0UU5rjx+0PWOnpjM8+4cfqQM/TuxMEdJFqhZ6jCiGjQo
 JyZOwvmladIAW7Cz9Iilhsx/f6jfSfEuyRl8eO8RcoGuDA0m/4NGS9sSjjeo0FRFxgMx
 YOqTwaB25Xxe8nXrbHoLfPhsJWiZdmnAcHkKco1pcl0ILzGg8+KCNxcwixnC6EOOwrjf
 G7z2kFZmSDTsynpIQgx8dDIpFhSXSwTXokFfiJwjEI8eLrrFjel37N/SJ+hsbCTlZg2g
 dM4Q==
X-Received: by 10.50.122.39 with SMTP id lp7mr5780694igb.24.1429721550702;
 Wed, 22 Apr 2015 09:52:30 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.36.53.10 with HTTP; Wed, 22 Apr 2015 09:51:50 -0700 (PDT)
In-Reply-To: <CAPunWhB=NNVApqqknL-Uyo=sX9sGXpOZ4MnwOF-utgpfeRBUAw@mail.gmail.com>
References: <CAPunWhB=NNVApqqknL-Uyo=sX9sGXpOZ4MnwOF-utgpfeRBUAw@mail.gmail.com>
From: Gabriel Scherer <gabriel.scherer@gmail.com>
Date: Wed, 22 Apr 2015 18:51:50 +0200
Message-ID: <CAPFanBE1ijL_f+dcFfhwCZgE-1fG651c_dqSzAO_8hbh4qvq+A@mail.gmail.com>
To: Nicolas Ojeda Bar <no263@dpmms.cam.ac.uk>
Content-Type: multipart/alternative; boundary=001a11c1e532284c9f051452fd42
Cc: "wg-camlp4@lists.ocaml.org" <wg-camlp4@lists.ocaml.org>
Subject: Re: [wg-camlp4] expressions in pattern position ?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 22 Apr 2015 16:49:43 -0000

--001a11c1e532284c9f051452fd42
Content-Type: text/plain; charset=UTF-8

Another option you have is to only replace the part that cannot be patterns
by extensions:

match%bitstring bits with
| { len = [%p <expr>]; bind = [%p <expr>] } -> ...

On Wed, Apr 22, 2015 at 6:36 PM, Nicolas Ojeda Bar <no263@dpmms.cam.ac.uk>
wrote:

> Hi,
>
> I am currently working on porting ocaml-bitstring to ppx.
>
> <https://code.google.com/p/bitstring/>
>
> The camlp4 version of this syntax extension extends the syntax to allow
> expressions in "pattern" positions.  For example:
>
> bitmatch bits with
> | { <patt> : <expr> : bind <expr> } -> ...
>
> I am considering the following concrete ppx syntax to emulate this:
>
> match%bitstring bits with
> | x, [%len <expr>], [%bind <expr>] ->
>
> (the [%len] annotation can be skipped if the payload is a literal
> constant).
>
> I find this syntax a little too heavy and am thinking about ways to
> improve it.
>
> I seem to remember some time ago there was a discussion about having the
> parser
> allow expression in pattern positions and reject those which are not
> patterns during
> typechecking.  I don't actually like this option, but was wondering if
> there had been any
> conclusions on the issue.
>
> Another possibility would be to use the {| ... |} annotation, as in:
>
> match%bitstring bits with
> | {| x : <expr> : bind <expr> |} -> ...
>
> The problem then is that one needs to write a parser for the thing
> inside {| ... |}.  I thought
> about splitting the payload on the delimiter ':' and then calling the
> OCaml parser to parse
> the individual subparts (here: "x", "<expr>", and "bind <expr>").
>
> What do you think ?
>
> Thanks!
>
> Best wishes,
> Nicolas
> _______________________________________________
> wg-camlp4 mailing list
> wg-camlp4@lists.ocaml.org
> http://lists.ocaml.org/listinfo/wg-camlp4
>

--001a11c1e532284c9f051452fd42
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Another option you have is to only replace the part that c=
annot be patterns by extensions:<br><br>match%bitstring bits with<br>
| { len =3D [%p &lt;expr&gt;]; bind =3D [%p &lt;expr&gt;] } -&gt; ...<br></=
div><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">On Wed, Apr 2=
2, 2015 at 6:36 PM, Nicolas Ojeda Bar <span dir=3D"ltr">&lt;<a href=3D"mail=
to:no263@dpmms.cam.ac.uk" target=3D"_blank">no263@dpmms.cam.ac.uk</a>&gt;</=
span> wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8e=
x;border-left:1px #ccc solid;padding-left:1ex">Hi,<br>
<br>
I am currently working on porting ocaml-bitstring to ppx.<br>
<br>
&lt;<a href=3D"https://code.google.com/p/bitstring/" target=3D"_blank">http=
s://code.google.com/p/bitstring/</a>&gt;<br>
<br>
The camlp4 version of this syntax extension extends the syntax to allow<br>
expressions in &quot;pattern&quot; positions.=C2=A0 For example:<br>
<br>
bitmatch bits with<br>
| { &lt;patt&gt; : &lt;expr&gt; : bind &lt;expr&gt; } -&gt; ...<br>
<br>
I am considering the following concrete ppx syntax to emulate this:<br>
<br>
match%bitstring bits with<br>
| x, [%len &lt;expr&gt;], [%bind &lt;expr&gt;] -&gt;<br>
<br>
(the [%len] annotation can be skipped if the payload is a literal constant)=
.<br>
<br>
I find this syntax a little too heavy and am thinking about ways to improve=
 it.<br>
<br>
I seem to remember some time ago there was a discussion about having the pa=
rser<br>
allow expression in pattern positions and reject those which are not<br>
patterns during<br>
typechecking.=C2=A0 I don&#39;t actually like this option, but was wonderin=
g if<br>
there had been any<br>
conclusions on the issue.<br>
<br>
Another possibility would be to use the {| ... |} annotation, as in:<br>
<br>
match%bitstring bits with<br>
| {| x : &lt;expr&gt; : bind &lt;expr&gt; |} -&gt; ...<br>
<br>
The problem then is that one needs to write a parser for the thing<br>
inside {| ... |}.=C2=A0 I thought<br>
about splitting the payload on the delimiter &#39;:&#39; and then calling t=
he<br>
OCaml parser to parse<br>
the individual subparts (here: &quot;x&quot;, &quot;&lt;expr&gt;&quot;, and=
 &quot;bind &lt;expr&gt;&quot;).<br>
<br>
What do you think ?<br>
<br>
Thanks!<br>
<br>
Best wishes,<br>
Nicolas<br>
_______________________________________________<br>
wg-camlp4 mailing list<br>
<a href=3D"mailto:wg-camlp4@lists.ocaml.org">wg-camlp4@lists.ocaml.org</a><=
br>
<a href=3D"http://lists.ocaml.org/listinfo/wg-camlp4" target=3D"_blank">htt=
p://lists.ocaml.org/listinfo/wg-camlp4</a><br>
</blockquote></div><br></div>

--001a11c1e532284c9f051452fd42--

From ioimnad44@outlook.com  Thu Apr 23 19:14:24 2015
Return-Path: <ioimnad44@outlook.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id F02C93C1D0
 for <wg-camlp4@lists.ocaml.org>; Thu, 23 Apr 2015 19:14:23 +0100 (BST)
X-Cam-SpamScore: ssssssss
X-Cam-SpamDetails: score 8.8 from SpamAssassin-3.3.2-1675274 
 *  1.3 RCVD_IN_RP_RNBL RBL: Relay in RNBL,
 *      https://senderscore.org/blacklistlookup/
 *      [115.221.57.58 listed in bl.score.senderscore.com]
 *  2.7 RCVD_IN_PSBL RBL: Received via a relay in PSBL
 *      [115.221.57.58 listed in psbl.surriel.com]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (ioimnad44[at]outlook.com)
 *  0.2 FREEMAIL_ENVFROM_END_DIGIT Envelope-from freemail username ends in
 *      digit (ioimnad44[at]outlook.com)
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  1.1 MIME_HTML_ONLY BODY: Message only has text/html MIME parts
 *  0.6 HTML_MIME_NO_HTML_TAG HTML-only message, but there is no HTML tag
 *  0.1 MISSING_MID Missing Message-Id: header
 *  0.0 LOTS_OF_MONEY Huge... sums of money
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
 *  1.4 MISSING_DATE Missing Date: header
 *  0.0 TO_NO_BRKTS_NORDNS_HTML To: misformatted and no rDNS and HTML only
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [115.221.57.58] (port=1101 helo=xcxcxc44.jnhgb.ws)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with smtp id 1YlLgU-0006nB-sG (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <ioimnad44@outlook.com>); Thu, 23 Apr 2015 19:17:16 +0100
From: "Felecia Hampton" <nbennett@unm.edu>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/html;
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] marketing secrets!
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
Date: Thu, 23 Apr 2015 18:14:24 -0000
X-List-Received-Date: Thu, 23 Apr 2015 18:14:24 -0000



<body>

<p><font size=3D"2" face=3D"Arial">please do not reply directly.&nbsp;<br>=

<br>
if you want to contact us,  please send us an email at <a href=3D"mailto:x=
ianmei49413@163.com">  xianmei49413@163.com</a>&nbsp;<br>
<br>
Hi,<br>
<br>
This is Elizabeth from Bulker Mania. All these years, I have seen thousand=
s of companies growing using the most powerful marketing tool "Email Marke=
ting"!<br> 
<br> 
We at Bulker Mania can help your business reach the next level, we have he=
lped hundred's of businesses go viral and also increase their client base =
within 30 days.<br> 
<br> 
What we Provide:<br> 
<br> 
We can send unlimited email campaigns for you all over the world<br> 
We can send out newsletter's on your behalf to promote your business.<br> =

We can send out Millions of emails for you.<br> 
We have High Quality data! We use our updated database to promote your bus=
iness.<br> 
<br> 
Advertise your business using the most powerful tool's in the market and s=
ee the difference it makes"<br> 
<br> 
What we require:<br> 
<br> 
Subject Line<br> 
Your Email Message or the Newsletter<br> 
<br> 
Sit back, relax and watch the clients coming in and your business grow!!!<=
br> 
<br> 
Basic Pricing:<br> 
<br> 
2 Million bulk emails only for $399<br> 
10 Million bulk emails only for $999<br> 
<br> 
please do not reply directly, For a custom package or more information ple=
ase send us an email at 
<a href=3D"mailto:xianmei49413@163.com">xianmei49413@163.com</a> .<br>
<br>
please do not reply directly.&nbsp;<br>
<br>
if you want to contact us,  please send us an email at <a href=3D"mailto:x=
ianmei49413@163.com">xianmei49413@163.com</a> 
<br>
<br>
<br>
Yours Truly<br> 
<br> 
</font></p> 
 
</body> 
 





From bounce@eu-catalog.org  Mon Apr 27 14:09:54 2015
Return-Path: <bounce@eu-catalog.org>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id C4CDA3C4CF
 for <wg-camlp4@lists.ocaml.org>; Mon, 27 Apr 2015 14:09:54 +0100 (BST)
X-Cam-SpamScore: sssss
X-Cam-SpamDetails: score 5.3 from SpamAssassin-3.3.2-1675274 
 *   60 CLAMAV ClamAV detected the following pattern
 * [Sanesecurity.Spam.12011.Pdf.BReg(13cec4585088bdd5b13964617f266caa:11658)]
 *  -56 CLAMAV_SANESECURITY Matches signature from Sanesecurity
 *  0.0 T_OBFU_PDF_ATTACH BODY: PDF attachment with generic MIME type
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [107.189.37.163] (port=50336 helo=eu-catalog.org)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtp id 1YmiqE-0005sb-YH (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <bounce@eu-catalog.org>); Mon, 27 Apr 2015 14:13:00 +0100
Received: (qmail 17229 invoked by uid 0); 27 Apr 2015 09:12:27 -0400
Date: Mon, 27 Apr 2015 15:12:27 +0200
To: wg-camlp4@lists.ocaml.org
From: EU Business Register <register@eu-catalog.org>
Message-ID: <1571b22466c33bb9cc81c3a152e040f1@localhost.localdomain>
X-Priority: 3
X-Mailer: PHPMailer 5.1 (phpmailer.sourceforge.net)
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary="b1_1571b22466c33bb9cc81c3a152e040f1"
Subject: [wg-camlp4] Business Register 2015/2016
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
Reply-To: EU Business Register <register@eu-catalog.org>
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 27 Apr 2015 13:09:54 -0000


--b1_1571b22466c33bb9cc81c3a152e040f1
Content-Type: text/plain; charset = "iso-8859-1"
Content-Transfer-Encoding: 8bit

Madam/Sir,

In order to have your company inserted in our Register for 2015/2016 print, complete and submit the attached form (PDF) to the following address:

EU BUSINESS REGISTER
PO BOX 3079
3502 GB UTRECHT
THE NETHERLANDS

Fax: 0031 205 248107

You can also attach the completed form in a reply to this email.

Updating is free of charge!

--b1_1571b22466c33bb9cc81c3a152e040f1
Content-Type: application/octet-stream; name="EBR-form.pdf"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="EBR-form.pdf"

JVBERi0xLjQNCiWhs8XXDQoxIDAgb2JqDQo8PC9UeXBlIC9DYXRhbG9nIC9QYWdlcyA0IDAgUiA+
PmVuZG9iag0KDQozIDAgb2JqDQo8PC9Qcm9kdWNlciAoUERGIEVkaXRvciABIC0gRm94aXQgU29m
dHdhcmUpL0F1dGhvciAoVGVzdCkvQ3JlYXRpb25EYXRlIChEOjIwMTAwNzE0MTE1NjM5KS9Nb2RE
YXRlIChEOjIwMTAwNzE0MTE1NjM5KT4+ZW5kb2JqDQoNCjQgMCBvYmoNCjw8L1R5cGUgL1BhZ2Vz
IC9LaWRzIDUgMCBSIC9Db3VudCAxID4+ZW5kb2JqDQoNCjUgMCBvYmoNCls2IDAgUiBdZW5kb2Jq
DQoNCjYgMCBvYmoNCjw8L1R5cGUgL1BhZ2UgL1BhcmVudCA0IDAgUiAvTWVkaWFCb3ggWzAgMCA1
OTUgODQyIF0vQ3JvcEJveCBbMCAwIDU5NSA4NDIgXS9SZXNvdXJjZXMgPDwvRm9udCA8PC9GWEYx
IDcgMCBSIC9GWEYyIDExIDAgUiAvRlhGMyAxMiAwIFIgPj4vQ29sb3JTcGFjZSA8PC9GWEMxIDgg
MCBSIC9GWEMyIDkgMCBSID4+Pj4vQ29udGVudHMgMTAgMCBSID4+ZW5kb2JqDQoNCjcgMCBvYmoN
Cjw8L1R5cGUgL0ZvbnQgL1N1YnR5cGUgL1R5cGUxIC9CYXNlRm9udCAvSGVsdmV0aWNhIC9FbmNv
ZGluZyAvV2luQW5zaUVuY29kaW5nID4+ZW5kb2JqDQoNCjggMCBvYmoNClsvU2VwYXJhdGlvbiAv
UEFOVE9ORSMyMDEzMCMyMEMgL0RldmljZUNNWUsgPDwvUmFuZ2UgWzAgMSAwIDEgMCAxIDAgMSBd
L04gMSAvRG9tYWluIFswIDEgXS9GdW5jdGlvblR5cGUgMiAvQzAgWzAgMCAwIDAgXS9DMSBbMCAw
LjMwMDAwMyAxIDAgXT4+XWVuZG9iag0KDQo5IDAgb2JqDQpbL1NlcGFyYXRpb24gL1BBTlRPTkUj
MjAyODcjMjBDIC9EZXZpY2VSR0IgPDwvUmFuZ2UgWzAgMSAwIDEgMCAxIF0vTiAxIC9Eb21haW4g
WzAgMSBdL0Z1bmN0aW9uVHlwZSAyIC9DMCBbMSAxIDEgXS9DMSBbMCAwLjMyNDE4OCAwLjYwNzg2
NCBdPj5dZW5kb2JqDQoNCjEwIDAgb2JqDQo8PC9MZW5ndGggNTg5NSAvRmlsdGVyIC9GbGF0ZURl
Y29kZSA+PnN0cmVhbQ0KeJztXdtyGzl6vvdT4HK3IvY0To1u3VFkS+JEFhWSsuzK5oIj0TYzFKWQ
1DjOY2T3XfJ6+X4AfSQoUbY1u1uacpXVPxrAfz4A3Q3+dPy+x9n1mnG2vl6yn/qz3+bXs5PV9Cvr
jVnMxr1z3Jqz/8L/Mf5xJnUWJUYxk5pIiYxd39obt286IpJc4nLxphNHKslYh6OHIphHXAKWUSJT
wHFkEsHsgASgiBKdVHd5lKW1wTJKgSa2N7SwF268iATnBFEb+/xGxVGqOOO4KwQIkmmkZQkv6L4E
4VkkMkIjs8jEhpkoTiXd5VESK5ZGKtYEykihW3lXgIq0HKsUZFCfGqwkNdDNxUWUSekw1yiztMpI
4JZj4ZbGK2NYHMWx788TVYECF4mTiJtdgi8rL+NIpbmsOElgSkdcZLX7Ctrg1fAkkpi2nFxGWVaH
KrqIUAnxm4QJEXFuSKgSFynjWZTFpDsJ1iDFCoYyFWDI0QpOQpsQOk8ikRAxfj5uIg0lA9aRIUmW
90E8ia4cn0SZ0rX5IXkpanCDPqIYI5V0HVIQnMD0VAEu3hiQo9302oISzRY7UQP9EnIQl5GoOOwW
YqHbRBv0pyCccjD0K4j2Ym78TeoQzVUQ1iTLmkAUw6I6ZBSGzJVHhlcw2b0mrwASninrJal1C2iT
rF5FBgLqcAkLpfmTKAFR5e0kirmojTZRqnVtdh1pJWuwnw4ukziwThyRC1Fwb+KSvJ2DPVHA5JKJ
SuAf0rk/pFa4DoeCeOlX0qq7uAdj8mMUXCWtpoMVFa5bzVH6U4MWIk5wGyQEFAVl376B1Mm8BLFh
ZYfpY16DIbVEknLITy1sACJAWFkW00ElVpWkNandfds9tuPK4bAIQ9OV0/MohtjqcI08Ivjjm39j
PyH2iir2tsKsgSdCoSZLQbqpwiz931EQPiePJ51qqJbcm6hFLIco0YjgZ5xH1yBpfbFjfUyS/CgI
GzABMsowSqTV6ECYF4htJtOR0i06XIiGF0A20KtmEvOQlnDZERQjSZoUiIhahAZHUqsBZGgiJKV5
YA1keBjMYU9NqloS+sel7B9FdyaFwWorIY2g2ZKQNiScBKyBa8RQWKsmGhBCDMRjOdU2DDYbMsoj
HRgzRRZuSVSR1FbCNQhTw6c6SBCCnJyyaQd+lsGD/hmMzZdCvbcf/pV8NPb/Ap6qbGhVGSZBSqrR
3JE29pOmOak6SVJG/2cFcP1GaFhAJosGhAqUVzEvu4uE24hcTOXBmIb6awkjsDG7aFAUtBFt/ExI
6ZTRPSIHXb9xdDiIwi2R6KC4mCAupn7U1mNiP/kO9gVya419mKzSFfsoL7KkYt+Bjn13XWPfNZTs
u5kq9gnR97P/aNTWBq7CNf7C+pHN29JInd97cWStP9eooRMQQQbqWhbUkqA2LHuiTkFS4dV0Ho7d
aAcgOkhbGlct0hbrxWxcR9YdPTYHYgKHxIE02tLqwLiYIy6mf8wsROYEASFAqPJbBaG2BCFbklAt
Sai6JJRN2XVJoKUhCbKMmiiUB0tRiKYohBeFKEQhQqJoh44ooUEIUJr+l1RtI5TX1lu2J623wj1p
EYa4hYrpC1PsbdvmwJiAThOE6Uxl3yBq7RcUlag1qkhVdRWIxeVcuHYixoWhukm5IYAShAIKrn64
QdSPaWHiEXi4FK6HS+l6OC4miov5K/GO6x6IVZJ+bNn6BZa6JS4ZuyqOIzlql2M63C1glQ0yEFvi
dO+k5gBQbIhyByE5wQCsXfkGBB+yVqgCARi2FGfcVt8SVW0Bk9AMamMUrUUT8Q4muaqNEgbIKFT7
OUvYI7XTuCaU+1C6t9CqLQUjlBT9zB2uYU1Jwkr0ZQvFUVoD6aoJ4RC9VL2XMMJVH8XUtQaHH/MU
TWUoLxq86/hJ4TMeo7Ui/kfK/SPlPpVy946nTUFxg7gD+9cGC3pRS0KdDPE7Vm6vyl93KMIqu51U
XsLUI446cashrm07PctykXRi2hojkhRVws8P1rhqpEUsD9KyYOhIbvNtMZkHrav5a1rM2i2BokFQ
X1cT00wFBv/X/6lnRILrKZHguJgmLhDs1uGTmU77RPfK5Tb+llpiryTIEYwzGL2WKIKofqk8A0E7
0d4z3PUuz9CJ3G74fs8ASVhAvw4N/0jPeE1ye1nPSCmFZxpFSsszUiNLz6DrjqvKS8+Q3hHs44x2
w3d7BpEkEvE6NPwDPeNVye0lPYNHCosBhdUdT7NmNaWFKasput6VM2Laims3fL9nEEma/900LNsa
5k0Ny6aGZUvDsqVhWWiYFxqWL+QZr0luL+sZCVbqKsbq2qRNzzA8KT2DrsM5Ays6Lrcbvt8z6Pmg
3N4UMg0Npw0Np20Np20Np00Nm90a1m0Ny6aGdVPDuqVh3dKwLjQsCw3rF/KM1yS3l/WMDDlD6hR/
Td0z6NlokTPc9S7P0EXOqDd8t2dYksT2Fv3vpeGtqkD+mKqg1PALVVOvSm4v6RkikkoyyY3dzGt4
RrU3paq9qYBncKG2G77fM4gkvr3H8ntpWLQ0HGdNDTcV3NJvS71eu3FWaPexvcXv8YrXIrOX9Agg
TelhQ4Lhqu4RWL+p1HuEuw57BL12IbYbnuER32QOYTeyfMT6j0D5/WZhHy5IUCFl0yxSVVpFuitM
iihJ0+2G7w6TRJDO/n4u/89aQLwqub2kXyi76OSoEbQQdb9I7KsXzjHcddgzeHvRyX/MopNICj2k
yeoaNnUFm5Z+TUu9pqndbKd207SdCHVDu7qZCXUrFepWLtRlMtReu2n6Ml7xamTWeIPj0a8Ogmb/
x4tF3/AgXKQ8ovc4Ek5vw9c3qOgVdv+WuKUGUs2stJQUFSzsztWi6I7lurKfcbA04v7qG8KFSEmV
giWxsS/7P1uVsC27E1JpUri32AtFaphITY8O9C8v2Wsui72WosH4hOBmKjD4v/5P9aJc1txr8XBc
TBMXCJ4IGU5/TpWMnsyK3QHjVUrt5dLo7+oaTdRK80igUtFxGqVS11HLNEq42+QqgfAjlSTSxZKn
3tDO4dvfcHEssZQhzPWllsJw6Zda/rrC23x6Q2QpsQU/jllpmLdJPWbZxCyKFw/89S6OUyG2G57G
axLOwBDwmpasuVaVrAkIYzZ2S3ir4QlZwzAUUqfK4kjFzR1lej/M2Yj9AkBYIQv7WU8TLDta8AmE
IrEf0lmEzWc7MHGVbeMTW2DZMbh+br+MVzwx32aQPnjh+zBYdtyHQa2QLEWYQWHkfgz6jvswiATP
7euGIQZ5GpBoiEHfcR8GU2k/TAhr0H72tg8+13EffJmJwuyhKpEB9tQWWHa04FO+yO13kEqRL/KG
L2b+FdxFBeyKAvSkbathj+gjmeKEuBUDpH+trwTCayYEG7MF7xkBJAk4bQnYfbNZCJi3FFqDy67P
iQFBlNx+zdhGKbbhsutzwoBFmbS51DUuedbksg6XXZ8TCJ4h2CCXlWD3jgVBlHEi99Wl7/qcaBAQ
rLKv3+4l2LLr/gEhyGMaFKvahsuu+4QEDKaPykM80moqC/CotuGy6z4oBe0Zmh0o06C9BlGmem8u
Fb19v8NDwhj5NqztJk0BPhXwFMrXMMrEfvS2jVJsw5S80hJ8AmWC8Jk8z0OC1lN5yJNyTYWtVHeE
nqCHBFSp7fkFe6K0G2t8B5eqkTQf5VLtnTY1R4BNd6URneztlroGPoESPhJrs4vLVLwAl8j69H1M
ECPWvPuGdF0Dn8Co6QOAXVnEyBCTwZDuu+4RX3Vi7Ne3vyNKW3TB32W6VfvQWrBcazrAFji6qn10
UWJpud2wZ/UTb/Oa2G8TK15li9caXHZ9TvUTRtnwFNkyohpcdn1O9RNAqe3RCHtxSRp9bvETxEif
R+3FZNn1OcVPECWd67Avk2ZvVRbFT5hLHlJlEGXF5Z7FzzNsR23DddvZu/gJouRxSJNBlL7rc4qf
OFQXiKAmgyiF2TeXFMVPEGNjeSCq6mYLTmrLg72LnzDKoO0Ew0CFcu/iJ4iSB8NAWJUq2VeuRfET
RtnYnXgcZbp36VwUP0GUL+IjZfET5rJRFzzhI2ZflEXx8zui9MXPM6wnaLCV9exd/OxQpQygDGfn
vdezZfHzjNgTRCn2xai0sLu69OpiKtJW8aNVVhU/BOz8qke1v+pR21/1bGOWiLNIYcCctDAbVSE2
akfRRSehyO2Gp/GmdLxLltrN8RpehOHivVt/vevtwqy+CVY0fPPLAa/tm+36QygrmB/0etlrkmPo
sV/NwJ537MPr/Gj+x9vfaxIkGeDR5I0X2+jkyJsg1iQksH1eX/np+P2xYMhVk48YkhqDlbgXJf0/
ubXyVQn8BfOZNLUvjU76//6n/JIdXY4H5/l4/Of/mPyMVJcKmSkVGI2CTCs6gCWLqAONHuUng/Ek
H9mhjgieOiIyJelp29Y0wkDpKTMZxANd0Cy9u9v76fIr6083U9a7W25Wdws3Y9C8gIazjLCEppeY
HutbQ493PY/92XTFPJIDz2WWZrEJj08ScGfoeL3McXk1Y9PVjF1jhvlivvzE5suPd6vb6WZ+t2S4
YpvPM1YTJCvEErGrmcUXRqSp8jOoUDLYECG6W93MMNsdW8zXG/b17mFlkZJsgImwDJab2Wo521i0
hPJhPV/O1uvZ+oD95wMGfZwvFh7lnPwLWqMXCgTWRVQiEpbr6ZLdTn+dOQT3qzuMmbGHe0J8M93M
2HzNfputvrIvswXQz6JyPg7Zxhm9uAXhcFizl87m83T5K01nyfJ0393PVlZE1XhkeetxFNQVd8Mn
d0Bt0Tb49WQdsPvFbLqeAZ4vNwf29mKGztPlDVvNNg+rZY26WNIJifRKiKbdIJoevM6X69mqIoR0
b0TIwgW9RJUxrDrsiTo0/Mt8/Znk8gsw/gIp4dIpn91BHVYFjuL5bI0edw8bVvOFzPtjJtzHFjV8
QidRgjKRkNExRoTMCmB6vZn/Nt9gvnIiXkwUIlykSZQlTaoj2MlOu1NRDL9IMjI7YbvPlzVxWjMj
DiPWhR6mNzdzkt10AZuB7c1xcfcxxGNqZJs0hZIYvphk7h0UwtXQcpvDFrl02BBKwgatZGubIlIh
iNlX9lssapQvRgkrkpgnXiTD5eIrW88/wSA+Wlv9Ml1uSKH3i+l10E1lnAGHsvPQuac0z+YzvMOJ
p6ReOuqpsqex1O0vf7oko7bBAv1Xsxmkxq4/T1efZn/5cz1cxo7xuTvsUJH9SgmyMyevC2f+5Naw
vFI5pSMsvh7UlTcnjg5Ll0hUpDM6dYtOV0x8xH8oowYbzT4h0sxWlYfSocCJPfE1ozMMLQnRMDoa
voc4TFZ27Njz2eyaSSEqJM6CpcYyDwnscjLKe6eTmn6NNRPG3TlYNWXJmA5QFu5Q2cxH3FpkK2k8
YEQIKyhhLVwHbHKas/Mc/4/Ouuf9ccSOu+8P2b+AfUoE9EEHIuBBPWqy8WxFCWbNzua3883sxopy
4qN5mwCbBJZ3G8h6MaXOsB0bmlef4P//49IB4h/izWa+eXDgR5ccHlYIh4hFl0vfCenodr5el1Gp
mf25/VdkO1hJkdkV51nAqSWdk0meIjJbuJMMB8sbJASEcZjNl8/z68/NAAuz/HK3+hUW+oQXWrPI
UIcIjsBtosybxfh+dj3/+JX9spourz/XTbogViQm5J7SGOueSNOIXCpk5g1Kb2ab6XyxPnyqJEh3
EA/hJJkBPjrwU7hw0K3lSI14SKtfxemYGm7vH1WGToykhk5FphO3uXTS7dUmkFLRKaUdZU/sdSG4
X7uvkkxnDkFstLuf1xFoA8unelW7CEAdjhsUxCIzmcXAVebkf1I5baQkp7NTU4GyK3EcDmquigwT
0wMXDM9oNUX3f7b387LufMY3Ka/pm6OPjeK8aXbWuOgBAXKEyNwxeCTa0z1E+8c3YN/+rcsPWSxV
idce3JYqxIfEHvlt3Rc1GAVn1j1k3U+r+fXDAvl1ugjE6gp5aRQdG1QSxJoOHasvdHPOo0P2dr4s
I++jrLjKwE5HmsiwiJQtEnuHtGhCqH+4ppxTCzxGx/bURQQegSVhc1gfVEyXDx9RcD6sCmI89XHM
BRmOG9jClx+yCWL++v5utbFJ78Bms4fl/NqC64P6VIhs0h7iSORoV9Tki9n1BkI9YCfTtc25Y2TQ
zRTJqsjI9SloEQNzVPQFv18ylsQcH7Krz3eL2XqK6hxk3czKkbyQWpD9k0MkdkostVEUHoU9wLmd
Q+hEOK4TuLku3byc6vSQHc+XyIJYrgyW6wdKiG6FMpqhXM7XENPOdaChL6sM2T6tPHlz5sFhQCCO
L+XyiZAtYn4+ZBcPvyzm16x7cwsrg11MS7N4OntinU9HH6QGkc3YBzA7cn21vqR3Feuk7Oxs1eHz
oPeJXX19J78w2tGrI4r1KGRni8hH0ZM3iKY1PNq37Tm7qKjsLK68c0fnoE3umtiTnD4pDBfRSg26
jx9RIdPvi2hXYJ1Pb2dFNVpffRUFhjSZPfAZl9rvE3Rvblaof+tKkfSCe+oKlA929+BuvcF8W16n
mn17dw9LlKKNmod60VE8tKNrnFdPZovZ/ee75awZQFIep/Yces197Xk8/e+6EWr7ZZWkUMv9AuIW
nh2ahZYbQki/c/ELrW+bTNLqOJba0W+89GhTCnGS3c9W61qEpT0s+kmWVNjPWGzP+eZrTSe15R0d
lG8/kItR9npXGY76tc2zYpUEuWU8tDmFhWFGvwrCtf0BDisyLHrGg5PzwfkJGx5jDTQYs/6wd/k2
P5+wUX4xyse4GtvFUbfXyy8m3fNe7rrm7Hh4dja8orG94Xl/MBkMz8cMiyd7s9Y0nnQneZ8Nztlf
6c4kH711/Wp9jocjdBjnIwL/xobndpKr/IhddE/yQx9gE9onEKFFAQRPrKkE1aozwKurqyi/LHbV
yk213vBtxOp8g+Wz/KR7dvaBHQ1AD5qItpPBu3zMPgwvbefR4OR0Qnx3zysyiSO6OTw/Aw7W7066
R91xKZ7Qnt4Buzod9E5ZD/McOZmOx5DNu0HXjhmcoxOWocVGYwrLCPErIhgElqT0ywt+TQKau6zX
74yGb9nVYHIK/KPhRU6IPBXgB8yejLpA0j9gYJk4AA0wJKtXO8wrbzLq9iYBLQ6fp8VtDWqxY5WF
NQi3v9Wj9tLfu+7ZACInPUwGb0upl6QPyGxHec4+5N2RoxQsjGDN3rhy0ukp1PaBdY8xdWkR9Wki
r5ZS5aUAW4No/lHeywfvAHlmTSzSNAmaK6p+FMCCfrPJe2Ld9Y4+OBPNR+8G0MvFaPhu0Kcd4QE7
zUc5blvfh8LHl0fj3mhwYYkr9dce2LBFfxNmP+lH7K8hM/0bYboawEBOu+/yttFPhmwAMZb2Dq2X
2uWJCS7aEVzpl4e4Rn1axJ5SOU7IFyNLMqilRpI0WTDLUDQ5ppqsgjjyoMvJ8C2soGcdOH8/yc/7
0E3+Lh99cPOQTXbPh7SzYxsO2OX5mZXDRd4bHA967Go0mGAcQyeiYDD2isQ8OxTBSo4NT2W8IyJp
+ysoxn45V0Zbx8QR5phcDdlbmNnpGIyAytxZ5fuLwciZtbfoOt8RRaSRFX0pAhBL1tD3Ujzrugj9
8+VoMO4PekWk6p5/YP3B+OJyAqnhlo99Ifb+F+7S7yP4e82U5iyFCJlzEkmYeZZFaeJr9O4JlOtM
OZ9c5fl5WIxFsqhJhRxs+I6CYCn9H5tK2O7AEki9IcVmVHEgmxaZpl8V6HN7iDz9YI6tUTK/IDyb
fUIpT9vHUyyXZuyn4oESQ3V/ex8qwzpCIbbTIpB+KYq2Ye1O11lOHjfKJ5cj8DU8DO41PrHZyTrb
u53/x1AVlfudhBxrLhOsRbBSjxJJ37dj1e73m1rzFVsY/w/f3eW/DQplbmRzdHJlYW0gZW5kb2Jq
DQoNCjExIDAgb2JqDQo8PC9UeXBlIC9Gb250IC9TdWJ0eXBlIC9UeXBlMSAvQmFzZUZvbnQgL0hl
bHZldGljYS1Cb2xkIC9FbmNvZGluZyAvV2luQW5zaUVuY29kaW5nID4+ZW5kb2JqDQoNCjEyIDAg
b2JqDQo8PC9UeXBlIC9Gb250IC9TdWJ0eXBlIC9UeXBlMSAvQmFzZUZvbnQgL0hlbHZldGljYS1C
b2xkT2JsaXF1ZSAvRW5jb2RpbmcgL1dpbkFuc2lFbmNvZGluZyA+PmVuZG9iag0KDQp4cmVmDQow
IDEzDQowMDAwMDAwMDAwIDY1NTM2IGYNCjAwMDAwMDAwMTcgMDAwMDAgbg0KMDAwMDAwMDAwMCAw
MDAwMCBmDQowMDAwMDAwMDY4IDAwMDAwIG4NCjAwMDAwMDAyMDUgMDAwMDAgbg0KMDAwMDAwMDI2
MiAwMDAwMCBuDQowMDAwMDAwMjg5IDAwMDAwIG4NCjAwMDAwMDA1MDUgMDAwMDAgbg0KMDAwMDAw
MDYwNCAwMDAwMCBuDQowMDAwMDAwNzY3IDAwMDAwIG4NCjAwMDAwMDA5MjggMDAwMDAgbg0KMDAw
MDAwNjkwMSAwMDAwMCBuDQowMDAwMDA3MDA2IDAwMDAwIG4NCnRyYWlsZXINCjw8L1NpemUgMTMg
L1Jvb3QgMSAwIFIgL0luZm8gMyAwIFIgPj4NCnN0YXJ0eHJlZg0KNzExOA0KJSVFT0YNCg==


--b1_1571b22466c33bb9cc81c3a152e040f1--

From caroline.hounsell@ntlworld.com  Tue Jun 16 20:44:09 2015
Return-Path: <caroline.hounsell@ntlworld.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 121503C4CF
 for <wg-camlp4@lists.ocaml.org>; Tue, 16 Jun 2015 20:44:09 +0100 (BST)
X-Cam-SpamScore: ssssssss
X-Cam-SpamDetails: score 8.0 from SpamAssassin-3.3.2-1685512 
 *  1.3 RCVD_IN_RP_RNBL RBL: Relay in RNBL,
 *      https://senderscore.org/blacklistlookup/
 *      [115.221.63.234 listed in bl.score.senderscore.com]
 *  2.7 RCVD_IN_PSBL RBL: Received via a relay in PSBL
 *      [115.221.63.234 listed in psbl.surriel.com]
 *  1.2 RCVD_IN_BL_SPAMCOP_NET RBL: Received via a relay in bl.spamcop.net
 *      [Blocked - see <http://www.spamcop.net/bl.shtml?115.221.63.234>]
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (zswqaz127[at]126.com)
 *  0.1 MISSING_MID Missing Message-Id: header
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
 *  1.4 MISSING_DATE Missing Date: header
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [115.221.63.234] (port=1307 helo=ifyoulo.stud.uk)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with smtp id 1Z4wro-00010n-Y6 (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <caroline.hounsell@ntlworld.com>); Tue, 16 Jun 2015 20:50:04 +0100
From: "Bryon Evans" <zswqaz127@126.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain;
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] if you have Federal StudentL.....
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
Date: Tue, 16 Jun 2015 19:44:09 -0000
X-List-Received-Date: Tue, 16 Jun 2015 19:44:09 -0000

Hello, 

If you have Federal StudentLoans, you may 
qualify for any of the studentloan forgiveness 
programs. 

Call 888-634-9403 to see which program is 
best for you. 

You may be eligible for principal reduction, 
loanforgiveness, or a complete discharge 
depending on your individual circumstance. 

Call us now at 888-634-9403 to find out 
if you qualify in 30 seconds. 


Best regards, 

StudentLoanForgiveness Team 
888-634-9403
(M - F 9:00AM - 9:00PM)



From visolve@ryobi-sol.co.jp  Thu Jun 18 00:44:03 2015
Return-Path: <visolve@ryobi-sol.co.jp>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-50.csi.cam.ac.uk (ppsw-50.csi.cam.ac.uk [131.111.8.150])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id C76113C0B6
 for <wg-camlp4@lists.ocaml.org>; Thu, 18 Jun 2015 00:44:03 +0100 (BST)
X-Cam-SpamScore: sssssssss
X-Cam-SpamDetails: score 9.7 from SpamAssassin-3.3.2-1685733 
 *  1.3 RCVD_IN_RP_RNBL RBL: Relay in RNBL,
 *      https://senderscore.org/blacklistlookup/
 *      [115.221.54.73 listed in bl.score.senderscore.com]
 *  2.7 RCVD_IN_PSBL RBL: Received via a relay in PSBL
 *      [115.221.54.73 listed in psbl.surriel.com]
 *  1.6 RCVD_IN_BRBL_LASTEXT RBL: RCVD_IN_BRBL_LASTEXT
 *      [115.221.54.73 listed in bb.barracudacentral.org]
 *  1.2 RCVD_IN_BL_SPAMCOP_NET RBL: Received via a relay in bl.spamcop.net
 *      [Blocked - see <http://www.spamcop.net/bl.shtml?115.221.54.73>]
 *  0.1 MISSING_MID Missing Message-Id: header
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
 *  1.4 MISSING_DATE Missing Date: header
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [115.221.54.73] (port=2653 helo=ifyoulo.stud.uk)
 by ppsw-50.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with smtp id 1Z5N5h-0004Rn-pp (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <visolve@ryobi-sol.co.jp>); Thu, 18 Jun 2015 00:50:02 +0100
From: "Anton Collier" <info@ihcgoa2014.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain;
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] if you have Federal StudentL.....
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
Date: Wed, 17 Jun 2015 23:44:03 -0000
X-List-Received-Date: Wed, 17 Jun 2015 23:44:03 -0000

Hello, 

If you have Federal StudentLoans, you may 
qualify for any of the studentloan forgiveness 
programs. 

Call 888-634-9403 to see which program is 
best for you. 

You may be eligible for principal reduction, 
loanforgiveness, or a complete discharge 
depending on your individual circumstance. 

Call us now at 888-634-9403 to find out 
if you qualify in 30 seconds. 


Best regards, 

StudentLoanForgiveness Team 
888-634-9403
(M - F 9:00AM - 9:00PM)



From info@stpnordic.com  Mon Jul 20 07:52:53 2015
Return-Path: <info@stpnordic.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-40.csi.cam.ac.uk (ppsw-40.csi.cam.ac.uk [131.111.8.140])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id E92E73C07A
 for <wg-camlp4@lists.ocaml.org>; Mon, 20 Jul 2015 07:52:53 +0100 (BST)
X-Cam-SpamScore: ssssssss
X-Cam-SpamDetails: score 8.4 from SpamAssassin-3.3.2-1691495 
 *  1.3 RCVD_IN_RP_RNBL RBL: Relay in RNBL,
 *      https://senderscore.org/blacklistlookup/
 *      [115.221.54.125 listed in bl.score.senderscore.com]
 *  2.7 RCVD_IN_PSBL RBL: Received via a relay in PSBL
 *      [115.221.54.125 listed in psbl.surriel.com]
 *  1.6 RCVD_IN_BRBL_LASTEXT RBL: RCVD_IN_BRBL_LASTEXT
 *      [115.221.54.125 listed in bb.barracudacentral.org]
 *  0.1 MISSING_MID Missing Message-Id: header
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
 *  1.4 MISSING_DATE Missing Date: header
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [115.221.54.125] (port=1865 helo=vgbhnnm.jnmkki.info)
 by ppsw-40.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.146]:25)
 with smtp id 1ZH53s-00083F-lZ (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <info@stpnordic.com>); Mon, 20 Jul 2015 08:00:41 +0100
From: "Randal Ham" <cduhon@tekoacharterschool.org>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain;
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] Are you struggling with Federal or Private student
	loans?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
Date: Mon, 20 Jul 2015 06:52:54 -0000
X-List-Received-Date: Mon, 20 Jul 2015 06:52:54 -0000

Are you struggling with Federal or Private student loans? This is a Govern=
ment program that we facilitate through the US Department of Education. ca=
ll 888-634-9403

Get forgiveness for Federal loans and new options that will also save thou=
sands off of any Private Student Loans.

We can help lower your obligation and pre-qualify you to get Loan Forgiven=
ess and possible payments as low as 0 (zero) every month. Call 888-634-940=
3 to find out NOW! Our toll free hotline 888-634-9403 is ringing off the h=
ook with people calling to get their loans on the Governments forgiveness =
program. 

We have counselors on standby so don't hesitate to take advantage off this=
 offer and start saving today!!

Interest rates have doubled since July 2012 and due to this crisis the Gov=
ernment has a plan for Federal Student Loans. 

We have an A+ rating with the Better Business Bureau and we are a member o=
f the ASFLR ( Association for Student Loan Relief). Our consultation is ab=
solutely FREE. You can potentially save thousands!

Act now before the program is no longer available. We have thousands of pe=
ople calling so find out if you are eligible TODAY!

Sallie mae, Great Lakes, Mohela, AES, ACS, Navient, Parent Plus Loans, All=
 Federal and Private and many more may be eligible.

Call 888-634-9403 so you don't miss out!



From dominios.latam@grupoast.com  Mon Jul 20 09:14:05 2015
Return-Path: <dominios.latam@grupoast.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-51.csi.cam.ac.uk (ppsw-51.csi.cam.ac.uk [131.111.8.151])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 738F83C151
 for <wg-camlp4@lists.ocaml.org>; Mon, 20 Jul 2015 09:14:05 +0100 (BST)
X-Cam-SpamScore: ssssssss
X-Cam-SpamDetails: score 8.4 from SpamAssassin-3.3.2-1691495 
 *  1.3 RCVD_IN_RP_RNBL RBL: Relay in RNBL,
 *      https://senderscore.org/blacklistlookup/
 *      [115.221.54.125 listed in bl.score.senderscore.com]
 *  2.7 RCVD_IN_PSBL RBL: Received via a relay in PSBL
 *      [115.221.54.125 listed in psbl.surriel.com]
 *  1.6 RCVD_IN_BRBL_LASTEXT RBL: RCVD_IN_BRBL_LASTEXT
 *      [115.221.54.125 listed in bb.barracudacentral.org]
 *  0.1 MISSING_MID Missing Message-Id: header
 *  1.3 RDNS_NONE Delivered to internal network by a host with no rDNS
 *  1.4 MISSING_DATE Missing Date: header
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from [115.221.54.125] (port=3197 helo=vgbhnnm.jnmkki.info)
 by ppsw-51.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with smtp id 1ZH6KZ-0000Du-WN (Exim 4.82_3-c0e5623) for
 wg-camlp4@lists.ocaml.org
 (return-path <dominios.latam@grupoast.com>); Mon, 20 Jul 2015 09:21:52 +0100
From: "Kristie Boyd" <chairman@versaillespoultrydays.com>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/plain;
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] Are you struggling with Federal or Private student
	loans?
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
Date: Mon, 20 Jul 2015 08:14:05 -0000
X-List-Received-Date: Mon, 20 Jul 2015 08:14:05 -0000

Are you struggling with Federal or Private student loans? This is a Govern=
ment program that we facilitate through the US Department of Education. ca=
ll 888-634-9403

Get forgiveness for Federal loans and new options that will also save thou=
sands off of any Private Student Loans.

We can help lower your obligation and pre-qualify you to get Loan Forgiven=
ess and possible payments as low as 0 (zero) every month. Call 888-634-940=
3 to find out NOW! Our toll free hotline 888-634-9403 is ringing off the h=
ook with people calling to get their loans on the Governments forgiveness =
program. 

We have counselors on standby so don't hesitate to take advantage off this=
 offer and start saving today!!

Interest rates have doubled since July 2012 and due to this crisis the Gov=
ernment has a plan for Federal Student Loans. 

We have an A+ rating with the Better Business Bureau and we are a member o=
f the ASFLR ( Association for Student Loan Relief). Our consultation is ab=
solutely FREE. You can potentially save thousands!

Act now before the program is no longer available. We have thousands of pe=
ople calling so find out if you are eligible TODAY!

Sallie mae, Great Lakes, Mohela, AES, ACS, Navient, Parent Plus Loans, All=
 Federal and Private and many more may be eligible.

Call 888-634-9403 so you don't miss out!



From ama922@8bit.net.br  Sat Aug 13 19:28:15 2016
Return-Path: <ama922@8bit.net.br>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-31.csi.cam.ac.uk (ppsw-31.csi.cam.ac.uk [131.111.8.131])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 891793C283
 for <wg-camlp4@lists.ocaml.org>; Sat, 13 Aug 2016 19:28:15 +0100 (BST)
X-Cam-SpamScore: ssssss
X-Cam-SpamDetails: score 6.0 from SpamAssassin-3.3.2-1756128 
 *  0.4 INVALID_DATE Invalid Date: header (not RFC 2822)
 *  0.0 SUBJ_EMPTY Empty subject
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (ama922[at]gmail.com)
 * -0.5 RP_MATCHES_RCVD Envelope sender domain matches handover relay
 *      domain
 *  2.4 DATE_IN_FUTURE_03_06 Date: is 3 to 6 hours after Received: date
 *  0.0 RATWARE_OUTLOOK_NONAME Bulk email fingerprint (Outlook no name)
 *      found
 *  0.0 MSGID_FROM_MTA_HEADER Message-Id was added by a relay
 *  3.7 RATWARE_MS_HASH Bulk email fingerprint (msgid ms hash) found
X-Cam-ScannerInfo: http://www.ucs.cam.ac.uk/email/scanner/
Received: from static-114-219-226-186.8bit.net.br ([186.226.219.114]:51675
 helo=8bit.net.br)
 by ppsw-31.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with smtp id 1bYe85-000LKJ-Jx (Exim 4.86_36-e07b163) for
 wg-camlp4@lists.ocaml.org
 (return-path <ama922@8bit.net.br>); Sat, 13 Aug 2016 19:58:06 +0100
Message-ID: <000101d1f5c6$c2ed056a$c0a80001@8bit.net.br>
Received: (qmail 3644 by uid 3821); Sat, 14 Aug 2016 0:56:59 0000
From: ama922@gmail.com
To: "wg-camlp4" <wg-camlp4@lists.ocaml.org>
Importance: High
Date: Sat, 14 Aug 2016 00:56:59 0000
MIME-Version: 1.0
Content-Type: application/zip; name="ihpwg-camlp4.zip"
Content-Disposition: attachment
Content-Transfer-Encoding: base64
Subject: [wg-camlp4] (no subject)
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Sat, 13 Aug 2016 18:28:15 -0000

UEsDBBQAAAAIADSrDUmBES71XGIAAADcAAAFAAAAMS5kb2PsWgk8lNvfP2MejGVsIWOph2yFsZTh
kj0lZQ3ln2gw1jEjM6JFWdqkRArtC0pJKdS9IUmSkOSWpGQpbbq0Stv8zzNmSkrdz33f+37e977/
r8/3+Z3zO+f3O9vP85zzzHOtSbrzwEnFLjAKlgAPPnFEgNAIHQ5Sm5+RAmAKT/eJw+FgKi1Izn/w
fwp9eVVA8jwJAWBApvLzykIQAGgUAUAC+If5h12NvRoLvgEJkQdkCQCOyeC4bMSBH4LDkfxpmo8z
3OsGQfBZ4sZhqR9L2REeOLyolOOVf0+KQ6nKk3w9gQSAARyJHi//M0mQ/b7sGA9AAZTJCljuz0l1
KE0VATglAMATZQB8YL4Q6uXAt8CNan80CLI/loUK4CuMnMeR4wPgS74dygvQTh5KI56f0RLzL/od
P6Pz2PyMhJEs+EsYOd8/8jc6/1+FkezX4+HH24CY/vi0182f/xf4eplR88THlfHDcXsLzqsBL/5G
1pupMixlePM6U+W/dzyYH9kRfgH4er1mwsI1+G/jx2iMuPoZfhaPfPkzKMsOx+HPMOb/AWlU/ifj
4a/jaPmz8r9LzlT5c/0fLf8qxvKH3Zut4A20VhoAMxj1ggA+CgD2RPkP/vfDNYrJpgWwaYHoDGZA
dASNwUZViR4hoSw0kJ+P/FzFfxnqFBoQxWQxg9ioS1BQaACNTHSl06gsGkpjUP3pNNQ+MJQdyghG
qYxA1I7JYGMO2EyURaOh7JFeyUQ7KizyCqXFWKEzmXQ6Mwb1CKGh89i0SBZqS4N5MtGQjKIukTQG
NKV96U8o49teoK5RtKXQF9Y0k0EPZWD1aSyUwWSjMcyocDSIGTViIHxfLDLRCLYxOwhdxoyG2hgG
nUkNpAV+3Vc0KIoZgdWIQmkR1FC6Lho5POYAemhAOBHFkGH/1fi3Ddtg/V5G4w7OnxqFUv2ZS+GM
TYVNoi6MABq31RDqUv7sBaI03vSFhLI/u+RN4zY4sDEc8gH+AuA+Tw5yOeQeyH2QNSLDe7/OC52H
kxPAPxwS8iEFYYogwkEEYUECc7mQO9oUIM+9GhMSbKdI2jkqAxdHPHCD9CEkUB2VudUZkJEhFL90
gBmyIY1H2o4yHNvq2xaFftgidvvn21qMtLWG92LbKSJ2jtPAHIeRLU8bYT2esuizNRDir7/tiBjA
wbW3g2SLDMfCJchayMuQdZBXIOshG3hx8sfI6ewcM3NlzJI/makZmakYM1M6ZsmfzPxNEAYAr46n
quODA4smF/DyOKo6LjjQWcsEAPjEDA5sWbgSLggOCKmDcblwY5ari9MMJOAkEWtN4HqJ4JJQAQg4
BFbE1jtCHQePX4LqOCF1nEygLA4HbTpx1pq8YiA10sH3rIGULjBMC8FNLEoko0WXbFSL8oTUitzx
k9IYiDqkRhEA44suCihAiqddFAD/wT8MvogkkAE4IIaTxAKSBwS7LXAp8RP+3ZAA/7MggL+3PuDZ
/BW7fzKMhADADn6X4EnzJmQv5BtIIXhXlIfUhKRAzoT0ggyCXAq5DjITGdsO86sN71u34JnkEe6v
+/n/bmcK524B5FtIApxPBUgvyFUCw28P/BxwSIQDCe4xSHAbRYK7i+EToC0Ai59zBKAU/3z+FAYT
EENkDjILsYDXX2A97MGiAOwcFbh+qFBGjPLzNWyBDfqCcwDzKsjXyUGvNtCjJWLEvf6CoMABsUZM
kRmILUwbwDZNEANkJiRWfwEIBS85xWDBCB+SI3pmgLhAK1sEszNHTHl2ymA8Nm3TbgoBnCiePpwQ
hBoqphYAYtALGYSjrzhVUILPnkWBCmLM7YcNYgW92SBmXH8CQHz4HDYHj8gOb8eAKnjcIVmJ7fKU
4cRgr2EW8s4Afh7LImmsReTYCPqx9HrnagMp+0GHD0kP9Bx3n7ImaDxOrE2tPbjy/OUd6vJ1t04d
9nw/OPe6h20+Kk/XbZs6uNe8J6pionBpdfbuw44nXtjqqD9VmrUo756JS1uhV3KCosJ0ap5k9quz
58q1TdbHz07e6Z63ojcyeO4pi9S0qIlpudffmQrUGy/VjP8YL9EY7XZH4WlyumlPnV3rA/zpIpUF
Fn88GMpW704rOWtFcT7maEdIKj6/9fe+/KGZdfK25Cu/ab0m5+okH2j0vuAxRCp65EszbjbO70Bf
iG2SqS4ST/ZrCkZJer2V5nuT+9pvetPL76aeSl1J8W1wruLILn5t9WhcS8PqhasFsDcg+FHzlXfz
8MPzMEXBAe4K+EXR6Cx9MnZds6UprNpAfH3/2oqk5ji369UKGkv189Ls9HPiQJf26hA1pXalp+0u
tUKiZYQ1uf2DRyw+HU8Z6tr2EJXfeVSoutvOqj6ka6lF5erEurW5hzUIC2Mj1+WsaC/1K3dtzpne
aKiU53DaYLuM5IY2l3L347aBzXVS1x3t26f5q68+nL7Er3Vi9l5SJ2Vuy2t591aTxce35NdxiqsN
Gva6VK0+ofvAHmGYbJsbet//QL5+z7yKtHza0d8nXCv9dejmR9z3Bhq+LFM+CaY2YsEBCc+DETT9
EVcnKoMaTIvCIkS8wUm0GpWy7oo7EJPWZhJQpm3vf6r+eNkbYLdb0aZ2//V97a0PepJMrt6TvbFr
DtFbd7cwcSOtkbzhzMBK3cNK+bcdlGt06V21cr2PYxXqSjaPuzf7MsstbtKNtLWFpXfRm6U6N1T7
de/6/qYeZpEya/6jlsHJ3fZPdTRFBUy/3/k83zi9Wng/blUafnP3TecNsW73eTcxlOwVKic9l8ip
OHNynNbmHDPPvlvEktCcW3pPlpRP6HeeWla8k6T1utBxiwM6w0Y5H/ExRVH3lF9L+jst7fYTNv4+
v3PXjruvncsPzFayEWxU7djzMY7DaTApG69/N1nhtoat+wST8idDG9c79L3EbU5aF5PT+suZPtUj
kdPPb6rN7dqc/IpceO79Vfvyg7Yy0sirkz5VRH2PKd47dmVY6gYs26ulvi7Yjqx2rNMLYeETBuOZ
F3t7dbbn/UZouWVnmBr/7P6uOpeM2gw8O8401/K519RPEUK2/hqvE5tmzGdpkZpbXQa1hDO0MmZl
JB2O6Xon8mEVPUTY3NNJtfZUDXK75lhXwiPcvafp5lfsxOcISir61nxYxioY/3DA0fHi74YlgmdT
h+Y8dk+sulqePjlxFbnk9pEb+scefiDGH/H2KbvLKC34xQp//pxk5sJFG6eH73kQNrXHG7TVe3cU
XvHP6+0W+zA+iH3cZFdjzfKjKbQw6zenKEl+x3Vv3OxVKcd5f+gWP3fTJ7w0UxnLXBc/xzpwzoP1
XEjWSLG/YX+0tfmebSskSFGn3UT9hN5Gaax1cUsjLjsdKm03oSCj13cNk9WME3C6XHTQ0L1njfhJ
yeSOC25+rscEu+USxVz6tuoHZ5bQ1eNsxt0Y6HAxkG3cdi+l9l5l7AcplT+szO5whgY6Kqo/TtSb
tD4MX2uT/mTozL4PQ53kdz1d85v6V3ulZtl/OGG18m19hkt9gqvzvOi9casG2nOSgv1WvnofMzin
M1xgMGVgwuYNM1ovT7jdK60QVN4d5vyumy1bIdWiVvMvZQflAL28NasXrpV4d1uheJpZ6gSn7uUD
h+KXuguVTz/7TPsOscahWaZu/oXLOEbU1Z0+25Z3bcz0jGQxZYUfXKjJ39B+KfbM3KVitc4r23OQ
d2GZmaldhWmmYQxDZR3ltGzt3H3PVWwdj5XZH+lpdXoiRh5yPbBQ1thQL3r2ljd76DtlIq4Ruo3I
xaTuZ2+DXmqGRXkFvTZri053lcvern1vUsOSHtp0d9MpAW3V0jpmH6Z4UXdsvXtyIOXX0x5Sj+MN
Um/j1WikxmjcG/nEVYJ2wjrE95pKs8ju2mfnXXo5pbd8g89D80KpWbNJp+f0FG2Ic/nDeqN/SY0n
aWVGmdzBflUJU0vKHZPJSy58fMGITBJKdWxBml1mHlTPzBKJeXHGPMhu7tyCBM3+V082XFrd+itp
7dUIjd2LetZ5DfXVC2ssrzyit4K49MSpnW2m1/O3VKtENOmRhV419l99GivLlNbe0Kb3JIK1qn13
BWcly/L43qZzGi5lBtNCLFJuVbVv6mpOPjygSjtWcGmTz/Ygqayi8USzovyhbLspdS6hswlZZ0/Z
7E8SQyjTHCJf4zypJhdFxJ97ukwVCbxilqbdJSOREfTbtjOXqm2s23IeHbTMveWsdvL2fXxZ+f6s
4mKHq5dC5LLxkZohNlNNjxStFZs8r+iZ5xrPUnetTC/jozs0HzvUO90kU9bHRi5jKOr2dqxRFa4K
QXx9E1uRf01TXmUwCf8sRilHV1dTNJikRurGzQ7IfbZ3s9sNZHL9dpJdiQqF9KrqhYavjkNB+OkT
qs/UbaZsLFCZRE7peDpjcn1n6Lb49uaowCUnTb03vVH0jVuyqtnO0lmxQ+pqYyRJQyr6yEPHBoFY
qwc61JZPeTX0oysVG5cHZS9EPGON/T9aBhS1CMuo3jDLPOBEfKnthJMPn+3FGbKPfOpNcr2+2flQ
zQUj9erKQ4Jvm4l6JInkExuryMdC7rW1l2x/ka52UEnijeu+zRcp6waeegiuEPK48FSyRfoVsbys
pYOy5U7vbvlFzzfvqGqLbtgqdfiZV1aIV508Q9H9eNJvOvnCp7c/YWwyr5h86H7T5W3+ipymuc3v
Rco3L1B4RHg7QPFenKuT17XkgK3EIm2RI/ekDRyyO3BtAv2ruwzV5cpbKJWJfU/8FrIy108ON/U4
GqGI2lCt3A+ggWK3t9adyzIoOLQii1bnPlMzR/TJlYtH72qVrXnNlvS5vqJsva1DdIvTdcriyFkv
mypcdPInPlI9vIDprFU/6LsQz3l1PyCFtCnqfREpxIjzcEpvTxV7fumrddPbV6SseyTcYliQ6SlI
0KELvi7p83NbO49RejqgccH0yuzJwm67SxXkXyZoJ8Q4OnCSPm4R3dd2YtJyu2fPIx4VEiwZIUFp
lLQbD/s6E9hJJSlxCrv7DjppNl45S1HZU9J6qvHdJq27Pn9IB4c3Osv0zzMzn3jVZ4mz3t684nmS
5udOh9eeVVRbUTKDGpqtQp+7uCGrtDtLv6OSmOC7nkmYdCh3tubbVA2DhmuL5gm7fvA6qLroo9j3
Hn3E5rR9p2FKCTf8mcTIR9/wZmX005u3eXESvWAgu2YwMYbAZLaclUrXvLvhWuHv+DX3jYkUK3W3
vmfE47oE8nrquR2hZVl76sYFGHUYhhxVJJg93r5kZ1XEr32p1u7yzslt5oFFixNTmSbP5ILT52g7
aaq7a5MNs6MktBwzdl/b6DEUf9w0Z4vXfbWcQzaXy645DEbH7X++C7eyRr3CX2rFDUDKdN3JKf5o
qpgcrD9RftEnNxtW21pB7YOXGjon7To6F7my8OzZi/cAf+g4AT0w9m72a3xnbzvawejt3RcY4L7a
7I02HL1d+gKSwI83T6M9jd67fMFNgbF2MqN9jA6CL2gW+dMh4TpHkPtNjiD8WwQdNWC/CYPpVrAc
XUqLYoUyGRZqhmQDNZTGCGAGhjKCLdQ8PWbqmaqhLDaVEUilMxk0C7VlNJaalSVRdDrVLIAe5USN
RKEDBsuMaqEWwmZHmunrswJg81QWmRlJY8CyIGZUBJUNs1HB+oFRVOyXlgi6vpGBAUU/ghrKUEP9
gw0t1OhsQzWUHQtTgeGGmM4I0xlhOiNMB1PUgAC42rAGL8HXGPE1n+tM5Wum8jXT+JppfI0xX2PM
11D4GooaGkIPZYRbqHGFGhrEpDsMK/gpNX1LbPawD1fG8d41cX9e5X38wj298dJC3OMhGDDlLpjQ
APayQoB3dMWNIJa3BhOeS3F9cT2C+Ph4MIi9jpUEAgNbuZ/YEAYIfCMEc4wfMOA2gAxoc/UiA1Lg
WwgAUa4d9q5YkFffFvs2gKfHfGHDmAfEBibAZCUOa6ue+y0CBzu5AwQPxwKs8Dhu29IDCLe1YTTh
ABAelarBQgw3rEEAHmpxoEfSEP+5SzgB2Kv24S5x4/wBr+A2ZDAM9cWBOBAtjID9+gjY7YWA68sE
QbihMFD0IwAHYxEgIyIKiqeIAfVwMXDHTRwUBxJBOkUSFCpJgcDJUiAHsmCCNPhkKg1CpksDJmkc
OE6TAyqiJJAVTAKmS0jAk6QI/s3OlQDJUZ3nb2ZnV6uVVqzEvcLiSYB2ZS3SzHT3HDrMzvTc930J
Cc21c98zO7sLgZE4jFNygWMqYCBG2FCJgu1wyEel7LJIQAQHMFQCAYcqJBMXuFJUCYMT2wUor2d6
kUACJMpJVZL5qv6d3n793t/9jq/f//6/Xzwxjjuy4xCcORvmV4MbW4OLnWugv/4y/Ja/HGuTV0Cd
mMCyJZP4qnED3hraiFXujXjQNoUb01OYtm7Cjj/ZjOeu34wPgkqsOpfB2xYOwlL5+QkVNq9VQ1in
3zCpxcZdWtwyshXXDm3Db5dtw9ia7Xjatx2e9Ha8mf0SXq5dhR0LV+Hl83g8wfMYI1ZcarYitNGG
p7fasHHGhuoWN16VerC34kXL7sOuK4O4eWUE9xYj+MdmFI9cGMOOjVfj3yNX483WThwZ24XntLsg
M+3Cs9PXoDSRwmu1GSwszWBXNIv7ZXmox/P4wTUFHCkUcGxXEWu9ZUxZK3jEX8HfVCv4551NSBea
OLpyFj9dP4uYaRYH1s5hav21EDwP5quvx8YbrodHdgNe89+Apc4OXj5/L8Z37sVLiZuwKnkTtgx8
GRvW3ooBy604LPsK3h3+U7yk2YffaPdhj3cfvma6DcHKbfiq6XZcRO7AL0N3Yl3qTux33IUfznwD
kuG7Ebn4Hrwyfg/+zHAPzgncg+SWexHd/Bd4c/qbaI/eh19ftB/3p7+FFdd9m/bbB3DY9AAGbA/i
+/hL6Ef/CoWhAzhsPwDBj/Kjc78Dp/e7kOgexhu7HsEb/KPYGnsU+2OP4ZYdB/Fo9SDacwehiv8A
7Zkf4p65H+Eb2b/Fn9d+jL9mfwJ55hAeG30cr7n/Hvtnn8BtmidxbeJJbEs+iVHtYdhTh2Fc+xT2
1Z/C8ul/QOOqp/FK62l8wfMzPB7+Gch5zyGv+jnujv8c1yWex4qF55F0voDvNV/AE9Z/wmrHi3hd
/xL2lf4F3518Gb++4BeoWX+B4SWv4Uj+dVyx+VcIXfYGvh9/A99SvoWB7Fs4fMU7GNn2Dm6uvoPl
3ndxUeg/8JDxP/Hu8j9AVfkD1hveQzH7Pg7sPA7FNccRu6YXivKsOFIhjurjEuFviI5bqUhGJ2NM
eFmf8OlcAg/qqCCPNJJoYhMCyCKHBgz0bBItlGhKuZtihAkWmq5HjBYvwUoJBroF+OCGjSbzCHQL
sMBK2chAz/IIwklTXAicUoBAmZ2PRg9KcGo0oXSRE4XnvEugtmmBZCXdNcUgvbUClQraKHfPnrzG
3ruqR8mLdXHyscCm5jW3S56BVDo0MCgblA7Ijn8RR3RzOLR0sQzxjgLIdauiAUKfJk31EfrcFXou
TjUDHC1HisFBiVSyZEg6uOhWOZnQO8IfP+ZpngTNWaT/MZu62pcNyaQCutr502jX0UbKId7No+7d
sWyQ3vHQAM0jxZHjMqFWerhPzMMj3tXUy0nLOF2+y6H/9HyEtl+cNn+WpqyjfP/28K0X4dgT0tdl
2e710ZLlKUEgvgZB2x34imSxMen7Y2zglLOLr5K1A+i+8z4jiLSP0+LBobLsIA5izx4l+9GUZ8Q3
uNAiP+G0CXwOnCAJCXPjSqGdhvHe+5/YUsMWj/Cz9NjxcyTDkquA18U1fDq3uuF0IrzrhAmE8rTF
rT2NB2Dskm4GEXOiLGJ/d+Z2wlh4tat7lfjfKpGnAiJPGWmPJKdwVA8ySnsNOsbrtJ82u2P8/xY+
oOw3JDnVsS+07ZGb7/vN793ZsYe+NoyNE4+9IsxQmzRhpZh+u9gz7hJH8UFxFnhI5NPn0Zs2v9oL
fsCb4gzxd0LfEK6VCG1B21Ii+Ed6xpzgDdlGf4VYJoukNycPSLpTb1wt6ZFoqjddR1Hs1ULvEma7
goPJ43MHjHzAaCAGNx90Gl2BXtpiX1kj3kOrka4Dp6Z9/DqXYPYUT6Q1K6UPj5XidYIp8PGINBKu
1FPd99oJdI/X+yFEB598PCDW5yI3Doj8OIA++uijjz7+u9BHH3300UcfffTx/w2fZv9LX3z2xXs3
rR77+p3D2Dj1++8J9v976NnoQnq25xJDVbT3rxPt/ZvQWyPYR0X4KPcOcSXmXnER9AH07PfvoOdL
PYievf9jsex/xUft+kWbfOAkWbSXn/nQTl7x4WrPJ/2uGevlO/f06wTLx3pq14jLE88eeeOXR956
81cf6uujjz766KOPPvroo48++uijj/+tWAxZHRDt7EHRhl8i7uu3FD3f/DLRNh8Vv8k+R7TlV6Ln
wz9X9L+fL9r0Ql7BLy5ssjQuxDyLEdhfEA1sIZ0IsR3dWCLgMvR2P7tCcIuL6e9T2UCPd4r/Twm7
bXW/rwQ2o7dblkv0wzNUhMAXTggTFyKjhJ3UqGipbKGyVYgroLK9u7chcJXoj9f1vlEFL/rejcLO
SkIsmBB/QMVKxUbFTsUh+PmpbKTiFtYQqHip+LqxXOjGjAS78XZAuPuFKRClEhOi3NHbzU14jozw
hSKV3UA3GksIyUkKcQ1U0lRmxLUVIcIrRyVPpSDm/eD4HxdC3FoFTRAYu6F9dczjbHABBiWLZQl9
aGhpby3pUC/ZtHjdyTuj7RLqXtx9S0FrLU5roNh98rPHim4E3wmcSZ7hk3bPCtOnryN1SojjmWIc
UsngSftefnaOj0YDDsLf1SrEDgp1b6XaZ7r3VOrG2uXocflTipmk+qXi2D1T/Rd+RP/Hn/zs7kdD
9Z9t/V+KE/qFiMJkN+y0gc+DFZB0Y1zHRE46HcYOkm6/+/jOfOiOVX2XAz4vhimDLj770s/Sf/fU
Kfo/KcT2TDEu1v/IWbS/QuCixKfzv8Azw+JCqHB8tvx/oRgX9Un8L/SBT+P/CXGvWYH/vyhy7un4
X/EZ/C/c+5nyv3DtmfC/6yz5Xyh3x0n8ves0/C+cT4m//5OwgbhD3kQk4AffKvkITyIwj45MtCIG
NXymuDftYIKoRhu1FCmVEXI7fYRL1UD0Rp8xriVSLc4zmiwBfQwhMmHJyU1VqOwkpp7TpxAP2xsp
ElQgUVUXuJmWfDgU1nU2KEiZIK2J6GwWtwu6QKrmNLRjsMrL0YS7Ts+ES7NV0hgdGzGWU3t3TLAh
uLRW5WxAycKorXuJLluj2tzEyWoI5u1z0WyoVp+eJayX3v0FLNRWmzbX0uXANojfmyF16BaI3u3y
E/harrnZgs2FsibJJV2jIzC1yslmrlIGcQUNZp+NR9A16fe4Ak5EdBu2kAlHAaxdHyJGpR6FUqKZ
ZwMWMA1XLqKL21Cwk6QmoCckXvbP6XEJL0fc6koVSCCJgpcoDQGSQ5AECUsMBPGYumJ2qGuyKndI
aciV6P0GTLzTMEV0RO+x6f3TF4eViOuKxFzJhlFvFeV1TcwJYg8piYlQDrakSYYo88NEbTp0kVtH
5mBqZ0m7HrVA64iQciaXhC/Nl+PesPXWst19aLupUr/pwj3TdypIoEIcnTnJINvdZo8wkulLDEmH
NlPMwJ70pAmTdcJeSmZjqrAdxjCJGRzKnMxtn17NhmNlnmpytx3NhQQMJgcJzUa1Y+xM2/T4HuJy
ziU1hs5P/06O1QMMwXrCZ+uT69bfZFnXkTpzqckn1qyaMm1XbpCEjHk94iRVV6ViZbiZlJVUWDsW
FETOBnRx6LUuEnAlyMB0a3otWahE7UboC2Em5lUQVGsklFN5s5LOCpvH1K7kstASNXEkLaNkxJWe
a5LVLtrEDjORk4wBpspsqNTwphFsO/U2sylG4m7Wn9vjoj3DSjLK2aTaimC5FldGOTKdJ5FEukG+
bNLUowtHzbfoJlZPWFA0zaScinkz+FSZL9WtBjjVjRyJBpLTZE7jJAu7rRPgasRUDVXoqHAarQEj
ySJJorpK1mBBieiDqkiyDZNdpWtETNEh/sbYjHvC0iAq2Lx2s7Ok4WX5Umc4r0vWbLShiUJrb9uH
6yR/VKGdyc/B2NaEi2yTdutGQMsrGl40yqRut+TUnVrcPNcaHXn82sF/q0w+PsWm4/IsFK0aX4zP
Z6Cx+IKGTJbWWyJGCmZ9DOaFEHHlNZUx7WypcnQZCengzTYjC0WihEVTdc8bnSHUyl55iJhK0FTM
edu8Pj7mIerkoeXuMrnVWK/vdvrSjemHpCS12ROedTirdHSY6lXlnJl285iRuLTzCLC8u+afsxLb
fMVV06WJB1qN3MppUhwMxE/m/KwNUW5OzYVI/pC9Yi82PNM7pQeQdify6WSTSCfNjXUq1qViZN51
CYvF7EiYkXKmozOuCIHassAr/TaCEN/gPHyUPqqzmWunynIJVps4eSWTDYHomBiraURhIvFUtZgI
wkEy3lDBriHWoHyhfERvnZHsGd/kapUS6bqMfGm3JZBNU2aasOtjRJ8lsHDWeWMw7IEjbwkFZi1K
EENJGfE1LWSm3iKmo2mjCQFdxZvyxO2wRhIpY0Lnh1YxEzfnjSkoTYQNR8qj0pH7b7DadLzeJCHB
OKmTcFIFQ32+FpPXtKiGzPkUsZv3GwqM27x7pZ9cCKPTljc347Ng7L5MO6UPw2OYLdliBi1cTFxl
JnVPR56sWTyjI/zIudNBmWQ9mVzPsCYwaguntDEqOBjOxXEeBiovywU4TRCMKsJwMVYBnlEbGKWZ
BWthVHZG4QSr8jBqL8OOBVhtKC7TxljwPKMysiqzjDXultlYzslB4WKUHkbuBcf6GXWQYWUhbv9S
dYxR6mScds8gw5lp6VZGbWcYJwvOzah8jCYAVh1mlDFGDj2rMzCMiSGclTXYIGPkHTdr8jJK/9Fh
qTIl4zgDIzeBZa2c2kavd7IKN6fzMSNMXMbuljFRRtPRsRzPMMb4KGV5hrEzSmeH1bkZpY89tAx8
iGEijDqWZU16RsodG5ZLaSkc42EYL+Oh1aCSS6NkKQcNz8iNLGvucDorI7ez02PDSve6h2spDVeE
L9NYMMftZnAqo71WzMwgTWLtWIssoFoPJ/OBWFDmiT887ufTOoJkqmiWO+tyxHTKQjKdKErk50T1
MZU5StCMa7xkwVrflk38bjwz/vXVa7fm6og5y85AvW3sJJuBbCQa338l6m5nfDZDCtDF/YowGwvL
Ys0XLp/IOYIphLX+aLjdyCIUJCFFok17RcVQmTfMZDv63EKGqMNEtzxdnGbHypvC2UqnmPY3K/X5
5ycgjxKvX0HHdoZEQ1Y+6AfT4rLNYpVFIj/bsFdT2U7Ony0wutLbWzBvKqYanDUIa7CgJFyxBkWA
uOrqaBkL2qpbayXBTpjJG6xF5YGhIcP0kiOBYDnX3ILt7RSfjdfjSDbT9SnCV85r0ZGoIMO2JEGF
GBUFlauC1qyhzVc0FShJRGPS6pqo6ewVrYMsjKkSHvfD5xP7TCdStNh4jbejgV0bDMnb3AyUBr8v
WLASYlLNuUJPLwnMT1bTged3Ex22bB/49vnHhryECZY0sLCFvD/SzsGrItFqTumBjw+lSVXjkJXa
nSH9QtjgQ6ZuTXsiCfpKL5pzOkXVj0iunprhSBitUlDDtT2srrHN6fI79J5BN/yh+aShZc3C7ucZ
W5KtI8M0uKLGrkAjS0oxoi5LA+SbE+acpl2ROo7tLfrnY3SaEfCqA0QXsSA9E7V5+ZoDVo0tEGLn
g5ceG68PPrytgYe2qX2MRxVk9XqtYlqr27N3q5E1mRnl7o1VG6d0ki/tv1KnVf1Xe28CHsdx34nW
DEASvKThIZmkKLIAUCR1kOruquqZFkV5uufEzAAzmBnMAVEWriFuYHARBHV4AFKy7Cg2ZEfWYSUG
JWdtObaXlhxHyTreIe31s18Sm3LsfUo2uwbtTTZ7k3r7Nnbynrn1r+7CgBTl2Mp+39u87w0+YAaF
7qrqqv/5+/3RjTuIL888hm4iwoLMCHPdjlISo1qC+PU2Stpp5QhFHVTPU2+RN1lEC1LiVlGMBloJ
SVIeFtFQZss6VmhgaqfqZgFGcYh4I8QTMmMNRItPGCRJ6HI7UbPUs07xt+csa349DVNra8h4MoG7
toT0LA1nIp4iU63UeuILu1kqQmNUTzCP3kr0c0fameHquilL1Q6qFritKRJmUhrwhFwB6o2SygMU
xanRSrQkQb52GsgQLcetVYGGOgl7YWIdUydCVT8j7jWIpJmeJV7+Z63ADJPo1QAxQlTFmzzbUILS
NuJNkXqaPr9Ry1NWXEsVdyVCwjQQ4eO2EF+Mhhq3bCMs1XTFGNJRu284mxzsDiE8bEX7i0Nx1Do1
nNencBkNtE0lpsjJnGcwGu49t680N4DwwOwQxeoc6o2d6A8HihqawyODOTyLK2Pt6ZnRSLbrix9t
839q795nP9fE1O4HMSVtjHY9mKYbiCfeUdlEvEXm9jXeRowwVaMvkp7baWVH14N65syOT3iaFgve
0NmHrJZv7loInb+J6Fmm+LfhPCFFdrmgB7gpDjM9Smi1hepx5itve/MhvqiVHZn5HaQ7Td+gJr24
rdy19JBRWb81Xt1PrXM9aeJtyHI7/WCRKKaHKQHib1Ij7OtEc1c3XunrelDpz7tuf8swqdrvvpMv
18TgTrWfZRp7FNetLrQWssB/WY/Qv4VkjmeDa3gWuI1/E6NWbHPbPZ5vQYr5Ctzym39/Ff6l0nXt
jcnvF/9MWb36h9+7efK24Cv6hX1/8kC6/H/9xeeOTV4ciP+zv4qNbv63T1x7Hwan94knP9z559/J
+185/rtrhzb/13aPk5KucaBIma64XA3Ob/DvXg3Xn3b90PbEWkOyA1T7p3xn8j9yft++CkXa9P/K
U0xSIhPPNF0V83ShjGfl00obuv/q1bsEwKY7bfyc+3cg+Wn3yif7r/IqXTyXVlHbCo4z8gv+uXe9
s8Aul4+PtGnLYbdd/FTfhW6Ac9mfN6y0/8VawA/W2lVf/LyW09Qt/7bJZZ/nd6GV//Z1V+yM18N7
ALECNKML/nDdWLc72AD8PiB+3yR+d5+2z2/gf/n2qrPeeb5HHL+w1CTmA2f9FNn///vzX3D8pi2a
e1H8r+ovvn6/wEeuXv3BWhe6iX+tRV9zgwQPnv751euv/6qDfYu1OKPX1mfV/2j7z/hu2L5piyLa
3b9wPjettL+11o0i/Gs77Ecd9Gu9y3jpG7bjz2RX2p9H174WXc548t0Z/yk3DPXOqjnZT9eqz4uu
G7fDC/5/cGnV+X6nEnB57Q/WXr3hqwGtEXem/H7DXHEdcu1Dd6FjKI2OO193IQV5EUMG/2nwzz7U
B+DRj1wr06PoH/b6+f/uQg+ipvkG3vsmAVChynoBXInd4u33wMI57Xc5QHm9OB6hy047AFyYT8qa
38TnuAmlXLV+nnLZ/QCI9YbTvl+MbbcDifFTV61/v9tuBxKi7K71f9Fph8+ozm4HwE2pq7UXnHaY
21N19jyhzzdWHf/XdUhc7318np762vGpersfAOcq9bXj33DaAVxbrq9d18E1djuAdIU1teOfX1Pr
p7qmdvxPnfZH+bUeXFsb93Pr7HZQyLfW1dZhR0Ot/2hDbR2ectoB3HujoTZuw/ra8cr62rhlpx1A
xqX1tX7ectq/CbdZ2bBqnTfW2tGm2ny+vdlu/zrcVHVzrf2Nm+32b8MNa2+uzefcllr7W1tqxy9t
q/V/cVttHZ6/xW6/wNu/fUtt/ovvs9u/xdur76v1/9TOWj/ndtbmf/K22jw/d1tt3IHb7fYq3Irh
9tq4hb21/p/aWxs31Vjrp9JYk1t/c22eA821cZU7av133VEbFx+o9Z86sGp/76z1E72z1r/nbrv9
FG/33V3r/417anr01/esksNDdjtYgsKhWv+LTjuAu9VDtX52HLbbAUSOHl61zodXye3h2vE/PVzT
o4P3rlo35zO6JtpZvNe+Bz5GAPVJpE8CfRLnG4snCwjJIOKTwkouo9tQM1KyMXoij2NGrMdKm77h
YkzCvQ7aW4iI/vcjAHwl3ivhXon2SrDXiIAAm37FDf2v47MSgK/EeyXcK9HeXN4Ep7As4H0AfSXm
KyFfifg6gK9jxMZF3wcRzUnUV4K+EvOVkK+N+C4LuoBK0FdivhLylYivDfjC+gBnI0D+ZbSbn5kY
lvCuRHcluCuxXRvaXRYhSECR8K5EdyW4K7HdMrOv5CH0dn0XH+nt+pMr423lPeQ1ie9KeFeiuxLc
xV44+ipfX939c/QFPl2MqPs2/qkOPev0tA81Ige8ldithG4lcpuMI4Tk+gsEVwK4Er8F+Bb2Hbe1
9vqCzvpj5HN/lQdG+6MwKszhC/y3fehv+ehb+Pt9bhd/P8CPsmeicekJDVkS1JWYroR0JaLLtw2t
zOcAsrFdCe1KZJf34SC7DrAr1uF/c655DdxwBUt8V8K7Et0V4K5p99+IzEEJ8UqE1wZ4p0s4PFk8
hQviOg8gzb2MPCDJEumVQK/EeW2Yt83u984VrFdCvRLplUCvxHkDPLhe5ga/EQHUK5HeoVF+tkB6
JdA7iYdQbV2aEAXMV0K+EvGVgK/Aez9Zv7giTzfxGQnUV4K+EvOVkK9EfAHwXTUOPwvnTIn9SuhX
Ir8S+AXcdwZ9p16OdgvffRvzlZCvRHwl4CvwXqs2TiPCKYn8SuBX4r427BvmmeRaJKDe9n18N1w8
9Db997tdzphNXGME/CvRXwn+SuxXQr+Ofjrwr0R/JfgrsV8B/dqEL0YPuBt5fPQFUeLykri+O5AD
/krsV0K/EvkVwG981fWFwhIBlgCwxH8d+FfYgYsrO7aRj+tgwBIClgiwAIBbjuNMbf3uWIGCJRIs
gWCJAwsY2Lkey/1VdMRFaFiiwBIElhiwhIAlAiwBYIn/AvwLxxidVOK/NMSPEfivhH8l+ptjOmCt
RDOZAQcL+FeivxL8ldivhH4F8ssPIIqD/EI/mnOMjf9K+FeivwSOoRpAJMTnwL8wlsR/HfiXT17C
v4D+imOYKo5RJAQMCHAO+tE6mYSAHQSYL4KWRLYEgnWzuF0ouPYjQIQlICzxYAkHSzQ41V3TKwEK
S0xYQsJ8JRxIWCLCAz1iv+zxYDRbOnaig2hwUgLEDj7MRV7iwxIe7pwujNl2HSBiiRBLgFjiww48
vGLXg27LH3bXtPngCkIsAWKJD0t42EGHrZrdliixBIklRiwhYgchFuMl3G+imBv815uozW2PH3W7
nfEP8d5ivVgCxBIflvCwRIcBHF5lH3H8uAMScy2VILHEiAVEDOv6Jupz2eOlViwJ5l82VCyRYgkU
S5x4dLamdwIulmixBIslViyh4hU//9cr+r2B70lSwsYSNZagscSMsyVnnINIIMcJHmTYyLEEjiVu
LGHjPKxnmut3xUW8aQKwsdBUlWuqKbTZBo+5LAN4zPWeEKGpusCPuZrqpsSPJXxso8f8GCrRYxs8
to9RJX4s4GMYkRWY2gnHAIIsAGRuZswY0UDDKEDIAkHWhZkB82vBxABGFmbGSNBAEswMYMm2KQI4
mc+K+MKMmyIbTwY4mSt0OzPSRHfw5BU4mehgRQBQ5tpPJaAs8WQJJ8O4TAVjw7WfEdGhBJUlpmxD
yhHoR5GYMk3D5AWoTA1YLiJQZQkqw4oRlqrZiLSjtS9xOzGkS5xZwswSZZYgM2DMNT0qzQ1IqFki
zRJodnDmPpxpK6DavjMVLLpAm7lFT1OSZTDbAuDNPtg4G3AmYnMpsZc6A1dkywk30t4QWH2rxdmy
EFyygKD50gkImpthPSAhaBuBboWr1lJUTUNvfDsIWFBKTaoLF8EtsRGD/WVt1EqBcHqzNJQnGoDR
gEVzUVEjjIhj+OTB1XCR4+4oD9sKoDSfmBA56rgscEcsQ3zCHdEC1TupZcHWa2EaFu5ITTA1ScRh
jNjyVmS6LW8RZkThAn3coqe4IMF8aI4LG8ik13JEyBQipMVpQFyg0U7DMHOi5BgsKZ92kFGx9Uac
efkxN9z3O5CB25Ksv2OghDU6diqpqaHUqelTY7NTmLRFxjpxZILMJVbs1z40M3kKk6nOU2rnxEmW
DHZb7SGcH++I0J78TGkqGOhTjEk4urbvlHUywwIH641wzYU58yVizt5RWMYCLKMltoNEaFB6fkUs
I+lgwisSI8CYUFvC47EE4RdFuYPlspQhTGyrLreVCs/va4F+NL6t7c7WB7kmgn4xJUj0MCE8yog7
/bB2ooF+MW8BnLlhMXD4IcrljfCggE+JBwVtsGVqmvpEBKHlqMkPNokSoEFw10RpoeE4bIeaYprY
DppnrAC2yxdgXEhYlGsiMxOOXeLhAwOfT1lRHGNRn5gYl0kT5I2SVhoEOaEkTcPQG9WLTBPqr4XE
/nJZijNbwrksGVmi57moUNUCGfDxYCR6o33n+QIpJWM98b7U6IloJkvCCh7iKWRn/8BMKpfFSo/c
71M92YlowZzqODFszfSPqeHxbpyOjbMe3ShaETyj5U/Ert1vWFAlRXWw8oR7ewNsLmUhYUZjhHK9
Ba3ggRxT4UooCzMSFUucYLpYYiMDwR6EXuJKhEpTYgdyCcqtoQ52n64EhEK7KBPBnjfOh2BKkvAd
5SaGiH5ogTGTeMWq+WytSFAVtIIybol4P9yCFKkujiEh6uMaGCO+BLXahAZmaEiYKj5WmBtWoV0a
6DxhMUYTIBxchrxwJGigIQJCZlECOk+8Ucq43LcSow3iSRKg3NuZEX4uUaQCq1KBeTypCjH1mYw7
DBYmvijEkyQBQxjtoBIKjyeFVKkBKqJl8CXeBPgJX/uN9vtONDYUnm33Yb1HyY0XiqaCT/BQCWdT
g/lo/7RG8SSOTYRLOo45ecHMaCDeNtSXzMwFSzmzrXwCW+rEsNFWiJRODRmJfLim3wasApirAATE
VOugoSKoBXdiCog8V3pwYgzcNdMdR8eMTmch7JibO3MKagoSw82q1wRPzrdKE5E0d7wU5AkMsxc2
ANyj3kJJnFEhDSQDzoSrmk8YGxLkkTHl0QTjjsLuOUvUnOjZAvNggOrAnC3bVHPbIKRNs4TJh60V
tgE0lVHHEYFtoJ3cwDAjBHuvxR0ZUjNgofnpfMu5neN66Y2BbwcDn4awHk40aSgI20ljTLFdcVrY
/jylRWZLnhJmXhFHcCkH/8DjEVhPLuVg2LjY6SID8cadqMHMcm9/4/0OBEPpU3i4f7JcmG6b6g8O
0c5ACGtengsm+8lIe7qjvTs3FS61OvhKuFQYw4Xe7nRuwtc61d0+2Y55Ntc2MZrvGxhLGDnc24mu
03NDqDRfBI2rtMiFvB1Mga2nPFIjQs143sVTKS9PIDqYz7a+AaqGINDzcvPGo7w01XjMJZZIN6nt
KFTu5GMgFVobOHluShXeMzdsnWBHieNshbEQW2+7Yp/FxclRBtpKvCAz1CuCJqUAARHldoTPWUyM
hxghITlqlql5cK1URIW8Zxa3e4Z0ywC7QLyiZy3Kg1PomaZgX7w5J040RWDC5S0gHI4hHBc3BLpw
xXbcyiK2jjB7VnoH2Aj+Jy1AeaanRyBcZXE7QAP3wsWV5Klli2uQBsO2PQK7JhwLI/kbx3GlaawT
31hbz4CKu7OzpcSpFmwUOjtOeiNK3+zEqHeuvcUK1/K9UtKIjI6N4shAPhjIJnrLCqNjHW2zgVQ4
i1uxEsooUzPxaGG4tu9cFKm4IpHBQoTFY09fOzOztjBTKiw+N6PCx/K9pj6xlSwJrpiJvDooIiPK
Iyyhj0REWJRHPSLhZyLC8oIr48MxU9hBJUr5Imjc8ycpE/Jm5CgXKmJytaWG8MA8zg0kbGNCw7CM
lNi7ICTHjvppC9PteJk7zA4QPEVgChA1cLmyowaBKQjxoIat2jJC4ceEYmAZlFbYaJCTDNOEIvOE
gIuoZhFfkHkjtpAzU9gBL8g5uBlmuxmRWNhuxttKTRByLsmwLFoeImJFOHlfCKRd2ATG+IW38VDl
RvvejCKtmM362sM4E5/0GaMDuXhPYaInaBzHxTY8iidx4ZStvg5ejntHiBfruG86nuszIzhyckop
hQ1rLJtrnS4HBofG06XZ9tX67my0kmZmByE5ntZQDS6WgusVgbkuTJM3QagIpXkEoIqN9oJZpmEn
vmMarDDV2xy7qgm7asdlhtggLjBawhEYKnwq7bDVDUJpQ4TJilBkDWJ8Gmp1Yi6I8YUHpXk7GGS6
sJkGj6khvIAOVeGkIGAUQaViUa+IuXwt1IjDCitJGkjz0AFyypDIKXXuyCDqpJS7G55TQugK2RgB
wyIcmQUxoCpMhBcOIyKDESJkB7ky2QURCoogt0U4F24rhNdjEkWyg1wCzot5IQoWmgX56432/QDq
SBtKOZ6mM8mpgpbECUszsmVtAo+ZkcHZaAh7MY3mTnhX8D6eBuOir320O5Xs6Ut2tpToeDR7qtSJ
u0NWcqIvHqr5dW53NMfLQoLJL8YnYi5wZkVqOtmKuBKRjoXtDDQLV6JDFM1EwktVno6JrWIJxp0i
9wfETse4w85xewHbIEwzhMcad5y2dxRJMQ+zVZEUeyHRZortVBKMCAWGeELYdx5m+7ilACWHbdDt
sENostrmgHk042wDM8XkhcgGhUHxtcHkbQemCTfDePAVhLSO5xpexy4z0w77pdxze8EDBZ74q5D4
Q/DlTVFDQBasQC2RivKwNwTRAKHcdgsA0isyPt4JEevD/YoSYZDKgXozA6wS5eJ+Y79+Bwpm8Gzk
eL4bJ9Wx/uOhmfExNjDTm0tb5HgZ84udPTUcKa7o+UGE816c9uESNssBTFOJU90TI3PmQEsE97Wf
0uMkoU4NjpVLq/EZHS7HhhSoKjwoN1sGD+QhSaE8aLNghSmJ0nDMXmFIZrn90jOMctPAF7AAAY0G
UT/zwRryOJeZNv4KiT/YOF+RCiiGeIUdBICFx3kCGeBRdgiMBeTCijQWxM7NO5gO9pEQgdqK1aOq
jJkIbJPj9TXb60OUCUIYsCVQGAsCSRxTQYGpVmQU3DA3KAAasBbYKUNYOn5Fqrx2CtcOUuqV0gUG
RWSyNijEBw3BoNxqMBWmR7zC33AZYy1MQAc8K2KGsCxanvJjNGE17PidR1G6CFn09I3zNe34dLCb
TFnh7vL4kFo08CxOzU5qKj7JAmWft0XmawOziYn4ZDHTNmTNDudxmGBfy3E8NlHCxpgZHKXJCaxd
l58b4KUhALEAL4NMJAhZN1c8pghB54qnRZxdZAKxMtoZ3wytA5Idky9NJyW24kWIwe2f8MA8I/UK
e8yE6Nh5shUChfGuoFHtTBEKQ/K2l4YAnNpu1tYK8LTMSILoGBmqirCIe2MCSQDkt7rIgWmc+tpE
npyhptgzX4EGhdXgexa23b7gFGy/DWBfCuTVFm6tAOZDByiHqs6eUSKgAQIZolBpG2GE2JaaIvyn
AmHUwEIDwsgFzhArRiBahPiXz18XKyZQAyZRA2bK1RAg/432uxHlp/PKCRI5UWxv8+L2WdyNh3Ck
vyOaxXOKhcvjaSd+C48Nl9L5U1N4Mt4/2GG0nSB0otQ33dE+Mzll4AHsnbBmsTnU3VLTbyKSc0g1
xcZ4BWhq2dlsnAbldBVYGshNNMc8MxYVkXMc0BcdPKmgN7JgrohwuFxxhbskLORgnN4EXdH7AJAu
RC3SMJhGnmYzxcZBhTmHtD/NWBbSdb3IfCL+4fbDtLNLodw8qNPBdwPIwYXAB8kCVQUYpsfk5IV7
CWcc9EUVaw2xHw+hwRJDHEWTEC34IMiEY/h+UBHGcHdHIT4ED86FWEtS2wwwHgSCBABwaIFmQ/AW
FJiFJmLyVUEgv0DGBB5BBQwpECYhwe3EyFI1d6P9PojwifxwpzeFTwV7T8ZavaF8xshEW8Y6cBwn
8dR0sBScGcGtEXMlfvPiyGingvOTWnY6MquH9fHeKTKICyPFkwNj5UhPy3R0Ln1NvkYAcKJUXohu
OsmFEXaCLivu4JchJ3hjip2fFgBzgiUKQdjvyIDQN1XYSG72eFhLbDkBIEbA0vFaCmwJWeLHhEzI
zTWx9QxADceTU4EMgHrkbVV08kS+gCpXRRthEXJrg/1G0cmeLJGy8WNCdsSYYkqaMBEEQoBnQkAF
0COkD8xnA73AzBFBHVAiojgbc4A8IkB9Icg1SIvIQAEahGjQC+pNw3Y2Z4MP4PYF9MNj1BRMHibm
2BGYmApRJXdNAvLkkWfrje06LkSz0zgR84WiONyWweU8VhJmeABnDHI8Ojdj7zdGs6HpwGS8vbdt
AJPCTHTMO8gw8xIjcaI3oyV6ySp7DqoAvoQCHgVWmpo5B6oOyFQ13GJD3kwV6bUvCyEzwCd2yCyI
RaNFQJDckksylNpIxipqxJRbHRBRv5504llNBFLcJKgm44ZaC3OhgOVnsEurQFvbl4Py2VtEfTHb
34sEop0ynhJ1QIRHCqDKdjJNhBPRuFsVjkYXblUH6wJuVew5pSIY585IRNlUaxeRmfDlAUEC6ZJw
8sUZt+GCk2AsI8bKM9vU6wIFtvNCEnPQZOCjwRMBcq0VnLwQEKMI5IV64kb7vA+1z3UPxL2jJ9lU
Kw73jMZxH24xT0yxQuf0FI7mp8Y7sgm0Km5rnZwqt2R0qy+PfW14zHd8ciTZizsGi/1hs9wWC1vx
XiUQnE3U9t3xPjq4FabZFlEAqhRU0AFUfbAjYKEN2GKIPIiMPKhYIi/4YhqwrWaQhrlF5GIQY2or
8Qp/TWAZ+cYxvVOEg0Hmc3BtqglvaKQoTQOYbkAwZPMokLRRoRABsMEwaLgNVEcXcRjNgepQUxB4
IeaVuLbRBjaYidSZCsDABsqZJeKwCMSgptTpYFIYEsdxQQwqHBfRHaCc6wrz2kGCSGFtoJynbpoI
JBjgRiB7PhHPcZNvCeCNdNKgnbSFhdFqARiGCJ8G/qrDCSJ95o39OA4rw8cHg7Q3jFP55BSd7RnG
EyxTmo2SEh4Zmo07+Js2gPuSmA16yViuBU97u4/jsd7ECA8uQilzJJMr5crX428sY6fhIn+CdMQx
43w5dEizqGAgwbgFRGjFjwk53AhThXxoCUZtM24Ds1nK8swArpKQVeaXCuRBt+O5DieeYyb4Dtv8
6jHwvNCVjOeMPFOlfIButABQLnAV4ksys50IapcKKBhQdWaKJRZhA2ScCWqIWN4nfAc3JYbtOwLC
d0Qc36G12YIr9BbcEBPBAyAJpkggeGygCStGRRYo0lMHuNNEFgjxgwDubFYKGEXBOCnCeBGLQfbA
o8wo051wkHnthL3jxn58DscJDkdGEoM4bcz2FciEwqbK0xMj6QwujOMUHsHjnekTMyt8Gu3Bg91e
tXW2BWdKoRwt4gDNd4wWTxTwDO6IBkOp0rX77gRdmuQADLH1usjU9bi9wrD1PJ1VBUNlw3HBkJ3O
iqStFSy1JnJiPceo6EezmK1Uagtz8Drw7xAj6cJS2y5ElzSdbxVrSjOgMEFhzX2mgHrCxJABN0Do
Nmu6KnvziezNF4EAj9rMsDBDPO9nAjMhHUCWQGphQvEN4wdHaUDyKDbgbIidsotvwCvAIjBq71SS
+QTlqws+hkLAw7MLkAotLFC+OFXbqFdkrixjU7WAbQYspxgobFNwwkeKHWfCXd3Yvhe0wUlLC5kT
eGiW+WisrfPEEG0ZmukZD1q4N9fXqnv7avYdo+hwoBvHM7i7UA4Xpk/1jwwp/bg9NIbHhzoG8OiQ
3G+fi++fHVBCQZAoG+D7B0CBLgJKTfCeAr925i14YeA2fJJjtWw1M2nQstXMBlKAmNFsjCnJWNpZ
UMGkU02irgBFCdfna6PCScJOex31AFLehgICQLtxqYKN0YUqqgXH/xORYDCBAlEI0wWSmJSQsUBL
NOGTiYgdwScnqFfg7DwEMATCw48JOM4NEBVhI8ApCRvBiMj3DcGjgI0IMuOavGoZZbhupqI4cjI3
1TlcnB46gXMj09r4cHZopvdU3OiYCZ1saR0s47GpfrraD6cH2/p8M/25rDmRiKbM2HBSPxUtRKbT
01O9U8qpEB3K4Ykp3Ym/7DFrkvE+HqkXw7FxLgI+HD5pzOCT/XgIj5h9BLeZhePT/QE8FB1XjYSM
69tzU1ElNprrxGrWbOsteHu8gaKFo5Okd9aM4cDUDG41ErJuB61UQzWiJlTAw7R/INCLC+0n8Alv
ajjaP+nF/fmsGkmGy96Rk3F5Xc0ojfu8VnpwaLB7CqesyVwZDxUj7SPxlrlTODWQHDvRblflwX/K
3YKo2cJIXCdtXi2lG2mvkvXSvFNthlHWfRDlnCvWed9jxdnQSMwIl/BsMIUH8fGTODLYrw951YFy
qj3RcaJnbKWO5Ph4xppND+L87ClSPI5He3Ao0DneH5vuDPbHO4aJgmP9vu6EY/9uF6NZ/sJKVdQt
UIvbgYfJXLonOlRIGn0zUyejEdw/PJhK5NIphosRc9LoycUcM+rURyVj6f5RPJMqhlmqfWJAn2wr
lCZTydZEYMQ30D1aNEshbFecDjsjreNntShh1dcZCU20kLEUnuMhXBiPjrT0FDunfcPeiDY66RsJ
rBrnIIr0z+D2vlQ5048DEQWnw5PtxyOTnXi47KXjMS1TnGkd6TBzqqwbb0JYjeGO7HjOKGIzxRNG
qg4f78Nzge4i7ZtlZaNAav3fiU4lit45NZhRyjhMYuMzmJwc6rGYPhLqOz6d8LYGjndwgRvGJVFf
X175FyvXx76OzOnpycGemWlUwjnr4bbuUf7hKG7KDgyiqeB478xoacwz3bR5w4anre4pl/tp1X6a
mPvwzlxkZLyne6TR9flMubvXNRLubhiZKm16OTBZ6vZMd/eM3LI3NVnCfaXekW60tqVvC/qt7OTM
Zit0stwwPlXavjtbGi2jke7pUrA0Oeg+ccu+wMzU9PjoyOCpM4HTagrtQLuxJzPTg5/40MPJMiqN
HbwTH1CySP47AHL+H6CfFmjFqa8pDzaEaVjrh+Ka+a4+u7gmva+5urF8tzdIuh40os+4buJ20T+o
tV9p8NtFNRcPeuOT9eh280KzFr90SPfbxTTPbCQVp5ama2MDD2KsvVBIU+f3bNtr18wgWTSDZNUM
kmUzFVk3s3elXgbJghkkK2aQLJmpQs3M5g0/2vMv9yyLYpnqhi364n1n0WYISdAj1K2mfdVtBVLd
Zl2Z4U4qQs9NBR5T2reQBh6quMchx42xnvtI1ycTZGkTbeARlmcfeKw0re7Wi9/cTa3HfO6W8/N2
Mcxty82L3uCi9wplSnBJVMKgM/Hp+idZ+RRv467iXHPUsNiXHw1RdIYcuPz45d2XH28jyl41fYb6
LsxD5UvVXXEqXy6e8tuVL+Uo8UDli7WD5pmb+dfZZS//wnN/dNHLzMR0dHH+LqYcLKD7yOWEz9pN
fQvrFw+Wo3qcItK65w+RrHZBstwFyXoXJAtekKx4QbLkBcmaFySLXhCNNsGtb6JIVrkgWeaCZJ0L
cgpdNqMNB+wiFySrXJAsc0GyzgXZhS6bNyDxr/X4KHbVrdtv33EHxQIdbQebiBfJuhckC1+QrHxx
R9Fn7coXJEtfXK4LTuULFqUvrgt6CsnKlwYe1LgvQN3LpjCtbEFTUPZioicEZlHZorvmm52ilxRU
vVSa40hlSBa91DOy0CxKXja6nkDP+dBzUO/yFFVbXa/yZKqypeKUuyxsQbLYBYtqF/RqO6k41S4L
DMlaFySLXZCsdvFAucv8dqLk6plROSaKXRpIkKBtUOyCZJTmQkNOtctCpHK7wAlQAMlqF7cX/Rc7
TkCy3MVv17ugj5KFxPwOUe1S2bGWomb/3aLWBclil8ZKI0QQ7lNjQ0hWtiBZ2oJkbQuSxS1+u7ql
MnlgpbIFydIWJGtbkCxu2Rp+8RFquLj4tiJZ1YJFWQv6rDeIZFkLknUtFaewpdK5qcD8T3zDhJoW
JIta6vzr0NN2TUtBC1L/kL9b8d+aDBI6/wkays+vZQ0BpqKHAXIOMuo+TTIMfYohWcyCZDULFuUs
gVuzpF7N+f9EwHfPh6gx/8fn77FS5zMeKGNxf0qz2JMKmjVPQAVLJdtAksy9H0oOkKxfiTIjNP+4
Fj+zqCpQunL+8/5H9ZBFqj+BuhXzObLG/1zg/BFRs2IFzSkoWfEPtdVV1ro+a9erzFcm7XqV+cls
jKLfV88z4r9V6xIpc+XmpTb9zuU7W2j1Ds11lJoeSOEuHA0EQ0gWpSBZlYJkWQqSdSl+pzDl0TCS
RSlIVqUgWZaCZF3KV3o7/+4Rw5pb2qv558zuB0QRSvcD1ANA0YVhuPGLrECpZ74LRYErukmXZtef
qPgFLUvPjy3VmfR0RccHRO3JeRPJ0pPdPATZiF9Y6g4w8uvnNbp8YPklHpV2PfBtX55UQj5refBM
VwrqTeZDFA96kaw2uYkuf6jrVvc2qDRxmXc7hSYVp9LkkrGdsqbP6Xgky4x1Fb2aatooCkw0ijfS
lEurbtALja51UFxy9igNhFv8z1UeYUrK/wQp8JTmlamlRvbyo777W9krWyvRrtNLR7XANymp3BSh
6tLR8w8jWUlStUtJzJu7ni5DIcmPFy+9sNTorVt+oe4Bu1oEyXIRJOtFkCwYqTgVI2gWHXBKRZCs
FUGyWATJahEky0XuLww/8sBy0v9bSzu9LZ8nS2O+6j2prl9n/tTOpgKlL3/N/1nudRbI0mdFbUjV
p0BtCL4LmVm6P3jp6/4iUxbKJNLASAw/B0UhTezHZZply6+w4pqlElu6WxSEfJwirCWW7qOsp7XB
yFEUAxB3k0WXy/6tUAvyicYh/BQNmwcpaVZOvxzuOiIKQMw/UgArWvqJ/0KBeKD8w/9YiOono5S6
fdVi1/dwXN2Upcvv7/oe4HsHA0TvqQ+hTII8rbTO398dzDANTyFZ8VG1Sz7QZvexM8xc+CAUe+Ar
m3IEX2l8FHDSxuAfQZWH6xglH8mcb9KWX+QXeP7S88QXanzIPc8Y2uuB2o6FRyN8FWUhB5KVHEiW
ckShluOhwqnloxjJAg4kKziQLOFAsoajSxRx/GjPjkeZ6ye3O5Ubfrt0o/Em2mueUO6PcI8VXW6n
j7ZRnD33uLJt+XZP2vdGJ4+k+MeqR7986sW2fVmtKbs0yqzG7O3f30rP3d7b1JXjCf1TtIO6dap3
mqYHijJePqK1UAVKMsq3nJtMsf+uLne9Nkkb/eod5xaXDqSgEGP+DC0fUF1XmpwijKpdhXGxXnF7
oAjj3EM80vDbRRhd0fwGqgzr7WcgY/VACcZiqZWQictNaaYrxtmgNmwdI8rpxOKT3W6CQuTpJJ1v
blxPfbnlzgaidi40Q7lFPfdhY6LcYpfiHmPn7jx3vJMYWNRaILfW8hpb3M7a3qaX7+74/p6Vmgok
iyqQrKpAsqyi4tRVePauVFQgWVKBZE0FkkUVT4a+t+fbe6Cg4uzTz7w5TWkbfob4Xn72yptjRW4d
P1O+u3fTxemGVi6oW6CAgvjvrqS0zu6PLDaq4beYHkEfuDjMquPLDzeQFJ3YBYUTn/aPqTs+XlDm
U63UyJT9drnE4suFN2io89JcKqPs0KuP7E6wSo9yZOI0T6KvXAzkma9qThw933du959eeuLCEbUN
7yWVgxNn/6m2o3rk/Ma37wouP5cohx86v1G7tPb8xq4jTPlk8CUuaHFlR1+BmW83bNVC99KQ+kka
Jb++1KkrG7tGU9SY2LUkih7KycCbX2zgCXrqRah4uBe/MtH15mP+evL2Fi2kQKlDNXM20cb2G8p2
/+kO+t8eCWaQrGhAsqQByZoGJIsaGoYjxfNHoZYByWIGJKsZkCxnQLKe4a1yKb937469pOsrXcbv
ntvjde2iS5Plk8biHywJYL/rBWtpsOj6PRr+Mr28ji0/pVXt8gWPieaeLDT+mqcApQtvbhusfIEr
9M3K5a9MfJgM+S5/xfrya14reXG9sWbxpZSyS9QqbFOtpY8z5dJtVG87zKr65YWlM/r5FCHPm8y4
9CflbTw0/dJn089cxos9NK1u1H7y2FOdhCzVB2ng9QMBzVqqh3qEiSM0BeUIFz8TKAfZ2/rS51uI
suvyneU7PJv/TnG/fjP98s3PLODHpu6YCGbjtOt3Ap697ehz9MlQebP/M0B1Lq8/Q7wLp4G/rpb2
xz0PcPNluENa/utUcfu7q1bdHyx/XH/tw/V6+sdHRUUBkiUFSNYUIFlU0ODztlT3QD0BkgUFSFYU
IFlSgGRNwe98bM+rR42lndHGJ61ziaak+q1ghlz8rloYYYr7oXO6dqXt0m3sm62k67eNdpbasTQ6
0/XHprKl8wqufGrpqPGNy23qEagZUNxd7Y8zrfnc17tuUpoVrfJPQ6bqFpUCmkb+Nv/9xc7Lpxas
6vRp5cr0kiBWr/wben7X2/nqLkre/iH+j551lbtur/yJz2yZnzz/ZI74dhRokJ8RDIfIRKqPRpl/
QclenCOfuPjp6r/LsMwhrbAl8MHUocXvX/rs+V1d31D/w8UW1owfvNiSp94391L2RpCai/de2J/6
M21LMUtDW//I2LqNXFlif0UWH/DfHWeebeWHF/f3Vj7lSWg5/tufeogHsLiFPfnpPJJEvt9h8v8m
giST7wEqf3FPeGwYSRofSR4fSSIfOUz+yB8ih8znSYuTiLhxnc9ORFDaSUSQJPiRZPiRpPiR5PiR
JPmRZPmRpPmR5PmRJPqRZPqRpPqR5PqRJPuRZPuRpPuR5PuRJPwbQlwWmoHud7e5pm22v8nrijGf
6WpmoXpmomcF1e9CzQ7VjyTXv+BDw4LrR82/ocfWfC3pKoczdWUkCX4kGX4kKX4kOX6Xa8Gh+JHk
+JEk+ZFk+ZGk+ZHk+ZEk+t1B9AGb6EeS6bc0dwJ4ftcCbaBhhl4Flh9Jmh8Jnp9noAgfsHl9JIl9
JJl9JKl9JLl9FDE3bziAvRhJYh9JZh9Jah9Jbr8hOpfe/TMg9DdWB7+p6FUoow0iyeUjSeb7bVID
fUhtyDLFRYDL91aSZqTywcgTHzSHuWWSDL4H2LDTTwUpD+4LNn2/8IwC5P3CM9WGkLmJkErBegyY
l4D1WDUPlL1/uKPiUPbV/ViE1vOvqC0Qh77YSunCF6ovPKnznw3A1J9v2EB5R5UhYBY8wNOjRZpj
SPL0SBL1SDL1HqDqqx9qp9RvU/WVV/IVh6pH2ysOVe8P/JNYdcT/YRqofidz3rcvXKjbz9QL31Fj
x1n1Q9UqTbnude0v1NXfW91is/IeoOXPf4iyVtfpRx0CHkkGHkkKHkkO3lU55dDvSPLvSBLwSDLw
HyG75uh8lecBlRySxHu9mVuaFMQ7ksx7MNxyAbcx1fUgQZJ290D265/UQ1QB3r27vjpKtVvQg+mu
elo94S2Qz9DOxjFvcP5h8y/vdweWBm2m/Uw7qfqAabfmkeTZP4St7nsrY0CyV+J/nSHswhPepcPz
Yz8hbnqJ2My6q6veYdarNrVunpy3PhdkxL8jutTB/B0uvMYh1Tef/QitPup+ACgmJAl1JBl1JCn1
WwPVjzY9GTY/QHzxZUGnVzdXP4pSLV2b82xpq25Wnmc9ZnU3j7F7fNXN2oFLcbTb/wHqq3ysQD0Q
Yl+qED2ynYYq8cTC/e1z3Uiy5UjS5Ujy5UgS5u4EOmrz5EgS5Ugy5UhS5Uhy5U/O+tfs/H0gyc1X
P0r9r1b2XHp/guk9uzzAji8fyBPfU0Wq+l8NEqP7iEWWXgNq/HyQfGPp1a5m4MW7mr/xmR1BGvYv
Lb8/Bhhjvc2IXzqwHn2N6V2bge70AB/uP8+TjwatlfgPAh1uVlsFHe5+naSADL/0a6TaFXgFh5Ye
i9Pw0pNJ/L2PsKUnKV5TYBRtW1/5Xoh1LQIHHo0zo+tfJOnSk5qKXs/xdb2necGigeU8PgTk9x1z
wa8luSjv++FSofmHBP8wsPTGUiMw3dazQIyYPa+bz+KbAmSrD2WipPo1PUHDvuWG5d/LUqurvrCl
6wUaDFTeoiT8M9cPWEvle64fVN5y/aB6B/yPURH94JVTYQVJBhtJChtJDttvk9hLRzUkCWwkGWwk
KWwkOex9ufK/+j2W8T9L1b+rvLj8Bav7GN6/9FX8ot94iieAl7qyRF32zZdjNll97s4vX747wlT/
Iz1D9GXPaf8j3fcJirr6wctAUb+V87du23Y58J8rjH0/p7gpWvh+rmvXK2jhbD0PFyqNHRW2ialP
NCongIBeG3Pdd65R0M9nCO12A3WGg3m0cLF+8QRxL+hXHqLz/r0267zUs6UaMIr0bE+Aar+51BO5
WH+2p2u/N+m5O8yWPIu/puVYzwJZBKq5uitEUpVd2mScLt636OaR5L4svRzQC5c/yHO+yfc7DPOm
OJ0aq6wHdvnsj2PALZfrw573f5ylbvG2+s8wb1NrPetY2CMoZCQ5ZCRJZCRZZCRp5Pr0ie5jgkBG
kkFGkkJGkkOuOCTyzXvzB1+cfvbcjDbZb2h7dWOpv4VeXP/yLepeLYMFVXyWx8YFiwYvjF0eDmOt
db1Z1NLL7wMGtYlO1msW66VqyxvMFz93xD9VfpR0LX5Xpy+92fOJLhKxiv6pOqt4catNBDfiNBDB
b24lxvNRpp2bXMol2WK2yet5toPpmpuYZ5gPdQEDrL40RvF65aWFCLv8UOXBrAeo3+7dnZRs52ae
77Y7SgPPXLyrlRhLT3HvetMJo2mX8jkF70Jdpoe9UjnSuCvJfOX6jOsmv031nntQ+7Wze+b76Y+x
2kYrzVvUlzLU2BIi1PwKDWhutlxOrY8vjX3jUrlLBWL3/Eb33hUOF0kSF0kWF0ka1wM8bvVodDiA
JH2LJH+LJIHbJRjcj+35/Tfohc5vvAy87fJrrpYfVV9uLJ9/2U9Sv0vQ0Yu37qx+OEIVN/ptXyst
+FLEn1cOW6eZuZ0G/ZuDZ7t4xts+z2JM2/KbJOVjO5eLGbK4/eKtpEh/QzNNwpY+GqHLt/1seZQb
vk/Ofxrv2bLT85sHLWo07qGefCDeR+ilfTSE1MZPs79ZilbWK4+Ti9nUpxe/VH793zfyfWza4zt3
vvJp/+vfLNBzt/Fw7tynq2f/uXLf0tfO3TYxe25u+eu5xQd/+7W5QHUjDX1jY+JK/6+nTVZ+sewx
isxfcZ2LCaa16U4e6NjkKpLsKpL0KpL8KpIEa30/VXYJXhVJYhVJZhVJahVJbvX+Kf2nz3p3uU82
/rNiuD42XtkrmFQkqVQkuVQkyVS3cf4xm0ZFkkdFkkhFkkn121TqPA/uBkdxsjPbHkGxLDancFsJ
zeJM7+RgeboSGB+bnhwf6bqwwq0iSa4iya4iSa+6T14q2bQqkrwqksQqksxqRVCrmzecWYsOJ7rH
+me6+xtK+KhxCShWJDlWJElWdz6t2HQqknwqkoQqkowqtinVW4+PI0mmIsmmIkmnIsmnKkCoVreU
GkInPN0j+OBXb8EdGEkCFUkGFUkKFUkOtaEnF/NnDiRjaSSpUyS5UyTJUyTZUz8e37whNFZ57rjL
s93hTZEkTl0Xn3eIUySZUw9Qp55Nkf4ZJAlTJBlTJClTJDlTLEjTV9ZkZtw9yl/YjKnfpkwX/zVF
kjJFkjN1Xd53wKZKkeRKkSRLkWRLsaBLK/uGsevc5s0b0P//+l/+9TD/yiAuo/xdQ7/6y4Pcrs3v
4flHVdc7xyfovY2/adVNgv/eE5xj/7nz+WHnCUAP8xmkURLFUAgFxJNcfrnXrvfw/ClQjKrzUPI+
NIgm0Xt/NbyH5y/BM9Gedh75PtlRcVorzjda9Qh0tPJeZ9/MFMk7u8K9XV3iZ3Gt3T7vvL/qvK8X
f3Uj1fm9AW0WN1V80/ld3DOJH/Ez5/fVV+ESN36Gew6vh0GuW+Nf9lWHvuTKO+c/57y/z3lXnLtx
/t/fQte86p32hlVtm2of33meI8ebfsXzFl2/3HjrxKOVqHh3Ob+77WcTfRC96/55VvbNfY1m+sWI
+5DLWQX7rs5/sXb3O/R3zz3IdA6CWx83uH646pa70D4vDnOtKN2ee+/dh+adU+y7E//ZdacgR7L4
a8yZPvrj7udELzv5Qqyvh2f+1+4ZDHcmd6O/FTfxjaBHkCK+NP5NuZaG0SGnRbnmU+Adbau/KNLR
Y3A7RHQYqfzd4N8BdB865uh/hP800eN8lGO8PYla+VcStfEWlbe0ohYUEMdlnBbbesh3r/MpxD8d
RkGU4F/NKCfusz0j7ruN+V+7+W+DiEdCKCzuyI35mWX+NSJaa09Zu/aJaLtd71wHuIkx+wetg4/P
k8GNQletAzyNrZ//7EajYo6D4ul8U/zzQXSSn6GjO8VaDK48uW0cHRfPEEyK2yxDewkdu+Y3FVFx
TgbleXuar81h/p7gq9F8w57kc/mwOPMwUkTvPWiI99Urjkjws3rELK9/ZuHXbigxBCn/oJXSxCxW
r1Sez2CMz3EczfKZH+PXNoemxPXlkS6udwpNi7/D+sH50/xTD9wgjM8+JPZ9hreNv+uz/raKKwlc
c+f2G7Xt2TNcrHPOoStyovFVDvP9CoqrCPDrY3y9w3zUQ3xVFf5t8U8W/3toRYpMZDpXTZ12beXq
35ucBMT1jYprW33UjSUogwbEjpZQn5CgMAoLnQutkqDkKt36+6QQ5If9ivLz56vkJyRuFx7mvQSR
JtYtLPQbPqliZQ8hn5iltrKCCm9XxWfC/2ahgFhB9T3Izyj/fUpc3yC3D9PosLhX/8l3ue7MqiOx
WHf7iZ7jwu7Y469+gXdeizZxN3CT24U8bvvhD9v551v59w53zXJfvSrvqV6z51ff08uF3vm67R4+
2rs+j2D7DW/afvVqs/vdz7l61eP4WeHkDENO1+XCbvn5f/0X+kc0139Mr7cefT32LHqp9bR74eE/
b9ymXnUE86rzEAI7jLrHdSeqc3XdxYOk+vz4ZF9GVVBdfc4y/+bHClpTnx8cU/WPeZyPRPuh/KjT
8BY4srW79/XXFFQPp+hfbHY+eb/EP62rT02Ow4PODn1J4So4Nd03PlL6RBf/zIe+WleH7ELhH71V
a0kePz7YW7plRkE3Oy2tGRtkcTCWPqagTfXZgUFZejx9/28paL1z8MOhE90jM93TpR1/xhth+N5S
38xk6Xdegl/tjpI9Q//u/1F4mH5Nv7/rVlBDvexz6E/5AWcaRJ+y7eFkuTR2/sP8spw/2A+EzC38
E9630+Q8W7GjreO+2nHiKYsFs43PYa3TVBCPQ+y4vdZiiuci/vCLfElRYGAy/jg8WQHqpKedh8X9
9CPwp9Dk5PhHYDHt57m9cqjWg/3stZ965Wq4UKY0UhIPfezk67/BacwPjDuPzup9W667CwX5odOl
N07y7XOWEh56Nf9pBW10jnCefgUPv/oZn+UaFBifGZtWTvBlc47IzpVL2dLJ6Vm+IWucSQn6+elC
bTEEhBbLPneydp6Db5Xa5mujwz4eHVOQG4wZCCt2rxHWEEEYverV4IbfN/zSJsS297vckDHsdtfx
n3vc9fAEGZFNuMRTXt/5cj31WsUlshgXUu5yuxfXo/L2tdE6tOBGfT+pr+cJy27kCPuadnjSgN+9
fa17+9Evujesc4+4tjes3brevbVie5dN7tjW+90bbkWuSa4THr4fD7h3QhAlo6gUl84BdMcHUB13
0ZFHFEXRlHOUKIe4iNYH0IY6902urYpC9cd4yHJYaVaaA9zTcqXsG5/lLjYzN5VP5vV6eqyupB2e
HuGxWDIRwubMdGV8tFs8BbSrDrlPh2z9W8M/VAIiyGqvhG9CuLJlfcV116ZjgbqtG9ZC0FVfh043
CtXccqafxx0VcMu3LPR/prL3xYXGyCM8BAv7ggoN8NjLCpuHVEX1W4esYIhV+s0hs1KilTXaU/2V
P+BxVPcoDg+O8NAIHzzp0+885g+Mj46Oj9Wt51HPYO/k+NQ4d/M4w2WtxGOjZDjcEgjxoOhYayZ5
OJjYlGj+kOd0CqvssEfByZ75v8KJwa6eye7JOXSggm6tRzf7XcJkIKnbsXEU2uNagzJ+1Ot3Iofh
QAdqGau6JquukcrI7OZqw2gVLYyEmMFjoKB2SA1bPPhR1aByyBeuD2vzPiWoKkqF+KzAY83qJ0ca
Rqem3PjweO/J/xi9N3AHPnMHrt5cva2Cmm5eeNWFtl1w3XaPe6f1G7ahQrYFiaANO6rrs9VnwZk3
BSv3cGfuP1lCHfPKru9u1P584+7qVh4IRC2Xar3Bvfk9aI/ldq2550Kj51t3NVkNd1suj+VC7+H1
ifhdz9kSbkc6LpExo2ueXeNC7pVPa97lyyXy7buOBWzJmeyA8yur0nKuIo+v4d+uG3wPOdnwLStp
u2sFELjkvA/eGUt9579HW179nV33/eC7AxWXSJd3ipRZTu6q8GOnP9K9kvzPrbP/dlXAITud30zn
vXvdNfibgn71l4cPstHBL67+kvgTPGjgYRvguWZ8Ff3qL897wN/gRnwz9sfrUL9Zruq/2mv7exj/
mPNca/SO8d8b/rnWeSb3Lzv+Q/AYm9XaAqf9vvN5LXrhXRTpy+4btz9Td+P29Y4SjZ7d+vaXNn03
cfb/mF96oOsLrkv1Nz7+z9bcuJ0f7gZIbHVow6fiBiF2PAs/pO6/1tvzq9pnhfkpbnimSuC+Y6l0
MpI2H9eOBZKtrcm2x9VjrS2BdDLDP+QsE769/EfIy81ogs/YDRfEGzcgtOFn0JeztvWOljc6C/Rh
573r+unWrVl/7Vxu5p0eceYyOd4vTb209NK8T2M7yjtmv6lg2/PJdPBwMmHBFcPCQSQKE7viDH7V
eewVvHY6O/SC815+x8SU6xaJq617rz0xx0lKH0mP2VGpcJMwOEiZ3QTDr3c2/ap4Fpn9Up22Oee9
gla/eOMHYQqJiz899LcP3ub5w79En0fBf5PmcYU79O5rYztBu2nVQtluUHpB6QQTcqL2AoqJ1q+e
qL1OqtP2Hed98ZqJwiS/f6V409f3XtzysbfR0pvI9zW+7W78LuvEHZ6Il8HngazCQ5uui81hIoYj
3ldXZcHdTtuXnfeld0xk+DpJgrbrn3IIbdc/ZBHarn86IrS5N1zbH98VN9huqVhwAZsRuja2h4NA
8FeCeKl+TqDP/755E4/K/StT3+x4tL/3ZePXq7/BIT7mnL5hFQ9xvZWVvAQffL00TW+ucA1I+u0G
mKeTaIy+c1arjcq7wgm/4NUSPNr0SFDRWUAJhg4pCtEPUUslh0zDCB6iLEwVQ/MGAjwgbdq8QQ50
dPWo9+6PKs5r84a27tHS0SbHqvEzoqWRMshQ6eQ0jKTwplxpcooHqlwvyjxi7RkpEe1oEzGIpmmK
AgcEWiNHm0JaSNGoFjQtoq7+hlmkrKNNelAPm5YVsoLUZ4Xsb/63SOBoU9gXNkkooJIwfJMQb968
4cHo+NQ0Dp2cLo31lSZxy9jx8Yc2b1iZunr0EeIjWlCnyqFA2FB4hBgIH/KFKOFrYioBQ1UVhZmP
HeFm9sjqC+Y9c4s2PFXu7i3xDlcvzFGm3YPh2+cl/APx3YPfySm70M+v1m2wpWPtdboCCvvN//If
/s//9Jf/+W1cMx1gQbHhPcSXiwgJa81AEx9WxIHw+bCcw2Ef+m/GaxPo/7Mvl4PPlh109Fd9bX0P
8Q88BWES/c97/arj/89+/WMe/38AUEsBAh8AFAAAAAgANKsNSYERLvVcYgAAANwAAAUAJAAAAAAA
AAAgAAAAAAAAADEuZG9jCgAgAAAAAAABABgAAKoqGJD10QGJpn0mkPXRAYmmfSaQ9dEBUEsFBgAA
AAABAAEAVwAAAH9iAAAAAA==

From theguesthouseandcottage@yahoo.com  Tue Oct 24 13:54:37 2017
Return-Path: <theguesthouseandcottage@yahoo.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id D7D483C13F
 for <wg-camlp4@lists.ocaml.org>; Tue, 24 Oct 2017 13:54:37 +0100 (BST)
X-Cam-SpamScore: sssssssss
X-Cam-SpamDetails: score 9.8 from SpamAssassin-3.4.1-1799552 
 *  1.3 RCVD_IN_RP_RNBL RBL: Relay in RNBL,
 *      https://senderscore.org/blacklistlookup/
 *      [60.182.78.55 listed in bl.score.senderscore.com]
 *  0.0 RCVD_IN_SORBS_DUL RBL: SORBS: sent directly from dynamic IP address
 *      [60.182.78.55 listed in dnsbl.sorbs.net]
 *  0.5 RCVD_IN_SORBS_SPAM RBL: SORBS: sender is a spam source
 *  2.7 RCVD_IN_PSBL RBL: Received via a relay in PSBL
 *      [60.182.78.55 listed in psbl.surriel.com]
 *  0.0 HEADER_FROM_DIFFERENT_DOMAINS From and EnvelopeFrom 2nd level mail
 *      domains are different
 *  0.0 FREEMAIL_FROM Sender email is commonly abused enduser mail provider
 *       (theguesthouseandcottage[at]yahoo.com)
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  0.7 MIME_HTML_ONLY BODY: Message only has text/html MIME parts
 *  1.4 PYZOR_CHECK Listed in Pyzor (http://pyzor.sf.net/)
 *  0.8 RDNS_NONE Delivered to internal network by a host with no rDNS
 *  0.0 LOTS_OF_MONEY Huge... sums of money
 *  0.5 MISSING_MID Missing Message-Id: header
 *  1.4 MISSING_DATE Missing Date: header
 *  0.2 FREEMAIL_FORGED_FROMDOMAIN 2nd level domains in From and
 *      EnvelopeFrom freemail headers are different
 *  0.4 HTML_MIME_NO_HTML_TAG HTML-only message, but there is no HTML tag
 *  0.0 TO_NO_BRKTS_NORDNS_HTML To: lacks brackets and no rDNS and HTML
 *      only
X-Cam-ScannerInfo: http://help.uis.cam.ac.uk/email-scanner-virus
Received: from [60.182.78.55] (port=3979 helo=aroundworldnic.cc)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with smtp id 1e6ynX-0004gP-p3 (Exim 4.89) for wg-camlp4@lists.ocaml.org
 (return-path <theguesthouseandcottage@yahoo.com>);
 Tue, 24 Oct 2017 13:59:18 +0100
From: "Julie J" <alessia@alessianails.ro>
To: wg-camlp4@lists.ocaml.org
Content-Type: text/html;
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] $400 payment
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
Reply-To: julie@exposureincrease.ru
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
Date: Tue, 24 Oct 2017 12:54:37 -0000
X-List-Received-Date: Tue, 24 Oct 2017 12:54:37 -0000

<p><font face=3D"Arial"><b><font size=3D"2">Please do&nbsp; NOT&nbsp; </fo=
nt>REPLY<font face=3D"Arial" size=3D"2">  
</font>to this email,&nbsp; as this email box is not monitored.</b><font s=
ize=3D"2"><b><br />  
</b>  
<br />  
<b>  
if you want to contact us,&nbsp; please&nbsp;<a href=3D"mailto:xiachuonei@=
163.com?subject=3Dworldwide emails">click 
here</a>  
</b>  
</font></font></p>    
    
    
<pre><font face=3D"Arial"><font size=3D"2"> <b>
</b>
</font></font><font face=3D"Arial"><b><font size=3D"2">If you don't want t=
o receive emails any more, please <font color=3D"#0000FF">Unsubscribe   wg=
-camlp4@lists.ocaml.org</font></font></b></font></pre>
   
   
<p><font face=3D"Arial" size=3D"2"> 
Hi,<br /> 
<br /> 
<pre><tt><font face=3D"Arial" size=3D"2">We provide <b><font color=3D"#ff0=
000">E-mail addresses databases</font></b><font color=3D"#ff0000"><b> </b>=
</font> , email lists .
 


High quality Emails, High quality Email addresses, High quality Email list=
s. </font></tt></pre>
</font>
<pre><font size=3D"3" face=3D"Verdana"> 
 Australia 	1087139	Email Addresses		$400 USD
 Austria 	386081	Email Addresses		$300 USD
 Belgium 	358868	Email Addresses		$300 USD 
 Brazil 	907746	Email Addresses		$400 USD 
 Canada 	1288691	Email Addresses		$400 USD  
 Colombia 	189533	Email Addresses		$190 USD 
 Czech Republic 	1236800	Email Addresses		$400 USD
 Denmark 	506201	Email Addresses		$400 USD 
 Estonia 	278385	Email Addresses		$250 USD 
 Finland 	359458	Email Addresses		$300 USD
 France 	1393935	Email Addresses		$400 USD 
 Germany 	3678748	Email Addresses		$500 USD 
 Greece	351383	Email Addresses		$250 USD
 Hong Kong 	123036	Email Addresses		$120 USD
 Hungary 	422919	Email Addresses		$400 USD 
 India 	228290	Email Addresses		$200 USD
 Indonesia 	96457	Email Addresses		$100 USD
 Israel 	208940	Email Addresses		$200 USD
 Italy 	1207026	Email Addresses		$400 USD
 Japan 	1170301	Email Addresses		$400 USD
 Korea 	261872	Email Addresses		$250 USD  
 Malaysia 	111748	Email Addresses		$100 USD 
 Mexico 	175569	Email Addresses		$170 USD 
 Netherlands 	932295	Email Addresses		$400 USD 
 New Zealand	398340	Email Addresses		$300 USD 
 Norway 	488707	Email Addresses		$400 USD  
 Poland 	796495	Email Addresses		$400 USD
 Portugal 	164443	Email Addresses		$160 USD 
 Russian Federation 	2006321	Email Addresses		$400 USD 
 Singapore 	106219	Email Addresses		$100 USD
 Slovakia 	244011	Email Addresses		$240 USD
 South Africa 	360808	Email Addresses		$250 USD
 Spain 	430095	Email Addresses		$400 USD
 Sweden 	655349	Email Addresses		$400 USD
 Switzerland 	641143	Email Addresses		$400 USD 
 Taiwan 	314926	Email Addresses		$200 USD
 United States 	888530	Email Addresses		$400 USD
 
 We have database for all countries, For more countries, please <b>contact=
 us,&nbsp; please&nbsp;<a href=3D"mailto:xiachuonei@163.com?subject=3Dworl=
dwide emails">click here</a></b></font><font face=3D"Arial" size=3D"2">

</pre>

All these years, I have seen thousands of companies growing using the most=
 powerful marketing tool "Email Marketing"!<br />     
<br />     
We&nbsp; can help your business reach the next level, we have helped hundr=
ed's of businesses go viral and also increase their client base within 30 =
days.<br />     
<br />     
apart from email lists(email address database),  we also Provide:<br />   =
  
<br />     
We can send unlimited email campaigns for you all over the world<br />    =
 
We can send out newsletter's on your behalf to promote your business.<br /=
>     
We can send out Millions of emails for you.<br />     
We have High Quality data! We use our updated database to promote your bus=
iness.<br />     
<br />     
Advertise your business using the most powerful tool's in the market and s=
ee the difference it makes"<br />     
<br />     
What we require:<br />     
<br />     
Subject Line<br />     
Your Email Message or the Newsletter<br />     
<br />     
Sit back, relax and watch the clients coming in and your business grow!!!<=
br />     
<br />     
Basic Pricing:<br />     
<br />     
2 Million bulk emails only for $399<br />     
10 Million bulk emails only for $999<br />     
<br />     
</font><p><font face=3D"Arial"><b><font size=3D"2">Please do&nbsp; NOT&nbs=
p; </font>REPLY<font face=3D"Arial" size=3D"2">  
</font>to this email,,&nbsp; as this email box is not monitored.</b><font =
size=3D"2"><b><br />  
</b>  
<br />  
<b>  
if you want to contact us,&nbsp; please&nbsp;<a href=3D"mailto:xiachuonei@=
163.com?subject=3Dworldwide emails">click 
here</a>  
</b>  
</font></font></p>    
    
    
<pre><font size=3D"2"> <b>
</b>
</font><font face=3D"Arial"><b><font size=3D"2">If you don't want to recei=
ve emails any more, please <font color=3D"#0000FF">Unsubscribe   wg-camlp4=
@lists.ocaml.org</font></font></b></font></pre>
   
   
   
   
   
<p><b> 
<font face=3D"Arial" size=3D"2"> 
Yours Truly    
</font></b>    
</p>  
   
    
    
    
    
<p><b><font face=3D"Arial" size=3D"2">Julie J</font></b></p>



From info@omniumentertainment.com  Thu Nov 16 17:29:10 2017
Return-Path: <info@omniumentertainment.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-43.csi.cam.ac.uk (ppsw-43.csi.cam.ac.uk [131.111.8.143])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 79C193C097
 for <wg-camlp4@lists.ocaml.org>; Thu, 16 Nov 2017 17:29:10 +0000 (GMT)
X-Cam-SpamScore: sssss
X-Cam-SpamDetails: score 5.9 from SpamAssassin-3.4.1-1799552 
 *  0.0 HEADER_FROM_DIFFERENT_DOMAINS From and EnvelopeFrom 2nd level mail
 *      domains are different
 * -0.0 BAYES_05 BODY: Bayes spam probability is 1 to 5%
 *      [score: 0.0129]
 *  1.4 PYZOR_CHECK Listed in Pyzor (http://pyzor.sf.net/)
 *  1.9 MISSING_MIMEOLE Message has X-MSMail-Priority, but no X-MimeOLE
 *  0.8 RDNS_NONE Delivered to internal network by a host with no rDNS
 *  0.5 MISSING_MID Missing Message-Id: header
 *  1.4 MISSING_DATE Missing Date: header
X-Cam-ScannerInfo: http://help.uis.cam.ac.uk/email-scanner-virus
Received: from [36.22.90.47] (port=2178 helo=aroundworldnic.cc)
 by ppsw-43.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with smtp id 1eFO4A-0005BY-nU (Exim 4.89) for wg-camlp4@lists.ocaml.org
 (return-path <info@omniumentertainment.com>); Thu, 16 Nov 2017 17:35:12 +0000
From: "Jessica" <jessica@exposureincrease.ru>
To: wg-camlp4@lists.ocaml.org
X-Priority: 1
X-MSMail-Priority: High
Content-Type: text/plain;
Content-Transfer-Encoding: quoted-printable
Subject: Re: [wg-camlp4] leads generation
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
Reply-To: jessica@exposureincrease.ru
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
Date: Thu, 16 Nov 2017 17:29:10 -0000
X-List-Received-Date: Thu, 16 Nov 2017 17:29:10 -0000

Hello,

Hope you are doing well! My name is Jessica from MarketReach Inc. We speci=
alize in providing email marketing, lead generation and Appointment bookin=
g services.

The data we use is C-Level i.e business owners and decision makers, based =
on our clients response all our leads are simpler to get hold of and easie=
r to convert!

Our packages start from $199 where you could market your business or produ=
cts to over 600,000 people using the most effective marketing tool - Email=
 marketing!

I would like to discuss your requirements.. Looking forward to your respon=
se!

Warm Regards

Jessica Huntley
MarketReach INC



From notificaciones2@jindalaimexico.com.mx  Tue Jun 19 11:49:22 2018
Return-Path: <notificaciones2@jindalaimexico.com.mx>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-31.csi.cam.ac.uk (ppsw-31.csi.cam.ac.uk [131.111.8.131])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id B76AE3C09D
 for <wg-camlp4@lists.ocaml.org>; Tue, 19 Jun 2018 11:49:22 +0100 (BST)
X-Cam-SpamScore: ss
X-Cam-SpamDetails: score 2.4 from SpamAssassin-3.4.1-1833685 
 *  1.7 URIBL_BLACK Contains an URL listed in the URIBL blacklist
 *      [URIs: ipic.su]
 * -0.7 RCVD_IN_DNSWL_LOW RBL: Sender listed at http://www.dnswl.org/, low
 *      trust
 *      [148.251.71.21 listed in list.dnswl.dnsbl.ja.net]
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0016]
 *  0.0 HTML_MESSAGE BODY: HTML included in message
 *  1.6 HTML_IMAGE_ONLY_24 BODY: HTML: images with 2000-2400 bytes of words
 *  0.1 DKIM_SIGNED Message has a DKIM or DK signature, not necessarily
 *      valid
 * -0.1 DKIM_VALID Message has at least one valid DKIM or DK signature
 * -0.1 DKIM_VALID_AU Message has a valid DKIM or DK signature from
 *      author's domain
X-Cam-ScannerInfo: http://help.uis.cam.ac.uk/email-scanner-virus
Received: from mx26-out21.antispamcloud.com ([148.251.71.21]:41208)
 by ppsw-31.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.147]:25)
 with esmtps (TLSv1.2:ECDHE-RSA-AES256-GCM-SHA384:256)
 id 1fVEUJ-000C8j-Kg (Exim 4.91) for wg-camlp4@lists.ocaml.org
 (return-path <notificaciones2@jindalaimexico.com.mx>);
 Tue, 19 Jun 2018 12:07:52 +0100
Received: from ka.hosting-mexico.net ([69.162.114.74])
 by mx36.antispamcloud.com with esmtps
 (TLSv1.2:ECDHE-RSA-AES256-GCM-SHA384:256) (Exim 4.89)
 (envelope-from <notificaciones2@jindalaimexico.com.mx>)
 id 1fVEU7-0008Eo-OC; Tue, 19 Jun 2018 13:07:41 +0200
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed;
 d=jindalaimexico.com.mx; s=default; h=Content-Type:MIME-Version:Date:Subject:
 To:From:Reply-To:Message-ID:Sender:Cc:Content-Transfer-Encoding:Content-ID:
 Content-Description:Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc
 :Resent-Message-ID:In-Reply-To:References:List-Id:List-Help:List-Unsubscribe:
 List-Subscribe:List-Post:List-Owner:List-Archive;
 bh=ibPtxr9xAqxpysYhPkgWC5ebN50iEXGs7D/lq+76bBY=; b=qgZbnSpuskF3EE0lNQu91g3CXa
 EiOMo9yNcgnSZHmQ7xh1H9bUiKQxVbu3/4vII7CVhzRxWVF5OLBQDgYpS0VwxVO77aMwuNFq2t7kb
 7jrmdIxLf7SyYPJYGBNIJ6j2YEOf16QNUvcRZlDTUQ2b/OTm9wTtgoVEpmkz0RpCeE3Hb0dnreygo
 /+5OeVs01/JawsrpV98lFcMt4ri8a20j45fM5qy0oIic47Yvk+TaLEWj1fldvHCL/xI0IKmWQI6MM
 jMVs5PXcDLZ5FXRabUudj2raSlh60ELnwi6PaOnY2g26GFsFZx2T4kefRnyu9VgI+fVd6oSNLmas+
 9UyQa49g==;
Received: from [59.27.249.166] (port=34945 helo=rvnxugtnhyy)
 by ka.hosting-mexico.net with esmtpsa
 (TLSv1.2:ECDHE-RSA-AES256-GCM-SHA384:256) (Exim 4.91)
 (envelope-from <notificaciones2@jindalaimexico.com.mx>)
 id 1fVEU2-00051G-NQ; Tue, 19 Jun 2018 06:07:36 -0500
Message-ID: <a713eebdb69d4844632690c337f15b577f496e9a@jindalaimexico.com.mx>
From: "Fedex" <notificaciones2@jindalaimexico.com.mx>
To: <dave@newdaymedia.co.uk>, <francis@ceplc.net>, <lee@ccwcservices.co.uk>,
 <wg-camlp4@lists.ocaml.org>, <neville@ec1counselling.co.uk>
Date: Tue, 19 Jun 2018 14:06:57 +0300
Organization: Fedex
MIME-Version: 1.0
Content-Type: multipart/alternative;
 boundary="232690c3c81c32815d5811afdb0f2e8763e6"
X-Originating-IP: 69.162.114.74
X-AntiSpamCloud-Domain: ka.hosting-mexico.net
X-AntiSpamCloud-Username: 69.162.114.74
Authentication-Results: antispamcloud.com; auth=pass
 smtp.auth=69.162.114.74@ka.hosting-mexico.net
X-AntiSpamCloud-Outgoing-Class: unsure
X-AntiSpamCloud-Outgoing-Evidence: Combined (0.69)
X-Recommended-Action: accept
X-Filter-ID: EX5BVjFpneJeBchSMxfU5v3dVI5eIl3qMx/WWC+fARt602E9L7XzfQH6nu9C/Fh9KJzpNe6xgvOx
 q3u0UDjvO3H+Ol5HJz2ql1aQPptihVPU78usqvEMqfEVNBNzntzbH2IXfLlI2WKFHkuTczYGYMit
 H/9iCHpjc48gQrDdUEr13cBt7WWtkVsAXP9GWOveQaXPwIlI4yu/PH1NWDdGRbsReCk+ciLS5+l0
 xo9ti37+x68890tW+PPtvXhEU0hLfQ40CtYdRj93CTvRXJ5+WF9l1/WyLBg0mKuTgAEprJHTf4rs
 m7+rFGG8cMBPkvJHrVC/+yNQNct2brDWA2/V61TOSHe/hgDby7WzCijt29dsUzx7VEFrqix7FoAo
 NR5dQoePwaFK+dcbpqoA75ADnD2/XKWyzdpoQkLhCP0phap3wmjblgqUqmSDl77lKihcEx7cO2lp
 tfhhwgJnoQrsKxqFnVau+FLmYVo8nL6HhTuyxoGniqsJcYtH8XC2bzZr5YE5enyccp7RH4WQio3u
 GWXO0Xj7HUEPEbu0nPZRln1WBb39uS1TjWG2Inx+Ts2QwxO+9yalkPwznrBYSgtTH8dU0xkDwv/G
 mxRfaMDoXQFmkuQWtFZiqV8yp0iSAt2OOwc9xHB8kAGwnlca6p4Wm3ytesG62MRnWbKlrMLO1Zia
 TQIXVemLMQyS0cqq3YQHkHm8GPbXpG5MUdfIx6m/Zg2cA3ManfpRl0WlWPFIatDb9N4V40rqwWiO
 F30QJqT5rFforEA8S32jXIGkcSEmdtmtBK+ZT0wL3gp0jCgaGOvyOPtmI/92/bTEz1VlWPqsy+mh
 Wfp+PcW3CyyZcySfsJ3w7bFbJtlrWz+ae6G33x0WxVzw6JTxlEBcF0wHBO63yfpCtBMIsmwVh9OO
 Zn6aSSjp6z0tlv9dYlcTNfyWqI3rGlUY2jbf3Q54l9HRkQvIbwM/5hBnK/HE7+KoDeUGJWeJaB4t
 v66QYnWFKSDs6mxUVA+9OyHDrkjLgXyEVi6gmdySlZou9qHIGOZDEEo7OziDHV4KdvCkAVHnYPbR
 YP8PbYOQO8NpshVilaXlW3uttjLRBep36lH0G4twIxavpw==
X-Report-Abuse-To: spam@quarantine1.antispamcloud.com
Subject: [wg-camlp4] Parcel Cannot Be Sent
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
Reply-To: Fedex <noreply@fedex.com>
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Tue, 19 Jun 2018 10:49:22 -0000

--232690c3c81c32815d5811afdb0f2e8763e6
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: quoted-printable

6/18/2018

Dear Customer,

We are sorry to inform you, someone has sent a parcel having the weight t=
hat exceeds the limit of commission-free weight value. The parcel was req=
uested for sending on your behalf.

In this regard, the extra fee comes to &pound; 32.54.

In order to send the parcel successfully, please pay this amount within o=
ne business day.

Please feel free to find more details here:

The file contains full description and further recommendations.

Sincerely Yours, Fedex Customer Relations Department

John K. Redhouse

Senior Manager

Fedex Group

john.redhouse@fedex.com

--232690c3c81c32815d5811afdb0f2e8763e6
Content-Type: text/html; charset="utf-8"
Content-Transfer-Encoding: quoted-printable

<HTML><HEAD><TITLE>FEDEX</TITLE>
<META http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dutf-8">
</HEAD>
<BODY title=3D"">
<META content=3Die=3Dedge http-equiv=3Dx-ua-compatible>
<META name=3Dviewport content=3D"width=3Ddevice-width, initial-scale=3D1"=
>
<STYLE type=3Dtext/css></STYLE>

<DIV style=3D"HEIGHT: 625px; WIDTH: 590px; MARGIN: 10px auto">
<DIV><IMG alt=3D"" src=3D"http://ipic.su/img/img7/fs/fedex.1528991612.jpg=
" width=3D160=20
height=3D50></DIV>
<DIV=20
style=3D"PADDING-BOTTOM: 0px; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING=
-LEFT: 5px; PADDING-RIGHT: 5px">
<DIV style=3D"MARGIN-TOP: 20px">6/18/2018</DIV>
<DIV style=3D"MARGIN-TOP: 20px"><B>Dear Customer,</B></DIV>
<DIV style=3D"MARGIN-TOP: 20px">We are sorry to inform you, someone has s=
ent a parcel having the weight=20
that exceeds the limit of commission-free weight value. The parcel was re=
quested for sending on your behalf.</DIV>
<DIV style=3D"MARGIN-TOP: 20px">In this regard, the extra=20
fee comes to &#163; 32.54.</DIV>
<DIV style=3D"MARGIN-TOP: 20px">In order to send the parcel successfully,=
=20
please pay this amount within one business day.</DIV>
<DIV style=3D"MARGIN-TOP: 20px">Please feel free to find more details her=
e: </DIV>
<DIV style=3D"MARGIN-TOP: 20px"><A href=3D"http://sottmar.com/tracklist/t=
racking_number.pdf.exe" rel=3Dnoopener=20
target=3D_blank><BUTTON=20
style=3D"BORDER-LEFT-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px; BACKGROUND: non=
e transparent scroll repeat 0% 0%; BORDER-BOTTOM-WIDTH: 0px; PADDING-BOTT=
OM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BORDER-=
TOP-WIDTH: 0px"><IMG=20
alt=3DButton=20
src=3D"http://ipic.su/img/img7/fs/fedex-btn.1529229317.jpg"></BUTTON></A>=
</DIV>
<DIV style=3D"MARGIN-TOP: 20px">The file contains full=20
description and further recommendations.</DIV>
<DIV style=3D"MARGIN-TOP: 20px">Sincerely Yours, Fedex Customer=20
Relations Department</DIV>
<DIV style=3D"MARGIN-TOP: 25px">
<P style=3D"MARGIN: 0px">John K. Redhouse</P>
<P style=3D"MARGIN: 0px">Senior Manager</P>
<P style=3D"MARGIN: 0px">Fedex Group</P>
<P=20
style=3D"MARGIN: 0px">john.redhouse@fedex.com</P></DIV></DIV></DIV></BODY=
></HTML>

--232690c3c81c32815d5811afdb0f2e8763e6--

From suaad@sudafast.edu.sd  Thu Jun 21 11:04:37 2018
Return-Path: <suaad@sudafast.edu.sd>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 2D6203C0BC
 for <wg-camlp4@lists.ocaml.org>; Thu, 21 Jun 2018 11:04:37 +0100 (BST)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.4.1-1833894 
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0000]
X-Cam-ScannerInfo: http://help.uis.cam.ac.uk/email-scanner-virus
Received: from ns1.goiasprev.go.gov.br ([187.4.158.171]:31451
 helo=claro.goiasprev.go.gov.br)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtps (TLSv1.2:ECDHE-RSA-AES256-GCM-SHA384:256)
 id 1fVwk8-000w81-gJ (Exim 4.91) for wg-camlp4@lists.ocaml.org
 (return-path <suaad@sudafast.edu.sd>); Thu, 21 Jun 2018 11:23:13 +0100
Received: from claro.goiasprev.go.gov.br (localhost [127.0.0.1])
 by claro.goiasprev.go.gov.br (Postfix) with ESMTPS id 682A22011B558;
 Thu, 21 Jun 2018 07:20:11 -0300 (-03)
Received: from localhost (localhost [127.0.0.1])
 by claro.goiasprev.go.gov.br (Postfix) with ESMTP id 560712011B74F;
 Thu, 21 Jun 2018 07:20:11 -0300 (-03)
Received: from claro.goiasprev.go.gov.br ([127.0.0.1])
 by localhost (claro.goiasprev.go.gov.br [127.0.0.1]) (amavisd-new, port 10026)
 with ESMTP id 0mMqbzcWhjSq; Thu, 21 Jun 2018 07:20:11 -0300 (-03)
Received: from uopzrgnhvmqmgm (unknown [220.117.116.132])
 by claro.goiasprev.go.gov.br (Postfix) with ESMTPSA id D9B1C2011B558;
 Thu, 21 Jun 2018 07:20:00 -0300 (-03)
Message-ID: <a002b4e7ecc7ede5797cca6680d4fefecc7d37@sudafast.edu.sd>
From: "WannaCry-Hack-team" <suaad@sudafast.edu.sd>
To: <wg-camlp4@lists.ocaml.org>, <leonardo@londongolf.co.uk>,
 <rweston@royweston.me.uk>, <cust-serv@dgos.co.uk>, <ball@dick.co.uk>
Date: Thu, 21 Jun 2018 13:22:24 +0300
Organization: Wanna-Cry
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8";
Content-Transfer-Encoding: quoted-printable
Subject: [wg-camlp4] Warning WannaCry-Team
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
Reply-To: WannaCry-Hack-team <support_wc@bitmessage.ch>
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Thu, 21 Jun 2018 10:04:37 -0000

Hello! WannaCry returned! All your devices were hacked with our program i=
nstalled on them. We have upgraded operation of our program, so you will =
not be able to recover your data after the attack.=20
All the information will be encrypted and then erased. Antivirus software=
 will not be able to detect our program, while firewalls will be emascula=
te against our one-of-a-kind code.=20
Should your files be encrypted, you will lose them forever.=20
Our program also covers the local network, erasing data on all computers =
connected to the network and remote servers, all cloud-stored data, and b=
locking website operation. We have already deployed our program on your d=
evices.=20
Deletion of your data is scheduled for June 22, 2018, at 5:00 - 10:00 PM.=
 All data stored on your computers, servers, and mobile devices will be d=
estroyed. Devices working on any version of Windows, iOS, macOS, Android,=
 and Linux are subject to data erasion.=20
In order to prevent data demolition, you can pay 0.1 BTC (~$650) to the b=
itcoin wallet:15TEifb6Dwvbvr2DQHs9PW2nXkYCWVZPFr=20
You must pay timely and notify us about the payment via email until 5:00 =
PM on June 22, 2018. After payment confirmation, we will send you instruc=
tions on how to avoid data erasion and such situations from now forward. =
Should you try to delete our program yourself, data erasion will commence=
 immediately.
To pay with bitcoins, please use localbitcoins.com or other similar platf=
orms, or just google for other means. After payment write to us: support_=
wc@bitmessage.ch=20

From uhnombn@wistem.co.ua  Mon Aug 13 14:20:40 2018
Return-Path: <uhnombn@wistem.co.ua>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id C4B673C462;
 Mon, 13 Aug 2018 14:20:40 +0100 (BST)
X-Cam-SpamScore: sss
X-Cam-SpamDetails: score 3.0 from SpamAssassin-3.4.1-1837891 
 *  2.0 BAYES_80 BODY: Bayes spam probability is 80 to 95%
 *      [score: 0.8917]
 *  1.0 FROM_EXCESS_BASE64 From: base64 encoded unnecessarily
X-Cam-ScannerInfo: http://help.uis.cam.ac.uk/email-scanner-virus
Received: from mail.wistem.co.ua ([81.171.29.41]:52492)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtp id 1fpDSK-000h4Y-11 (Exim 4.91)
 (return-path <uhnombn@wistem.co.ua>); Mon, 13 Aug 2018 15:04:25 +0100
Received: from wistem.co.ua (MTND934.cs1local [81.171.29.41])
 by mail.wistem.co.ua (Postfix) with ESMTPA id 0C4F763200;
 Mon, 13 Aug 2018 16:58:42 +0300 (EEST)
Message-ID: <4d7701d43326$e7bb4290$cb3ee024@uhnombn>
From: "=?windows-1251?B?7OLi?=" <uhnombn@wistem.co.ua>
To: <wg-camlp4@lists.ocaml.org>
Date: Mon, 13 Aug 2018 16:58:49 +0300
MIME-Version: 1.0
Content-Type: text/plain;
	charset="windows-1251"
Content-Transfer-Encoding: 7bit
X-Priority: 3
X-MSMail-Priority: Normal
X-Mailer: Microsoft Windows Live Mail 14.0.8117.416
X-MimeOLE: Produced By Microsoft MimeOLE V14.0.8117.416
Subject: [wg-camlp4] =?cp1251?b?8eHu7A==?=
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Mon, 13 Aug 2018 13:20:40 -0000

  



From engm@palacelanresort.com  Wed Nov 28 08:22:51 2018
Return-Path: <engm@palacelanresort.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-32.csi.cam.ac.uk (ppsw-32.csi.cam.ac.uk [131.111.8.132])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id 4C4A63C1D0
 for <wg-camlp4@lists.ocaml.org>; Wed, 28 Nov 2018 08:22:51 +0000 (GMT)
X-Cam-SpamScore: sssssss
X-Cam-SpamDetails: score 7.7 from SpamAssassin-3.4.2-1847520 
 *  0.1 RCVD_IN_SBL RBL: Received via a relay in Spamhaus SBL
 *      [189.201.216.75 listed in zen.dnsbl.ja.net]
 *  3.3 RCVD_IN_SBL_CSS RBL: Received via a relay in Spamhaus SBL-CSS
 *  0.8 BAYES_50 BODY: Bayes spam probability is 40 to 60%
 *      [score: 0.4573]
 *  1.3 RCVD_IN_BL_SPAMCOP_NET RBL: Received via a relay in bl.spamcop.net
 *      [Blocked - see <http://www.spamcop.net/bl.shtml?189.201.216.75>]
 *  1.3 RCVD_IN_RP_RNBL RBL: Relay in RNBL,
 *      https://senderscore.org/blacklistlookup/
 *      [58.211.24.134 listed in bl.score.senderscore.com]
 *  0.0 TVD_SPACE_RATIO No description available.
 *  0.8 RDNS_NONE Delivered to internal network by a host with no rDNS
X-Cam-ScannerInfo: http://help.uis.cam.ac.uk/email-scanner-virus
Received: from [58.211.24.134] (port=56812 helo=mail-server.csland.com)
 by ppsw-32.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.148]:25)
 with esmtps (TLSv1:DHE-RSA-AES256-SHA:256)
 id 1gRvty-000LeR-0m (Exim 4.91) for wg-camlp4@lists.ocaml.org
 (return-path <engm@palacelanresort.com>); Wed, 28 Nov 2018 09:13:04 +0000
Received: from [75.flembalagens.vva.gtitelecom.net.br] ([189.201.216.75])
 (authenticated user engm@palacelanresort.com)
 by mail-server.csland.com (Kerio MailServer 6.7.0 patch 1)
 (using TLSv1/SSLv3 with cipher AES256-SHA (256 bits))
 for wg-camlp4@lists.ocaml.org; Wed, 28 Nov 2018 17:10:30 +0800
X-header: 677
X-Sender: <engm@palacelanresort.com>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset=UTF-8
From: "Jack" <engm@palacelanresort.com>
Message-ID: <0isfx1nrbsyt6kjwxuurc1o9o.o6kt4mggxf.43768021566958.32esfxzzj5.h3nma4gi@mail889.kgm84.palacelanresort.com>
Errors-To: zls9lw78pfb43jak0xa5@palacelanresort.com
To: wg-camlp4@lists.ocaml.org
X-Sender-Info: <engm@palacelanresort.com>
Date: Wed, 28 Nov 2018 10:12:20 +0100
Subject: [wg-camlp4] Cris
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Wed, 28 Nov 2018 08:22:51 -0000

Z2lhZ21oIGN6cm1nYWdnIG5kY2dicHBrbA0KDQpodHRwOi8vd3d3Lm1pa2Nvbi5pZS9lZjI2a2dp
L2s5czcxZGEucGhwP2QyY3RZMkZ0YkhBMFFHeHBjM1J6TG05allXMXNMbTl5Wnc9PQ0K


From tim.petrone1@hemscot.com  Fri May 10 19:21:48 2019
Return-Path: <tim.petrone1@hemscot.com>
X-Original-To: wg-camlp4@lists.ocaml.org
Delivered-To: wg-camlp4@lists.ocaml.org
Received: from ppsw-33.csi.cam.ac.uk (ppsw-33.csi.cam.ac.uk [131.111.8.133])
 by ocaml-mx.ocamllabs.cl.cam.ac.uk (Postfix) with ESMTPS id A77AC3CE7D
 for <wg-camlp4@lists.ocaml.org>; Fri, 10 May 2019 19:21:48 +0100 (BST)
X-Cam-SpamDetails: score -0.1 from SpamAssassin-3.4.2-1858976 
 * -0.1 BAYES_00 BODY: Bayes spam probability is 0 to 1%
 *      [score: 0.0009]
X-Cam-ScannerInfo: http://help.uis.cam.ac.uk/email-scanner-virus
Received: from sv19.hanbai.com ([49.212.219.206]:52271)
 by ppsw-33.csi.cam.ac.uk (mx.cam.ac.uk [131.111.8.149]:25)
 with esmtps (TLSv1:DHE-RSA-AES256-SHA:256)
 id 1hPB5j-0006zZ-ha (Exim 4.91) for wg-camlp4@lists.ocaml.org
 (return-path <tim.petrone1@hemscot.com>); Fri, 10 May 2019 20:22:00 +0100
Received: from [74.208.253.180] ([74.208.253.180]) (authenticated)
 by sv19.hanbai.com (unknown) with ESMTP id x4AItFUR011396
 for <wg-camlp4@lists.ocaml.org>; Sat, 11 May 2019 04:21:56 +0900
Message-Id: <201905101921.x4AItFUR011396@sv19.hanbai.com>
Content-Type: text/plain; charset="iso-8859-1"
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
Content-Description: Mail message body
To: wg-camlp4@lists.ocaml.org
From: "Timothy Petrone" <tim.petrone1@hemscot.com>
Date: Fri, 10 May 2019 19:21:55 +0000
Subject: [wg-camlp4] 5-10-19
X-BeenThere: wg-camlp4@lists.ocaml.org
X-Mailman-Version: 2.1.15
Precedence: list
Reply-To: tim.petrone@bohaiconsultants.com
List-Id: "Working Group: the future of syntax extensions in OCaml"
 <wg-camlp4.lists.ocaml.org>
List-Unsubscribe: <http://lists.ocaml.org/options/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=unsubscribe>
List-Archive: <http://lists.ocaml.org/pipermail/wg-camlp4/>
List-Post: <mailto:wg-camlp4@lists.ocaml.org>
List-Help: <mailto:wg-camlp4-request@lists.ocaml.org?subject=help>
List-Subscribe: <http://lists.ocaml.org/listinfo/wg-camlp4>,
 <mailto:wg-camlp4-request@lists.ocaml.org?subject=subscribe>
X-List-Received-Date: Fri, 10 May 2019 18:21:48 -0000

Good day,

I have this proposal to share with you and I'm hopeful your experience will=
 be helpful in closing. Get back to me for more details if interested.

Regards,
Timothy Petrone.
T: +31 970 050 34732

