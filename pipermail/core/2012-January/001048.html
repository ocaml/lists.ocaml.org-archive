<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> build-and-install
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20build-and-install&In-Reply-To=%3C0D694988-D466-4D07-9AF2-1CBA21721B42%40recoil.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001045.html">
   <LINK REL="Next"  HREF="001049.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>build-and-install</H1>
    <B>Anil Madhavapeddy</B> 
    <A HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20build-and-install&In-Reply-To=%3C0D694988-D466-4D07-9AF2-1CBA21721B42%40recoil.org%3E"
       TITLE="build-and-install">anil at recoil.org
       </A><BR>
    <I>Thu Jan 26 16:11:41 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001045.html">build-and-install
</A></li>
        <LI>Next message: <A HREF="001049.html">build-and-install
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1048">[ date ]</a>
              <a href="thread.html#1048">[ thread ]</a>
              <a href="subject.html#1048">[ subject ]</a>
              <a href="author.html#1048">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Including the autogenerated files does make bisecting changes a bit of a pain in the future.

It would be much better just to get an OASIS release out, since anyone else creating OCaml libraries has this exact same issue.

-anil

On 26 Jan 2012, at 16:07, Yaron Minsky wrote:

&gt;<i> For what it's worth, we just pushed Yury's changes to the bitbucket repo, so those mac fixes should be in place.  I'll try to test them out myself at home tonight.
</I>&gt;<i> 
</I>&gt;<i> Yury, do you think it makes sense for us to include the setup.ml files we used directly in the repo?  I know it's a bit nasty to include generated files (the release tarballs of course should include them), but I wonder if it might make sense given the complexity of getting just the right version of Oasis installed...
</I>&gt;<i> 
</I>&gt;<i> y
</I>&gt;<i> 
</I>&gt;<i> On Thu, Jan 26, 2012 at 9:03 AM, Yury Sulsky &lt;<A HREF="http://lists.ocaml.org/listinfo/core">yury.sulsky at gmail.com</A>&gt; wrote:
</I>&gt;<i> Actually, we've managed to build and install all of the libraries on a
</I>&gt;<i> 32-bit Mac OSX machine. We're pushing a few fixes to the tree, one of
</I>&gt;<i> which changes the build scripts to patch the generated setup.ml files
</I>&gt;<i> with support for packed libs. This way, we don't need to rely on a
</I>&gt;<i> patched version of OASIS being installed.
</I>&gt;<i> 
</I>&gt;<i> When these fixes hit the tree hosted on bitbucket, I hope that a
</I>&gt;<i> 32-bit Linux system will be able to build the tree straight away.
</I>&gt;<i> 
</I>&gt;<i> But I agree, patching the generated setup.ml files is hacky and it
</I>&gt;<i> would be great if there were a released version of OASIS with support
</I>&gt;<i> for the Pack option.
</I>&gt;<i> 
</I>&gt;<i> Yury
</I>&gt;<i> 
</I>&gt;<i> On Thu, Jan 26, 2012 at 1:29 PM, Anil Madhavapeddy &lt;<A HREF="http://lists.ocaml.org/listinfo/core">anil at recoil.org</A>&gt; wrote:
</I>&gt;<i> &gt; Why did you have to rebuild the setup.ml files? Were the ones included in
</I>&gt;<i> &gt; the various library tarballs incorrect?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Also Sylvain: would it be possible just to commit those patches that are
</I>&gt;<i> &gt; outstanding against OASIS for pack support? They seem to work well enough,
</I>&gt;<i> &gt; and lots of people seem to run into it...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -Anil
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 26 Jan 2012, at 13:23, Lin wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; For those interested, I finally managed to build and install all libraries
</I>&gt;<i> &gt; on 32-bit Linux. The steps are:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1)  build a patched version of oasis 0.2.1~alpha1 which can handle the
</I>&gt;<i> &gt; `Pack:true' option (thanks to help from Adrien Nader and Sylvain Le Gall)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2) uninstall previously installed version of
</I>&gt;<i> &gt; type-conv/sexplib/bin_prot/fieldslib , etc.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 3)  uncomment all `Pack:true' in every oasis.sh script in the directory tree
</I>&gt;<i> &gt; , if any
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 4)  patch base/core/lib/backtrace_stubs.c to compile on 32-bit machines
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 01/26/2012 12:31 AM, Lin wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Well, this seems result from the fact that the official released oasis
</I>&gt;<i> &gt; 0.2.1~alpha1 does not handle the `Pack:true' option in the _oasis file,
</I>&gt;<i> &gt; which is used for generate correct .mlpack files.  There is a patch for
</I>&gt;<i> &gt; handling this option which has not been merged into oasis trunk :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; <A HREF="http://www.forge.ocamlcore.org/tracker/index.php?func=detail&amp;aid=573&amp;group_id=54&amp;atid=294">http://www.forge.ocamlcore.org/tracker/index.php?func=detail&amp;aid=573&amp;group_id=54&amp;atid=294</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I guess that in Jane Street you're using the patched version of oasis, so I
</I>&gt;<i> &gt; can't get the library modules packed when trying to compile with the
</I>&gt;<i> &gt; unpatched version.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And what it looks like is exactly a module packing problem, i.e. I can `open
</I>&gt;<i> &gt; Sexp', which should be `Sexplib.Sexp', and can't `open Sexplib' because it's
</I>&gt;<i> &gt; not packed at all.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 01/21/2012 11:29 PM, Yaron Minsky wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The sexplib error is a bit surprising.  Did it successfully install sexplib
</I>&gt;<i> &gt; before building core?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm currently trying to build the packages by hand.  Here's my latest
</I>&gt;<i> &gt; problem:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; core $ ./oasis.sh &amp;&amp; ocaml setup.ml -build &amp;&amp; ocaml setup.ml -install
</I>&gt;<i> &gt; ../../build-common.sh: line 88: undefined: unbound variable
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If anyone knows how to get past that, I'd be much obliged...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I started a page on the wiki for collecting hints on how to do the
</I>&gt;<i> &gt; installation.  There's not much there yet, but I'll fill things out as I
</I>&gt;<i> &gt; figure them out.  Others should feel free to pile in their advice:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     <A HREF="https://bitbucket.org/yminsky/ocaml-core/wiki/InstallationHints">https://bitbucket.org/yminsky/ocaml-core/wiki/InstallationHints</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; y
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Sat, Jan 21, 2012 at 10:25 AM, Lin &lt;<A HREF="http://lists.ocaml.org/listinfo/core">mysnowls at 163.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I have been trying to build it by build-and-install script from two hous
</I>&gt;<i> &gt;&gt; ago. With a few tweaks I can get it build everything before core(and async).
</I>&gt;<i> &gt;&gt; I changed the last few lines of the script by discarding all the flags
</I>&gt;<i> &gt;&gt; setting stuff, such that:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;   esac
</I>&gt;<i> &gt;&gt;   ./oasis.sh
</I>&gt;<i> &gt;&gt;   ./configure --prefix ~/godi
</I>&gt;<i> &gt;&gt;   make build
</I>&gt;<i> &gt;&gt;   make install || true
</I>&gt;<i> &gt;&gt;   popd
</I>&gt;<i> &gt;&gt; done
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; But when building core there are some problems. First compiling
</I>&gt;<i> &gt;&gt; `backtrace_stubs.c' failed by the #error directive on IA32 machines. This
</I>&gt;<i> &gt;&gt; can be solved by just returning an caml_copy_string(&quot;Not implemented&quot;) for
</I>&gt;<i> &gt;&gt; backtrace_get() on IA32 machines.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Another problem is like this, which I don't know what to do with it:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; error : unbound module Sexplib
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On 01/21/2012 11:13 PM, Yaron Minsky wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Has anyone succeeded in building Core on a mac using the build-and-install
</I>&gt;<i> &gt;&gt; script in the root?  When I try to run it, I get the following error:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; ocaml-core $ ./build-and-install --disable-linux --disable-posix-timers
</I>&gt;<i> &gt;&gt; too many anonymous arguments: ./build-and-install -o j:h -l
</I>&gt;<i> &gt;&gt; jobs:,help,enable-linux,disable-linux,enable-posix-timers,disable-posix-timers
</I>&gt;<i> &gt;&gt; -- --disable-linux --disable-posix-tim\
</I>&gt;<i> &gt;&gt; ers
</I>&gt;<i> &gt;&gt; ------ base/type-conv ------
</I>&gt;<i> &gt;&gt; ~/Documents/code/ocaml-core/base/type-conv ~/Documents/code/ocaml-core
</I>&gt;<i> &gt;&gt; W: Field XMETAType is set but matching plugin is not enabled.
</I>&gt;<i> &gt;&gt; I: File INSTALL has not changed, skipping
</I>&gt;<i> &gt;&gt; I: File Makefile has not changed, skipping
</I>&gt;<i> &gt;&gt; I: Regenerating file _tags
</I>&gt;<i> &gt;&gt; I: File configure has not changed, skipping
</I>&gt;<i> &gt;&gt; I: File lib/type-conv.odocl has not changed, skipping
</I>&gt;<i> &gt;&gt; I: File myocamlbuild.ml has not changed, skipping
</I>&gt;<i> &gt;&gt; I: File setup.ml has not changed, skipping
</I>&gt;<i> &gt;&gt; I: File syntax/META has not changed, skipping
</I>&gt;<i> &gt;&gt; I: File syntax/pa_type_conv.mllib has not changed, skipping
</I>&gt;<i> &gt;&gt; I: Running command '/usr/local/bin/ocamlc.opt -config &gt;
</I>&gt;<i> &gt;&gt; '/var/folders/sy/cj86bh9d2cz0z_wvct_pbd8r0000gn/T/oasis-ee87eb.txt''
</I>&gt;<i> &gt;&gt; I: Running command '/usr/local/bin/ocamlfind query -format %v findlib &gt;
</I>&gt;<i> &gt;&gt; '/var/folders/sy/cj86bh9d2cz0z_wvct_pbd8r0000gn/T/oasis-3ad4a1.txt''
</I>&gt;<i> &gt;&gt; E: Don't know what to do with arguments: ''
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ocaml.org/pipermail/core/attachments/20120126/2f2bfb33/attachment-0001.html">http://lists.ocaml.org/pipermail/core/attachments/20120126/2f2bfb33/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001045.html">build-and-install
</A></li>
	<LI>Next message: <A HREF="001049.html">build-and-install
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1048">[ date ]</a>
              <a href="thread.html#1048">[ thread ]</a>
              <a href="subject.html#1048">[ subject ]</a>
              <a href="author.html#1048">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/core">More information about the core
mailing list</a><br>
</body></html>
