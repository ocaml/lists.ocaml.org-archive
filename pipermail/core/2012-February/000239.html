<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> bin-prot compile error on OS X 10.7/clang-llvm 3.0/OCaml 3.12.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20bin-prot%20compile%20error%20on%20OS%20X%2010.7/clang-llvm%203.0/OCaml%203.12.1&In-Reply-To=%3CCACLX4jSNDjfTP8We-%2B4WBN8TVVF01DZLSm_zY_J3Ri7x7QnpoQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000238.html">
   <LINK REL="Next"  HREF="000241.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>bin-prot compile error on OS X 10.7/clang-llvm 3.0/OCaml 3.12.1</H1>
    <B>Yaron Minsky</B> 
    <A HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20bin-prot%20compile%20error%20on%20OS%20X%2010.7/clang-llvm%203.0/OCaml%203.12.1&In-Reply-To=%3CCACLX4jSNDjfTP8We-%2B4WBN8TVVF01DZLSm_zY_J3Ri7x7QnpoQ%40mail.gmail.com%3E"
       TITLE="bin-prot compile error on OS X 10.7/clang-llvm 3.0/OCaml 3.12.1">yminsky at janestreet.com
       </A><BR>
    <I>Sat Feb 25 19:09:54 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000238.html">bin-prot compile error on OS X 10.7/clang-llvm 3.0/OCaml 3.12.1
</A></li>
        <LI>Next message: <A HREF="000241.html">bin-prot compile error on OS X 10.7/clang-llvm 3.0/OCaml 3.12.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#239">[ date ]</a>
              <a href="thread.html#239">[ thread ]</a>
              <a href="subject.html#239">[ subject ]</a>
              <a href="author.html#239">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Feb 24, 2012 at 2:01 PM, &quot;Markus W. Wei&#223;mann&quot; &lt;
<A HREF="http://lists.ocaml.org/listinfo/core">markus.weissmann at cs.tum.edu</A>&gt; wrote:

&gt;<i> Hello there,
</I>&gt;<i>
</I>&gt;<i> I'm not sure if this is the right place to report bugs but I couldn't find
</I>&gt;<i> anything else on the JaneStreet homepage (btw. the link to this mailing
</I>&gt;<i> list looks broken):
</I>&gt;<i>
</I>
This is a fine place to report bugs.

Which link is broken?  The &quot;code&quot; link on our ocaml blog page leads you
here:

   <A HREF="https://bitbucket.org/yminsky/ocaml-core/wiki/Home">https://bitbucket.org/yminsky/ocaml-core/wiki/Home</A>

and the link from there to the mailing list seems to work.


&gt;<i> bin-prot fails to compile (since recently) on OS X 10.7.3 with the latest
</I>&gt;<i> XCode/clang compiler, OCaml 3.12.1.
</I>&gt;<i> This is a clean install of MacPorts and I am the maintainer of both OCaml
</I>&gt;<i> and bin-prot there.
</I>&gt;<i>
</I>&gt;<i> 1.) An array-out-of-bounds warning is generated which makes the code fail
</I>&gt;<i> due to -Werror bein enabled:
</I>&gt;<i> It seems as if bin-prot tries to access the 2nd element of a 1-sized
</I>&gt;<i> C-array defined in OCaml's bigarray.h
</I>&gt;<i>
</I>

&gt;<i> - - - - - 8&lt; - - - - -
</I>&gt;<i> + ocamlfind ocamlc -ccopt -DOS_DARWIN -ccopt -pipe -ccopt -g -ccopt -fPIC
</I>&gt;<i> -ccopt -O2 -ccopt -fomit-frame-pointer -ccopt -fsigned-char -ccopt -Wall
</I>&gt;<i> -ccopt -pedantic -ccopt -Wextra -ccopt -Wunused -ccopt -Wno-long-long -c
</I>&gt;<i> lib/write_stubs.c
</I>&gt;<i> clang: warning: argument unused during compilation: '-fno-defer-pop'
</I>&gt;<i> clang: warning: argument unused during compilation: '-no-cpp-precomp'
</I>&gt;<i> lib/write_stubs.c:482:1: warning: array index of '1' indexes past the end
</I>&gt;<i> of an array (that contains 1 elements) [-Warray-bounds]
</I>&gt;<i> MK_VEC_MAT_WRITERS(float32, float)
</I>&gt;<i> ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</I>&gt;<i> lib/write_stubs.c:473:42: note: instantiated from:
</I>&gt;<i>    unsigned long dim2 = (unsigned long) mat-&gt;dim[1]; \
</I>&gt;<i>                                         ^        ~
</I>&gt;<i> /opt/local/lib/ocaml/caml/bigarray.h:76:3: note: array 'dim' declared here
</I>&gt;<i>  intnat dim[1] /*[num_dims]*/; /* Size in each dimension */
</I>&gt;<i>  ^
</I>&gt;<i> lib/write_stubs.c:483:1: warning: array index of '1' indexes past the end
</I>&gt;<i> of an array (that contains 1 elements) [-Warray-bounds]
</I>&gt;<i> MK_VEC_MAT_WRITERS(float64, double)
</I>&gt;<i> ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</I>&gt;<i> lib/write_stubs.c:473:42: note: instantiated from:
</I>&gt;<i>    unsigned long dim2 = (unsigned long) mat-&gt;dim[1]; \
</I>&gt;<i>                                         ^        ~
</I>&gt;<i> /opt/local/lib/ocaml/caml/bigarray.h:76:3: note: array 'dim' declared here
</I>&gt;<i>  intnat dim[1] /*[num_dims]*/; /* Size in each dimension */
</I>&gt;<i>  ^
</I>&gt;<i> 2 warnings generated.
</I>&gt;<i> - - - - - &gt;8 - - - - -
</I>&gt;<i>
</I>&gt;<i> 2.) If I disable -Werror the linker finally gives up on me -- which I
</I>&gt;<i> can't make a clue of. As a wild guess I would say that the llvm-people made
</I>&gt;<i> their C-Compiler more strict and less gcc-compatible:
</I>&gt;<i>
</I>&gt;<i> - - - - - 8&lt; - - - - -
</I>&gt;<i> + ocamlfind ocamlopt -g -I lib -linkpkg -package unix -package type-conv
</I>&gt;<i> -package oUnit -package camlp4.quotations -package camlp4.lib -package
</I>&gt;<i> bigarray syntax/pa_bin_prot.cmxa lib/bin_prot.cmxa lib/bin_prot.cmx
</I>&gt;<i> lib_test/bin_prot_test.cmx lib_test/test.cmx lib_test/test_runner.cmx -o
</I>&gt;<i> lib_test/test_runner.native
</I>&gt;<i> Undefined symbols for architecture x86_64:
</I>&gt;<i>  &quot;_write_float_stub&quot;, referenced from:
</I>&gt;<i>      .L1602 in bin_prot_test.o
</I>&gt;<i>      .L151 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_float_stub)
</I>&gt;<i>  &quot;_get_buf_ptr_stub&quot;, referenced from:
</I>&gt;<i>      .L1606 in bin_prot_test.o
</I>&gt;<i>      .L1631 in bin_prot_test.o
</I>&gt;<i>      .L1660 in bin_prot_test.o
</I>&gt;<i>      .L1686 in bin_prot_test.o
</I>&gt;<i>      .L1710 in bin_prot_test.o
</I>&gt;<i>      .L1734 in bin_prot_test.o
</I>&gt;<i>      .L1774 in bin_prot_test.o
</I>&gt;<i>      ...
</I>&gt;<i>  &quot;_read_float_stub&quot;, referenced from:
</I>&gt;<i>      .L1619 in bin_prot_test.o
</I>&gt;<i>      .L1627 in bin_prot_test.o
</I>&gt;<i>      .L154 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_float_stub)
</I>&gt;<i>  &quot;_write_variant_tag_stub&quot;, referenced from:
</I>&gt;<i>      .L1842 in bin_prot_test.o
</I>&gt;<i>      .L1841 in bin_prot_test.o
</I>&gt;<i>      .L1840 in bin_prot_test.o
</I>&gt;<i>      .L125 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_variant_tag_stub)
</I>&gt;<i>  &quot;_get_buf_pos_stub&quot;, referenced from:
</I>&gt;<i>      .L114 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_common__1 in bin_prot.o
</I>&gt;<i>  &quot;_read_bigstring_stub&quot;, referenced from:
</I>&gt;<i>      .L132 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_bigstring_stub)
</I>&gt;<i>  &quot;_read_float32_mat_stub&quot;, referenced from:
</I>&gt;<i>      .L138 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_float32_mat_stub)
</I>&gt;<i>  &quot;_read_float32_vec_stub&quot;, referenced from:
</I>&gt;<i>      .L144 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_float32_vec_stub)
</I>&gt;<i>  &quot;_read_float64_mat_stub&quot;, referenced from:
</I>&gt;<i>      .L134 in bin_prot.o
</I>&gt;<i>      .L136 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_float64_mat_stub)
</I>&gt;<i>  &quot;_read_float64_vec_stub&quot;, referenced from:
</I>&gt;<i>      .L140 in bin_prot.o
</I>&gt;<i>      .L142 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_float64_vec_stub)
</I>&gt;<i>  &quot;_read_int64_bits_stub&quot;, referenced from:
</I>&gt;<i>      .L116 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_int64_bits_stub)
</I>&gt;<i>  &quot;_read_int_64bit_stub&quot;, referenced from:
</I>&gt;<i>      .L118 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_int_64bit_stub)
</I>&gt;<i>  &quot;_read_network16_int_stub&quot;, referenced from:
</I>&gt;<i>      .L114 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_network16_int_stub)
</I>&gt;<i>  &quot;_read_network32_int32_stub&quot;, referenced from:
</I>&gt;<i>      .L110 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_network32_int32_stub)
</I>&gt;<i>  &quot;_read_network32_int_stub&quot;, referenced from:
</I>&gt;<i>      .L112 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_network32_int_stub)
</I>&gt;<i>  &quot;_read_network64_int64_stub&quot;, referenced from:
</I>&gt;<i>      .L106 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_network64_int64_stub)
</I>&gt;<i>  &quot;_read_network64_int_stub&quot;, referenced from:
</I>&gt;<i>      .L108 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_read_network64_int_stub)
</I>&gt;<i>  &quot;_read_raw_string_stub&quot;, referenced from:
</I>&gt;<i>      .L227 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_read_c__48 in bin_prot.o
</I>&gt;<i>  &quot;_write_bigstring_stub&quot;, referenced from:
</I>&gt;<i>      .L129 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_bigstring_stub)
</I>&gt;<i>  &quot;_write_float32_mat_stub&quot;, referenced from:
</I>&gt;<i>      .L135 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_float32_mat_stub)
</I>&gt;<i>  &quot;_write_float32_vec_stub&quot;, referenced from:
</I>&gt;<i>      .L141 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_float32_vec_stub)
</I>&gt;<i>  &quot;_write_float64_mat_stub&quot;, referenced from:
</I>&gt;<i>      .L131 in bin_prot.o
</I>&gt;<i>      .L133 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_float64_mat_stub)
</I>&gt;<i>  &quot;_write_float64_vec_stub&quot;, referenced from:
</I>&gt;<i>      .L137 in bin_prot.o
</I>&gt;<i>      .L139 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_float64_vec_stub)
</I>&gt;<i>  &quot;_write_float_array_stub&quot;, referenced from:
</I>&gt;<i>      .L127 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_float_array_stub)
</I>&gt;<i>  &quot;_write_int64_bits_stub&quot;, referenced from:
</I>&gt;<i>      .L115 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_int64_bits_stub)
</I>&gt;<i>  &quot;_write_network16_int_stub&quot;, referenced from:
</I>&gt;<i>      .L113 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_network16_int_stub)
</I>&gt;<i>  &quot;_write_network32_int32_stub&quot;, referenced from:
</I>&gt;<i>      .L109 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_network32_int32_stub)
</I>&gt;<i>  &quot;_write_network32_int_stub&quot;, referenced from:
</I>&gt;<i>      .L111 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_network32_int_stub)
</I>&gt;<i>  &quot;_write_network64_int64_stub&quot;, referenced from:
</I>&gt;<i>      .L105 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_network64_int64_stub)
</I>&gt;<i>  &quot;_write_network64_int_stub&quot;, referenced from:
</I>&gt;<i>      .L107 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i>     (maybe you meant: _ml_write_network64_int_stub)
</I>&gt;<i>  &quot;_write_raw_string_stub&quot;, referenced from:
</I>&gt;<i>      .L206 in bin_prot.o
</I>&gt;<i>      _camlBin_prot__Unsafe_write_c__44 in bin_prot.o
</I>&gt;<i> ld: symbol(s) not found for architecture x86_64
</I>&gt;<i> clang: error: linker command failed with exit code 1 (use -v to see
</I>&gt;<i> invocation)
</I>&gt;<i> File &quot;caml_startup&quot;, line 1, characters 0-1:
</I>&gt;<i> Error: Error during linking
</I>&gt;<i> Command exited with code 2.
</I>&gt;<i> - - - - - &gt;8 - - - - -
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Best Regards
</I>&gt;<i>
</I>&gt;<i> -Markus
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Markus Wei&#223;mann, M.Sc.
</I>&gt;<i> Technische Universit&#228;t M&#252;nchen
</I>&gt;<i> Institut f&#252;r Informatik
</I>&gt;<i> Boltzmannstr. 3
</I>&gt;<i> D-85748 Garching
</I>&gt;<i> Germany
</I>&gt;<i> Tel. +49 (89) 2 89-1 81 05
</I>&gt;<i> Fax +49 (89) 2 89-1 81 07
</I>&gt;<i> <A HREF="http://wwwknoll.in.tum.de/">http://wwwknoll.in.tum.de/</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ocaml.org/pipermail/core/attachments/20120225/8145e871/attachment.html">http://lists.ocaml.org/pipermail/core/attachments/20120225/8145e871/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000238.html">bin-prot compile error on OS X 10.7/clang-llvm 3.0/OCaml 3.12.1
</A></li>
	<LI>Next message: <A HREF="000241.html">bin-prot compile error on OS X 10.7/clang-llvm 3.0/OCaml 3.12.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#239">[ date ]</a>
              <a href="thread.html#239">[ thread ]</a>
              <a href="subject.html#239">[ subject ]</a>
              <a href="author.html#239">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/core">More information about the core
mailing list</a><br>
</body></html>
