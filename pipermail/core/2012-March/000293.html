<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> sexp_default
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20sexp_default&In-Reply-To=%3CCACLX4jQZW9TX94ohh3XxUa7jGpPCsaV_ObKdWkH2RPTWGOP46g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000292.html">
   <LINK REL="Next"  HREF="000294.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>sexp_default</H1>
    <B>Yaron Minsky</B> 
    <A HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20sexp_default&In-Reply-To=%3CCACLX4jQZW9TX94ohh3XxUa7jGpPCsaV_ObKdWkH2RPTWGOP46g%40mail.gmail.com%3E"
       TITLE="sexp_default">yminsky at janestreet.com
       </A><BR>
    <I>Fri Mar 30 21:44:29 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000292.html">sexp_default
</A></li>
        <LI>Next message: <A HREF="000294.html">sexp_default
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#293">[ date ]</a>
              <a href="thread.html#293">[ thread ]</a>
              <a href="subject.html#293">[ subject ]</a>
              <a href="author.html#293">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Fri, Mar 30, 2012 at 4:25 PM, Markus Mottl &lt;<A HREF="http://lists.ocaml.org/listinfo/core">markus.mottl at gmail.com</A>&gt; wrote:
&gt;<i> On Fri, Mar 30, 2012 at 15:45, Yaron Minsky &lt;<A HREF="http://lists.ocaml.org/listinfo/core">yminsky at janestreet.com</A>&gt; wrote:
</I>&gt;&gt;<i> I am a little worried about the semantics of !, though. &#160;If I create a type:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; &#160;type t = { foo : int sexp_default(7)! } with sexp
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> then the round-tripping could be pretty weird. &#160;In particular,
</I>&gt;&gt;<i> consider this sequence:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160; { foo = 3 }
</I>&gt;&gt;<i> &#160; |! sexp_of_t &#160;(* this is () *)
</I>&gt;&gt;<i> &#160; |! t_of_sexp &#160;(* this is { foo = 7 } *)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This behavior seems pretty unfortunate. &#160;Is that really what it does?
</I>&gt;<i>
</I>&gt;<i> No, it would consider equivalence to the default expression first to
</I>&gt;<i> determine whether to drop the field in the S-expression. &#160;In your case
</I>&gt;<i> it would convert the record to ((foo 3)). &#160;If, however, you had used {
</I>&gt;<i> foo = 7 }, then it would convert it to () as expected. &#160;Without the !,
</I>&gt;<i> it would always emit the field no matter the content.
</I>&gt;<i>
</I>&gt;<i> Due to that equivalence check it is probably not a good idea to use
</I>&gt;<i> expensive function calls or gargantuan values as default expressions.
</I>&gt;<i> But that doesn't seem necessary in practice anyway.
</I>
Got it.  Is the equality check based on polymorphic compare, or
equality of the s-expression representation?

&gt;&gt;<i> As a side note, Markus, if you're working on more patches: please
</I>&gt;&gt;<i> don't do merges in the stuff your proposing. &#160;Yury's conversion code
</I>&gt;&gt;<i> doesn't work well on merges. &#160;(merges purely within your code are
</I>&gt;&gt;<i> actually OK, as long as you're not merging in from different points in
</I>&gt;&gt;<i> the history that was exported from Jane Street.)
</I>&gt;<i>
</I>&gt;<i> Hm, well, that surely makes it hard to work on the same files, which
</I>&gt;<i> would require merges. &#160;As long as we don't tread on each other's feet
</I>&gt;<i> that should be possible though.
</I>
Yeah, we'll have to figure it out over time.  I think right now one
can do all the merging one wants, subject to the constraint that all
the work is anchored to the same spot in our HG repo.  But the
simplest use-case is just linear histories.  Right now Yury is
manually dealing with the conversion of the revisions we've pulled in
so far, which is kind of painful.

&gt;<i> --
</I>&gt;<i> Markus Mottl&#160; &#160; &#160; &#160; <A HREF="http://www.ocaml.info&#160;">http://www.ocaml.info&#160;</A> &#160; &#160; &#160; <A HREF="http://lists.ocaml.org/listinfo/core">markus.mottl at gmail.com</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000292.html">sexp_default
</A></li>
	<LI>Next message: <A HREF="000294.html">sexp_default
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#293">[ date ]</a>
              <a href="thread.html#293">[ thread ]</a>
              <a href="subject.html#293">[ subject ]</a>
              <a href="author.html#293">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/core">More information about the core
mailing list</a><br>
</body></html>
