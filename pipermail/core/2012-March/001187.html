<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> sexp_default
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20sexp_default&In-Reply-To=%3CCACLX4jQDYugo6mLJY8%2BoegG9YMHDa9CZ51%2BJUtR-NxY7N%3D5GpA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001190.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>sexp_default</H1>
    <B>Yaron Minsky</B> 
    <A HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20sexp_default&In-Reply-To=%3CCACLX4jQDYugo6mLJY8%2BoegG9YMHDa9CZ51%2BJUtR-NxY7N%3D5GpA%40mail.gmail.com%3E"
       TITLE="sexp_default">yminsky at janestreet.com
       </A><BR>
    <I>Sat Mar 31 12:50:21 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001190.html">sexp_default
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1187">[ date ]</a>
              <a href="thread.html#1187">[ thread ]</a>
              <a href="subject.html#1187">[ subject ]</a>
              <a href="author.html#1187">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Fri, Mar 30, 2012 at 6:09 PM, Markus Mottl &lt;<A HREF="http://lists.ocaml.org/listinfo/core">markus.mottl at gmail.com</A>&gt; wrote:
&gt;<i> On Fri, Mar 30, 2012 at 17:28, Yaron Minsky &lt;<A HREF="http://lists.ocaml.org/listinfo/core">yminsky at janestreet.com</A>&gt; wrote:
</I>&gt;&gt;<i> Hrm. &#160;The polymorphic equality thing makes me a little sick &#160;--- we're
</I>&gt;&gt;<i> actually trying to avoid polymorphic compare wherever we can these
</I>&gt;&gt;<i> days, for both performance and semantic reasons. &#160;Is there a reason it
</I>&gt;&gt;<i> can't use comparison of s-expressions? &#160;I don't think efficiency is a
</I>&gt;&gt;<i> primary concern here, since this is already fairly slow
</I>&gt;&gt;<i> pretty-printing code.
</I>&gt;<i>
</I>&gt;<i> I guess nobody is fully satisfied with polymorphic equality in
</I>&gt;<i> general. &#160;I'm not sure there is any true gain in comparing
</I>&gt;<i> S-expressions. &#160;One could imagine that some S-expression converters
</I>&gt;<i> normalize the representation so that e.g. sets, maps, etc., would
</I>&gt;<i> compare consistently, but this is not a given (e.g. hashtables).
</I>&gt;<i> Furthermore, in the vast majority of cases we would needlessly convert
</I>&gt;<i> a value to an S-expression just for equality checking even though it
</I>&gt;<i> need not be emitted in the first place - a rather expensive default
</I>&gt;<i> behavior.
</I>
Fair.

&gt;<i> The only consistent solution I can see is if the user can optionally
</I>&gt;<i> specify an equivalence relation, e.g. by having another optional
</I>&gt;<i> expression that contains such a function. &#160;But this could turn out to
</I>&gt;<i> be extremely expensive: think of comparing hashtables.
</I>&gt;<i>
</I>&gt;<i> Default field values are probably hardly ever changed back and forth
</I>&gt;<i> at runtime, especially in ways that would destroy pointer equality or
</I>&gt;<i> worse to a structurally distinct but semantically equivalent
</I>&gt;<i> representation. &#160;Polymorphic equality checks would therefore almost
</I>&gt;<i> always just compare two identical pointers anyway, which is both
</I>&gt;<i> consistent and maximally efficient. &#160;Even if a field were emitted that
</I>&gt;<i> need not be, this should never cause any issues other than diminished
</I>&gt;<i> output readability.
</I>&gt;<i>
</I>&gt;<i> I'd therefore suggest to use polymorphic equality for the while being.
</I>&gt;<i> &#160;If it really turns out to cause issues in practice, you can always
</I>&gt;<i> add the mentioned optional equality function later.
</I>
That sounds pretty reasonable.  Another option would be to use
physical equality, which would have the property that if you left the
default unmodified, it would work, but otherwise would re-output the
value.  That's got its own set of surprising issues as well, though.

y

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001190.html">sexp_default
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1187">[ date ]</a>
              <a href="thread.html#1187">[ thread ]</a>
              <a href="subject.html#1187">[ subject ]</a>
              <a href="author.html#1187">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/core">More information about the core
mailing list</a><br>
</body></html>
