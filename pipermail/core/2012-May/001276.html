<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Bitbucket patch queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20Bitbucket%20patch%20queues&In-Reply-To=%3CCACLX4jRVN%3DW5dQy%2BsHKtrzz%2ByxuHNckr_d7TxPCwFDtxqC2VCA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000386.html">
   <LINK REL="Next"  HREF="001277.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Bitbucket patch queues</H1>
    <B>Yaron Minsky</B> 
    <A HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20Bitbucket%20patch%20queues&In-Reply-To=%3CCACLX4jRVN%3DW5dQy%2BsHKtrzz%2ByxuHNckr_d7TxPCwFDtxqC2VCA%40mail.gmail.com%3E"
       TITLE="Bitbucket patch queues">yminsky at janestreet.com
       </A><BR>
    <I>Wed May 30 22:52:40 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000386.html">Bitbucket patch queues
</A></li>
        <LI>Next message: <A HREF="001277.html">Bitbucket patch queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1276">[ date ]</a>
              <a href="thread.html#1276">[ thread ]</a>
              <a href="subject.html#1276">[ subject ]</a>
              <a href="author.html#1276">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Wed, May 30, 2012 at 12:35 PM, Markus Mottl &lt;<A HREF="http://lists.ocaml.org/listinfo/core">markus.mottl at gmail.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> have you guys thought about creating a central patch queue for
</I>&gt;<i> ocaml-core? &#160;I think the merge-related issues discussed previously
</I>&gt;<i> could be solved most easily if you maintained a central patch queue
</I>&gt;<i> repository.
</I>
No, but it does seem like a good idea.

&gt;<i> I've just played around with my own Bitbucket patch queue of my fork,
</I>&gt;<i> and it seems to work just fine. &#160;This allows me to avoid merging with
</I>&gt;<i> your repo by &quot;rebasing&quot;, i.e. doing a &quot;hg qpop -a&quot;, &quot;hg pull -u&quot; (from
</I>&gt;<i> your repo), &quot;hg qpush -a&quot;.
</I>
That makes a lot of sense.

&gt;<i> But one problem still remains: how to submit patches to your
</I>&gt;<i> repository. &#160;In the moment I commit my patches to my tree for you to
</I>&gt;<i> pull, there might be a race condition where you change your tree, thus
</I>&gt;<i> forcing a potentially bad merge. &#160;This will eventually become a major
</I>&gt;<i> problem as the number of contributors grows. &#160;Accepting pull requests
</I>&gt;<i> will obviously change your tree and thus increase chances for race
</I>&gt;<i> conditions with others.
</I>
This isn't a problem unless you pull in again from the main tree and
do a merge on your side.  Us adding patches on its own doesn't hurt
anything.

That said, it's an error prone process, and patch-queues are in some
sense much more natural.  I quite like the idea, really.

&gt;<i> The improved workflow would make sure that people never commit changes
</I>&gt;<i> to the main repository. &#160;Instead they:
</I>&gt;<i>
</I>&gt;<i> &#160;* Fork your central patch queue instead of the ocaml-core repo. &#160;You
</I>&gt;<i> will never accept pull requests for the latter!
</I>&gt;<i> &#160;* Add new patches with &quot;qnew&quot;.
</I>&gt;<i> &#160;* Update them with &quot;qrefresh&quot; as they keep improving them.
</I>&gt;<i> &#160;* Pull from your patch queue (rebasing their patches).
</I>&gt;<i> &#160;* Commit their patches to their patch repository via &quot;hg commit --mq&quot;
</I>&gt;<i> &#160;* Push them to their fork of your patch queue (hg push --mq)
</I>&gt;<i> &#160;* Send pull requests to your central patch queue
</I>&gt;<i>
</I>&gt;<i> Contributors will never run &quot;qfinish&quot; to apply patches to the main
</I>&gt;<i> repo. &#160;Applying the patches will be your privilege after accepting
</I>&gt;<i> pull requests for the patch queue repo. &#160;I think this will also make
</I>&gt;<i> your job of merging patches easier, because it is trivial to verify
</I>&gt;<i> that the main repository is untouched, i.e. that only the patch repo
</I>&gt;<i> contains changes.
</I>&gt;<i>
</I>&gt;<i> I haven't tested the whole workflow yet, but it worked as expected for
</I>&gt;<i> me for those parts that I did test. &#160;Please let me know if you want to
</I>&gt;<i> create a patch queue and test this approach with me.
</I>
Yes, let's do it.  Give me a couple of days to set it up.

y

&gt;<i> Regards,
</I>&gt;<i> Markus
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Markus Mottl&#160; &#160; &#160; &#160; <A HREF="http://www.ocaml.info&#160;">http://www.ocaml.info&#160;</A> &#160; &#160; &#160; <A HREF="http://lists.ocaml.org/listinfo/core">markus.mottl at gmail.com</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000386.html">Bitbucket patch queues
</A></li>
	<LI>Next message: <A HREF="001277.html">Bitbucket patch queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1276">[ date ]</a>
              <a href="thread.html#1276">[ thread ]</a>
              <a href="subject.html#1276">[ subject ]</a>
              <a href="author.html#1276">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/core">More information about the core
mailing list</a><br>
</body></html>
