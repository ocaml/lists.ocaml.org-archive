<tt>
Thank&nbsp;you&nbsp;for&nbsp;the&nbsp;responses.&nbsp; I&#39;m&nbsp;probably&nbsp;going&nbsp;to&nbsp;switch&nbsp;to&nbsp;the&nbsp;&gt;&gt;=,&nbsp;&gt;&gt;&gt;,&nbsp;&gt;&gt;|&nbsp;operators.&nbsp; I&nbsp;wasn&#39;t&nbsp;sure&nbsp;if&nbsp;I&nbsp;liked&nbsp;them&nbsp;when&nbsp;I&nbsp;first&nbsp;started&nbsp;but&nbsp;I&#39;ll&nbsp;try&nbsp;them&nbsp;out.&nbsp; They&nbsp;will&nbsp;probably&nbsp;be&nbsp;clearer&nbsp;now&nbsp;that&nbsp;I&nbsp;have&nbsp;had&nbsp;time&nbsp;to&nbsp;think&nbsp;about&nbsp;the&nbsp;code&nbsp;in&nbsp;terms&nbsp;of&nbsp;bind&nbsp;and&nbsp;upon.&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;the&nbsp;upon&nbsp;code,&nbsp;in&nbsp;&lt;a&nbsp;href=&quot;http://gen_server_test.ml&quot;&gt;gen_server_test.ml&lt;/a&gt;&nbsp;that&nbsp;should&nbsp;be&nbsp;switched&nbsp;to&nbsp;bind,&nbsp;I&nbsp;agree.&nbsp; In&nbsp;&lt;a&nbsp;href=&quot;http://gen_server.ml&quot;&gt;gen_server.ml&lt;/a&gt;,&nbsp;I&nbsp;use&nbsp;upon&nbsp;to&nbsp;represent&nbsp;the&nbsp;event&nbsp;loop,&nbsp;which&nbsp;represents&nbsp;a&nbsp;detached&nbsp;computation&nbsp;so&nbsp;nobody&nbsp;should&nbsp;ever&nbsp;wait&nbsp;on&nbsp;that&nbsp; I&nbsp;think&nbsp;the&nbsp;use&nbsp;of&nbsp;upon&nbsp;there&nbsp;is&nbsp;valid,&nbsp;but&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&nbsp;disagree.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;the&nbsp;original&nbsp;problem&nbsp;I&nbsp;raised,&nbsp;about&nbsp;a&nbsp;gen&nbsp;server&nbsp;being&nbsp;able&nbsp;to&nbsp;reference&nbsp;itself,&nbsp;the&nbsp;best&nbsp;solution&nbsp;I&#39;ve&nbsp;come&nbsp;up&nbsp;with&nbsp;is&nbsp;passing&nbsp;the&nbsp;init&nbsp;function&nbsp;a&nbsp;tuple&nbsp;of&nbsp;(msg&nbsp;-&gt;&nbsp;unit&nbsp;*&nbsp;exited&nbsp;Ivar.t).&nbsp; The&nbsp;init&nbsp;function&nbsp;can&nbsp;give&nbsp;this&nbsp;tuple&nbsp;to&nbsp;other&nbsp;services&nbsp;it&nbsp;wants&nbsp;to&nbsp;create.&nbsp; I&#39;m&nbsp;still&nbsp;not&nbsp;a&nbsp;big&nbsp;fan&nbsp;of&nbsp;it&nbsp;though,&nbsp;but&nbsp;my&nbsp;Ocaml-type-fu&nbsp;is&nbsp;weak.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;again&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Jul&nbsp;3,&nbsp;2012&nbsp;at&nbsp;8:46&nbsp;AM,&nbsp;David&nbsp;House&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:dhouse@janestreet.com&quot;&nbsp;target=&quot;_blank&quot;&gt;dhouse@janestreet.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;Tue,&nbsp;Jul&nbsp;3,&nbsp;2012&nbsp;at&nbsp;5:34&nbsp;AM,&nbsp;Sam&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:sdefabbiakane@gmail.com&quot;&gt;sdefabbiakane@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&gt;&nbsp;You&#39;re&nbsp;refererencing&nbsp;some&nbsp;things&nbsp;in&nbsp;Async&#39;s&nbsp;Deferred&nbsp;module&nbsp;(like&lt;br&gt;<br>
&gt;&nbsp;&#39;Deferred.return&#39;,&nbsp;etc)&nbsp;with&nbsp;their&nbsp;qualified&nbsp;names,&nbsp;which&nbsp;is&nbsp;unnecessary:&lt;br&gt;<br>
&gt;&nbsp;you&nbsp;can&nbsp;just&nbsp;use&nbsp;&#39;return&#39;.&nbsp;This&nbsp;is&nbsp;partially&nbsp;a&nbsp;style&nbsp;point,&nbsp;but&nbsp;Deferred&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;generally&nbsp;understood&nbsp;to&nbsp;be&nbsp;the&nbsp;top-level&nbsp;monad&nbsp;if&nbsp;you&nbsp;have&nbsp;Async&nbsp;open.&nbsp;(This&lt;br&gt;<br>
&gt;&nbsp;is&nbsp;also&nbsp;the&nbsp;case&nbsp;for&nbsp;some&nbsp;functions&nbsp;in&nbsp;other&nbsp;modules,&nbsp;like&nbsp;printf,&nbsp;which&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;the&nbsp;top&nbsp;level&nbsp;in&nbsp;Core.)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Not&nbsp;sure&nbsp;I&nbsp;totally&nbsp;agree&nbsp;--&nbsp;I&nbsp;think&nbsp;Deferred.return&nbsp;is&nbsp;a&nbsp;clearer&nbsp;name&lt;br&gt;<br>
than&nbsp;return&nbsp;on&nbsp;its&nbsp;own.&nbsp;I&nbsp;generally&nbsp;try&nbsp;to&nbsp;avoid&nbsp;use&nbsp;of&nbsp;return&nbsp;by&lt;br&gt;<br>
using&nbsp;map&nbsp;instead&nbsp;of&nbsp;bind&nbsp;as&nbsp;the&nbsp;last&nbsp;chained&nbsp;infix&nbsp;operator,&nbsp;e.g.:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;foo&lt;br&gt;<br>
 &nbsp;&gt;&gt;=&nbsp;fun&nbsp;a&nbsp;-&gt;&lt;br&gt;<br>
 &nbsp;bar&nbsp;a&lt;br&gt;<br>
 &nbsp;&gt;&gt;=&nbsp;fun&nbsp;()&nbsp;-&gt;&lt;br&gt;<br>
 &nbsp;baz&lt;br&gt;<br>
 &nbsp;&gt;&gt;|&nbsp;fun&nbsp;c&nbsp;-&gt;&lt;br&gt;<br>
 &nbsp;quux&nbsp;c&lt;br&gt;<br>
&lt;br&gt;<br>
(This&nbsp;also&nbsp;shows&nbsp;another&nbsp;style&nbsp;point&nbsp;I&#39;m&nbsp;a&nbsp;fan&nbsp;of:&nbsp;arrange&nbsp;your&nbsp;code&lt;br&gt;<br>
with&nbsp;binds/maps&nbsp;on&nbsp;the&nbsp;left,&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;clear&nbsp;where&nbsp;they&nbsp;all&nbsp;are.&lt;br&gt;<br>
This&nbsp;is&nbsp;important,&nbsp;because&nbsp;they&#39;re&nbsp;basically&nbsp;the&nbsp;possible&nbsp;context&lt;br&gt;<br>
switch&nbsp;points&nbsp;in&nbsp;your&nbsp;code.&nbsp;So&nbsp;you&nbsp;should&nbsp;be&nbsp;aware&nbsp;where&nbsp;they&nbsp;are.&nbsp;The&lt;br&gt;<br>
above&nbsp;example&nbsp;looks&nbsp;silly,&nbsp;but&nbsp;generally&nbsp;you&nbsp;have&nbsp;much&nbsp;longer&nbsp;lines&lt;br&gt;<br>
between&nbsp;the&nbsp;binds,&nbsp;and&nbsp;it&nbsp;looks&nbsp;fine.)&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;Generally&nbsp;functions&nbsp;that&nbsp;do&nbsp;deferred&nbsp;things&nbsp;should&nbsp;generally&nbsp;have&nbsp;a&nbsp;Deferred&lt;br&gt;<br>
&gt;&nbsp;type.&nbsp;Don&#39;t&nbsp;use&nbsp;upon&nbsp;to&nbsp;try&nbsp;to&nbsp;give&nbsp;yourself&nbsp;functions&nbsp;of&nbsp;type&nbsp;&#39;unit&#39;.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;+1,&nbsp;and&nbsp;in&nbsp;fact&nbsp;I&#39;d&nbsp;say&nbsp;any&nbsp;use&nbsp;of&nbsp;upon&nbsp;is&nbsp;supicious.&nbsp;Note&nbsp;that&nbsp;[x&nbsp;&gt;&gt;&gt;&lt;br&gt;<br>
f]&nbsp;is&nbsp;equivalent&nbsp;(pretty&nbsp;much)&nbsp;to&nbsp;[whenever&nbsp;(x&nbsp;&gt;&gt;=&nbsp;f)]&nbsp;(at&nbsp;some&nbsp;point&lt;br&gt;<br>
we&nbsp;are&nbsp;renaming&nbsp;&quot;whenever&quot;&nbsp;to&nbsp;&quot;don&#39;t_wait_for&quot;&nbsp;--&nbsp;I&nbsp;can&#39;t&nbsp;remember&lt;br&gt;<br>
whether&nbsp;that&nbsp;has&nbsp;hit&nbsp;yet).&nbsp;But&nbsp;as&nbsp;you&nbsp;say,&nbsp;you&nbsp;should&nbsp;just&nbsp;let&nbsp;things&lt;br&gt;<br>
have&nbsp;deferred&nbsp;return&nbsp;types&nbsp;if&nbsp;they&nbsp;do&nbsp;deferred&nbsp;things.&nbsp;This&nbsp;means&nbsp;that&lt;br&gt;<br>
clients&nbsp;of&nbsp;that&nbsp;function&nbsp;have&nbsp;the&nbsp;choice&nbsp;whether&nbsp;to&nbsp;wait&nbsp;for&nbsp;that&lt;br&gt;<br>
function&nbsp;(by&nbsp;binding&nbsp;on&nbsp;it),&nbsp;or&nbsp;not&nbsp;to&nbsp;(by&nbsp;calling&lt;br&gt;<br>
whenever/don&#39;t_wait_for).&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;only&nbsp;exception&nbsp;is&nbsp;very&nbsp;tight&nbsp;loops,&nbsp;where&nbsp;upon&nbsp;is&nbsp;more&nbsp;efficient&lt;br&gt;<br>
than&nbsp;bind,&nbsp;because&nbsp;it&nbsp;avoids&nbsp;allocating&nbsp;an&nbsp;extra&nbsp;deferred.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
