<tt>
Confirmed&nbsp;segfault&nbsp;on&nbsp;10.8.2&nbsp;with&nbsp;latest&nbsp;core&nbsp;(108.07.01)&nbsp;and&nbsp;OCaml&nbsp;4.00.1+short-types.&lt;br&gt;&lt;br&gt;On&nbsp;Thursday,&nbsp;November&nbsp;8,&nbsp;2012&nbsp;11:47:21&nbsp;AM&nbsp;UTC-6,&nbsp;Anil&nbsp;Madhavapeddy&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;Looks&nbsp;like&nbsp;another&nbsp;misaligned&nbsp;stack&nbsp;pointer&nbsp;somewhere;&nbsp;two&nbsp;were&nbsp;fixed<br>
&lt;br&gt;already&nbsp;here:<br>
&lt;br&gt;&lt;a&nbsp;href=&quot;http://caml.inria.fr/mantis/view.php?id=5700&quot;&nbsp;target=&quot;_blank&quot;&gt;http://caml.inria.fr/mantis/&lt;wbr&gt;view.php?id=5700&lt;/a&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;MacOS&nbsp;10.8&nbsp;strictly&nbsp;needs&nbsp;a&nbsp;16-byte&nbsp;aligned&nbsp;stack&nbsp;or&nbsp;else&nbsp;lots&nbsp;of&nbsp;systems<br>
&lt;br&gt;functions&nbsp;decide&nbsp;to&nbsp;throw&nbsp;in&nbsp;the&nbsp;towel&nbsp;(due&nbsp;to&nbsp;them&nbsp;using&nbsp;SSE&nbsp;instructions<br>
&lt;br&gt;by&nbsp;default&nbsp;now).<br>
&lt;br&gt;<br>
&lt;br&gt;#0&nbsp;&nbsp;0x00007fff8e4ad8a5&nbsp;in&nbsp;misaligned_stack_error_&lt;wbr&gt;entering_dyld_stub_binder&nbsp;()<br>
&lt;br&gt;#1&nbsp;&nbsp;0x0000000000000103&nbsp;in&nbsp;??&nbsp;()<br>
&lt;br&gt;#2&nbsp;&nbsp;0x0000000100254068&nbsp;in&nbsp;caml_absf_mask&nbsp;()<br>
&lt;br&gt;#3&nbsp;&nbsp;0x000000010022e923&nbsp;in&nbsp;caml_raise&nbsp;()<br>
&lt;br&gt;#4&nbsp;&nbsp;0x000000010022ec71&nbsp;in&nbsp;caml_array_bound_error&nbsp;()<br>
&lt;br&gt;#5&nbsp;&nbsp;0x000000010000b32a&nbsp;in&nbsp;.L101&nbsp;()<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;-a<br>
&lt;br&gt;<br>
&lt;br&gt;On&nbsp;8&nbsp;Nov&nbsp;2012,&nbsp;at&nbsp;17:16,&nbsp;Markus&nbsp;Mottl&nbsp;&lt;&lt;a&nbsp;href=&quot;javascript:&quot;&nbsp;target=&quot;_blank&quot;&nbsp;gdf-obfuscated-mailto=&quot;ivd_zaxjboAJ&quot;&gt;markus...@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:<br>
&lt;br&gt;<br>
&lt;br&gt;&gt;&nbsp;Should&nbsp;have&nbsp;mentioned&nbsp;that,&nbsp;too:&nbsp;I'm&nbsp;running&nbsp;Mac&nbsp;OS&nbsp;X&nbsp;10.8.2&nbsp;with&nbsp;the<br>
&lt;br&gt;&gt;&nbsp;latest&nbsp;XCode&nbsp;version&nbsp;(4.5.2).<br>
&lt;br&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&nbsp;On&nbsp;Thu,&nbsp;Nov&nbsp;8,&nbsp;2012&nbsp;at&nbsp;12:11&nbsp;PM,&nbsp;Ashish&nbsp;Agarwal&nbsp;&lt;&lt;a&nbsp;href=&quot;javascript:&quot;&nbsp;target=&quot;_blank&quot;&nbsp;gdf-obfuscated-mailto=&quot;ivd_zaxjboAJ&quot;&gt;agarw...@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:<br>
&lt;br&gt;&gt;&gt;&nbsp;I&nbsp;correctly&nbsp;get&nbsp;an&nbsp;exception&nbsp;with&nbsp;OCaml&nbsp;3.12.1,&nbsp;Core&nbsp;108.00.02,&nbsp;on&nbsp;Mac&nbsp;OS&nbsp;X<br>
&lt;br&gt;&gt;&gt;&nbsp;10.7.5.<br>
&lt;br&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&nbsp;On&nbsp;Thu,&nbsp;Nov&nbsp;8,&nbsp;2012&nbsp;at&nbsp;12:04&nbsp;PM,&nbsp;Markus&nbsp;Mottl&nbsp;&lt;&lt;a&nbsp;href=&quot;javascript:&quot;&nbsp;target=&quot;_blank&quot;&nbsp;gdf-obfuscated-mailto=&quot;ivd_zaxjboAJ&quot;&gt;markus...@gmail.com&lt;/a&gt;&gt;<br>
&lt;br&gt;&gt;&gt;&nbsp;wrote:<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;Hi,<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;I've&nbsp;run&nbsp;into&nbsp;a&nbsp;segfault&nbsp;on&nbsp;Mac&nbsp;OS&nbsp;X&nbsp;with&nbsp;a&nbsp;very&nbsp;trivial&nbsp;program&nbsp;that<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;basically&nbsp;just&nbsp;links&nbsp;with&nbsp;Jane&nbsp;Street&nbsp;Core.&nbsp;&nbsp;Here&nbsp;is&nbsp;the&nbsp;file&nbsp;&lt;a&nbsp;href=&quot;http://test.ml&quot;&nbsp;target=&quot;_blank&quot;&gt;test.ml&lt;/a&gt;:<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;----------<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;module&nbsp;X&nbsp;=&nbsp;Core<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;let&nbsp;()&nbsp;=&nbsp;[||].(0)&nbsp;&lt;-&nbsp;42<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;----------<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;You&nbsp;can&nbsp;build&nbsp;it&nbsp;as&nbsp;follows:<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;&nbsp;ocamlbuild&nbsp;-use-ocamlfind&nbsp;-cflag&nbsp;-thread&nbsp;-lflag&nbsp;-thread&nbsp;-pkgs&nbsp;core<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;test.native<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;Running&nbsp;test.native&nbsp;will&nbsp;give&nbsp;you&nbsp;a&nbsp;segfault.&nbsp;&nbsp;Here&nbsp;is&nbsp;the&nbsp;stack<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;backtrace:<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;----------<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;#0&nbsp;&nbsp;0x00007fff90fa78a5&nbsp;in&nbsp;misaligned_stack_error_&lt;wbr&gt;entering_dyld_stub_binder<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;()<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;#1&nbsp;&nbsp;0x0000000000000103&nbsp;in&nbsp;??&nbsp;()<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;#2&nbsp;&nbsp;0x0000000101c0a088&nbsp;in&nbsp;pvars&nbsp;()<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;#3&nbsp;&nbsp;0x0000000101bddedd&nbsp;in&nbsp;caml_raise&nbsp;()<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;#4&nbsp;&nbsp;0x0000000101bddf99&nbsp;in&nbsp;caml_array_bound_error&nbsp;()<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;#5&nbsp;&nbsp;0x00000001019b6aca&nbsp;in&nbsp;.L101&nbsp;()<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;----------<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;The&nbsp;program&nbsp;should&nbsp;just&nbsp;raise&nbsp;an&nbsp;exception&nbsp;due&nbsp;to&nbsp;the&nbsp;illegal&nbsp;array<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;access.&nbsp;&nbsp;Merely&nbsp;raising&nbsp;an&nbsp;exception&nbsp;directly&nbsp;doesn't&nbsp;trigger&nbsp;the<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;problem.&nbsp;&nbsp;The&nbsp;program&nbsp;won't&nbsp;segfault&nbsp;either&nbsp;if&nbsp;the&nbsp;&quot;module&nbsp;X&nbsp;=&nbsp;Core&quot;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;line&nbsp;is&nbsp;commented&nbsp;out,&nbsp;i.e.&nbsp;Core&nbsp;has&nbsp;to&nbsp;be&nbsp;linked&nbsp;in.&nbsp;&nbsp;Other&nbsp;libraries<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;apparently&nbsp;also&nbsp;don't&nbsp;cause&nbsp;this&nbsp;issue.<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;Could&nbsp;another&nbsp;Mac&nbsp;OS&nbsp;X&nbsp;user&nbsp;here&nbsp;please&nbsp;verify&nbsp;the&nbsp;problem?&nbsp;&nbsp;I'm&nbsp;using<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;OCaml&nbsp;4.00.1&nbsp;with&nbsp;Opam&nbsp;and&nbsp;the&nbsp;latest&nbsp;release&nbsp;of&nbsp;Core&nbsp;in&nbsp;there.<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;Maybe&nbsp;somebody&nbsp;more&nbsp;knowledgeable&nbsp;about&nbsp;stack&nbsp;alignment&nbsp;and&nbsp;linking<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;issues&nbsp;on&nbsp;Mac&nbsp;OS&nbsp;X&nbsp;has&nbsp;an&nbsp;idea&nbsp;what's&nbsp;going&nbsp;wrong&nbsp;here.&nbsp;&nbsp;I&nbsp;suspect<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;it's&nbsp;a&nbsp;code&nbsp;generation,&nbsp;linking&nbsp;or&nbsp;even&nbsp;runtime&nbsp;issue&nbsp;that&nbsp;may&nbsp;need&nbsp;to<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;be&nbsp;fixed&nbsp;in&nbsp;the&nbsp;compiler.&nbsp;&nbsp;Or&nbsp;there&nbsp;could&nbsp;be&nbsp;a&nbsp;bug&nbsp;in&nbsp;some&nbsp;module<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;initialization&nbsp;in&nbsp;Core&nbsp;that&nbsp;is&nbsp;using&nbsp;C-bindings&nbsp;(less&nbsp;likely,&nbsp;I'm&nbsp;not<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;aware&nbsp;of&nbsp;anything&nbsp;that&nbsp;could&nbsp;cause&nbsp;this).<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;Regards,<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;Markus<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;--<br>
&lt;br&gt;&gt;&gt;&gt;&nbsp;Markus&nbsp;Mottl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://www.ocaml.info&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.ocaml.info&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;javascript:&quot;&nbsp;target=&quot;_blank&quot;&nbsp;gdf-obfuscated-mailto=&quot;ivd_zaxjboAJ&quot;&gt;markus...@gmail.com&lt;/a&gt;<br>
&lt;br&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&nbsp;<br>
&lt;br&gt;&gt;&nbsp;--&nbsp;<br>
&lt;br&gt;&gt;&nbsp;Markus&nbsp;Mottl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://www.ocaml.info&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.ocaml.info&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;javascript:&quot;&nbsp;target=&quot;_blank&quot;&nbsp;gdf-obfuscated-mailto=&quot;ivd_zaxjboAJ&quot;&gt;markus...@gmail.com&lt;/a&gt;<br>
&lt;br&gt;&gt;&nbsp;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;
</tt>
