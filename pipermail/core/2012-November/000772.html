<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Cross-module inlining fails
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20Cross-module%20inlining%20fails&In-Reply-To=%3CCAFd54qMr%3DBg-sx%2BYCh65uSJePDCOYAFOGtjFCqmxpgKbEKD_kg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000771.html">
   <LINK REL="Next"  HREF="000774.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Cross-module inlining fails</H1>
    <B>Valentin Gatien-Baron</B> 
    <A HREF="mailto:core%40lists.ocaml.org?Subject=Re%3A%20Cross-module%20inlining%20fails&In-Reply-To=%3CCAFd54qMr%3DBg-sx%2BYCh65uSJePDCOYAFOGtjFCqmxpgKbEKD_kg%40mail.gmail.com%3E"
       TITLE="Cross-module inlining fails">vgatien-baron at janestreet.com
       </A><BR>
    <I>Mon Nov 19 18:23:17 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000771.html">Cross-module inlining fails
</A></li>
        <LI>Next message: <A HREF="000774.html">Cross-module inlining fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#772">[ date ]</a>
              <a href="thread.html#772">[ thread ]</a>
              <a href="subject.html#772">[ subject ]</a>
              <a href="author.html#772">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Not all cmx's should be installed, but I don't see why the packed cmx
should not be installed. Generally speaking, I think packed cmx's are
not special and every cmx that was given to ocamlopt to build the cmxa
should be installed.

cmxs are for dynamic loading, so that's not related.

On 11/19/12, Sylvain Le Gall &lt;<A HREF="http://lists.ocaml.org/listinfo/core">sylvain at le-gall.net</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 2012/11/19 Markus Mottl &lt;<A HREF="http://lists.ocaml.org/listinfo/core">markus.mottl at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've noticed that cross-module inlining does not work with the
</I>&gt;&gt;<i> Opam-installed Core library, because the .cmx file is not installed.
</I>&gt;&gt;<i> Note that it is not enough to install the .cmxa file, because it is
</I>&gt;&gt;<i> only used during linking.  The compiler wouldn't know where to look
</I>&gt;&gt;<i> for optimization information.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Looking at the setup.ml file generated by Oasis, it seems that Oasis
</I>&gt;&gt;<i> is the culprit, but I thought it would be important to know for other
</I>&gt;&gt;<i> Core users if they experience bad performance.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sylvain, is there anything one has to put in the _oasis file to
</I>&gt;&gt;<i> generate correct installation code?  My guess is that all that's
</I>&gt;&gt;<i> needed is to fix setup.ml by installing the .cmx of packing targets
</I>&gt;&gt;<i> (e.g. core.cmx), not just .cmx files for constituents of unpacked
</I>&gt;&gt;<i> libraries, which seem to be handled correctly.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well, .cmx file should be installed EXCEPT if you are using packed
</I>&gt;<i> modules...
</I>&gt;<i>
</I>&gt;<i> The culprit is:
</I>&gt;<i> (not lib.lib_pack) &amp;&amp; (* Do not install .cmx packed submodules *)
</I>&gt;<i> in src/oasis/OASISLibrary.ml
</I>&gt;<i>
</I>&gt;<i> AFAIK, Core use pack module, so this is the reason why it doesn't install
</I>&gt;<i> .cmx.
</I>&gt;<i>
</I>&gt;<i> You can experiment installing .cmx by commenting this line. But I am really
</I>&gt;<i> not sure this will help that much. I thought that .cmxs was a pack of .cmx
</I>&gt;<i> so that inlining can work using what is inside this archive (contrary to
</I>&gt;<i> .cmxa).
</I>&gt;<i>
</I>&gt;<i> Maybe the inlining using .cmxs doesn't work as excepted ?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Regards,
</I>&gt;&gt;<i> Markus
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Markus Mottl        <A HREF="http://www.ocaml.info">http://www.ocaml.info</A>        <A HREF="http://lists.ocaml.org/listinfo/core">markus.mottl at gmail.com</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000771.html">Cross-module inlining fails
</A></li>
	<LI>Next message: <A HREF="000774.html">Cross-module inlining fails
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#772">[ date ]</a>
              <a href="thread.html#772">[ thread ]</a>
              <a href="subject.html#772">[ subject ]</a>
              <a href="author.html#772">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/core">More information about the core
mailing list</a><br>
</body></html>
