From louis.gesbert at ocamlpro.com  Thu Jan  9 18:43:05 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Thu, 09 Jan 2014 19:43:05 +0100
Subject: [ocaml-platform] opam 1.1.1 to be released shortly
Message-ID: <1398884.DsPVFKPgNf@agaric>

Happy new year everyone !

I am putting everything together to release 1.1.1 in the next few days, which should unlock the release of opam-doc and help package opam-in-a-box. I am getting through the last few issues tagged for 1.1.1, postponing what is not either trivial or urgent.

1.1.1 features mostly bug-fixes and UI/doc improvements, but also focuses on improving the API and tools to be a better base for the platform (functions for opam-doc, interface with tools like opamfu and opam-installer). Once this is released, there will be more room to (progressively) merge the stash of deeper changes that I have been working on in the meantime.

Please discuss any requests or blockers for 1.1.1 !
The biggest current issue is probably the upgrade problems with the built-in heuristic, but there isn't much we can do before the release, and the real solution is to have aspcud packaged and working on OSX.

Cheers,
Louis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/platform/attachments/20140109/3a2aaea6/attachment.html>

From anil at recoil.org  Thu Jan  9 23:36:49 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 9 Jan 2014 23:36:49 +0000
Subject: [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <1398884.DsPVFKPgNf@agaric>
References: <1398884.DsPVFKPgNf@agaric>
Message-ID: <20140109233649.GA2106@dark.recoil.org>

On Thu, Jan 09, 2014 at 07:43:05PM +0100, Louis Gesbert wrote:
> Happy new year everyone !
> 
> I am putting everything together to release 1.1.1 in the next few days,
> which should unlock the release of opam-doc and help package
> opam-in-a-box. I am getting through the last few issues tagged for
> 1.1.1, postponing what is not either trivial or urgent.
> 
> 1.1.1 features mostly bug-fixes and UI/doc improvements, but also
> focuses on improving the API and tools to be a better base for the
> platform (functions for opam-doc, interface with tools like opamfu and
> opam-installer). Once this is released, there will be more room to
> (progressively) merge the stash of deeper changes that I have been
> working on in the meantime.
> 
> Please discuss any requests or blockers for 1.1.1 !  The biggest current
> issue is probably the upgrade problems with the built-in heuristic, but
> there isn't much we can do before the release, and the real solution is
> to have aspcud packaged and working on OSX.

Thanks Louis!  The solver issue is my last remaining big concern as well
before getting 1.1.1 out of the door.  It would be very useful to
characterise the reason for the failure to see if a quick workaround is
possible, since so many users are hitting it.  If it's just due to the
growing number of packages, perhaps we can add some more constraints to
the package descriptions help the solver find a solution more easily?

Aside from that, the only other problem I can think of that confused users
was the inconsistent 'packages added or removed' display after an opam
update.  Was that fixed?  I couldn't find the live issue.

When you have an RC let me know, and I'll run it through it's paces on the
various BSDs to make sure that there haven't been any regressions due to
the `which` vs `type` changes.

-anil

From roberto at dicosmo.org  Fri Jan 10 07:34:23 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Fri, 10 Jan 2014 08:34:23 +0100
Subject: [ocaml-platform] [opam-devel] opam 1.1.1 to be released shortly
In-Reply-To: <20140109233649.GA2106@dark.recoil.org>
References: <1398884.DsPVFKPgNf@agaric> <20140109233649.GA2106@dark.recoil.org>
Message-ID: <20140110073423.GA14450@voyager>

On Thu, Jan 09, 2014 at 11:36:49PM +0000, Anil Madhavapeddy wrote:
> > Please discuss any requests or blockers for 1.1.1 !  The biggest current
> > issue is probably the upgrade problems with the built-in heuristic, but
> > there isn't much we can do before the release, and the real solution is
> > to have aspcud packaged and working on OSX.
> 
> Thanks Louis!  The solver issue is my last remaining big concern as well
> before getting 1.1.1 out of the door.  It would be very useful to
> characterise the reason for the failure to see if a quick workaround is
> possible, since so many users are hitting it.  If it's just due to the
> growing number of packages, perhaps we can add some more constraints to
> the package descriptions help the solver find a solution more easily?
> 

Thanks Louis for all this work!

As for the solver, unfortunately it is not a simple piece of code that can be
"fixed" with "workarounds", that's why we have been strongly advocating to use a
modular architecture for package managers, with interchangeable solvers clearly
separated from the rest, see for example
http://dx.doi.org/10.1016/j.infsof.2012.09.002

The only sensible thing to do is to actually package aspcud (and possibly
also packup and mccs) for Mac OSX and Windows, which is a reasonably simple
engineering task; I have contacted the developer team of aspcud to encourage
them to do this, and I do have hope to see this done in the year, but I have
no guarantee.

Considering the time frame, and the fact that this kind of issues is
going to come up more and more over time, I do understand that we need
a quicker solution, and the best thing is to ask for help with this 
among our friends OCamlrs...

I'll write a detailed mail on the list to this end this afternoon (now,
as alway, meeting... meeting... meeting :-( )

-- 
Roberto
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 3020 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        

From anil at recoil.org  Fri Jan 10 09:59:24 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 10 Jan 2014 09:59:24 +0000
Subject: [ocaml-platform] [opam-devel] opam 1.1.1 to be released shortly
In-Reply-To: <20140110073423.GA14450@voyager>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <20140110073423.GA14450@voyager>
Message-ID: <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>

On 10 Jan 2014, at 07:34, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

> Considering the time frame, and the fact that this kind of issues is
> going to come up more and more over time, I do understand that we need
> a quicker solution, and the best thing is to ask for help with this 
> among our friends OCamlrs...

If someone could point me to what to port, I'd be happy to take a look
at OpenBSD and Homebrew ports. I'm CCing Vsevolod who has been interested
in a FreeBSD port of aspcud for their new package managers.

What are the differences between the 'paranoid', 'basic' and 'full' user
tracks on their website, and does it affect OPAM?

-anil

From louis.gesbert at ocamlpro.com  Fri Jan 10 13:46:25 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 10 Jan 2014 14:46:25 +0100
Subject: [ocaml-platform] [opam-devel] opam 1.1.1 to be released shortly
In-Reply-To: <20140109233649.GA2106@dark.recoil.org>
References: <1398884.DsPVFKPgNf@agaric> <20140109233649.GA2106@dark.recoil.org>
Message-ID: <3311556.qEzEnXgqjl@ocp-dell>

> Aside from that, the only other problem I can think of that confused users
> was the inconsistent 'packages added or removed' display after an opam
> update.  Was that fixed?  I couldn't find the live issue.

No, not fixed yet. I had shifted it to 1.2 already but will have a second look.

> When you have an RC let me know, and I'll run it through it's paces on the
> various BSDs to make sure that there haven't been any regressions due to
> the `which` vs `type` changes.

Ok, will do, thanks a lot !

Louis


From roberto at dicosmo.org  Fri Jan 10 17:44:08 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Fri, 10 Jan 2014 18:44:08 +0100
Subject: [ocaml-platform] [opam-devel] opam 1.1.1 to be released shortly
In-Reply-To: <52D02257.5020007@cam.ac.uk>
References: <1398884.DsPVFKPgNf@agaric> <20140109233649.GA2106@dark.recoil.org>
 <20140110073423.GA14450@voyager>
 <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>
 <52D02257.5020007@cam.ac.uk>
Message-ID: <20140110174408.GA21382@voyager>

Hi Vsevolod,
   that's great news, a big thank you!!!

I have just sent out a request for help packaging
aspcud, mccs and packup, and now found out that you
almost finished aspcud already :-)

A couple of suggestions :

 - add a comment on https://github.com/ocaml/opam/issues/1074
   mentioning your work on FreeBSD

 - check the patch added by Ralf in the latest version of the
   Debian aspcud package to ensure backwards compatibility of
   the optimization criteria supported by the latest aspcud
   with the legacy criteria supported by the other solvers...
   this basically boils down to adding a few lines to the 
   aspcud bash shell to use a short sed file and convert the
   old criteria in the new language supported by the latest
   aspcud... you'll find attached the modified aspcud and the
   sed file from the Debian package

 - once this is done, you can try to run opam and check whether
   all works fine... it looks for aspcud using "which aspcud"

All the best

--
Roberto
   

On Fri, Jan 10, 2014 at 04:39:51PM +0000, Vsevolod Stakhov wrote:
> JFYI, I have ported aspcud to FreeBSD today (together with gringo and
> clasp). It seems to be working with some test cudf files.
> 
> The most tricky patch was to enable support of the libc++ from LLVM, but
> I hopefully have managed it.
> 
> On 10/01/14 09:59, Anil Madhavapeddy wrote:
> > On 10 Jan 2014, at 07:34, Roberto Di Cosmo <roberto at dicosmo.org> wrote:
> > 
> >> Considering the time frame, and the fact that this kind of issues is
> >> going to come up more and more over time, I do understand that we need
> >> a quicker solution, and the best thing is to ask for help with this 
> >> among our friends OCamlrs...
> > 
> > If someone could point me to what to port, I'd be happy to take a look
> > at OpenBSD and Homebrew ports. I'm CCing Vsevolod who has been interested
> > in a FreeBSD port of aspcud for their new package managers.
> > 
> > What are the differences between the 'paranoid', 'basic' and 'full' user
> > tracks on their website, and does it affect OPAM?
> > 
> > -anil
> > 
> 
> -- 
> Vsevolod Stakhov

-- 
Roberto Di Cosmo
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 3020 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        
-------------- next part --------------
# new -> count(new)
# removed -> count(removed)
# changed -> count(changed)
# notuptodate -> notuptodate(solution)
# unsat_recommends -> unsat_recommends(solution)
# sum(name) -> sum(name,solution)

s/\([+-]\)\(new\|removed\|changed\)/\1count(\2)/g
s/\([+-]\)\(notuptodate\|unsat_recommends\)\([^(]\|$\)/\1\2(solution)\3/g
s/\([+-]\)sum(\([a-z]*\))/\1sum(\2,solution)/g
-------------- next part --------------
#!/bin/bash

clasp_bin=clasp
unclasp_bin=unclasp
gringo_bin=gringo
cudf2lp_bin=/usr/lib/aspcud/bin/cudf2lp
sharedir=/usr/share/aspcud

trendycriterion="-count(removed),-notuptodate(solution),-unsat_recommends(solution),-count(new)"

if [[ $3 == trendy ]]; then
    criterion=$trendycriterion;
else
    criterion=`sed -f /usr/share/aspcud/misc11-to-misc12 <<< $3`
fi

function enc()
{
	for x in "." "$sharedir/encodings"; do
		[[ -e "$x/$1" ]] && { echo "$x/$1"; return 0; }
	done
	echo "$x"
	return 1
}

function cleanup()
{
	[[ -d "$tmp" ]] && rm -rf "$tmp"
}

function die()
{
	echo "error: $1" >&2
	exit 0
}

function usage()
{
	echo "Usage: ${0} [OPTION]... CUDFIN CUDFOUT [CRITERIA]"
	echo "  -h       print this help"
	echo "  -c OPT   append clasp option OPT"
	echo "  -e ENC   append encoding ENC"
	echo "  -p OPT   append cudf2lp option OPT"
	echo "  -s SOL   choose solver {clasp,unclasp}"
	echo
	echo "Default commandline for clasp:"
	echo -n "$(basename "${0}")"
	for x in "${clasp_opts_def[@]}";  do
		echo " \\"
		echo -n "    -c $x"
	done
	for x in "${gringo_opts_def[@]}";  do
		echo " \\"
		echo -n "    -e $x"
	done
	echo
	echo
	echo "Default commandline for unclasp:"
	echo -n "$(basename "${0}")"
	for x in "${unclasp_opts_def[@]}";  do
		echo " \\"
		echo -n "    -c $x"
	done
	for x in "${ungringo_opts_def[@]}";  do
		echo " \\"
		echo -n "    -e $x"
	done
	echo
}

base="$(dirname "$(readlink -f "$0")")"
PATH=".:$base:$base/../build/release/bin:$PATH"

# default options
solver=""
clasp_opts_def=( "--opt-heu=1" "--sat-prepro" "--restarts=L,128" "--heuristic=VSIDS" "--opt-hierarch=1" "--local-restarts" "--del-max=200000,250" )
unclasp_opts_def=( )
gringo_opts_def=( "$(enc misc2012.lp)" )
ungringo_opts_def=( "$(enc misc2012.lp)" )

cudf_opts=( )
clasp_opts=( )
gringo_opts=( )

unset wrapper_out
unset tmp

while getopts "hc:e:p:s:" flag
do
	case "$flag" in
		"e") gringo_opts=( "${gringo_opts[@]}" "$(enc "$OPTARG")" ) ;;
		"c") clasp_opts=( "${clasp_opts[@]}" "$OPTARG" ) ;;
		"p") cudf_opts=( "${cudf_opts[@]}" "$OPTARG" ) ;;
		"s") solver="$OPTARG" ;;
		"h") usage; exit 0 ;;
		"?") exit 1 ;;
	esac
done

shift $((OPTIND-1))

if [[ -z ${solver} ]]; then
	if echo $(basename "$0") | grep -q "aspuncud"; then
		solver="unclasp"
	elif echo $(basename "$0") | grep -q "aspcud"; then
		solver="clasp"
	fi
fi

case "${solver}" in 
	clasp)
		solver_bin="${clasp_bin}"
		clasp_opts_implicit=( "--stats=2" "--quiet=1,2" )
		;;
	unclasp)
		clasp_opts_def=( "${unclasp_opts_def[@]}" )
		gringo_opts_def=( "${ungringo_opts_def[@]}" )
		solver_bin="${unclasp_bin}"
		clasp_opts_implicit=( "--stats" )
		;;
	*)
		die "error: solver clasp or unclasp expected"
		;;
esac

[[ ${#clasp_opts[*]} -eq 0 ]] && clasp_opts=( "${clasp_opts_def[@]}" )
[[ ${#gringo_opts[*]} -eq 0 ]] && gringo_opts=( "${gringo_opts_def[@]}" )
clasp_opts=( "${clasp_opts[@]}" "${clasp_opts_implicit[@]}" )

if [[ $# -eq 3 ]]; then
	cudf_opts=( "${cudf_opts[@]}" "-c" "$criterion" )
elif echo $(basename "$0") | grep -q "paranoid"; then
	[[ $# -ne 2 ]] && { die "error: exactly two arguments expected"; }
	cudf_opts=( "${cudf_opts[@]}" "-c" "paranoid" )
else
	die "error: exactly three arguments expected"
fi

wrapper_out="$2"

trap cleanup EXIT

test -n "${TMPDIR}" && tmpdir="${TMPDIR}/"
tmp="$(mktemp -d "${tmpdir}outXXXXXX")"

# note this is probably unecessary...
function usrtrap() {
:
}
trap usrtrap USR1 TERM INT

cat <<EOF > "$tmp/parse.py"
#!/usr/bin/python
import signal, re, sys

def ignore(x, y): pass

signal.signal(signal.SIGUSR1, ignore)
signal.signal(signal.SIGTERM, ignore)
signal.signal(signal.SIGINT,  ignore)
signal.signal(signal.SIGPIPE, ignore)

out = open("$wrapper_out", "w")

keep = False
solution = None
try:
	for line in sys.stdin:
		sys.stdout.write(line[:-1][:81])
		sys.stdout.write("\n")
		if keep: 
			solution = line
			keep = False
		if line.startswith("Answer"): keep = True
except: pass

if solution == None: out.write("FAIL\n")
else:
        for m in re.finditer(r'in\\("(?P<pkg>[^,]+)",(?P<ver>[^)]+)\\)', solution):
                out.write("package: " + m.group("pkg") + "\\n")
                out.write("version: " + m.group("ver") + "\\n")
                out.write("installed: true\\n\\n")
out.close()

sys.stdout.write(open("$tmp/clasp_err").read())
sys.stdout.write(open("$tmp/gringo_err").read())
sys.stdout.write(open("$tmp/cudf_err").read())
EOF
chmod +x "$tmp/parse.py"

"${cudf2lp_bin}" "${cudf_opts[@]}"   > "$tmp/cudf_out"   2> "$tmp/cudf_err"   < "$1"
"${gringo_bin}"  "${gringo_opts[@]}" > "$tmp/gringo_out" 2> "$tmp/gringo_err" "$tmp/cudf_out"
"${solver_bin}"  "${clasp_opts[@]}"                      2> "$tmp/clasp_err"  "$tmp/gringo_out" | "$tmp/parse.py"


From louis.gesbert at ocamlpro.com  Tue Jan 14 09:34:39 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 14 Jan 2014 10:34:39 +0100
Subject: [ocaml-platform] [opam-devel] opam 1.1.1 to be released shortly
In-Reply-To: <3311556.qEzEnXgqjl@ocp-dell>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <3311556.qEzEnXgqjl@ocp-dell>
Message-ID: <1854196.ShU3pOPAaF@agaric>

I am going to test and do a few last fixes, and should have a RC available today.

Unless they are needed for 1.1.1, I am going to add a bunch of variables just after the release (`system-version`, `build-dir`, `opt-available`, and all those in https://github.com/ocaml/opam/pull/967).

No easy fix yet, but I'll try to improve the reports on what's NEW or UPDATED today (#1030); as for the solver/heuristic issue (#985), the (source) release can be independent from the port of aspcud so I don't think it is a blocker.

Cheers,
Louis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/platform/attachments/20140114/57a2e4ad/attachment.html>

From anil at recoil.org  Tue Jan 14 10:54:55 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 14 Jan 2014 10:54:55 +0000
Subject: [ocaml-platform] [opam-devel] opam 1.1.1 to be released shortly
In-Reply-To: <1854196.ShU3pOPAaF@agaric>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <3311556.qEzEnXgqjl@ocp-dell>
 <1854196.ShU3pOPAaF@agaric>
Message-ID: <2D08CF53-03EB-4460-8AE6-9E776C50B620@recoil.org>

Sounds good - could you also merge trunk with the 1.1 branch for the RC and tag it from there instead of trunk?

-anil

On 14 Jan 2014, at 09:34, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> I am going to test and do a few last fixes, and should have a RC available today.
>  
> Unless they are needed for 1.1.1, I am going to add a bunch of variables just after the release (`system-version`, `build-dir`, `opt-available`, and all those in https://github.com/ocaml/opam/pull/967).
>  
> No easy fix yet, but I'll try to improve the reports on what's NEW or UPDATED today (#1030); as for the solver/heuristic issue (#985), the (source) release can be independent from the port of aspcud so I don't think it is a blocker.
>  
> Cheers,
> Louis
> _______________________________________________
> Platform mailing list
> Platform at lists.ocaml.org
> http://lists.ocaml.org/listinfo/platform

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/platform/attachments/20140114/89b1d1e9/attachment.html>

From louis.gesbert at ocamlpro.com  Tue Jan 14 17:11:11 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 14 Jan 2014 18:11:11 +0100
Subject: [ocaml-platform] OPAM 1.1.1 RC
Message-ID: <7642023.CBU7nb4V1q@agaric>

The first RC for OPAM 1.1.1 has just been tagged. Everyone is welcome to try it out and report any last-minute problems !

Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.

Cheers !
Louis


>From the changelog:
* Fix `opam-admin make <packages> -r` (#990)
* Explicitly prettyprint list of lists, to fix `opam-admin depexts` (#997)
* Tell the user which fields is invalid in a configuration file (#1016)
* Add `OpamSolver.empty_universe` for flexible universe instantiation (#1033)
* Add `OpamFormula.eval_relop` and `OpamFormula.check_relop` (#1042)
* Change `OpamCompiler.compare` to match `Pervasives.compare` (#1042)
* Add `OpamCompiler.eval_relop` (#1042)
* Add `OpamPackage.Name.compare` (#1046)
* Add types `version_constraint` and `version_formula` to `OpamFormula` (#1046)
* Clearer command aliases. Made `info` an alias for `show` and added the alias `uninstall` (#944)
* Fixed `opam init --root=<relative path>` (#1047)
* Display OS constraints in `opam info` (#1052)
* Add a new 'opam-installer' script to make `.install` files usable outside of opam (#1026)
* Add a `--resolve` option to `opam-admin make` that builds just the archives you need
  for a specific installation (#1031)
* Fixed handling of spaces in filenames in internal files (#1014)
* Replace calls to `which` by a more portable call (#1061)
* Fixed generation of the init scripts in some cases (#1011)
* Better reports on package patch errors (#987, #988)
* More accurate warnings for unknown package dependencies (#1079)
* Added `opam config report` to help with bug reports (#1034)
* Do not reinstall dev packages with `opam upgrade <pkg>` (#1001)
* Be more careful with `opam init` to a non-empty root directory (#974)
* Cleanup build-dir after successful compiler installation to save on space (#1006)
* Enable packagers to specify mirrors in url files (#807)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/platform/attachments/20140114/00a0ffc3/attachment.html>

From anil at recoil.org  Tue Jan 14 17:34:55 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 14 Jan 2014 17:34:55 +0000
Subject: [ocaml-platform] OPAM 1.1.1 RC
In-Reply-To: <7642023.CBU7nb4V1q@agaric>
References: <7642023.CBU7nb4V1q@agaric>
Message-ID: <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>

On 14 Jan 2014, at 17:11, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.

I don't think this should be included in 1.1.1, since it changes the repository format.  For instance, is there a clear backwards compatibility story for 1.1.0 clients that connect to a repository that includes multiple archives?

-anil


From louis.gesbert at ocamlpro.com  Wed Jan 15 09:27:54 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 15 Jan 2014 10:27:54 +0100
Subject: [ocaml-platform] [opam-devel]  OPAM 1.1.1 RC
In-Reply-To: <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
References: <7642023.CBU7nb4V1q@agaric>
 <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
Message-ID: <3243493.3NMBiFsKb1@ocp-dell>

On Tuesday 14 January 2014 17:34:55 Anil Madhavapeddy wrote:
> On 14 Jan 2014, at 17:11, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
> > Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.
> 
> I don't think this should be included in 1.1.1, since it changes the repository format.  For instance, is there a clear backwards compatibility story for 1.1.0 clients that connect to a repository that includes multiple archives?

Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.

Any opinions on this ? The problem still exists even if we shift that after release.

Cheers,
Louis

From gabriel.scherer at gmail.com  Wed Jan 15 09:50:49 2014
From: gabriel.scherer at gmail.com (Gabriel Scherer)
Date: Wed, 15 Jan 2014 10:50:49 +0100
Subject: [ocaml-platform] [opam-devel] OPAM 1.1.1 RC
In-Reply-To: <3243493.3NMBiFsKb1@ocp-dell>
References: <7642023.CBU7nb4V1q@agaric>
 <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
 <3243493.3NMBiFsKb1@ocp-dell>
Message-ID: <CAPFanBF_aa8ccco=ddKadGaYsDzgvcFx_GgfNCKmGtu3ZYrWaw@mail.gmail.com>

In the future it may be worth thinking about format versioning, so
that next-version server can apply an adaptation layer when talking to
previous-version clients.

On Wed, Jan 15, 2014 at 10:27 AM, Louis Gesbert
<louis.gesbert at ocamlpro.com> wrote:
> On Tuesday 14 January 2014 17:34:55 Anil Madhavapeddy wrote:
>> On 14 Jan 2014, at 17:11, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>>
>> > Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.
>>
>> I don't think this should be included in 1.1.1, since it changes the repository format.  For instance, is there a clear backwards compatibility story for 1.1.0 clients that connect to a repository that includes multiple archives?
>
> Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
> If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.
>
> Any opinions on this ? The problem still exists even if we shift that after release.
>
> Cheers,
> Louis
> _______________________________________________
> Platform mailing list
> Platform at lists.ocaml.org
> http://lists.ocaml.org/listinfo/platform

From anil at recoil.org  Wed Jan 15 10:03:29 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 15 Jan 2014 10:03:29 +0000
Subject: [ocaml-platform] [opam-devel]  OPAM 1.1.1 RC
In-Reply-To: <3243493.3NMBiFsKb1@ocp-dell>
References: <7642023.CBU7nb4V1q@agaric>
 <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
 <3243493.3NMBiFsKb1@ocp-dell>
Message-ID: <025C47AC-6380-47B5-ACC8-78D1478C33E9@recoil.org>

On 15 Jan 2014, at 09:27, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> On Tuesday 14 January 2014 17:34:55 Anil Madhavapeddy wrote:
>> On 14 Jan 2014, at 17:11, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>> 
>>> Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.
>> 
>> I don't think this should be included in 1.1.1, since it changes the repository format.  For instance, is there a clear backwards compatibility story for 1.1.0 clients that connect to a repository that includes multiple archives?
> 
> Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
> If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.

It's not critical to have it right now.  Unplanned outages happen, and this one might have happened right after the 1.1.1 release and the world won't end.  Let's pull it and implement the feature more thoroughly in 1.2.0 rather than cram it into a point release.

> Any opinions on this ? The problem still exists even if we shift that after release.

Not necessarily.  We could bump the repo version in 1.2.0 and think about a compatibility shim for 1.1.0 (via opam-admin rewrites).

-anil


> 
> Cheers,
> Louis
> 


From Christophe.Troestler at umons.ac.be  Wed Jan 15 10:22:08 2014
From: Christophe.Troestler at umons.ac.be (Christophe Troestler)
Date: Wed, 15 Jan 2014 11:22:08 +0100
Subject: [ocaml-platform] [opam-devel] OPAM 1.1.1 RC
In-Reply-To: <3243493.3NMBiFsKb1@ocp-dell>
References: <7642023.CBU7nb4V1q@agaric>
 <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
 <3243493.3NMBiFsKb1@ocp-dell>
Message-ID: <20140115.112208.811095868884036097.Christophe.Troestler@umons.ac.be>

On Wed, 15 Jan 2014 10:27:54 +0100, Louis Gesbert wrote:
> 
> Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
> If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.
> 
> Any opinions on this ? The problem still exists even if we shift that after release.

Does it break if we allow several archive fields?

From louis.gesbert at ocamlpro.com  Wed Jan 15 10:33:06 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 15 Jan 2014 11:33:06 +0100
Subject: [ocaml-platform] [opam-devel] OPAM 1.1.1 RC
In-Reply-To: <20140115.112208.811095868884036097.Christophe.Troestler@umons.ac.be>
References: <7642023.CBU7nb4V1q@agaric> <3243493.3NMBiFsKb1@ocp-dell>
 <20140115.112208.811095868884036097.Christophe.Troestler@umons.ac.be>
Message-ID: <3058383.EPME0THgC5@ocp-dell>

On Wednesday 15 January 2014 11:22:08 Christophe Troestler wrote:
> On Wed, 15 Jan 2014 10:27:54 +0100, Louis Gesbert wrote:
> > 
> > Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
> > If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.
> > 
> > Any opinions on this ? The problem still exists even if we shift that after release.
> 
> Does it break if we allow several archive fields?

The OPAM file formats in general don't allow duplicated fields, so we would need to add a deeper-rooted exception for this. As we are not _that_ hurried, 1.1.1 will be without that patch so that the repo migration can be done properly.

From roberto at dicosmo.org  Wed Jan 15 15:13:40 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Wed, 15 Jan 2014 16:13:40 +0100
Subject: [ocaml-platform] [opam-devel] opam 1.1.1 to be released shortly
In-Reply-To: <1854196.ShU3pOPAaF@agaric>
References: <1398884.DsPVFKPgNf@agaric> <20140109233649.GA2106@dark.recoil.org>
 <3311556.qEzEnXgqjl@ocp-dell> <1854196.ShU3pOPAaF@agaric>
Message-ID: <CAJBwKuWuaF1d7BYOA8r2K+9zUzBGJ65WyJ9no2J6M0xNz2xk+A@mail.gmail.com>

Hi Louis,
   I agree that aspcud is not a blocker, if the patch to aspcud is
properly integrated on Mac OSX,
so we can keep the default value for OPAMCRITERIA.

Once we have a proper external solver on all platforms, we should be
able to clean up all the complex heuristics code present today, but
that can wait.

2014/1/14 Louis Gesbert <louis.gesbert at ocamlpro.com>:
> I am going to test and do a few last fixes, and should have a RC available
> today.
>
>
>
> Unless they are needed for 1.1.1, I am going to add a bunch of variables
> just after the release (`system-version`, `build-dir`, `opt-available`, and
> all those in https://github.com/ocaml/opam/pull/967).
>
>
>
> No easy fix yet, but I'll try to improve the reports on what's NEW or
> UPDATED today (#1030); as for the solver/heuristic issue (#985), the
> (source) release can be independent from the port of aspcud so I don't think
> it is a blocker.
>
>
>
> Cheers,
>
> Louis
>
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>



-- 
Roberto Di Cosmo

------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:

Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3

From louis.gesbert at ocamlpro.com  Wed Jan 29 15:36:52 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 29 Jan 2014 16:36:52 +0100
Subject: [ocaml-platform] OPAM 1.1.1 Released !
Message-ID: <2402300.iHojb7qSok@agaric>

We are glad to announce that OPAM 1.1.1 has just been released.
https://github.com/ocaml/opam/releases/tag/1.1.1


The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES

Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.

This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.

Thanks to all who contributed to this :)

Louis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/platform/attachments/20140129/dade966f/attachment.html>

From anil at recoil.org  Thu Jan 30 11:03:22 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 30 Jan 2014 11:03:22 +0000
Subject: [ocaml-platform] OPAM 1.1.1 Released !
In-Reply-To: <2402300.iHojb7qSok@agaric>
References: <2402300.iHojb7qSok@agaric>
Message-ID: <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>

Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
(with aspcud as recommended)

Ubuntu packages building in my unstable PPA:
https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.

CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.

Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture binaries more easily.  It would be great to submit OPAM into Fedora as well.


-anil

On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> We are glad to announce that OPAM 1.1.1 has just been released.
> https://github.com/ocaml/opam/releases/tag/1.1.1
>  
>  
> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>  
> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>  
> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>  
> Thanks to all who contributed to this :)
>  
> Louis
> _______________________________________________
> Platform mailing list
> Platform at lists.ocaml.org
> http://lists.ocaml.org/listinfo/platform


From gabriel.scherer at gmail.com  Thu Jan 30 11:34:01 2014
From: gabriel.scherer at gmail.com (Gabriel Scherer)
Date: Thu, 30 Jan 2014 12:34:01 +0100
Subject: [ocaml-platform] [ANN] Experiment: OCaml patch review on
	github.com/ocaml/ocaml
Message-ID: <CAPFanBH4fYEmgoXkNLwAfta1cRVSPjmA-gB1GdzjeTWRATGeCQ@mail.gmail.com>

TL;DR: During the six next months, we will follow pull requests (PR)
posted on the github mirror of the OCaml distribution, as an
alternative to the mantis bugtracker. This experiment hopes to attract
more people to participate in the extremely helpful and surprisingly
rewarding activity of patch reviews.


Dear OCaml community,

I think we need more people ready to review patches proposed for
inclusion in the OCaml compiler/distribution; lack of reviews is
currently one of the bottleneck in the development process -- among
others, such as the sheer difficulty to reach consensus on any change
to the language itself. Doing patch reviews is helpful, extremely
interesting, and an excellent way to get to know more about small
parts of the compiler.

There was a resurgence of discussions on caml-list (Yotam Barnoy's
[moving to github] and Adrien Nader's thoughtful proposal of
a [mailing-list for patch review]). Amir Chaudhry launched a poll to
record decreasing order of preference, and the [results] are
clear-cut: people hate Mantis' guts, and would rather use anything
else.

[moving to github]: http://alan.petitepomme.net/cwn/2013.12.24.html#5
[mailing-list for patch review]:
https://sympa.inria.fr/sympa/arc/caml-list/2014-01/msg00055.html
[results]: https://docs.google.com/forms/d/1QWhqJRv1yPvdi6E3AiqbvUwlqGorV_Wbk7h_JYuDUiQ/viewanalytics

I declare open the following experiment: for six months, starting
today upto late July, patches proposed for the OCaml distribution may
be submitted as a pull request (PR) on the [main github mirror], and
we warmly encourage anyone to review the proposed patches, and make
any comments they feel can help. Anything that can help improve the
contribution, or discuss potential issues (backward compatibility,
future-proofiness of the change, alternative designs...) will speed up
the time between a patch proposal and a clear decision to integrate it
or not.

[main github mirror]: https://github.com/ocaml/ocaml/

In six months, we will reconsider, the default choice being to stop
using github and revert to a mantis-only workflow. In the meantime,
I will mirror the github PRs on the mantis side, so that contributors
that do not wish to use the github interface can continue working as
before. Patches and reviews are of course still welcome on mantis.

Note that github will *not* be used for issue tracking, only for patch
reviews. If you want to submit a patch against a bug discussed in
Mantis, or want to re-submit a patch already in Mantis (in the wild
hope of more eyeballs), feel free to send a github PR and link to it
from the bugtracker. Finally, the github mirror remains *read-only*:
if patches are accepted, the PR will be closed but will be committed
to the SVN first, and synced in git as usual.

We're just trying things to see if it works better. I hope it does. In
any case, thanks in advance for your participation -- whichever tool
you use. Happy hacking!

.

PS: If you want to get notified for all Pull Requests sent, you
(need a github account and) can click on the "Watch" button in the top
right of http://github.com/ocaml/ocaml to register for
notifications. In the [notification settings] page of your account,
you can set up notifications to get send by email and/or to the
(mostly useless) github notification web interface.

[notification settings](https://github.com/settings/notifications)

From anil at recoil.org  Thu Jan 30 14:45:44 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 30 Jan 2014 14:45:44 +0000
Subject: [ocaml-platform] OPAM 1.1.1 Released !
In-Reply-To: <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
Message-ID: <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>

There appears to be some regression due to ocp-build. All the builds have failed due to :

cat ocp-build.run ocp-build.boot > ocp-build
chmod +x ocp-build
./ocp-build -help >/dev/null 2>&1
make[1]: *** [ocp-build] Error 2
make: *** [ocp-build/ocp-build] Error 2


See:
http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
(MacOS X)

or 
https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
(ubuntu)

Louis, could you help here? I won't have time to look at this until tomorrow morning probably.

-anil

On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:

> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
> (with aspcud as recommended)
> 
> Ubuntu packages building in my unstable PPA:
> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
> I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.
> 
> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
> 
> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture binaries more easily.  It would be great to submit OPAM into Fedora as well.
> 
> 
> -anil
> 
> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
>> We are glad to announce that OPAM 1.1.1 has just been released.
>> https://github.com/ocaml/opam/releases/tag/1.1.1
>> 
>> 
>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>> 
>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>> 
>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>> 
>> Thanks to all who contributed to this :)
>> 
>> Louis
>> _______________________________________________
>> Platform mailing list
>> Platform at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/platform
> 
> _______________________________________________
> Platform mailing list
> Platform at lists.ocaml.org
> http://lists.ocaml.org/listinfo/platform
> 


From Fabrice.Le_fessant at inria.fr  Thu Jan 30 14:55:30 2014
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Thu, 30 Jan 2014 15:55:30 +0100
Subject: [ocaml-platform] [opam-devel]  OPAM 1.1.1 Released !
In-Reply-To: <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
 <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>
Message-ID: <CAHvkLrMVRc=6+LzWHB+VdH28K+yXCJ-OGfXMWopOb8hu5Owo8g@mail.gmail.com>

Weird, I could compile opam-1.1.1 with both OCaml 4.01.0 and OCaml
3.12.1 on my Ubuntu. Any specific patch applied there on OCaml that
could explain this problem ?

By the way, you should also probably change

./ocp-build -help >/dev/null 2>&1

to

./ocp-build -help >log.txt 2>&1

to get some feedback when something gets wrong.

--Fabrice


On Thu, Jan 30, 2014 at 3:45 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
> There appears to be some regression due to ocp-build. All the builds have failed due to :
>
> cat ocp-build.run ocp-build.boot > ocp-build
> chmod +x ocp-build
> ./ocp-build -help >/dev/null 2>&1
> make[1]: *** [ocp-build] Error 2
> make: *** [ocp-build/ocp-build] Error 2
>
>
> See:
> http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
> (MacOS X)
>
> or
> https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
> (ubuntu)
>
> Louis, could you help here? I won't have time to look at this until tomorrow morning probably.
>
> -anil
>
> On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:
>
>> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
>> (with aspcud as recommended)
>>
>> Ubuntu packages building in my unstable PPA:
>> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
>> I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.
>>
>> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
>>
>> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture binaries more easily.  It would be great to submit OPAM into Fedora as well.
>>
>>
>> -anil
>>
>> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>>
>>> We are glad to announce that OPAM 1.1.1 has just been released.
>>> https://github.com/ocaml/opam/releases/tag/1.1.1
>>>
>>>
>>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>>>
>>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>>>
>>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>>>
>>> Thanks to all who contributed to this :)
>>>
>>> Louis
>>> _______________________________________________
>>> Platform mailing list
>>> Platform at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/platform
>>
>> _______________________________________________
>> Platform mailing list
>> Platform at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/platform
>>
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel



-- 
Fabrice LE FESSANT
Chercheur en Informatique
INRIA Paris Rocquencourt -- OCamlPro
Programming Languages and Distributed Systems

From anil at recoil.org  Thu Jan 30 14:57:51 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 30 Jan 2014 14:57:51 +0000
Subject: [ocaml-platform] [opam-devel]  OPAM 1.1.1 Released !
In-Reply-To: <CAHvkLrMVRc=6+LzWHB+VdH28K+yXCJ-OGfXMWopOb8hu5Owo8g@mail.gmail.com>
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
 <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>
 <CAHvkLrMVRc=6+LzWHB+VdH28K+yXCJ-OGfXMWopOb8hu5Owo8g@mail.gmail.com>
Message-ID: <90351454-C7E8-420A-97DC-A6D1327878F6@recoil.org>

The Debian/Ubuntu/FreeBSD distribution packages are generally patched with
the ocamlbuild patches to avoid depending on the ocp-build binary blob.

The Homebrew packages use ocp-build, but also exhibit this failure.

I really dislike the use of two build systems in OPAM; it makes maintaining
the distro packages an unnecessary chore.  Mehdi has observed the same in
the past. 

-anil

On 30 Jan 2014, at 14:55, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:

> Weird, I could compile opam-1.1.1 with both OCaml 4.01.0 and OCaml
> 3.12.1 on my Ubuntu. Any specific patch applied there on OCaml that
> could explain this problem ?
> 
> By the way, you should also probably change
> 
> ./ocp-build -help >/dev/null 2>&1
> 
> to
> 
> ./ocp-build -help >log.txt 2>&1
> 
> to get some feedback when something gets wrong.
> 
> --Fabrice
> 
> 
> On Thu, Jan 30, 2014 at 3:45 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>> There appears to be some regression due to ocp-build. All the builds have failed due to :
>> 
>> cat ocp-build.run ocp-build.boot > ocp-build
>> chmod +x ocp-build
>> ./ocp-build -help >/dev/null 2>&1
>> make[1]: *** [ocp-build] Error 2
>> make: *** [ocp-build/ocp-build] Error 2
>> 
>> 
>> See:
>> http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
>> (MacOS X)
>> 
>> or
>> https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
>> (ubuntu)
>> 
>> Louis, could you help here? I won't have time to look at this until tomorrow morning probably.
>> 
>> -anil
>> 
>> On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:
>> 
>>> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
>>> (with aspcud as recommended)
>>> 
>>> Ubuntu packages building in my unstable PPA:
>>> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
>>> I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.
>>> 
>>> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
>>> 
>>> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture binaries more easily.  It would be great to submit OPAM into Fedora as well.
>>> 
>>> 
>>> -anil
>>> 
>>> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>>> 
>>>> We are glad to announce that OPAM 1.1.1 has just been released.
>>>> https://github.com/ocaml/opam/releases/tag/1.1.1
>>>> 
>>>> 
>>>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>>>> 
>>>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>>>> 
>>>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>>>> 
>>>> Thanks to all who contributed to this :)
>>>> 
>>>> Louis
>>>> _______________________________________________
>>>> Platform mailing list
>>>> Platform at lists.ocaml.org
>>>> http://lists.ocaml.org/listinfo/platform
>>> 
>>> _______________________________________________
>>> Platform mailing list
>>> Platform at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/platform
>>> 
>> 
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
> 
> 
> 
> -- 
> Fabrice LE FESSANT
> Chercheur en Informatique
> INRIA Paris Rocquencourt -- OCamlPro
> Programming Languages and Distributed Systems
> 


From mmatalka at gmail.com  Thu Jan 30 16:20:50 2014
From: mmatalka at gmail.com (Malcolm Matalka)
Date: Thu, 30 Jan 2014 16:20:50 +0000
Subject: [ocaml-platform] [opam-devel]  OPAM 1.1.1 Released !
In-Reply-To: <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org> (Anil
 Madhavapeddy's message of "Thu, 30 Jan 2014 14:45:44 +0000")
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
 <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>
Message-ID: <878utxv3tp.fsf@gmail.com>

Probably this:

https://github.com/ocaml/opam/issues/1038

Anil Madhavapeddy <anil at recoil.org> writes:

> There appears to be some regression due to ocp-build. All the builds have failed due to :
>
> cat ocp-build.run ocp-build.boot > ocp-build
> chmod +x ocp-build
> ./ocp-build -help >/dev/null 2>&1
> make[1]: *** [ocp-build] Error 2
> make: *** [ocp-build/ocp-build] Error 2
>
>
> See:
> http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
> (MacOS X)
>
> or 
> https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
> (ubuntu)
>
> Louis, could you help here? I won't have time to look at this until tomorrow morning probably.
>
> -anil
>
> On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:
>
>> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
>> (with aspcud as recommended)
>> 
>> Ubuntu packages building in my unstable PPA:
>> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
>> I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.
>> 
>> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
>> 
>> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture
>> binaries more easily.  It would be great to submit OPAM into Fedora as well.
>> 
>> 
>> -anil
>> 
>> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>> 
>>> We are glad to announce that OPAM 1.1.1 has just been released.
>>> https://github.com/ocaml/opam/releases/tag/1.1.1
>>> 
>>> 
>>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>>> 
>>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation
>>> on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>>> 
>>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>>> 
>>> Thanks to all who contributed to this :)
>>> 
>>> Louis
>>> _______________________________________________
>>> Platform mailing list
>>> Platform at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/platform
>> 
>> _______________________________________________
>> Platform mailing list
>> Platform at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/platform
>> 
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

From anil at recoil.org  Thu Jan 30 16:30:02 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 30 Jan 2014 16:30:02 +0000
Subject: [ocaml-platform] [opam-devel]  OPAM 1.1.1 Released !
In-Reply-To: <878utxv3tp.fsf@gmail.com>
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
 <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org> <878utxv3tp.fsf@gmail.com>
Message-ID: <D6DED056-E8F2-4545-9BD1-FA46F2A5649E@recoil.org>

Spot on! I've pushed a quick fix to Homebrew to test it against the buildbot.

-anil

On 30 Jan 2014, at 16:20, Malcolm Matalka <mmatalka at gmail.com> wrote:

> Probably this:
> 
> https://github.com/ocaml/opam/issues/1038
> 
> Anil Madhavapeddy <anil at recoil.org> writes:
> 
>> There appears to be some regression due to ocp-build. All the builds have failed due to :
>> 
>> cat ocp-build.run ocp-build.boot > ocp-build
>> chmod +x ocp-build
>> ./ocp-build -help >/dev/null 2>&1
>> make[1]: *** [ocp-build] Error 2
>> make: *** [ocp-build/ocp-build] Error 2
>> 
>> 
>> See:
>> http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
>> (MacOS X)
>> 
>> or 
>> https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
>> (ubuntu)
>> 
>> Louis, could you help here? I won't have time to look at this until tomorrow morning probably.
>> 
>> -anil
>> 
>> On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:
>> 
>>> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
>>> (with aspcud as recommended)
>>> 
>>> Ubuntu packages building in my unstable PPA:
>>> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
>>> I've made one change to the packaging here by adding 'aspcud' to the recommended list. I'll mail the OCaml list when I put these live in the stable PPA.
>>> 
>>> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
>>> 
>>> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture
>>> binaries more easily.  It would be great to submit OPAM into Fedora as well.
>>> 
>>> 
>>> -anil
>>> 
>>> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>>> 
>>>> We are glad to announce that OPAM 1.1.1 has just been released.
>>>> https://github.com/ocaml/opam/releases/tag/1.1.1
>>>> 
>>>> 
>>>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>>>> 
>>>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation
>>>> on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>>>> 
>>>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>>>> 
>>>> Thanks to all who contributed to this :)
>>>> 
>>>> Louis
>>>> _______________________________________________
>>>> Platform mailing list
>>>> Platform at lists.ocaml.org
>>>> http://lists.ocaml.org/listinfo/platform
>>> 
>>> _______________________________________________
>>> Platform mailing list
>>> Platform at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/platform
>>> 
>> 
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel


