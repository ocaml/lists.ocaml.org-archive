<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] mirage, opam and cross-compiling... ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20mirage%2C%20opam%20and%20cross-compiling...%20%3F&In-Reply-To=%3C4C20415C7327A849961F3B8421413725010CD5506A95%40EXCHANGE1.ad.nottingham.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000197.html">
   <LINK REL="Next"  HREF="000199.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] mirage, opam and cross-compiling... ?</H1>
    <B>Christopher Greenhalgh</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20mirage%2C%20opam%20and%20cross-compiling...%20%3F&In-Reply-To=%3C4C20415C7327A849961F3B8421413725010CD5506A95%40EXCHANGE1.ad.nottingham.ac.uk%3E"
       TITLE="[opam-devel] mirage, opam and cross-compiling... ?">Chris.Greenhalgh at nottingham.ac.uk
       </A><BR>
    <I>Thu Sep 19 09:55:55 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000197.html">[opam-devel] mirage, opam and cross-compiling... ?
</A></li>
        <LI>Next message: <A HREF="000199.html">[opam-devel] .opam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#198">[ date ]</a>
              <a href="thread.html#198">[ thread ]</a>
              <a href="subject.html#198">[ subject ]</a>
              <a href="author.html#198">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18 September 2013 16:58 Anil Madhavapeddy wrote:

&gt;<i>- there's no standard for specifying an equivalent to CFLAGS/CC in OCaml build systems -- everyone defines their own.
</I>
I did some thinking about (something that turned out to be equivalent to) this and I came up with what - to me - seems like a sensible scheme; for posterity I've noted it here: <A HREF="https://github.com/cgreenhalgh/ocaml-crosscompiling/blob/master/docs/toolchainproposal.md">https://github.com/cgreenhalgh/ocaml-crosscompiling/blob/master/docs/toolchainproposal.md</A> 
but probably it should be fed somewhere else as it would involve a new flag in all the ocaml commands...

&gt;<i>- the annoying ones are usually syntax extensions, which need to be built as host libraries and not target libraries.  We have a way to sidestep this as of a few weeks ago.  Leo White has built a specialized compiler driver that bypasses the usual compiler parse tree, and instead statically links in some camlp4 extensions.  This is not only faster, but it avoids dynamic linking in the compiler completely!  Most of our syntax extension requirements are actually pretty minimal (the Lwt one, and perhaps Sexplib and Cow), so we could just link those into one mega-compiler-driver that works on all the source code that we care about.
</I>
With and ocaml-android cross-compiler this seems to have 'just worked' so far, presumably because it is using the syntax extensions as bytecode only and they have no dependencies on native libraries. (I haven't dug enough to see exactly what is going on yet). Potentially fragile, though...

p.s.  I've left a link but moved my notes to a new git repo, <A HREF="https://github.com/cgreenhalgh/ocaml-crosscompiling">https://github.com/cgreenhalgh/ocaml-crosscompiling</A> )

Cheers
Chris

This message and any attachment are intended solely for the addressee and may contain confidential information. If you have received this message in error, please send it back to me, and immediately delete it.   Please do not use, copy or disclose the information contained in this message or in any attachment.  Any views or opinions expressed by the author of this email do not necessarily reflect the views of the University of Nottingham.

This message has been checked for viruses but the contents of an attachment
may still contain software viruses which could damage your computer system, you are advised to perform your own checks. Email communications with the University of Nottingham may be monitored as permitted by UK legislation.




</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000197.html">[opam-devel] mirage, opam and cross-compiling... ?
</A></li>
	<LI>Next message: <A HREF="000199.html">[opam-devel] .opam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#198">[ date ]</a>
              <a href="thread.html#198">[ thread ]</a>
              <a href="subject.html#198">[ subject ]</a>
              <a href="author.html#198">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
