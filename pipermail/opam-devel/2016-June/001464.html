<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] opam 2 containers/building toplevel
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20opam%202%20containers/building%20toplevel&In-Reply-To=%3CE51C5B015DBD1348A1D85763337FB6D9F058C88C%40Remus.metastack.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001463.html">
   <LINK REL="Next"  HREF="001465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] opam 2 containers/building toplevel</H1>
    <B>David Allsopp</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20opam%202%20containers/building%20toplevel&In-Reply-To=%3CE51C5B015DBD1348A1D85763337FB6D9F058C88C%40Remus.metastack.local%3E"
       TITLE="[opam-devel] opam 2 containers/building toplevel">dra-news at metastack.com
       </A><BR>
    <I>Wed Jun  1 16:05:40 BST 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="001463.html">[opam-devel] opam 2 containers/building toplevel
</A></li>
        <LI>Next message: <A HREF="001465.html">[opam-devel] opam 2 containers/building toplevel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1464">[ date ]</a>
              <a href="thread.html#1464">[ thread ]</a>
              <a href="subject.html#1464">[ subject ]</a>
              <a href="author.html#1464">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Louis Gesbert wrote:
&gt;<i> Le mercredi 1 juin 2016, 14:29:45 David Allsopp a &#233;crit :
</I>&gt;<i> &gt; Anil Madhavapeddy wrote:
</I>&gt;<i> &gt; &gt; &gt; On 31 May 2016, at 14:36, Louis Gesbert
</I>&gt;<i> &gt; &gt; &gt; &lt;<A HREF="http://lists.ocaml.org/listinfo/opam-devel">louis.gesbert at ocamlpro.com</A>&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; wrote:
</I>&gt;<i> &gt; &lt;snip&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; The issue with `make lib-ext` may be that `opam-admin.top` can't
</I>&gt;<i> &gt; &gt; &gt; find the proper opam libraries installed. The Makefile in
</I>&gt;<i> &gt; &gt; &gt; `admin-scripts/` has a quick hack to build bytecode versions, but
</I>&gt;<i> &gt; &gt; &gt; that reiles on `ocamlfind` to locate the installed versions of the
</I>&gt;<i> &gt; &gt; &gt; dependencies; it wouldn't be difficult to improve it to work with
</I>&gt;<i> `lib-ext` though.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; It would be very useful if they could work with lib-ext and the
</I>&gt;<i> &gt; &gt; toplevel be built by default.  Right now there is some oddness where
</I>&gt;<i> &gt; &gt; the extlib interactive installer is run if I build `opam-admin.top`
</I>&gt;<i> &gt; &gt; manually, so I gave up around there.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; lib-ext isn't very well-conceived/constructed, IMNRHO! See
</I>&gt;<i> &gt; <A HREF="https://github.com/dra27/opam/commit/f740058a639306c093de3b4f7425a0174">https://github.com/dra27/opam/commit/f740058a639306c093de3b4f7425a0174</A>
</I>&gt;<i> &gt; 7239e 97. Part of my reason for spending time last year implementing
</I>&gt;<i> &gt; lib-pkg in the build system ...
</I>&gt;<i> 
</I>&gt;<i> Nice fix,  I'd gladly merge the PR
</I>
Feel free to cherry-pick it (it's on <A HREF="https://github.com/dra27/opam/commits/windows-build">https://github.com/dra27/opam/commits/windows-build</A>) - while Git is wonderful, I found working on OCaml earlier in the year that it's not wonderful when you're trying to maintain a large number of pull requests and a rebasing branch of all of those PRs in one! So for now, I'd prefer to keep my contributions in one branch only, until the darned thing's actually finished, just for my own sanity! :o) The rebase does a good job of noticing when fixes like that have been superseded.

&gt;<i> For lib-ext... well, we needed a build system:
</I>&gt;<i> - for OCaml
</I>&gt;<i> - with no dependencies
</I>&gt;<i> 
</I>&gt;<i> and it's just to bootstrap. Yes obviously, lib-ext is an ugly hack, and I
</I>&gt;<i> am not proud of it; the doc+Makefiles makes sure you only use it for
</I>&gt;<i> building the opam binary and not for usable libraries though
</I>&gt;<i> 
</I>&gt;<i> The previous solution was cleaner, but relied on ocp-build. Migrating to
</I>&gt;<i> OCamlMakefile was a painful experience, but I can't see a better option
</I>&gt;<i> around. Also, it manages to not be too much trouble to maintain.
</I>
<A HREF="https://github.com/dra27/opam/commit/8ccda84b17ffd57543a15e4a09072ba9a237fefe">https://github.com/dra27/opam/commit/8ccda84b17ffd57543a15e4a09072ba9a237fefe</A> :o)


David
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001463.html">[opam-devel] opam 2 containers/building toplevel
</A></li>
	<LI>Next message: <A HREF="001465.html">[opam-devel] opam 2 containers/building toplevel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1464">[ date ]</a>
              <a href="thread.html#1464">[ thread ]</a>
              <a href="subject.html#1464">[ subject ]</a>
              <a href="author.html#1464">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
