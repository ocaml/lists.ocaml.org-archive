<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] opam 2 containers/building toplevel
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20opam%202%20containers/building%20toplevel&In-Reply-To=%3CE51C5B015DBD1348A1D85763337FB6D9F058C3E9%40Remus.metastack.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="001462.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] opam 2 containers/building toplevel</H1>
    <B>David Allsopp</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20opam%202%20containers/building%20toplevel&In-Reply-To=%3CE51C5B015DBD1348A1D85763337FB6D9F058C3E9%40Remus.metastack.local%3E"
       TITLE="[opam-devel] opam 2 containers/building toplevel">dra-news at metastack.com
       </A><BR>
    <I>Wed Jun  1 15:29:45 BST 2016</I>
    <P><UL>
        
        <LI>Next message: <A HREF="001462.html">[opam-devel] opam 2 containers/building toplevel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1461">[ date ]</a>
              <a href="thread.html#1461">[ thread ]</a>
              <a href="subject.html#1461">[ subject ]</a>
              <a href="author.html#1461">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Anil Madhavapeddy wrote:
&gt;<i> &gt; On 31 May 2016, at 14:36, Louis Gesbert &lt;<A HREF="http://lists.ocaml.org/listinfo/opam-devel">louis.gesbert at ocamlpro.com</A>&gt;
</I>&gt;<i> wrote:
</I>
&lt;snip&gt;

&gt;<i> &gt; The issue with `make lib-ext` may be that `opam-admin.top` can't find
</I>&gt;<i> &gt; the proper opam libraries installed. The Makefile in `admin-scripts/`
</I>&gt;<i> &gt; has a quick hack to build bytecode versions, but that reiles on
</I>&gt;<i> &gt; `ocamlfind` to locate the installed versions of the dependencies; it
</I>&gt;<i> &gt; wouldn't be difficult to improve it to work with `lib-ext` though.
</I>&gt;<i> 
</I>&gt;<i> It would be very useful if they could work with lib-ext and the toplevel
</I>&gt;<i> be built by default.  Right now there is some oddness where the extlib
</I>&gt;<i> interactive installer is run if I build `opam-admin.top` manually, so I
</I>&gt;<i> gave up around there.
</I>
lib-ext isn't very well-conceived/constructed, IMNRHO! See <A HREF="https://github.com/dra27/opam/commit/f740058a639306c093de3b4f7425a01747239e97.">https://github.com/dra27/opam/commit/f740058a639306c093de3b4f7425a01747239e97.</A> Part of my reason for spending time last year implementing lib-pkg in the build system ...

I then hacked admin-scripts/compilers-to-packages.ml and changed the #directory entries to include src/{core,repository,format,tools} and src_ext and can run that script which I used to replicate the next branch on opam-repository and so rebased to create <A HREF="https://github.com/dra27/opam-repository/tree/next-windows">https://github.com/dra27/opam-repository/tree/next-windows</A> (I've been doing a lot of work locally, which is why it's lagging behind master at the moment). 

&gt;<i> &gt; Now, for scripts that get generally useful and somewhat stable, it's
</I>&gt;<i> &gt; perfectly fine to migrate them to be part of opam-admin. Moving the
</I>&gt;<i> &gt; scripts to their own repo would also be fine if they reach a critical
</I>&gt;<i> weight.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Should we improve compat of the Makefile and/or move the 1.2-&gt;2.0
</I>&gt;<i> &gt; functionality to opam-admin ?
</I>&gt;<i> 
</I>&gt;<i> For the purposes of container-based testing, it would be great if we could
</I>&gt;<i> move the essential functionality into `opam admin` directly.  This will
</I>&gt;<i> let me insert in the right `git clone / opam admin upgrade` runs into the
</I>&gt;<i> CI scripts so that OPAM 2 is easy to test for end users.
</I>
compilers-to-packages.ml will be a one-time thing, though, surely? Once OPAM 2 goes live, surely the main repository will need to work in reverse, back-porting an OPAM 1.x.y repository?


David
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="001462.html">[opam-devel] opam 2 containers/building toplevel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1461">[ date ]</a>
              <a href="thread.html#1461">[ thread ]</a>
              <a href="subject.html#1461">[ subject ]</a>
              <a href="author.html#1461">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
