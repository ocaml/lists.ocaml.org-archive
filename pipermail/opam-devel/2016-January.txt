From louis.gesbert at ocamlpro.com  Mon Jan 18 15:02:41 2016
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 19 Jan 2016 00:02:41 +0900
Subject: [opam-devel] Opam license bug
Message-ID: <2498690.sFXyP31mEN@maitake>

Dear all,

It so happens that the license that was shipped with Opam -- and, accordingly, 
under the terms of which it was officially distributed, is bogus. More details 
on the issue below, but the trouble is, a CLA was not put in place at the 
beginning, nor ever since, and OCamlPro -- although copyright holder of 98% of 
the current code? -- is hands tied to change the license without a general 
agreement by now.

This highlights the need for such an agreement, so I would be very glad if our 
dear contributors would be so kind to read and agree to our CLA, helping in 
solving this and possible further licensing issues.

## Our CLA

We propose to our contributors the CLA that we already apply to some of our 
software, which can be read at:

  https://www.ocamlpro.com/files/CLA-OCamlPro-individual.txt

I honestly believe it to be on the open end of the spectrum for such 
agreements, as it basically only gives us the rights to relicense under our 
own terms, without otherwise depriving the contributors of their rights?. It's 
basically the same terms used by e.g. Google.

## The issue

Opam is distributed under the terms of the LGPL v3 "with OCaml linking 
exception"?, the problem being with the definition of the exception, which was 
written against the LGPL v2, and not properly adapted. It patches the wrong 
clauses, making it actually worthless. Assuming that this results in the 
original LGPL v3 to apply, it is more restrictive than what we intended!

This situation is thus a legal hazard to users of the Opam lib, first and 
foremost, and clarifying things on that front should be beneficial for 
everyone.

Note that the issue was raised after discussions with the spdx folks on  
https://github.com/ocaml/opam/pull/2224. Their detailed answer can be read at:

  http://lists.spdx.org/pipermail/spdx-legal/2015-July/001464.html

This affects other projects as well.


I am sending this to opam-devel first for your opinion, and I am no lawyer so 
feel free to rectify if I made any mistakes. I'll take care of gathering the 
authors of significant contributions and asking them individually when 
necessary.

Best,
Louis Gesbert, OCamlPro



? As computed using, on my current dev branch:
    git ls-files 'src/**ml*' | xargs -n1 git blame --line-porcelain | sed -n 
's/^author //p' | sort -f | uniq -ic | sort -rVb

? We heard a complaint about it from Daniel B?nzli, and do not believe it to 
be the general feeling. To make your own informed opinion on it, here are the 
related comments and our answers:

  https://github.com/OCamlPro/ocp-indent/pull/192
  
? according to the LICENSE file, and source headers: the README doesn't 
actually even mention this explicitely

From daniel.buenzli at erratique.ch  Mon Jan 18 15:48:01 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Mon, 18 Jan 2016 16:48:01 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <2498690.sFXyP31mEN@maitake>
References: <2498690.sFXyP31mEN@maitake>
Message-ID: <8F669B09640C490BADCB361FFDAE3EFC@erratique.ch>

CLA are chores for everyone involved and barriers to contribution. 

Distribute opam under a liberal license under which you ask your contributors to license their contributions and all your problems will be gone with less lawyers and paperwork involved.

Your proposal is a disservice to the project.

Best,

Daniel



From dra-news at metastack.com  Mon Jan 18 16:01:58 2016
From: dra-news at metastack.com (David Allsopp)
Date: Mon, 18 Jan 2016 16:01:58 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <2498690.sFXyP31mEN@maitake>
References: <2498690.sFXyP31mEN@maitake>
Message-ID: <E51C5B015DBD1348A1D85763337FB6D9EA1D9A61@Remus.metastack.local>

Louis Gesbert wrote:
> ## The issue
> 
> Opam is distributed under the terms of the LGPL v3 "with OCaml linking
> exception"?, the problem being with the definition of the exception, which
> was written against the LGPL v2, and not properly adapted. It patches the
> wrong clauses, making it actually worthless.

I am not a lawyer, but I don't need to ask any of the considerable number amongst my acquaintance to know that this would be little more than a clerical error under British contract law - it would be highly unlikely that it would render the exception void. But then British Law has the benefit of being based on Common Law, so that may be of little of help with other European/US considerations...


David

From daniel.buenzli at erratique.ch  Mon Jan 18 16:17:11 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Mon, 18 Jan 2016 17:17:11 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <2498690.sFXyP31mEN@maitake>
References: <2498690.sFXyP31mEN@maitake>
Message-ID: <6B36A6D786AA4B3581BA517B6F88CCC5@erratique.ch>

Le lundi, 18 janvier 2016 ? 16:02, Louis Gesbert a ?crit :
> ? We heard a complaint about it from Daniel B?nzli, and do not believe it to
> be the general feeling. To make your own informed opinion on it, here are the  
> related comments and our answers:
>  
> https://github.com/OCamlPro/ocp-indent/pull/192
I would also like to add your last answer to this thread is a little bit disingenuous since we all know who's the major financial backer that is behind the software.

Best,  

Daniel



From louis.gesbert at ocamlpro.com  Mon Jan 18 16:29:17 2016
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 19 Jan 2016 01:29:17 +0900
Subject: [opam-devel] Opam license bug
In-Reply-To: <6B36A6D786AA4B3581BA517B6F88CCC5@erratique.ch>
References: <2498690.sFXyP31mEN@maitake>
 <6B36A6D786AA4B3581BA517B6F88CCC5@erratique.ch>
Message-ID: <5957374.O4ZVHedWL1@maitake>

Le lundi 18 janvier 2016, 17:17:11 Daniel B?nzli a ?crit :
> Le lundi, 18 janvier 2016 ? 16:02, Louis Gesbert a ?crit :
> > ? We heard a complaint about it from Daniel B?nzli, and do not believe it
> > to be the general feeling. To make your own informed opinion on it, here
> > are the related comments and our answers:
> > 
> > https://github.com/OCamlPro/ocp-indent/pull/192
> 
> I would also like to add your last answer to this thread is a little bit
> disingenuous since we all know who's the major financial backer that is
> behind the software.

Jane Street is indeed the major financial backer behind opam, and we are very 
thankful for that. Most open-source projects are possible thanks to sponsors, 
and my meaning wasn't that we work for free, which would be nonsense -- I 
didn't intend my wording to be misleading, so sorry if it was.

However, I don't see your point or how it relates to the issue at hand; also 
note that, leaving aside the consideration of LGPL vs BSD, something should be 
done to clarify the current situation anyway.

Best,
Louis

From daniel.buenzli at erratique.ch  Mon Jan 18 16:42:16 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Mon, 18 Jan 2016 17:42:16 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <5957374.O4ZVHedWL1@maitake>
References: <2498690.sFXyP31mEN@maitake>
 <6B36A6D786AA4B3581BA517B6F88CCC5@erratique.ch>
 <5957374.O4ZVHedWL1@maitake>
Message-ID: <4F96AC3AD69F4F6986B2C0333BC3FD88@erratique.ch>

Le lundi, 18 janvier 2016 ? 17:29, Louis Gesbert a ?crit :
> However, I don't see your point or how it relates to the issue at hand; also
> note that, leaving aside the consideration of LGPL vs BSD, something should be  
> done to clarify the current situation anyway.


Well the license has to be clarified; fine: let's ask all contributors to be able to relicense it under the correct license.  

However there's *absolutely no need* to introduce a CLA to do this. Sorry but this looks disingenuous again, you are conflating two very distincts problems into a single one.

Best,  

Daniel





From louis.gesbert at ocamlpro.com  Mon Jan 18 17:01:08 2016
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 19 Jan 2016 02:01:08 +0900
Subject: [opam-devel] Opam license bug
In-Reply-To: <4F96AC3AD69F4F6986B2C0333BC3FD88@erratique.ch>
References: <2498690.sFXyP31mEN@maitake> <5957374.O4ZVHedWL1@maitake>
 <4F96AC3AD69F4F6986B2C0333BC3FD88@erratique.ch>
Message-ID: <4542956.qc8PBNcVrb@maitake>

Le lundi 18 janvier 2016, 17:42:16 Daniel B?nzli a ?crit :
> Le lundi, 18 janvier 2016 ? 17:29, Louis Gesbert a ?crit :
> > However, I don't see your point or how it relates to the issue at hand;
> > also note that, leaving aside the consideration of LGPL vs BSD, something
> > should be done to clarify the current situation anyway.
> 
> Well the license has to be clarified; fine: let's ask all contributors to be
> able to relicense it under the correct license.
> 
> However there's *absolutely no need* to introduce a CLA to do this. Sorry
> but this looks disingenuous again, you are conflating two very distincts
> problems into a single one.
> 
> Best,
> 
> Daniel

Granted, a CLA is not the only solution to the problem. But it is one.

I expected it wouldn't be to your taste, but I don't think this reflects the 
general opinion -- I am waiting to hear more feedback on this. So this is 
still the solution we would like to propose at the moment.

Best,
Louis

From daniel.buenzli at erratique.ch  Mon Jan 18 17:31:32 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Mon, 18 Jan 2016 18:31:32 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <4542956.qc8PBNcVrb@maitake>
References: <2498690.sFXyP31mEN@maitake> <5957374.O4ZVHedWL1@maitake>
 <4F96AC3AD69F4F6986B2C0333BC3FD88@erratique.ch>
 <4542956.qc8PBNcVrb@maitake>
Message-ID: <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>

Le lundi, 18 janvier 2016 ? 18:01, Louis Gesbert a ?crit :
> Granted, a CLA is not the only solution to the problem. But it is one.

So could you please explain us why you think it is a *good* one ?  

The only benefits I see here are for OCamlPro's own IP rights.  

I see however a lot of disadvantages for the whole OCaml community. For example a CLA for opam may reduce the chances that other companies allow their employees to work on opam.  

As for myself I wouldn't sign such a CLA; not only for the unfair terms I mentioned in the thread you linked to but also since I do not understand the bounds of the terms, have no lawyer and do not want nor have the money to hire one.

Best,  

Daniel






From louis.gesbert at ocamlpro.com  Mon Jan 18 18:09:02 2016
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 19 Jan 2016 03:09:02 +0900
Subject: [opam-devel] Opam license bug
In-Reply-To: <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
Message-ID: <4813628.DAUMmrq0a5@maitake>

By having a CLA in place, we ensure we have the hands free to avoid any 
further such issues: the problem can't arise again. Yes, it does allow us to 
re-license the software, or even negociate specific licensing terms with 
partners, which sounds quite fair to me. Also, this adds to the range of 
theoretical possibilities, but we currently have no plans to monetize Opam.

Le lundi 18 janvier 2016, 18:31:32 Daniel B?nzli a ?crit :
> Le lundi, 18 janvier 2016 ? 18:01, Louis Gesbert a ?crit :
> > Granted, a CLA is not the only solution to the problem. But it is one.
> 
> So could you please explain us why you think it is a *good* one ?
> 
> The only benefits I see here are for OCamlPro's own IP rights.
> 
> I see however a lot of disadvantages for the whole OCaml community. For
> example a CLA for opam may reduce the chances that other companies allow
> their employees to work on opam.

I am curious and would be glad to hear more about it: I intuitively don't see 
much difference between submitting a contribution BSD-licensed or under the 
terms of the CLA, from the company's point of view. Am I wrong ?

> As for myself I wouldn't sign such a CLA; not only for the unfair terms I
> mentioned in the thread you linked to but also since I do not understand
> the bounds of the terms, have no lawyer and do not want nor have the money
> to hire one.

I am sorry to hear that: even though your contributions are probably 
quantitatively too small to raise copyright issues, I know that Opam is a 
project that matters to you, and those have been highly appreciated. Anyway, 
let's wait until have more feedback to make a decision on this.

Best,
Louis

From daniel.buenzli at erratique.ch  Mon Jan 18 18:46:26 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Mon, 18 Jan 2016 19:46:26 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <4813628.DAUMmrq0a5@maitake>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
Message-ID: <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>


Le lundi, 18 janvier 2016 ? 19:09, Louis Gesbert a ?crit :
> By having a CLA in place, we ensure we have the hands free to avoid any  
> further such issues: the problem can't arise again. Yes, it does allow us to  
> re-license the software, or even negociate specific licensing terms with  
> partners, which sounds quite fair to me. Also, this adds to the range of  
> theoretical possibilities, but we currently have no plans to monetize Opam.

So let's be honest about it. From the community point of view there are very little incentives to this solution. License changes are rare.

> I am curious and would be glad to hear more about it: I intuitively don't see
> much difference between submitting a contribution BSD-licensed or under the  
> terms of the CLA, from the company's point of view. Am I wrong ?

Yes.  

Opam is LGPL'ed, contributing under the terms of the CLA allows OCamlPro to do whatever it wishes with opam and the contributions. But you as a contributor are not allowed to do whatever you wish since you are bound by LGPL terms. If Opam was under a more liberal license, everyone could do whatever it wishes with the code and we'd no even need to have a discussion about a CLA.  

Also from a broader perspective, companies may have rules that say you are allowed to contribute to projects that have these specific kind of licenses. Having other legalities under the form of CLAs surrounding contribution may be a no go because the legal setting is non standard or would need to much legal investigations.

Best,  

Daniel



From thomas at gazagnaire.org  Mon Jan 18 19:34:21 2016
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Mon, 18 Jan 2016 19:34:21 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch> <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
Message-ID: <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>

Honestly, if we are speaking about re-licensing opam, I am really much in favour of a more liberal license: MIT or BSD is so much simpler than LGPL+CLA, and we don't really need to make the barrier for contributing higher.

Being there at the beginning, I understand the initial choice of license: at the time, the scope of what was being building was not totally clear, opam was the first large independent software project developed by OCamlPro the company was very young and some kind of protection were needed. Nowadays, I think opam is in a very different different situation: it became the default package manager for OCaml. 

So I'd rather look at the next steps at how we can now make opam more widespread. For instance,  lower the contribution barrier: simpler and more re-usable code, more documentation, simpler licensing scheme (BSD is the new norm); and  make it fully OCaml independent: in the source code but also in the manual, and on its own website (generated from GH pages, with manual + roadmap). Lastly, we need all which was discussed on the roadmap for 1.3, including windows support :-)

Best,
Thomas

> Le lundi, 18 janvier 2016 ? 19:09, Louis Gesbert a ?crit :
>> By having a CLA in place, we ensure we have the hands free to avoid any  
>> further such issues: the problem can't arise again. Yes, it does allow us to  
>> re-license the software, or even negociate specific licensing terms with  
>> partners, which sounds quite fair to me. Also, this adds to the range of  
>> theoretical possibilities, but we currently have no plans to monetize Opam.
> 
> So let's be honest about it. From the community point of view there are very little incentives to this solution. License changes are rare.
> 
>> I am curious and would be glad to hear more about it: I intuitively don't see
>> much difference between submitting a contribution BSD-licensed or under the  
>> terms of the CLA, from the company's point of view. Am I wrong ?
> 
> Yes.  
> 
> Opam is LGPL'ed, contributing under the terms of the CLA allows OCamlPro to do whatever it wishes with opam and the contributions. But you as a contributor are not allowed to do whatever you wish since you are bound by LGPL terms. If Opam was under a more liberal license, everyone could do whatever it wishes with the code and we'd no even need to have a discussion about a CLA.  
> 
> Also from a broader perspective, companies may have rules that say you are allowed to contribute to projects that have these specific kind of licenses. Having other legalities under the form of CLAs surrounding contribution may be a no go because the legal setting is non standard or would need to much legal investigations.
> 
> Best,  
> 
> Daniel
> 
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From yminsky at janestreet.com  Mon Jan 18 19:50:53 2016
From: yminsky at janestreet.com (Yaron Minsky)
Date: Mon, 18 Jan 2016 19:50:53 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch> <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
Message-ID: <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>

Daniel, would you be opposed to a CLA if the code were released under a
more liberal license?  For our open source code, Jane Street was advised to
use a CLA, even though we were using a liberal license (Apache, in
particular.)  I'm curious if the CLA itself is a problem, or just the CLA
in combination with a restrictive license?

y

On Mon, Jan 18, 2016 at 2:34 PM Thomas Gazagnaire <thomas at gazagnaire.org>
wrote:

> Honestly, if we are speaking about re-licensing opam, I am really much in
> favour of a more liberal license: MIT or BSD is so much simpler than
> LGPL+CLA, and we don't really need to make the barrier for contributing
> higher.
>
> Being there at the beginning, I understand the initial choice of license:
> at the time, the scope of what was being building was not totally clear,
> opam was the first large independent software project developed by OCamlPro
> the company was very young and some kind of protection were needed.
> Nowadays, I think opam is in a very different different situation: it
> became the default package manager for OCaml.
>
> So I'd rather look at the next steps at how we can now make opam more
> widespread. For instance,  lower the contribution barrier: simpler and more
> re-usable code, more documentation, simpler licensing scheme (BSD is the
> new norm); and  make it fully OCaml independent: in the source code but
> also in the manual, and on its own website (generated from GH pages, with
> manual + roadmap). Lastly, we need all which was discussed on the roadmap
> for 1.3, including windows support :-)
>
> Best,
> Thomas
>
> > Le lundi, 18 janvier 2016 ? 19:09, Louis Gesbert a ?crit :
> >> By having a CLA in place, we ensure we have the hands free to avoid any
> >> further such issues: the problem can't arise again. Yes, it does allow
> us to
> >> re-license the software, or even negociate specific licensing terms with
> >> partners, which sounds quite fair to me. Also, this adds to the range of
> >> theoretical possibilities, but we currently have no plans to monetize
> Opam.
> >
> > So let's be honest about it. From the community point of view there are
> very little incentives to this solution. License changes are rare.
> >
> >> I am curious and would be glad to hear more about it: I intuitively
> don't see
> >> much difference between submitting a contribution BSD-licensed or under
> the
> >> terms of the CLA, from the company's point of view. Am I wrong ?
> >
> > Yes.
> >
> > Opam is LGPL'ed, contributing under the terms of the CLA allows OCamlPro
> to do whatever it wishes with opam and the contributions. But you as a
> contributor are not allowed to do whatever you wish since you are bound by
> LGPL terms. If Opam was under a more liberal license, everyone could do
> whatever it wishes with the code and we'd no even need to have a discussion
> about a CLA.
> >
> > Also from a broader perspective, companies may have rules that say you
> are allowed to contribute to projects that have these specific kind of
> licenses. Having other legalities under the form of CLAs surrounding
> contribution may be a no go because the legal setting is non standard or
> would need to much legal investigations.
> >
> > Best,
> >
> > Daniel
> >
> >
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160118/dfee803f/attachment.html>

From dra-news at metastack.com  Mon Jan 18 19:57:29 2016
From: dra-news at metastack.com (David Allsopp)
Date: Mon, 18 Jan 2016 19:57:29 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch> <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
Message-ID: <E51C5B015DBD1348A1D85763337FB6D9EA1DB3D4@Remus.metastack.local>

For what it's worth...

I agree that starting to have to sign CLAs, etc. leaves a funny taste in the mouth. Daniel has an important point about lawyers, etc. that using a well-known open source licence is a much easier thing to sign up to. The licences tend to be short (or in the GPL's case, very well-explained). Once you start having to sign CLAs, one has to worry about how much one has signed away - for example, while I'm sure yours doesn't, it's quite easy to sign a CLA where you actually transfer so many rights that you lose control over reusing your own code fragments yourself. It's also much easier just to be requiring that everyone use git commit -s rather than actually administering contracts!

OCaml already has a requirement for a CLA, but it's reserved for large contributions only - if there must be CLAs, could such an arrangement be explicitly copied?


David

> -----Original Message-----
> From: opam-devel [mailto:opam-devel-bounces at lists.ocaml.org] On Behalf Of
> Thomas Gazagnaire
> Sent: 18 January 2016 19:34
> To: Daniel B?nzli
> Cc: Louis Gesbert; opam-devel
> Subject: Re: [opam-devel] Opam license bug
> 
> Honestly, if we are speaking about re-licensing opam, I am really much in
> favour of a more liberal license: MIT or BSD is so much simpler than
> LGPL+CLA, and we don't really need to make the barrier for contributing
> higher.
> 
> Being there at the beginning, I understand the initial choice of license:
> at the time, the scope of what was being building was not totally clear,
> opam was the first large independent software project developed by
> OCamlPro the company was very young and some kind of protection were
> needed. Nowadays, I think opam is in a very different different situation:
> it became the default package manager for OCaml.
> 
> So I'd rather look at the next steps at how we can now make opam more
> widespread. For instance,  lower the contribution barrier: simpler and
> more re-usable code, more documentation, simpler licensing scheme (BSD is
> the new norm); and  make it fully OCaml independent: in the source code
> but also in the manual, and on its own website (generated from GH pages,
> with manual + roadmap). Lastly, we need all which was discussed on the
> roadmap for 1.3, including windows support :-)
> 
> Best,
> Thomas
> 
> > Le lundi, 18 janvier 2016 ? 19:09, Louis Gesbert a ?crit :
> >> By having a CLA in place, we ensure we have the hands free to avoid
> >> any further such issues: the problem can't arise again. Yes, it does
> >> allow us to re-license the software, or even negociate specific
> >> licensing terms with partners, which sounds quite fair to me. Also,
> >> this adds to the range of theoretical possibilities, but we currently
> have no plans to monetize Opam.
> >
> > So let's be honest about it. From the community point of view there are
> very little incentives to this solution. License changes are rare.
> >
> >> I am curious and would be glad to hear more about it: I intuitively
> >> don't see much difference between submitting a contribution
> >> BSD-licensed or under the terms of the CLA, from the company's point of
> view. Am I wrong ?
> >
> > Yes.
> >
> > Opam is LGPL'ed, contributing under the terms of the CLA allows OCamlPro
> to do whatever it wishes with opam and the contributions. But you as a
> contributor are not allowed to do whatever you wish since you are bound by
> LGPL terms. If Opam was under a more liberal license, everyone could do
> whatever it wishes with the code and we'd no even need to have a
> discussion about a CLA.
> >
> > Also from a broader perspective, companies may have rules that say you
> are allowed to contribute to projects that have these specific kind of
> licenses. Having other legalities under the form of CLAs surrounding
> contribution may be a no go because the legal setting is non standard or
> would need to much legal investigations.
> >
> > Best,
> >
> > Daniel
> >
> >
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

From daniel.buenzli at erratique.ch  Mon Jan 18 20:57:25 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Mon, 18 Jan 2016 21:57:25 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
Message-ID: <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>

Le lundi, 18 janvier 2016 ? 20:50, Yaron Minsky a ?crit :
> Daniel, would you be opposed to a CLA if the code were released under a more liberal license? For our open source code, Jane Street was advised to use a CLA, even though we were using a liberal license (Apache, in particular.) I'm curious if the CLA itself is a problem, or just the CLA in combination with a restrictive license?

It depends on the terms of the CLA and if I'm actually able to get a reasonable grasp of it and its implications by myself.

For example if the CLA only asks me to grant the rights under the license of the project itself and to guarantee that I'm the actual author of the code I guess I could actually sign that. Though it feels more like bureaucracy and barriers that needed, this should somehow be implied by the act of committing to the repo under your name (but IANAL).  

However I would still not want the proposed CLA mentioned in this thread with a liberal license ? just start talking about licensing patent grants for your company (pt 3.) in your terms and the lawyers of possibly contributing companies will start to trip out. As Thomas mention we should rather look to make it easier to accept contributions in opam than increase the legal work needed to do so.

On a more personal level I'm interested in keeping the lawyers as much as possible out of the loop* and I'm only willing to work with projects that have the same attitude, I do not see CLAs in general as being part of this attitude.

Best,  

Daniel

* w.r.t. I'm actually planning to gradually relicense all my software under a simpler license than the BSD3 I have been using for now.

 

From roberto at dicosmo.org  Tue Jan 19 07:56:52 2016
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 19 Jan 2016 08:56:52 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
Message-ID: <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>

Oh well, another license/cla/ianal/lawyers-are-evil thread / troll...

Being, still today, the 5th opam contributor, according to the git commit
debatable metrics I am of course obliged to feed the troll.

So, well, first of all, let me totally and deeply disagree on the cursorily
repeated assertions in this thread that imply that GPL is BAD and BSD is
GOOD. This kind of generic self asserting statements are ok among kids, not
grown up persons able to master a sophisticated language like OCaml.

Personally, I am strongly against moving from LGPL to BSD, and no matter if
you agree or not with me, that clearly means that such a move would not
encourage contributions in general, but only contributions from BSD fans.

Roberto Di Cosmo (via mobile/cell)
Le 18 janv. 2016 21:57, "Daniel B?nzli" <daniel.buenzli at erratique.ch> a
?crit :

> Le lundi, 18 janvier 2016 ? 20:50, Yaron Minsky a ?crit :
> > Daniel, would you be opposed to a CLA if the code were released under a
> more liberal license? For our open source code, Jane Street was advised to
> use a CLA, even though we were using a liberal license (Apache, in
> particular.) I'm curious if the CLA itself is a problem, or just the CLA in
> combination with a restrictive license?
>
> It depends on the terms of the CLA and if I'm actually able to get a
> reasonable grasp of it and its implications by myself.
>
> For example if the CLA only asks me to grant the rights under the license
> of the project itself and to guarantee that I'm the actual author of the
> code I guess I could actually sign that. Though it feels more like
> bureaucracy and barriers that needed, this should somehow be implied by the
> act of committing to the repo under your name (but IANAL).
>
> However I would still not want the proposed CLA mentioned in this thread
> with a liberal license ? just start talking about licensing patent grants
> for your company (pt 3.) in your terms and the lawyers of possibly
> contributing companies will start to trip out. As Thomas mention we should
> rather look to make it easier to accept contributions in opam than increase
> the legal work needed to do so.
>
> On a more personal level I'm interested in keeping the lawyers as much as
> possible out of the loop* and I'm only willing to work with projects that
> have the same attitude, I do not see CLAs in general as being part of this
> attitude.
>
> Best,
>
> Daniel
>
> * w.r.t. I'm actually planning to gradually relicense all my software
> under a simpler license than the BSD3 I have been using for now.
>
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160119/124def0a/attachment.html>

From daniel.buenzli at erratique.ch  Tue Jan 19 08:47:16 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Tue, 19 Jan 2016 09:47:16 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
Message-ID: <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>


Le mardi, 19 janvier 2016 ? 08:56, Roberto Di Cosmo a ?crit :
> So, well, first of all, let me totally and deeply disagree on the cursorily repeated assertions in this thread that imply that GPL is BAD and BSD is GOOD. This kind of generic self asserting statements are ok among kids, not grown up persons able to master a sophisticated language like OCaml.

If you had actually taken time to read me rather than make pointless inflammatory comments, you would have realized that I never implied this at any point in the discussion.  

So to help your inability to read here's a summary of what I said:  

1. Having the LGPL and the proposed unfair CLA is inacceptable. It is harmful to the growth of the project and hence given the status of the project in the OCaml community to the latter itself.  

2. If OCamlPro wants to have more leeway to do whatever it wishes with opam and its contributions they should rather license it under a more liberal license and avoid the CLA.  

3. I'm perfectly fine if opam stays with the LGPL. I'm not however fine with the added CLA.

So now do actually try to act like a grown up person and comment on the actual problem which is the unfair CLA, not the LGPL vs BSD problem.

Best,

Daniel



From jdimino at janestreet.com  Tue Jan 19 11:03:13 2016
From: jdimino at janestreet.com (Jeremie Dimino)
Date: Tue, 19 Jan 2016 11:03:13 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
Message-ID: <CANhEzE4dGNKoaVe=KzGxKDQhCQX5Gcf-YeeUdd7JYmwkeXSUbA@mail.gmail.com>

?(adding Mark)?

On Tue, Jan 19, 2016 at 8:47 AM, Daniel B?nzli <daniel.buenzli at erratique.ch>
wrote:

>
> Le mardi, 19 janvier 2016 ? 08:56, Roberto Di Cosmo a ?crit :
> > So, well, first of all, let me totally and deeply disagree on the
> cursorily repeated assertions in this thread that imply that GPL is BAD and
> BSD is GOOD. This kind of generic self asserting statements are ok among
> kids, not grown up persons able to master a sophisticated language like
> OCaml.
>
> If you had actually taken time to read me rather than make pointless
> inflammatory comments, you would have realized that I never implied this at
> any point in the discussion.
>
> So to help your inability to read here's a summary of what I said:
>
> 1. Having the LGPL and the proposed unfair CLA is inacceptable. It is
> harmful to the growth of the project and hence given the status of the
> project in the OCaml community to the latter itself.
>
> 2. If OCamlPro wants to have more leeway to do whatever it wishes with
> opam and its contributions they should rather license it under a more
> liberal license and avoid the CLA.
>
> 3. I'm perfectly fine if opam stays with the LGPL. I'm not however fine
> with the added CLA.
>
> So now do actually try to act like a grown up person and comment on the
> actual problem which is the unfair CLA, not the LGPL vs BSD problem.
>
> Best,
>
> Daniel
>
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>



-- 
Jeremie
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160119/d4c06496/attachment.html>

From mshinwell at janestreet.com  Tue Jan 19 11:18:24 2016
From: mshinwell at janestreet.com (Mark Shinwell)
Date: Tue, 19 Jan 2016 11:18:24 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <CANhEzE4dGNKoaVe=KzGxKDQhCQX5Gcf-YeeUdd7JYmwkeXSUbA@mail.gmail.com>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
 <CANhEzE4dGNKoaVe=KzGxKDQhCQX5Gcf-YeeUdd7JYmwkeXSUbA@mail.gmail.com>
Message-ID: <CAM3Ki76hAZRJ4ssmGzE2VV0LjWxq7tDXGb1oKDcZ1x5aeCKaAQ@mail.gmail.com>

Just a small thing to add.  It seems to me that the real value of OPAM
is as part of the fabric of the OCaml community.  It's that community
that drives the development of the language---and indeed in some cases
provides the means for people to be gainfully employed on projects
related to that language.  As such, the first priority would seem to
be ensuring that OPAM's development can be as fast and sustainable as
possible.  To my mind having a simple BSD (or Apache, but be careful
of incompatibility with LGPL) licence is probably the most reliable
way of helping achieve that goal.

(Aside: I'm not sure even that completely negates the need for a CLA,
although you would need to ask a lawyer to be more certain.  For
example, if some organisation wishes to use OPAM and do IP due
diligence upon the code, they may be interested in such documents
attesting to the origin of the code and who the copyright holders are.
Perhaps the CLA would also provide greater protection to the
organisation acting as the "guardian" of OPAM.  However if the CLA
were to be a standard one that does not involve copyright transfer
(for example, the upstream OCaml one, being very similar to that of
the Apache Foundation) and the licence were permissive, the worst case
is probably people dissuaded by the burden of submitting a CLA rather
than people refusing to contribute on the grounds of the licence.)

What's the worst case with a BSD licence?  Maybe Microsoft will use
the code for the next package manager for Windows.  Or maybe Apple
will, and then you'll be famous.

Mark

On 19 January 2016 at 11:03, Jeremie Dimino <jdimino at janestreet.com> wrote:
> (adding Mark)
>
> On Tue, Jan 19, 2016 at 8:47 AM, Daniel B?nzli <daniel.buenzli at erratique.ch>
> wrote:
>>
>>
>> Le mardi, 19 janvier 2016 ? 08:56, Roberto Di Cosmo a ?crit :
>> > So, well, first of all, let me totally and deeply disagree on the
>> > cursorily repeated assertions in this thread that imply that GPL is BAD and
>> > BSD is GOOD. This kind of generic self asserting statements are ok among
>> > kids, not grown up persons able to master a sophisticated language like
>> > OCaml.
>>
>> If you had actually taken time to read me rather than make pointless
>> inflammatory comments, you would have realized that I never implied this at
>> any point in the discussion.
>>
>> So to help your inability to read here's a summary of what I said:
>>
>> 1. Having the LGPL and the proposed unfair CLA is inacceptable. It is
>> harmful to the growth of the project and hence given the status of the
>> project in the OCaml community to the latter itself.
>>
>> 2. If OCamlPro wants to have more leeway to do whatever it wishes with
>> opam and its contributions they should rather license it under a more
>> liberal license and avoid the CLA.
>>
>> 3. I'm perfectly fine if opam stays with the LGPL. I'm not however fine
>> with the added CLA.
>>
>> So now do actually try to act like a grown up person and comment on the
>> actual problem which is the unfair CLA, not the LGPL vs BSD problem.
>>
>> Best,
>>
>> Daniel
>>
>>
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
>
>
>
>
> --
> Jeremie

From roberto at dicosmo.org  Tue Jan 19 12:22:09 2016
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 19 Jan 2016 13:22:09 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
Message-ID: <CAJBwKuUTTm8NAdkm14WAD12=vQzL8zk4R=PYSMN-zS5N+9FtaA@mail.gmail.com>

Daniel,
 I clearly stated I was going to feed the troll, so this gives a hint to
the fact that the text was intended to be read with some humour: if you
prefer to read it as inflammatory, so be it, but it was not my intention,
and if you feel offended, I do apologize.

Being fond of exegesis, though, I'd like to attract your attention to the
fact that my message was criticising an "attitude" (self asserting,
overgeneralising value judgements), while your message is criticising a
"person" (me).

But I am too old to feel offended.

Cheers

--
Roberto

2016-01-19 9:47 GMT+01:00 Daniel B?nzli <daniel.buenzli at erratique.ch>:

>
> Le mardi, 19 janvier 2016 ? 08:56, Roberto Di Cosmo a ?crit :
> > So, well, first of all, let me totally and deeply disagree on the
> cursorily repeated assertions in this thread that imply that GPL is BAD and
> BSD is GOOD. This kind of generic self asserting statements are ok among
> kids, not grown up persons able to master a sophisticated language like
> OCaml.
>
> If you had actually taken time to read me rather than make pointless
> inflammatory comments, you would have realized that I never implied this at
> any point in the discussion.
>
> So to help your inability to read here's a summary of what I said:
>
> 1. Having the LGPL and the proposed unfair CLA is inacceptable. It is
> harmful to the growth of the project and hence given the status of the
> project in the OCaml community to the latter itself.
>
> 2. If OCamlPro wants to have more leeway to do whatever it wishes with
> opam and its contributions they should rather license it under a more
> liberal license and avoid the CLA.
>
> 3. I'm perfectly fine if opam stays with the LGPL. I'm not however fine
> with the added CLA.
>
> So now do actually try to act like a grown up person and comment on the
> actual problem which is the unfair CLA, not the LGPL vs BSD problem.
>
> Best,
>
> Daniel
>
>
>


-- 
Roberto Di Cosmo

------------------------------------------------------------------
Professeur               En detachement a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:

Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160119/22abaf8c/attachment.html>

From daniel.buenzli at erratique.ch  Tue Jan 19 12:54:54 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Tue, 19 Jan 2016 13:54:54 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <CAJBwKuUTTm8NAdkm14WAD12=vQzL8zk4R=PYSMN-zS5N+9FtaA@mail.gmail.com>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
 <CAJBwKuUTTm8NAdkm14WAD12=vQzL8zk4R=PYSMN-zS5N+9FtaA@mail.gmail.com>
Message-ID: <ACCEF22198054116B37642A3C0D37127@erratique.ch>

Le mardi, 19 janvier 2016 ? 13:22, Roberto Di Cosmo a ?crit :
> Being fond of exegesis, though, I'd like to attract your attention to the fact that my message was criticising an "attitude" (self asserting, overgeneralising value judgements), while your message is criticising a "person" (me).

Your message was attributing licensing partisan thoughts and attitudes to participants in the discussion that they had not. As a result your message was hiding the real issue that needs to be discussed.

So I simply corrected this.  

Do not expect me to let my views be mispresented.

Best,  

Daniel



From roberto at dicosmo.org  Tue Jan 19 13:27:11 2016
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 19 Jan 2016 14:27:11 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <ACCEF22198054116B37642A3C0D37127@erratique.ch>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
 <CAJBwKuUTTm8NAdkm14WAD12=vQzL8zk4R=PYSMN-zS5N+9FtaA@mail.gmail.com>
 <ACCEF22198054116B37642A3C0D37127@erratique.ch>
Message-ID: <CAJBwKuVDG2Y4wW8Aoy0+v-UTug4tnmVmo__XU4e2Bt-WjA25DA@mail.gmail.com>

It surely is unsettling to see, or believe to see, one's views distorted,
misrepresented, or simply disregarded or chopped off a thread in a way or
in another.

I made a clear point, even if in a humorous mood, and I'll state it here
again: I am a contributor to a project, opam, which is licensed under LGPL,
so whomever wants to change the licence of opam needs my informed consent,
as well as the consent of the other contributors.

Independently from the CLA discussion, which is another subject, my formal
position here is that I am opposed to see the licence of opam changed to
BSD or other non copyleft ones.

Now dropping off this thread

--
Roberto

2016-01-19 13:54 GMT+01:00 Daniel B?nzli <daniel.buenzli at erratique.ch>:

> Le mardi, 19 janvier 2016 ? 13:22, Roberto Di Cosmo a ?crit :
> > Being fond of exegesis, though, I'd like to attract your attention to
> the fact that my message was criticising an "attitude" (self asserting,
> overgeneralising value judgements), while your message is criticising a
> "person" (me).
>
> Your message was attributing licensing partisan thoughts and attitudes to
> participants in the discussion that they had not. As a result your message
> was hiding the real issue that needs to be discussed.
>
> So I simply corrected this.
>
> Do not expect me to let my views be mispresented.
>
> Best,
>
> Daniel
>
>
>


-- 
Roberto Di Cosmo

------------------------------------------------------------------
Professeur               En detachement a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:

Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160119/2c98e836/attachment.html>

From Fabrice.Le_fessant at inria.fr  Tue Jan 19 14:17:43 2016
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Tue, 19 Jan 2016 14:17:43 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch> <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
Message-ID: <CAHvkLrOXptOuOa1GV_kxDYPjV57hJ6dMY=kiunqK3VQbujhCCw@mail.gmail.com>

On Tue, Jan 19, 2016 at 9:47 AM Daniel B?nzli <daniel.buenzli at erratique.ch>
wrote:

> 3. I'm perfectly fine if opam stays with the LGPL. I'm not however fine
> with the added CLA.
>

I must repeat at this point that, as written in the first mail, the reason
why Louis was proposing to use a CLA for OPAM is that the current license
is not LGPL. It is a wrongly patched LGPL v3, with an exception coming from
LGPL v2, that makes it unusable in the context of OCaml. Without a CLA from
major contributors to OPAM, the only option is to move to GPL (LGPL has a
clause that allows switching to GPL without agreement from the
contributors).

Now, on the long term, having a CLA is a good thing for any open-source
project, as changing the license might be needed for some unpredicted
reason, at some point in the life of a project. For example, a license
might become obsolete, because it was tried in a court and failed to
protect what it should have. OCaml itself is currently changing its license.

Note that OCamlPro's CLA is just a copy of the standard one used by Google
and many companies and organizations, that do not transfer copyright, but
just allows OCamlPro to change the license. I haven't checked, but it is
even maybe the same as Inria's one for OCaml.

--Fabrice
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160119/882b08d5/attachment-0001.html>

From anil at recoil.org  Tue Jan 19 14:27:08 2016
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 19 Jan 2016 14:27:08 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <CAHvkLrOXptOuOa1GV_kxDYPjV57hJ6dMY=kiunqK3VQbujhCCw@mail.gmail.com>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch> <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
 <CAHvkLrOXptOuOa1GV_kxDYPjV57hJ6dMY=kiunqK3VQbujhCCw@mail.gmail.com>
Message-ID: <6BA3E0A9-5B7E-4CD2-881C-E22D0A5DCB63@recoil.org>

On 19 Jan 2016, at 14:17, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:
> 
> On Tue, Jan 19, 2016 at 9:47 AM Daniel B?nzli <daniel.buenzli at erratique.ch <mailto:daniel.buenzli at erratique.ch>> wrote:
> 3. I'm perfectly fine if opam stays with the LGPL. I'm not however fine with the added CLA.
> 
> I must repeat at this point that, as written in the first mail, the reason why Louis was proposing to use a CLA for OPAM is that the current license is not LGPL. It is a wrongly patched LGPL v3, with an exception coming from LGPL v2, that makes it unusable in the context of OCaml. Without a CLA from major contributors to OPAM, the only option is to move to GPL (LGPL has a clause that allows switching to GPL without agreement from the contributors).

Dear all,

The ability to be flexible about the license is important to the project, and a large-scale relicensing to a BSD license is not practical at this stage in the project (nor is it fair to hijack Louis' initial request).

I wanted to raise two points however:

- I would very much like to align OPAM and OCaml's licensing, and one is LGPLv3 and the other is LGPLv2.  The latter is commercially more widely acceptable, and more importantly is set in stone after the recent consortium meeting.  What would the maintainer's feelings of aligning the OPAM license exactly with that of OCaml, so that we at least have a standard copyleft license for the ecosystem.

- I sense that some of the issues with the CLA are that external contributors are uncomfortable with a commercial company with no published future plans for OPAM. Perhaps it would make things easier if a body such as the Caml Consortium held the OPAM CLA.  It's not clear to me if the Consortium wants this, but I thought I'd raise the topic.  It would be hugely beneficial to commercial users to have one place to get the OCaml ecosystem under a BSD-style license for embedding in products.

best,
Anil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160119/e6c5f410/attachment.html>

From daniel.buenzli at erratique.ch  Tue Jan 19 14:39:54 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Tue, 19 Jan 2016 15:39:54 +0100
Subject: [opam-devel] Opam license bug
In-Reply-To: <CAHvkLrOXptOuOa1GV_kxDYPjV57hJ6dMY=kiunqK3VQbujhCCw@mail.gmail.com>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
 <CAHvkLrOXptOuOa1GV_kxDYPjV57hJ6dMY=kiunqK3VQbujhCCw@mail.gmail.com>
Message-ID: <824F991E143C4B35A8A35A834211F7F0@erratique.ch>

Le mardi, 19 janvier 2016 ? 15:17, Fabrice Le Fessant a ?crit :
> I must repeat at this point that, as written in the first mail, the reason why Louis was proposing to use a CLA for OPAM is that the current license is not LGPL. It is a wrongly patched LGPL v3, with an exception coming from LGPL v2, that makes it unusable in the context of OCaml. Without a CLA from major contributors to OPAM, the only option is to move to GPL (LGPL has a clause that allows switching to GPL without agreement from the contributors).

This is not true. As Louis acknowledged the only thing you need is agreement by all the contributors to correct the license. There is absolutely no need to introduce a CLA to correct the opam license bug. I find it very distasteful from the part of OCamlPro to try to make people believe that this is the case.
  
> Note that OCamlPro's CLA is just a copy of the standard one used by Google and many companies and organizations, that do not transfer copyright, but just allows OCamlPro to change the license. I haven't checked, but it is even maybe the same as Inria's one for OCaml.


The fact that it's used by other companies is irrelevant. The way I read your CLA is that it effectively gives complete control (including the right to relicense) to OCamlPro over opam and the contributions that are made to it while it doesn't give that right to the contributors (if opam remains under the LGPL).  

Best,

Daniel



From mshinwell at janestreet.com  Tue Jan 19 14:52:59 2016
From: mshinwell at janestreet.com (Mark Shinwell)
Date: Tue, 19 Jan 2016 14:52:59 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <6BA3E0A9-5B7E-4CD2-881C-E22D0A5DCB63@recoil.org>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch>
 <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
 <CAHvkLrOXptOuOa1GV_kxDYPjV57hJ6dMY=kiunqK3VQbujhCCw@mail.gmail.com>
 <6BA3E0A9-5B7E-4CD2-881C-E22D0A5DCB63@recoil.org>
Message-ID: <CAM3Ki75FeKVxDh425MKtZHRunaV=Gpt7L7JJamuan0gJHLJEig@mail.gmail.com>

For what reason would it be impractical to relicense under a BSD
licence?  (I don't really understand your statement in conjunction
with what Thomas writes, for example.)

When you write about the Consortium, I assume you meant that not only
the Consortium not only hold the CLA but also include OPAM as part of
the software covered under the special BSD agreement.

Mark

On 19 January 2016 at 14:27, Anil Madhavapeddy <anil at recoil.org> wrote:
> On 19 Jan 2016, at 14:17, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr>
> wrote:
>
>
> On Tue, Jan 19, 2016 at 9:47 AM Daniel B?nzli <daniel.buenzli at erratique.ch>
> wrote:
>>
>> 3. I'm perfectly fine if opam stays with the LGPL. I'm not however fine
>> with the added CLA.
>
>
> I must repeat at this point that, as written in the first mail, the reason
> why Louis was proposing to use a CLA for OPAM is that the current license is
> not LGPL. It is a wrongly patched LGPL v3, with an exception coming from
> LGPL v2, that makes it unusable in the context of OCaml. Without a CLA from
> major contributors to OPAM, the only option is to move to GPL (LGPL has a
> clause that allows switching to GPL without agreement from the
> contributors).
>
>
> Dear all,
>
> The ability to be flexible about the license is important to the project,
> and a large-scale relicensing to a BSD license is not practical at this
> stage in the project (nor is it fair to hijack Louis' initial request).
>
> I wanted to raise two points however:
>
> - I would very much like to align OPAM and OCaml's licensing, and one is
> LGPLv3 and the other is LGPLv2.  The latter is commercially more widely
> acceptable, and more importantly is set in stone after the recent consortium
> meeting.  What would the maintainer's feelings of aligning the OPAM license
> exactly with that of OCaml, so that we at least have a standard copyleft
> license for the ecosystem.
>
> - I sense that some of the issues with the CLA are that external
> contributors are uncomfortable with a commercial company with no published
> future plans for OPAM. Perhaps it would make things easier if a body such as
> the Caml Consortium held the OPAM CLA.  It's not clear to me if the
> Consortium wants this, but I thought I'd raise the topic.  It would be
> hugely beneficial to commercial users to have one place to get the OCaml
> ecosystem under a BSD-style license for embedding in products.
>
> best,
> Anil
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>

From anil at recoil.org  Tue Jan 19 14:57:24 2016
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 19 Jan 2016 14:57:24 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <CAM3Ki75FeKVxDh425MKtZHRunaV=Gpt7L7JJamuan0gJHLJEig@mail.gmail.com>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch> <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
 <CAHvkLrOXptOuOa1GV_kxDYPjV57hJ6dMY=kiunqK3VQbujhCCw@mail.gmail.com>
 <6BA3E0A9-5B7E-4CD2-881C-E22D0A5DCB63@recoil.org>
 <CAM3Ki75FeKVxDh425MKtZHRunaV=Gpt7L7JJamuan0gJHLJEig@mail.gmail.com>
Message-ID: <00C4CF8C-4ABE-4C8E-8B39-62DA41A1D43B@recoil.org>

On 19 Jan 2016, at 14:52, Mark Shinwell <mshinwell at janestreet.com> wrote:
> 
> For what reason would it be impractical to relicense under a BSD
> licence?  (I don't really understand your statement in conjunction
> with what Thomas writes, for example.)

We are unlikely to reach such a consensus on this thread. The only scenario under which that works is for OCamlPro to apply the CLA (they can't as its broken) or for Roberto to agree (which he has indicated he won't).

More generally, it's just difficult for a project that's several years old to do this sort of change.

> When you write about the Consortium, I assume you meant that not only
> the Consortium not only hold the CLA but also include OPAM as part of
> the software covered under the special BSD agreement.

Yes that's correct. There is a long tradition of this being the mechanism to obtain the compiler tools for commercial closed source use, and extending it to cover OPAM is the only route I see to getting a commercially friendly OPAM license for industrial users in the short term.

-Anil

> 
> Mark
> 
>> On 19 January 2016 at 14:27, Anil Madhavapeddy <anil at recoil.org> wrote:
>> On 19 Jan 2016, at 14:17, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr>
>> wrote:
>> 
>> 
>> On Tue, Jan 19, 2016 at 9:47 AM Daniel B?nzli <daniel.buenzli at erratique.ch>
>> wrote:
>>> 
>>> 3. I'm perfectly fine if opam stays with the LGPL. I'm not however fine
>>> with the added CLA.
>> 
>> 
>> I must repeat at this point that, as written in the first mail, the reason
>> why Louis was proposing to use a CLA for OPAM is that the current license is
>> not LGPL. It is a wrongly patched LGPL v3, with an exception coming from
>> LGPL v2, that makes it unusable in the context of OCaml. Without a CLA from
>> major contributors to OPAM, the only option is to move to GPL (LGPL has a
>> clause that allows switching to GPL without agreement from the
>> contributors).
>> 
>> 
>> Dear all,
>> 
>> The ability to be flexible about the license is important to the project,
>> and a large-scale relicensing to a BSD license is not practical at this
>> stage in the project (nor is it fair to hijack Louis' initial request).
>> 
>> I wanted to raise two points however:
>> 
>> - I would very much like to align OPAM and OCaml's licensing, and one is
>> LGPLv3 and the other is LGPLv2.  The latter is commercially more widely
>> acceptable, and more importantly is set in stone after the recent consortium
>> meeting.  What would the maintainer's feelings of aligning the OPAM license
>> exactly with that of OCaml, so that we at least have a standard copyleft
>> license for the ecosystem.
>> 
>> - I sense that some of the issues with the CLA are that external
>> contributors are uncomfortable with a commercial company with no published
>> future plans for OPAM. Perhaps it would make things easier if a body such as
>> the Caml Consortium held the OPAM CLA.  It's not clear to me if the
>> Consortium wants this, but I thought I'd raise the topic.  It would be
>> hugely beneficial to commercial users to have one place to get the OCaml
>> ecosystem under a BSD-style license for embedding in products.
>> 
>> best,
>> Anil
>> 
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
> 

From Fabrice.Le_fessant at inria.fr  Tue Jan 19 15:15:58 2016
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Tue, 19 Jan 2016 15:15:58 +0000
Subject: [opam-devel] Opam license bug
In-Reply-To: <6BA3E0A9-5B7E-4CD2-881C-E22D0A5DCB63@recoil.org>
References: <2498690.sFXyP31mEN@maitake> <4542956.qc8PBNcVrb@maitake>
 <107FCF220F6F425DB193EBDCCEFDFC28@erratique.ch> <4813628.DAUMmrq0a5@maitake>
 <65DAA611EC24475FBE6C4B371A5E729A@erratique.ch>
 <D60E4321-09C4-49DE-B671-2EA32E91C90E@gazagnaire.org>
 <CACLX4jQNA12oXO8id+=i=2LG-_AytjeX=LTzm+1g=jkVNMQBDg@mail.gmail.com>
 <CADFAF270603484AAA4616AEAA20D1D0@erratique.ch>
 <CAJBwKuUJX_ZBT-rT2TLqCG_hmcCPw0+gjF+7N9o0cXP31DBFBA@mail.gmail.com>
 <C410BED5B61E428ABDE38935A92F9F5D@erratique.ch>
 <CAHvkLrOXptOuOa1GV_kxDYPjV57hJ6dMY=kiunqK3VQbujhCCw@mail.gmail.com>
 <6BA3E0A9-5B7E-4CD2-881C-E22D0A5DCB63@recoil.org>
Message-ID: <CAHvkLrPYQwnET-NH2QYbeQpJg-=oyhJuSO99rrW-4adKbn_NwQ@mail.gmail.com>

>
> - I would very much like to align OPAM and OCaml's licensing, and one is
> LGPLv3 and the other is LGPLv2.  The latter is commercially more widely
> acceptable, and more importantly is set in stone after the recent
> consortium meeting.  What would the maintainer's feelings of aligning the
> OPAM license exactly with that of OCaml, so that we at least have a
> standard copyleft license for the ecosystem.
>

I don't see any problem with that. The idea behing choosing LGPLv3 in the
first place was that it was supposed to be a more modern license than
LGPLv2, but having both OPAM and OCaml share the same license is probably
simpler for people to understand the ecosystem.


> - I sense that some of the issues with the CLA are that external
> contributors are uncomfortable with a commercial company with no published
> future plans for OPAM.
>
Perhaps it would make things easier if a body such as the Caml Consortium
> held the OPAM CLA.  It's not clear to me if the Consortium wants this, but
> I thought I'd raise the topic.  It would be hugely beneficial to commercial
> users to have one place to get the OCaml ecosystem under a BSD-style
> license for embedding in products.
>

Even if most of the development of OPAM has been funded by Jane Street,
OCamlPro has also contributed to OPAM on its own funding. Moving the CLA
(if adopted) into the Caml Consortium would just remove any hope for
OCamlPro to get back this investment, as reselling BSD-style license might
be the only possible business activity around OPAM.

Moreover, I don't see why it would be simpler to contact INRIA to get a
license for the OCaml compiler if what you want is to get a license on
OPAM, and you could just contact OCamlPro for that.

--Fabrice
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160119/b1adce8a/attachment-0001.html>

From tim at gfxmonk.net  Wed Jan 20 21:34:28 2016
From: tim at gfxmonk.net (Tim Cuthbertson)
Date: Thu, 21 Jan 2016 08:34:28 +1100
Subject: [opam-devel] pinned package not installing dependencies
Message-ID: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>

I've used opam a bunch, but this is the first time I've tried creating
my own package. It seems like I must be doing something dumb, but in
order to test my package I'm setting up a new opam repository (opam
init; opam switch create; then in that switch opam pin
<path-to-git-checkout>).

Opam then tries to install `gup` (my package), but doesn't get very
far because it doesn't install any of my dependencies! My opam file
looks like:

    opam-version: "1"
    name: "gup"
    version: "0.5.1"
    maintainer: "tim at gfxmonk.net"
    depends: [
     "batteries"
     "cryptokit"
     "extunix"
     "lwt" { ">=2.5.1" }
     "ocamlfind" {build}
    ]
    build: [
     ["make" "-C" "ocaml" "native"]
    ]


A log of the failed build is at:
https://gist.github.com/timbertson/5834db27e6d0ce22a86d

As you can see, it doesn't try to install any of my dependencies. I am
using the builtin solver instead of aspcud, but I'm assuming the
default solver isn't _that_ bad ;).

I also checked that the contents of `gup.opam` inside the opam
repository (in packages.dev/gup) looks right, so it shouldn't be due
to an out of date opam file.

Any help?

Cheers,
 - Tim.

From daniel.buenzli at erratique.ch  Wed Jan 20 21:48:42 2016
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Wed, 20 Jan 2016 22:48:42 +0100
Subject: [opam-devel] pinned package not installing dependencies
In-Reply-To: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>
References: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>
Message-ID: <E2129D92E7914868BF67152D05D4B67E@erratique.ch>



Le mercredi, 20 janvier 2016 ? 22:34, Tim Cuthbertson a ?crit :

> As you can see, it doesn't try to install any of my dependencies. I am
> using the builtin solver instead of aspcud, but I'm assuming the
> default solver isn't _that_ bad ;).

Not sure if it its this but why are you using --no-action ?  

https://gist.github.com/timbertson/5834db27e6d0ce22a86d#file-gup-install-txt-L20

Daniel



From scott.dj at gmail.com  Wed Jan 20 21:58:09 2016
From: scott.dj at gmail.com (David Scott)
Date: Wed, 20 Jan 2016 21:58:09 +0000
Subject: [opam-devel] pinned package not installing dependencies
In-Reply-To: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>
References: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>
Message-ID: <CAG_esB3NbBGfdtBeAZmSAM44as1oF9R2as38CBWT=Zz9iJiG=A@mail.gmail.com>

On Wed, Jan 20, 2016 at 9:34 PM, Tim Cuthbertson <tim at gfxmonk.net> wrote:

> I've used opam a bunch, but this is the first time I've tried creating
> my own package. It seems like I must be doing something dumb, but in
> order to test my package I'm setting up a new opam repository (opam
> init; opam switch create; then in that switch opam pin
> <path-to-git-checkout>).
>
> Opam then tries to install `gup` (my package), but doesn't get very
> far because it doesn't install any of my dependencies! My opam file
> looks like:
>
>     opam-version: "1"
>     name: "gup"
>     version: "0.5.1"
>     maintainer: "tim at gfxmonk.net"
>     depends: [
>      "batteries"
>      "cryptokit"
>      "extunix"
>      "lwt" { ">=2.5.1" }
>

Try changing this line to

  "lwt" { >= "2.5.1" }

Cheers,
Dave


>      "ocamlfind" {build}
>     ]
>     build: [
>      ["make" "-C" "ocaml" "native"]
>     ]
>
>
> A log of the failed build is at:
> https://gist.github.com/timbertson/5834db27e6d0ce22a86d
>
> As you can see, it doesn't try to install any of my dependencies. I am
> using the builtin solver instead of aspcud, but I'm assuming the
> default solver isn't _that_ bad ;).
>
> I also checked that the contents of `gup.opam` inside the opam
> repository (in packages.dev/gup) looks right, so it shouldn't be due
> to an out of date opam file.
>
> Any help?
>
> Cheers,
>  - Tim.
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>



-- 
Dave Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160120/e08769db/attachment.html>

From tim at gfxmonk.net  Thu Jan 21 08:12:57 2016
From: tim at gfxmonk.net (Tim Cuthbertson)
Date: Thu, 21 Jan 2016 19:12:57 +1100
Subject: [opam-devel] pinned package not installing dependencies
In-Reply-To: <E2129D92E7914868BF67152D05D4B67E@erratique.ch>
References: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>
 <E2129D92E7914868BF67152D05D4B67E@erratique.ch>
Message-ID: <CAC-LLDhgqMWKLvwxec9t+WBn9nXmFGm65miiLM9E3oeV9fHDzQ@mail.gmail.com>

On Thu, Jan 21, 2016 at 8:48 AM Daniel B?nzli <daniel.buenzli at erratique.ch>
wrote:

>
>
> Le mercredi, 20 janvier 2016 ? 22:34, Tim Cuthbertson a ?crit :
>
> > As you can see, it doesn't try to install any of my dependencies. I am
> > using the builtin solver instead of aspcud, but I'm assuming the
> > default solver isn't _that_ bad ;).
>
> Not sure if it its this but why are you using --no-action ?
>
>
> https://gist.github.com/timbertson/5834db27e6d0ce22a86d#file-gup-install-txt-L20
>
> Daniel
>
>
I'm explicitly calling `opam install gup` slightly later on (
https://gist.github.com/timbertson/5834db27e6d0ce22a86d#file-gup-install-txt-L31),
just because I want to be explicit rather than relying on `opam pin` to
install the package automatically.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160121/6692ceb1/attachment.html>

From tim at gfxmonk.net  Thu Jan 21 08:13:02 2016
From: tim at gfxmonk.net (Tim Cuthbertson)
Date: Thu, 21 Jan 2016 19:13:02 +1100
Subject: [opam-devel] pinned package not installing dependencies
In-Reply-To: <CAG_esB3NbBGfdtBeAZmSAM44as1oF9R2as38CBWT=Zz9iJiG=A@mail.gmail.com>
References: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>
 <CAG_esB3NbBGfdtBeAZmSAM44as1oF9R2as38CBWT=Zz9iJiG=A@mail.gmail.com>
Message-ID: <CAC-LLDiQxxjYvGQd5v5t_GJwCQvMkrdir+bighb9OqO2ExFymw@mail.gmail.com>

On Thu, Jan 21, 2016 at 8:58 AM, David Scott <scott.dj at gmail.com> wrote:
>
>
> On Wed, Jan 20, 2016 at 9:34 PM, Tim Cuthbertson <tim at gfxmonk.net> wrote:
>>
>> I've used opam a bunch, but this is the first time I've tried creating
>> my own package. It seems like I must be doing something dumb, but in
>> order to test my package I'm setting up a new opam repository (opam
>> init; opam switch create; then in that switch opam pin
>> <path-to-git-checkout>).
>>
>> Opam then tries to install `gup` (my package), but doesn't get very
>> far because it doesn't install any of my dependencies! My opam file
>> looks like:
>>
>>     opam-version: "1"
>>     name: "gup"
>>     version: "0.5.1"
>>     maintainer: "tim at gfxmonk.net"
>>     depends: [
>>      "batteries"
>>      "cryptokit"
>>      "extunix"
>>      "lwt" { ">=2.5.1" }
>
>
> Try changing this line to
>
>   "lwt" { >= "2.5.1" }
>
> Cheers,
> Dave

Aha! Thanks, Dave - that fixed it.

Funnily enough I already suspected this line could be a problem, and I
removed it but that didn't help. Remembering back, I must have done
that when I had _another_ issue (accidentally had two `depends:` keys
in my opam file). Since it obviously didn't fix _that_ problem, I
mentally marked it as not the issue.

Is my opam file above invalid? Or is it valid-but-not-what-I-meant?
Given that it didn't install any of my dependencies it seems like it
must have been invalid rather than just specifying a weird constraint
/ tag for `lwt`. Is there some error I should have seen for having an
invalid file?

Cheers,
 - Tim.

From sebastien.mondet at gmail.com  Thu Jan 21 13:16:38 2016
From: sebastien.mondet at gmail.com (Sebastien Mondet)
Date: Thu, 21 Jan 2016 08:16:38 -0500
Subject: [opam-devel] pinned package not installing dependencies
In-Reply-To: <CAC-LLDiQxxjYvGQd5v5t_GJwCQvMkrdir+bighb9OqO2ExFymw@mail.gmail.com>
References: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>
 <CAG_esB3NbBGfdtBeAZmSAM44as1oF9R2as38CBWT=Zz9iJiG=A@mail.gmail.com>
 <CAC-LLDiQxxjYvGQd5v5t_GJwCQvMkrdir+bighb9OqO2ExFymw@mail.gmail.com>
Message-ID: <CALScVYkb2aM24zKpV6tLYCr5W0eCg74J5-pSwgh_dZmPcTYAKw@mail.gmail.com>

On Thu, Jan 21, 2016 at 3:13 AM, Tim Cuthbertson <tim at gfxmonk.net> wrote:

> On Thu, Jan 21, 2016 at 8:58 AM, David Scott <scott.dj at gmail.com> wrote:
> >
> >
> > On Wed, Jan 20, 2016 at 9:34 PM, Tim Cuthbertson <tim at gfxmonk.net>
> wrote:
> >>
> >> I've used opam a bunch, but this is the first time I've tried creating
> >> my own package. It seems like I must be doing something dumb, but in
> >> order to test my package I'm setting up a new opam repository (opam
> >> init; opam switch create; then in that switch opam pin
> >> <path-to-git-checkout>).
> >>
> >> Opam then tries to install `gup` (my package), but doesn't get very
> >> far because it doesn't install any of my dependencies! My opam file
> >> looks like:
> >>
> >>     opam-version: "1"
> >>     name: "gup"
> >>     version: "0.5.1"
> >>     maintainer: "tim at gfxmonk.net"
> >>     depends: [
> >>      "batteries"
> >>      "cryptokit"
> >>      "extunix"
> >>      "lwt" { ">=2.5.1" }
> >
> >
> > Try changing this line to
> >
> >   "lwt" { >= "2.5.1" }
> >
> > Cheers,
> > Dave
>
> Aha! Thanks, Dave - that fixed it.
>
> Funnily enough I already suspected this line could be a problem, and I
> removed it but that didn't help. Remembering back, I must have done
> that when I had _another_ issue (accidentally had two `depends:` keys
> in my opam file). Since it obviously didn't fix _that_ problem, I
> mentally marked it as not the issue.
>
> Is my opam file above invalid? Or is it valid-but-not-what-I-meant?
> Given that it didn't install any of my dependencies it seems like it
> must have been invalid rather than just specifying a weird constraint
> / tag for `lwt`. Is there some error I should have seen for having an
> invalid file?
>
>
You can use `opam-lint`

The line with the wrong constraint  "lwt"  { ">=2.5.1" } gives me:

    $ opam lint ./opam
    Errors found in /..../opam:
       error: File format error: at /.../opam:27:43, Expected a list of
constraints




> Cheers,
>  - Tim.
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160121/67f5dbef/attachment.html>

From louis.gesbert at ocamlpro.com  Thu Jan 21 15:42:16 2016
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Thu, 21 Jan 2016 16:42:16 +0100
Subject: [opam-devel] pinned package not installing dependencies
In-Reply-To: <CAG_esB3NbBGfdtBeAZmSAM44as1oF9R2as38CBWT=Zz9iJiG=A@mail.gmail.com>
References: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>
 <CAG_esB3NbBGfdtBeAZmSAM44as1oF9R2as38CBWT=Zz9iJiG=A@mail.gmail.com>
Message-ID: <5325681.aC6pk7b99j@maitake>

Indeed, that must be the error:
the default behaviour, on the repository, is to just ignore a field when it 
doesn't have the expected format -- to break as little as possible when the 
repository isn't exactly as expected (repository bug, or problem of 
compatibility beteen versions).

This shouldn't, of course, be the case for pinned packages when using an opam 
file from the source or the user -- so that may be a bug in Opam. In any 
case, I would recomment using `--debug` to see what happens.

Best,
Louis Gesbert - OCamlPro


Le mercredi 20 janvier 2016, 21:58:09 David Scott a ?crit :
> On Wed, Jan 20, 2016 at 9:34 PM, Tim Cuthbertson <tim at gfxmonk.net> wrote:
> > I've used opam a bunch, but this is the first time I've tried creating
> > my own package. It seems like I must be doing something dumb, but in
> > order to test my package I'm setting up a new opam repository (opam
> > init; opam switch create; then in that switch opam pin
> > <path-to-git-checkout>).
> > 
> > Opam then tries to install `gup` (my package), but doesn't get very
> > far because it doesn't install any of my dependencies! My opam file
> > 
> > looks like:
> >     opam-version: "1"
> >     name: "gup"
> >     version: "0.5.1"
> >     maintainer: "tim at gfxmonk.net"
> >     depends: [
> >     
> >      "batteries"
> >      "cryptokit"
> >      "extunix"
> >      "lwt" { ">=2.5.1" }
> 
> Try changing this line to
> 
>   "lwt" { >= "2.5.1" }
> 
> Cheers,
> Dave
> 
> >      "ocamlfind" {build}
> >     
> >     ]
> >     build: [
> >     
> >      ["make" "-C" "ocaml" "native"]
> >     
> >     ]
> > 
> > A log of the failed build is at:
> > https://gist.github.com/timbertson/5834db27e6d0ce22a86d
> > 
> > As you can see, it doesn't try to install any of my dependencies. I am
> > using the builtin solver instead of aspcud, but I'm assuming the
> > default solver isn't _that_ bad ;).
> > 
> > I also checked that the contents of `gup.opam` inside the opam
> > repository (in packages.dev/gup) looks right, so it shouldn't be due
> > to an out of date opam file.
> > 
> > Any help?
> > 
> > Cheers,
> > 
> >  - Tim.
> > 
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel

From edgar at beancode.io  Thu Jan 21 17:42:45 2016
From: edgar at beancode.io (Edgar Aroutiounian)
Date: Thu, 21 Jan 2016 09:42:45 -0800
Subject: [opam-devel] Using binaries
Message-ID: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>

Greetings all, 

I?m trying to wrap up a compiler for opam, specifically this one 

http://psellos.com/ocaml/compile-to-iphone.html <http://psellos.com/ocaml/compile-to-iphone.html>

Its an ocaml compiler ready for iOS. Right now I have the repo here, 

https://github.com/fxfactorial/opam-ios <https://github.com/fxfactorial/opam-ios>

and its essentially in the same vein as:

https://github.com/whitequark/opam-android <https://github.com/whitequark/opam-android>

but I very much would like to avoid having to do though the process of building etc. Does opam not have to just be given a binary? This would make it much easier methinks.

-Edgar Aroutiounian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160121/c9e75b98/attachment.html>

From tim at gfxmonk.net  Fri Jan 22 09:29:31 2016
From: tim at gfxmonk.net (Tim Cuthbertson)
Date: Fri, 22 Jan 2016 20:29:31 +1100
Subject: [opam-devel] pinned package not installing dependencies
In-Reply-To: <5325681.aC6pk7b99j@maitake>
References: <CAC-LLDgmteJ2Dno3y_FsyT74m2cyBQHbHF96PpfBtgR=GuUe8Q@mail.gmail.com>
 <CAG_esB3NbBGfdtBeAZmSAM44as1oF9R2as38CBWT=Zz9iJiG=A@mail.gmail.com>
 <5325681.aC6pk7b99j@maitake>
Message-ID: <CAC-LLDjnodc8aA6sT4k9m7hBaVjAnjuqtaZpHPNGOyf6wUrbqQ@mail.gmail.com>

On Fri, Jan 22, 2016 at 2:42 AM, Louis Gesbert
<louis.gesbert at ocamlpro.com> wrote:
> Indeed, that must be the error:
> the default behaviour, on the repository, is to just ignore a field when it
> doesn't have the expected format -- to break as little as possible when the
> repository isn't exactly as expected (repository bug, or problem of
> compatibility beteen versions).
>
> This shouldn't, of course, be the case for pinned packages when using an opam
> file from the source or the user -- so that may be a bug in Opam. In any
> case, I would recomment using `--debug` to see what happens.
>
> Best,
> Louis Gesbert - OCamlPro

Thanks Louis,

You're right, I do get a message when running with --debug (which I
thought I tried, I must have missed it somehow):

[WARNING] At ~/Desktop/gup-opam/gup-test/packages.dev/gup/gup.opam:8:19:
            Expected a list of constraints

So that would definitely have pointed me to the problem if I'd seen
it. I can see why you might not show that to a casual user of a broken
repo, but it'd be great to see this warning more prominently on pinned
packages.

Thanks,
 - Tim


> Le mercredi 20 janvier 2016, 21:58:09 David Scott a ?crit :
>> On Wed, Jan 20, 2016 at 9:34 PM, Tim Cuthbertson <tim at gfxmonk.net> wrote:
>> > I've used opam a bunch, but this is the first time I've tried creating
>> > my own package. It seems like I must be doing something dumb, but in
>> > order to test my package I'm setting up a new opam repository (opam
>> > init; opam switch create; then in that switch opam pin
>> > <path-to-git-checkout>).
>> >
>> > Opam then tries to install `gup` (my package), but doesn't get very
>> > far because it doesn't install any of my dependencies! My opam file
>> >
>> > looks like:
>> >     opam-version: "1"
>> >     name: "gup"
>> >     version: "0.5.1"
>> >     maintainer: "tim at gfxmonk.net"
>> >     depends: [
>> >
>> >      "batteries"
>> >      "cryptokit"
>> >      "extunix"
>> >      "lwt" { ">=2.5.1" }
>>
>> Try changing this line to
>>
>>   "lwt" { >= "2.5.1" }
>>
>> Cheers,
>> Dave
>>
>> >      "ocamlfind" {build}
>> >
>> >     ]
>> >     build: [
>> >
>> >      ["make" "-C" "ocaml" "native"]
>> >
>> >     ]
>> >
>> > A log of the failed build is at:
>> > https://gist.github.com/timbertson/5834db27e6d0ce22a86d
>> >
>> > As you can see, it doesn't try to install any of my dependencies. I am
>> > using the builtin solver instead of aspcud, but I'm assuming the
>> > default solver isn't _that_ bad ;).
>> >
>> > I also checked that the contents of `gup.opam` inside the opam
>> > repository (in packages.dev/gup) looks right, so it shouldn't be due
>> > to an out of date opam file.
>> >
>> > Any help?
>> >
>> > Cheers,
>> >
>> >  - Tim.
>> >
>> > _______________________________________________
>> > opam-devel mailing list
>> > opam-devel at lists.ocaml.org
>> > http://lists.ocaml.org/listinfo/opam-devel

From louis.gesbert at ocamlpro.com  Fri Jan 22 12:37:12 2016
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 22 Jan 2016 13:37:12 +0100
Subject: [opam-devel] Using binaries
In-Reply-To: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>
References: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>
Message-ID: <290695151.asOSIXEOhk@maitake>

The package/compiler descriptions fetch an archive and run custom commands for 
build and install, so although the standard repo only provides source 
packages, you are free to build from source or just download and install a 
precompiled binary: Opam itself is agnostic in that regard.

Hope this helps,
Louis Gesbert - OCamlPro

Le jeudi 21 janvier 2016, 09:42:45 Edgar Aroutiounian a ?crit :
> Greetings all,
> 
> I?m trying to wrap up a compiler for opam, specifically this one
> 
> http://psellos.com/ocaml/compile-to-iphone.html
> <http://psellos.com/ocaml/compile-to-iphone.html>
> 
> Its an ocaml compiler ready for iOS. Right now I have the repo here,
> 
> https://github.com/fxfactorial/opam-ios
> <https://github.com/fxfactorial/opam-ios>
> 
> and its essentially in the same vein as:
> 
> https://github.com/whitequark/opam-android
> <https://github.com/whitequark/opam-android>
> 
> but I very much would like to avoid having to do though the process of
> building etc. Does opam not have to just be given a binary? This would make
> it much easier methinks.
> 
> -Edgar Aroutiounian

From gabriel.scherer at gmail.com  Fri Jan 22 13:34:34 2016
From: gabriel.scherer at gmail.com (Gabriel Scherer)
Date: Fri, 22 Jan 2016 08:34:34 -0500
Subject: [opam-devel] Using binaries
In-Reply-To: <290695151.asOSIXEOhk@maitake>
References: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>
 <290695151.asOSIXEOhk@maitake>
Message-ID: <CAPFanBHGpcAk61x+5jaCnPH6Ph2py0cSefkmPDmMVRgQyxdX_A@mail.gmail.com>

I would be interested in some more information on this. This seems very
simple as you say it, but I had not thought about the fact that OPAM
already has the capacities to act as a binary distribution platform -- I
somehow thought that there would be an announcement of some new extra
features at some point designed for binary distribution.

Louis, you are saying that this is feasible. Are you aware of this actually
having been done? For example, is anyone working on providing a, say, opam
repository for x86-64 binaries corresponding to the packages available on
opam-repository?

I suppose that if people proposed that, they would probably pre-build
binaries for only a subset of the possible packages or configurations.
Would it work to mix a "binary repository" that provides only a subset of
the packages, and the official source repository, and would package query
solvers have a way to do the right thing there? Or would it be the
responsibility of the alternate repository provider to include a
source-only fallback for the non-distributed packages? (This would make it
harder to have a single repository with binary packages for several
architectures.)

On Fri, Jan 22, 2016 at 7:37 AM, Louis Gesbert <louis.gesbert at ocamlpro.com>
wrote:

> The package/compiler descriptions fetch an archive and run custom commands
> for
> build and install, so although the standard repo only provides source
> packages, you are free to build from source or just download and install a
> precompiled binary: Opam itself is agnostic in that regard.
>
> Hope this helps,
> Louis Gesbert - OCamlPro
>
> Le jeudi 21 janvier 2016, 09:42:45 Edgar Aroutiounian a ?crit :
> > Greetings all,
> >
> > I?m trying to wrap up a compiler for opam, specifically this one
> >
> > http://psellos.com/ocaml/compile-to-iphone.html
> > <http://psellos.com/ocaml/compile-to-iphone.html>
> >
> > Its an ocaml compiler ready for iOS. Right now I have the repo here,
> >
> > https://github.com/fxfactorial/opam-ios
> > <https://github.com/fxfactorial/opam-ios>
> >
> > and its essentially in the same vein as:
> >
> > https://github.com/whitequark/opam-android
> > <https://github.com/whitequark/opam-android>
> >
> > but I very much would like to avoid having to do though the process of
> > building etc. Does opam not have to just be given a binary? This would
> make
> > it much easier methinks.
> >
> > -Edgar Aroutiounian
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160122/ed0d8f05/attachment.html>

From thomas at gazagnaire.org  Fri Jan 22 13:40:06 2016
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Fri, 22 Jan 2016 13:40:06 +0000
Subject: [opam-devel] Using binaries
In-Reply-To: <CAPFanBHGpcAk61x+5jaCnPH6Ph2py0cSefkmPDmMVRgQyxdX_A@mail.gmail.com>
References: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>
 <290695151.asOSIXEOhk@maitake>
 <CAPFanBHGpcAk61x+5jaCnPH6Ph2py0cSefkmPDmMVRgQyxdX_A@mail.gmail.com>
Message-ID: <6F50883F-EC0C-4C30-A1DA-74C5BB0DC7FB@gazagnaire.org>

I think you'll get into complex binary distribution when you distribute set of libraries which depends on system libraries. When you simply distribute binaries or if everything is statically linked that's much easier and opam should just work today (just need to be careful with architecture constraints). But would be interested to see if someone actually manage to do this properly :p

Thomas

> On 22 Jan 2016, at 13:34, Gabriel Scherer <gabriel.scherer at gmail.com> wrote:
> 
> I would be interested in some more information on this. This seems very simple as you say it, but I had not thought about the fact that OPAM already has the capacities to act as a binary distribution platform -- I somehow thought that there would be an announcement of some new extra features at some point designed for binary distribution.
> 
> Louis, you are saying that this is feasible. Are you aware of this actually having been done? For example, is anyone working on providing a, say, opam repository for x86-64 binaries corresponding to the packages available on opam-repository?
> 
> I suppose that if people proposed that, they would probably pre-build binaries for only a subset of the possible packages or configurations. Would it work to mix a "binary repository" that provides only a subset of the packages, and the official source repository, and would package query solvers have a way to do the right thing there? Or would it be the responsibility of the alternate repository provider to include a source-only fallback for the non-distributed packages? (This would make it harder to have a single repository with binary packages for several architectures.)
> 
> On Fri, Jan 22, 2016 at 7:37 AM, Louis Gesbert <louis.gesbert at ocamlpro.com <mailto:louis.gesbert at ocamlpro.com>> wrote:
> The package/compiler descriptions fetch an archive and run custom commands for
> build and install, so although the standard repo only provides source
> packages, you are free to build from source or just download and install a
> precompiled binary: Opam itself is agnostic in that regard.
> 
> Hope this helps,
> Louis Gesbert - OCamlPro
> 
> Le jeudi 21 janvier 2016, 09:42:45 Edgar Aroutiounian a ?crit :
> > Greetings all,
> >
> > I?m trying to wrap up a compiler for opam, specifically this one
> >
> > http://psellos.com/ocaml/compile-to-iphone.html <http://psellos.com/ocaml/compile-to-iphone.html>
> > <http://psellos.com/ocaml/compile-to-iphone.html <http://psellos.com/ocaml/compile-to-iphone.html>>
> >
> > Its an ocaml compiler ready for iOS. Right now I have the repo here,
> >
> > https://github.com/fxfactorial/opam-ios <https://github.com/fxfactorial/opam-ios>
> > <https://github.com/fxfactorial/opam-ios <https://github.com/fxfactorial/opam-ios>>
> >
> > and its essentially in the same vein as:
> >
> > https://github.com/whitequark/opam-android <https://github.com/whitequark/opam-android>
> > <https://github.com/whitequark/opam-android <https://github.com/whitequark/opam-android>>
> >
> > but I very much would like to avoid having to do though the process of
> > building etc. Does opam not have to just be given a binary? This would make
> > it much easier methinks.
> >
> > -Edgar Aroutiounian
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org <mailto:opam-devel at lists.ocaml.org>
> http://lists.ocaml.org/listinfo/opam-devel <http://lists.ocaml.org/listinfo/opam-devel>
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160122/ce3e10d3/attachment.html>

From louis.gesbert at ocamlpro.com  Fri Jan 22 13:47:54 2016
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 22 Jan 2016 14:47:54 +0100
Subject: [opam-devel] Using binaries
In-Reply-To: <CAPFanBHGpcAk61x+5jaCnPH6Ph2py0cSefkmPDmMVRgQyxdX_A@mail.gmail.com>
References: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>
 <290695151.asOSIXEOhk@maitake>
 <CAPFanBHGpcAk61x+5jaCnPH6Ph2py0cSefkmPDmMVRgQyxdX_A@mail.gmail.com>
Message-ID: <2361434.ePvI9C4jr5@maitake>

Le vendredi 22 janvier 2016, 08:34:34 Gabriel Scherer a ?crit :
> I would be interested in some more information on this. This seems very
> simple as you say it, but I had not thought about the fact that OPAM
> already has the capacities to act as a binary distribution platform -- I
> somehow thought that there would be an announcement of some new extra
> features at some point designed for binary distribution.
> 
> Louis, you are saying that this is feasible. Are you aware of this actually
> having been done? For example, is anyone working on providing a, say, opam
> repository for x86-64 binaries corresponding to the packages available on
> opam-repository?
> 
> I suppose that if people proposed that, they would probably pre-build
> binaries for only a subset of the possible packages or configurations.
> Would it work to mix a "binary repository" that provides only a subset of
> the packages, and the official source repository, and would package query
> solvers have a way to do the right thing there? Or would it be the
> responsibility of the alternate repository provider to include a
> source-only fallback for the non-distributed packages? (This would make it
> harder to have a single repository with binary packages for several
> architectures.)

`ocp-bin` was an experiment to provide such a cache of pre-built packages, 
falling back to building from source when unavailable for the current setup.
With the official OCaml distribution, you would hit issues of relocation 
though, although there are some hacks around that 
(https://github.com/OCamlPro/ocp-reloc)

So although there are no real barriers in Opam for a binary repository, doing 
something like a conversion from source repo to binary repo, especially with 
OCaml, raises some challenges.

> 
> On Fri, Jan 22, 2016 at 7:37 AM, Louis Gesbert <louis.gesbert at ocamlpro.com>
> 
> wrote:
> > The package/compiler descriptions fetch an archive and run custom 
commands
> > for
> > build and install, so although the standard repo only provides source
> > packages, you are free to build from source or just download and install 
a
> > precompiled binary: Opam itself is agnostic in that regard.
> > 
> > Hope this helps,
> > Louis Gesbert - OCamlPro
> > 
> > Le jeudi 21 janvier 2016, 09:42:45 Edgar Aroutiounian a ?crit :
> > > Greetings all,
> > > 
> > > I?m trying to wrap up a compiler for opam, specifically this one
> > > 
> > > http://psellos.com/ocaml/compile-to-iphone.html
> > > <http://psellos.com/ocaml/compile-to-iphone.html>
> > > 
> > > Its an ocaml compiler ready for iOS. Right now I have the repo here,
> > > 
> > > https://github.com/fxfactorial/opam-ios
> > > <https://github.com/fxfactorial/opam-ios>
> > > 
> > > and its essentially in the same vein as:
> > > 
> > > https://github.com/whitequark/opam-android
> > > <https://github.com/whitequark/opam-android>
> > > 
> > > but I very much would like to avoid having to do though the process of
> > > building etc. Does opam not have to just be given a binary? This would
> > 
> > make
> > 
> > > it much easier methinks.
> > > 
> > > -Edgar Aroutiounian
> > 
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel

From anil at recoil.org  Fri Jan 22 13:53:53 2016
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 22 Jan 2016 05:53:53 -0800
Subject: [opam-devel] Using binaries
In-Reply-To: <2361434.ePvI9C4jr5@maitake>
References: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>
 <290695151.asOSIXEOhk@maitake>
 <CAPFanBHGpcAk61x+5jaCnPH6Ph2py0cSefkmPDmMVRgQyxdX_A@mail.gmail.com>
 <2361434.ePvI9C4jr5@maitake>
Message-ID: <CBD55955-B26B-4C1F-899A-70BC31770C85@recoil.org>

On 22 Jan 2016, at 05:47, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
> Le vendredi 22 janvier 2016, 08:34:34 Gabriel Scherer a ?crit :
>> I would be interested in some more information on this. This seems very
>> simple as you say it, but I had not thought about the fact that OPAM
>> already has the capacities to act as a binary distribution platform -- I
>> somehow thought that there would be an announcement of some new extra
>> features at some point designed for binary distribution.
>> 
>> Louis, you are saying that this is feasible. Are you aware of this actually
>> having been done? For example, is anyone working on providing a, say, opam
>> repository for x86-64 binaries corresponding to the packages available on
>> opam-repository?
>> 
>> I suppose that if people proposed that, they would probably pre-build
>> binaries for only a subset of the possible packages or configurations.
>> Would it work to mix a "binary repository" that provides only a subset of
>> the packages, and the official source repository, and would package query
>> solvers have a way to do the right thing there? Or would it be the
>> responsibility of the alternate repository provider to include a
>> source-only fallback for the non-distributed packages? (This would make it
>> harder to have a single repository with binary packages for several
>> architectures.)
> 
> `ocp-bin` was an experiment to provide such a cache of pre-built packages, 
> falling back to building from source when unavailable for the current setup.
> With the official OCaml distribution, you would hit issues of relocation 
> though, although there are some hacks around that 
> (https://github.com/OCamlPro/ocp-reloc)
> 
> So although there are no real barriers in Opam for a binary repository, doing 
> something like a conversion from source repo to binary repo, especially with 
> OCaml, raises some challenges.

How about an OPAM switch that uses the compiler relocation patch and musl libc and the right CFLAGS to link everything statically by default?  That should provide an experience similar to Go, with an output binary that is standalone (including libc).

Anil


From gabriel.scherer at gmail.com  Fri Jan 22 17:11:34 2016
From: gabriel.scherer at gmail.com (Gabriel Scherer)
Date: Fri, 22 Jan 2016 12:11:34 -0500
Subject: [opam-devel] Using binaries
In-Reply-To: <CBD55955-B26B-4C1F-899A-70BC31770C85@recoil.org>
References: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>
 <290695151.asOSIXEOhk@maitake>
 <CAPFanBHGpcAk61x+5jaCnPH6Ph2py0cSefkmPDmMVRgQyxdX_A@mail.gmail.com>
 <2361434.ePvI9C4jr5@maitake> <CBD55955-B26B-4C1F-899A-70BC31770C85@recoil.org>
Message-ID: <CAPFanBHA8a95PO86GLvnD09BPF59xbboVW2ZbFUt-yQQsOZf-g@mail.gmail.com>

Out of curiosity, do we have a pointer to the "relocation patch" and its
upstreaming discussion? If some upstream changes can be made to make binary
distribution easier, we could try to push them.

(If I understand
https://github.com/ocaml/opam-repository/blob/master/compilers/4.02.3/4.02.3%2Bmusl%2Bstatic/4.02.3%2Bmusl%2Bstatic.comp
correctly, the upstream compiler needs no patching to work with musl.)

On Fri, Jan 22, 2016 at 8:53 AM, Anil Madhavapeddy <anil at recoil.org> wrote:

> On 22 Jan 2016, at 05:47, Louis Gesbert <louis.gesbert at ocamlpro.com>
> wrote:
> >
> > Le vendredi 22 janvier 2016, 08:34:34 Gabriel Scherer a ?crit :
> >> I would be interested in some more information on this. This seems very
> >> simple as you say it, but I had not thought about the fact that OPAM
> >> already has the capacities to act as a binary distribution platform -- I
> >> somehow thought that there would be an announcement of some new extra
> >> features at some point designed for binary distribution.
> >>
> >> Louis, you are saying that this is feasible. Are you aware of this
> actually
> >> having been done? For example, is anyone working on providing a, say,
> opam
> >> repository for x86-64 binaries corresponding to the packages available
> on
> >> opam-repository?
> >>
> >> I suppose that if people proposed that, they would probably pre-build
> >> binaries for only a subset of the possible packages or configurations.
> >> Would it work to mix a "binary repository" that provides only a subset
> of
> >> the packages, and the official source repository, and would package
> query
> >> solvers have a way to do the right thing there? Or would it be the
> >> responsibility of the alternate repository provider to include a
> >> source-only fallback for the non-distributed packages? (This would make
> it
> >> harder to have a single repository with binary packages for several
> >> architectures.)
> >
> > `ocp-bin` was an experiment to provide such a cache of pre-built
> packages,
> > falling back to building from source when unavailable for the current
> setup.
> > With the official OCaml distribution, you would hit issues of relocation
> > though, although there are some hacks around that
> > (https://github.com/OCamlPro/ocp-reloc)
> >
> > So although there are no real barriers in Opam for a binary repository,
> doing
> > something like a conversion from source repo to binary repo, especially
> with
> > OCaml, raises some challenges.
>
> How about an OPAM switch that uses the compiler relocation patch and musl
> libc and the right CFLAGS to link everything statically by default?  That
> should provide an experience similar to Go, with an output binary that is
> standalone (including libc).
>
> Anil
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20160122/54b8d64b/attachment.html>

From louis.gesbert at ocamlpro.com  Sat Jan 23 12:00:56 2016
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Sat, 23 Jan 2016 13:00:56 +0100
Subject: [opam-devel] Using binaries
In-Reply-To: <5EFC8385-A17E-48AA-8F20-86FA0C9CB038@beancode.io>
References: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>
 <290695151.asOSIXEOhk@maitake>
 <5EFC8385-A17E-48AA-8F20-86FA0C9CB038@beancode.io>
Message-ID: <4913196.2oXItnHLXR@maitake>

Le samedi 23 janvier 2016, 01:01:56 Edgar Aroutiounian a ?crit :
> Okay.
> 
> I have my url file looking like:
> 
> archive:"https://github.com/fxfactorial/ocamlios64/archive/v1.0.tar.gz"
> checksum:?9bdb96ca81a08cabaec686b90cfcd338"
> 
> and my opam file:
> 
> opam-version:"1"
> maintainer:"edgar.factorial at gmail.com"
> build:[
>   "./install.sh" "%{prefix}%"
> ]

This should be `install:` rather than `build:`; and `opam-version: "1"` is 
old. Please refer to
  http://opam.ocaml.org/doc/Manual.html#opam

for up-to-date documentation.
But that's not the issue that's causing the problem, Opam would still accept 
it.

Opam does copy the contents of files/ into the unpacked tarball directory, 
and runs all commands from there. A return code of 127 indicates that the 
shell didn't find the file to execute, though -- so I would guess something 
got mixed up in installing your new metadata:

- is the package pinned (which is the recommended way of testing) ? In this 
case, the metadata from the repo may be masked locally. See `opam show ocaml-
ios64 --where` to see the location of the metadata used by Opam.

- did you `opam update` ?

- if your repository is under version control, did you commit the new files ?

Hope this helps

Louis Gesbert - OCamlPro

> 
> remove:[
>   ["./remove.sh" "%{prefix}%"]
> ]
> 
> depends :[
>   "ocamlfind" {>= "1.5.4"}
> ]
> 
> available: [ ocaml-version = "4.02.3?]
> 
> 
> and my install.sh which is under the files directory,
> 
> #!/bin/sh -e
> 
> PREFIX="$1"
> 
> echo "Hello World?
> 
> 
> And when I try to install this with my local repo I get:
> 
> opam install ocaml-ios
> The following actions will be performed:
>   ?  install ocaml-ios64 4.02.3               [required by ocaml-ios]
>   ?  install ocaml-ios   4.02.3
> ===== ?  2 =====
> Do you want to continue ? [Y/n] y
> 
> =-=- Gathering sources =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
=
>  ? [ocaml-ios64.4.02.3]
> https://github.com/fxfactorial/ocamlios64/archive/v1.0.tar.gz downloaded
> 
> =-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
=
>  ? [ERROR] The compilation of ocaml-ios64 failed at "./install.sh
> /Users/Edgar/.opam/ios_coding". Processing  1/2: [ocaml-ios64: ./remove.sh]
> #=== ERROR while installing ocaml-ios64.4.02.3
> ================================# # opam-version 1.2.2
> # os           darwin
> # command      ./install.sh /Users/Edgar/.opam/ios_coding
> # path         /Users/Edgar/.opam/ios_coding/build/ocaml-ios64.4.02.3
> # compiler     4.02.3
> # exit-code    127
> # env-file    
> /Users/Edgar/.opam/ios_coding/build/ocaml-ios64.4.02.3/ocaml-ios64-46180-c6
> 1e7b.env # stdout-file 
> /Users/Edgar/.opam/ios_coding/build/ocaml-ios64.4.02.3/ocaml-ios64-46180-c6
> 1e7b.out # stderr-file 
> /Users/Edgar/.opam/ios_coding/build/ocaml-ios64.4.02.3/ocaml-ios64-46180-c6
> 1e7b.err
> 
> 
> 
> =-=- Error report -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
=
>  ? The following actions were aborted
>   ?  install ocaml-ios 4.02.3
> The following actions failed
>   ?  install ocaml-ios64 4.02.3
> No changes have been performed
> 
> 
> I?m confused now. Does the install.sh script assume that its in the
> directory of the unzipped tarball? Does opam expect the build or install
> step to do something? Does it expect a build and install step at all? How
> about for remove?
> 
> -Edgar
> 
> > On Jan 22, 2016, at 4:37 AM, Louis Gesbert <louis.gesbert at ocamlpro.com>
> > wrote:
> > 
> > The package/compiler descriptions fetch an archive and run custom 
commands
> > for build and install, so although the standard repo only provides source
> > packages, you are free to build from source or just download and install
> > a precompiled binary: Opam itself is agnostic in that regard.
> > 
> > Hope this helps,
> > Louis Gesbert - OCamlPro
> > 
> > Le jeudi 21 janvier 2016, 09:42:45 Edgar Aroutiounian a ?crit :
> >> Greetings all,
> >> 
> >> I?m trying to wrap up a compiler for opam, specifically this one
> >> 
> >> http://psellos.com/ocaml/compile-to-iphone.html
> >> <http://psellos.com/ocaml/compile-to-iphone.html>
> >> 
> >> Its an ocaml compiler ready for iOS. Right now I have the repo here,
> >> 
> >> https://github.com/fxfactorial/opam-ios
> >> <https://github.com/fxfactorial/opam-ios>
> >> 
> >> and its essentially in the same vein as:
> >> 
> >> https://github.com/whitequark/opam-android
> >> <https://github.com/whitequark/opam-android>
> >> 
> >> but I very much would like to avoid having to do though the process of
> >> building etc. Does opam not have to just be given a binary? This would
> >> make
> >> it much easier methinks.
> >> 
> >> -Edgar Aroutiounian

From edwin+ml-ocaml at etorok.net  Sat Jan 23 21:33:05 2016
From: edwin+ml-ocaml at etorok.net (=?UTF-8?B?VMO2csO2ayBFZHdpbg==?=)
Date: Sat, 23 Jan 2016 23:33:05 +0200
Subject: [opam-devel] Using binaries
In-Reply-To: <CAPFanBHA8a95PO86GLvnD09BPF59xbboVW2ZbFUt-yQQsOZf-g@mail.gmail.com>
References: <ECB5EE87-67A3-456B-A259-E6A256618F57@beancode.io>
 <290695151.asOSIXEOhk@maitake>
 <CAPFanBHGpcAk61x+5jaCnPH6Ph2py0cSefkmPDmMVRgQyxdX_A@mail.gmail.com>
 <2361434.ePvI9C4jr5@maitake>
 <CBD55955-B26B-4C1F-899A-70BC31770C85@recoil.org>
 <CAPFanBHA8a95PO86GLvnD09BPF59xbboVW2ZbFUt-yQQsOZf-g@mail.gmail.com>
Message-ID: <56A3F191.8080702@etorok.net>

On 01/22/2016 07:11 PM, Gabriel Scherer wrote:
> (If I understand https://github.com/ocaml/opam-repository/blob/master/compilers/4.02.3/4.02.3%2Bmusl%2Bstatic/4.02.3%2Bmusl%2Bstatic.comp correctly, the upstream compiler needs no patching to work with musl.)

I had more success by using 4.02.3+musl and adding '-cclib -static' just to the final application's linker options.
4.02.3+musl+static fails in variouos ways when libraries try to build a .cmxs.

Also opam packages with C dependencies require those to be built with musl (zlib, libev, hopefully not openssl, etc.) .. at which point you may
want to avoid becoming a mini-distro based on musl and provide just a few of the popular C libs that allows the largest part of the opam repository to be built with musl.

-- 
Edwin T?r?k | Co-founder and Lead Developer

Skylable open-source object storage: reliable, fast, secure
http://www.skylable.com


