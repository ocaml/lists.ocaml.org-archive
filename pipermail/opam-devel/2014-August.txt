From anil at recoil.org  Sun Aug  3 11:46:22 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 3 Aug 2014 11:46:22 +0100
Subject: [opam-devel] Fwd: [opam-commits] Cron job update-opamfu failed on
	opam.ocaml.org
References: <E1XDP59-0004tq-GO@www-ocaml-serv1>
Message-ID: <DBDBD673-E4F8-4511-B5CB-45A0D1E0C340@recoil.org>

Looks like the recent changes have broken opam2web cron updates.

Begin forwarded message:

> echo  >> lib/opamfu.mllib
> ocamlbuild -use-ocamlfind -cflags -w, at f@p at u@40 -pkgs opam-lib.client,uri,cmdliner -I ui -I lib -tags "debug" opamfu.cma opamfu.cmxa opamfu.a opamfuCli.cma opamfuCli.cmxa opamfuCli.a
> ocamlfind ocamldep -package cmdliner -package uri -package opam-lib.client -modules lib/opamfUniverse.mli > lib/opamfUniverse.mli.depends
> + ocamlfind ocamldep -package cmdliner -package uri -package opam-lib.client -modules lib/opamfUniverse.mli > lib/opamfUniverse.mli.depends
> ocamlfind: Package `opam-lib.client' not found


From louis.gesbert at ocamlpro.com  Sun Aug  3 13:17:39 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Sun, 03 Aug 2014 14:17:39 +0200
Subject: [opam-devel] Fwd: [opam-commits] Cron job update-opamfu failed
	on opam.ocaml.org
In-Reply-To: <DBDBD673-E4F8-4511-B5CB-45A0D1E0C340@recoil.org>
References: <E1XDP59-0004tq-GO@www-ocaml-serv1>
 <DBDBD673-E4F8-4511-B5CB-45A0D1E0C340@recoil.org>
Message-ID: <1819671.1qWkCgiuRX@agaric>

Ah, I fixed the versions on the server already, but the other changes broke it again. It should be ok once I manage to land the appropriate patches on OPAM (that make 'make libinstall' and META consistent).

opamfu and opam2web actually got a bit ahead of OPAM on this.

Le dimanche 3 ao?t 2014, 11:46:22 Anil Madhavapeddy a ?crit :
> Looks like the recent changes have broken opam2web cron updates.
> 
> Begin forwarded message:
> 
> > echo  >> lib/opamfu.mllib
> > ocamlbuild -use-ocamlfind -cflags -w, at f@p at u@40 -pkgs opam-lib.client,uri,cmdliner -I ui -I lib -tags "debug" opamfu.cma opamfu.cmxa opamfu.a opamfuCli.cma opamfuCli.cmxa opamfuCli.a
> > ocamlfind ocamldep -package cmdliner -package uri -package opam-lib.client -modules lib/opamfUniverse.mli > lib/opamfUniverse.mli.depends
> > + ocamlfind ocamldep -package cmdliner -package uri -package opam-lib.client -modules lib/opamfUniverse.mli > lib/opamfUniverse.mli.depends
> > ocamlfind: Package `opam-lib.client' not found
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From anil at recoil.org  Wed Aug  6 09:14:08 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 6 Aug 2014 09:14:08 +0100
Subject: [opam-devel] Fwd: [opam-commits] Cron job update-opam2web failed on
	opam.ocaml.org
References: <E1XErSN-0002wo-AJ@www-ocaml-serv1>
Message-ID: <106E1176-030C-446C-87A4-837B08547969@recoil.org>

Looks like some package is missing an ocamlfind dep now.


Begin forwarded message:

> From: cron at opam.ocaml.org
> Date: 6 August 2014 04:00:03 BST
> To: opam-commits at lists.ocaml.org
> Subject: [opam-commits] Cron job update-opam2web failed on opam.ocaml.org
> 
> 
> === FULL LOG ===
> 
> 
> ======== RUNNING COMMAND: update-opam2web update-from-git.sh opam2web ========
> {{{
> ==> 2014-08-06 03:00:01+00:00
> ==> Load opam env
> [ERROR] Your version of OPAM (1.2.0~beta3) is not recent enough to read ~/.opam/config.
> Upgrade to version 1.2.0 or later to read this file.
> [ERROR] At ~/.opam/config
> ==> Running update-from-git.sh opam2web
> 
> From git://github.com/ocaml/opam2web
>   7c04ac5..16004ab  master     -> origin/master
> Removing src/_build/
> Already on 'master'
> Your branch is behind 'origin/master' by 2 commits, and can be fast-forwarded.
> HEAD is now at 16004ab Merge pull request #102 from Chris00/master
> /home/opam/local/bin/update-from-git.sh: line 39: ocamlfind: command not found
> cd src && make
> make[1]: Entering directory `/home/opam/git/opam2web/src'
> ocamlbuild -classic-display -I apalog -use-ocamlfind -cflags "-bin-annot" -no-links -tags "debug" -tags "syntax(camlp4o)" -pkgs cow,cow.syntax,opam-lib.client,opamfu.cli,cmdliner opam2web.cma
> ocamlfind ocamldep -package cmdliner -package opamfu.cli -package opam-lib.client -package cow.syntax -package cow -syntax camlp4o -modules o2wUniverse.mli > o2wUniverse.mli.depends
> + ocamlfind ocamldep -package cmdliner -package opamfu.cli -package opam-lib.client -package cow.syntax -package cow -syntax camlp4o -modules o2wUniverse.mli > o2wUniverse.mli.depends
> /bin/sh: 1: ocamlfind: not found
> Command exited with code 127.
> make[1]: *** [opam2web.cma] Error 10
> make[1]: Leaving directory `/home/opam/git/opam2web/src'
> make: *** [build] Error 2
> 
> ======== CRON JOB update-opam2web FAILED ========
> ==> 2014-08-06 03:00:03+00:00
> ==> Full command was: update-from-git.sh opam2web
> _______________________________________________
> Opam-commits mailing list
> Opam-commits at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-commits
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140806/e49fc8b0/attachment.html>

From sheets at alum.mit.edu  Wed Aug  6 11:37:49 2014
From: sheets at alum.mit.edu (David Sheets)
Date: Wed, 6 Aug 2014 11:37:49 +0100
Subject: [opam-devel] Fwd: [opam-commits] Cron job update-opam2web
 failed on opam.ocaml.org
In-Reply-To: <106E1176-030C-446C-87A4-837B08547969@recoil.org>
References: <E1XErSN-0002wo-AJ@www-ocaml-serv1>
 <106E1176-030C-446C-87A4-837B08547969@recoil.org>
Message-ID: <CAAWM5TxcSDjZ3frPjjt4TfjofDUwfR0Vk9=rTBXvQgdJDtC6Ow@mail.gmail.com>

Perhaps it's related to the ~/.opam/config errors at the top? My guess
is that the env didn't load and PATH isn't set.

David

On Wed, Aug 6, 2014 at 9:14 AM, Anil Madhavapeddy <anil at recoil.org> wrote:
> Looks like some package is missing an ocamlfind dep now.
>
>
> Begin forwarded message:
>
> From: cron at opam.ocaml.org
> Date: 6 August 2014 04:00:03 BST
> To: opam-commits at lists.ocaml.org
> Subject: [opam-commits] Cron job update-opam2web failed on opam.ocaml.org
>
>
> === FULL LOG ===
>
>
> ======== RUNNING COMMAND: update-opam2web update-from-git.sh opam2web
> ========
> {{{
> ==> 2014-08-06 03:00:01+00:00
> ==> Load opam env
> [ERROR] Your version of OPAM (1.2.0~beta3) is not recent enough to read
> ~/.opam/config.
> Upgrade to version 1.2.0 or later to read this file.
> [ERROR] At ~/.opam/config
> ==> Running update-from-git.sh opam2web
>
> From git://github.com/ocaml/opam2web
>   7c04ac5..16004ab  master     -> origin/master
> Removing src/_build/
> Already on 'master'
> Your branch is behind 'origin/master' by 2 commits, and can be
> fast-forwarded.
> HEAD is now at 16004ab Merge pull request #102 from Chris00/master
> /home/opam/local/bin/update-from-git.sh: line 39: ocamlfind: command not
> found
> cd src && make
> make[1]: Entering directory `/home/opam/git/opam2web/src'
> ocamlbuild -classic-display -I apalog -use-ocamlfind -cflags "-bin-annot"
> -no-links -tags "debug" -tags "syntax(camlp4o)" -pkgs
> cow,cow.syntax,opam-lib.client,opamfu.cli,cmdliner opam2web.cma
> ocamlfind ocamldep -package cmdliner -package opamfu.cli -package
> opam-lib.client -package cow.syntax -package cow -syntax camlp4o -modules
> o2wUniverse.mli > o2wUniverse.mli.depends
> + ocamlfind ocamldep -package cmdliner -package opamfu.cli -package
> opam-lib.client -package cow.syntax -package cow -syntax camlp4o -modules
> o2wUniverse.mli > o2wUniverse.mli.depends
> /bin/sh: 1: ocamlfind: not found
> Command exited with code 127.
> make[1]: *** [opam2web.cma] Error 10
> make[1]: Leaving directory `/home/opam/git/opam2web/src'
> make: *** [build] Error 2
>
> ======== CRON JOB update-opam2web FAILED ========
> ==> 2014-08-06 03:00:03+00:00
> ==> Full command was: update-from-git.sh opam2web
> _______________________________________________
> Opam-commits mailing list
> Opam-commits at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-commits
>
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>

From louis.gesbert at ocamlpro.com  Wed Aug  6 13:13:52 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 06 Aug 2014 14:13:52 +0200
Subject: [opam-devel] Fwd: [opam-commits] Cron job update-opam2web
	failed on opam.ocaml.org
In-Reply-To: <106E1176-030C-446C-87A4-837B08547969@recoil.org>
References: <E1XErSN-0002wo-AJ@www-ocaml-serv1>
 <106E1176-030C-446C-87A4-837B08547969@recoil.org>
Message-ID: <1549841.UiivLKFuhl@agaric>

Fixed already. it was simply the opam-version issue mentionned on 
https://github.com/ocaml/opam/releases/tag/1.2.0-beta3 (last dot)

Le mercredi 6 ao?t 2014, 09:14:08 Anil Madhavapeddy a ?crit :
> Looks like some package is missing an ocamlfind dep now.
> 
> 
> Begin forwarded message:
> 
> > From: cron at opam.ocaml.org
> > Date: 6 August 2014 04:00:03 BST
> > To: opam-commits at lists.ocaml.org
> > Subject: [opam-commits] Cron job update-opam2web failed on opam.ocaml.org
> > 
> > 
> > === FULL LOG ===
> > 
> > 
> > ======== RUNNING COMMAND: update-opam2web update-from-git.sh opam2web ========
> > {{{
> > ==> 2014-08-06 03:00:01+00:00
> > ==> Load opam env
> > [ERROR] Your version of OPAM (1.2.0~beta3) is not recent enough to read ~/.opam/config.
> > Upgrade to version 1.2.0 or later to read this file.
> > [ERROR] At ~/.opam/config
> > ==> Running update-from-git.sh opam2web
> > 
> > From git://github.com/ocaml/opam2web
> >   7c04ac5..16004ab  master     -> origin/master
> > Removing src/_build/
> > Already on 'master'
> > Your branch is behind 'origin/master' by 2 commits, and can be fast-forwarded.
> > HEAD is now at 16004ab Merge pull request #102 from Chris00/master
> > /home/opam/local/bin/update-from-git.sh: line 39: ocamlfind: command not found
> > cd src && make
> > make[1]: Entering directory `/home/opam/git/opam2web/src'
> > ocamlbuild -classic-display -I apalog -use-ocamlfind -cflags "-bin-annot" -no-links -tags "debug" -tags "syntax(camlp4o)" -pkgs cow,cow.syntax,opam-lib.client,opamfu.cli,cmdliner opam2web.cma
> > ocamlfind ocamldep -package cmdliner -package opamfu.cli -package opam-lib.client -package cow.syntax -package cow -syntax camlp4o -modules o2wUniverse.mli > o2wUniverse.mli.depends
> > + ocamlfind ocamldep -package cmdliner -package opamfu.cli -package opam-lib.client -package cow.syntax -package cow -syntax camlp4o -modules o2wUniverse.mli > o2wUniverse.mli.depends
> > /bin/sh: 1: ocamlfind: not found
> > Command exited with code 127.
> > make[1]: *** [opam2web.cma] Error 10
> > make[1]: Leaving directory `/home/opam/git/opam2web/src'
> > make: *** [build] Error 2
> > 
> > ======== CRON JOB update-opam2web FAILED ========
> > ==> 2014-08-06 03:00:03+00:00
> > ==> Full command was: update-from-git.sh opam2web
> > _______________________________________________
> > Opam-commits mailing list
> > Opam-commits at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-commits
> > 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140806/2593afd3/attachment.html>

From anil at recoil.org  Sun Aug 10 20:33:23 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 10 Aug 2014 20:33:23 +0100
Subject: [opam-devel] We have binary OPAM RPMs!
Message-ID: <1B51829C-343C-4F0E-90CF-C9B5F4596226@recoil.org>

Thanks to help from Euan Harris and Jon Ludlam at the recent OCaml Compiler Hackathon at Citrix, I've managed to coax the OpenSUSE Build Service into generating binary RPMs for Fedora 19/20, CentOS 6/7 and RHEL7!

WWW: https://build.opensuse.org/package/show/home:ocaml/opam#
Download: http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam

I've only tried this on a CentOS 6 VM so far, and it's working great.  Since the version of OCaml packaged there is 3.11.2, our RPMs bootstrap themselves by using a local copy of OCaml to build OPAM.  The resulting yum installation is working successfully via "opam init --comp=4.01.0" on CentOS 6.

Note that only OPAM 1.2.0beta3 is packaged up like this.  I haven't gone back to the 1.1.x series as I don't think it's worth the maintenance burden at this stage.

For the curious, here's the OpenSUSE Build Service instructions that combine what Jon/I have been doing:
https://gist.github.com/avsm/09fd0f3944fecd8a8ee3
In theory, the build service should do non-x86 builds (ARM, PPC, etc), but in practise the infrastructure seems completely broken and fail in interesting ways.  Has anyone ever successfully had this working?

CCing xen-api as well, since this is probably of use to the xapi packaging efforts on CentOS.

cheers,
Anil

From gesbert at antislash.info  Mon Aug 11 09:49:46 2014
From: gesbert at antislash.info (Louis Gesbert)
Date: Mon, 11 Aug 2014 10:49:46 +0200
Subject: [opam-devel] We have binary OPAM RPMs!
In-Reply-To: <1B51829C-343C-4F0E-90CF-C9B5F4596226@recoil.org>
References: <1B51829C-343C-4F0E-90CF-C9B5F4596226@recoil.org>
Message-ID: <2726275.i5fF2UPWbU@agaric>

That's great news, thanks !

Le dimanche 10 ao?t 2014, 20:33:23 Anil Madhavapeddy a ?crit :
> Thanks to help from Euan Harris and Jon Ludlam at the recent OCaml Compiler Hackathon at Citrix, I've managed to coax the OpenSUSE Build Service into generating binary RPMs for Fedora 19/20, CentOS 6/7 and RHEL7!
> 
> WWW: https://build.opensuse.org/package/show/home:ocaml/opam#
> Download: http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam
> 
> I've only tried this on a CentOS 6 VM so far, and it's working great.  Since the version of OCaml packaged there is 3.11.2, our RPMs bootstrap themselves by using a local copy of OCaml to build OPAM.  The resulting yum installation is working successfully via "opam init --comp=4.01.0" on CentOS 6.
> 
> Note that only OPAM 1.2.0beta3 is packaged up like this.  I haven't gone back to the 1.1.x series as I don't think it's worth the maintenance burden at this stage.
> 
> For the curious, here's the OpenSUSE Build Service instructions that combine what Jon/I have been doing:
> https://gist.github.com/avsm/09fd0f3944fecd8a8ee3
> In theory, the build service should do non-x86 builds (ARM, PPC, etc), but in practise the infrastructure seems completely broken and fail in interesting ways.  Has anyone ever successfully had this working?
> 
> CCing xen-api as well, since this is probably of use to the xapi packaging efforts on CentOS.
> 
> cheers,
> Anil
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140811/c1ea86aa/attachment.html>

From anil at recoil.org  Wed Aug 13 00:54:18 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 13 Aug 2014 00:54:18 +0100
Subject: [opam-devel] We have binary OPAM RPMs!
In-Reply-To: <2726275.i5fF2UPWbU@agaric>
References: <1B51829C-343C-4F0E-90CF-C9B5F4596226@recoil.org>
 <2726275.i5fF2UPWbU@agaric>
Message-ID: <17A2ECBD-A4AB-47A1-ACAB-0B7405DDFFE4@recoil.org>

I also got some more distributions working (Fedora), as well as Debian Wheezy.  Any tests appreciated before we include them in the 1.2beta announcement...

http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam

-anil

On 11 Aug 2014, at 09:49, Louis Gesbert <gesbert at antislash.info> wrote:

> That's great news, thanks !
>  
> Le dimanche 10 ao?t 2014, 20:33:23 Anil Madhavapeddy a ?crit :
> > Thanks to help from Euan Harris and Jon Ludlam at the recent OCaml Compiler Hackathon at Citrix, I've managed to coax the OpenSUSE Build Service into generating binary RPMs for Fedora 19/20, CentOS 6/7 and RHEL7!
> > 
> > WWW: https://build.opensuse.org/package/show/home:ocaml/opam#
> > Download: http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam
> > 
> > I've only tried this on a CentOS 6 VM so far, and it's working great.  Since the version of OCaml packaged there is 3.11.2, our RPMs bootstrap themselves by using a local copy of OCaml to build OPAM.  The resulting yum installation is working successfully via "opam init --comp=4.01.0" on CentOS 6.
> > 
> > Note that only OPAM 1.2.0beta3 is packaged up like this.  I haven't gone back to the 1.1.x series as I don't think it's worth the maintenance burden at this stage.
> > 
> > For the curious, here's the OpenSUSE Build Service instructions that combine what Jon/I have been doing:
> > https://gist.github.com/avsm/09fd0f3944fecd8a8ee3
> > In theory, the build service should do non-x86 builds (ARM, PPC, etc), but in practise the infrastructure seems completely broken and fail in interesting ways.  Has anyone ever successfully had this working?
> > 
> > CCing xen-api as well, since this is probably of use to the xapi packaging efforts on CentOS.
> > 
> > cheers,
> > Anil
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140813/152b7fda/attachment.html>

From anil at recoil.org  Wed Aug 13 00:55:46 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 13 Aug 2014 00:55:46 +0100
Subject: [opam-devel] Stable archive checksums
In-Reply-To: <CAP_800rKzYXZZDKdPG2oZHzTRRscbrS6kiUZS7kG-Jd3k4u-0w@mail.gmail.com>
References: <CAP_800rdag7RjAjew=N5uO1GJwv2Z0zGk7QEKhT2cE_cOPy0eA@mail.gmail.com>
 <F1A58619-8EE3-4A65-B346-3E20894F2AE2@recoil.org>
 <CAP_800rKzYXZZDKdPG2oZHzTRRscbrS6kiUZS7kG-Jd3k4u-0w@mail.gmail.com>
Message-ID: <A18FC1CB-8436-4EC3-9E95-074AC2596727@recoil.org>

On 27 Jun 2014, at 23:08, Markus Mottl <markus.mottl at gmail.com> wrote:

> On Thu, Jun 26, 2014 at 3:22 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>> My OCaml GitHub bindings have a little command line utility to upload stuff via the command-line (you can probably do the same with Curl as well).
> 
> I've just forked ocaml-github and added a new application
> "git-create-release", which does the obvious.  It also allows you to
> upload multiple assets (e.g. tarballs) in one call.  This should make
> it easier to script the process of making a new release.  E.g. you
> could grep the latest version of your software via "git tag", create a
> stable tarball for it, and then create the new release on GitHub.  You
> may even want to create a new OPAM package (with the correct SHA-1
> sum) automatically for it then.

A belated "thank you" for this -- it's now included in the github-0.8.6
package in OPAM.

-anil

From louis.gesbert at ocamlpro.com  Wed Aug 13 08:43:00 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 13 Aug 2014 09:43 +0200
Subject: [opam-devel] Stable archive checksums
In-Reply-To: <CAP_800rKzYXZZDKdPG2oZHzTRRscbrS6kiUZS7kG-Jd3k4u-0w@mail.gmail.com>
References: <CAP_800rdag7RjAjew=N5uO1GJwv2Z0zGk7QEKhT2cE_cOPy0eA@mail.gmail.com>
 <F1A58619-8EE3-4A65-B346-3E20894F2AE2@recoil.org>
 <CAP_800rKzYXZZDKdPG2oZHzTRRscbrS6kiUZS7kG-Jd3k4u-0w@mail.gmail.com>
Message-ID: <12463088.VdeTJgKA5W@agaric>

Le vendredi 27 juin 2014, 18:08:10 Markus Mottl a ?crit :
> On Thu, Jun 26, 2014 at 3:22 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
> > My OCaml GitHub bindings have a little command line utility to upload stuff via the command-line (you can probably do the same with Curl as well).
> 
> I've just forked ocaml-github and added a new application
> "git-create-release", which does the obvious.  It also allows you to
> upload multiple assets (e.g. tarballs) in one call.  This should make
> it easier to script the process of making a new release.  E.g. you
> could grep the latest version of your software via "git tag", create a
> stable tarball for it, and then create the new release on GitHub.  You
> may even want to create a new OPAM package (with the correct SHA-1
> sum) automatically for it then.
> 
> Regards,
> Markus
> 
> 

Great ! That'll even make OPAM's own release easier, allowing to improve on https://github.com/ocaml/opam/blob/1.2.0-beta4/shell/release.sh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140813/69aefc6d/attachment.html>

From thomas at gazagnaire.org  Wed Aug 13 13:37:54 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Wed, 13 Aug 2014 13:37:54 +0100
Subject: [opam-devel] We have binary OPAM RPMs!
In-Reply-To: <17A2ECBD-A4AB-47A1-ACAB-0B7405DDFFE4@recoil.org>
References: <1B51829C-343C-4F0E-90CF-C9B5F4596226@recoil.org>
 <2726275.i5fF2UPWbU@agaric> <17A2ECBD-A4AB-47A1-ACAB-0B7405DDFFE4@recoil.org>
Message-ID: <CA71BA82-3421-4AD1-B47F-D8C63985A00B@gazagnaire.org>

Yay! That's an achievement!

What's the story with aspcud?

Thomas

On 13 Aug 2014, at 00:54, Anil Madhavapeddy <anil at recoil.org> wrote:

> I also got some more distributions working (Fedora), as well as Debian Wheezy.  Any tests appreciated before we include them in the 1.2beta announcement...
> 
> http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam
> 
> -anil
> 
> On 11 Aug 2014, at 09:49, Louis Gesbert <gesbert at antislash.info> wrote:
> 
>> That's great news, thanks !
>>  
>> Le dimanche 10 ao?t 2014, 20:33:23 Anil Madhavapeddy a ?crit :
>> > Thanks to help from Euan Harris and Jon Ludlam at the recent OCaml Compiler Hackathon at Citrix, I've managed to coax the OpenSUSE Build Service into generating binary RPMs for Fedora 19/20, CentOS 6/7 and RHEL7!
>> > 
>> > WWW: https://build.opensuse.org/package/show/home:ocaml/opam#
>> > Download: http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam
>> > 
>> > I've only tried this on a CentOS 6 VM so far, and it's working great.  Since the version of OCaml packaged there is 3.11.2, our RPMs bootstrap themselves by using a local copy of OCaml to build OPAM.  The resulting yum installation is working successfully via "opam init --comp=4.01.0" on CentOS 6.
>> > 
>> > Note that only OPAM 1.2.0beta3 is packaged up like this.  I haven't gone back to the 1.1.x series as I don't think it's worth the maintenance burden at this stage.
>> > 
>> > For the curious, here's the OpenSUSE Build Service instructions that combine what Jon/I have been doing:
>> > https://gist.github.com/avsm/09fd0f3944fecd8a8ee3
>> > In theory, the build service should do non-x86 builds (ARM, PPC, etc), but in practise the infrastructure seems completely broken and fail in interesting ways.  Has anyone ever successfully had this working?
>> > 
>> > CCing xen-api as well, since this is probably of use to the xapi packaging efforts on CentOS.
>> > 
>> > cheers,
>> > Anil
>> > _______________________________________________
>> > opam-devel mailing list
>> > opam-devel at lists.ocaml.org
>> > http://lists.ocaml.org/listinfo/opam-devel
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140813/65ee898b/attachment.html>

From louis.gesbert at ocamlpro.com  Wed Aug 13 16:41:25 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 13 Aug 2014 17:41:25 +0200
Subject: [opam-devel] We have binary OPAM RPMs!
In-Reply-To: <CA71BA82-3421-4AD1-B47F-D8C63985A00B@gazagnaire.org>
References: <1B51829C-343C-4F0E-90CF-C9B5F4596226@recoil.org>
 <17A2ECBD-A4AB-47A1-ACAB-0B7405DDFFE4@recoil.org>
 <CA71BA82-3421-4AD1-B47F-D8C63985A00B@gazagnaire.org>
Message-ID: <39114231.8iRirIIoi3@agaric>

That's great ! Thanks for diving into this.
Seems the manpages got missing though (at least in the debian package). Other than that lintian only complains about hardening_no_relro which, IIRC, is normal with OCaml.

Le mercredi 13 ao?t 2014, 13:37:54 Thomas Gazagnaire a ?crit :
> Yay! That's an achievement!
> 
> What's the story with aspcud?
> 
> Thomas
> 
> On 13 Aug 2014, at 00:54, Anil Madhavapeddy <anil at recoil.org> wrote:
> 
> > I also got some more distributions working (Fedora), as well as Debian Wheezy.  Any tests appreciated before we include them in the 1.2beta announcement...
> > 
> > http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam
> > 
> > -anil
> > 
> > On 11 Aug 2014, at 09:49, Louis Gesbert <gesbert at antislash.info> wrote:
> > 
> >> That's great news, thanks !
> >>  
> >> Le dimanche 10 ao?t 2014, 20:33:23 Anil Madhavapeddy a ?crit :
> >> > Thanks to help from Euan Harris and Jon Ludlam at the recent OCaml Compiler Hackathon at Citrix, I've managed to coax the OpenSUSE Build Service into generating binary RPMs for Fedora 19/20, CentOS 6/7 and RHEL7!
> >> > 
> >> > WWW: https://build.opensuse.org/package/show/home:ocaml/opam#
> >> > Download: http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam
> >> > 
> >> > I've only tried this on a CentOS 6 VM so far, and it's working great.  Since the version of OCaml packaged there is 3.11.2, our RPMs bootstrap themselves by using a local copy of OCaml to build OPAM.  The resulting yum installation is working successfully via "opam init --comp=4.01.0" on CentOS 6.
> >> > 
> >> > Note that only OPAM 1.2.0beta3 is packaged up like this.  I haven't gone back to the 1.1.x series as I don't think it's worth the maintenance burden at this stage.
> >> > 
> >> > For the curious, here's the OpenSUSE Build Service instructions that combine what Jon/I have been doing:
> >> > https://gist.github.com/avsm/09fd0f3944fecd8a8ee3
> >> > In theory, the build service should do non-x86 builds (ARM, PPC, etc), but in practise the infrastructure seems completely broken and fail in interesting ways.  Has anyone ever successfully had this working?
> >> > 
> >> > CCing xen-api as well, since this is probably of use to the xapi packaging efforts on CentOS.
> >> > 
> >> > cheers,
> >> > Anil
> >> > _______________________________________________
> >> > opam-devel mailing list
> >> > opam-devel at lists.ocaml.org
> >> > http://lists.ocaml.org/listinfo/opam-devel
> > 
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140813/eefc4c03/attachment.html>

From loldrup at gmail.com  Wed Aug 13 20:30:54 2014
From: loldrup at gmail.com (Jon Loldrup)
Date: Wed, 13 Aug 2014 21:30:54 +0200
Subject: [opam-devel] Error installing ocamlfind using Ubuntu's OPAM package
Message-ID: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>

Hi

I'm trying to install cohttp on Ubuntu 14.04. However it is not working so
well, as can be seen from this screenshot:

http://i58.tinypic.com/euk9e1.png

I started from a pretty much unaltered installation of Ubuntu 14.04. Then I
executed the following commands in order. The last command led to the error.

sudo apt-get update && sudo apt-get upgrade
sudo apt-get install ocaml-nox ocaml-native-compilers ocaml-doc tuareg-mode
ocaml-findlib oasis libpcre-ocaml-dev
sudo apt-get update
sudo apt-get install ocaml ocaml-native-compilers camlp4-extra opam
opam
opam list
opam init
eval `opam config env`
opam search cohttp
opam search core
opam update
opam list
opam install cohttp

So, how do I approach figuring out what went wrong? I'm an Ocaml newbie..
Also, where should I report errors like this if it is indeed a bug instead
of a user error?

regards Jon Loldrup
Denmark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140813/2caac424/attachment-0001.html>

From anil at recoil.org  Wed Aug 13 21:43:41 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 13 Aug 2014 21:43:41 +0100
Subject: [opam-devel] Error installing ocamlfind using Ubuntu's OPAM
	package
In-Reply-To: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>
References: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>
Message-ID: <27619F91-4089-4B84-92CF-D09C5975C72A@recoil.org>

Hi Jon,

You're missing just one system package required to build ocamlfind called 'm4'.  Just add

sudo apt-get install m4

to your command set below and you should be fine.  For installing Cohttp with the Core backend, do:

opam install cohttp ssl async 

Let us know if this doesn't work out.

best,
Anil

On 13 Aug 2014, at 20:30, Jon Loldrup <loldrup at gmail.com> wrote:

> Hi
> 
> I'm trying to install cohttp on Ubuntu 14.04. However it is not working so well, as can be seen from this screenshot:
> 
> http://i58.tinypic.com/euk9e1.png
> 
> I started from a pretty much unaltered installation of Ubuntu 14.04. Then I executed the following commands in order. The last command led to the error.
> 
> sudo apt-get update && sudo apt-get upgrade
> sudo apt-get install ocaml-nox ocaml-native-compilers ocaml-doc tuareg-mode ocaml-findlib oasis libpcre-ocaml-dev
> sudo apt-get update
> sudo apt-get install ocaml ocaml-native-compilers camlp4-extra opam
> opam
> opam list
> opam init
> eval `opam config env`
> opam search cohttp
> opam search core
> opam update
> opam list
> opam install cohttp
> 
> So, how do I approach figuring out what went wrong? I'm an Ocaml newbie..
> Also, where should I report errors like this if it is indeed a bug instead of a user error?
> 
> regards Jon Loldrup
> Denmark
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140813/50807747/attachment.html>

From loldrup at gmail.com  Wed Aug 13 23:32:23 2014
From: loldrup at gmail.com (Jon Loldrup)
Date: Thu, 14 Aug 2014 00:32:23 +0200
Subject: [opam-devel] Error installing ocamlfind using Ubuntu's OPAM
	package
In-Reply-To: <27619F91-4089-4B84-92CF-D09C5975C72A@recoil.org>
References: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>
 <27619F91-4089-4B84-92CF-D09C5975C72A@recoil.org>
Message-ID: <CACxdjHz0CbMChnqYUvKYyT=EFDp18dVje2hCkktxWysFT+J5SA@mail.gmail.com>

Thank you for your help :)
It almost worked. However, it's missing 'libssl', which has no installation
candidate either through apt-get nor through OPAM:

jon at lemur:~/Auchitect/code$ opam install libssl
[ERROR] libssl is not a valid versioned package name
'opam install libssl' failed.

jon at lemur:~/Auchitect/code$ sudo apt-get install libssl
[sudo] password for jon:
Reading package lists... Done
Building dependency tree
Reading state information... Done
Package libssl is not available, but is referred to by another package.
This may mean that the package is missing, has been obsoleted, or
is only available from another source

E: Package 'libssl' has no installation candidate
jon at lemur:~/Auchitect/code$

this is the error from OPAM when running 'opam install cohttp ssl async':

=-=-= Installing async.111.25.00 =-=-=
default    Downloadinghttps
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>://
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>opam.ocaml.org
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>/archives/
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>async
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>.111.25.00+
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>opam.tar.gz
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>
Downloadinghttps
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>://
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>opam.ocaml.org
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>/archives/
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>async
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>.111.25.00+
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>opam.tar.gz
<https://opam.ocaml.org/archives/async.111.25.00+opam.tar.gz>
Building async.111.25.00:
  make
  make install
Installing async.111.25.00.

[ERROR] Due to some errors while processing ssl.0.4.7, the following
actions will NOT proceed:
 - install cohttp.0.11.2
 - install conduit.0.5.1

===== ERROR while installing ssl.0.4.7 =====
# opam-version 1.1.1
# os           linux
# command      ./configure --prefix /home/jon/.opam/system
# path         /home/jon/.opam/system/build/ssl.0.4.7
# compiler     system (4.01.0)
# exit-code    1
# env-file     /home/jon/.opam/system/build/ssl.0.4.7/ssl-5767-c743ac.env
# stdout-file  /home/jon/.opam/system/build/ssl.0.4.7/ssl-5767-c743ac.out
# stderr-file  /home/jon/.opam/system/build/ssl.0.4.7/ssl-5767-c743ac.err
### stdout ###
# ...[truncated]
# checking for ocamldep... /usr/bin/ocamldep
# checking for ocamllex... /usr/bin/ocamllex
# checking for ocamlyacc... /usr/bin/ocamlyacc
# checking for ocamldoc... /usr/bin/ocamldoc
# checking for ocamlmktop... /usr/bin/ocamlmktop
# checking for gcc... (cached) gcc
# checking whether we are using the GNU C compiler... (cached) yes
# checking whether gcc accepts -g... (cached) yes
# checking for gcc option to accept ISO C89... (cached) none needed
# checking for SSL_new in -lssl... no
### stderr ###
# configure: error: Cannot find libssl.

The former state can be restored with opam switch import -f
"/home/jon/.opam/system/backup/state-20140713220132.export"
'opam install cohttp ssl async' failed.

Is SSL mandatory for running cohttp? The stuff I need to transfer via json
to my Ocaml-program isn't privacy sensitive at all.

/Jon
Hi Jon,

You're missing just one system package required to build ocamlfind called
'm4'.  Just add

sudo apt-get install m4

to your command set below and you should be fine.  For installing Cohttp
with the Core backend, do:

opam install cohttp ssl async

Let us know if this doesn't work out.

best,
Anil

On 13 Aug 2014, at 20:30, Jon Loldrup <loldrup at gmail.com> wrote:

Hi

I'm trying to install cohttp on Ubuntu 14.04. However it is not working so
well, as can be seen from this screenshot:

http://i58.tinypic.com/euk9e1.png

I started from a pretty much unaltered installation of Ubuntu 14.04. Then I
executed the following commands in order. The last command led to the error.

sudo apt-get update && sudo apt-get upgrade
sudo apt-get install ocaml-nox ocaml-native-compilers ocaml-doc tuareg-mode
ocaml-findlib oasis libpcre-ocaml-dev
sudo apt-get update
sudo apt-get install ocaml ocaml-native-compilers camlp4-extra opam
opam
opam list
opam init
eval `opam config env`
opam search cohttp
opam search core
opam update
opam list
opam install cohttp

So, how do I approach figuring out what went wrong? I'm an Ocaml newbie..
Also, where should I report errors like this if it is indeed a bug instead
of a user error?

regards Jon Loldrup
Denmark
 _______________________________________________
opam-devel mailing list
opam-devel at lists.ocaml.org
http://lists.ocaml.org/listinfo/opam-devel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140814/77164923/attachment.html>

From yallop at gmail.com  Wed Aug 13 23:39:18 2014
From: yallop at gmail.com (Jeremy Yallop)
Date: Wed, 13 Aug 2014 23:39:18 +0100
Subject: [opam-devel] Error installing ocamlfind using Ubuntu's OPAM
	package
In-Reply-To: <CACxdjHz0CbMChnqYUvKYyT=EFDp18dVje2hCkktxWysFT+J5SA@mail.gmail.com>
References: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>
 <27619F91-4089-4B84-92CF-D09C5975C72A@recoil.org>
 <CACxdjHz0CbMChnqYUvKYyT=EFDp18dVje2hCkktxWysFT+J5SA@mail.gmail.com>
Message-ID: <CAAxsn=GK90DBznNfhvAPRPvLmS-Tk9_Cuy5sOUn-o0PQbnG9ZA@mail.gmail.com>

On 13 August 2014 23:32, Jon Loldrup <loldrup at gmail.com> wrote:
> Thank you for your help :)
> It almost worked. However, it's missing 'libssl', which has no installation
> candidate either through apt-get nor through OPAM:

I think libssl-dev is the package you need.

From loldrup at gmail.com  Wed Aug 13 23:43:23 2014
From: loldrup at gmail.com (Jon Loldrup)
Date: Thu, 14 Aug 2014 00:43:23 +0200
Subject: [opam-devel] Error installing ocamlfind using Ubuntu's OPAM
	package
In-Reply-To: <CAAxsn=GK90DBznNfhvAPRPvLmS-Tk9_Cuy5sOUn-o0PQbnG9ZA@mail.gmail.com>
References: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>
 <27619F91-4089-4B84-92CF-D09C5975C72A@recoil.org>
 <CACxdjHz0CbMChnqYUvKYyT=EFDp18dVje2hCkktxWysFT+J5SA@mail.gmail.com>
 <CAAxsn=GK90DBznNfhvAPRPvLmS-Tk9_Cuy5sOUn-o0PQbnG9ZA@mail.gmail.com>
Message-ID: <CACxdjHxmiRa0gxZwh65TNY9RW3tro441g2criejey5_2a10pqA@mail.gmail.com>

Den 14/08/2014 00.39 skrev "Jeremy Yallop" <yallop at gmail.com>:
>
> On 13 August 2014 23:32, Jon Loldrup <loldrup at gmail.com> wrote:
> > Thank you for your help :)
> > It almost worked. However, it's missing 'libssl', which has no
installation
> > candidate either through apt-get nor through OPAM:
>
> I think libssl-dev is the package you need.

Indeed it was :)

cohhtp has been installed
Thanks!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140814/51e0aa44/attachment-0001.html>

From louis.gesbert at ocamlpro.com  Thu Aug 14 08:17:45 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Thu, 14 Aug 2014 09:17:45 +0200
Subject: [opam-devel] Error installing ocamlfind using Ubuntu's OPAM
	package
In-Reply-To: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>
References: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>
Message-ID: <2758823.4FAxvT7RNd@agaric>

Le mercredi 13 ao?t 2014, 21:30:54 Jon Loldrup a ?crit :
> Hi
> 
> I'm trying to install cohttp on Ubuntu 14.04. However it is not working so
> well, as can be seen from this screenshot:
> 
> http://i58.tinypic.com/euk9e1.png
> 
> I started from a pretty much unaltered installation of Ubuntu 14.04. Then I
> executed the following commands in order. The last command led to the error.
> 
> sudo apt-get update && sudo apt-get upgrade
> sudo apt-get install ocaml-nox ocaml-native-compilers ocaml-doc tuareg-mode
> ocaml-findlib oasis libpcre-ocaml-dev
> sudo apt-get update
> sudo apt-get install ocaml ocaml-native-compilers camlp4-extra opam
> opam
> opam list
> opam init

Note that the newer version will warn at this point if m4 is not installed.
Not the case for libssl, of course, though.

> eval `opam config env`
> opam search cohttp
> opam search core
> opam update
> opam list
> opam install cohttp
> 
> So, how do I approach figuring out what went wrong? I'm an Ocaml newbie..
> Also, where should I report errors like this if it is indeed a bug instead
> of a user error?
> 
> regards Jon Loldrup
> Denmark

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140814/8b49cdd9/attachment.html>

From arnaud.degroote at laas.fr  Wed Aug 13 21:32:52 2014
From: arnaud.degroote at laas.fr (Arnaud Degroote)
Date: Wed, 13 Aug 2014 22:32:52 +0200
Subject: [opam-devel] Error installing ocamlfind using Ubuntu's OPAM
 package
In-Reply-To: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>
References: <CACxdjHxhwY2nMt6h6-9F+Zwj76cFXyJehy31WokzgLAB9KLVjw@mail.gmail.com>
Message-ID: <20140813203252.GB1529@hermes>

On 13/Aug - 21:30, Jon Loldrup wrote:
> Hi
> 
> I'm trying to install cohttp on Ubuntu 14.04. However it is not working so
> well, as can be seen from this screenshot:
> 
> http://i58.tinypic.com/euk9e1.png
> 
> I started from a pretty much unaltered installation of Ubuntu 14.04. Then I
> executed the following commands in order. The last command led to the error.
> 
> sudo apt-get update && sudo apt-get upgrade
> sudo apt-get install ocaml-nox ocaml-native-compilers ocaml-doc tuareg-mode
> ocaml-findlib oasis libpcre-ocaml-dev
> sudo apt-get update
> sudo apt-get install ocaml ocaml-native-compilers camlp4-extra opam
> opam
> opam list
> opam init
> eval `opam config env`
> opam search cohttp
> opam search core
> opam update
> opam list
> opam install cohttp
> 
> So, how do I approach figuring out what went wrong? I'm an Ocaml newbie..
> Also, where should I report errors like this if it is indeed a bug instead
> of a user error?

From the error message, it seems you need to install m4 using apt (or
aptitude)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 473 bytes
Desc: not available
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140813/a81ecdc3/attachment.sig>

From anil at recoil.org  Thu Aug 14 17:27:36 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 14 Aug 2014 17:27:36 +0100
Subject: [opam-devel] We have binary OPAM RPMs!
In-Reply-To: <39114231.8iRirIIoi3@agaric>
References: <1B51829C-343C-4F0E-90CF-C9B5F4596226@recoil.org>
 <17A2ECBD-A4AB-47A1-ACAB-0B7405DDFFE4@recoil.org>
 <CA71BA82-3421-4AD1-B47F-D8C63985A00B@gazagnaire.org>
 <39114231.8iRirIIoi3@agaric>
Message-ID: <C53B2B96-B735-4EB4-8524-2CEAADCC3619@recoil.org>

I've unfortunately had to give up on getting Aspcud compiling, as the dependency chain got to 10 custom spec files for CentOS 6 and the time ran out :-(

The issue is that several of the transitive dependencies (tbb-devel, bison) are relatively new bits of software that aren't widely ported yet.

It's possibly time to start thinking about an OCaml implementation of Aspcud once the OPAM 1.2 release is done.  It would massively reduce the porting burden in the future.

-anil

On 13 Aug 2014, at 16:41, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> That's great ! Thanks for diving into this.
> Seems the manpages got missing though (at least in the debian package). Other than that lintian only complains about hardening_no_relro which, IIRC, is normal with OCaml.
>  
> Le mercredi 13 ao?t 2014, 13:37:54 Thomas Gazagnaire a ?crit :
> > Yay! That's an achievement!
> > 
> > What's the story with aspcud?
> > 
> > Thomas
> > 
> > On 13 Aug 2014, at 00:54, Anil Madhavapeddy <anil at recoil.org> wrote:
> > 
> > > I also got some more distributions working (Fedora), as well as Debian Wheezy.  Any tests appreciated before we include them in the 1.2beta announcement...
> > > 
> > > http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam
> > > 
> > > -anil
> > > 
> > > On 11 Aug 2014, at 09:49, Louis Gesbert <gesbert at antislash.info> wrote:
> > > 
> > >> That's great news, thanks !
> > >>  
> > >> Le dimanche 10 ao?t 2014, 20:33:23 Anil Madhavapeddy a ?crit :
> > >> > Thanks to help from Euan Harris and Jon Ludlam at the recent OCaml Compiler Hackathon at Citrix, I've managed to coax the OpenSUSE Build Service into generating binary RPMs for Fedora 19/20, CentOS 6/7 and RHEL7!
> > >> > 
> > >> > WWW: https://build.opensuse.org/package/show/home:ocaml/opam#
> > >> > Download: http://software.opensuse.org/download.html?project=home%3Aocaml&package=opam
> > >> > 
> > >> > I've only tried this on a CentOS 6 VM so far, and it's working great.  Since the version of OCaml packaged there is 3.11.2, our RPMs bootstrap themselves by using a local copy of OCaml to build OPAM.  The resulting yum installation is working successfully via "opam init --comp=4.01.0" on CentOS 6.
> > >> > 
> > >> > Note that only OPAM 1.2.0beta3 is packaged up like this.  I haven't gone back to the 1.1.x series as I don't think it's worth the maintenance burden at this stage.
> > >> > 
> > >> > For the curious, here's the OpenSUSE Build Service instructions that combine what Jon/I have been doing:
> > >> > https://gist.github.com/avsm/09fd0f3944fecd8a8ee3
> > >> > In theory, the build service should do non-x86 builds (ARM, PPC, etc), but in practise the infrastructure seems completely broken and fail in interesting ways.  Has anyone ever successfully had this working?
> > >> > 
> > >> > CCing xen-api as well, since this is probably of use to the xapi packaging efforts on CentOS.
> > >> > 
> > >> > cheers,
> > >> > Anil
> > >> > _______________________________________________
> > >> > opam-devel mailing list
> > >> > opam-devel at lists.ocaml.org
> > >> > http://lists.ocaml.org/listinfo/opam-devel
> > > 
> > > _______________________________________________
> > > opam-devel mailing list
> > > opam-devel at lists.ocaml.org
> > > http://lists.ocaml.org/listinfo/opam-devel
> > 


From anil at recoil.org  Thu Aug 14 17:35:23 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 14 Aug 2014 17:35:23 +0100
Subject: [opam-devel] We have binary OPAM RPMs!
In-Reply-To: <C53B2B96-B735-4EB4-8524-2CEAADCC3619@recoil.org>
References: <1B51829C-343C-4F0E-90CF-C9B5F4596226@recoil.org>
 <17A2ECBD-A4AB-47A1-ACAB-0B7405DDFFE4@recoil.org>
 <CA71BA82-3421-4AD1-B47F-D8C63985A00B@gazagnaire.org>
 <39114231.8iRirIIoi3@agaric>
 <C53B2B96-B735-4EB4-8524-2CEAADCC3619@recoil.org>
Message-ID: <51567124-D67C-4C33-AD6B-6A2B6E6BD064@recoil.org>

On 14 Aug 2014, at 17:27, Anil Madhavapeddy <anil at recoil.org> wrote:

> The issue is that several of the transitive dependencies (tbb-devel, bison) are relatively new bits of software that aren't widely ported yet.

To clarify the bison point -- it requires a version of Bison that is newer than the base version in some distributions (like OpenBSD ports), and the two are incompatible (so other packages break when the version of Bison is upgraded).

-anil

From darioteixeira at yahoo.com  Fri Aug 15 12:14:50 2014
From: darioteixeira at yahoo.com (Dario Teixeira)
Date: Fri, 15 Aug 2014 04:14:50 -0700
Subject: [opam-devel] Package requires copying into a system directory
Message-ID: <1408101290.40062.YahooMailNeo@web121705.mail.ne1.yahoo.com>

Hi,

I have a Camlhighlight package which is almost ready for pushing
to the main OPAM repository.? There's a snag, however: proper
installation requires that the file "src/sexp.outlang" be copied
into the system directory "/usr/share/source-highlight".? This
is of course the sort of thing that requires root permissions,
which makes OPAM installation as a user more troublesome.


I've submitted a request for sexp.outlang to be shipped
by default with GNU Source-highlight [1].? Once that happens,
this problem will be moot.? It will take some time, however,
for a new GNU Source-highlight version to percolate down to
user distros, which is why an interim solution must be found.
Moreover,? it doesn't seem like GNU Source-highlight supports
a user data directory along side the system one, unfortunately.
(I've asked on their mailing-list anyway.)


Anyway, my current approach is to use OPAM's support for post-messages
to let the user know that the installation won't be complete until they

manually copy the sexp.outlang file [2].? Still, I'm wondering if someone
has encountered a similar problem before and has a better solution.


Thanks in advance for your time!
Best regards,
Dario Teixeira


[1] https://savannah.gnu.org/bugs/?42994
[2] https://github.com/darioteixeira/opam-dario/tree/master/packages/camlhighlight.9999/opam


From anil at recoil.org  Fri Aug 15 13:44:14 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 15 Aug 2014 13:44:14 +0100
Subject: [opam-devel] Package requires copying into a system directory
In-Reply-To: <1408101290.40062.YahooMailNeo@web121705.mail.ne1.yahoo.com>
References: <1408101290.40062.YahooMailNeo@web121705.mail.ne1.yahoo.com>
Message-ID: <0D0F3A15-A5D9-4828-88E6-112947FD9827@recoil.org>

On 15 Aug 2014, at 12:14, Dario Teixeira <darioteixeira at yahoo.com> wrote:

> Hi,
> 
> I have a Camlhighlight package which is almost ready for pushing
> to the main OPAM repository.  There's a snag, however: proper
> installation requires that the file "src/sexp.outlang" be copied
> into the system directory "/usr/share/source-highlight".  This
> is of course the sort of thing that requires root permissions,
> which makes OPAM installation as a user more troublesome.
> 
> I've submitted a request for sexp.outlang to be shipped
> by default with GNU Source-highlight [1].  Once that happens,
> this problem will be moot.  It will take some time, however,
> for a new GNU Source-highlight version to percolate down to
> user distros, which is why an interim solution must be found.
> Moreover,  it doesn't seem like GNU Source-highlight supports
> a user data directory along side the system one, unfortunately.
> (I've asked on their mailing-list anyway.)

Support multiple directories really is the way to go.  Failing that,
can you override the global directory and point it into OPAM.  It
may be possible to mirror /usr/share/source-highlight via a post
install hook into ~/.opam/<...> if you can override the global
definition of the directory.

-anil

From daniel.buenzli at erratique.ch  Fri Aug 15 14:14:01 2014
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Fri, 15 Aug 2014 14:14:01 +0100
Subject: [opam-devel] Package requires copying into a system directory
In-Reply-To: <1408101290.40062.YahooMailNeo@web121705.mail.ne1.yahoo.com>
References: <1408101290.40062.YahooMailNeo@web121705.mail.ne1.yahoo.com>
Message-ID: <B21DD8868DB144F2BEA95F5B24E8899A@erratique.ch>

Le vendredi, 15 ao?t 2014 ? 12:14, Dario Teixeira a ?crit :
> Anyway, my current approach is to use OPAM's support for post-messages
> to let the user know that the installation won't be complete until they
>  
> manually copy the sexp.outlang file [2]. Still, I'm wondering if someone
> has encountered a similar problem before and has a better solution.

If your build system generate an opam .install file, you can install files at an arbitrary absolute path on the system by specifiying a path in the `misc:` section (see section 2.2.3 of the opam developer manual).  

During install opam will then prompt the user if it allows to install the file at the given absolute path. I don't think this has been used much (if ever) so I don't know if it will ask you to sudo if it detects that it has not the privileges to install there (but I highly suspect the answer is no).

Best,

Daniel



From darioteixeira at yahoo.com  Fri Aug 15 15:05:11 2014
From: darioteixeira at yahoo.com (Dario Teixeira)
Date: Fri, 15 Aug 2014 07:05:11 -0700
Subject: [opam-devel] Package requires copying into a system directory
In-Reply-To: <B21DD8868DB144F2BEA95F5B24E8899A@erratique.ch>
References: <1408101290.40062.YahooMailNeo@web121705.mail.ne1.yahoo.com>
 <B21DD8868DB144F2BEA95F5B24E8899A@erratique.ch>
Message-ID: <1408111511.67952.YahooMailNeo@web121704.mail.ne1.yahoo.com>

Hi,

And thank you, Anil and Daniel, for your prompt replies.? I'm now considering the
alternative approach of providing GNU Source-highlight with a fully-qualified path
for sexp.outlang, instead of copying the file into its data directory.? This path
must be known at compile time (e.g $HOME/.opam/4.01.0/share/camlhighlight/sexp.outlang),
so I'll be taking a look at the OPAM and OASIS documentation to figure out how to
best do this.? Stay tuned.

<rant>
And if someone has some free time on their hands or wants to give an interesting
project to a student, writing a pure OCaml generic syntax highlighting library
is definitely something to consider.? GNU Source-highlight may have the advantage
of being packaged for all major distros, but in other respects it's a fine example
of why C++ is *not* the language to choose for heavy symbolic processing...
</rant>

Best regards,
Dario Teixeira

From daniel.buenzli at erratique.ch  Fri Aug 15 15:21:35 2014
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Fri, 15 Aug 2014 15:21:35 +0100
Subject: [opam-devel] Package requires copying into a system directory
In-Reply-To: <1408111511.67952.YahooMailNeo@web121704.mail.ne1.yahoo.com>
References: <1408101290.40062.YahooMailNeo@web121705.mail.ne1.yahoo.com>
 <B21DD8868DB144F2BEA95F5B24E8899A@erratique.ch>
 <1408111511.67952.YahooMailNeo@web121704.mail.ne1.yahoo.com>
Message-ID: <7564FD2D8FCA4D67B94F369D868F69AC@erratique.ch>

Le vendredi, 15 ao?t 2014 ? 15:05, Dario Teixeira a ?crit :
> And if someone has some free time on their hands or wants to give an interesting
> project to a student, writing a pure OCaml generic syntax highlighting library
> is definitely something to consider.

Did you have a look at:  

http://zoggy.github.io/higlo/

I use higlo the tool in conjuction with omd [1] to make to syntactically highlight ocaml code in my web log tool.

Never used it as a library though.

Best,

Daniel

[1] https://github.com/dbuenzli/logr/blob/master/logr#L14



From darioteixeira at yahoo.com  Fri Aug 15 16:12:26 2014
From: darioteixeira at yahoo.com (Dario Teixeira)
Date: Fri, 15 Aug 2014 08:12:26 -0700
Subject: [opam-devel] Package requires copying into a system directory
In-Reply-To: <7564FD2D8FCA4D67B94F369D868F69AC@erratique.ch>
References: <1408101290.40062.YahooMailNeo@web121705.mail.ne1.yahoo.com>
 <B21DD8868DB144F2BEA95F5B24E8899A@erratique.ch>
 <1408111511.67952.YahooMailNeo@web121704.mail.ne1.yahoo.com>
 <7564FD2D8FCA4D67B94F369D868F69AC@erratique.ch>
Message-ID: <1408115546.33224.YahooMailNeo@web121704.mail.ne1.yahoo.com>

Hi,

> I use higlo the tool in conjuction with omd [1] to make to syntactically 

> highlight ocaml code in my web log tool.

I wasn't aware of Higlo -- thanks for the pointer.? However, it does suffer
from a common syndrome among syntax highlighting projects: it supports one
or two input languages and leaves supporting others as an exercise for the
reader.? This makes it hard to overcome the catch-22 problem that hardly
anyone uses Higlo because it only supports a couple of languages, and no one
writes Higlo plugins for other languages because no one uses Higlo anyway.
Despite its problems, GNU Source-highlight did manage to get over this bump,
supporting pretty much any common and not-so-common language out there.

I'm convinced that any project aiming to replace GNU Source-highlight should
either a) use the same source language definitions as GNU Source-highlight
(or Emacs, or Vim), or b) include a converter from existing source language
definitions into its own native format.

Kind regards,
Dario

From darioteixeira at yahoo.com  Fri Aug 15 19:19:07 2014
From: darioteixeira at yahoo.com (Dario Teixeira)
Date: Fri, 15 Aug 2014 11:19:07 -0700
Subject: [opam-devel] Package requires copying into a system directory
In-Reply-To: <7564FD2D8FCA4D67B94F369D868F69AC@erratique.ch>
References: <1408101290.40062.YahooMailNeo@web121705.mail.ne1.yahoo.com>
 <B21DD8868DB144F2BEA95F5B24E8899A@erratique.ch>
 <1408111511.67952.YahooMailNeo@web121704.mail.ne1.yahoo.com>
 <7564FD2D8FCA4D67B94F369D868F69AC@erratique.ch>
Message-ID: <1408126747.56815.YahooMailNeo@web121705.mail.ne1.yahoo.com>

Hi,

Just an update: in the meantime I've implemented a reasonable solution [1].
Basically, it installs sexp.outlang to share/camlhighlight, and uses the
patching-with-substitution feature of OPAM to patch one of Camlhighlight
source files with the proper path.? "Ain't pretty but it works..."

Unfortunately I've also discovered a linking problem with the native code
version, so I'll have to postpone releasing the new version and uploading
the package until that's fixed...

Cheers,
Dario


[1] https://github.com/darioteixeira/opam-dario/tree/master/packages/camlhighlight.9999


From agarwal1975 at gmail.com  Sun Aug 17 17:16:37 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Sun, 17 Aug 2014 12:16:37 -0400
Subject: [opam-devel] opam pinning to local repo
Message-ID: <CAMu2m2+iuoryfrXxP1bwEQY-mnURrsZCRAZZLcw=f=iznNwo_A@mail.gmail.com>

I'm trying out 1.2.0-beta4 and wondering what is the correct workflow for
local development packages.

Say I have a local package `foo` that is not defined in any repository. I
put an opam file in the root of the package's source directory, then did
`opam pin add foo ~/code/foo`. However, opam doesn't detect the opam file,
and instead says "package not defined, would I like to define a new
package". At this point you have to answer yes, and opam creates a new opam
file, which is not what I want.

Even if the package is defined in a repository, I want opam to detect the
opam file in the source directory, not that defined in the repo.

The recent platform blog post says opam pin "will generate a new package on
the fly by detecting the presence of an opam file within the source
repository itself". Where should this opam file be?

Note I'm trying to simplify my previous workflow, where I would put the
opam file in the source directory at the path
"opam/packages/foo/foo.master/opam". Then I would first add this as a repo
and also pin to this directory. I'm trying to avoid the first part; I
shouldn't have to add a repo per package.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140817/97e00960/attachment.html>

From anil at recoil.org  Sun Aug 17 17:24:34 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 17 Aug 2014 11:24:34 -0500
Subject: [opam-devel] opam pinning to local repo
In-Reply-To: <CAMu2m2+iuoryfrXxP1bwEQY-mnURrsZCRAZZLcw=f=iznNwo_A@mail.gmail.com>
References: <CAMu2m2+iuoryfrXxP1bwEQY-mnURrsZCRAZZLcw=f=iznNwo_A@mail.gmail.com>
Message-ID: <91C0AB32-1293-4223-A0A4-429D28F482E1@recoil.org>

I wonder if you've been bitten by the git/local autodetection.  OPAM 1.2b4 spots that the local directory that you're pinning to is a git repository, and turns it into a git remote instead.  if you haven't committed the `opam` file to the local git, then it won't be seen by opam.

Can you try

opam pin -k local add foo ~/code/foo

and see if you get the expected behaviour of using the existing opam file?

This is the OPAM issue for the autodetection:
https://github.com/ocaml/opam/issues/1582

If this is indeed your bug, I'm of the firmer notion that this smart probing should be deactivated before the final release.

-a

On 17 Aug 2014, at 11:16, Ashish Agarwal <agarwal1975 at gmail.com> wrote:

> I'm trying out 1.2.0-beta4 and wondering what is the correct workflow for local development packages.
> 
> Say I have a local package `foo` that is not defined in any repository. I put an opam file in the root of the package's source directory, then did `opam pin add foo ~/code/foo`. However, opam doesn't detect the opam file, and instead says "package not defined, would I like to define a new package". At this point you have to answer yes, and opam creates a new opam file, which is not what I want.
> 
> Even if the package is defined in a repository, I want opam to detect the opam file in the source directory, not that defined in the repo.
> 
> The recent platform blog post says opam pin "will generate a new package on the fly by detecting the presence of an opam file within the source repository itself". Where should this opam file be?
> 
> Note I'm trying to simplify my previous workflow, where I would put the opam file in the source directory at the path "opam/packages/foo/foo.master/opam". Then I would first add this as a repo and also pin to this directory. I'm trying to avoid the first part; I shouldn't have to add a repo per package.
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140817/b1661aec/attachment.html>

From agarwal1975 at gmail.com  Sun Aug 17 18:01:08 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Sun, 17 Aug 2014 13:01:08 -0400
Subject: [opam-devel] opam pinning to local repo
In-Reply-To: <91C0AB32-1293-4223-A0A4-429D28F482E1@recoil.org>
References: <CAMu2m2+iuoryfrXxP1bwEQY-mnURrsZCRAZZLcw=f=iznNwo_A@mail.gmail.com>
 <91C0AB32-1293-4223-A0A4-429D28F482E1@recoil.org>
Message-ID: <CAMu2m2Ky07vQjts=Oigg-DwQWrEWAMwd2wLMME4SViTksJf5uQ@mail.gmail.com>

Yes, that's it. It works fine if I do -k local (which seems the same as -k
path, why multiple names for the same option?).

I guess this gives a +1 to the view in 1582 that the default should be
path-pin. I do often do `opam install` in order to test that my change is
correct, so in other words I'm not ready to git commit just yet. That is
necessarily the case when the change I'm making is to the opam file itself.
Also if I specify a folder path as the pin's target, to me the intuitive
result of that is to use the contents of that folder, committed or not. If
I specified a folder path appended with ".git#master" (or something like
that), then I'd be happy with that resulting in a git-pin.





On Sun, Aug 17, 2014 at 12:24 PM, Anil Madhavapeddy <anil at recoil.org> wrote:

> I wonder if you've been bitten by the git/local autodetection.  OPAM 1.2b4
> spots that the local directory that you're pinning to is a git repository,
> and turns it into a git remote instead.  if you haven't committed the
> `opam` file to the local git, then it won't be seen by opam.
>
> Can you try
>
> opam pin -k local add foo ~/code/foo
>
> and see if you get the expected behaviour of using the existing opam file?
>
> This is the OPAM issue for the autodetection:
> https://github.com/ocaml/opam/issues/1582
>
> If this is indeed your bug, I'm of the firmer notion that this smart
> probing should be deactivated before the final release.
>
> -a
>
> On 17 Aug 2014, at 11:16, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
>
> I'm trying out 1.2.0-beta4 and wondering what is the correct workflow for
> local development packages.
>
> Say I have a local package `foo` that is not defined in any repository. I
> put an opam file in the root of the package's source directory, then did
> `opam pin add foo ~/code/foo`. However, opam doesn't detect the opam file,
> and instead says "package not defined, would I like to define a new
> package". At this point you have to answer yes, and opam creates a new opam
> file, which is not what I want.
>
> Even if the package is defined in a repository, I want opam to detect the
> opam file in the source directory, not that defined in the repo.
>
> The recent platform blog post says opam pin "will generate a new package
> on the fly by detecting the presence of an opam file within the source
> repository itself". Where should this opam file be?
>
> Note I'm trying to simplify my previous workflow, where I would put the
> opam file in the source directory at the path
> "opam/packages/foo/foo.master/opam". Then I would first add this as a repo
> and also pin to this directory. I'm trying to avoid the first part; I
> shouldn't have to add a repo per package.
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140817/64819970/attachment.html>

From louis.gesbert at ocamlpro.com  Mon Aug 18 08:50:29 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Mon, 18 Aug 2014 09:50:29 +0200
Subject: [opam-devel] opam pinning to local repo
In-Reply-To: <CAMu2m2Ky07vQjts=Oigg-DwQWrEWAMwd2wLMME4SViTksJf5uQ@mail.gmail.com>
References: <CAMu2m2+iuoryfrXxP1bwEQY-mnURrsZCRAZZLcw=f=iznNwo_A@mail.gmail.com>
 <91C0AB32-1293-4223-A0A4-429D28F482E1@recoil.org>
 <CAMu2m2Ky07vQjts=Oigg-DwQWrEWAMwd2wLMME4SViTksJf5uQ@mail.gmail.com>
Message-ID: <2274946.Xb4Jy3f2jD@agaric>

Hi,

Le dimanche 17 ao?t 2014, 13:01:08 Ashish Agarwal a ?crit :
> Yes, that's it. It works fine if I do -k local (which seems the same as -k
> path, why multiple names for the same option?).

`local` is deprecated, `path` has been found more explicit. (Only "path" is still in the manpage)

> I guess this gives a +1 to the view in 1582 that the default should be
> path-pin. I do often do `opam install` in order to test that my change is
> correct, so in other words I'm not ready to git commit just yet. That is
> necessarily the case when the change I'm making is to the opam file itself.
> Also if I specify a folder path as the pin's target, to me the intuitive
> result of that is to use the contents of that folder, committed or not. If
> I specified a folder path appended with ".git#master" (or something like
> that), then I'd be happy with that resulting in a git-pin.

Yes indeed, this is reverted for the next beta in favor of a simple warning
when you path-pin a VCed directory, just so you know OPAM might pick up artefacts.
Using a directory ending in `.git` would switch to git-controlled without the need for `-k`, as would using a git url (git://).

Thanks for the feedback !

Louis Gesbert


> On Sun, Aug 17, 2014 at 12:24 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
> 
> > I wonder if you've been bitten by the git/local autodetection.  OPAM 1.2b4
> > spots that the local directory that you're pinning to is a git repository,
> > and turns it into a git remote instead.  if you haven't committed the
> > `opam` file to the local git, then it won't be seen by opam.
> >
> > Can you try
> >
> > opam pin -k local add foo ~/code/foo
> >
> > and see if you get the expected behaviour of using the existing opam file?
> >
> > This is the OPAM issue for the autodetection:
> > https://github.com/ocaml/opam/issues/1582
> >
> > If this is indeed your bug, I'm of the firmer notion that this smart
> > probing should be deactivated before the final release.
> >
> > -a
> >
> > On 17 Aug 2014, at 11:16, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
> >
> > I'm trying out 1.2.0-beta4 and wondering what is the correct workflow for
> > local development packages.
> >
> > Say I have a local package `foo` that is not defined in any repository. I
> > put an opam file in the root of the package's source directory, then did
> > `opam pin add foo ~/code/foo`. However, opam doesn't detect the opam file,
> > and instead says "package not defined, would I like to define a new
> > package". At this point you have to answer yes, and opam creates a new opam
> > file, which is not what I want.
> >
> > Even if the package is defined in a repository, I want opam to detect the
> > opam file in the source directory, not that defined in the repo.
> >
> > The recent platform blog post says opam pin "will generate a new package
> > on the fly by detecting the presence of an opam file within the source
> > repository itself". Where should this opam file be?
> >
> > Note I'm trying to simplify my previous workflow, where I would put the
> > opam file in the source directory at the path
> > "opam/packages/foo/foo.master/opam". Then I would first add this as a repo
> > and also pin to this directory. I'm trying to avoid the first part; I
> > shouldn't have to add a repo per package.
> >
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
> >
> >
> >

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140818/7bb7c5c4/attachment-0001.html>

From amc79 at cam.ac.uk  Thu Aug 21 20:41:28 2014
From: amc79 at cam.ac.uk (Amir Chaudhry)
Date: Thu, 21 Aug 2014 20:41:28 +0100
Subject: [opam-devel] Issue with Homebrew install of opam --HEAD
Message-ID: <61286FBC-5128-4CBD-97BC-D8E4D6D50E0F@cam.ac.uk>

Not strictly an opam bug but I just tried to install the HEAD version of opam via homebrew and encountered a failure [1].  I'm not sure what I'm missing nor how to fix it so I'm wondering if anyone can help me figure it out.  The homebrew formula is at [2] and hasn't been changed in a while.

In the meantime I've gone back to opam 1.1.1. without any (apparent) issues.

[1] output at: https://gist.github.com/amirmc/93a41cf3a5c96f20bbfc
[2] https://github.com/Homebrew/homebrew/blob/master/Library/Formula/opam.rb

Amir

From thomas.gazagnaire at gmail.com  Thu Aug 21 21:38:01 2014
From: thomas.gazagnaire at gmail.com (Thomas Gazagnaire)
Date: Thu, 21 Aug 2014 21:38:01 +0100
Subject: [opam-devel] Issue with Homebrew install of opam --HEAD
In-Reply-To: <61286FBC-5128-4CBD-97BC-D8E4D6D50E0F@cam.ac.uk>
References: <61286FBC-5128-4CBD-97BC-D8E4D6D50E0F@cam.ac.uk>
Message-ID: <586DD695-B8AC-4CBB-A7B4-D0FC4F9A0C21@gmail.com>

This is related to changes I've done to make opam-lib compile on 4.02

Try to opam update and re-run your command 

> On 21 Aug 2014, at 20:41, Amir Chaudhry <amc79 at cam.ac.uk> wrote:
> 
> Not strictly an opam bug but I just tried to install the HEAD version of opam via homebrew and encountered a failure [1].  I'm not sure what I'm missing nor how to fix it so I'm wondering if anyone can help me figure it out.  The homebrew formula is at [2] and hasn't been changed in a while.
> 
> In the meantime I've gone back to opam 1.1.1. without any (apparent) issues.
> 
> [1] output at: https://gist.github.com/amirmc/93a41cf3a5c96f20bbfc
> [2] https://github.com/Homebrew/homebrew/blob/master/Library/Formula/opam.rb
> 
> Amir
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

From thomas.gazagnaire at gmail.com  Thu Aug 21 21:40:47 2014
From: thomas.gazagnaire at gmail.com (Thomas Gazagnaire)
Date: Thu, 21 Aug 2014 21:40:47 +0100
Subject: [opam-devel] Issue with Homebrew install of opam --HEAD
In-Reply-To: <586DD695-B8AC-4CBB-A7B4-D0FC4F9A0C21@gmail.com>
References: <61286FBC-5128-4CBD-97BC-D8E4D6D50E0F@cam.ac.uk>
 <586DD695-B8AC-4CBB-A7B4-D0FC4F9A0C21@gmail.com>
Message-ID: <6EC3FF68-A57A-4392-92FB-2B35CD46BBCB@gmail.com>

That's also possible that the formula needs to be updated due to changes in the build system in opam 1.2 (needs to add a make lib-ext somewhere I think). Depends on how the package is built ...

> On 21 Aug 2014, at 21:38, Thomas Gazagnaire <thomas.gazagnaire at gmail.com> wrote:
> 
> This is related to changes I've done to make opam-lib compile on 4.02
> 
> Try to opam update and re-run your command 
> 
>> On 21 Aug 2014, at 20:41, Amir Chaudhry <amc79 at cam.ac.uk> wrote:
>> 
>> Not strictly an opam bug but I just tried to install the HEAD version of opam via homebrew and encountered a failure [1].  I'm not sure what I'm missing nor how to fix it so I'm wondering if anyone can help me figure it out.  The homebrew formula is at [2] and hasn't been changed in a while.
>> 
>> In the meantime I've gone back to opam 1.1.1. without any (apparent) issues.
>> 
>> [1] output at: https://gist.github.com/amirmc/93a41cf3a5c96f20bbfc
>> [2] https://github.com/Homebrew/homebrew/blob/master/Library/Formula/opam.rb
>> 
>> Amir
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel

From louis.gesbert at ocamlpro.com  Fri Aug 22 08:40:17 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 22 Aug 2014 09:40:17 +0200
Subject: [opam-devel] Issue with Homebrew install of opam --HEAD
In-Reply-To: <6EC3FF68-A57A-4392-92FB-2B35CD46BBCB@gmail.com>
References: <61286FBC-5128-4CBD-97BC-D8E4D6D50E0F@cam.ac.uk>
 <586DD695-B8AC-4CBB-A7B4-D0FC4F9A0C21@gmail.com>
 <6EC3FF68-A57A-4392-92FB-2B35CD46BBCB@gmail.com>
Message-ID: <1466557.JBcPZKW10h@agaric>

The homebrew package description probably needs to be updated
for 1.2 (or 1.1.2, for that matter).
See https://github.com/ocaml/opam/blob/master/README.md#compiling-this-repo

Le jeudi 21 ao?t 2014, 21:40:47 Thomas Gazagnaire a ?crit :
> That's also possible that the formula needs to be updated due to changes in the build system in opam 1.2 (needs to add a make lib-ext somewhere I think). Depends on how the package is built ...
> 
> > On 21 Aug 2014, at 21:38, Thomas Gazagnaire <thomas.gazagnaire at gmail.com> wrote:
> > 
> > This is related to changes I've done to make opam-lib compile on 4.02
> > 
> > Try to opam update and re-run your command 
> > 
> >> On 21 Aug 2014, at 20:41, Amir Chaudhry <amc79 at cam.ac.uk> wrote:
> >> 
> >> Not strictly an opam bug but I just tried to install the HEAD version of opam via homebrew and encountered a failure [1].  I'm not sure what I'm missing nor how to fix it so I'm wondering if anyone can help me figure it out.  The homebrew formula is at [2] and hasn't been changed in a while.
> >> 
> >> In the meantime I've gone back to opam 1.1.1. without any (apparent) issues.
> >> 
> >> [1] output at: https://gist.github.com/amirmc/93a41cf3a5c96f20bbfc
> >> [2] https://github.com/Homebrew/homebrew/blob/master/Library/Formula/opam.rb
> >> 
> >> Amir
> >> _______________________________________________
> >> opam-devel mailing list
> >> opam-devel at lists.ocaml.org
> >> http://lists.ocaml.org/listinfo/opam-devel
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140822/5d1a19ce/attachment.html>

From anil at recoil.org  Sat Aug 23 12:40:57 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sat, 23 Aug 2014 12:40:57 +0100
Subject: [opam-devel] Issue with Homebrew install of opam --HEAD
In-Reply-To: <1466557.JBcPZKW10h@agaric>
References: <61286FBC-5128-4CBD-97BC-D8E4D6D50E0F@cam.ac.uk>
 <586DD695-B8AC-4CBB-A7B4-D0FC4F9A0C21@gmail.com>
 <6EC3FF68-A57A-4392-92FB-2B35CD46BBCB@gmail.com> <1466557.JBcPZKW10h@agaric>
Message-ID: <84690BA7-8AD3-4F57-9269-F5CB96744E86@recoil.org>

I've issued a Homebrew pull request to update OPAM to 1.1.2 upstream, which
lets the `--HEAD` target work as expected again.

https://github.com/Homebrew/homebrew/pull/31818

-anil

On 22 Aug 2014, at 08:40, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> The homebrew package description probably needs to be updated
> for 1.2 (or 1.1.2, for that matter).
> See https://github.com/ocaml/opam/blob/master/README.md#compiling-this-repo
>  
> Le jeudi 21 ao?t 2014, 21:40:47 Thomas Gazagnaire a ?crit :
> > That's also possible that the formula needs to be updated due to changes in the build system in opam 1.2 (needs to add a make lib-ext somewhere I think). Depends on how the package is built ...
> > 
> > > On 21 Aug 2014, at 21:38, Thomas Gazagnaire <thomas.gazagnaire at gmail.com> wrote:
> > > 
> > > This is related to changes I've done to make opam-lib compile on 4.02
> > > 
> > > Try to opam update and re-run your command 
> > > 
> > >> On 21 Aug 2014, at 20:41, Amir Chaudhry <amc79 at cam.ac.uk> wrote:
> > >> 
> > >> Not strictly an opam bug but I just tried to install the HEAD version of opam via homebrew and encountered a failure [1].  I'm not sure what I'm missing nor how to fix it so I'm wondering if anyone can help me figure it out.  The homebrew formula is at [2] and hasn't been changed in a while.
> > >> 
> > >> In the meantime I've gone back to opam 1.1.1. without any (apparent) issues.
> > >> 
> > >> [1] output at: https://gist.github.com/amirmc/93a41cf3a5c96f20bbfc
> > >> [2] https://github.com/Homebrew/homebrew/blob/master/Library/Formula/opam.rb
> > >> 
> > >> Amir
> > >> _______________________________________________
> > >> opam-devel mailing list
> > >> opam-devel at lists.ocaml.org
> > >> http://lists.ocaml.org/listinfo/opam-devel
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
>  
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From anil at recoil.org  Tue Aug 26 17:04:22 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 26 Aug 2014 17:04:22 +0100
Subject: [opam-devel] distributed package management blog post
Message-ID: <E68F9768-5A02-4152-BF0D-4862DD80FDCE@recoil.org>

Just FYI, there's an interesting blog post by Ezyang about a distributed approach to package management, which matches OPAM pretty well.

http://blog.ezyang.com/2014/08/the-fundamental-problem-of-programming-language-package-management/

I responded on the HN thread here:
https://news.ycombinator.com/item?id=8226139
(other perspectives/clarifications also welcome!)

-anil

From anil at recoil.org  Fri Aug 29 12:17:05 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 29 Aug 2014 12:17:05 +0100
Subject: [opam-devel] worrying segfault in ocaml-gettext on 4.02
Message-ID: <513A3240-86D5-4E58-B89A-1AA8D797037E@recoil.org>

There's a reproducible segfault in 4.02 only for gettext
https://github.com/ocaml/opam-bulk-logs/blob/master/20140829/roo/4.02.0/raw/gettext#L2351

Anyone got time to triage this?  I'm out for a few hours so cant immediately.  Looks like gettext may be double linking unix.cma, which can't be healthy.

-anil


From mshinwell at janestreet.com  Fri Aug 29 12:19:18 2014
From: mshinwell at janestreet.com (Mark Shinwell)
Date: Fri, 29 Aug 2014 12:19:18 +0100
Subject: [opam-devel] worrying segfault in ocaml-gettext on 4.02
In-Reply-To: <513A3240-86D5-4E58-B89A-1AA8D797037E@recoil.org>
References: <513A3240-86D5-4E58-B89A-1AA8D797037E@recoil.org>
Message-ID: <CAM3Ki74m3qXVxnxErL1vzOoMH-u_RRqCBR4WM+GAmxFtzDK0aA@mail.gmail.com>

Jeremie took one look at this and said it's probably something to do
with formats...

Mark

On 29 August 2014 12:17, Anil Madhavapeddy <anil at recoil.org> wrote:
> There's a reproducible segfault in 4.02 only for gettext
> https://github.com/ocaml/opam-bulk-logs/blob/master/20140829/roo/4.02.0/raw/gettext#L2351
>
> Anyone got time to triage this?  I'm out for a few hours so cant immediately.  Looks like gettext may be double linking unix.cma, which can't be healthy.
>
> -anil
>

From mshinwell at janestreet.com  Fri Aug 29 12:20:49 2014
From: mshinwell at janestreet.com (Mark Shinwell)
Date: Fri, 29 Aug 2014 12:20:49 +0100
Subject: [opam-devel] worrying segfault in ocaml-gettext on 4.02
In-Reply-To: <CAM3Ki74m3qXVxnxErL1vzOoMH-u_RRqCBR4WM+GAmxFtzDK0aA@mail.gmail.com>
References: <513A3240-86D5-4E58-B89A-1AA8D797037E@recoil.org>
 <CAM3Ki74m3qXVxnxErL1vzOoMH-u_RRqCBR4WM+GAmxFtzDK0aA@mail.gmail.com>
Message-ID: <CAM3Ki74bJKa5OBKDkzL=3OEb0y7jDoTxy3+npgjBHdbh5Sm0bg@mail.gmail.com>

(we are looking at it)

On 29 August 2014 12:19, Mark Shinwell <mshinwell at janestreet.com> wrote:
> Jeremie took one look at this and said it's probably something to do
> with formats...
>
> Mark
>
> On 29 August 2014 12:17, Anil Madhavapeddy <anil at recoil.org> wrote:
>> There's a reproducible segfault in 4.02 only for gettext
>> https://github.com/ocaml/opam-bulk-logs/blob/master/20140829/roo/4.02.0/raw/gettext#L2351
>>
>> Anyone got time to triage this?  I'm out for a few hours so cant immediately.  Looks like gettext may be double linking unix.cma, which can't be healthy.
>>
>> -anil
>>

From yallop at gmail.com  Fri Aug 29 12:27:59 2014
From: yallop at gmail.com (Jeremy Yallop)
Date: Fri, 29 Aug 2014 12:27:59 +0100
Subject: [opam-devel] worrying segfault in ocaml-gettext on 4.02
In-Reply-To: <CAM3Ki74m3qXVxnxErL1vzOoMH-u_RRqCBR4WM+GAmxFtzDK0aA@mail.gmail.com>
References: <513A3240-86D5-4E58-B89A-1AA8D797037E@recoil.org>
 <CAM3Ki74m3qXVxnxErL1vzOoMH-u_RRqCBR4WM+GAmxFtzDK0aA@mail.gmail.com>
Message-ID: <CAAxsn=ESdcTfOn5b-MDGwCO3bMq2WJFBksSKREY5JzN44Qk_kw@mail.gmail.com>

Indeed: the CHANGELOG has the following for 0.3.5:

v 0.3.5 (Mon, 04 Aug 2014 23:31:41 +0200):
  * Always use format_of_string to not segfault with OCaml 4.02.

(the segfault was in 0.3.4)


On 29 August 2014 12:19, Mark Shinwell <mshinwell at janestreet.com> wrote:
> Jeremie took one look at this and said it's probably something to do
> with formats...
>
> Mark
>
> On 29 August 2014 12:17, Anil Madhavapeddy <anil at recoil.org> wrote:
>> There's a reproducible segfault in 4.02 only for gettext
>> https://github.com/ocaml/opam-bulk-logs/blob/master/20140829/roo/4.02.0/raw/gettext#L2351
>>
>> Anyone got time to triage this?  I'm out for a few hours so cant immediately.  Looks like gettext may be double linking unix.cma, which can't be healthy.
>>
>> -anil
>>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

From mshinwell at janestreet.com  Fri Aug 29 12:28:42 2014
From: mshinwell at janestreet.com (Mark Shinwell)
Date: Fri, 29 Aug 2014 12:28:42 +0100
Subject: [opam-devel] worrying segfault in ocaml-gettext on 4.02
In-Reply-To: <CAAxsn=ESdcTfOn5b-MDGwCO3bMq2WJFBksSKREY5JzN44Qk_kw@mail.gmail.com>
References: <513A3240-86D5-4E58-B89A-1AA8D797037E@recoil.org>
 <CAM3Ki74m3qXVxnxErL1vzOoMH-u_RRqCBR4WM+GAmxFtzDK0aA@mail.gmail.com>
 <CAAxsn=ESdcTfOn5b-MDGwCO3bMq2WJFBksSKREY5JzN44Qk_kw@mail.gmail.com>
Message-ID: <CAM3Ki75e0upp3hoU3M0CJsEgxY6Zhp+-EYwH=T4AtgeHkBMX9g@mail.gmail.com>

The problem is the "if true then Obj.magic ..." line.  Deleting this
seems to make it work, which I assume is the fix in 0.3.5.

Mark

On 29 August 2014 12:27, Jeremy Yallop <yallop at gmail.com> wrote:
> Indeed: the CHANGELOG has the following for 0.3.5:
>
> v 0.3.5 (Mon, 04 Aug 2014 23:31:41 +0200):
>   * Always use format_of_string to not segfault with OCaml 4.02.
>
> (the segfault was in 0.3.4)
>
>
> On 29 August 2014 12:19, Mark Shinwell <mshinwell at janestreet.com> wrote:
>> Jeremie took one look at this and said it's probably something to do
>> with formats...
>>
>> Mark
>>
>> On 29 August 2014 12:17, Anil Madhavapeddy <anil at recoil.org> wrote:
>>> There's a reproducible segfault in 4.02 only for gettext
>>> https://github.com/ocaml/opam-bulk-logs/blob/master/20140829/roo/4.02.0/raw/gettext#L2351
>>>
>>> Anyone got time to triage this?  I'm out for a few hours so cant immediately.  Looks like gettext may be double linking unix.cma, which can't be healthy.
>>>
>>> -anil
>>>
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel

From sylvain+ocaml at le-gall.net  Fri Aug 29 15:01:41 2014
From: sylvain+ocaml at le-gall.net (Sylvain Le Gall)
Date: Fri, 29 Aug 2014 16:01:41 +0200
Subject: [opam-devel] worrying segfault in ocaml-gettext on 4.02
In-Reply-To: <CAM3Ki75e0upp3hoU3M0CJsEgxY6Zhp+-EYwH=T4AtgeHkBMX9g@mail.gmail.com>
References: <513A3240-86D5-4E58-B89A-1AA8D797037E@recoil.org>
 <CAM3Ki74m3qXVxnxErL1vzOoMH-u_RRqCBR4WM+GAmxFtzDK0aA@mail.gmail.com>
 <CAAxsn=ESdcTfOn5b-MDGwCO3bMq2WJFBksSKREY5JzN44Qk_kw@mail.gmail.com>
 <CAM3Ki75e0upp3hoU3M0CJsEgxY6Zhp+-EYwH=T4AtgeHkBMX9g@mail.gmail.com>
Message-ID: <CAOCAUGOFr99a5b0xiVWfSaqoiDTgxs=D__91uQL0L2=xwgqMvA@mail.gmail.com>

2014-08-29 13:28 GMT+02:00 Mark Shinwell <mshinwell at janestreet.com>:

> The problem is the "if true then Obj.magic ..." line.  Deleting this
> seems to make it work, which I assume is the fix in 0.3.5.
>
>
Yes.


> Mark
>
> On 29 August 2014 12:27, Jeremy Yallop <yallop at gmail.com> wrote:
> > Indeed: the CHANGELOG has the following for 0.3.5:
> >
> > v 0.3.5 (Mon, 04 Aug 2014 23:31:41 +0200):
> >   * Always use format_of_string to not segfault with OCaml 4.02.
> >
> > (the segfault was in 0.3.4)
> >
> >
> > On 29 August 2014 12:19, Mark Shinwell <mshinwell at janestreet.com> wrote:
> >> Jeremie took one look at this and said it's probably something to do
> >> with formats...
> >>
> >> Mark
> >>
> >> On 29 August 2014 12:17, Anil Madhavapeddy <anil at recoil.org> wrote:
> >>> There's a reproducible segfault in 4.02 only for gettext
> >>>
> https://github.com/ocaml/opam-bulk-logs/blob/master/20140829/roo/4.02.0/raw/gettext#L2351
> >>>
> >>> Anyone got time to triage this?  I'm out for a few hours so cant
> immediately.  Looks like gettext may be double linking unix.cma, which
> can't be healthy.
> >>>
> >>> -anil
> >>>
> >> _______________________________________________
> >> opam-devel mailing list
> >> opam-devel at lists.ocaml.org
> >> http://lists.ocaml.org/listinfo/opam-devel
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140829/c0fbcd59/attachment.html>

From anil at recoil.org  Fri Aug 29 15:07:09 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 29 Aug 2014 15:07:09 +0100
Subject: [opam-devel] worrying segfault in ocaml-gettext on 4.02
In-Reply-To: <CAOCAUGOFr99a5b0xiVWfSaqoiDTgxs=D__91uQL0L2=xwgqMvA@mail.gmail.com>
References: <513A3240-86D5-4E58-B89A-1AA8D797037E@recoil.org>
 <CAM3Ki74m3qXVxnxErL1vzOoMH-u_RRqCBR4WM+GAmxFtzDK0aA@mail.gmail.com>
 <CAAxsn=ESdcTfOn5b-MDGwCO3bMq2WJFBksSKREY5JzN44Qk_kw@mail.gmail.com>
 <CAM3Ki75e0upp3hoU3M0CJsEgxY6Zhp+-EYwH=T4AtgeHkBMX9g@mail.gmail.com>
 <CAOCAUGOFr99a5b0xiVWfSaqoiDTgxs=D__91uQL0L2=xwgqMvA@mail.gmail.com>
Message-ID: <508C9EF9-8DCC-424F-A141-643083A4FEE6@recoil.org>

Thanks for confirming the fix -- I just wanted to make sure this wasn't a 4.02 release blocker.

Now in OPAM in https://github.com/ocaml/opam-repository/pull/2545

-anil

On 29 Aug 2014, at 15:01, Sylvain Le Gall <sylvain+ocaml at le-gall.net> wrote:

> 
> 
> 
> 2014-08-29 13:28 GMT+02:00 Mark Shinwell <mshinwell at janestreet.com>:
> The problem is the "if true then Obj.magic ..." line.  Deleting this
> seems to make it work, which I assume is the fix in 0.3.5.
> 
> 
> Yes.
>  
> Mark
> 
> On 29 August 2014 12:27, Jeremy Yallop <yallop at gmail.com> wrote:
> > Indeed: the CHANGELOG has the following for 0.3.5:
> >
> > v 0.3.5 (Mon, 04 Aug 2014 23:31:41 +0200):
> >   * Always use format_of_string to not segfault with OCaml 4.02.
> >
> > (the segfault was in 0.3.4)
> >
> >
> > On 29 August 2014 12:19, Mark Shinwell <mshinwell at janestreet.com> wrote:
> >> Jeremie took one look at this and said it's probably something to do
> >> with formats...
> >>
> >> Mark
> >>
> >> On 29 August 2014 12:17, Anil Madhavapeddy <anil at recoil.org> wrote:
> >>> There's a reproducible segfault in 4.02 only for gettext
> >>> https://github.com/ocaml/opam-bulk-logs/blob/master/20140829/roo/4.02.0/raw/gettext#L2351
> >>>
> >>> Anyone got time to triage this?  I'm out for a few hours so cant immediately.  Looks like gettext may be double linking unix.cma, which can't be healthy.
> >>>
> >>> -anil
> >>>
> >> _______________________________________________
> >> opam-devel mailing list
> >> opam-devel at lists.ocaml.org
> >> http://lists.ocaml.org/listinfo/opam-devel
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140829/0051e382/attachment.html>

From anil at recoil.org  Sun Aug 31 08:56:40 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 31 Aug 2014 08:56:40 +0100
Subject: [opam-devel] the available field in 1.1.1
Message-ID: <27B936A1-BEE7-4EE6-8699-D6D287735EFB@recoil.org>

I'm trying to get the available field working in camlp4 so that we can select a system camlp4 if its a preinstalled switch.  I have the following camlp4 packages:

diff --git a/packages/camlp4/camlp4.4.02.0+system/opam b/packages/camlp4/camlp4.4.02.0+system/opam
new file mode 100644
index 0000000..4e3bc40
--- /dev/null
+++ b/packages/camlp4/camlp4.4.02.0+system/opam
@@ -0,0 +1,8 @@
+opam-version: "1"
+maintainer: "jeremie at dimino.org"
+homepage: "https://github.com/ocaml/camlp4"
+license: "LGPLv2"
+build: [
+  ["camlp4" "-v"]
+]
+available: [ preinstalled & ocaml-version = "4.02.0" ]
diff --git a/packages/camlp4/camlp4.4.02.0/opam b/packages/camlp4/camlp4.4.02.0/opam
index 32f02e6..0fc662d 100644
--- a/packages/camlp4/camlp4.4.02.0/opam
+++ b/packages/camlp4/camlp4.4.02.0/opam
@@ -17,4 +17,4 @@ remove: [
              "%{bin}%/camlp4o.opt" "%{bin}%/camlp4oof.opt" "%{bin}%/camlp4r.opt"
   ]
 ]
-ocaml-version: [>="4.02.0" & <"4.03.0"]
+available: [ !preinstalled & ocaml-version = "4.02.0" ]

This works fine OPAM 1.2, but OPAM 1.1.1 complains with a parse error.  Is there
anything that'll work for both?

See https://travis-ci.org/ocaml/opam-repository/jobs/34006191
and https://github.com/ocaml/opam-repository/pull/2558

errors are:
[WARNING] Errors while parsing camlp4.4.02.0 OPAM file, skipping.
[WARNING] Errors while parsing camlp4.4.02.0+system OPAM file, skipping.
[WARNING] Errors while parsing camlp4.4.02.0 OPAM file, skipping.
[WARNING] Errors while parsing camlp4.4.02.0+system OPAM file, skipping.

(Also, an env var to turn these parse warnings into failures would be a useful Travis knob to have in 1.2 perhaps)

-anil

From thomas at gazagnaire.org  Sun Aug 31 10:30:52 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Sun, 31 Aug 2014 10:30:52 +0100
Subject: [opam-devel] the available field in 1.1.1
In-Reply-To: <27B936A1-BEE7-4EE6-8699-D6D287735EFB@recoil.org>
References: <27B936A1-BEE7-4EE6-8699-D6D287735EFB@recoil.org>
Message-ID: <0F47FA7B-2369-4860-ACE7-95DDCD877742@gazagnaire.org>

> +available: [ !preinstalled & ocaml-version = "4.02.0" ]
> 
> This works fine OPAM 1.2, but OPAM 1.1.1 complains with a parse error.  Is there
> anything that'll work for both?

The parser in 1.1.1 was a bit dumb, you need to add parenthesis:

available: [ !preinstalled & (ocaml-version = "4.02.0") ]

> errors are:
> [WARNING] Errors while parsing camlp4.4.02.0 OPAM file, skipping.
> [WARNING] Errors while parsing camlp4.4.02.0+system OPAM file, skipping.
> [WARNING] Errors while parsing camlp4.4.02.0 OPAM file, skipping.
> [WARNING] Errors while parsing camlp4.4.02.0+system OPAM file, skipping.
> 
> (Also, an env var to turn these parse warnings into failures would be a useful Travis knob to have in 1.2 perhaps)

You can use --strict or set OPAMSTRICT to a non null value.

Thomas


From thomas at gazagnaire.org  Sun Aug 31 13:35:43 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Sun, 31 Aug 2014 13:35:43 +0100
Subject: [opam-devel] the available field in 1.1.1
In-Reply-To: <0F47FA7B-2369-4860-ACE7-95DDCD877742@gazagnaire.org>
References: <27B936A1-BEE7-4EE6-8699-D6D287735EFB@recoil.org>
 <0F47FA7B-2369-4860-ACE7-95DDCD877742@gazagnaire.org>
Message-ID: <313F3D4B-ABB1-480C-A652-8EA6783F956D@gazagnaire.org>

>> +available: [ !preinstalled & ocaml-version = "4.02.0" ]
>> 
>> This works fine OPAM 1.2, but OPAM 1.1.1 complains with a parse error.  Is there
>> anything that'll work for both?
> 
> The parser in 1.1.1 was a bit dumb, you need to add parenthesis:
> 
> available: [ !preinstalled & (ocaml-version = "4.02.0")
> ]

Actually, 1.1.1 parser is very broken ... You should use:
[ (preinstalled = false) & (ocaml-version = "4.02.0") ]

>> errors are:
>> [WARNING] Errors while parsing camlp4.4.02.0 OPAM file, skipping.
>> [WARNING] Errors while parsing camlp4.4.02.0+system OPAM file, skipping.
>> [WARNING] Errors while parsing camlp4.4.02.0 OPAM file, skipping.
>> [WARNING] Errors while parsing camlp4.4.02.0+system OPAM file, skipping.
>> 
>> (Also, an env var to turn these parse warnings into failures would be a useful Travis knob to have in 1.2 perhaps)
> 
> You can use --strict or set OPAMSTRICT to a non null value.

And it seems that `opam update --strict` does not really care about the --strict option.

But at least, parser error messages in 1.2 are great!

Thomas

From anil at recoil.org  Sun Aug 31 15:03:26 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 31 Aug 2014 15:03:26 +0100
Subject: [opam-devel] the available field in 1.1.1
In-Reply-To: <313F3D4B-ABB1-480C-A652-8EA6783F956D@gazagnaire.org>
References: <27B936A1-BEE7-4EE6-8699-D6D287735EFB@recoil.org>
 <0F47FA7B-2369-4860-ACE7-95DDCD877742@gazagnaire.org>
 <313F3D4B-ABB1-480C-A652-8EA6783F956D@gazagnaire.org>
Message-ID: <696D4FEC-3D30-4928-B9F0-00118EBF261D@recoil.org>

On 31 Aug 2014, at 13:35, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:

>>> +available: [ !preinstalled & ocaml-version = "4.02.0" ]
>>> 
>>> This works fine OPAM 1.2, but OPAM 1.1.1 complains with a parse error.  Is there
>>> anything that'll work for both?
>> 
>> The parser in 1.1.1 was a bit dumb, you need to add parenthesis:
>> 
>> available: [ !preinstalled & (ocaml-version = "4.02.0")
>> ]
> 
> Actually, 1.1.1 parser is very broken ... You should use:
> [ (preinstalled = false) & (ocaml-version = "4.02.0") ]

Thanks, this is now pushed and building in the pull request (along with a help message to point people at camlp4 binaries).

> 
>>> errors are:
>>> [WARNING] Errors while parsing camlp4.4.02.0 OPAM file, skipping.
>>> [WARNING] Errors while parsing camlp4.4.02.0+system OPAM file, skipping.
>>> [WARNING] Errors while parsing camlp4.4.02.0 OPAM file, skipping.
>>> [WARNING] Errors while parsing camlp4.4.02.0+system OPAM file, skipping.
>>> 
>>> (Also, an env var to turn these parse warnings into failures would be a useful Travis knob to have in 1.2 perhaps)
>> 
>> You can use --strict or set OPAMSTRICT to a non null value.
> 
> And it seems that `opam update --strict` does not really care about the --strict option.
> 
> But at least, parser error messages in 1.2 are great!

Splendid :) Is OPAMSTRICT working in OPAM 1.2?  This will be helpful since
there are known warnings in 1.1 that should disappear in 1.2.

-anil

From anil at recoil.org  Sun Aug 31 15:11:49 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 31 Aug 2014 15:11:49 +0100
Subject: [opam-devel] the available field in 1.1.1
In-Reply-To: <696D4FEC-3D30-4928-B9F0-00118EBF261D@recoil.org>
References: <27B936A1-BEE7-4EE6-8699-D6D287735EFB@recoil.org>
 <0F47FA7B-2369-4860-ACE7-95DDCD877742@gazagnaire.org>
 <313F3D4B-ABB1-480C-A652-8EA6783F956D@gazagnaire.org>
 <696D4FEC-3D30-4928-B9F0-00118EBF261D@recoil.org>
Message-ID: <8F21FD8A-761D-4421-934F-3B29872D0158@recoil.org>

On 31 Aug 2014, at 15:03, Anil Madhavapeddy <anil at recoil.org> wrote:

> On 31 Aug 2014, at 13:35, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
> 
>>>> +available: [ !preinstalled & ocaml-version = "4.02.0" ]
>>>> 
>>>> This works fine OPAM 1.2, but OPAM 1.1.1 complains with a parse error.  Is there
>>>> anything that'll work for both?
>>> 
>>> The parser in 1.1.1 was a bit dumb, you need to add parenthesis:
>>> 
>>> available: [ !preinstalled & (ocaml-version = "4.02.0")
>>> ]
>> 
>> Actually, 1.1.1 parser is very broken ... You should use:
>> [ (preinstalled = false) & (ocaml-version = "4.02.0") ]
> 
> Thanks, this is now pushed and building in the pull request (along with a help message to point people at camlp4 binaries).

Can't get this to work, see below for two attempts:

+available: [ (preinstalled = "false") & (ocaml-version = "4.02.0") ]
To Build:
atdgen
camlp4
build one: atdgen
default    Synchronizing with /home/travis/build/ocaml/opam-repository
Updating ~/.opam/repo/compiler-index ...
Updating ~/.opam/compilers/ ...
Updating ~/.opam/repo/package-index ...
Updating ~/.opam/packages/ ...
Creating a cache of metadata in ~/.opam/state.cache ...
[ERROR] 'preinstalled' has type bool, but a env element of type string was expected.

+available: [ (preinstalled = false) & (ocaml-version = "4.02.0") ]
To Build:
atdgen
camlp4
build one: atdgen
default    Synchronizing with /home/travis/build/ocaml/opam-repository
Updating ~/.opam/repo/compiler-index ...
Updating ~/.opam/compilers/ ...
Updating ~/.opam/repo/package-index ...
Updating ~/.opam/packages/ ...
Creating a cache of metadata in ~/.opam/state.cache ...
[ERROR] 'false' has type bool, but a env element of type string was expected.

(from the relevant Travis builds...)

-anil

