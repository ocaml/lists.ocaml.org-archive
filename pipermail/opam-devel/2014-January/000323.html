<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20%5Bocaml-platform%5D%20opam%201.1.1%20to%20be%20released%20shortly&In-Reply-To=%3C20140110174408.GA21382%40voyager%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000322.html">
   <LINK REL="Next"  HREF="000324.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly</H1>
    <B>Roberto Di Cosmo</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20%5Bocaml-platform%5D%20opam%201.1.1%20to%20be%20released%20shortly&In-Reply-To=%3C20140110174408.GA21382%40voyager%3E"
       TITLE="[opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly">roberto at dicosmo.org
       </A><BR>
    <I>Fri Jan 10 17:44:08 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000322.html">[opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
</A></li>
        <LI>Next message: <A HREF="000324.html">[opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#323">[ date ]</a>
              <a href="thread.html#323">[ thread ]</a>
              <a href="subject.html#323">[ subject ]</a>
              <a href="author.html#323">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Vsevolod,
   that's great news, a big thank you!!!

I have just sent out a request for help packaging
aspcud, mccs and packup, and now found out that you
almost finished aspcud already :-)

A couple of suggestions :

 - add a comment on <A HREF="https://github.com/ocaml/opam/issues/1074">https://github.com/ocaml/opam/issues/1074</A>
   mentioning your work on FreeBSD

 - check the patch added by Ralf in the latest version of the
   Debian aspcud package to ensure backwards compatibility of
   the optimization criteria supported by the latest aspcud
   with the legacy criteria supported by the other solvers...
   this basically boils down to adding a few lines to the 
   aspcud bash shell to use a short sed file and convert the
   old criteria in the new language supported by the latest
   aspcud... you'll find attached the modified aspcud and the
   sed file from the Debian package

 - once this is done, you can try to run opam and check whether
   all works fine... it looks for aspcud using &quot;which aspcud&quot;

All the best

--
Roberto
   

On Fri, Jan 10, 2014 at 04:39:51PM +0000, Vsevolod Stakhov wrote:
&gt;<i> JFYI, I have ported aspcud to FreeBSD today (together with gringo and
</I>&gt;<i> clasp). It seems to be working with some test cudf files.
</I>&gt;<i> 
</I>&gt;<i> The most tricky patch was to enable support of the libc++ from LLVM, but
</I>&gt;<i> I hopefully have managed it.
</I>&gt;<i> 
</I>&gt;<i> On 10/01/14 09:59, Anil Madhavapeddy wrote:
</I>&gt;<i> &gt; On 10 Jan 2014, at 07:34, Roberto Di Cosmo &lt;<A HREF="http://lists.ocaml.org/listinfo/opam-devel">roberto at dicosmo.org</A>&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;&gt; Considering the time frame, and the fact that this kind of issues is
</I>&gt;<i> &gt;&gt; going to come up more and more over time, I do understand that we need
</I>&gt;<i> &gt;&gt; a quicker solution, and the best thing is to ask for help with this 
</I>&gt;<i> &gt;&gt; among our friends OCamlrs...
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If someone could point me to what to port, I'd be happy to take a look
</I>&gt;<i> &gt; at OpenBSD and Homebrew ports. I'm CCing Vsevolod who has been interested
</I>&gt;<i> &gt; in a FreeBSD port of aspcud for their new package managers.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; What are the differences between the 'paranoid', 'basic' and 'full' user
</I>&gt;<i> &gt; tracks on their website, and does it affect OPAM?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -anil
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Vsevolod Stakhov
</I>
-- 
Roberto Di Cosmo
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: <A HREF="http://lists.ocaml.org/listinfo/opam-devel">roberto at dicosmo.org</A>
Universite Paris Diderot WWW  : <A HREF="http://www.dicosmo.org">http://www.dicosmo.org</A>
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: <A HREF="http://identi.ca/rdicosmo">http://identi.ca/rdicosmo</A>
FRANCE.                  Twitter: <A HREF="http://twitter.com/rdicosmo">http://twitter.com/rdicosmo</A>
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      <A HREF="http://www.gnu.org/philosophy/no-word-attachments.html">http://www.gnu.org/philosophy/no-word-attachments.html</A>
------------------------------------------------------------------
Office location:
 
Bureau 3020 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        
-------------- next part --------------
# new -&gt; count(new)
# removed -&gt; count(removed)
# changed -&gt; count(changed)
# notuptodate -&gt; notuptodate(solution)
# unsat_recommends -&gt; unsat_recommends(solution)
# sum(name) -&gt; sum(name,solution)

s/\([+-]\)\(new\|removed\|changed\)/\1count(\2)/g
s/\([+-]\)\(notuptodate\|unsat_recommends\)\([^(]\|$\)/\1\2(solution)\3/g
s/\([+-]\)sum(\([a-z]*\))/\1sum(\2,solution)/g
-------------- next part --------------
#!/bin/bash

clasp_bin=clasp
unclasp_bin=unclasp
gringo_bin=gringo
cudf2lp_bin=/usr/lib/aspcud/bin/cudf2lp
sharedir=/usr/share/aspcud

trendycriterion=&quot;-count(removed),-notuptodate(solution),-unsat_recommends(solution),-count(new)&quot;

if [[ $3 == trendy ]]; then
    criterion=$trendycriterion;
else
    criterion=`sed -f /usr/share/aspcud/misc11-to-misc12 &lt;&lt;&lt; $3`
fi

function enc()
{
	for x in &quot;.&quot; &quot;$sharedir/encodings&quot;; do
		[[ -e &quot;$x/$1&quot; ]] &amp;&amp; { echo &quot;$x/$1&quot;; return 0; }
	done
	echo &quot;$x&quot;
	return 1
}

function cleanup()
{
	[[ -d &quot;$tmp&quot; ]] &amp;&amp; rm -rf &quot;$tmp&quot;
}

function die()
{
	echo &quot;error: $1&quot; &gt;&amp;2
	exit 0
}

function usage()
{
	echo &quot;Usage: ${0} [OPTION]... CUDFIN CUDFOUT [CRITERIA]&quot;
	echo &quot;  -h       print this help&quot;
	echo &quot;  -c OPT   append clasp option OPT&quot;
	echo &quot;  -e ENC   append encoding ENC&quot;
	echo &quot;  -p OPT   append cudf2lp option OPT&quot;
	echo &quot;  -s SOL   choose solver {clasp,unclasp}&quot;
	echo
	echo &quot;Default commandline for clasp:&quot;
	echo -n &quot;$(basename &quot;${0}&quot;)&quot;
	for x in &quot;${clasp_opts_def[@]}&quot;;  do
		echo &quot; \\&quot;
		echo -n &quot;    -c $x&quot;
	done
	for x in &quot;${gringo_opts_def[@]}&quot;;  do
		echo &quot; \\&quot;
		echo -n &quot;    -e $x&quot;
	done
	echo
	echo
	echo &quot;Default commandline for unclasp:&quot;
	echo -n &quot;$(basename &quot;${0}&quot;)&quot;
	for x in &quot;${unclasp_opts_def[@]}&quot;;  do
		echo &quot; \\&quot;
		echo -n &quot;    -c $x&quot;
	done
	for x in &quot;${ungringo_opts_def[@]}&quot;;  do
		echo &quot; \\&quot;
		echo -n &quot;    -e $x&quot;
	done
	echo
}

base=&quot;$(dirname &quot;$(readlink -f &quot;$0&quot;)&quot;)&quot;
PATH=&quot;.:$base:$base/../build/release/bin:$PATH&quot;

# default options
solver=&quot;&quot;
clasp_opts_def=( &quot;--opt-heu=1&quot; &quot;--sat-prepro&quot; &quot;--restarts=L,128&quot; &quot;--heuristic=VSIDS&quot; &quot;--opt-hierarch=1&quot; &quot;--local-restarts&quot; &quot;--del-max=200000,250&quot; )
unclasp_opts_def=( )
gringo_opts_def=( &quot;$(enc misc2012.lp)&quot; )
ungringo_opts_def=( &quot;$(enc misc2012.lp)&quot; )

cudf_opts=( )
clasp_opts=( )
gringo_opts=( )

unset wrapper_out
unset tmp

while getopts &quot;hc:e:p:s:&quot; flag
do
	case &quot;$flag&quot; in
		&quot;e&quot;) gringo_opts=( &quot;${gringo_opts[@]}&quot; &quot;$(enc &quot;$OPTARG&quot;)&quot; ) ;;
		&quot;c&quot;) clasp_opts=( &quot;${clasp_opts[@]}&quot; &quot;$OPTARG&quot; ) ;;
		&quot;p&quot;) cudf_opts=( &quot;${cudf_opts[@]}&quot; &quot;$OPTARG&quot; ) ;;
		&quot;s&quot;) solver=&quot;$OPTARG&quot; ;;
		&quot;h&quot;) usage; exit 0 ;;
		&quot;?&quot;) exit 1 ;;
	esac
done

shift $((OPTIND-1))

if [[ -z ${solver} ]]; then
	if echo $(basename &quot;$0&quot;) | grep -q &quot;aspuncud&quot;; then
		solver=&quot;unclasp&quot;
	elif echo $(basename &quot;$0&quot;) | grep -q &quot;aspcud&quot;; then
		solver=&quot;clasp&quot;
	fi
fi

case &quot;${solver}&quot; in 
	clasp)
		solver_bin=&quot;${clasp_bin}&quot;
		clasp_opts_implicit=( &quot;--stats=2&quot; &quot;--quiet=1,2&quot; )
		;;
	unclasp)
		clasp_opts_def=( &quot;${unclasp_opts_def[@]}&quot; )
		gringo_opts_def=( &quot;${ungringo_opts_def[@]}&quot; )
		solver_bin=&quot;${unclasp_bin}&quot;
		clasp_opts_implicit=( &quot;--stats&quot; )
		;;
	*)
		die &quot;error: solver clasp or unclasp expected&quot;
		;;
esac

[[ ${#clasp_opts[*]} -eq 0 ]] &amp;&amp; clasp_opts=( &quot;${clasp_opts_def[@]}&quot; )
[[ ${#gringo_opts[*]} -eq 0 ]] &amp;&amp; gringo_opts=( &quot;${gringo_opts_def[@]}&quot; )
clasp_opts=( &quot;${clasp_opts[@]}&quot; &quot;${clasp_opts_implicit[@]}&quot; )

if [[ $# -eq 3 ]]; then
	cudf_opts=( &quot;${cudf_opts[@]}&quot; &quot;-c&quot; &quot;$criterion&quot; )
elif echo $(basename &quot;$0&quot;) | grep -q &quot;paranoid&quot;; then
	[[ $# -ne 2 ]] &amp;&amp; { die &quot;error: exactly two arguments expected&quot;; }
	cudf_opts=( &quot;${cudf_opts[@]}&quot; &quot;-c&quot; &quot;paranoid&quot; )
else
	die &quot;error: exactly three arguments expected&quot;
fi

wrapper_out=&quot;$2&quot;

trap cleanup EXIT

test -n &quot;${TMPDIR}&quot; &amp;&amp; tmpdir=&quot;${TMPDIR}/&quot;
tmp=&quot;$(mktemp -d &quot;${tmpdir}outXXXXXX&quot;)&quot;

# note this is probably unecessary...
function usrtrap() {
:<i>
</I>}
trap usrtrap USR1 TERM INT

cat &lt;&lt;EOF &gt; &quot;$tmp/parse.py&quot;
#!/usr/bin/python
import signal, re, sys

def ignore(x, y): pass

signal.signal(signal.SIGUSR1, ignore)
signal.signal(signal.SIGTERM, ignore)
signal.signal(signal.SIGINT,  ignore)
signal.signal(signal.SIGPIPE, ignore)

out = open(&quot;$wrapper_out&quot;, &quot;w&quot;)

keep = False
solution = None
try:
	for line in sys.stdin:
		sys.stdout.write(line[:-1][:81])
		sys.stdout.write(&quot;\n&quot;)
		if keep: 
			solution = line
			keep = False
		if line.startswith(&quot;Answer&quot;): keep = True
except: pass

if solution == None: out.write(&quot;FAIL\n&quot;)
else:
        for m in re.finditer(r'in\\(&quot;(?P&lt;pkg&gt;[^,]+)&quot;,(?P&lt;ver&gt;[^)]+)\\)', solution):
                out.write(&quot;package: &quot; + m.group(&quot;pkg&quot;) + &quot;\\n&quot;)
                out.write(&quot;version: &quot; + m.group(&quot;ver&quot;) + &quot;\\n&quot;)
                out.write(&quot;installed: true\\n\\n&quot;)
out.close()

sys.stdout.write(open(&quot;$tmp/clasp_err&quot;).read())
sys.stdout.write(open(&quot;$tmp/gringo_err&quot;).read())
sys.stdout.write(open(&quot;$tmp/cudf_err&quot;).read())
EOF
chmod +x &quot;$tmp/parse.py&quot;

&quot;${cudf2lp_bin}&quot; &quot;${cudf_opts[@]}&quot;   &gt; &quot;$tmp/cudf_out&quot;   2&gt; &quot;$tmp/cudf_err&quot;   &lt; &quot;$1&quot;
&quot;${gringo_bin}&quot;  &quot;${gringo_opts[@]}&quot; &gt; &quot;$tmp/gringo_out&quot; 2&gt; &quot;$tmp/gringo_err&quot; &quot;$tmp/cudf_out&quot;
&quot;${solver_bin}&quot;  &quot;${clasp_opts[@]}&quot;                      2&gt; &quot;$tmp/clasp_err&quot;  &quot;$tmp/gringo_out&quot; | &quot;$tmp/parse.py&quot;

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000322.html">[opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
</A></li>
	<LI>Next message: <A HREF="000324.html">[opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#323">[ date ]</a>
              <a href="thread.html#323">[ thread ]</a>
              <a href="subject.html#323">[ subject ]</a>
              <a href="author.html#323">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
