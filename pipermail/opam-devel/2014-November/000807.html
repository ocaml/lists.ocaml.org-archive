<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] opam pinning to local repo
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20opam%20pinning%20to%20local%20repo&In-Reply-To=%3C271A7AE078FE4681B68DCFE2CBD86F8B%40erratique.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000806.html">
   <LINK REL="Next"  HREF="000808.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] opam pinning to local repo</H1>
    <B>Daniel B&#252;nzli</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20opam%20pinning%20to%20local%20repo&In-Reply-To=%3C271A7AE078FE4681B68DCFE2CBD86F8B%40erratique.ch%3E"
       TITLE="[opam-devel] opam pinning to local repo">daniel.buenzli at erratique.ch
       </A><BR>
    <I>Mon Nov 17 12:06:38 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000806.html">[opam-devel] opam pinning to local repo
</A></li>
        <LI>Next message: <A HREF="000808.html">[opam-devel] opam pinning to local repo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#807">[ date ]</a>
              <a href="thread.html#807">[ thread ]</a>
              <a href="subject.html#807">[ subject ]</a>
              <a href="author.html#807">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Le lundi, 17 novembre 2014 &#224; 12:15, Thomas Leonard a &#233;crit :
&gt;<i> I'd prefer a third option: use the files as they are in the working
</I>&gt;<i> directory, but only those tracked by git. I often get bitten by opam
</I>&gt;<i> copying untracked files (e.g. setup.data, setup.log, previous build
</I>&gt;<i> artifacts) and giving strange results.
</I>&gt;<i>  
</I>&gt;<i> I use the copy-if-tracked system when editing on my desktop but
</I>&gt;<i> compiling on my cubieboard and it works well. You just have to
</I>&gt;<i> remember to &quot;git add&quot; any new files... but that's a useful check
</I>&gt;<i> anyway.
</I>&gt;<i>  
</I>&gt;<i> (BTW, you can easily snapshot the current tracked files without
</I>&gt;<i> changing anything with &quot;git stash create&quot;, which outputs an anonymous
</I>&gt;<i> commit ID if there are any changes relative to HEAD)
</I>
That's an interesting middle ground we didn't think about when we had the discussion about this [1]. While I was firmly (and still am) opposed to path pins because of the problems you mention, I do have to agree that having to commit/amend commit on my git-pins, which is what I do now, is sometimes painful. So you'd suggest something like rsync directory state in opam's build dir then:

git stash save -u
git clean -fxd
git checkout .
git stash pop  

Note that with the above procedure you don't have to `git add` untracked files, it relies on your .gitignore. If you prefer the (maybe safer) behaviour you suggest, remove the -u from the first command.  

Regarding the `git stash create` id for the watermark I am not very fond of that since by being anonymous it doesn't give me any context and/or useful information, I think I'd prefer the short last commit ID with -dirty appended.  

Best,

Daniel

[1] <A HREF="https://github.com/ocaml/opam/issues/1555">https://github.com/ocaml/opam/issues/1555</A>


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000806.html">[opam-devel] opam pinning to local repo
</A></li>
	<LI>Next message: <A HREF="000808.html">[opam-devel] opam pinning to local repo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#807">[ date ]</a>
              <a href="thread.html#807">[ thread ]</a>
              <a href="subject.html#807">[ subject ]</a>
              <a href="author.html#807">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
