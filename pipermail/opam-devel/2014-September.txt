From louis.gesbert at ocamlpro.com  Mon Sep  1 09:26:18 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Mon, 01 Sep 2014 10:26:18 +0200
Subject: [opam-devel] the available field in 1.1.1
In-Reply-To: <8F21FD8A-761D-4421-934F-3B29872D0158@recoil.org>
References: <27B936A1-BEE7-4EE6-8699-D6D287735EFB@recoil.org>
 <696D4FEC-3D30-4928-B9F0-00118EBF261D@recoil.org>
 <8F21FD8A-761D-4421-934F-3B29872D0158@recoil.org>
Message-ID: <1538046.YGuxGQMm4E@agaric>

Now checking the --strict in 1.2 and syntax in 1.1

Le dimanche 31 ao?t 2014, 15:11:49 Anil Madhavapeddy a ?crit :
> On 31 Aug 2014, at 15:03, Anil Madhavapeddy <anil at recoil.org> wrote:
> 
> > On 31 Aug 2014, at 13:35, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
> > 
> >>>> +available: [ !preinstalled & ocaml-version = "4.02.0" ]
> >>>> 
> >>>> This works fine OPAM 1.2, but OPAM 1.1.1 complains with a parse error.  Is there
> >>>> anything that'll work for both?
> >>> 
> >>> The parser in 1.1.1 was a bit dumb, you need to add parenthesis:
> >>> 
> >>> available: [ !preinstalled & (ocaml-version = "4.02.0")
> >>> ]
> >> 
> >> Actually, 1.1.1 parser is very broken ... You should use:
> >> [ (preinstalled = false) & (ocaml-version = "4.02.0") ]
> > 
> > Thanks, this is now pushed and building in the pull request (along with a help message to point people at camlp4 binaries).
> 
> Can't get this to work, see below for two attempts:
> 
> +available: [ (preinstalled = "false") & (ocaml-version = "4.02.0") ]
> To Build:
> atdgen
> camlp4
> build one: atdgen
> default    Synchronizing with /home/travis/build/ocaml/opam-repository
> Updating ~/.opam/repo/compiler-index ...
> Updating ~/.opam/compilers/ ...
> Updating ~/.opam/repo/package-index ...
> Updating ~/.opam/packages/ ...
> Creating a cache of metadata in ~/.opam/state.cache ...
> [ERROR] 'preinstalled' has type bool, but a env element of type string was expected.
> 
> +available: [ (preinstalled = false) & (ocaml-version = "4.02.0") ]
> To Build:
> atdgen
> camlp4
> build one: atdgen
> default    Synchronizing with /home/travis/build/ocaml/opam-repository
> Updating ~/.opam/repo/compiler-index ...
> Updating ~/.opam/compilers/ ...
> Updating ~/.opam/repo/package-index ...
> Updating ~/.opam/packages/ ...
> Creating a cache of metadata in ~/.opam/state.cache ...
> [ERROR] 'false' has type bool, but a env element of type string was expected.
> 
> (from the relevant Travis builds...)
> 
> -anil
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140901/7317340f/attachment.html>

From gesbert at antislash.info  Mon Sep  1 10:00:39 2014
From: gesbert at antislash.info (Louis Gesbert)
Date: Mon, 01 Sep 2014 11:00:39 +0200
Subject: [opam-devel] the available field in 1.1.1
In-Reply-To: <8F21FD8A-761D-4421-934F-3B29872D0158@recoil.org>
References: <27B936A1-BEE7-4EE6-8699-D6D287735EFB@recoil.org>
 <696D4FEC-3D30-4928-B9F0-00118EBF261D@recoil.org>
 <8F21FD8A-761D-4421-934F-3B29872D0158@recoil.org>
Message-ID: <22028655.FUmumUUhJ0@agaric>

Don't ask me why, but you can get it working with

available: [ ("%{preinstalled}%" = "false") & (ocaml-version = "4.02.0") ]

glad I rewrote the parser since then :)

Le dimanche 31 ao?t 2014, 15:11:49 Anil Madhavapeddy a ?crit :
> On 31 Aug 2014, at 15:03, Anil Madhavapeddy <anil at recoil.org> wrote:
> 
> > On 31 Aug 2014, at 13:35, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
> > 
> >>>> +available: [ !preinstalled & ocaml-version = "4.02.0" ]
> >>>> 
> >>>> This works fine OPAM 1.2, but OPAM 1.1.1 complains with a parse error.  Is there
> >>>> anything that'll work for both?
> >>> 
> >>> The parser in 1.1.1 was a bit dumb, you need to add parenthesis:
> >>> 
> >>> available: [ !preinstalled & (ocaml-version = "4.02.0")
> >>> ]
> >> 
> >> Actually, 1.1.1 parser is very broken ... You should use:
> >> [ (preinstalled = false) & (ocaml-version = "4.02.0") ]
> > 
> > Thanks, this is now pushed and building in the pull request (along with a help message to point people at camlp4 binaries).
> 
> Can't get this to work, see below for two attempts:
> 
> +available: [ (preinstalled = "false") & (ocaml-version = "4.02.0") ]
> To Build:
> atdgen
> camlp4
> build one: atdgen
> default    Synchronizing with /home/travis/build/ocaml/opam-repository
> Updating ~/.opam/repo/compiler-index ...
> Updating ~/.opam/compilers/ ...
> Updating ~/.opam/repo/package-index ...
> Updating ~/.opam/packages/ ...
> Creating a cache of metadata in ~/.opam/state.cache ...
> [ERROR] 'preinstalled' has type bool, but a env element of type string was expected.
> 
> +available: [ (preinstalled = false) & (ocaml-version = "4.02.0") ]
> To Build:
> atdgen
> camlp4
> build one: atdgen
> default    Synchronizing with /home/travis/build/ocaml/opam-repository
> Updating ~/.opam/repo/compiler-index ...
> Updating ~/.opam/compilers/ ...
> Updating ~/.opam/repo/package-index ...
> Updating ~/.opam/packages/ ...
> Creating a cache of metadata in ~/.opam/state.cache ...
> [ERROR] 'false' has type bool, but a env element of type string was expected.
> 
> (from the relevant Travis builds...)
> 
> -anil
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140901/5d1b5eaa/attachment-0001.html>

From agarwal1975 at gmail.com  Mon Sep  1 13:57:01 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Mon, 1 Sep 2014 08:57:01 -0400
Subject: [opam-devel] "ocaml_beginners"::[] Opam issues "[ERROR]
 Multiple versions installed ..."
In-Reply-To: <20140901052010.GA32675@s70206.gridserver.com>
References: <20140828005146.GA23538@s70206.gridserver.com>
 <CAMu2m2+umRfAnRhL+Y4f26LEXJXwgcSQE9zqanx7sbfETeHs_Q@mail.gmail.com>
 <20140901052010.GA32675@s70206.gridserver.com>
Message-ID: <CAMu2m2Ln_w2PJzjKFb_z8tp68GbERxOP4cw5zdk_YnMKRZ548g@mail.gmail.com>

I don't know, but I'm cc'ing the opam mailing list as you may get a better
response there.


On Mon, Sep 1, 2014 at 1:20 AM, John Magolske listmail at b79.net
[ocaml_beginners] <ocaml_beginners at yahoogroups.com> wrote:

>
>
> Hi,
>
> * Ashish Agarwal agarwal1975 at gmail.com [ocaml_beginners] <
> ocaml_beginners at yahoogroups.com> [140828 07:38]:
>
> >
> > > I've been using opam for a few months now
> >
> > A lot has changed over this time. It might be worth a fresh install.
> > Do rm -rf ~/.opam. There's also a new pre-release of opam out, so
> > you might as well use the newer version.
>
> I'd been doing `opam update && opam upgrade` somewhat regularly over
> this time, under the impression this keeps things up-to-date similar
> to how `aptitude update && aptitude dist-upgrade` works with Debian
> (this is on Debian Sid BTW). And this had been upgrading things nicely
> without error until recently.
>
> In any case, I reinstalled from scratch as suggested and everything
> installed without error. Then, running `opam update -u` installed
> base-threads.base, base-bigarray.base & base-unix.base ... running
> `opam update -u` again, opam claimed to unstall those 3 packages
> again. Seems as though these packages never really get installed no
> matter how many times `opam update -u` is run.
>
> Next I did `opam install ocp-indent merlin utop`, which installed
> these packages without error, and utop worked fine. Then, running
> `opam update -u` failed with errors (see below) that left utop in an
> unusable state, throwing up the error:
>
> Fatal error: exception Fl_package_base.No_such_package("unix", "")
>
> Below I've pasted output from the above mentioned sequence of commands.
> Next I'll try the more recent version of opam to see if that helps,
> but not seeing any bugs listed for 1.1.1 here:
> https://bugs.debian.org/cgi-bin/pkgreport.cgi?src=opam
> I'm wondering if I might be coming up against some other other issues.
>
> Regards,
>
> John
>
> ~~~
>
> % rm -rf ~/.opam
> % sudo aptitude install opam #(opam 1.1.1 was already installed)
> % opam --version
> 1.1.1
> % opam init --comp=4.01.0
>
> [... many lines of complilation output ...]
>
> ... If you agree, OPAM will modify:
>
> - ~/.zshrc (or a file you specify) to set the right environment
> variables and to load the auto-completion scripts for your shell (zsh)
> on startup. Specifically, it checks for and appends the following line:
>
> . ~/.opam/opam-init/init.sh > /dev/null 2> /dev/null || true
>
> - ~/.ocamlinit to ensure that non-system installations of `ocamlfind`
> (i.e. those installed by OPAM) will work correctly when running the
> OCaml toplevel. It does this by adding $OCAML_TOPLEVEL_PATH to the list
> of include directories.
> ...
>
> Do you want OPAM to modify ~/.zshrc and ~/.ocamlinit?
> (default is 'no', use 'f' to name a file other than ~/.zshrc)
> [N/y/f] y
>
> User configuration:
> ~/.ocamlinit is already up-to-date.
> ~/.zshrc is already up-to-date.
> Global configuration:
> Updating ~/.opam/opam-init/init.sh
> auto-completion : [true]
> opam-switch-eval: [true]
> Updating ~/.opam/opam-init/init.zsh
> auto-completion : [true]
> opam-switch-eval: [true]
> Updating ~/.opam/opam-init/init.csh
> auto-completion : [true]
> opam-switch-eval: [true]
>
> % opam update -u
> default Downloading https://opam.ocaml.org/urls.txt
> Downloading https://opam.ocaml.org/repo
>
> Updating ~/.opam/repo/compiler-index ...
> Updating ~/.opam/compilers/ ...
> Updating ~/.opam/repo/package-index ...
> Updating ~/.opam/packages/ ...
> Updating the cache of metadata (~/.opam/state.cache) ...
> 3 to install | 0 to reinstall | 0 to upgrade | 0 to downgrade | 0 to remove
> You can now run 'opam upgrade' to upgrade your system.
> The following actions will be performed:
> - install base-threads.base
>
> - install base-bigarray.base
> - install base-unix.base
> 3 to install | 0 to reinstall | 0 to upgrade | 0 to downgrade | 0 to remove
>
> =-=-= Installing base-bigarray.base =-=-=
> Installing base-bigarray.base.
>
> =-=-= Installing base-threads.base =-=-=
> Installing base-threads.base.
>
> =-=-= Installing base-unix.base =-=-=
> Installing base-unix.base.
> opam update -u 35.00s user 2.27s system 95% cpu 39.197 total
>
> % opam update -u
> default Downloading https://opam.ocaml.org/urls.txt
>
> Updating ~/.opam/repo/compiler-index ...
> Updating ~/.opam/compilers/ ...
> Updating ~/.opam/repo/package-index ...
> Updating ~/.opam/packages/ ...
> Updating the cache of metadata (~/.opam/state.cache) ...
> 3 to install | 0 to reinstall | 0 to upgrade | 0 to downgrade | 0 to remove
> You can now run 'opam upgrade' to upgrade your system.
> The following actions will be performed:
> - install base-threads.base
>
> - install base-bigarray.base
> - install base-unix.base
> 3 to install | 0 to reinstall | 0 to upgrade | 0 to downgrade | 0 to remove
>
> =-=-= Installing base-bigarray.base =-=-=
> Installing base-bigarray.base.
>
> =-=-= Installing base-threads.base =-=-=
> Installing base-threads.base.
>
> =-=-= Installing base-unix.base =-=-=
> Installing base-unix.base.
> opam update -u 34.70s user 2.38s system 96% cpu 38.499 total
>
> % opam install ocp-indent merlin utop
> [ these installed fine, without error ]
>
> % opam update -u
> default Downloading https://opam.ocaml.org/urls.txt
>
> Updating ~/.opam/repo/compiler-index ...
> Updating ~/.opam/compilers/ ...
> Updating ~/.opam/repo/package-index ...
> Updating ~/.opam/packages/ ...
> The following packages have been UPDATED upstream:
> - biniou.1.0.9
> - camlp4.4.01.0
> - camomile.0.8.5
> - cmdliner.0.9.5
> - cppo.0.9.4
> - easy-format.1.0.2
> - lambda-term.1.6
> - lwt.2.4.5
> - menhir.20130912
> - merlin.1.7.1
> - ocp-build.1.99.8-beta
> - ocp-indent.1.4.2
> - react.1.2.0
> - utop.1.15
> - yojson.1.1.8
> - zed.1.3
>
> Updating the cache of metadata (~/.opam/state.cache) ...
> 20 to install | 0 to reinstall | 0 to upgrade | 0 to downgrade | 0 to
> remove
>
> You can now run 'opam upgrade' to upgrade your system.
> The following actions will be performed:
> - install base-threads.base [required by utop]
> - install ocamlfind.1.5.2 [required by merlin, ocp-indent, utop]
>
> - install base-bigarray.base
> - install base-unix.base [required by utop]
> - install camlp4.4.01.0 [required by ocp-indent, utop]
> - install react.1.2.0 [required by utop]
>
> - install menhir.20130912 [required by merlin]
> - install easy-format.1.0.2 [required by merlin]
> - install cppo.0.9.4 [required by merlin]
> - install cmdliner.0.9.5 [required by ocp-indent]
> - install ocp-build.1.99.8-beta [required by ocp-indent]
>
> - install camomile.0.8.5 [required by utop]
> - install lwt.2.4.5 [required by utop]
> - install biniou.1.0.9 [required by merlin]
> - install ocp-indent.1.4.2
>
> - install zed.1.3 [required by utop]
> - install yojson.1.1.8 [required by merlin]
> - install lambda-term.1.6 [required by utop]
> - install merlin.1.7.1
> - install utop.1.15
> 20 to install | 0 to reinstall | 0 to upgrade | 0 to downgrade | 0 to
> remove
>
>
> =-=-= Installing base-bigarray.base =-=-=
> Installing base-bigarray.base.
>
> =-=-= Installing base-threads.base =-=-=
> Installing base-threads.base.
>
> =-=-= Installing base-unix.base =-=-=
> Installing base-unix.base.
>
> =-=-= Installing camlp4.4.01.0 =-=-=
> Installing camlp4.4.01.0.
>
> =-=-= Installing ocamlfind.1.5.2 =-=-=
> Building ocamlfind.1.5.2:
> ./configure -bindir /home/jm/.opam/4.01.0/bin -sitelib
> /home/jm/.opam/4.01.0/lib -mandir /home/jm/.opam/4.01.0/man -config
> /home/jm/.opam/4.01.0/lib/findlib.conf
> make all
> make opt
> make install
> [ERROR] The compilation of ocamlfind.1.5.2 failed.
> Removing ocamlfind.1.5.2.
> ocamlfind remove bytes
>
> ./configure -bindir /home/jm/.opam/4.01.0/bin -sitelib
> /home/jm/.opam/4.01.0/lib -mandir /home/jm/.opam/4.01.0/man -config
> /home/jm/.opam/4.01.0/lib/findlib.conf
> make uninstall
>
> [ERROR] Due to some errors while processing ocamlfind.1.5.2, the following
> actions will NOT proceed:
> - install merlin.1.7.1
> - install menhir.20130912
> - install lambda-term.1.6
> - install biniou.1.0.9
> - install utop.1.15
> - install lwt.2.4.5
> - install zed.1.3
> - install cppo.0.9.4
> - install camomile.0.8.5
> - install ocp-indent.1.4.2
> - install yojson.1.1.8
> - install ocp-build.1.99.8-beta
> - install react.1.2.0
> - install easy-format.1.0.2
> - install cmdliner.0.9.5
>
> ===== ERROR while installing ocamlfind.1.5.2 =====
> # opam-version 1.1.1
> # os linux
> # command make install
> # path /home/jm/.opam/4.01.0/build/ocamlfind.1.5.2
> # compiler 4.01.0
> # exit-code 2
> # env-file
> /home/jm/.opam/4.01.0/build/ocamlfind.1.5.2/ocamlfind-798-9ace5e.env
> # stdout-file
> /home/jm/.opam/4.01.0/build/ocamlfind.1.5.2/ocamlfind-798-9ace5e.out
> # stderr-file
> /home/jm/.opam/4.01.0/build/ocamlfind.1.5.2/ocamlfind-798-9ace5e.err
> ### stdout ###
> # ...[truncated]
> # cd "/home/jm/.opam/4.01.0/lib/ocaml/compiler-libs/"; \
> # cp topdirs.cmi toploop.cmi "/home/jm/.opam/4.01.0/lib/findlib/"; \
> # fi
> # make[1]: Leaving directory
> '/home/jm/.opam/4.01.0/build/ocamlfind.1.5.2/src/findlib'
> # make[1]: Entering directory
> '/home/jm/.opam/4.01.0/build/ocamlfind.1.5.2/src/bytes'
> # ocamlbuild -classic-display -no-links bytes.cmi bytes.cma
> # cd _build/ && ocamlfind install bytes ../META bytes.cmi bytes.cma
> -optional bytes.cmx bytes.a bytes.cmxa bytes.cmxs
> # Makefile:22: recipe for target 'install' failed
> # make[1]: Leaving directory
> '/home/jm/.opam/4.01.0/build/ocamlfind.1.5.2/src/bytes'
> # Makefile:20: recipe for target 'install' failed
> ### stderr ###
> # Makefile:150: depend: No such file or directory
> # ocamlfind: Package bytes is already installed
> # - (file /home/jm/.opam/4.01.0/lib/bytes/META already exists)
> # make[1]: *** [install] Error 2
> # make: *** [install] Error 2
>
>
> 'opam update -u' failed.
>
> --
> John Magolske
> http://B79.net/contact
>
>  __._,_.___
>   ------------------------------
> Posted by: John Magolske <listmail at b79.net>
> ------------------------------
>     Reply via web post
> <https://groups.yahoo.com/neo/groups/ocaml_beginners/conversations/messages/14105;_ylc=X3oDMTJxMzJyamh2BF9TAzk3MzU5NzE0BGdycElkAzQ5OTkxOTQEZ3Jwc3BJZAMxNzA1MDA2NzY0BG1zZ0lkAzE0MTA1BHNlYwNmdHIEc2xrA3JwbHkEc3RpbWUDMTQwOTU0ODgxMw--?act=reply&messageNum=14105>
> ?  Reply to sender
> <listmail at b79.net?subject=Re%3A%20%22ocaml_beginners%22%3A%3A%5B%5D%20Opam%20issues%20%22%5BERROR%5D%20Multiple%20versions%20installed%20%2E%2E%2E%22>
> ?  Reply to group
> <ocaml_beginners at yahoogroups.com?subject=Re%3A%20%22ocaml_beginners%22%3A%3A%5B%5D%20Opam%20issues%20%22%5BERROR%5D%20Multiple%20versions%20installed%20%2E%2E%2E%22>
> ? Start a New Topic
> <https://groups.yahoo.com/neo/groups/ocaml_beginners/conversations/newtopic;_ylc=X3oDMTJlNDhwdjA1BF9TAzk3MzU5NzE0BGdycElkAzQ5OTkxOTQEZ3Jwc3BJZAMxNzA1MDA2NzY0BHNlYwNmdHIEc2xrA250cGMEc3RpbWUDMTQwOTU0ODgxMw-->
> ? Messages in this topic
> <https://groups.yahoo.com/neo/groups/ocaml_beginners/conversations/topics/14102;_ylc=X3oDMTM2azFuZXBrBF9TAzk3MzU5NzE0BGdycElkAzQ5OTkxOTQEZ3Jwc3BJZAMxNzA1MDA2NzY0BG1zZ0lkAzE0MTA1BHNlYwNmdHIEc2xrA3Z0cGMEc3RpbWUDMTQwOTU0ODgxMwR0cGNJZAMxNDEwMg-->
> (3)
>  Archives up to December 31, 2011 are also downloadable at
> http://www.connettivo.net/cntprojects/ocaml_beginners
> The archives of the very official ocaml list (the seniors' one) can be
> found at http://caml.inria.fr
> Attachments are banned and you're asked to be polite, avoid flames etc.
>  Visit Your Group
> <https://groups.yahoo.com/neo/groups/ocaml_beginners/info;_ylc=X3oDMTJldXB1azloBF9TAzk3MzU5NzE0BGdycElkAzQ5OTkxOTQEZ3Jwc3BJZAMxNzA1MDA2NzY0BHNlYwN2dGwEc2xrA3ZnaHAEc3RpbWUDMTQwOTU0ODgxMw-->
>
>
>  [image: Yahoo! Groups]
> <https://groups.yahoo.com/neo;_ylc=X3oDMTJkY244OGNmBF9TAzk3MzU5NzE0BGdycElkAzQ5OTkxOTQEZ3Jwc3BJZAMxNzA1MDA2NzY0BHNlYwNmdHIEc2xrA2dmcARzdGltZQMxNDA5NTQ4ODEz>
> ? Privacy <https://info.yahoo.com/privacy/us/yahoo/groups/details.html> ?
> Unsubscribe
> <ocaml_beginners-unsubscribe at yahoogroups.com?subject=Unsubscribe> ? Terms
> of Use <https://info.yahoo.com/legal/us/yahoo/utos/terms/>
>
>    .
>
>  __,_._,___
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140901/3eb5a918/attachment-0001.html>

From anil at recoil.org  Mon Sep  8 21:23:23 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Mon, 8 Sep 2014 21:23:23 +0100
Subject: [opam-devel] OCaml/OPAM PPAs updated: now with armhf and OPAM 1.2.0
Message-ID: <E338CFC4-B207-4DFC-8F32-195B4211CC55@recoil.org>

Some updates to the binary packages used by all the Travis tests:

- The Ubuntu launchpad folk kindly upgraded my account to support
  ARM builds, and so the various PPA combinations now include armhf
  binaries, which should greatly help save build times there.
  See: https://launchpad.net/~avsm/ for all the combinations of PPAs.

- Added PPAs for the OCaml 4.02 and OPAM 1.2.0 combinations, up to
  the latest OPAM snapshot today.  When's the OPAM 1.2.x branch
  going to be created, Louis?  I can call the packages 1.2.0 then.

- Added binary packages for camlp4 as well, so that it remains a
  system package.  The (rather hacked up) Debian package for this
  is in the experimental/master branch at:
    https://github.com/avsm/camlp4

Enjoy!  If there are no problems with these, I'll be blogging about
it for the opam.ocaml.org site when I get a chance so they are
seen more widely.

-anil

From yminsky at janestreet.com  Tue Sep  9 03:08:09 2014
From: yminsky at janestreet.com (Yaron Minsky)
Date: Mon, 8 Sep 2014 22:08:09 -0400
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
Message-ID: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>

Apologies for the following bits of emacs nonsense.

Sadly, I think that opam 1.2 has broken the emacs configuration that I
documented here:

https://github.com/realworldocaml/book/wiki/Installation-Instructions#emacs

I'm looking for advice as to how to fix things.  It has to do with how
paths are set up.  Emacs for the mac has the annoying property of not
propagating ordinary shell settings.  Instead what I did was this:

;; -- Tweaks for OS X -------------------------------------
;; Tweak for problem on OS X where Emacs.app doesn't run the right
;; init scripts when invoking a sub-shell
(cond
 ((eq window-system 'ns) ; macosx
  ;; Invoke login shells, so that .profile or .bash_profile is read
  (setq shell-command-switch "-lc")))

This caused the .profile to get run again on every incoming shell.
This has the property of rerunning "eval `opam config env`".  That
used to work because opam would throw its entries on the path when it
ran.  But I believe opam has been changed to not re-add entries when
they're already there.  This means that when you run the shell with
"-lc", it redumps the entries from /etc/paths on top, thus shadowing
the opam entries.

We could change opam 1.2 so that instead of not adding entries when
they're already there, it instead deletes the old version of the entry
and re-adds it to the top.  Or we could come up with a more principled
emacs-on-the-mac setup, but I can't quite figure out a good way of
doing that.

Thoughts on how to fix this are very welcome!

y

From mort at cantab.net  Tue Sep  9 10:09:34 2014
From: mort at cantab.net (Richard Mortier)
Date: Tue, 9 Sep 2014 10:09:34 +0100
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
In-Reply-To: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
References: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
Message-ID: <CAN2Hq05G7yuF+DTjbLXV2=7uBoicfYkYhSkBMsBzCSizx9nnXg@mail.gmail.com>

On 9 September 2014 03:08, Yaron Minsky <yminsky at janestreet.com> wrote:
> Apologies for the following bits of emacs nonsense.
>
> Sadly, I think that opam 1.2 has broken the emacs configuration that I
> documented here:
>
> https://github.com/realworldocaml/book/wiki/Installation-Instructions#emacs
>
> I'm looking for advice as to how to fix things.  It has to do with how
> paths are set up.  Emacs for the mac has the annoying property of not
> propagating ordinary shell settings.  Instead what I did was this:
>
> ;; -- Tweaks for OS X -------------------------------------
> ;; Tweak for problem on OS X where Emacs.app doesn't run the right
> ;; init scripts when invoking a sub-shell
> (cond
>  ((eq window-system 'ns) ; macosx
>   ;; Invoke login shells, so that .profile or .bash_profile is read
>   (setq shell-command-switch "-lc")))
>
> This caused the .profile to get run again on every incoming shell.
> This has the property of rerunning "eval `opam config env`".  That
> used to work because opam would throw its entries on the path when it
> ran.  But I believe opam has been changed to not re-add entries when
> they're already there.  This means that when you run the shell with
> "-lc", it redumps the entries from /etc/paths on top, thus shadowing
> the opam entries.

the fragment i have in my `~/.emacs`
(https://github.com/mor1/rc-files/blob/master/emacs.d/init.el) that
attempts to deal with this is:

```
;; <http://stackoverflow.com/questions/8606954/
;;    path-and-exec-path-set-but-emacs-does-not-find-executable>
(defun set-exec-path-from-shell-PATH ()
  "Set up Emacs' `exec-path' and PATH environment variable to
  match that used by the user's shell.

This is particularly useful under Mac OSX, where GUI apps are not
started from a shell."
  (interactive)
  (let ((path-from-shell
         (replace-regexp-in-string
          "[ \t\n]*$" ""
          (shell-command-to-string "$SHELL --login -i -c 'echo $PATH'"))
         ))
    (setenv "PATH" path-from-shell)
    (setq exec-path (split-string path-from-shell path-separator)))
  )
(set-exec-path-from-shell-PATH)
```

ie., extract $PATH from a shell and then set various emacs variables
accordingly. but it's hardly pleasant.

> We could change opam 1.2 so that instead of not adding entries when
> they're already there, it instead deletes the old version of the entry
> and re-adds it to the top.  Or we could come up with a more principled
> emacs-on-the-mac setup, but I can't quite figure out a good way of
> doing that.

well, encouraging emacs on the mac to propagate shell settings
properly would do it for me ;)

failing that, i like the idea of opam deleting old instances of PATH
mods and then re-adding at the front. that seems the least surprising
and tidiest option.

(probably not much help for the rwo documentation, but fwiw i got
bored of shell environment confusion a while back and wrote some shell
functions to help me keep things clean and attempt to make shell
initialisation largely idempotent; i basically never now have lines of
the form VAR=value:$VAR in any of my startup scripts.

https://github.com/mor1/rc-files/blob/master/envfns.sh
https://github.com/mor1/rc-files/blob/master/environment

)

-- 
Richard Mortier
mort at cantab.net

From yminsky at janestreet.com  Tue Sep  9 12:11:11 2014
From: yminsky at janestreet.com (Yaron Minsky)
Date: Tue, 9 Sep 2014 07:11:11 -0400
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
In-Reply-To: <CAN2Hq05G7yuF+DTjbLXV2=7uBoicfYkYhSkBMsBzCSizx9nnXg@mail.gmail.com>
References: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
 <CAN2Hq05G7yuF+DTjbLXV2=7uBoicfYkYhSkBMsBzCSizx9nnXg@mail.gmail.com>
Message-ID: <CACLX4jQuOgEvUXUUAZiVy93mV6M=GxR9FaAZW+6sS0CNHMOU-g@mail.gmail.com>

Nice!  I'll look at that.

Can someone confirm that the change in how "opam config env" really
happened between 1.1.2 and 1.2?  I wonder if so whether it would make
sense to revert it, since that would avoid breaking lots of emacs
configs for people, and also because the new behavior also seems worse
than the old one.

y

On Tue, Sep 9, 2014 at 5:09 AM, Richard Mortier <mort at cantab.net> wrote:
> On 9 September 2014 03:08, Yaron Minsky <yminsky at janestreet.com> wrote:
>> Apologies for the following bits of emacs nonsense.
>>
>> Sadly, I think that opam 1.2 has broken the emacs configuration that I
>> documented here:
>>
>> https://github.com/realworldocaml/book/wiki/Installation-Instructions#emacs
>>
>> I'm looking for advice as to how to fix things.  It has to do with how
>> paths are set up.  Emacs for the mac has the annoying property of not
>> propagating ordinary shell settings.  Instead what I did was this:
>>
>> ;; -- Tweaks for OS X -------------------------------------
>> ;; Tweak for problem on OS X where Emacs.app doesn't run the right
>> ;; init scripts when invoking a sub-shell
>> (cond
>>  ((eq window-system 'ns) ; macosx
>>   ;; Invoke login shells, so that .profile or .bash_profile is read
>>   (setq shell-command-switch "-lc")))
>>
>> This caused the .profile to get run again on every incoming shell.
>> This has the property of rerunning "eval `opam config env`".  That
>> used to work because opam would throw its entries on the path when it
>> ran.  But I believe opam has been changed to not re-add entries when
>> they're already there.  This means that when you run the shell with
>> "-lc", it redumps the entries from /etc/paths on top, thus shadowing
>> the opam entries.
>
> the fragment i have in my `~/.emacs`
> (https://github.com/mor1/rc-files/blob/master/emacs.d/init.el) that
> attempts to deal with this is:
>
> ```
> ;; <http://stackoverflow.com/questions/8606954/
> ;;    path-and-exec-path-set-but-emacs-does-not-find-executable>
> (defun set-exec-path-from-shell-PATH ()
>   "Set up Emacs' `exec-path' and PATH environment variable to
>   match that used by the user's shell.
>
> This is particularly useful under Mac OSX, where GUI apps are not
> started from a shell."
>   (interactive)
>   (let ((path-from-shell
>          (replace-regexp-in-string
>           "[ \t\n]*$" ""
>           (shell-command-to-string "$SHELL --login -i -c 'echo $PATH'"))
>          ))
>     (setenv "PATH" path-from-shell)
>     (setq exec-path (split-string path-from-shell path-separator)))
>   )
> (set-exec-path-from-shell-PATH)
> ```
>
> ie., extract $PATH from a shell and then set various emacs variables
> accordingly. but it's hardly pleasant.
>
>> We could change opam 1.2 so that instead of not adding entries when
>> they're already there, it instead deletes the old version of the entry
>> and re-adds it to the top.  Or we could come up with a more principled
>> emacs-on-the-mac setup, but I can't quite figure out a good way of
>> doing that.
>
> well, encouraging emacs on the mac to propagate shell settings
> properly would do it for me ;)
>
> failing that, i like the idea of opam deleting old instances of PATH
> mods and then re-adding at the front. that seems the least surprising
> and tidiest option.
>
> (probably not much help for the rwo documentation, but fwiw i got
> bored of shell environment confusion a while back and wrote some shell
> functions to help me keep things clean and attempt to make shell
> initialisation largely idempotent; i basically never now have lines of
> the form VAR=value:$VAR in any of my startup scripts.
>
> https://github.com/mor1/rc-files/blob/master/envfns.sh
> https://github.com/mor1/rc-files/blob/master/environment
>
> )
>
> --
> Richard Mortier
> mort at cantab.net

From daniel.buenzli at erratique.ch  Tue Sep  9 13:21:58 2014
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Tue, 9 Sep 2014 14:21:58 +0200
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
In-Reply-To: <CACLX4jQuOgEvUXUUAZiVy93mV6M=GxR9FaAZW+6sS0CNHMOU-g@mail.gmail.com>
References: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
 <CAN2Hq05G7yuF+DTjbLXV2=7uBoicfYkYhSkBMsBzCSizx9nnXg@mail.gmail.com>
 <CACLX4jQuOgEvUXUUAZiVy93mV6M=GxR9FaAZW+6sS0CNHMOU-g@mail.gmail.com>
Message-ID: <0D33CC08C8964B989D8E4DF411794AAA@erratique.ch>

Le mardi, 9 septembre 2014 ? 13:11, Yaron Minsky a ?crit :
> Can someone confirm that the change in how "opam config env" really
> happened between 1.1.2 and 1.2?  

Could you exhibit a sample invocation showing the problem ? I do use the  

(setq shell-command-switch "-lc")

trick. But none of the other things except a  

(add-to-list 'load-path
 (concat
  (replace-regexp-in-string "\n$" ""
  (shell-command-to-string "opam config var share"))
  "/emacs/site-lisp"))



and things don't break here, at least in compilation mode.  

If I switch and try an `ocamlc -version` I get the correct ocamlc invoked. I suspect you should drop that `opam config env ?sexp` thing aswell as updating the exec-path. These things are only going to be invoked once and thus will not adapt to the current switch (as won't the above addition to 'load-path).  

Best,

Daniel



From yminsky at gmail.com  Tue Sep  9 15:37:48 2014
From: yminsky at gmail.com (Yaron Minsky)
Date: Tue, 9 Sep 2014 10:37:48 -0400
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
In-Reply-To: <0D33CC08C8964B989D8E4DF411794AAA@erratique.ch>
References: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
 <CAN2Hq05G7yuF+DTjbLXV2=7uBoicfYkYhSkBMsBzCSizx9nnXg@mail.gmail.com>
 <CACLX4jQuOgEvUXUUAZiVy93mV6M=GxR9FaAZW+6sS0CNHMOU-g@mail.gmail.com>
 <0D33CC08C8964B989D8E4DF411794AAA@erratique.ch>
Message-ID: <CADKNfh+2H1J9yg6YJ3j5z8XbTw2NnE90mct7aY6NeR8Gr9pysw@mail.gmail.com>

Hmm.  I just tried your elisp code, and it doesn't quite get me there.
In particular, compilation now looks fine, but utop and merlin no
longer work, because emacs can no longer find them.  In particular, by
not extending exec-path, you lose the ability to directly invoke those
commands.  Also, a shell buffer (created with M-x shell) has the wrong
path, i.e., the path without opam putting its stuff in.  Maybe I
should put the opam stuff in the .bashrc.

Do those things work properly for you?

y

On Tue, Sep 9, 2014 at 8:21 AM, Daniel B?nzli
<daniel.buenzli at erratique.ch> wrote:
> Le mardi, 9 septembre 2014 ? 13:11, Yaron Minsky a ?crit :
>> Can someone confirm that the change in how "opam config env" really
>> happened between 1.1.2 and 1.2?
>
> Could you exhibit a sample invocation showing the problem ? I do use the
>
> (setq shell-command-switch "-lc")
>
> trick. But none of the other things except a
>
> (add-to-list 'load-path
>  (concat
>   (replace-regexp-in-string "\n$" ""
>   (shell-command-to-string "opam config var share"))
>   "/emacs/site-lisp"))
>
>
>
> and things don't break here, at least in compilation mode.
>
> If I switch and try an `ocamlc -version` I get the correct ocamlc invoked. I suspect you should drop that `opam config env ?sexp` thing aswell as updating the exec-path. These things are only going to be invoked once and thus will not adapt to the current switch (as won't the above addition to 'load-path).
>
> Best,
>
> Daniel
>
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

From daniel.buenzli at erratique.ch  Tue Sep  9 16:18:45 2014
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Tue, 9 Sep 2014 17:18:45 +0200
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
In-Reply-To: <CADKNfh+2H1J9yg6YJ3j5z8XbTw2NnE90mct7aY6NeR8Gr9pysw@mail.gmail.com>
References: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
 <CAN2Hq05G7yuF+DTjbLXV2=7uBoicfYkYhSkBMsBzCSizx9nnXg@mail.gmail.com>
 <CACLX4jQuOgEvUXUUAZiVy93mV6M=GxR9FaAZW+6sS0CNHMOU-g@mail.gmail.com>
 <0D33CC08C8964B989D8E4DF411794AAA@erratique.ch>
 <CADKNfh+2H1J9yg6YJ3j5z8XbTw2NnE90mct7aY6NeR8Gr9pysw@mail.gmail.com>
Message-ID: <62762542131641FA9C6092EDCFB4D10E@erratique.ch>

Le mardi, 9 septembre 2014 ? 16:37, Yaron Minsky a ?crit :
> Do those things work properly for you?

For things like merlin you can use (but that may be on the merlin2 branch, you'll have to check that).  

(require 'merlin)
(setq merlin-command 'opam)
(add-to-list 'company-backends 'merlin-company-backend)
(add-hook 'caml-mode-hook 'merlin-mode)
(setq merlin-use-auto-complete-mode 'easy)



For things like ocp-indent I use:  

; ocp-indent
(require 'ocp-indent)
(setq ocp-indent-path
      (concat
       (replace-regexp-in-string "\n$" ""
           (shell-command-to-string "opam config var bin")) "/ocp-indent"))
(setq ocp-indent-config "strict_with=always,match_clause=4,strict_else=never")


For utop I don't know, I don't use it. But if you can set its command to use in emacs to something like for ocp-indent-path above.

I confirm that M-x shell doesn't work me either, ocaml is not found at all.  

Best,

Daniel



From yminsky at janestreet.com  Tue Sep  9 16:47:26 2014
From: yminsky at janestreet.com (Yaron Minsky)
Date: Tue, 9 Sep 2014 11:47:26 -0400
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
In-Reply-To: <62762542131641FA9C6092EDCFB4D10E@erratique.ch>
References: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
 <CAN2Hq05G7yuF+DTjbLXV2=7uBoicfYkYhSkBMsBzCSizx9nnXg@mail.gmail.com>
 <CACLX4jQuOgEvUXUUAZiVy93mV6M=GxR9FaAZW+6sS0CNHMOU-g@mail.gmail.com>
 <0D33CC08C8964B989D8E4DF411794AAA@erratique.ch>
 <CADKNfh+2H1J9yg6YJ3j5z8XbTw2NnE90mct7aY6NeR8Gr9pysw@mail.gmail.com>
 <62762542131641FA9C6092EDCFB4D10E@erratique.ch>
Message-ID: <CACLX4jTYm_usp8xNgDk4pV-Ee=R=7X+uq59yaEUCFe9sREu+Og@mail.gmail.com>

Just to renew my question to the opam devs: we can probably find
improvements to the standard emacs setup we recommend to people, but
should we unwind the change in opam in how it handles the PATH
variable, to avoid breaking people's installed config files?

y

On Tue, Sep 9, 2014 at 11:18 AM, Daniel B?nzli
<daniel.buenzli at erratique.ch> wrote:
> Le mardi, 9 septembre 2014 ? 16:37, Yaron Minsky a ?crit :
>> Do those things work properly for you?
>
> For things like merlin you can use (but that may be on the merlin2 branch, you'll have to check that).
>
> (require 'merlin)
> (setq merlin-command 'opam)
> (add-to-list 'company-backends 'merlin-company-backend)
> (add-hook 'caml-mode-hook 'merlin-mode)
> (setq merlin-use-auto-complete-mode 'easy)
>
>
>
> For things like ocp-indent I use:
>
> ; ocp-indent
> (require 'ocp-indent)
> (setq ocp-indent-path
>       (concat
>        (replace-regexp-in-string "\n$" ""
>            (shell-command-to-string "opam config var bin")) "/ocp-indent"))
> (setq ocp-indent-config "strict_with=always,match_clause=4,strict_else=never")
>
>
> For utop I don't know, I don't use it. But if you can set its command to use in emacs to something like for ocp-indent-path above.
>
> I confirm that M-x shell doesn't work me either, ocaml is not found at all.
>
> Best,
>
> Daniel
>
>

From louis.gesbert at ocamlpro.com  Tue Sep  9 17:27:59 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 09 Sep 2014 18:27:59 +0200
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
In-Reply-To: <CACLX4jTYm_usp8xNgDk4pV-Ee=R=7X+uq59yaEUCFe9sREu+Og@mail.gmail.com>
References: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
 <62762542131641FA9C6092EDCFB4D10E@erratique.ch>
 <CACLX4jTYm_usp8xNgDk4pV-Ee=R=7X+uq59yaEUCFe9sREu+Og@mail.gmail.com>
Message-ID: <4627628.VDmdEVHKpK@agaric>

I'll check, but I am not sure there has been any recent changes on this. The situation isn't ideal anyway, so I'll gladly take suggestions on improving this.

Please see related issue: https://github.com/ocaml/opam/issues/1447

Thanks,
Louis

Le mardi 9 septembre 2014, 11:47:26 Yaron Minsky a ?crit :
> Just to renew my question to the opam devs: we can probably find
> improvements to the standard emacs setup we recommend to people, but
> should we unwind the change in opam in how it handles the PATH
> variable, to avoid breaking people's installed config files?
> 
> y
> 
> On Tue, Sep 9, 2014 at 11:18 AM, Daniel B?nzli
> <daniel.buenzli at erratique.ch> wrote:
> > Le mardi, 9 septembre 2014 ? 16:37, Yaron Minsky a ?crit :
> >> Do those things work properly for you?
> >
> > For things like merlin you can use (but that may be on the merlin2 branch, you'll have to check that).
> >
> > (require 'merlin)
> > (setq merlin-command 'opam)
> > (add-to-list 'company-backends 'merlin-company-backend)
> > (add-hook 'caml-mode-hook 'merlin-mode)
> > (setq merlin-use-auto-complete-mode 'easy)
> >
> >
> >
> > For things like ocp-indent I use:
> >
> > ; ocp-indent
> > (require 'ocp-indent)
> > (setq ocp-indent-path
> >       (concat
> >        (replace-regexp-in-string "\n$" ""
> >            (shell-command-to-string "opam config var bin")) "/ocp-indent"))
> > (setq ocp-indent-config "strict_with=always,match_clause=4,strict_else=never")
> >
> >
> > For utop I don't know, I don't use it. But if you can set its command to use in emacs to something like for ocp-indent-path above.
> >
> > I confirm that M-x shell doesn't work me either, ocaml is not found at all.
> >
> > Best,
> >
> > Daniel
> >
> >
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140909/41581083/attachment-0001.html>

From yminsky at janestreet.com  Tue Sep  9 18:57:22 2014
From: yminsky at janestreet.com (Yaron Minsky)
Date: Tue, 9 Sep 2014 13:57:22 -0400
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
In-Reply-To: <4627628.VDmdEVHKpK@agaric>
References: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
 <62762542131641FA9C6092EDCFB4D10E@erratique.ch>
 <CACLX4jTYm_usp8xNgDk4pV-Ee=R=7X+uq59yaEUCFe9sREu+Og@mail.gmail.com>
 <4627628.VDmdEVHKpK@agaric>
Message-ID: <CACLX4jRi31tF4id3VOG6MdBAEsyHmxuOQiJMd0uEoq_4rTKfpw@mail.gmail.com>

I guess I don't know if there's been a change, but I think that making
opam add paths to the front even when those paths are already in PATH,
is probably better than doing nothing in that case.

y

On Tue, Sep 9, 2014 at 12:27 PM, Louis Gesbert
<louis.gesbert at ocamlpro.com> wrote:
> I'll check, but I am not sure there has been any recent changes on this. The
> situation isn't ideal anyway, so I'll gladly take suggestions on improving
> this.
>
>
>
> Please see related issue: https://github.com/ocaml/opam/issues/1447
>
>
>
> Thanks,
>
> Louis
>
>
>
> Le mardi 9 septembre 2014, 11:47:26 Yaron Minsky a ?crit :
>
>> Just to renew my question to the opam devs: we can probably find
>
>> improvements to the standard emacs setup we recommend to people, but
>
>> should we unwind the change in opam in how it handles the PATH
>
>> variable, to avoid breaking people's installed config files?
>
>>
>
>> y
>
>>
>
>> On Tue, Sep 9, 2014 at 11:18 AM, Daniel B?nzli
>
>> <daniel.buenzli at erratique.ch> wrote:
>
>> > Le mardi, 9 septembre 2014 ? 16:37, Yaron Minsky a ?crit :
>
>> >> Do those things work properly for you?
>
>> >
>
>> > For things like merlin you can use (but that may be on the merlin2
>> > branch, you'll have to check that).
>
>> >
>
>> > (require 'merlin)
>
>> > (setq merlin-command 'opam)
>
>> > (add-to-list 'company-backends 'merlin-company-backend)
>
>> > (add-hook 'caml-mode-hook 'merlin-mode)
>
>> > (setq merlin-use-auto-complete-mode 'easy)
>
>> >
>
>> >
>
>> >
>
>> > For things like ocp-indent I use:
>
>> >
>
>> > ; ocp-indent
>
>> > (require 'ocp-indent)
>
>> > (setq ocp-indent-path
>
>> > (concat
>
>> > (replace-regexp-in-string "\n$" ""
>
>> > (shell-command-to-string "opam config var bin")) "/ocp-indent"))
>
>> > (setq ocp-indent-config
>> > "strict_with=always,match_clause=4,strict_else=never")
>
>> >
>
>> >
>
>> > For utop I don't know, I don't use it. But if you can set its command to
>> > use in emacs to something like for ocp-indent-path above.
>
>> >
>
>> > I confirm that M-x shell doesn't work me either, ocaml is not found at
>> > all.
>
>> >
>
>> > Best,
>
>> >
>
>> > Daniel
>
>> >
>
>> >
>
>> _______________________________________________
>
>> opam-devel mailing list
>
>> opam-devel at lists.ocaml.org
>
>> http://lists.ocaml.org/listinfo/opam-devel
>
>>
>
>

From vb at luminar.eu.org  Wed Sep 10 10:00:44 2014
From: vb at luminar.eu.org (Vincent B.)
Date: Wed, 10 Sep 2014 11:00:44 +0200
Subject: [opam-devel] Fwd: AUR Comment for aspcud-svn
In-Reply-To: <20140909181017.D82AC281E5@luna.archlinux.org>
References: <20140909181017.D82AC281E5@luna.archlinux.org>
Message-ID: <5410133C.7030404@luminar.eu.org>




-------- Forwarded Message --------
Subject: AUR Comment for aspcud-svn
Date: Tue,  9 Sep 2014 18:10:17 +0000 (UTC)
From: notify at aur.archlinux.org
Reply-To: noreply at aur.archlinux.org
To: undisclosed-recipients: ;

from https://aur.archlinux.org/pkgbase/aspcud-svn/
zhenya1007 wrote:

>From af83aff2dae812bdcf8086b5ef642c52186abd86 Mon Sep 17 00:00:00
2001
From: Evgeny Roubinchtein <zhenya1007 at gmail.com>
Date: Tue, 9 Sep 2014 10:53:36 -0700
Subject: [PATCH] A compilation fix.

Needed this patch to get the source to compile with.
boost 1.56.0-1
gcc 4.9.1-1
---
 aspcud-svn/PKGBUILD             | 13 ++++++++++---
 aspcud-svn/dependency.cpp.patch | 11 +++++++++++
 2 files changed, 21 insertions(+), 3 deletions(-)
 create mode 100644 aspcud-svn/dependency.cpp.patch

diff --git a/aspcud-svn/PKGBUILD b/aspcud-svn/PKGBUILD
index 5929cb1..a29e97d 100644
--- a/aspcud-svn/PKGBUILD
+++ b/aspcud-svn/PKGBUILD
@@ -2,7 +2,7 @@

 pkgname=aspcud-svn
 groups=('potassco')
-pkgver=r8385
+pkgver=r8738
 pkgrel=1
 pkgdesc="Solver for package dependencies"
 arch=('x86_64' 'i686' 'armv6h' 'armv7h')
@@ -12,8 +12,10 @@ depends=('clasp>=2.1.3' 'gringo>=4.2.1')
 conflicts=('aspcud')
 provides=('aspcud')
 makedepends=('boost' 'cmake' 're2c')
-source=("$pkgname"::'svn+svn://svn.code.sf.net/p/potassco/code/trunk/aspcud')
-md5sums=('SKIP')
+source=("$pkgname"::'svn+svn://svn.code.sf.net/p/potassco/code/trunk/aspcud'
+	dependency.cpp.patch)
+md5sums=('SKIP'
+	'c417b8aff0c290e07e6be27d68efe48a')

 pkgver() {
     cd "$srcdir/$pkgname"
@@ -21,6 +23,11 @@ pkgver() {
     printf "r%s" "${ver//[[:alpha:]]}"
 }

+prepare() {
+    cd "$srcdir/$pkgname"
+    patch -p3 -i $srcdir/dependency.cpp.patch
+}
+
 build() {
     cd "$srcdir/$pkgname"
     mkdir -p build/release
diff --git a/aspcud-svn/dependency.cpp.patch
b/aspcud-svn/dependency.cpp.patch
new file mode 100644
index 0000000..15b05b8
--- /dev/null
+++ b/aspcud-svn/dependency.cpp.patch
@@ -0,0 +1,11 @@
+--- ./src/aspcud-svn/libcudf/src/dependency.cpp.orig	2014-09-08
17:35:55.375674302 -0700
++++ ./src/aspcud-svn/libcudf/src/dependency.cpp	2014-09-08
18:09:00.832366212 -0700
+@@ -49,7 +49,7 @@
+
+     struct CudfPackageRefFilter {
+         CudfPackageRefFilter(const Cudf::PackageRef &ref) :
ref(&ref) { }
+-        bool operator()(const Entity *entity) {
++        bool operator()(const Entity *entity) const {
+             switch (ref->op) {
+                 case Cudf::PackageRef::EQ:
+                     return (entity->version == ref->version ||
entity->allVersions()) && ref->version != 0;
-- 
2.1.0



---
If you no longer wish to receive notifications about this package,
please go the the above package page and click the UnNotify button.




From anil at recoil.org  Wed Sep 10 10:41:30 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 10 Sep 2014 10:41:30 +0100
Subject: [opam-devel] Fwd: AUR Comment for aspcud-svn
In-Reply-To: <5410133C.7030404@luminar.eu.org>
References: <20140909181017.D82AC281E5@luna.archlinux.org>
 <5410133C.7030404@luminar.eu.org>
Message-ID: <58BF7C83-1220-4133-ABFF-45AB377D8E6B@recoil.org>

Thanks for pointing out this patch!  Also CCing Vsevolod in case
it affects the FreeBSD port of aspcud (used by pkgng now optionally,
I believe).

-anil

On 10 Sep 2014, at 10:00, Vincent B. <vb at luminar.eu.org> wrote:

> 
> 
> 
> -------- Forwarded Message --------
> Subject: AUR Comment for aspcud-svn
> Date: Tue,  9 Sep 2014 18:10:17 +0000 (UTC)
> From: notify at aur.archlinux.org
> Reply-To: noreply at aur.archlinux.org
> To: undisclosed-recipients: ;
> 
> from https://aur.archlinux.org/pkgbase/aspcud-svn/
> zhenya1007 wrote:
> 
> From af83aff2dae812bdcf8086b5ef642c52186abd86 Mon Sep 17 00:00:00
> 2001
> From: Evgeny Roubinchtein <zhenya1007 at gmail.com>
> Date: Tue, 9 Sep 2014 10:53:36 -0700
> Subject: [PATCH] A compilation fix.
> 
> Needed this patch to get the source to compile with.
> boost 1.56.0-1
> gcc 4.9.1-1
> ---
> aspcud-svn/PKGBUILD             | 13 ++++++++++---
> aspcud-svn/dependency.cpp.patch | 11 +++++++++++
> 2 files changed, 21 insertions(+), 3 deletions(-)
> create mode 100644 aspcud-svn/dependency.cpp.patch
> 
> diff --git a/aspcud-svn/PKGBUILD b/aspcud-svn/PKGBUILD
> index 5929cb1..a29e97d 100644
> --- a/aspcud-svn/PKGBUILD
> +++ b/aspcud-svn/PKGBUILD
> @@ -2,7 +2,7 @@
> 
> pkgname=aspcud-svn
> groups=('potassco')
> -pkgver=r8385
> +pkgver=r8738
> pkgrel=1
> pkgdesc="Solver for package dependencies"
> arch=('x86_64' 'i686' 'armv6h' 'armv7h')
> @@ -12,8 +12,10 @@ depends=('clasp>=2.1.3' 'gringo>=4.2.1')
> conflicts=('aspcud')
> provides=('aspcud')
> makedepends=('boost' 'cmake' 're2c')
> -source=("$pkgname"::'svn+svn://svn.code.sf.net/p/potassco/code/trunk/aspcud')
> -md5sums=('SKIP')
> +source=("$pkgname"::'svn+svn://svn.code.sf.net/p/potassco/code/trunk/aspcud'
> +	dependency.cpp.patch)
> +md5sums=('SKIP'
> +	'c417b8aff0c290e07e6be27d68efe48a')
> 
> pkgver() {
>     cd "$srcdir/$pkgname"
> @@ -21,6 +23,11 @@ pkgver() {
>     printf "r%s" "${ver//[[:alpha:]]}"
> }
> 
> +prepare() {
> +    cd "$srcdir/$pkgname"
> +    patch -p3 -i $srcdir/dependency.cpp.patch
> +}
> +
> build() {
>     cd "$srcdir/$pkgname"
>     mkdir -p build/release
> diff --git a/aspcud-svn/dependency.cpp.patch
> b/aspcud-svn/dependency.cpp.patch
> new file mode 100644
> index 0000000..15b05b8
> --- /dev/null
> +++ b/aspcud-svn/dependency.cpp.patch
> @@ -0,0 +1,11 @@
> +--- ./src/aspcud-svn/libcudf/src/dependency.cpp.orig	2014-09-08
> 17:35:55.375674302 -0700
> ++++ ./src/aspcud-svn/libcudf/src/dependency.cpp	2014-09-08
> 18:09:00.832366212 -0700
> +@@ -49,7 +49,7 @@
> +
> +     struct CudfPackageRefFilter {
> +         CudfPackageRefFilter(const Cudf::PackageRef &ref) :
> ref(&ref) { }
> +-        bool operator()(const Entity *entity) {
> ++        bool operator()(const Entity *entity) const {
> +             switch (ref->op) {
> +                 case Cudf::PackageRef::EQ:
> +                     return (entity->version == ref->version ||
> entity->allVersions()) && ref->version != 0;
> -- 
> 2.1.0
> 
> 
> 
> ---
> If you no longer wish to receive notifications about this package,
> please go the the above package page and click the UnNotify button.
> 
> 
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
> 


From louis.gesbert at ocamlpro.com  Wed Sep 10 12:32:09 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 10 Sep 2014 13:32:09 +0200
Subject: [opam-devel] Opam 1.2 breaks emacs on the mac sortof
In-Reply-To: <CACLX4jRi31tF4id3VOG6MdBAEsyHmxuOQiJMd0uEoq_4rTKfpw@mail.gmail.com>
References: <CACLX4jQrb7Ca58skNHsdipCcG711E1W6nYXvqVqTVnFujJACtw@mail.gmail.com>
 <4627628.VDmdEVHKpK@agaric>
 <CACLX4jRi31tF4id3VOG6MdBAEsyHmxuOQiJMd0uEoq_4rTKfpw@mail.gmail.com>
Message-ID: <4206289.hLlX90KUsC@agaric>

Sorry for the noise: there was
https://github.com/ocaml/opam/commit/bbcdf8e7 seems to be in cause.

Thanks for the feedback !

Le mardi 9 septembre 2014, 13:57:22 Yaron Minsky a ?crit :
> I guess I don't know if there's been a change, but I think that making
> opam add paths to the front even when those paths are already in PATH,
> is probably better than doing nothing in that case.
> 
> y
> 
> On Tue, Sep 9, 2014 at 12:27 PM, Louis Gesbert
> <louis.gesbert at ocamlpro.com> wrote:
> > I'll check, but I am not sure there has been any recent changes on this. The
> > situation isn't ideal anyway, so I'll gladly take suggestions on improving
> > this.
> >
> >
> >
> > Please see related issue: https://github.com/ocaml/opam/issues/1447
> >
> >
> >
> > Thanks,
> >
> > Louis
> >
> >
> >
> > Le mardi 9 septembre 2014, 11:47:26 Yaron Minsky a ?crit :
> >
> >> Just to renew my question to the opam devs: we can probably find
> >
> >> improvements to the standard emacs setup we recommend to people, but
> >
> >> should we unwind the change in opam in how it handles the PATH
> >
> >> variable, to avoid breaking people's installed config files?
> >
> >>
> >
> >> y
> >
> >>
> >
> >> On Tue, Sep 9, 2014 at 11:18 AM, Daniel B?nzli
> >
> >> <daniel.buenzli at erratique.ch> wrote:
> >
> >> > Le mardi, 9 septembre 2014 ? 16:37, Yaron Minsky a ?crit :
> >
> >> >> Do those things work properly for you?
> >
> >> >
> >
> >> > For things like merlin you can use (but that may be on the merlin2
> >> > branch, you'll have to check that).
> >
> >> >
> >
> >> > (require 'merlin)
> >
> >> > (setq merlin-command 'opam)
> >
> >> > (add-to-list 'company-backends 'merlin-company-backend)
> >
> >> > (add-hook 'caml-mode-hook 'merlin-mode)
> >
> >> > (setq merlin-use-auto-complete-mode 'easy)
> >
> >> >
> >
> >> >
> >
> >> >
> >
> >> > For things like ocp-indent I use:
> >
> >> >
> >
> >> > ; ocp-indent
> >
> >> > (require 'ocp-indent)
> >
> >> > (setq ocp-indent-path
> >
> >> > (concat
> >
> >> > (replace-regexp-in-string "\n$" ""
> >
> >> > (shell-command-to-string "opam config var bin")) "/ocp-indent"))
> >
> >> > (setq ocp-indent-config
> >> > "strict_with=always,match_clause=4,strict_else=never")
> >
> >> >
> >
> >> >
> >
> >> > For utop I don't know, I don't use it. But if you can set its command to
> >> > use in emacs to something like for ocp-indent-path above.
> >
> >> >
> >
> >> > I confirm that M-x shell doesn't work me either, ocaml is not found at
> >> > all.
> >
> >> >
> >
> >> > Best,
> >
> >> >
> >
> >> > Daniel
> >
> >> >
> >
> >> >
> >
> >> _______________________________________________
> >
> >> opam-devel mailing list
> >
> >> opam-devel at lists.ocaml.org
> >
> >> http://lists.ocaml.org/listinfo/opam-devel
> >
> >>
> >
> >

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140910/a39272c1/attachment-0001.html>

From kaminski at cs.uni-potsdam.de  Wed Sep 10 11:30:10 2014
From: kaminski at cs.uni-potsdam.de (Roland Kaminski)
Date: Wed, 10 Sep 2014 12:30:10 +0200
Subject: [opam-devel] Fwd: AUR Comment for aspcud-svn
In-Reply-To: <5410133C.7030404@luminar.eu.org>
References: <20140909181017.D82AC281E5@luna.archlinux.org>
 <5410133C.7030404@luminar.eu.org>
Message-ID: <3143525.tu86YdeZe3@beholder>

Hi, I fixed this in trunk. Thanks for reporting. -Roland

On Wednesday, September 10, 2014 11:00:44 AM Vincent B. wrote:
> -------- Forwarded Message --------
> Subject: AUR Comment for aspcud-svn
> Date: Tue,  9 Sep 2014 18:10:17 +0000 (UTC)
> From: notify at aur.archlinux.org
> Reply-To: noreply at aur.archlinux.org
> To: undisclosed-recipients: ;
> 
> from https://aur.archlinux.org/pkgbase/aspcud-svn/
> zhenya1007 wrote:
> 
> From af83aff2dae812bdcf8086b5ef642c52186abd86 Mon Sep 17 00:00:00
> 2001
> From: Evgeny Roubinchtein <zhenya1007 at gmail.com>
> Date: Tue, 9 Sep 2014 10:53:36 -0700
> Subject: [PATCH] A compilation fix.
> 
> Needed this patch to get the source to compile with.
> boost 1.56.0-1
> gcc 4.9.1-1
> ---
>  aspcud-svn/PKGBUILD             | 13 ++++++++++---
>  aspcud-svn/dependency.cpp.patch | 11 +++++++++++
>  2 files changed, 21 insertions(+), 3 deletions(-)
>  create mode 100644 aspcud-svn/dependency.cpp.patch
> 
> diff --git a/aspcud-svn/PKGBUILD b/aspcud-svn/PKGBUILD
> index 5929cb1..a29e97d 100644
> --- a/aspcud-svn/PKGBUILD
> +++ b/aspcud-svn/PKGBUILD
> @@ -2,7 +2,7 @@
> 
>  pkgname=aspcud-svn
>  groups=('potassco')
> -pkgver=r8385
> +pkgver=r8738
>  pkgrel=1
>  pkgdesc="Solver for package dependencies"
>  arch=('x86_64' 'i686' 'armv6h' 'armv7h')
> @@ -12,8 +12,10 @@ depends=('clasp>=2.1.3' 'gringo>=4.2.1')
>  conflicts=('aspcud')
>  provides=('aspcud')
>  makedepends=('boost' 'cmake' 're2c')
> -source=("$pkgname"::'svn+svn://svn.code.sf.net/p/potassco/code/trunk/aspcud
> ') -md5sums=('SKIP')
> +source=("$pkgname"::'svn+svn://svn.code.sf.net/p/potassco/code/trunk/aspcud
> ' +	dependency.cpp.patch)
> +md5sums=('SKIP'
> +	'c417b8aff0c290e07e6be27d68efe48a')
> 
>  pkgver() {
>      cd "$srcdir/$pkgname"
> @@ -21,6 +23,11 @@ pkgver() {
>      printf "r%s" "${ver//[[:alpha:]]}"
>  }
> 
> +prepare() {
> +    cd "$srcdir/$pkgname"
> +    patch -p3 -i $srcdir/dependency.cpp.patch
> +}
> +
>  build() {
>      cd "$srcdir/$pkgname"
>      mkdir -p build/release
> diff --git a/aspcud-svn/dependency.cpp.patch
> b/aspcud-svn/dependency.cpp.patch
> new file mode 100644
> index 0000000..15b05b8
> --- /dev/null
> +++ b/aspcud-svn/dependency.cpp.patch
> @@ -0,0 +1,11 @@
> +--- ./src/aspcud-svn/libcudf/src/dependency.cpp.orig	2014-09-08
> 17:35:55.375674302 -0700
> ++++ ./src/aspcud-svn/libcudf/src/dependency.cpp	2014-09-08
> 18:09:00.832366212 -0700
> +@@ -49,7 +49,7 @@
> +
> +     struct CudfPackageRefFilter {
> +         CudfPackageRefFilter(const Cudf::PackageRef &ref) :
> ref(&ref) { }
> +-        bool operator()(const Entity *entity) {
> ++        bool operator()(const Entity *entity) const {
> +             switch (ref->op) {
> +                 case Cudf::PackageRef::EQ:
> +                     return (entity->version == ref->version ||
> entity->allVersions()) && ref->version != 0;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 213 bytes
Desc: This is a digitally signed message part.
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140910/14500621/attachment.sig>

From anil at recoil.org  Thu Sep 11 15:20:30 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 11 Sep 2014 15:20:30 +0100
Subject: [opam-devel] bulk testing now includes CentOS 6/7
Message-ID: <603EBEEF-512F-49A0-A971-C3282EB8E136@recoil.org>

At a request from Dave Scott from Citrix, I've added a Docker CentOS 6/7 image into https://github.com/avsm/docker-opam and started running bulk builds on there too.

This looks for tags of the form ["centos"] and/or ["centos" "centos-7"] (for more
specific RPM versions).  Results are being pushed to https://github.com/ocaml/opam-bulk-logs, and I anticipate there will be many more failures due to the lack of depexts for this platform.

Dave has made a start with https://github.com/ocaml/opam-repository/pull/2656, but any other interested parties in CentOS/Fedora can also contribute depexts.

cheers,
Anil

From scott.dj at gmail.com  Thu Sep 11 15:28:29 2014
From: scott.dj at gmail.com (David Scott)
Date: Thu, 11 Sep 2014 15:28:29 +0100
Subject: [opam-devel] bulk testing now includes CentOS 6/7
In-Reply-To: <603EBEEF-512F-49A0-A971-C3282EB8E136@recoil.org>
References: <603EBEEF-512F-49A0-A971-C3282EB8E136@recoil.org>
Message-ID: <CAG_esB2Oui1O40ghBLTQGyjHso40AurqvDrUtceh+uH18H=TYA@mail.gmail.com>

On Thu, Sep 11, 2014 at 3:20 PM, Anil Madhavapeddy <anil at recoil.org> wrote:

> At a request from Dave Scott from Citrix, I've added a Docker CentOS 6/7
> image into https://github.com/avsm/docker-opam and started running bulk
> builds on there too.
>
> This looks for tags of the form ["centos"] and/or ["centos" "centos-7"]
> (for more
> specific RPM versions).  Results are being pushed to
> https://github.com/ocaml/opam-bulk-logs, and I anticipate there will be
> many more failures due to the lack of depexts for this platform.
>

This is really nice, thanks for adding this!


> Dave has made a start with
> https://github.com/ocaml/opam-repository/pull/2656, but any other
> interested parties in CentOS/Fedora can also contribute depexts.


> cheers,
> Anil
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>



-- 
Dave Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140911/99f9b64c/attachment.html>

From p.donadeo at gmail.com  Thu Sep 11 15:37:22 2014
From: p.donadeo at gmail.com (Paolo Donadeo)
Date: Thu, 11 Sep 2014 16:37:22 +0200
Subject: [opam-devel] bulk testing now includes CentOS 6/7
In-Reply-To: <603EBEEF-512F-49A0-A971-C3282EB8E136@recoil.org>
References: <603EBEEF-512F-49A0-A971-C3282EB8E136@recoil.org>
Message-ID: <CAPzAKVD3OtD-fBMTDF05JRsLFeo8GoOGgG-SBZyntwjVfCD61w@mail.gmail.com>

Thanks Anil.


-- 
*Paolo*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140911/7f9a87a9/attachment.html>

From louis.gesbert at ocamlpro.com  Fri Sep 19 16:02:43 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 19 Sep 2014 17:02:43 +0200
Subject: [opam-devel] Preparing the path for 1.2
Message-ID: <12168727.HDWJGTDxmd@agaric>

Hi all,

As you may know, the 1.2.0 RC2 has just been tagged [1]. However, as discussed at [2], planning the migration of the repository is quite a delicate matter ; this doesn't have to be done at the same time as the release itself, but some confusion may arise if we advertise a new workflow that leads to packages that get refused from the main repo because they're not 1.1 compatible.

We tried to improve compatibility for the next release, but for 1.2 there are just too many changes and opam 1.1 _won't_ nicely handle them. So here is how I have been preparing:

- a batch conversion of the existing repo [7]: not required but useful for 1.2 (adding dev repos for archives held on github, setting ocamlfind deps as build-only, turning depopts constraints to conflicts [3]...). This is useful as a starting point for repo extension and example, and done using scripts in `admin-scripts/` [4]

- a `admin-scripts/to_1_1.ml` script in opam [5] that can convert a package back to 1.1 format. I successfully tested it on the above repo and with opam 1.1 ; there may be corner cases on new 1.2 opam files that this didn't get into, but these can be caught by Travis before they break.

- updated admin scripts on the 11-bridge branch of opam.ocaml.org [6]. The new scripts create a duplicate of the repo at opam.ocaml.org/1.1/, branch version-triggered redirects between the two, and apply the above script to the 1.1 repo mirror at every update. This should make it transparent whichever opam version is used.

- tested the opam.ocaml.org scripts on a local mirror I set up, and they seem to work fine (after _a lot_ of tweaking) ; note that these can be pushed live beforehand, they'll set up the redirects but the translation script doesn't change opam files with `opam-version` < "1.2" so it won't cause any user-visible changes until we actually accept 1.2 opam files in the repo (except for the "permanently redirected" message)

What remains to do:

- setup the opam-repository travis scripts to apply the 1.1 rewrite before testing, for opam versions < 1.2. Only tricky part is to get hold of a recent enough opam-lib to run the script (maybe we could cheat and put a standalone bytecode exe on opam-repository for that ; well one for 4.01 and one for 4.02 since the format changed...). This way PRs to opam-repo containing 1.2 opam files will be correctly tested, as well as the rewrite.

- release !


Finally, note that I'll be moving across the globe next week, and won't be available for two weeks or so. Everything should be ready to release as soon as I get back.

Cheers,
Louis



[1] https://github.com/ocaml/opam/releases/tag/1.2.0-rc2
[2] https://github.com/ocaml/opam/issues/1662
[3] https://github.com/ocaml/opam/pull/1325
[4] https://github.com/ocaml/opam/tree/master/admin-scripts
[5] https://github.com/ocaml/opam/pull/1743
[6] https://github.com/ocaml/opam.ocaml.org/tree/11-bridge
[7] https://github.com/ocaml/opam-repository/tree/1.2-test


PS: during the course of these tests, I sadly found out that repo redirect handling in 1.1 wasn't that good: it works at update but not straight-away at init. See comment at https://github.com/ocaml/opam/pull/1744
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140919/692edbce/attachment.html>

From anil at recoil.org  Fri Sep 19 16:09:34 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 19 Sep 2014 16:09:34 +0100
Subject: [opam-devel] Preparing the path for 1.2
In-Reply-To: <12168727.HDWJGTDxmd@agaric>
References: <12168727.HDWJGTDxmd@agaric>
Message-ID: <5634EC38-6BBF-4BC4-B799-E64EBEDFEB52@recoil.org>

One thing that worries me is that some people did not see the repo redirection for OPAM 1.1, and this might happen again for 1.2 until we figure out why (I think it might be just that they did a Git init instead of the default).

Would it make sense to activate the repo redirect to the new branch ahead of the release?  The only way we will know if people have moved over is via the HTTP remote (since the Git remote is hosted on GitHub without direct logs).  Which leads on to my next question -- will there be a separate HTTP URL space for 1.1 and 1.2 for the HTTP remote?

cheers,
Anil

On 19 Sep 2014, at 16:02, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> Hi all,
>  
> As you may know, the 1.2.0 RC2 has just been tagged [1]. However, as discussed at [2], planning the migration of the repository is quite a delicate matter ; this doesn't have to be done at the same time as the release itself, but some confusion may arise if we advertise a new workflow that leads to packages that get refused from the main repo because they're not 1.1 compatible.
>  
> We tried to improve compatibility for the next release, but for 1.2 there are just too many changes and opam 1.1 _won't_ nicely handle them. So here is how I have been preparing:
>  
> - a batch conversion of the existing repo [7]: not required but useful for 1.2 (adding dev repos for archives held on github, setting ocamlfind deps as build-only, turning depopts constraints to conflicts [3]...). This is useful as a starting point for repo extension and example, and done using scripts in `admin-scripts/` [4]
>  
> - a `admin-scripts/to_1_1.ml` script in opam [5] that can convert a package back to 1.1 format. I successfully tested it on the above repo and with opam 1.1 ; there may be corner cases on new 1.2 opam files that this didn't get into, but these can be caught by Travis before they break.
>  
> - updated admin scripts on the 11-bridge branch of opam.ocaml.org [6]. The new scripts create a duplicate of the repo at opam.ocaml.org/1.1/, branch version-triggered redirects between the two, and apply the above script to the 1.1 repo mirror at every update. This should make it transparent whichever opam version is used.
>  
> - tested the opam.ocaml.org scripts on a local mirror I set up, and they seem to work fine (after _a lot_ of tweaking) ; note that these can be pushed live beforehand, they'll set up the redirects but the translation script doesn't change opam files with `opam-version` < "1.2" so it won't cause any user-visible changes until we actually accept 1.2 opam files in the repo (except for the "permanently redirected" message)
>  
> What remains to do:
>  
> - setup the opam-repository travis scripts to apply the 1.1 rewrite before testing, for opam versions < 1.2. Only tricky part is to get hold of a recent enough opam-lib to run the script (maybe we could cheat and put a standalone bytecode exe on opam-repository for that ; well one for 4.01 and one for 4.02 since the format changed...). This way PRs to opam-repo containing 1.2 opam files will be correctly tested, as well as the rewrite.
>  
> - release !
>  
>  
> Finally, note that I'll be moving across the globe next week, and won't be available for two weeks or so. Everything should be ready to release as soon as I get back.
>  
> Cheers,
> Louis
>  
>  
>  
> [1] https://github.com/ocaml/opam/releases/tag/1.2.0-rc2
> [2] https://github.com/ocaml/opam/issues/1662
> [3] https://github.com/ocaml/opam/pull/1325
> [4] https://github.com/ocaml/opam/tree/master/admin-scripts
> [5] https://github.com/ocaml/opam/pull/1743
> [6] https://github.com/ocaml/opam.ocaml.org/tree/11-bridge
> [7] https://github.com/ocaml/opam-repository/tree/1.2-test
>  
>  
> PS: during the course of these tests, I sadly found out that repo redirect handling in 1.1 wasn't that good: it works at update but not straight-away at init. See comment at https://github.com/ocaml/opam/pull/1744
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140919/70836075/attachment-0001.html>

From louis.gesbert at ocamlpro.com  Fri Sep 19 16:19:12 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 19 Sep 2014 17:19:12 +0200
Subject: [opam-devel] Preparing the path for 1.2
In-Reply-To: <5634EC38-6BBF-4BC4-B799-E64EBEDFEB52@recoil.org>
References: <12168727.HDWJGTDxmd@agaric>
 <5634EC38-6BBF-4BC4-B799-E64EBEDFEB52@recoil.org>
Message-ID: <10229387.JhaiCQeLLi@agaric>

Le vendredi 19 septembre 2014, 16:09:34 Anil Madhavapeddy a ?crit :
> One thing that worries me is that some people did not see the repo redirection for OPAM 1.1, and this might happen again for 1.2 until we figure out why (I think it might be just that they did a Git init instead of the default).

Probably. I also added the 'repo' file to the 'index.tar.gz' file, which may help even for 1.1.

> Would it make sense to activate the repo redirect to the new branch ahead of the release?

Exactly what I was suggesting :)
The branch was just for tests, normally what I advised won't need any branching on the git side, only rewrite on the http server side

> The only way we will know if people have moved over is via the HTTP remote (since the Git remote is hosted on GitHub without direct logs).  Which leads on to my next question -- will there be a separate HTTP URL space for 1.1 and 1.2 for the HTTP remote?
> 
> cheers,
> Anil
> 
> On 19 Sep 2014, at 16:02, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
> > Hi all,
> >  
> > As you may know, the 1.2.0 RC2 has just been tagged [1]. However, as discussed at [2], planning the migration of the repository is quite a delicate matter ; this doesn't have to be done at the same time as the release itself, but some confusion may arise if we advertise a new workflow that leads to packages that get refused from the main repo because they're not 1.1 compatible.
> >  
> > We tried to improve compatibility for the next release, but for 1.2 there are just too many changes and opam 1.1 _won't_ nicely handle them. So here is how I have been preparing:
> >  
> > - a batch conversion of the existing repo [7]: not required but useful for 1.2 (adding dev repos for archives held on github, setting ocamlfind deps as build-only, turning depopts constraints to conflicts [3]...). This is useful as a starting point for repo extension and example, and done using scripts in `admin-scripts/` [4]
> >  
> > - a `admin-scripts/to_1_1.ml` script in opam [5] that can convert a package back to 1.1 format. I successfully tested it on the above repo and with opam 1.1 ; there may be corner cases on new 1.2 opam files that this didn't get into, but these can be caught by Travis before they break.
> >  
> > - updated admin scripts on the 11-bridge branch of opam.ocaml.org [6]. The new scripts create a duplicate of the repo at opam.ocaml.org/1.1/, branch version-triggered redirects between the two, and apply the above script to the 1.1 repo mirror at every update. This should make it transparent whichever opam version is used.
> >  
> > - tested the opam.ocaml.org scripts on a local mirror I set up, and they seem to work fine (after _a lot_ of tweaking) ; note that these can be pushed live beforehand, they'll set up the redirects but the translation script doesn't change opam files with `opam-version` < "1.2" so it won't cause any user-visible changes until we actually accept 1.2 opam files in the repo (except for the "permanently redirected" message)
> >  
> > What remains to do:
> >  
> > - setup the opam-repository travis scripts to apply the 1.1 rewrite before testing, for opam versions < 1.2. Only tricky part is to get hold of a recent enough opam-lib to run the script (maybe we could cheat and put a standalone bytecode exe on opam-repository for that ; well one for 4.01 and one for 4.02 since the format changed...). This way PRs to opam-repo containing 1.2 opam files will be correctly tested, as well as the rewrite.
> >  
> > - release !
> >  
> >  
> > Finally, note that I'll be moving across the globe next week, and won't be available for two weeks or so. Everything should be ready to release as soon as I get back.
> >  
> > Cheers,
> > Louis
> >  
> >  
> >  
> > [1] https://github.com/ocaml/opam/releases/tag/1.2.0-rc2
> > [2] https://github.com/ocaml/opam/issues/1662
> > [3] https://github.com/ocaml/opam/pull/1325
> > [4] https://github.com/ocaml/opam/tree/master/admin-scripts
> > [5] https://github.com/ocaml/opam/pull/1743
> > [6] https://github.com/ocaml/opam.ocaml.org/tree/11-bridge
> > [7] https://github.com/ocaml/opam-repository/tree/1.2-test
> >  
> >  
> > PS: during the course of these tests, I sadly found out that repo redirect handling in 1.1 wasn't that good: it works at update but not straight-away at init. See comment at https://github.com/ocaml/opam/pull/1744
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140919/7938e8fa/attachment.html>

From thomas at gazagnaire.org  Sat Sep 27 18:43:56 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Sat, 27 Sep 2014 18:43:56 +0100
Subject: [opam-devel] ows reports
Message-ID: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>

Hi,

I had a quick look at "opam weather services" reports and I am a bit puzzled at how the statistic are computed. It seems that a package is considered as "broken" when one of its dependency cannot be installed. I'm not sure it makes sense: in the case the dependency is not available on a given platform / compiler version, then all the packages which depend upon it are not available as well as "availability" is a transitive relation in opam. These packages are not "broken".

Especially, on that page: http://ows.irill.org/table.html a lot of "bad" result are in fact simply a result the package not available for the given compiler version. 

I'm sure they are packages which are actually broken (ie. there are no version of ocaml where they can be installed) and these should be much more useful to high-light in order than someone try to fix the descriptions (for instance me, when I am bored and have nothing else to do).

Best,
Thomas

From roberto at dicosmo.org  Sat Sep 27 19:14:12 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Sat, 27 Sep 2014 20:14:12 +0200
Subject: [opam-devel] ows reports
In-Reply-To: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
Message-ID: <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>

Dear Thomas,
   I have some difficulty in understanding what exactly you do not
understand in the reports present on OWS.

Let me try to provide a few hints; a package is reported as "bad" for a
given version and a given architecture if there is no way to satisfy its
dependencies.

This means that there is no way you can install it using opam, and even if
the "code" shipped with the package may be perfectly fine, the "package"
itself is nevertheless useless.

This is why it is often termed "broken", following a terminology that is
now standard in the world of package based distribution, as it has been in
use for a couple of decades.

Why a package is broken, who is responsible of fixing it, is another story:
it can be the package maintainer that did not update the dependencies, or
the maintainer of a dependency that has wrongly removed it, or the release
manager that has not spotted the problem.

In the framework of the Mancoosi project we have developed a full suite of
tools to help improving the quality of a package based system, and it so
happen that all these tools are even written in OCaml.

I really do suggest that people on this list take the time and read the
short support material that was developed by Zack, Ralf and me for the HATS
summer school, and that is available here:
http://www.dicosmo.org/Publications/Hats2012.html

All the best

--
Roberto


2014-09-27 19:43 GMT+02:00 Thomas Gazagnaire <thomas at gazagnaire.org>:

> Hi,
>
> I had a quick look at "opam weather services" reports and I am a bit
> puzzled at how the statistic are computed. It seems that a package is
> considered as "broken" when one of its dependency cannot be installed. I'm
> not sure it makes sense: in the case the dependency is not available on a
> given platform / compiler version, then all the packages which depend upon
> it are not available as well as "availability" is a transitive relation in
> opam. These packages are not "broken".
>
> Especially, on that page: http://ows.irill.org/table.html a lot of "bad"
> result are in fact simply a result the package not available for the given
> compiler version.
>
> I'm sure they are packages which are actually broken (ie. there are no
> version of ocaml where they can be installed) and these should be much more
> useful to high-light in order than someone try to fix the descriptions (for
> instance me, when I am bored and have nothing else to do).
>
> Best,
> Thomas
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>



-- 
Roberto Di Cosmo

------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:

Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140927/1f6985a1/attachment.html>

From roberto at dicosmo.org  Sat Sep 27 19:14:46 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Sat, 27 Sep 2014 20:14:46 +0200
Subject: [opam-devel] ows reports
In-Reply-To: <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
Message-ID: <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>

s/architecture/compiler version/g

in the previous message

2014-09-27 20:14 GMT+02:00 Roberto Di Cosmo <roberto at dicosmo.org>:

> Dear Thomas,
>    I have some difficulty in understanding what exactly you do not
> understand in the reports present on OWS.
>
> Let me try to provide a few hints; a package is reported as "bad" for a
> given version and a given architecture if there is no way to satisfy its
> dependencies.
>
> This means that there is no way you can install it using opam, and even if
> the "code" shipped with the package may be perfectly fine, the "package"
> itself is nevertheless useless.
>
> This is why it is often termed "broken", following a terminology that is
> now standard in the world of package based distribution, as it has been in
> use for a couple of decades.
>
> Why a package is broken, who is responsible of fixing it, is another
> story: it can be the package maintainer that did not update the
> dependencies, or the maintainer of a dependency that has wrongly removed
> it, or the release manager that has not spotted the problem.
>
> In the framework of the Mancoosi project we have developed a full suite of
> tools to help improving the quality of a package based system, and it so
> happen that all these tools are even written in OCaml.
>
> I really do suggest that people on this list take the time and read the
> short support material that was developed by Zack, Ralf and me for the HATS
> summer school, and that is available here:
> http://www.dicosmo.org/Publications/Hats2012.html
>
> All the best
>
> --
> Roberto
>
>
> 2014-09-27 19:43 GMT+02:00 Thomas Gazagnaire <thomas at gazagnaire.org>:
>
>> Hi,
>>
>> I had a quick look at "opam weather services" reports and I am a bit
>> puzzled at how the statistic are computed. It seems that a package is
>> considered as "broken" when one of its dependency cannot be installed. I'm
>> not sure it makes sense: in the case the dependency is not available on a
>> given platform / compiler version, then all the packages which depend upon
>> it are not available as well as "availability" is a transitive relation in
>> opam. These packages are not "broken".
>>
>> Especially, on that page: http://ows.irill.org/table.html a lot of "bad"
>> result are in fact simply a result the package not available for the given
>> compiler version.
>>
>> I'm sure they are packages which are actually broken (ie. there are no
>> version of ocaml where they can be installed) and these should be much more
>> useful to high-light in order than someone try to fix the descriptions (for
>> instance me, when I am bored and have nothing else to do).
>>
>> Best,
>> Thomas
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
>>
>
>
>
> --
> Roberto Di Cosmo
>
> ------------------------------------------------------------------
> Professeur               En delegation a l'INRIA
> PPS                      E-mail: roberto at dicosmo.org
> Universite Paris Diderot WWW  : http://www.dicosmo.org
> Case 7014                Tel  : ++33-(0)1-57 27 92 20
> 5, Rue Thomas Mann
> F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
> FRANCE.                  Twitter: http://twitter.com/rdicosmo
> ------------------------------------------------------------------
> Attachments:
> MIME accepted, Word deprecated
>       http://www.gnu.org/philosophy/no-word-attachments.html
> ------------------------------------------------------------------
> Office location:
>
> Bureau 320 (3rd floor)
> Batiment Sophie Germain
> Avenue de France
> Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
> -----------------------------------------------------------------
> GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3
>



-- 
Roberto Di Cosmo

------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:

Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140927/9589fe0c/attachment-0001.html>

From thomas at gazagnaire.org  Sat Sep 27 20:31:12 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Sat, 27 Sep 2014 20:31:12 +0100
Subject: [opam-devel] ows reports
In-Reply-To: <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
Message-ID: <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>

> s/architecture/compiler version/g

Let me rephrase then. I think in some cases the ocaml version as an architecture. For an user point-of-view (and a maintainer) I am interested by two different questions:

1. Can I install the given package for at least one version of the compiler (in this case: the compiler is a normal package that you can upgrade/downgrade, not an architecture which doesn't change). if not, is it because:
  a) the package is in "broken" (there is a strong conflict in its dependencies)
  b) the package depends on a "broken" package

2. Can I install the given package with the given compiler version: if not, is it because:
  a) the package is "unavailable" for the given compiler (because 'available' field evaluate to false) or
  b) the package depends on an "unavailable" package

http://ows.irill.org/table.html show an empty square for 2.a but seems to conflats 1.a, 1.b and 2.b. I think that would be very helpful to highlight 1.a (1.b and 2.b could also be useful to know the root causes of the problems, ie. either fix 1.a or port 2.a to the given ocaml version).

Best,
Thomas


> 
> in the previous message
> 
> 2014-09-27 20:14 GMT+02:00 Roberto Di Cosmo <roberto at dicosmo.org>:
> Dear Thomas,
>    I have some difficulty in understanding what exactly you do not understand in the reports present on OWS.
> 
> Let me try to provide a few hints; a package is reported as "bad" for a given version and a given architecture if there is no way to satisfy its dependencies.
> 
> This means that there is no way you can install it using opam, and even if the "code" shipped with the package may be perfectly fine, the "package" itself is nevertheless useless.
> 
> This is why it is often termed "broken", following a terminology that is now standard in the world of package based distribution, as it has been in use for a couple of decades.
> 
> Why a package is broken, who is responsible of fixing it, is another story: it can be the package maintainer that did not update the dependencies, or the maintainer of a dependency that has wrongly removed it, or the release manager that has not spotted the problem.
> 
> In the framework of the Mancoosi project we have developed a full suite of tools to help improving the quality of a package based system, and it so happen that all these tools are even written in OCaml.
> 
> I really do suggest that people on this list take the time and read the short support material that was developed by Zack, Ralf and me for the HATS summer school, and that is available here: 
> http://www.dicosmo.org/Publications/Hats2012.html
> 
> All the best
> 
> --
> Roberto
> 
> 
> 2014-09-27 19:43 GMT+02:00 Thomas Gazagnaire <thomas at gazagnaire.org>:
> Hi,
> 
> I had a quick look at "opam weather services" reports and I am a bit puzzled at how the statistic are computed. It seems that a package is considered as "broken" when one of its dependency cannot be installed. I'm not sure it makes sense: in the case the dependency is not available on a given platform / compiler version, then all the packages which depend upon it are not available as well as "availability" is a transitive relation in opam. These packages are not "broken".
> 
> Especially, on that page: http://ows.irill.org/table.html a lot of "bad" result are in fact simply a result the package not available for the given compiler version.
> 
> I'm sure they are packages which are actually broken (ie. there are no version of ocaml where they can be installed) and these should be much more useful to high-light in order than someone try to fix the descriptions (for instance me, when I am bored and have nothing else to do).
> 
> Best,
> Thomas
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
> 
> 
> 
> -- 
> Roberto Di Cosmo
>  
> ------------------------------------------------------------------
> Professeur               En delegation a l'INRIA
> PPS                      E-mail: roberto at dicosmo.org
> Universite Paris Diderot WWW  : http://www.dicosmo.org
> Case 7014                Tel  : ++33-(0)1-57 27 92 20
> 5, Rue Thomas Mann       
> F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
> FRANCE.                  Twitter: http://twitter.com/rdicosmo
> ------------------------------------------------------------------
> Attachments:
> MIME accepted, Word deprecated
>       http://www.gnu.org/philosophy/no-word-attachments.html
> ------------------------------------------------------------------
> Office location:
>  
> Bureau 320 (3rd floor)
> Batiment Sophie Germain
> Avenue de France
> Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
> -----------------------------------------------------------------
> GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 
> 
> 
> 
> -- 
> Roberto Di Cosmo
>  
> ------------------------------------------------------------------
> Professeur               En delegation a l'INRIA
> PPS                      E-mail: roberto at dicosmo.org
> Universite Paris Diderot WWW  : http://www.dicosmo.org
> Case 7014                Tel  : ++33-(0)1-57 27 92 20
> 5, Rue Thomas Mann       
> F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
> FRANCE.                  Twitter: http://twitter.com/rdicosmo
> ------------------------------------------------------------------
> Attachments:
> MIME accepted, Word deprecated
>       http://www.gnu.org/philosophy/no-word-attachments.html
> ------------------------------------------------------------------
> Office location:
>  
> Bureau 320 (3rd floor)
> Batiment Sophie Germain
> Avenue de France
> Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
> -----------------------------------------------------------------
> GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140927/8acd7bdc/attachment.html>

From thomas at gazagnaire.org  Sun Sep 28 02:29:15 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Sun, 28 Sep 2014 02:29:15 +0100
Subject: [opam-devel] ows reports
In-Reply-To: <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
Message-ID: <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>

> Let me rephrase then. I think in some cases the ocaml version as an architecture. For an user point-of-view (and a maintainer) I am interested by two different questions:

sorry, forgot to write some words ... I meant:

 "I think in some cases the ocaml version should not be considered as an architecture"


> 
> 1. Can I install the given package for at least one version of the compiler (in this case: the compiler is a normal package that you can upgrade/downgrade, not an architecture which doesn't change). if not, is it because:
>   a) the package is in "broken" (there is a strong conflict in its dependencies)
>   b) the package depends on a "broken" package
> 
> 2. Can I install the given package with the given compiler version: if not, is it because:
>   a) the package is "unavailable" for the given compiler (because 'available' field evaluate to false) or
>   b) the package depends on an "unavailable" package
> 
> http://ows.irill.org/table.html show an empty square for 2.a but seems to conflats 1.a, 1.b and 2.b. I think that would be very helpful to highlight 1.a (1.b and 2.b could also be useful to know the root causes of the problems, ie. either fix 1.a or port 2.a to the given ocaml version).
> 
> Best,
> Thomas
> 
> 
>> 
>> in the previous message
>> 
>> 2014-09-27 20:14 GMT+02:00 Roberto Di Cosmo <roberto at dicosmo.org>:
>> Dear Thomas,
>>    I have some difficulty in understanding what exactly you do not understand in the reports present on OWS.
>> 
>> Let me try to provide a few hints; a package is reported as "bad" for a given version and a given architecture if there is no way to satisfy its dependencies.
>> 
>> This means that there is no way you can install it using opam, and even if the "code" shipped with the package may be perfectly fine, the "package" itself is nevertheless useless.
>> 
>> This is why it is often termed "broken", following a terminology that is now standard in the world of package based distribution, as it has been in use for a couple of decades.
>> 
>> Why a package is broken, who is responsible of fixing it, is another story: it can be the package maintainer that did not update the dependencies, or the maintainer of a dependency that has wrongly removed it, or the release manager that has not spotted the problem.
>> 
>> In the framework of the Mancoosi project we have developed a full suite of tools to help improving the quality of a package based system, and it so happen that all these tools are even written in OCaml.
>> 
>> I really do suggest that people on this list take the time and read the short support material that was developed by Zack, Ralf and me for the HATS summer school, and that is available here: 
>> http://www.dicosmo.org/Publications/Hats2012.html
>> 
>> All the best
>> 
>> --
>> Roberto
>> 
>> 
>> 2014-09-27 19:43 GMT+02:00 Thomas Gazagnaire <thomas at gazagnaire.org>:
>> Hi,
>> 
>> I had a quick look at "opam weather services" reports and I am a bit puzzled at how the statistic are computed. It seems that a package is considered as "broken" when one of its dependency cannot be installed. I'm not sure it makes sense: in the case the dependency is not available on a given platform / compiler version, then all the packages which depend upon it are not available as well as "availability" is a transitive relation in opam. These packages are not "broken".
>> 
>> Especially, on that page: http://ows.irill.org/table.html a lot of "bad" result are in fact simply a result the package not available for the given compiler version.
>> 
>> I'm sure they are packages which are actually broken (ie. there are no version of ocaml where they can be installed) and these should be much more useful to high-light in order than someone try to fix the descriptions (for instance me, when I am bored and have nothing else to do).
>> 
>> Best,
>> Thomas
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
>> 
>> 
>> 
>> -- 
>> Roberto Di Cosmo
>>  
>> ------------------------------------------------------------------
>> Professeur               En delegation a l'INRIA
>> PPS                      E-mail: roberto at dicosmo.org
>> Universite Paris Diderot WWW  : http://www.dicosmo.org
>> Case 7014                Tel  : ++33-(0)1-57 27 92 20
>> 5, Rue Thomas Mann       
>> F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
>> FRANCE.                  Twitter: http://twitter.com/rdicosmo
>> ------------------------------------------------------------------
>> Attachments:
>> MIME accepted, Word deprecated
>>       http://www.gnu.org/philosophy/no-word-attachments.html
>> ------------------------------------------------------------------
>> Office location:
>>  
>> Bureau 320 (3rd floor)
>> Batiment Sophie Germain
>> Avenue de France
>> Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
>> -----------------------------------------------------------------
>> GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 
>> 
>> 
>> 
>> -- 
>> Roberto Di Cosmo
>>  
>> ------------------------------------------------------------------
>> Professeur               En delegation a l'INRIA
>> PPS                      E-mail: roberto at dicosmo.org
>> Universite Paris Diderot WWW  : http://www.dicosmo.org
>> Case 7014                Tel  : ++33-(0)1-57 27 92 20
>> 5, Rue Thomas Mann       
>> F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
>> FRANCE.                  Twitter: http://twitter.com/rdicosmo
>> ------------------------------------------------------------------
>> Attachments:
>> MIME accepted, Word deprecated
>>       http://www.gnu.org/philosophy/no-word-attachments.html
>> ------------------------------------------------------------------
>> Office location:
>>  
>> Bureau 320 (3rd floor)
>> Batiment Sophie Germain
>> Avenue de France
>> Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
>> -----------------------------------------------------------------
>> GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140928/f5c4ab4b/attachment-0001.html>

From roberto at dicosmo.org  Sun Sep 28 08:20:38 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Sun, 28 Sep 2014 09:20:38 +0200
Subject: [opam-devel] ows reports
In-Reply-To: <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
 <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
Message-ID: <20140928072038.GA15211@traveler>

On Sun, Sep 28, 2014 at 02:29:15AM +0100, Thomas Gazagnaire wrote:
>     1. Can I install the given package for at least one version of the compiler

IMHO, this information is perfectly readable in the current table: if a line is
fully red, then the answer is no, otherwise it is yes. The advantage of the
current presentation is that you also immediately see which compiler versions
are ok.

>    if not, is it
>     because:
>       a) the package is in "broken" (there is a strong conflict in its
>     dependencies)
>       b) the package depends on a "broken" package
>     2. Can I install the given package with the given compiler version: if not,
>     is it because:
>       a) the package is "unavailable" for the given compiler (because
>     'available' field evaluate to false) or
>       b) the package depends on an "unavailable" package
> 
>     http://ows.irill.org/table.html show an empty square for 2.a but seems to
>     conflats 1.a, 1.b and 2.b. I think that would be very helpful to highlight
>     1.a (1.b and 2.b could also be useful to know the root causes of the
>     problems, ie. either fix 1.a or port 2.a to the given ocaml version).
> 

If I understand well, you would like to see some kind of information that
could be used to suggest what could or should be done to "fix" the red cells:
for example, if a package p has conflicting dependencies, you might want to
start looking at p, while when a package p depends on a q that is broken,
you will first look at q, right?

Unfortunately, things are not that simple... if my understanding of how
opam-repository is maintained today is correct, a package p version v can enter
the repository at a certain time t only if it is installable.  So even in you
1.a case, the "blame" for p being uninstallable at some later time t' may still
go (and will probably go) to some change in some remote dependency of p, and you
are not better off than in 1.b

When working in the Debian framework, one can provide more helpful information,
throught the identification of "outdated" packages (packages that are broken and
can only be fixed by working on them), but unfortunately the tool that performs
this analysis is pretty subtle, only works on Debian medatata today, and we
have no resources to make it work on arbitrary CUDF documents.

So the best we can do today is to provide a detailed explanation of the reasons why
a package cannot be installed when you click on the red cell: a package may
depend on a missing package, on a package that is not installable, on packages
that are in conflict, on version ranges of a package that have no installable
candidate, and all this, of course, may happen arbitrarily far in the dependency
graph; even if some effort to display the root causes is made, human
intervention is needed to decide what to do then.

As for 2.a and 2.b, the distinction seems also easy to make from the current
display: an empty cell means the package has a compiler constraint that declares
it unavailable, while a red cell means the problem is with its dependencies, and
in that case, you need to click on the cell and investigate what happens.

Notice though that the presentation of these explanations is not yet optimal:
since there are so many versions of packages around in the opam repository,
providing a compact presentation is not as straghtforward as for the GNU/Linux
distributions case; quite a bit of work has already gone into this issue
(many thanks to Louis, btw) and is now being continued by an intern at Irill,
but the jury is still out on what the right approach really is.

--
Roberto

>     Best,
>     Thomas
> 
> 
> 
> 
>         in the previous message
> 
>         2014-09-27 20:14 GMT+02:00 Roberto Di Cosmo <roberto at dicosmo.org>:
> 
>             Dear Thomas,
>                I have some difficulty in understanding what exactly you do not
>             understand in the reports present on OWS.
> 
>             Let me try to provide a few hints; a package is reported as "bad"
>             for a given version and a given architecture if there is no way to
>             satisfy its dependencies.
> 
>             This means that there is no way you can install it using opam, and
>             even if the "code" shipped with the package may be perfectly fine,
>             the "package" itself is nevertheless useless.
> 
>             This is why it is often termed "broken", following a terminology
>             that is now standard in the world of package based distribution, as
>             it has been in use for a couple of decades.
> 
>             Why a package is broken, who is responsible of fixing it, is
>             another story: it can be the package maintainer that did not update
>             the dependencies, or the maintainer of a dependency that has
>             wrongly removed it, or the release manager that has not spotted the
>             problem.
> 
>             In the framework of the Mancoosi project we have developed a full
>             suite of tools to help improving the quality of a package based
>             system, and it so happen that all these tools are even written in
>             OCaml.
> 
>             I really do suggest that people on this list take the time and read
>             the short support material that was developed by Zack, Ralf and me
>             for the HATS summer school, and that is available here:
>             http://www.dicosmo.org/Publications/Hats2012.html
> 
>             All the best
> 
>             --
>             Roberto
> 
> 
>             2014-09-27 19:43 GMT+02:00 Thomas Gazagnaire <thomas at gazagnaire.org
>             >:
> 
>                 Hi,
> 
>                 I had a quick look at "opam weather services" reports and I am
>                 a bit puzzled at how the statistic are computed. It seems that
>                 a package is considered as "broken" when one of its dependency
>                 cannot be installed. I'm not sure it makes sense: in the case
>                 the dependency is not available on a given platform / compiler
>                 version, then all the packages which depend upon it are not
>                 available as well as "availability" is a transitive relation in
>                 opam. These packages are not "broken".
> 
>                 Especially, on that page: http://ows.irill.org/table.html a lot
>                 of "bad" result are in fact simply a result the package not
>                 available for the given compiler version.
> 
>                 I'm sure they are packages which are actually broken (ie. there
>                 are no version of ocaml where they can be installed) and these
>                 should be much more useful to high-light in order than someone
>                 try to fix the descriptions (for instance me, when I am bored
>                 and have nothing else to do).
> 
>                 Best,
>                 Thomas
>                 _______________________________________________
>                 opam-devel mailing list
>                 opam-devel at lists.ocaml.org
>                 http://lists.ocaml.org/listinfo/opam-devel
> 
> 
> 
> 
>             --
>             Roberto Di Cosmo
>              
>             ------------------------------------------------------------------
>             Professeur               En delegation a l'INRIA
>             PPS                      E-mail: roberto at dicosmo.org
>             Universite Paris Diderot WWW  : http://www.dicosmo.org
>             Case 7014                Tel  : ++33-(0)1-57 27 92 20
>             5, Rue Thomas Mann       
>             F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
>             FRANCE.                  Twitter: http://twitter.com/rdicosmo
>             ------------------------------------------------------------------
>             Attachments:
>             MIME accepted, Word deprecated
>                   http://www.gnu.org/philosophy/no-word-attachments.html
>             ------------------------------------------------------------------
>             Office location:
>              
>             Bureau 320 (3rd floor)
>             Batiment Sophie Germain
>             Avenue de France
>             Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
>             -----------------------------------------------------------------
>             GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 
> 
> 
> 
> 
>         --
>         Roberto Di Cosmo
>          
>         ------------------------------------------------------------------
>         Professeur               En delegation a l'INRIA
>         PPS                      E-mail: roberto at dicosmo.org
>         Universite Paris Diderot WWW  : http://www.dicosmo.org
>         Case 7014                Tel  : ++33-(0)1-57 27 92 20
>         5, Rue Thomas Mann       
>         F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
>         FRANCE.                  Twitter: http://twitter.com/rdicosmo
>         ------------------------------------------------------------------
>         Attachments:
>         MIME accepted, Word deprecated
>               http://www.gnu.org/philosophy/no-word-attachments.html
>         ------------------------------------------------------------------
>         Office location:
>          
>         Bureau 320 (3rd floor)
>         Batiment Sophie Germain
>         Avenue de France
>         Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
>         -----------------------------------------------------------------
>         GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 
> 
> 
> 
> 

-- 
Roberto Di Cosmo
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 3020 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        

From thomas at gazagnaire.org  Sun Sep 28 11:24:07 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Sun, 28 Sep 2014 11:24:07 +0100
Subject: [opam-devel] ows reports
In-Reply-To: <20140928072038.GA15211@traveler>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
 <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
 <20140928072038.GA15211@traveler>
Message-ID: <7D827465-EEFF-4CD5-BA97-3D7932A45662@gazagnaire.org>

Hi Roberto,

Thanks for your explanations.

> IMHO, this information is perfectly readable in the current table: if a line is
> fully red, then the answer is no, otherwise it is yes. The advantage of the
> current presentation is that you also immediately see which compiler versions
> are ok.

> If I understand well, you would like to see some kind of information that
> could be used to suggest what could or should be done to "fix" the red cells:
> for example, if a package p has conflicting dependencies, you might want to
> start looking at p, while when a package p depends on a q that is broken,
> you will first look at q, right?

Yes exactly, it is very useful to have a quality metrics for opam-repository (let's say, the number of red cells) but I feel this metrics does not really reflect the way we currently manage the repository and it does not really help when one to improve the metrics results.

For instance, fixing 2.b means adding a new "available" field for the package, which is artificial: if you try to 'opam install' this package, opam will already tell you that the package is not available for your OS or ocaml-version (and I think it is much more precise in the unavailability cause in version 1.2). 

Fixing 1.b means finding the right 1.a to fix. So the metrics should be the number of 1.a. in the repo.

> Unfortunately, things are not that simple... if my understanding of how
> opam-repository is maintained today is correct, a package p version v can enter
> the repository at a certain time t only if it is installable.  So even in you
> 1.a case, the "blame" for p being uninstallable at some later time t' may still
> go (and will probably go) to some change in some remote dependency of p, and you
> are not better off than in 1.b

We do not track forward-dependencies yet in our testing due to resource constraints, but that was the plan from the beginning. So if a package is installable for a given ocaml version, it should stay installable no matter what in the future. Note that we are currently happy to merge package 2.a which are unavailable on some compiler version (if the package has a field "available") set or 2.b (because it depends on a package which have an "available" field set). Do you think that's a problem?

> So the best we can do today is to provide a detailed explanation of the reasons why
> a package cannot be installed when you click on the red cell: a package may
> depend on a missing package, on a package that is not installable, on packages
> that are in conflict, on version ranges of a package that have no installable
> candidate, and all this, of course, may happen arbitrarily far in the dependency
> graph; even if some effort to display the root causes is made, human
> intervention is needed to decide what to do then.

Yes, and that's already very useful! I just want a way to have only green cells there :-)

> Notice though that the presentation of these explanations is not yet optimal:
> since there are so many versions of packages around in the opam repository,
> providing a compact presentation is not as straghtforward as for the GNU/Linux
> distributions case; quite a bit of work has already gone into this issue
> (many thanks to Louis, btw) and is now being continued by an intern at Irill,
> but the jury is still out on what the right approach really is.

If you need feedback, do not hesitate to ask me (or this list). Would be great to have a tool that the opam-repository maintainers can use efficiently to improve the quality of the repository.

Best,
Thomas

> 
> --
> Roberto
> 
>>    Best,
>>    Thomas
>> 
>> 
>> 
>> 
>>        in the previous message
>> 
>>        2014-09-27 20:14 GMT+02:00 Roberto Di Cosmo <roberto at dicosmo.org>:
>> 
>>            Dear Thomas,
>>               I have some difficulty in understanding what exactly you do not
>>            understand in the reports present on OWS.
>> 
>>            Let me try to provide a few hints; a package is reported as "bad"
>>            for a given version and a given architecture if there is no way to
>>            satisfy its dependencies.
>> 
>>            This means that there is no way you can install it using opam, and
>>            even if the "code" shipped with the package may be perfectly fine,
>>            the "package" itself is nevertheless useless.
>> 
>>            This is why it is often termed "broken", following a terminology
>>            that is now standard in the world of package based distribution, as
>>            it has been in use for a couple of decades.
>> 
>>            Why a package is broken, who is responsible of fixing it, is
>>            another story: it can be the package maintainer that did not update
>>            the dependencies, or the maintainer of a dependency that has
>>            wrongly removed it, or the release manager that has not spotted the
>>            problem.
>> 
>>            In the framework of the Mancoosi project we have developed a full
>>            suite of tools to help improving the quality of a package based
>>            system, and it so happen that all these tools are even written in
>>            OCaml.
>> 
>>            I really do suggest that people on this list take the time and read
>>            the short support material that was developed by Zack, Ralf and me
>>            for the HATS summer school, and that is available here:
>>            http://www.dicosmo.org/Publications/Hats2012.html
>> 
>>            All the best
>> 
>>            --
>>            Roberto
>> 
>> 
>>            2014-09-27 19:43 GMT+02:00 Thomas Gazagnaire <thomas at gazagnaire.org
>>> :
>> 
>>                Hi,
>> 
>>                I had a quick look at "opam weather services" reports and I am
>>                a bit puzzled at how the statistic are computed. It seems that
>>                a package is considered as "broken" when one of its dependency
>>                cannot be installed. I'm not sure it makes sense: in the case
>>                the dependency is not available on a given platform / compiler
>>                version, then all the packages which depend upon it are not
>>                available as well as "availability" is a transitive relation in
>>                opam. These packages are not "broken".
>> 
>>                Especially, on that page: http://ows.irill.org/table.html a lot
>>                of "bad" result are in fact simply a result the package not
>>                available for the given compiler version.
>> 
>>                I'm sure they are packages which are actually broken (ie. there
>>                are no version of ocaml where they can be installed) and these
>>                should be much more useful to high-light in order than someone
>>                try to fix the descriptions (for instance me, when I am bored
>>                and have nothing else to do).
>> 
>>                Best,
>>                Thomas
>>                _______________________________________________
>>                opam-devel mailing list
>>                opam-devel at lists.ocaml.org
>>                http://lists.ocaml.org/listinfo/opam-devel
>> 
>> 
>> 
>> 
>>            --
>>            Roberto Di Cosmo
>> 
>>            ------------------------------------------------------------------
>>            Professeur               En delegation a l'INRIA
>>            PPS                      E-mail: roberto at dicosmo.org
>>            Universite Paris Diderot WWW  : http://www.dicosmo.org
>>            Case 7014                Tel  : ++33-(0)1-57 27 92 20
>>            5, Rue Thomas Mann       
>>            F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
>>            FRANCE.                  Twitter: http://twitter.com/rdicosmo
>>            ------------------------------------------------------------------
>>            Attachments:
>>            MIME accepted, Word deprecated
>>                  http://www.gnu.org/philosophy/no-word-attachments.html
>>            ------------------------------------------------------------------
>>            Office location:
>> 
>>            Bureau 320 (3rd floor)
>>            Batiment Sophie Germain
>>            Avenue de France
>>            Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
>>            -----------------------------------------------------------------
>>            GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 
>> 
>> 
>> 
>> 
>>        --
>>        Roberto Di Cosmo
>> 
>>        ------------------------------------------------------------------
>>        Professeur               En delegation a l'INRIA
>>        PPS                      E-mail: roberto at dicosmo.org
>>        Universite Paris Diderot WWW  : http://www.dicosmo.org
>>        Case 7014                Tel  : ++33-(0)1-57 27 92 20
>>        5, Rue Thomas Mann       
>>        F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
>>        FRANCE.                  Twitter: http://twitter.com/rdicosmo
>>        ------------------------------------------------------------------
>>        Attachments:
>>        MIME accepted, Word deprecated
>>              http://www.gnu.org/philosophy/no-word-attachments.html
>>        ------------------------------------------------------------------
>>        Office location:
>> 
>>        Bureau 320 (3rd floor)
>>        Batiment Sophie Germain
>>        Avenue de France
>>        Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
>>        -----------------------------------------------------------------
>>        GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 
>> 
>> 
>> 
>> 
> 
> -- 
> Roberto Di Cosmo
> 
> ------------------------------------------------------------------
> Professeur               En delegation a l'INRIA
> PPS                      E-mail: roberto at dicosmo.org
> Universite Paris Diderot WWW  : http://www.dicosmo.org
> Case 7014                Tel  : ++33-(0)1-57 27 92 20
> 5, Rue Thomas Mann       
> F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
> FRANCE.                  Twitter: http://twitter.com/rdicosmo
> ------------------------------------------------------------------
> Attachments:
> MIME accepted, Word deprecated
>      http://www.gnu.org/philosophy/no-word-attachments.html
> ------------------------------------------------------------------
> Office location:
> 
> Bureau 3020 (3rd floor)
> Batiment Sophie Germain
> Avenue de France
> Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
> -----------------------------------------------------------------
> GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        


From thomas at gazagnaire.org  Sun Sep 28 16:38:53 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Sun, 28 Sep 2014 16:38:53 +0100
Subject: [opam-devel] Travis CI failures
Message-ID: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>

Hi all,

Recently I saw Travis CI to be quite unreliable. It took sometimes hours to start and very often I need to manually re-lauch some tests because of connectivity errors. I don't complain too loudly because it's a free (and very useful) service, but I am wondering if we should not upgrade to something a bit more reliable.

Looking at https://travis-ci.com/plans they seem to have few paying offer which might be interesting, although I am not sure to understand if this will solve the current issues. And it looks a little bit expensive, but we rely on the free service a lot already. 

Also, ideally we should use Travis CI to only coordinate the build on the Rackspace VMs but we don't have that infrastructure in place yet, so  maybe we should switch to a paying service for few months.

What do people think?

Best,
Thomas

From anil at recoil.org  Sun Sep 28 21:03:12 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 28 Sep 2014 21:03:12 +0100
Subject: [opam-devel] Travis CI failures
In-Reply-To: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
Message-ID: <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>

On 28 Sep 2014, at 16:38, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:

> Hi all,
> 
> Recently I saw Travis CI to be quite unreliable. It took sometimes hours to start and very often I need to manually re-lauch some tests because of connectivity errors. I don't complain too loudly because it's a free (and very useful) service, but I am wondering if we should not upgrade to something a bit more reliable.
> 
> Looking at https://travis-ci.com/plans they seem to have few paying offer which might be interesting, although I am not sure to understand if this will solve the current issues. And it looks a little bit expensive, but we rely on the free service a lot already. 
> 
> Also, ideally we should use Travis CI to only coordinate the build on the Rackspace VMs but we don't have that infrastructure in place yet, so  maybe we should switch to a paying service for few months.

My understanding is that the paid Travis service doesn't entirely help with the existing issues, which are infrastructure overload on their part.  The paid service increases the number of parallel builds, but still (e.g.) enforces the per-job 50 minute limit.

I'll prioritise the Rackspace VM work to let us unlock more builds.  We're seeing an increasing number of repository failures due to the lack of reverse-transitive checking of builds, and that should be very easy to do in parallel on VM infrastructure.

(I may be wrong about the latest in paid Travis -- if anyone wants to enquire with them, please do let me know.  I'm happy to pay for the service if it would solve any problems.)

-anil


From agarwal1975 at gmail.com  Mon Sep 29 14:20:50 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Mon, 29 Sep 2014 09:20:50 -0400
Subject: [opam-devel] Travis CI failures
In-Reply-To: <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
Message-ID: <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>

About 10 - 20 minutes out of the 50 get used up installing OCaml and basic
libraries every time. Has anyone looked into getting OCaml as one of the
natively supported languages by Travis? I'm not sure how it works, but
ideally we could have preinstalled images with various versions of OCaml,
opam, and several of the main libraries pre-installed.

On Sun, Sep 28, 2014 at 4:03 PM, Anil Madhavapeddy <anil at recoil.org> wrote:

> On 28 Sep 2014, at 16:38, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
>
> > Hi all,
> >
> > Recently I saw Travis CI to be quite unreliable. It took sometimes hours
> to start and very often I need to manually re-lauch some tests because of
> connectivity errors. I don't complain too loudly because it's a free (and
> very useful) service, but I am wondering if we should not upgrade to
> something a bit more reliable.
> >
> > Looking at https://travis-ci.com/plans they seem to have few paying
> offer which might be interesting, although I am not sure to understand if
> this will solve the current issues. And it looks a little bit expensive,
> but we rely on the free service a lot already.
> >
> > Also, ideally we should use Travis CI to only coordinate the build on
> the Rackspace VMs but we don't have that infrastructure in place yet, so
> maybe we should switch to a paying service for few months.
>
> My understanding is that the paid Travis service doesn't entirely help
> with the existing issues, which are infrastructure overload on their part.
> The paid service increases the number of parallel builds, but still (e.g.)
> enforces the per-job 50 minute limit.
>
> I'll prioritise the Rackspace VM work to let us unlock more builds.  We're
> seeing an increasing number of repository failures due to the lack of
> reverse-transitive checking of builds, and that should be very easy to do
> in parallel on VM infrastructure.
>
> (I may be wrong about the latest in paid Travis -- if anyone wants to
> enquire with them, please do let me know.  I'm happy to pay for the service
> if it would solve any problems.)
>
> -anil
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140929/745e798d/attachment.html>

From anil at recoil.org  Mon Sep 29 14:24:26 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Mon, 29 Sep 2014 14:24:26 +0100
Subject: [opam-devel] Travis CI failures
In-Reply-To: <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
 <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
Message-ID: <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>

None of the time is spent installing OCaml on the basic Linux install, since I've been compiling up a set of binary Debs/RPMs of the matrix of OCaml and OPAM versions (e.g. see https://launchpad.net/~avsm).  We only compile from source on the Mac, which is optional.

If someone is interested in proposing official OCaml support, a good template for anyone wishing to OCaml support in Travis is the pull request to add Rust support here:
https://github.com/travis-ci/travis-build/pull/264/files

-anil

On 29 Sep 2014, at 14:20, Ashish Agarwal <agarwal1975 at gmail.com> wrote:

> About 10 - 20 minutes out of the 50 get used up installing OCaml and basic libraries every time. Has anyone looked into getting OCaml as one of the natively supported languages by Travis? I'm not sure how it works, but ideally we could have preinstalled images with various versions of OCaml, opam, and several of the main libraries pre-installed.
> 
> On Sun, Sep 28, 2014 at 4:03 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
> On 28 Sep 2014, at 16:38, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
> 
> > Hi all,
> >
> > Recently I saw Travis CI to be quite unreliable. It took sometimes hours to start and very often I need to manually re-lauch some tests because of connectivity errors. I don't complain too loudly because it's a free (and very useful) service, but I am wondering if we should not upgrade to something a bit more reliable.
> >
> > Looking at https://travis-ci.com/plans they seem to have few paying offer which might be interesting, although I am not sure to understand if this will solve the current issues. And it looks a little bit expensive, but we rely on the free service a lot already.
> >
> > Also, ideally we should use Travis CI to only coordinate the build on the Rackspace VMs but we don't have that infrastructure in place yet, so  maybe we should switch to a paying service for few months.
> 
> My understanding is that the paid Travis service doesn't entirely help with the existing issues, which are infrastructure overload on their part.  The paid service increases the number of parallel builds, but still (e.g.) enforces the per-job 50 minute limit.
> 
> I'll prioritise the Rackspace VM work to let us unlock more builds.  We're seeing an increasing number of repository failures due to the lack of reverse-transitive checking of builds, and that should be very easy to do in parallel on VM infrastructure.
> 
> (I may be wrong about the latest in paid Travis -- if anyone wants to enquire with them, please do let me know.  I'm happy to pay for the service if it would solve any problems.)
> 
> -anil
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140929/077e1bae/attachment.html>

From thomas at gazagnaire.org  Mon Sep 29 14:59:59 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Mon, 29 Sep 2014 14:59:59 +0100
Subject: [opam-devel] call for help: opam history
Message-ID: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>

Hi all,

I've tried to describe the history of opam (from my imperfect memories) in there:

https://github.com/ocaml/opam/wiki/History

Please feel free to comment/add evenst/fix existing events. I apologies in advance if you think you are involved and you are not mentioned, or if I recalled things wrongly. In that case, either fix the document directly (everyone can edit it) or send me an email and I'll do it directly. Many people were (and are) involved in the project, so please help me make that document as accurate as possible!

Once that document is good enough (ideally in a couple of weeks), it will replace http://opam.ocaml.org/about.html as I've heard people complaining about it multiple times already.

Best,
Thomas

From agarwal1975 at gmail.com  Mon Sep 29 17:36:25 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Mon, 29 Sep 2014 12:36:25 -0400
Subject: [opam-devel] Travis CI failures
In-Reply-To: <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
 <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
 <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>
Message-ID: <CAMu2m2+0AiWQfnB2SZ0VYxB5Bt7cWMO91h386KFqdOmM3NX6TQ@mail.gmail.com>

Are the travis scripts for opam public? Where are they? Maybe I can learn
from them.

In my own repos, I haven't managed to use the system compiler. I'm forced
to do `opam switch --comp=4.02.0`, which causes me to compile ocaml every
time. Here are the problems I have with the binary system compilers:

*On Ubuntu*
I use Anil's PPAs, and successfully do:

apt-get install ocaml opam camlp4

However, I then request to install a bunch of opam packges and am told that:

The following actions will be performed:

 - install   camlp4.4.02.0+system                  [required by
variantslib, tyxml, type_conv, sexplib, pgocaml, pa_ounit, optcomp,
ocamlscript, js_of_ocaml, fieldslib, enumerate, custom_printf, core_kernel,
comparelib, bitstring, async_unix, async_extra, async, async_kernel,
bin_prot, camomile, core, cudf, dyntype, extlib, herelib, lwt, ocp-build,
pa_bench, pa_test, pipebang, textutils, typerep, ulex]


And then installation of camlp4 fails with:

./check-camlp4.sh: 3: ./check-camlp4.sh: camlp4orf: not found

Indeed camlp4orf is not installed.


*On CentOS*
I follow the instructions here
<http://software.opensuse.org/download.html?project=home:ocaml&package=opam>,
successfully do `yum install ocaml opam` (it seems there is no camlp4
binary provided). I then request to install a bunch of opam packages, and
many fail with:

Cannot find external tool 'ocamldoc'

Indeed ocamldoc is not installed.


If I can get the correct procedure to follow, I'll be happy to update
ocaml.org's Install page.




On Mon, Sep 29, 2014 at 9:24 AM, Anil Madhavapeddy <anil at recoil.org> wrote:

> None of the time is spent installing OCaml on the basic Linux install,
> since I've been compiling up a set of binary Debs/RPMs of the matrix of
> OCaml and OPAM versions (e.g. see https://launchpad.net/~avsm).  We only
> compile from source on the Mac, which is optional.
>
> If someone is interested in proposing official OCaml support, a good
> template for anyone wishing to OCaml support in Travis is the pull request
> to add Rust support here:
> https://github.com/travis-ci/travis-build/pull/264/files
>
> -anil
>
> On 29 Sep 2014, at 14:20, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
>
> About 10 - 20 minutes out of the 50 get used up installing OCaml and basic
> libraries every time. Has anyone looked into getting OCaml as one of the
> natively supported languages by Travis? I'm not sure how it works, but
> ideally we could have preinstalled images with various versions of OCaml,
> opam, and several of the main libraries pre-installed.
>
> On Sun, Sep 28, 2014 at 4:03 PM, Anil Madhavapeddy <anil at recoil.org>
> wrote:
>
>> On 28 Sep 2014, at 16:38, Thomas Gazagnaire <thomas at gazagnaire.org>
>> wrote:
>>
>> > Hi all,
>> >
>> > Recently I saw Travis CI to be quite unreliable. It took sometimes
>> hours to start and very often I need to manually re-lauch some tests
>> because of connectivity errors. I don't complain too loudly because it's a
>> free (and very useful) service, but I am wondering if we should not upgrade
>> to something a bit more reliable.
>> >
>> > Looking at https://travis-ci.com/plans they seem to have few paying
>> offer which might be interesting, although I am not sure to understand if
>> this will solve the current issues. And it looks a little bit expensive,
>> but we rely on the free service a lot already.
>> >
>> > Also, ideally we should use Travis CI to only coordinate the build on
>> the Rackspace VMs but we don't have that infrastructure in place yet, so
>> maybe we should switch to a paying service for few months.
>>
>> My understanding is that the paid Travis service doesn't entirely help
>> with the existing issues, which are infrastructure overload on their part.
>> The paid service increases the number of parallel builds, but still (e.g.)
>> enforces the per-job 50 minute limit.
>>
>> I'll prioritise the Rackspace VM work to let us unlock more builds.
>> We're seeing an increasing number of repository failures due to the lack of
>> reverse-transitive checking of builds, and that should be very easy to do
>> in parallel on VM infrastructure.
>>
>> (I may be wrong about the latest in paid Travis -- if anyone wants to
>> enquire with them, please do let me know.  I'm happy to pay for the service
>> if it would solve any problems.)
>>
>> -anil
>>
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
>>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140929/bd53488e/attachment-0001.html>

From amc79 at cam.ac.uk  Mon Sep 29 17:47:19 2014
From: amc79 at cam.ac.uk (Amir Chaudhry)
Date: Mon, 29 Sep 2014 17:47:19 +0100
Subject: [opam-devel] Travis CI failures
In-Reply-To: <CAMu2m2+0AiWQfnB2SZ0VYxB5Bt7cWMO91h386KFqdOmM3NX6TQ@mail.gmail.com>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
 <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
 <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>
 <CAMu2m2+0AiWQfnB2SZ0VYxB5Bt7cWMO91h386KFqdOmM3NX6TQ@mail.gmail.com>
Message-ID: <95EC1B02-B66F-4590-B7D9-FE2AF29F52AE@cam.ac.uk>


On 29 Sep 2014, at 17:36, Ashish Agarwal <agarwal1975 at gmail.com> wrote:

> Are the travis scripts for opam public? Where are they? Maybe I can learn from them.

Do you mean the files in the opam repo [1]? You can see the travis outputs online too [2], though I note that the build matrix doesn't include 4.02.0, (though the script does).

[1] https://github.com/ocaml/opam/blob/master/.travis-ci.sh
[2] https://travis-ci.org/ocaml/opam 

AC

> 
> In my own repos, I haven't managed to use the system compiler. I'm forced to do `opam switch --comp=4.02.0`, which causes me to compile ocaml every time. Here are the problems I have with the binary system compilers:
> 
> On Ubuntu
> I use Anil's PPAs, and successfully do:
> 
> apt-get install ocaml opam camlp4
> 
> However, I then request to install a bunch of opam packges and am told that:
> 
> The following actions will be performed:
> 
>  - install   camlp4.4.02.0+system                  [required by variantslib, tyxml, type_conv, sexplib, pgocaml, pa_ounit, optcomp, ocamlscript, js_of_ocaml, fieldslib, enumerate, custom_printf, core_kernel, comparelib, bitstring, async_unix, async_extra, async, async_kernel, bin_prot, camomile, core, cudf, dyntype, extlib, herelib, lwt, ocp-build, pa_bench, pa_test, pipebang, textutils, typerep, ulex]
> 
> 
> And then installation of camlp4 fails with:
> 
> ./check-camlp4.sh: 3: ./check-camlp4.sh: camlp4orf: not found
> 
> Indeed camlp4orf is not installed.
> 
> 
> On CentOS
> I follow the instructions here, successfully do `yum install ocaml opam` (it seems there is no camlp4 binary provided). I then request to install a bunch of opam packages, and many fail with:
> 
> Cannot find external tool 'ocamldoc'
> 
> Indeed ocamldoc is not installed.
> 
> 
> If I can get the correct procedure to follow, I'll be happy to update ocaml.org's Install page.
> 
> 
> 
> 
> On Mon, Sep 29, 2014 at 9:24 AM, Anil Madhavapeddy <anil at recoil.org> wrote:
> None of the time is spent installing OCaml on the basic Linux install, since I've been compiling up a set of binary Debs/RPMs of the matrix of OCaml and OPAM versions (e.g. see https://launchpad.net/~avsm).  We only compile from source on the Mac, which is optional.
> 
> If someone is interested in proposing official OCaml support, a good template for anyone wishing to OCaml support in Travis is the pull request to add Rust support here:
> https://github.com/travis-ci/travis-build/pull/264/files
> 
> -anil
> 
> On 29 Sep 2014, at 14:20, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
> 
>> About 10 - 20 minutes out of the 50 get used up installing OCaml and basic libraries every time. Has anyone looked into getting OCaml as one of the natively supported languages by Travis? I'm not sure how it works, but ideally we could have preinstalled images with various versions of OCaml, opam, and several of the main libraries pre-installed.
>> 
>> On Sun, Sep 28, 2014 at 4:03 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>> On 28 Sep 2014, at 16:38, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
>> 
>> > Hi all,
>> >
>> > Recently I saw Travis CI to be quite unreliable. It took sometimes hours to start and very often I need to manually re-lauch some tests because of connectivity errors. I don't complain too loudly because it's a free (and very useful) service, but I am wondering if we should not upgrade to something a bit more reliable.
>> >
>> > Looking at https://travis-ci.com/plans they seem to have few paying offer which might be interesting, although I am not sure to understand if this will solve the current issues. And it looks a little bit expensive, but we rely on the free service a lot already.
>> >
>> > Also, ideally we should use Travis CI to only coordinate the build on the Rackspace VMs but we don't have that infrastructure in place yet, so  maybe we should switch to a paying service for few months.
>> 
>> My understanding is that the paid Travis service doesn't entirely help with the existing issues, which are infrastructure overload on their part.  The paid service increases the number of parallel builds, but still (e.g.) enforces the per-job 50 minute limit.
>> 
>> I'll prioritise the Rackspace VM work to let us unlock more builds.  We're seeing an increasing number of repository failures due to the lack of reverse-transitive checking of builds, and that should be very easy to do in parallel on VM infrastructure.
>> 
>> (I may be wrong about the latest in paid Travis -- if anyone wants to enquire with them, please do let me know.  I'm happy to pay for the service if it would solve any problems.)
>> 
>> -anil
>> 
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
>> 
> 
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From thomas at gazagnaire.org  Mon Sep 29 18:12:51 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Mon, 29 Sep 2014 18:12:51 +0100
Subject: [opam-devel] Travis CI failures
In-Reply-To: <95EC1B02-B66F-4590-B7D9-FE2AF29F52AE@cam.ac.uk>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
 <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
 <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>
 <CAMu2m2+0AiWQfnB2SZ0VYxB5Bt7cWMO91h386KFqdOmM3NX6TQ@mail.gmail.com>
 <95EC1B02-B66F-4590-B7D9-FE2AF29F52AE@cam.ac.uk>
Message-ID: <40DD484E-CBFF-442D-A5E6-0BA02E1DEA91@gazagnaire.org>

>> Are the travis scripts for opam public? Where are they? Maybe I can learn from them.
> 
> Do you mean the files in the opam repo [1]? You can see the travis outputs online too [2], though I note that the build matrix doesn't include 4.02.0, (though the script does).
> 
> [1] https://github.com/ocaml/opam/blob/master/.travis-ci.sh
> [2] https://travis-ci.org/ocaml/opam 

Almost :-)

The right urls are:
[1] https://github.com/ocaml/opam-repository/blob/master/.travis-ci.sh
[1]' https://github.com/ocaml/opam-repository/blob/master/.travis.yml
[2] https://travis-ci.org/ocaml/opam-repository

> AC
> 
>> 
>> In my own repos, I haven't managed to use the system compiler. I'm forced to do `opam switch --comp=4.02.0`, which causes me to compile ocaml every time. Here are the problems I have with the binary system compilers:
>> 
>> On Ubuntu
>> I use Anil's PPAs, and successfully do:
>> 
>> apt-get install ocaml opam camlp4
>> 
>> However, I then request to install a bunch of opam packges and am told that:
>> 
>> The following actions will be performed:
>> 
>> - install   camlp4.4.02.0+system                  [required by variantslib, tyxml, type_conv, sexplib, pgocaml, pa_ounit, optcomp, ocamlscript, js_of_ocaml, fieldslib, enumerate, custom_printf, core_kernel, comparelib, bitstring, async_unix, async_extra, async, async_kernel, bin_prot, camomile, core, cudf, dyntype, extlib, herelib, lwt, ocp-build, pa_bench, pa_test, pipebang, textutils, typerep, ulex]
>> 
>> 
>> And then installation of camlp4 fails with:
>> 
>> ./check-camlp4.sh: 3: ./check-camlp4.sh: camlp4orf: not found
>> 
>> Indeed camlp4orf is not installed.
>> 
>> 
>> On CentOS
>> I follow the instructions here, successfully do `yum install ocaml opam` (it seems there is no camlp4 binary provided). I then request to install a bunch of opam packages, and many fail with:
>> 
>> Cannot find external tool 'ocamldoc'
>> 
>> Indeed ocamldoc is not installed.
>> 
>> 
>> If I can get the correct procedure to follow, I'll be happy to update ocaml.org's Install page.
>> 
>> 
>> 
>> 
>> On Mon, Sep 29, 2014 at 9:24 AM, Anil Madhavapeddy <anil at recoil.org> wrote:
>> None of the time is spent installing OCaml on the basic Linux install, since I've been compiling up a set of binary Debs/RPMs of the matrix of OCaml and OPAM versions (e.g. see https://launchpad.net/~avsm).  We only compile from source on the Mac, which is optional.
>> 
>> If someone is interested in proposing official OCaml support, a good template for anyone wishing to OCaml support in Travis is the pull request to add Rust support here:
>> https://github.com/travis-ci/travis-build/pull/264/files
>> 
>> -anil
>> 
>> On 29 Sep 2014, at 14:20, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
>> 
>>> About 10 - 20 minutes out of the 50 get used up installing OCaml and basic libraries every time. Has anyone looked into getting OCaml as one of the natively supported languages by Travis? I'm not sure how it works, but ideally we could have preinstalled images with various versions of OCaml, opam, and several of the main libraries pre-installed.
>>> 
>>> On Sun, Sep 28, 2014 at 4:03 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>>> On 28 Sep 2014, at 16:38, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
>>> 
>>>> Hi all,
>>>> 
>>>> Recently I saw Travis CI to be quite unreliable. It took sometimes hours to start and very often I need to manually re-lauch some tests because of connectivity errors. I don't complain too loudly because it's a free (and very useful) service, but I am wondering if we should not upgrade to something a bit more reliable.
>>>> 
>>>> Looking at https://travis-ci.com/plans they seem to have few paying offer which might be interesting, although I am not sure to understand if this will solve the current issues. And it looks a little bit expensive, but we rely on the free service a lot already.
>>>> 
>>>> Also, ideally we should use Travis CI to only coordinate the build on the Rackspace VMs but we don't have that infrastructure in place yet, so  maybe we should switch to a paying service for few months.
>>> 
>>> My understanding is that the paid Travis service doesn't entirely help with the existing issues, which are infrastructure overload on their part.  The paid service increases the number of parallel builds, but still (e.g.) enforces the per-job 50 minute limit.
>>> 
>>> I'll prioritise the Rackspace VM work to let us unlock more builds.  We're seeing an increasing number of repository failures due to the lack of reverse-transitive checking of builds, and that should be very easy to do in parallel on VM infrastructure.
>>> 
>>> (I may be wrong about the latest in paid Travis -- if anyone wants to enquire with them, please do let me know.  I'm happy to pay for the service if it would solve any problems.)
>>> 
>>> -anil
>>> 
>>> _______________________________________________
>>> opam-devel mailing list
>>> opam-devel at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/opam-devel
>>> 
>> 
>> 
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From agarwal1975 at gmail.com  Mon Sep 29 19:46:46 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Mon, 29 Sep 2014 14:46:46 -0400
Subject: [opam-devel] Travis CI failures
In-Reply-To: <40DD484E-CBFF-442D-A5E6-0BA02E1DEA91@gazagnaire.org>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
 <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
 <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>
 <CAMu2m2+0AiWQfnB2SZ0VYxB5Bt7cWMO91h386KFqdOmM3NX6TQ@mail.gmail.com>
 <95EC1B02-B66F-4590-B7D9-FE2AF29F52AE@cam.ac.uk>
 <40DD484E-CBFF-442D-A5E6-0BA02E1DEA91@gazagnaire.org>
Message-ID: <CAMu2m2Lbz2f2vWaDiCMPmA05SxkLwanNvN89T9R-VwRHGJSBqw@mail.gmail.com>

Thanks. I now have it working on Ubuntu. The issue is that several OS
packages have to be installed, not just "ocaml" and "camlp4". Thus, the
instructions [1,2] we've been linking people to are incomplete.

I still don't know what to do on CentOS to get ocamldoc. Does anyone have
the full list of packages for each OS?

Why are multiple packages needed? I would expect "apt-get install ocaml" or
"yum install ocaml" to install everything that one gets from installing the
source distribution of OCaml.

[1]
http://software.opensuse.org/download.html?project=home:ocaml&package=opam
[2]
http://software.opensuse.org/download.html?project=home:ocaml&package=ocaml



On Mon, Sep 29, 2014 at 1:12 PM, Thomas Gazagnaire <thomas at gazagnaire.org>
wrote:

> >> Are the travis scripts for opam public? Where are they? Maybe I can
> learn from them.
> >
> > Do you mean the files in the opam repo [1]? You can see the travis
> outputs online too [2], though I note that the build matrix doesn't include
> 4.02.0, (though the script does).
> >
> > [1] https://github.com/ocaml/opam/blob/master/.travis-ci.sh
> > [2] https://travis-ci.org/ocaml/opam
>
> Almost :-)
>
> The right urls are:
> [1] https://github.com/ocaml/opam-repository/blob/master/.travis-ci.sh
> [1]' https://github.com/ocaml/opam-repository/blob/master/.travis.yml
> [2] https://travis-ci.org/ocaml/opam-repository
>
> > AC
> >
> >>
> >> In my own repos, I haven't managed to use the system compiler. I'm
> forced to do `opam switch --comp=4.02.0`, which causes me to compile ocaml
> every time. Here are the problems I have with the binary system compilers:
> >>
> >> On Ubuntu
> >> I use Anil's PPAs, and successfully do:
> >>
> >> apt-get install ocaml opam camlp4
> >>
> >> However, I then request to install a bunch of opam packges and am told
> that:
> >>
> >> The following actions will be performed:
> >>
> >> - install   camlp4.4.02.0+system                  [required by
> variantslib, tyxml, type_conv, sexplib, pgocaml, pa_ounit, optcomp,
> ocamlscript, js_of_ocaml, fieldslib, enumerate, custom_printf, core_kernel,
> comparelib, bitstring, async_unix, async_extra, async, async_kernel,
> bin_prot, camomile, core, cudf, dyntype, extlib, herelib, lwt, ocp-build,
> pa_bench, pa_test, pipebang, textutils, typerep, ulex]
> >>
> >>
> >> And then installation of camlp4 fails with:
> >>
> >> ./check-camlp4.sh: 3: ./check-camlp4.sh: camlp4orf: not found
> >>
> >> Indeed camlp4orf is not installed.
> >>
> >>
> >> On CentOS
> >> I follow the instructions here, successfully do `yum install ocaml
> opam` (it seems there is no camlp4 binary provided). I then request to
> install a bunch of opam packages, and many fail with:
> >>
> >> Cannot find external tool 'ocamldoc'
> >>
> >> Indeed ocamldoc is not installed.
> >>
> >>
> >> If I can get the correct procedure to follow, I'll be happy to update
> ocaml.org's Install page.
> >>
> >>
> >>
> >>
> >> On Mon, Sep 29, 2014 at 9:24 AM, Anil Madhavapeddy <anil at recoil.org>
> wrote:
> >> None of the time is spent installing OCaml on the basic Linux install,
> since I've been compiling up a set of binary Debs/RPMs of the matrix of
> OCaml and OPAM versions (e.g. see https://launchpad.net/~avsm).  We only
> compile from source on the Mac, which is optional.
> >>
> >> If someone is interested in proposing official OCaml support, a good
> template for anyone wishing to OCaml support in Travis is the pull request
> to add Rust support here:
> >> https://github.com/travis-ci/travis-build/pull/264/files
> >>
> >> -anil
> >>
> >> On 29 Sep 2014, at 14:20, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
> >>
> >>> About 10 - 20 minutes out of the 50 get used up installing OCaml and
> basic libraries every time. Has anyone looked into getting OCaml as one of
> the natively supported languages by Travis? I'm not sure how it works, but
> ideally we could have preinstalled images with various versions of OCaml,
> opam, and several of the main libraries pre-installed.
> >>>
> >>> On Sun, Sep 28, 2014 at 4:03 PM, Anil Madhavapeddy <anil at recoil.org>
> wrote:
> >>> On 28 Sep 2014, at 16:38, Thomas Gazagnaire <thomas at gazagnaire.org>
> wrote:
> >>>
> >>>> Hi all,
> >>>>
> >>>> Recently I saw Travis CI to be quite unreliable. It took sometimes
> hours to start and very often I need to manually re-lauch some tests
> because of connectivity errors. I don't complain too loudly because it's a
> free (and very useful) service, but I am wondering if we should not upgrade
> to something a bit more reliable.
> >>>>
> >>>> Looking at https://travis-ci.com/plans they seem to have few paying
> offer which might be interesting, although I am not sure to understand if
> this will solve the current issues. And it looks a little bit expensive,
> but we rely on the free service a lot already.
> >>>>
> >>>> Also, ideally we should use Travis CI to only coordinate the build on
> the Rackspace VMs but we don't have that infrastructure in place yet, so
> maybe we should switch to a paying service for few months.
> >>>
> >>> My understanding is that the paid Travis service doesn't entirely help
> with the existing issues, which are infrastructure overload on their part.
> The paid service increases the number of parallel builds, but still (e.g.)
> enforces the per-job 50 minute limit.
> >>>
> >>> I'll prioritise the Rackspace VM work to let us unlock more builds.
> We're seeing an increasing number of repository failures due to the lack of
> reverse-transitive checking of builds, and that should be very easy to do
> in parallel on VM infrastructure.
> >>>
> >>> (I may be wrong about the latest in paid Travis -- if anyone wants to
> enquire with them, please do let me know.  I'm happy to pay for the service
> if it would solve any problems.)
> >>>
> >>> -anil
> >>>
> >>> _______________________________________________
> >>> opam-devel mailing list
> >>> opam-devel at lists.ocaml.org
> >>> http://lists.ocaml.org/listinfo/opam-devel
> >>>
> >>
> >>
> >> _______________________________________________
> >> opam-devel mailing list
> >> opam-devel at lists.ocaml.org
> >> http://lists.ocaml.org/listinfo/opam-devel
> >
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140929/b3736b72/attachment-0001.html>

From anil at recoil.org  Tue Sep 30 09:19:34 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 09:19:34 +0100
Subject: [opam-devel] call for help: opam history
In-Reply-To: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
Message-ID: <9F71EE92-B838-4422-B619-F9D3D70AD3A7@recoil.org>

Hi Thomas,

Looks good to me -- I made some edits (mainly for language and to add links to your OCaml Workshop 2012 video).  The only thing missing that I can see is the shift to opam.ocaml.org (and a thank you to Rackspace for the hosting) and David Sheets' work on opam2web/opamfu.

It would also be nice to give a shout out to the various folk who have contributed binary packages such as Mehdi, Vincent, Nicolas, Malcolm, Vsevolod and Christopher -- https://github.com/ocaml/opam/wiki/Distributions

best,
Anil


On 29 Sep 2014, at 14:59, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:

> Hi all,
> 
> I've tried to describe the history of opam (from my imperfect memories) in there:
> 
> https://github.com/ocaml/opam/wiki/History
> 
> Please feel free to comment/add evenst/fix existing events. I apologies in advance if you think you are involved and you are not mentioned, or if I recalled things wrongly. In that case, either fix the document directly (everyone can edit it) or send me an email and I'll do it directly. Many people were (and are) involved in the project, so please help me make that document as accurate as possible!
> 
> Once that document is good enough (ideally in a couple of weeks), it will replace http://opam.ocaml.org/about.html as I've heard people complaining about it multiple times already.
> 
> Best,
> Thomas
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
> 


From anil at recoil.org  Tue Sep 30 09:27:07 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 09:27:07 +0100
Subject: [opam-devel] Travis CI failures
In-Reply-To: <CAMu2m2Lbz2f2vWaDiCMPmA05SxkLwanNvN89T9R-VwRHGJSBqw@mail.gmail.com>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
 <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
 <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>
 <CAMu2m2+0AiWQfnB2SZ0VYxB5Bt7cWMO91h386KFqdOmM3NX6TQ@mail.gmail.com>
 <95EC1B02-B66F-4590-B7D9-FE2AF29F52AE@cam.ac.uk>
 <40DD484E-CBFF-442D-A5E6-0BA02E1DEA91@gazagnaire.org>
 <CAMu2m2Lbz2f2vWaDiCMPmA05SxkLwanNvN89T9R-VwRHGJSBqw@mail.gmail.com>
Message-ID: <1BB48871-6BBA-4E6D-B5E7-2CE0633CA153@recoil.org>

On 29 Sep 2014, at 19:46, Ashish Agarwal <agarwal1975 at gmail.com> wrote:

> Thanks. I now have it working on Ubuntu. The issue is that several OS packages have to be installed, not just "ocaml" and "camlp4". Thus, the instructions [1,2] we've been linking people to are incomplete.

That's right -- this has always been the case historically on Debian (somewhat suboptimally I think, but it fits in with their distribution criteria).  I usually do "ocaml ocaml-native-compilers camlp4-extra" to get everything.

> 
> I still don't know what to do on CentOS to get ocamldoc. Does anyone have the full list of packages for each OS?

You should have got ocamldoc with just ocaml there.  I believe you just need "ocaml" and "ocaml-camlp4" on CentOS, but please correct me if that's wrong.  I don't regularly use it and so could have missed something in the packaging.

> 
> Why are multiple packages needed? I would expect "apt-get install ocaml" or "yum install ocaml" to install everything that one gets from installing the source distribution of OCaml.
> 
> [1] http://software.opensuse.org/download.html?project=home:ocaml&package=opam
> [2] http://software.opensuse.org/download.html?project=home:ocaml&package=ocaml

That's just following upstream packaging practises.  I think it's better to do that and to document what packages are needed, rather than changing it for our local efforts.

However, it could be easier.  I'll take a look at making the Travis scripts a bit more automated by sourcing a central copy of the script from somewhere on GitHub.  That'll reduce the rate of cut and pastes..

-anil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140930/3f4e75ed/attachment.html>

From roberto at dicosmo.org  Tue Sep 30 10:28:10 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 30 Sep 2014 11:28:10 +0200
Subject: [opam-devel] call for help: opam history
In-Reply-To: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
Message-ID: <CAJBwKuXA1_eUSTpVDPG28z8pa3Cfj81AQj=HoPunS3R=8PYD5Q@mail.gmail.com>

Thank Thomas for starting this... I'll try to have a look later this week

2014-09-29 15:59 GMT+02:00 Thomas Gazagnaire <thomas at gazagnaire.org>:

> Hi all,
>
> I've tried to describe the history of opam (from my imperfect memories) in
> there:
>
> https://github.com/ocaml/opam/wiki/History
>
> Please feel free to comment/add evenst/fix existing events. I apologies in
> advance if you think you are involved and you are not mentioned, or if I
> recalled things wrongly. In that case, either fix the document directly
> (everyone can edit it) or send me an email and I'll do it directly. Many
> people were (and are) involved in the project, so please help me make that
> document as accurate as possible!
>
> Once that document is good enough (ideally in a couple of weeks), it will
> replace http://opam.ocaml.org/about.html as I've heard people complaining
> about it multiple times already.
>
> Best,
> Thomas
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>



-- 
Roberto Di Cosmo

------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:

Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140930/acd19b14/attachment.html>

From Fabrice.Le_fessant at inria.fr  Tue Sep 30 10:47:51 2014
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Tue, 30 Sep 2014 11:47:51 +0200
Subject: [opam-devel] call for help: opam history
In-Reply-To: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
Message-ID: <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>

Hi Thomas,

On Mon, Sep 29, 2014 at 3:59 PM, Thomas Gazagnaire
<thomas at gazagnaire.org> wrote:
> Once that document is good enough (ideally in a couple of weeks), it will replace http://opam.ocaml.org/about.html as I've heard people complaining about it multiple times already.

Could you be more explicit about the complains that you have heard
about this page ?

>From my point of view, the new presentation starts too late: the first
ideas of OPAM were in DORM, and the DORM proposal was submitted to the
French state in 2010. The main idea of DORM was to develop a new
package manager for OCaml, using the DOSE technology from the Mancoosi
team. Then, Yaron contacted OCamlPro in mi-november 2011 to put more
manpower on the design of new package manager for OCaml. Also, in the
opam-repository description, I thought the first 200 packages were
mostly packaged by Frederic Tuong, who spent almost 6 months doing
only that. Am I wrong ?

Best,
--Fabrice
-- 
Fabrice LE FESSANT
Chercheur en Informatique
INRIA Paris Rocquencourt -- OCamlPro
Programming Languages and Distributed Systems

From anil at recoil.org  Tue Sep 30 11:34:58 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 11:34:58 +0100
Subject: [opam-devel] call for help: opam history
In-Reply-To: <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
Message-ID: <98611B76-B012-4039-91ED-918B23743005@recoil.org>

On 30 Sep 2014, at 10:47, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:
> 
> From my point of view, the new presentation starts too late: the first
> ideas of OPAM were in DORM, and the DORM proposal was submitted to the
> French state in 2010. The main idea of DORM was to develop a new
> package manager for OCaml, using the DOSE technology from the Mancoosi
> team. Then, Yaron contacted OCamlPro in mi-november 2011 to put more
> manpower on the design of new package manager for OCaml.

This sounds like ideal for the start of the history.  Why not edit it
in yourself as Thomas suggested?  Did DORM get funded btw?  Linking to
any other outputs from the project would also help round out the history.

> Also, in the opam-repository description, I thought the first 200 packages were
> mostly packaged by Frederic Tuong, who spent almost 6 months doing
> only that. Am I wrong ?

This was an excellent excuse to try gitinspector out:
http://www.recoil.org/~avsm/opam-repo-stats.html

The stats may be misleading if there was rebasing going on in the early
days, so take those with a pinch of salt.  The tool did output month
by month commit statistics which may help jog memories though.
(see the "history timeline" section of the page)

-anil

From anil at recoil.org  Tue Sep 30 11:50:41 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 11:50:41 +0100
Subject: [opam-devel] call for help: opam history
In-Reply-To: <98611B76-B012-4039-91ED-918B23743005@recoil.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <98611B76-B012-4039-91ED-918B23743005@recoil.org>
Message-ID: <726FF787-81BF-4274-BDD9-7659D39ED04B@recoil.org>

Somewhat orthogonal, but the history of CPAN in Perl is nice.  It's more of an ongoing tale...

http://cpan.io/ref/history.html

-anil

From sylvain+ocaml at le-gall.net  Tue Sep 30 13:02:04 2014
From: sylvain+ocaml at le-gall.net (Sylvain Le Gall)
Date: Tue, 30 Sep 2014 14:02:04 +0200
Subject: [opam-devel] call for help: opam history
In-Reply-To: <98611B76-B012-4039-91ED-918B23743005@recoil.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <98611B76-B012-4039-91ED-918B23743005@recoil.org>
Message-ID: <CAOCAUGMuE80tAmaZqTmLGv6peuR0jONhaU1tiNg0KLO9pMfGmA@mail.gmail.com>

I tried to look for DORM documentation and the only thing I can find is:
http://www.irill.org/blog/homepage
IRILL days 2010
16h00-16h30 DORM, the missing tool to persist your deliveries, Pierre
Queinnec (Zenika)

There are no more data on that (no slides). Given the background of
Zenika, this look a lot like something Java related.

I am sure Fabrice is right about the fact that some ideas of opam were
in DORM proposal, but given the lack of documentation and the kind
tools it seems to be from the few hints you can gather I would not
mention it. This can be misleading.


2014-09-30 12:34 GMT+02:00 Anil Madhavapeddy <anil at recoil.org>:
> On 30 Sep 2014, at 10:47, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:
>>
>> From my point of view, the new presentation starts too late: the first
>> ideas of OPAM were in DORM, and the DORM proposal was submitted to the
>> French state in 2010. The main idea of DORM was to develop a new
>> package manager for OCaml, using the DOSE technology from the Mancoosi
>> team. Then, Yaron contacted OCamlPro in mi-november 2011 to put more
>> manpower on the design of new package manager for OCaml.
>
> This sounds like ideal for the start of the history.  Why not edit it
> in yourself as Thomas suggested?  Did DORM get funded btw?  Linking to
> any other outputs from the project would also help round out the history.
>
>> Also, in the opam-repository description, I thought the first 200 packages were
>> mostly packaged by Frederic Tuong, who spent almost 6 months doing
>> only that. Am I wrong ?
>
> This was an excellent excuse to try gitinspector out:
> http://www.recoil.org/~avsm/opam-repo-stats.html
>
> The stats may be misleading if there was rebasing going on in the early
> days, so take those with a pinch of salt.  The tool did output month
> by month commit statistics which may help jog memories though.
> (see the "history timeline" section of the page)
>
> -anil
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

From Pietro.Abate at pps.univ-paris-diderot.fr  Tue Sep 30 13:46:29 2014
From: Pietro.Abate at pps.univ-paris-diderot.fr (Pietro Abate)
Date: Tue, 30 Sep 2014 14:46:29 +0200
Subject: [opam-devel] call for help: opam history
In-Reply-To: <98611B76-B012-4039-91ED-918B23743005@recoil.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <98611B76-B012-4039-91ED-918B23743005@recoil.org>
Message-ID: <20140930124629.GA18375@zed.irill.org>

On 30/09/14 11:34, Anil Madhavapeddy wrote:
> On 30 Sep 2014, at 10:47, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:
> > 
> > From my point of view, the new presentation starts too late: the first
> > ideas of OPAM were in DORM, and the DORM proposal was submitted to the
> > French state in 2010. The main idea of DORM was to develop a new
> > package manager for OCaml, using the DOSE technology from the Mancoosi
> > team. Then, Yaron contacted OCamlPro in mi-november 2011 to put more
> > manpower on the design of new package manager for OCaml.
> 
> This sounds like ideal for the start of the history.  Why not edit it
> in yourself as Thomas suggested?  Did DORM get funded btw?  Linking to
> any other outputs from the project would also help round out the history.

Yes. The dorm was funded and completed 29 oct. 2013 : I was part
of the project working on something else not directly related to
opam. As Fabrice said, the first ideas about opam were outlined in a
few presentations during the DORM project and the involvement of the
mancoosi team (and the use of cudf/dose libraries) in what it would
have been named after "opam", dated back to 2010.

p

From roberto at dicosmo.org  Tue Sep 30 13:41:48 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 30 Sep 2014 14:41:48 +0200
Subject: [opam-devel] call for help: opam history
In-Reply-To: <CAOCAUGMuE80tAmaZqTmLGv6peuR0jONhaU1tiNg0KLO9pMfGmA@mail.gmail.com>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <98611B76-B012-4039-91ED-918B23743005@recoil.org>
 <CAOCAUGMuE80tAmaZqTmLGv6peuR0jONhaU1tiNg0KLO9pMfGmA@mail.gmail.com>
Message-ID: <20140930124148.GA22095@traveler>

Hi Sylvain,
   if you look at http://opam.ocaml.org/about.html you'll find a direct link to
http://zenika.github.io/DORM/ with more recent and pertinent information than
the talk given by Pierre Queinnec at the end of 2010; it was an R&D project that
got partially funded to support the development of industrial tools for package
based software repositories relying on the know-how and technology we
(Mancoosi/PPS/Irill) built over the past ten years.

I will not comment on the Java-specific part of it, even if I'm sure we
functional programmers would love to learn how lame Maven came out from
our analysis (opam-repository, with its red cells on ows.irill.org
is a gem in comparison).

DORM's outcome on the OCaml side is indeed opam: if you dig into opam's git
repo you'll find CUDF and Dose used as a foundation since the very beginning,
not to mention the time we spent here providing background information, 
answering questions and solving issues with the algorithms, which is sadly
not traced into the source code.

I'm forwarding this thread to other people in the team that are not on opam-devel
so we can try to come up with more precise factual elements: getting the story,
and the credits, right, is very important in all OSS projects, as that's one
of the factors that contribute to make everybody willing to continue to contribute.

Nevertheless, I'm afraid this will have to wait, as we are all under
a lot of pressure in this moment, and cannot commit to firm deadlines (hey,
that's OSS after all :-))

--
Roberto

On Tue, Sep 30, 2014 at 02:02:04PM +0200, Sylvain Le Gall wrote:
> I tried to look for DORM documentation and the only thing I can find is:
> http://www.irill.org/blog/homepage
> IRILL days 2010
> 16h00-16h30 DORM, the missing tool to persist your deliveries, Pierre
> Queinnec (Zenika)
> 
> There are no more data on that (no slides). Given the background of
> Zenika, this look a lot like something Java related.
> 
> I am sure Fabrice is right about the fact that some ideas of opam were
> in DORM proposal, but given the lack of documentation and the kind
> tools it seems to be from the few hints you can gather I would not
> mention it. This can be misleading.
> 
> 
> 2014-09-30 12:34 GMT+02:00 Anil Madhavapeddy <anil at recoil.org>:
> > On 30 Sep 2014, at 10:47, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:
> >>
> >> From my point of view, the new presentation starts too late: the first
> >> ideas of OPAM were in DORM, and the DORM proposal was submitted to the
> >> French state in 2010. The main idea of DORM was to develop a new
> >> package manager for OCaml, using the DOSE technology from the Mancoosi
> >> team. Then, Yaron contacted OCamlPro in mi-november 2011 to put more
> >> manpower on the design of new package manager for OCaml.
> >
> > This sounds like ideal for the start of the history.  Why not edit it
> > in yourself as Thomas suggested?  Did DORM get funded btw?  Linking to
> > any other outputs from the project would also help round out the history.
> >
> >> Also, in the opam-repository description, I thought the first 200 packages were
> >> mostly packaged by Frederic Tuong, who spent almost 6 months doing
> >> only that. Am I wrong ?
> >
> > This was an excellent excuse to try gitinspector out:
> > http://www.recoil.org/~avsm/opam-repo-stats.html
> >
> > The stats may be misleading if there was rebasing going on in the early
> > days, so take those with a pinch of salt.  The tool did output month
> > by month commit statistics which may help jog memories though.
> > (see the "history timeline" section of the page)
> >
> > -anil
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-- 
Roberto Di Cosmo
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 3020 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        

From thomas at gazagnaire.org  Tue Sep 30 14:38:29 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Tue, 30 Sep 2014 14:38:29 +0100
Subject: [opam-devel] call for help: opam history
In-Reply-To: <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
Message-ID: <FFCF273B-994C-4F82-9E83-DF90867DA237@gazagnaire.org>

Hi,

>> Once that document is good enough (ideally in a couple of weeks), it will replace http://opam.ocaml.org/about.html as I've heard people complaining about it multiple times already.
> 
> Could you be more explicit about the complains that you have heard
> about this page ?

Mainly that people who contributed to the project were not acknowledge properly on that page. Asking people to contribute to the page should help fixing this (hopefully).

> From my point of view, the new presentation starts too late: the first
> ideas of OPAM were in DORM, and the DORM proposal was submitted to the
> French state in 2010. The main idea of DORM was to develop a new
> package manager for OCaml, using the DOSE technology from the Mancoosi
> team. Then, Yaron contacted OCamlPro in mi-november 2011 to put more
> manpower on the design of new package manager for OCaml. Also, in the
> opam-repository description, I thought the first 200 packages were
> mostly packaged by Frederic Tuong, who spent almost 6 months doing
> only that. Am I wrong ?

I was not involved in the DORM project so I don't know that part of the story -- I'll let you, Roberto and the other people involved filling this gap by directly editing the wiki page. About Frederic: he certainly contributed to import a lot of packages at the beginning (I found [1] and [2] for instance) but he then spent most of his time working on the initial opam prototype if I remember correctly. Could be useful to ask him directly but I don't have his new email ... Anil's stats seems to indicate that very early Anil and I were the two main contributors of opam-repository (although it seems I was very good at deleting stuff ...). The v0 tag in opam-repository (from Jun 2012) points to [3] and contains ~20 packages but a later commit[4] shows a lot of files generated by Frederic.

Best,
Thomas

[1] https://github.com/ocaml/opam-repository/commit/2def559b335014cdd9bb72f01155d1fe53407890
[2] https://github.com/ocaml/opam-repository/pull/6
[3] https://github.com/ocaml/opam-repository/tree/6200d7c8eb2ec2954ac24c485e0ad09120e6a50f/opam
[4] https://github.com/ocaml/opam-repository/tree/64dee064c69bae378af85f90e2a8dc03e25b0090/opam


From anil at recoil.org  Tue Sep 30 15:00:00 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 15:00:00 +0100
Subject: [opam-devel] call for help: opam history
In-Reply-To: <FFCF273B-994C-4F82-9E83-DF90867DA237@gazagnaire.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <FFCF273B-994C-4F82-9E83-DF90867DA237@gazagnaire.org>
Message-ID: <699388DB-7016-47BD-B718-2A11FB8401DE@recoil.org>

On 30 Sep 2014, at 14:38, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:

> Hi,
> 
>>> Once that document is good enough (ideally in a couple of weeks), it will replace http://opam.ocaml.org/about.html as I've heard people complaining about it multiple times already.
>> 
>> Could you be more explicit about the complains that you have heard
>> about this page ?
> 
> Mainly that people who contributed to the project were not acknowledge properly on that page. Asking people to contribute to the page should help fixing this (hopefully).
> 
>> From my point of view, the new presentation starts too late: the first
>> ideas of OPAM were in DORM, and the DORM proposal was submitted to the
>> French state in 2010. The main idea of DORM was to develop a new
>> package manager for OCaml, using the DOSE technology from the Mancoosi
>> team. Then, Yaron contacted OCamlPro in mi-november 2011 to put more
>> manpower on the design of new package manager for OCaml. Also, in the
>> opam-repository description, I thought the first 200 packages were
>> mostly packaged by Frederic Tuong, who spent almost 6 months doing
>> only that. Am I wrong ?
> 
> I was not involved in the DORM project so I don't know that part of the story -- I'll let you, Roberto and the other people involved filling this gap by directly editing the wiki page. About Frederic: he certainly contributed to import a lot of packages at the beginning (I found [1] and [2] for instance) but he then spent most of his time working on the initial opam prototype if I remember correctly. Could be useful to ask him directly but I don't have his new email ... Anil's stats seems to indicate that very early Anil and I were the two main contributors of opam-repository (although it seems I was very good at deleting stuff ...). The v0 tag in opam-repository (from Jun 2012) points to [3] and contains ~20 packages but a later commit[4] shows a lot of files generated by Frederic.

My memory is hazy, but looking over IRC logs reveals quite a few conversations
between the three of us (Frederic, you and me) about the best structure for the
repository.  It's safe to say that Frederic was very involved in that process,
even if it's not directly reflected in the repository stats.

-anil

From thomas at gazagnaire.org  Tue Sep 30 15:34:05 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Tue, 30 Sep 2014 15:34:05 +0100
Subject: [opam-devel] ows reports
In-Reply-To: <20140928072038.GA15211@traveler>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
 <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
 <20140928072038.GA15211@traveler>
Message-ID: <8EF9869B-F0B8-474A-8C87-FE2351F53672@gazagnaire.org>

Hi Roberto,

to summarise the discussion so far: in order to remove all the "red"  boxes in ows their are two solutions:

- either we advise people to release packages to not rely on the transitivity of the "available" field and we fix the current "available" metadata to be the transitive closure of what we currently have.

- or we should agree on some display changes on the ows results. I cannot directly contribute to that unfortunately as the source code of ows is not public.

I'm not very keen on doing the first point (because it looks like duplicating meta-data), but if you think your tools cannot be tweaked to do the second point (or if you think that's the wrong approach) I'm fine to do it anyway.  The current metrics measured by ows are wrong regarding the current opam-repository policies, and we should fix that.

Best,
Thomas



On 28 Sep 2014, at 08:20, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

> On Sun, Sep 28, 2014 at 02:29:15AM +0100, Thomas Gazagnaire wrote:
>>    1. Can I install the given package for at least one version of the compiler
> 
> IMHO, this information is perfectly readable in the current table: if a line is
> fully red, then the answer is no, otherwise it is yes. The advantage of the
> current presentation is that you also immediately see which compiler versions
> are ok.
> 
>>   if not, is it
>>    because:
>>      a) the package is in "broken" (there is a strong conflict in its
>>    dependencies)
>>      b) the package depends on a "broken" package
>>    2. Can I install the given package with the given compiler version: if not,
>>    is it because:
>>      a) the package is "unavailable" for the given compiler (because
>>    'available' field evaluate to false) or
>>      b) the package depends on an "unavailable" package
>> 
>>    http://ows.irill.org/table.html show an empty square for 2.a but seems to
>>    conflats 1.a, 1.b and 2.b. I think that would be very helpful to highlight
>>    1.a (1.b and 2.b could also be useful to know the root causes of the
>>    problems, ie. either fix 1.a or port 2.a to the given ocaml version).
>> 
> 
> If I understand well, you would like to see some kind of information that
> could be used to suggest what could or should be done to "fix" the red cells:
> for example, if a package p has conflicting dependencies, you might want to
> start looking at p, while when a package p depends on a q that is broken,
> you will first look at q, right?
> 
> Unfortunately, things are not that simple... if my understanding of how
> opam-repository is maintained today is correct, a package p version v can enter
> the repository at a certain time t only if it is installable.  So even in you
> 1.a case, the "blame" for p being uninstallable at some later time t' may still
> go (and will probably go) to some change in some remote dependency of p, and you
> are not better off than in 1.b
> 
> When working in the Debian framework, one can provide more helpful information,
> throught the identification of "outdated" packages (packages that are broken and
> can only be fixed by working on them), but unfortunately the tool that performs
> this analysis is pretty subtle, only works on Debian medatata today, and we
> have no resources to make it work on arbitrary CUDF documents.
> 
> So the best we can do today is to provide a detailed explanation of the reasons why
> a package cannot be installed when you click on the red cell: a package may
> depend on a missing package, on a package that is not installable, on packages
> that are in conflict, on version ranges of a package that have no installable
> candidate, and all this, of course, may happen arbitrarily far in the dependency
> graph; even if some effort to display the root causes is made, human
> intervention is needed to decide what to do then.
> 
> As for 2.a and 2.b, the distinction seems also easy to make from the current
> display: an empty cell means the package has a compiler constraint that declares
> it unavailable, while a red cell means the problem is with its dependencies, and
> in that case, you need to click on the cell and investigate what happens.
> 
> Notice though that the presentation of these explanations is not yet optimal:
> since there are so many versions of packages around in the opam repository,
> providing a compact presentation is not as straghtforward as for the GNU/Linux
> distributions case; quite a bit of work has already gone into this issue
> (many thanks to Louis, btw) and is now being continued by an intern at Irill,
> but the jury is still out on what the right approach really is.
> 
> --
> Roberto
> 
>>    Best,
>>    Thomas
>> 
>> 
>> 
>> 
>>        in the previous message
>> 
>>        2014-09-27 20:14 GMT+02:00 Roberto Di Cosmo <roberto at dicosmo.org>:
>> 
>>            Dear Thomas,
>>               I have some difficulty in understanding what exactly you do not
>>            understand in the reports present on OWS.
>> 
>>            Let me try to provide a few hints; a package is reported as "bad"
>>            for a given version and a given architecture if there is no way to
>>            satisfy its dependencies.
>> 
>>            This means that there is no way you can install it using opam, and
>>            even if the "code" shipped with the package may be perfectly fine,
>>            the "package" itself is nevertheless useless.
>> 
>>            This is why it is often termed "broken", following a terminology
>>            that is now standard in the world of package based distribution, as
>>            it has been in use for a couple of decades.
>> 
>>            Why a package is broken, who is responsible of fixing it, is
>>            another story: it can be the package maintainer that did not update
>>            the dependencies, or the maintainer of a dependency that has
>>            wrongly removed it, or the release manager that has not spotted the
>>            problem.
>> 
>>            In the framework of the Mancoosi project we have developed a full
>>            suite of tools to help improving the quality of a package based
>>            system, and it so happen that all these tools are even written in
>>            OCaml.
>> 
>>            I really do suggest that people on this list take the time and read
>>            the short support material that was developed by Zack, Ralf and me
>>            for the HATS summer school, and that is available here:
>>            http://www.dicosmo.org/Publications/Hats2012.html
>> 
>>            All the best
>> 
>>            --
>>            Roberto
>> 
>> 
>>            2014-09-27 19:43 GMT+02:00 Thomas Gazagnaire <thomas at gazagnaire.org
>>> :
>> 
>>                Hi,
>> 
>>                I had a quick look at "opam weather services" reports and I am
>>                a bit puzzled at how the statistic are computed. It seems that
>>                a package is considered as "broken" when one of its dependency
>>                cannot be installed. I'm not sure it makes sense: in the case
>>                the dependency is not available on a given platform / compiler
>>                version, then all the packages which depend upon it are not
>>                available as well as "availability" is a transitive relation in
>>                opam. These packages are not "broken".
>> 
>>                Especially, on that page: http://ows.irill.org/table.html a lot
>>                of "bad" result are in fact simply a result the package not
>>                available for the given compiler version.
>> 
>>                I'm sure they are packages which are actually broken (ie. there
>>                are no version of ocaml where they can be installed) and these
>>                should be much more useful to high-light in order than someone
>>                try to fix the descriptions (for instance me, when I am bored
>>                and have nothing else to do).
>> 
>>                Best,
>>                Thomas
>>                _______________________________________________
>>                opam-devel mailing list
>>                opam-devel at lists.ocaml.org
>>                http://lists.ocaml.org/listinfo/opam-devel
>> 
>> 
>> 
>> 
>>            --
>>            Roberto Di Cosmo
>> 
>>            ------------------------------------------------------------------
>>            Professeur               En delegation a l'INRIA
>>            PPS                      E-mail: roberto at dicosmo.org
>>            Universite Paris Diderot WWW  : http://www.dicosmo.org
>>            Case 7014                Tel  : ++33-(0)1-57 27 92 20
>>            5, Rue Thomas Mann       
>>            F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
>>            FRANCE.                  Twitter: http://twitter.com/rdicosmo
>>            ------------------------------------------------------------------
>>            Attachments:
>>            MIME accepted, Word deprecated
>>                  http://www.gnu.org/philosophy/no-word-attachments.html
>>            ------------------------------------------------------------------
>>            Office location:
>> 
>>            Bureau 320 (3rd floor)
>>            Batiment Sophie Germain
>>            Avenue de France
>>            Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
>>            -----------------------------------------------------------------
>>            GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 
>> 
>> 
>> 
>> 
>>        --
>>        Roberto Di Cosmo
>> 
>>        ------------------------------------------------------------------
>>        Professeur               En delegation a l'INRIA
>>        PPS                      E-mail: roberto at dicosmo.org
>>        Universite Paris Diderot WWW  : http://www.dicosmo.org
>>        Case 7014                Tel  : ++33-(0)1-57 27 92 20
>>        5, Rue Thomas Mann       
>>        F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
>>        FRANCE.                  Twitter: http://twitter.com/rdicosmo
>>        ------------------------------------------------------------------
>>        Attachments:
>>        MIME accepted, Word deprecated
>>              http://www.gnu.org/philosophy/no-word-attachments.html
>>        ------------------------------------------------------------------
>>        Office location:
>> 
>>        Bureau 320 (3rd floor)
>>        Batiment Sophie Germain
>>        Avenue de France
>>        Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
>>        -----------------------------------------------------------------
>>        GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3 
>> 
>> 
>> 
>> 
> 
> -- 
> Roberto Di Cosmo
> 
> ------------------------------------------------------------------
> Professeur               En delegation a l'INRIA
> PPS                      E-mail: roberto at dicosmo.org
> Universite Paris Diderot WWW  : http://www.dicosmo.org
> Case 7014                Tel  : ++33-(0)1-57 27 92 20
> 5, Rue Thomas Mann       
> F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
> FRANCE.                  Twitter: http://twitter.com/rdicosmo
> ------------------------------------------------------------------
> Attachments:
> MIME accepted, Word deprecated
>      http://www.gnu.org/philosophy/no-word-attachments.html
> ------------------------------------------------------------------
> Office location:
> 
> Bureau 3020 (3rd floor)
> Batiment Sophie Germain
> Avenue de France
> Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
> -----------------------------------------------------------------
> GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        


From anil at recoil.org  Tue Sep 30 15:43:12 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 15:43:12 +0100
Subject: [opam-devel] call for help: opam history
In-Reply-To: <20140930124148.GA22095@traveler>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <98611B76-B012-4039-91ED-918B23743005@recoil.org>
 <CAOCAUGMuE80tAmaZqTmLGv6peuR0jONhaU1tiNg0KLO9pMfGmA@mail.gmail.com>
 <20140930124148.GA22095@traveler>
Message-ID: <877BFB16-AA02-41CC-B551-CD3F5EBBC2C8@recoil.org>

On 30 Sep 2014, at 13:41, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

> Hi Sylvain,
>   if you look at http://opam.ocaml.org/about.html you'll find a direct link to
> http://zenika.github.io/DORM/ with more recent and pertinent information than
> the talk given by Pierre Queinnec at the end of 2010; it was an R&D project that
> got partially funded to support the development of industrial tools for package
> based software repositories relying on the know-how and technology we
> (Mancoosi/PPS/Irill) built over the past ten years.
> 
> I will not comment on the Java-specific part of it, even if I'm sure we
> functional programmers would love to learn how lame Maven came out from
> our analysis (opam-repository, with its red cells on ows.irill.org
> is a gem in comparison).

That's very interesting -- is there a central repository of Maven package
metadata as well that?  I thought it was a standalone build tool.  It would
be very useful to have some sort of comparison to other languages to get a
sense of how well we're doing (even if it's a very rough metric).

I guess if we're going to do more work on OCaml Java then we need to start
poking at the Java packaging ecosystem.  I'm not terribly eager :-)

> 
> DORM's outcome on the OCaml side is indeed opam: if you dig into opam's git
> repo you'll find CUDF and Dose used as a foundation since the very beginning,
> not to mention the time we spent here providing background information, 
> answering questions and solving issues with the algorithms, which is sadly
> not traced into the source code.

Yeah, this aspect is very important.  The git repository is just a guideline;
there were many IRC and personal conversations that drove the early design.
We can just iterate on the history until everyone's happy, and then maintain
it moving forward every few months when new features show up.

-anil

From roberto at dicosmo.org  Tue Sep 30 16:03:37 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 30 Sep 2014 17:03:37 +0200
Subject: [opam-devel] call for help: opam history
In-Reply-To: <877BFB16-AA02-41CC-B551-CD3F5EBBC2C8@recoil.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <98611B76-B012-4039-91ED-918B23743005@recoil.org>
 <CAOCAUGMuE80tAmaZqTmLGv6peuR0jONhaU1tiNg0KLO9pMfGmA@mail.gmail.com>
 <20140930124148.GA22095@traveler>
 <877BFB16-AA02-41CC-B551-CD3F5EBBC2C8@recoil.org>
Message-ID: <20140930150337.GA26724@traveler>

> > I will not comment on the Java-specific part of it, even if I'm sure we
> > functional programmers would love to learn how lame Maven came out from
> > our analysis (opam-repository, with its red cells on ows.irill.org
> > is a gem in comparison).
> 
> That's very interesting -- is there a central repository of Maven package
> metadata as well that?  I thought it was a standalone build tool.  It would
> be very useful to have some sort of comparison to other languages to get a
> sense of how well we're doing (even if it's a very rough metric).
> 

That's Maven Central, see http://search.maven.org/#stats for example
if you want to get scared... :-)

-- 
Roberto

From agarwal1975 at gmail.com  Tue Sep 30 16:23:19 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Tue, 30 Sep 2014 11:23:19 -0400
Subject: [opam-devel] call for help: opam history
In-Reply-To: <877BFB16-AA02-41CC-B551-CD3F5EBBC2C8@recoil.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <98611B76-B012-4039-91ED-918B23743005@recoil.org>
 <CAOCAUGMuE80tAmaZqTmLGv6peuR0jONhaU1tiNg0KLO9pMfGmA@mail.gmail.com>
 <20140930124148.GA22095@traveler>
 <877BFB16-AA02-41CC-B551-CD3F5EBBC2C8@recoil.org>
Message-ID: <CAMu2m2+0KSC2V=s15DPPQ=FRVVkQSHr-X5btjhaNwRhwXaSVmQ@mail.gmail.com>

On Tue, Sep 30, 2014 at 10:43 AM, Anil Madhavapeddy <anil at recoil.org> wrote:

I guess if we're going to do more work on OCaml Java then we need to start
> poking at the Java packaging ecosystem.  I'm not terribly eager :-)
>

Off topic, but note that we had a talk [1] on OCaml-Java and Maven
recently, and there's a repo [2].

[1] http://www.meetup.com/NYC-OCaml/events/189659582/
[2] https://github.com/struktured/ocamljava-maven-plugin/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140930/da2d5d29/attachment.html>

From roberto at dicosmo.org  Tue Sep 30 16:25:23 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 30 Sep 2014 17:25:23 +0200
Subject: [opam-devel] ows reports
In-Reply-To: <8EF9869B-F0B8-474A-8C87-FE2351F53672@gazagnaire.org>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
 <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
 <20140928072038.GA15211@traveler>
 <8EF9869B-F0B8-474A-8C87-FE2351F53672@gazagnaire.org>
Message-ID: <20140930152523.GB26724@traveler>

Hi Thomas,
   let me try to explain again my point of view: ows.irill.org tells us, for
each package and version, and each compiler version for which it is compatible,
whether it can be installed or not.

If not, one can get a detailed explanation of why it is not installable, that a
package maintainer can use to track down the issue.

It's really that simple: ows does nothing else than showing this factual,
verifiable information.

In particular, it does not try to solve the difficult issue of finding who is to
blame for a particular broken package, that's up to the release manager or the
package maintainers: if a package P marked "available" for 3.12 cannot compile
because it depends on a package Q that has no version "available" for 3.12,
it is broken nonetheless, and it must be reported, because a user may try
to install it and see it fail. I do not understand why you want to change
this.

I'm sure in front of a blackboard things would be much easier to explain, both
ways, and we will certainly find common grounds then, so let's postpone this
discussion to the first occasion we can do that


--
Roberto

From agarwal1975 at gmail.com  Tue Sep 30 17:16:38 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Tue, 30 Sep 2014 12:16:38 -0400
Subject: [opam-devel] Travis CI failures
In-Reply-To: <1BB48871-6BBA-4E6D-B5E7-2CE0633CA153@recoil.org>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
 <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
 <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>
 <CAMu2m2+0AiWQfnB2SZ0VYxB5Bt7cWMO91h386KFqdOmM3NX6TQ@mail.gmail.com>
 <95EC1B02-B66F-4590-B7D9-FE2AF29F52AE@cam.ac.uk>
 <40DD484E-CBFF-442D-A5E6-0BA02E1DEA91@gazagnaire.org>
 <CAMu2m2Lbz2f2vWaDiCMPmA05SxkLwanNvN89T9R-VwRHGJSBqw@mail.gmail.com>
 <1BB48871-6BBA-4E6D-B5E7-2CE0633CA153@recoil.org>
Message-ID: <CAMu2m2+k7isOhGwusYV2cgU0PJe8dPv=y+r2eQx6GHrz=o29-Q@mail.gmail.com>

Thanks for the explanations. I spent all day learning more about package
management on several OS's, and updated the ocaml.org install page.
Hopefully things are a bit clearer.

On Tue, Sep 30, 2014 at 4:27 AM, Anil Madhavapeddy <anil at recoil.org> wrote:

> On 29 Sep 2014, at 19:46, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
>
> Thanks. I now have it working on Ubuntu. The issue is that several OS
> packages have to be installed, not just "ocaml" and "camlp4". Thus, the
> instructions [1,2] we've been linking people to are incomplete.
>
>
> That's right -- this has always been the case historically on Debian
> (somewhat suboptimally I think, but it fits in with their distribution
> criteria).  I usually do "ocaml ocaml-native-compilers camlp4-extra" to get
> everything.
>
>
> I still don't know what to do on CentOS to get ocamldoc. Does anyone have
> the full list of packages for each OS?
>
>
> You should have got ocamldoc with just ocaml there.  I believe you just
> need "ocaml" and "ocaml-camlp4" on CentOS, but please correct me if that's
> wrong.  I don't regularly use it and so could have missed something in the
> packaging.
>
>
> Why are multiple packages needed? I would expect "apt-get install ocaml"
> or "yum install ocaml" to install everything that one gets from installing
> the source distribution of OCaml.
>
> [1]
> http://software.opensuse.org/download.html?project=home:ocaml&package=opam
> [2]
> http://software.opensuse.org/download.html?project=home:ocaml&package=ocaml
>
>
> That's just following upstream packaging practises.  I think it's better
> to do that and to document what packages are needed, rather than changing
> it for our local efforts.
>
> However, it could be easier.  I'll take a look at making the Travis
> scripts a bit more automated by sourcing a central copy of the script from
> somewhere on GitHub.  That'll reduce the rate of cut and pastes..
>
> -anil
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140930/0e25802f/attachment.html>

From thomas at gazagnaire.org  Tue Sep 30 17:19:36 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Tue, 30 Sep 2014 17:19:36 +0100
Subject: [opam-devel] ows reports
In-Reply-To: <20140930152523.GB26724@traveler>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
 <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
 <20140928072038.GA15211@traveler>
 <8EF9869B-F0B8-474A-8C87-FE2351F53672@gazagnaire.org>
 <20140930152523.GB26724@traveler>
Message-ID: <228736F0-FD04-4607-821F-79F9ADA97E55@gazagnaire.org>

> In particular, it does not try to solve the difficult issue of finding who is to
> blame for a particular broken package, that's up to the release manager or the
> package maintainers: if a package P marked "available" for 3.12 cannot compile
> because it depends on a package Q that has no version "available" for 3.12,
> it is broken nonetheless, and it must be reported, because a user may try
> to install it and see it fail. I do not understand why you want to change
> this.

Because the kind of errors reported to the user is very different and the way to fix it is different as well.

$ opam install async.108.00.02
The following dependencies couldn't be met:
  - async -> async_core = 108.00.02 -> core < 109.31.00
Your request can't be satisfied:
  - core<109.31.00 is not available because it requires OCaml >= 4.00.1 & < 4.01.0.

vs.

$ opam install mirage-www.0.3.0
The following dependencies couldn't be met:
  - mirage-www -> cstruct < 0.6.0
  - mirage-www -> mirage-fs >= 0.4.0 -> cstruct >= 0.6.0 | cstruct >= 0.6.0
Your request can't be satisfied:
  - Conflicting version constraints for cstruct

In the first case, there is nothing to "fix". But to make ows happy we can populate the "available" field of async to get the same message as when trying to install core:

$ opam install core.108.00.02
[ERROR] core.108.00.02 is not available because it requires OCaml < 4.00.1.

This will transform the "red" box in ows into an "empty" box: that's good for the stats, but I'm not sure that's better for an user point-of-view.

In the second case, that's clearly an error if the package that should be fixed (or the package should be removed as there is no valid user configuration where it can be installed). This is a very valuable information which should be high-lighted to the repository (or package) maintainers.

> I'm sure in front of a blackboard things would be much easier to explain, both
> ways, and we will certainly find common grounds then, so let's postpone this
> discussion to the first occasion we can do that

I'm happy to discuss about than in person, although I think that's also good we have that kind of discussion in the open so that other people on that list can follow what's happening and comment if they (don't?) like. But we can maybe organise an opam-devel meeting close to the ocaml consortium meeting (not sure when it is exactly, but can be the same day or the day before/after).

Best,
Thomas


From Fabrice.Le_fessant at inria.fr  Tue Sep 30 17:25:05 2014
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Tue, 30 Sep 2014 18:25:05 +0200
Subject: [opam-devel] call for help: opam history
In-Reply-To: <FFCF273B-994C-4F82-9E83-DF90867DA237@gazagnaire.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <FFCF273B-994C-4F82-9E83-DF90867DA237@gazagnaire.org>
Message-ID: <CAHvkLrO3Hq5Or0erxe1wrhk6WJ=V+wcQAA1n7XpT6sBvhnL86g@mail.gmail.com>

On Tue, Sep 30, 2014 at 3:38 PM, Thomas Gazagnaire
<thomas at gazagnaire.org> wrote:
>> Could you be more explicit about the complains that you have heard
>> about this page ?
>
> Mainly that people who contributed to the project were not acknowledge properly on that page. Asking people to contribute to the page should help fixing this (hopefully).

Wouldn't a simple list of contributors be enough ? Or should we really
investigate and measure the size of contributions ? How do you compare
the time I spent convincing people OPAM should be done, finding funds
and manpower, with the time other ones spent developing or
contributing packages ?

> I was not involved in the DORM project so I don't know that part of the story

??? You were working for OCamlPro, and spending some of your time
managing Frederic (with me), who was paid by DORM via INRIA. You may
not have been involved in the administrative part of DORM, but you
were clearly involved in the technical part :-)

In the attached file, I tracked the number of OPAM packages after
every commit in the first months (I hope I didn't make any mistake):

>From 6 Aug 2012 to 14 Aug 2012, Frederic added 100 packages in about
15 commits (count 115 to 214). On 12 Jul 2012, he added 19 packages
(count 82 to 101). Just with that, he is the main contributor of
packages at end of August 2012 with more than half the packages. In my
souvenir, he was mostly working on packaging while you were mostly
developing the tool itself.

Funnily, my own contribution was to move the count from 24 to... 0 and
then 1 on Jun 5 :-)

Best,
--Fabrice
-- 
Fabrice LE FESSANT
Chercheur en Informatique
INRIA Paris Rocquencourt -- OCamlPro
Programming Languages and Distributed Systems
-------------- next part --------------
A non-text attachment was scrubbed...
Name: new-packages.count
Type: application/octet-stream
Size: 18376 bytes
Desc: not available
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140930/64b02ede/attachment-0001.obj>

From roberto at dicosmo.org  Tue Sep 30 17:33:09 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 30 Sep 2014 18:33:09 +0200
Subject: [opam-devel] ows reports
In-Reply-To: <228736F0-FD04-4607-821F-79F9ADA97E55@gazagnaire.org>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
 <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
 <20140928072038.GA15211@traveler>
 <8EF9869B-F0B8-474A-8C87-FE2351F53672@gazagnaire.org>
 <20140930152523.GB26724@traveler>
 <228736F0-FD04-4607-821F-79F9ADA97E55@gazagnaire.org>
Message-ID: <CAJBwKuVDv+AWS2WHyaoB-3vEZA7B3xf9yGoq1zQnOY0AFh-dGA@mail.gmail.com>

It's not about "the open", that is up to now bringing nothing to a better
understanding of the issue, since it is just me and you discussing on two
different points of views.

It's about the bandwidth, and time.


2014-09-30 18:19 GMT+02:00 Thomas Gazagnaire <thomas at gazagnaire.org>:

> > In particular, it does not try to solve the difficult issue of finding
> who is to
> > blame for a particular broken package, that's up to the release manager
> or the
> > package maintainers: if a package P marked "available" for 3.12 cannot
> compile
> > because it depends on a package Q that has no version "available" for
> 3.12,
> > it is broken nonetheless, and it must be reported, because a user may try
> > to install it and see it fail. I do not understand why you want to change
> > this.
>
> Because the kind of errors reported to the user is very different and the
> way to fix it is different as well.
>
> $ opam install async.108.00.02
> The following dependencies couldn't be met:
>   - async -> async_core = 108.00.02 -> core < 109.31.00
> Your request can't be satisfied:
>   - core<109.31.00 is not available because it requires OCaml >= 4.00.1 &
> < 4.01.0.
>
> vs.
>
> $ opam install mirage-www.0.3.0
> The following dependencies couldn't be met:
>   - mirage-www -> cstruct < 0.6.0
>   - mirage-www -> mirage-fs >= 0.4.0 -> cstruct >= 0.6.0 | cstruct >= 0.6.0
> Your request can't be satisfied:
>   - Conflicting version constraints for cstruct
>
> In the first case, there is nothing to "fix". But to make ows happy we can
> populate the "available" field of async to get the same message as when
> trying to install core:
>
> $ opam install core.108.00.02
> [ERROR] core.108.00.02 is not available because it requires OCaml < 4.00.1.
>
> This will transform the "red" box in ows into an "empty" box: that's good
> for the stats, but I'm not sure that's better for an user point-of-view.
>
> In the second case, that's clearly an error if the package that should be
> fixed (or the package should be removed as there is no valid user
> configuration where it can be installed). This is a very valuable
> information which should be high-lighted to the repository (or package)
> maintainers.
>
> > I'm sure in front of a blackboard things would be much easier to
> explain, both
> > ways, and we will certainly find common grounds then, so let's postpone
> this
> > discussion to the first occasion we can do that
>
> I'm happy to discuss about than in person, although I think that's also
> good we have that kind of discussion in the open so that other people on
> that list can follow what's happening and comment if they (don't?) like.
> But we can maybe organise an opam-devel meeting close to the ocaml
> consortium meeting (not sure when it is exactly, but can be the same day or
> the day before/after).
>
> Best,
> Thomas
>
>


-- 
Roberto Di Cosmo

------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:

Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140930/7312b6d7/attachment.html>

From anil at recoil.org  Tue Sep 30 17:39:59 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 17:39:59 +0100
Subject: [opam-devel] call for help: opam history
In-Reply-To: <CAHvkLrO3Hq5Or0erxe1wrhk6WJ=V+wcQAA1n7XpT6sBvhnL86g@mail.gmail.com>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <FFCF273B-994C-4F82-9E83-DF90867DA237@gazagnaire.org>
 <CAHvkLrO3Hq5Or0erxe1wrhk6WJ=V+wcQAA1n7XpT6sBvhnL86g@mail.gmail.com>
Message-ID: <0453922C-5D20-4979-BAE0-85D599FF9839@recoil.org>

On 30 Sep 2014, at 17:25, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:

> On Tue, Sep 30, 2014 at 3:38 PM, Thomas Gazagnaire
> <thomas at gazagnaire.org> wrote:
>>> Could you be more explicit about the complains that you have heard
>>> about this page ?
>> 
>> Mainly that people who contributed to the project were not acknowledge properly on that page. Asking people to contribute to the page should help fixing this (hopefully).
> 
> Wouldn't a simple list of contributors be enough ? Or should we really
> investigate and measure the size of contributions ? How do you compare
> the time I spent convincing people OPAM should be done, finding funds
> and manpower, with the time other ones spent developing or
> contributing packages ?

Fabrice, I believe Thomas's intent in constructing this page was to begin
the construction of a narrative of the history, in exactly the same fashion
as the OCaml history page on:
http://caml.inria.fr/about/history.en.html
which I in turn used to write the basis of the Real World OCaml introduction at:
https://realworldocaml.org/v1/en/html/prologue.html#a-brief-history-from-the-1960s

The paragraph you suggested on the DORM background sounds fine,
particularly with Roberto's clarification on the location of the project
homepage.  Why don't you just edit it into the draft?  There's no suggestion
of measuring the size of contributions that I'm aware of.

> In the attached file, I tracked the number of OPAM packages after
> every commit in the first months (I hope I didn't make any mistake):
> 
> From 6 Aug 2012 to 14 Aug 2012, Frederic added 100 packages in about
> 15 commits (count 115 to 214). On 12 Jul 2012, he added 19 packages
> (count 82 to 101). Just with that, he is the main contributor of
> packages at end of August 2012 with more than half the packages. In my
> souvenir, he was mostly working on packaging while you were mostly
> developing the tool itself.

Ah yes, I think I do remember this now.  It was added in this pull
request: https://github.com/ocaml/opam-repository/pull/6

These packages were imported from a translation tool that imported the
GODI metadata in the OPAM format, with some manual fixes.  Gerd later
(quite reasonably) requested that we not re-use the metadata without
some licensing clarification, which led to this fun issue in 2013:
https://github.com/ocaml/opam-repository/issues/955

If others can confirm my memory of these events, I believe we should
also credit GODI for providing a source for the initial metadata to
bootstrap the OPAM repository via Frederic's conversion tool.  I can
hunt for more details in e-mail later if necessary. 

-anil

From thomas at gazagnaire.org  Tue Sep 30 17:42:31 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Tue, 30 Sep 2014 17:42:31 +0100
Subject: [opam-devel] call for help: opam history
In-Reply-To: <CAHvkLrO3Hq5Or0erxe1wrhk6WJ=V+wcQAA1n7XpT6sBvhnL86g@mail.gmail.com>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <FFCF273B-994C-4F82-9E83-DF90867DA237@gazagnaire.org>
 <CAHvkLrO3Hq5Or0erxe1wrhk6WJ=V+wcQAA1n7XpT6sBvhnL86g@mail.gmail.com>
Message-ID: <8F9585AA-3C82-4283-A50B-377F5DC65914@gazagnaire.org>

>>> Could you be more explicit about the complains that you have heard
>>> about this page ?
>> 
>> Mainly that people who contributed to the project were not acknowledge properly on that page. Asking people to contribute to the page should help fixing this (hopefully).
> 
> Wouldn't a simple list of contributors be enough ? Or should we really
> investigate and measure the size of contributions ? How do you compare
> the time I spent convincing people OPAM should be done, finding funds
> and manpower, with the time other ones spent developing or
> contributing packages ?

There is no comparison to be done, I think it is useful to properly state how things happened at the time. I've tried to dig into my emails, commits message, IRC logs and my bad memory to write the first draft, and as you can see in the topic of that email I'm calling for help to make things more accurate :-) So of course we should mention the initial work done to fund the project (both DORM and OCamlPro resources).

>> I was not involved in the DORM project so I don't know that part of the story
> 
> ??? You were working for OCamlPro, and spending some of your time
> managing Frederic (with me), who was paid by DORM via INRIA. You may
> not have been involved in the administrative part of DORM, but you
> were clearly involved in the technical part :-)

I remember very clearly working with Frederic on opam, with memory is not that bad :p I never attended any DORM meetings though, and I never saw (or participate) the project deliverables.

> In the attached file, I tracked the number of OPAM packages after
> every commit in the first months (I hope I didn't make any mistake):
> 
> From 6 Aug 2012 to 14 Aug 2012, Frederic added 100 packages in about
> 15 commits (count 115 to 214). On 12 Jul 2012, he added 19 packages
> (count 82 to 101). Just with that, he is the main contributor of
> packages at end of August 2012 with more than half the packages. In my
> souvenir, he was mostly working on packaging while you were mostly
> developing the tool itself.
> 
> Funnily, my own contribution was to move the count from 24 to... 0 and
> then 1 on Jun 5 :-)

Haha, I'm not the only one trying to delete stuff then :-) 

Thanks for the package stats, very useful. Did you take into account the format changes in the repository in your stats? And about the time spent on code/repo by Frederic and me, I just remember we spent a lot of time working on both at the same time (as we were fixing design issues while creating new packages, and Frederic developed a quite sophisticated system to generate package meta-data). I'll correct this part of history later this week.

Best,
Thomas

From anil at recoil.org  Tue Sep 30 18:06:37 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 18:06:37 +0100
Subject: [opam-devel] ows reports
In-Reply-To: <228736F0-FD04-4607-821F-79F9ADA97E55@gazagnaire.org>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
 <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
 <20140928072038.GA15211@traveler>
 <8EF9869B-F0B8-474A-8C87-FE2351F53672@gazagnaire.org>
 <20140930152523.GB26724@traveler>
 <228736F0-FD04-4607-821F-79F9ADA97E55@gazagnaire.org>
Message-ID: <37DF7B34-5E16-4C14-9153-7C40F753F28A@recoil.org>

On 30 Sep 2014, at 17:19, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:

>> In particular, it does not try to solve the difficult issue of finding who is to
>> blame for a particular broken package, that's up to the release manager or the
>> package maintainers: if a package P marked "available" for 3.12 cannot compile
>> because it depends on a package Q that has no version "available" for 3.12,
>> it is broken nonetheless, and it must be reported, because a user may try
>> to install it and see it fail. I do not understand why you want to change
>> this.
> 
> Because the kind of errors reported to the user is very different and the way to fix it is different as well.
> 
> $ opam install async.108.00.02
> The following dependencies couldn't be met:
>  - async -> async_core = 108.00.02 -> core < 109.31.00
> Your request can't be satisfied:
>  - core<109.31.00 is not available because it requires OCaml >= 4.00.1 & < 4.01.0.
> 
> vs.
> 
> $ opam install mirage-www.0.3.0
> The following dependencies couldn't be met:
>  - mirage-www -> cstruct < 0.6.0
>  - mirage-www -> mirage-fs >= 0.4.0 -> cstruct >= 0.6.0 | cstruct >= 0.6.0
> Your request can't be satisfied:
>  - Conflicting version constraints for cstruct
> 
> In the first case, there is nothing to "fix". But to make ows happy we can populate the "available" field of async to get the same message as when trying to install core:
> 
> $ opam install core.108.00.02
> [ERROR] core.108.00.02 is not available because it requires OCaml < 4.00.1.

Why don't we just do that with a mechanized pass of the repository to rewrite packages to add the `available` field when missing?  It's also clearer to the user if there's an available field in the immediate package description, instead of having to invoke `opam` to perform the dependency resolution.  That wouldn't require any changes to ows either.

Although, now that I think about it more, one big downside is that the `available` field may become out-of-date when a *new* version of a dependency is added, such as this one today in Batteries [1] that tweaks `available` versions.  We would have to then adjust all the upstream `available` packages also, which seems rather error prone.

[1] https://github.com/ocaml/opam-repository/pull/2779

I'm CCing Damien Doligez, since he's been fixing a huge number of these issues in the OPAM repository recently, and is cooking up some tools to help with OCaml release engineering.  Roberto, is the source (even if it's not very clean) to ows available for us to experiment locally?  I'd prefer not to duplicate efforts between Damien, us and you if possible, but I also don't want to cause you extra work if OWS isn't easily re-installable.

-anil

From Fabrice.Le_fessant at inria.fr  Tue Sep 30 18:06:59 2014
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Tue, 30 Sep 2014 19:06:59 +0200
Subject: [opam-devel] call for help: opam history
In-Reply-To: <8F9585AA-3C82-4283-A50B-377F5DC65914@gazagnaire.org>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <FFCF273B-994C-4F82-9E83-DF90867DA237@gazagnaire.org>
 <CAHvkLrO3Hq5Or0erxe1wrhk6WJ=V+wcQAA1n7XpT6sBvhnL86g@mail.gmail.com>
 <8F9585AA-3C82-4283-A50B-377F5DC65914@gazagnaire.org>
Message-ID: <CAHvkLrPF-pK=dzWwbkgpDmTf27sYUK_3Du=EVUDE51dAdzG0xQ@mail.gmail.com>

On Tue, Sep 30, 2014 at 6:42 PM, Thomas Gazagnaire
<thomas at gazagnaire.org> wrote:
>>>> Could you be more explicit about the complains that you have heard
>>>> about this page ?
>>>
>>> Mainly that people who contributed to the project were not acknowledge properly on that page. Asking people to contribute to the page should help fixing this (hopefully).
>>
>> Wouldn't a simple list of contributors be enough ? Or should we really
>> investigate and measure the size of contributions ? How do you compare
>> the time I spent convincing people OPAM should be done, finding funds
>> and manpower, with the time other ones spent developing or
>> contributing packages ?
>
> There is no comparison to be done, I think it is useful to properly state how things happened at the time. I've tried to dig into my emails, commits message, IRC logs and my bad memory to write the first draft, and as you can see in the topic of that email I'm calling for help to make things more accurate :-) So of course we should mention the initial work done to fund the project (both DORM and OCamlPro resources).

My point is just that people are always unhappy with how contributions
to a given project are displayed. I would have just added a list of
contributors to the About page, but if the goal is also to have a nice
history for opam, that's fine.

>> Funnily, my own contribution was to move the count from 24 to... 0 and
>> then 1 on Jun 5 :-)
>
> Haha, I'm not the only one trying to delete stuff then :-)
>
> Thanks for the package stats, very useful. Did you take into account the format changes in the repository in your stats? And about the time spent on code/repo by Frederic and me, I just remember we spent a lot of time working on both at the same time (as we were fixing design issues while creating new packages, and Frederic developed a quite sophisticated system to generate package meta-data). I'll correct this part of history later this week.

I just counted the number of files in the opam/ subdirectory (the
equivalent of packages/ at the time) after each commit. Indeed, there
are many commits changing the format of these files, to be consistent
with a change in the format expected by the tool, so it does not take
into account all that work.

@Anil: yes, I kind of remember that there was a tool to automatically
extract the meta-data from GODI packages and to translate it to
"descr" files. However, the work of filling OPAM files with build and
install instructions was not automated, to the best of my knowledge,
so Frederic had to build every package and check that it would work
well in OPAM. But of course, GODI should be credited, both for
providing an inspiration for OPAM (we built on the experience we had
of GODI and sometimes, of the problems we had with it) and for forcing
many developers to package nicely their programs and libraries, so
that we work of packaging them again was much more easy.

--Fabrice

-- 
Fabrice LE FESSANT
Chercheur en Informatique
INRIA Paris Rocquencourt -- OCamlPro
Programming Languages and Distributed Systems

From anil at recoil.org  Tue Sep 30 18:11:43 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 18:11:43 +0100
Subject: [opam-devel] call for help: opam history
In-Reply-To: <CAHvkLrPF-pK=dzWwbkgpDmTf27sYUK_3Du=EVUDE51dAdzG0xQ@mail.gmail.com>
References: <837CF831-839A-48E8-A685-70C48381D483@gazagnaire.org>
 <CAHvkLrPatjXttkGhZpahw_xq+JTR=OxagDOFdugJimwfzTEjGQ@mail.gmail.com>
 <FFCF273B-994C-4F82-9E83-DF90867DA237@gazagnaire.org>
 <CAHvkLrO3Hq5Or0erxe1wrhk6WJ=V+wcQAA1n7XpT6sBvhnL86g@mail.gmail.com>
 <8F9585AA-3C82-4283-A50B-377F5DC65914@gazagnaire.org>
 <CAHvkLrPF-pK=dzWwbkgpDmTf27sYUK_3Du=EVUDE51dAdzG0xQ@mail.gmail.com>
Message-ID: <EFCFEFB4-045D-4C10-922F-1A41DE272973@recoil.org>

On 30 Sep 2014, at 18:06, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:
> 
> @Anil: yes, I kind of remember that there was a tool to automatically
> extract the meta-data from GODI packages and to translate it to
> "descr" files. However, the work of filling OPAM files with build and
> install instructions was not automated, to the best of my knowledge,
> so Frederic had to build every package and check that it would work
> well in OPAM. But of course, GODI should be credited, both for
> providing an inspiration for OPAM (we built on the experience we had
> of GODI and sometimes, of the problems we had with it) and for forcing
> many developers to package nicely their programs and libraries, so
> that we work of packaging them again was much more easy.

Yes, I think that's right -- it was just the descriptions and metadata
that were borrowed from GODI, with the build instructions being manually
edited to add (e.g.) the prefix and make macros.  That was quite a bit of
work...
 
-anil


From anil at recoil.org  Tue Sep 30 21:39:29 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 21:39:29 +0100
Subject: [opam-devel] Travis CI failures
In-Reply-To: <CAMu2m2+k7isOhGwusYV2cgU0PJe8dPv=y+r2eQx6GHrz=o29-Q@mail.gmail.com>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
 <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
 <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>
 <CAMu2m2+0AiWQfnB2SZ0VYxB5Bt7cWMO91h386KFqdOmM3NX6TQ@mail.gmail.com>
 <95EC1B02-B66F-4590-B7D9-FE2AF29F52AE@cam.ac.uk>
 <40DD484E-CBFF-442D-A5E6-0BA02E1DEA91@gazagnaire.org>
 <CAMu2m2Lbz2f2vWaDiCMPmA05SxkLwanNvN89T9R-VwRHGJSBqw@mail.gmail.com>
 <1BB48871-6BBA-4E6D-B5E7-2CE0633CA153@recoil.org>
 <CAMu2m2+k7isOhGwusYV2cgU0PJe8dPv=y+r2eQx6GHrz=o29-Q@mail.gmail.com>
Message-ID: <34D069CE-2E14-498B-A471-4F153CBC952B@recoil.org>

Ashish, this is *very* useful as it's the first stumbling block that users run into and give up when they do.  Thank you!

-anil

On 30 Sep 2014, at 17:16, Ashish Agarwal <agarwal1975 at gmail.com> wrote:

> Thanks for the explanations. I spent all day learning more about package management on several OS's, and updated the ocaml.org install page. Hopefully things are a bit clearer.
> 
> On Tue, Sep 30, 2014 at 4:27 AM, Anil Madhavapeddy <anil at recoil.org> wrote:
> On 29 Sep 2014, at 19:46, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
> 
>> Thanks. I now have it working on Ubuntu. The issue is that several OS packages have to be installed, not just "ocaml" and "camlp4". Thus, the instructions [1,2] we've been linking people to are incomplete.
> 
> That's right -- this has always been the case historically on Debian (somewhat suboptimally I think, but it fits in with their distribution criteria).  I usually do "ocaml ocaml-native-compilers camlp4-extra" to get everything.
> 
>> 
>> I still don't know what to do on CentOS to get ocamldoc. Does anyone have the full list of packages for each OS?
> 
> You should have got ocamldoc with just ocaml there.  I believe you just need "ocaml" and "ocaml-camlp4" on CentOS, but please correct me if that's wrong.  I don't regularly use it and so could have missed something in the packaging.
> 
>> 
>> Why are multiple packages needed? I would expect "apt-get install ocaml" or "yum install ocaml" to install everything that one gets from installing the source distribution of OCaml.
>> 
>> [1] http://software.opensuse.org/download.html?project=home:ocaml&package=opam
>> [2] http://software.opensuse.org/download.html?project=home:ocaml&package=ocaml
> 
> That's just following upstream packaging practises.  I think it's better to do that and to document what packages are needed, rather than changing it for our local efforts.
> 
> However, it could be easier.  I'll take a look at making the Travis scripts a bit more automated by sourcing a central copy of the script from somewhere on GitHub.  That'll reduce the rate of cut and pastes..
> 
> -anil
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140930/b29f5c45/attachment.html>

From roberto at dicosmo.org  Tue Sep 30 21:40:17 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 30 Sep 2014 22:40:17 +0200
Subject: [opam-devel] ows reports
In-Reply-To: <37DF7B34-5E16-4C14-9153-7C40F753F28A@recoil.org>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
 <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
 <20140928072038.GA15211@traveler>
 <8EF9869B-F0B8-474A-8C87-FE2351F53672@gazagnaire.org>
 <20140930152523.GB26724@traveler>
 <228736F0-FD04-4607-821F-79F9ADA97E55@gazagnaire.org>
 <37DF7B34-5E16-4C14-9153-7C40F753F28A@recoil.org>
Message-ID: <20140930204017.GA14738@traveler>

Hi Anil,
   I think I mentioned it earlier, but just in case it ended up in some lost
closed ticket somewhere on github, let me recall this here: OWS does a nice
web-like presentation of the results that you can obtain by just running
*distcheck*, a standard tool from the Dose tool suite, which is distributed
under a free software licence, and uses the Cudf library, also distributed under
a free software licence.

Anybody can do the same locally, it's as simple as

 opam config cudf-universe > cudf:///universe.cudf
 distcheck -f -e cudf:///tmp/universe.cudf 

So you can test everything already, right away! This has been possible since
the very beginning: there is nothing hidden, the manpage for distcheck is quite
detailed and there is even a full 20 pages primer in the documentation directory.


All this being said, things are not as well as I would like.

On one side, the existence of zillions of versions of the same package in
opam-repository made the original explanation algorithm produce correct, but
unreadable reports; over the past years different experiments with the
simplification of the explanations led to different pieces of code trying to do
differently similar, but not quite identical things in different places,
including opam and OWS, instead of in the Dose library, where all this really
belongs.

Also, distcheck produces by default a report referring to the CUDF file, so it
outputs a version number that needs to be matched back with the original package
version; there are incarnations of distcheck for debian, rpm and eclipse that do this
properly, but not yet for opam, that has not even a formally specified version
comparison algorithm, as AFAIK it justs currently piggybacks on the dose implementation
of the debian one, that may change in the future, as it has changed in the past.

To try and get back in a sane state, there has been work ongoing here over the
summer to design a general explanation simplification algorithm that covers most
cases, not just for opam, and various experiments on how to make distcheck
handle source versions generically, all in the public Dose git repo, but we are
far from finished yet, as it's pretty tricky work.

Now I really want to see everything converge back into a single code base again,
which *is* free software: Dose and Cudf, to which everybody is welcome to
contribute, even if I know that the learning curve is steep, despite all this
being OCaml code.

Hope this clarifies my stance here.

--
Roberto

From anil at recoil.org  Tue Sep 30 21:56:00 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 30 Sep 2014 21:56:00 +0100
Subject: [opam-devel] ows reports
In-Reply-To: <20140930204017.GA14738@traveler>
References: <08CEEB78-5430-48F2-BED2-368E05B16579@gazagnaire.org>
 <CAJBwKuX8BPZ5nAnDd9ZLtXCg8_o5rw0h19GvEEJUuJaxyUgVqg@mail.gmail.com>
 <CAJBwKuULbLXwC5qy3qzMYAwArmS3FB95eUVNGhteqtBCPF2Rjw@mail.gmail.com>
 <C519F5AC-847F-49BF-8EC5-B409434DBBED@gazagnaire.org>
 <2926B1CD-BBF0-4505-A569-0D6ECF5B388C@gazagnaire.org>
 <20140928072038.GA15211@traveler>
 <8EF9869B-F0B8-474A-8C87-FE2351F53672@gazagnaire.org>
 <20140930152523.GB26724@traveler>
 <228736F0-FD04-4607-821F-79F9ADA97E55@gazagnaire.org>
 <37DF7B34-5E16-4C14-9153-7C40F753F28A@recoil.org>
 <20140930204017.GA14738@traveler>
Message-ID: <FCDB52EE-36DB-4EAB-90A9-E59AB269AAAD@recoil.org>

I did not know that it's just a layer over dose-distcheck, so that sounds like
exactly the right way for us to experiment with it (albeit in a raw form, but
that's fine).

David Sheets points me to the version of Dose packaged up in OPAM as the
right version to use here (it has various patches applied to it for
compatibility with opamLib, I believe).

Thanks for the pointer,
Anil

On 30 Sep 2014, at 21:40, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

> Hi Anil,
>   I think I mentioned it earlier, but just in case it ended up in some lost
> closed ticket somewhere on github, let me recall this here: OWS does a nice
> web-like presentation of the results that you can obtain by just running
> *distcheck*, a standard tool from the Dose tool suite, which is distributed
> under a free software licence, and uses the Cudf library, also distributed under
> a free software licence.
> 
> Anybody can do the same locally, it's as simple as
> 
> opam config cudf-universe > cudf:///universe.cudf
> distcheck -f -e cudf:///tmp/universe.cudf 
> 
> So you can test everything already, right away! This has been possible since
> the very beginning: there is nothing hidden, the manpage for distcheck is quite
> detailed and there is even a full 20 pages primer in the documentation directory.
> 
> 
> All this being said, things are not as well as I would like.
> 
> On one side, the existence of zillions of versions of the same package in
> opam-repository made the original explanation algorithm produce correct, but
> unreadable reports; over the past years different experiments with the
> simplification of the explanations led to different pieces of code trying to do
> differently similar, but not quite identical things in different places,
> including opam and OWS, instead of in the Dose library, where all this really
> belongs.
> 
> Also, distcheck produces by default a report referring to the CUDF file, so it
> outputs a version number that needs to be matched back with the original package
> version; there are incarnations of distcheck for debian, rpm and eclipse that do this
> properly, but not yet for opam, that has not even a formally specified version
> comparison algorithm, as AFAIK it justs currently piggybacks on the dose implementation
> of the debian one, that may change in the future, as it has changed in the past.
> 
> To try and get back in a sane state, there has been work ongoing here over the
> summer to design a general explanation simplification algorithm that covers most
> cases, not just for opam, and various experiments on how to make distcheck
> handle source versions generically, all in the public Dose git repo, but we are
> far from finished yet, as it's pretty tricky work.
> 
> Now I really want to see everything converge back into a single code base again,
> which *is* free software: Dose and Cudf, to which everybody is welcome to
> contribute, even if I know that the learning curve is steep, despite all this
> being OCaml code.
> 
> Hope this clarifies my stance here.
> 
> --
> Roberto
> 


From agarwal1975 at gmail.com  Tue Sep 30 22:06:19 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Tue, 30 Sep 2014 17:06:19 -0400
Subject: [opam-devel] Travis CI failures
In-Reply-To: <34D069CE-2E14-498B-A471-4F153CBC952B@recoil.org>
References: <D445ED14-AC9A-4A65-88D6-AB45E1910AB2@gazagnaire.org>
 <E3B96826-4F40-4CDC-8E05-02DF1E6CBEB7@recoil.org>
 <CAMu2m2+ZuPaHEHjPtPRBLxdALmnLZx9hh6T02-fqM+2aD+Hjzw@mail.gmail.com>
 <30BC94CD-2132-42F0-8B21-49EC59760F54@recoil.org>
 <CAMu2m2+0AiWQfnB2SZ0VYxB5Bt7cWMO91h386KFqdOmM3NX6TQ@mail.gmail.com>
 <95EC1B02-B66F-4590-B7D9-FE2AF29F52AE@cam.ac.uk>
 <40DD484E-CBFF-442D-A5E6-0BA02E1DEA91@gazagnaire.org>
 <CAMu2m2Lbz2f2vWaDiCMPmA05SxkLwanNvN89T9R-VwRHGJSBqw@mail.gmail.com>
 <1BB48871-6BBA-4E6D-B5E7-2CE0633CA153@recoil.org>
 <CAMu2m2+k7isOhGwusYV2cgU0PJe8dPv=y+r2eQx6GHrz=o29-Q@mail.gmail.com>
 <34D069CE-2E14-498B-A471-4F153CBC952B@recoil.org>
Message-ID: <CAMu2m2LEbyRtFvUCmzQ7H_SK2d+eqgMZup0knu19Yvcqz=j6qQ@mail.gmail.com>

Going from nothing to a working OCaml installation is still a little too
hard, but only in terms of knowing what to do. Everything works if you know
what commands to run in all the various scenarios. In other words, the
Install page needs a lot more love.

On Tue, Sep 30, 2014 at 4:39 PM, Anil Madhavapeddy <anil at recoil.org> wrote:

> Ashish, this is *very* useful as it's the first stumbling block that users
> run into and give up when they do.  Thank you!
>
> -anil
>
> On 30 Sep 2014, at 17:16, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
>
> Thanks for the explanations. I spent all day learning more about package
> management on several OS's, and updated the ocaml.org install page.
> Hopefully things are a bit clearer.
>
> On Tue, Sep 30, 2014 at 4:27 AM, Anil Madhavapeddy <anil at recoil.org>
> wrote:
>
>> On 29 Sep 2014, at 19:46, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
>>
>> Thanks. I now have it working on Ubuntu. The issue is that several OS
>> packages have to be installed, not just "ocaml" and "camlp4". Thus, the
>> instructions [1,2] we've been linking people to are incomplete.
>>
>>
>> That's right -- this has always been the case historically on Debian
>> (somewhat suboptimally I think, but it fits in with their distribution
>> criteria).  I usually do "ocaml ocaml-native-compilers camlp4-extra" to get
>> everything.
>>
>>
>> I still don't know what to do on CentOS to get ocamldoc. Does anyone have
>> the full list of packages for each OS?
>>
>>
>> You should have got ocamldoc with just ocaml there.  I believe you just
>> need "ocaml" and "ocaml-camlp4" on CentOS, but please correct me if that's
>> wrong.  I don't regularly use it and so could have missed something in the
>> packaging.
>>
>>
>> Why are multiple packages needed? I would expect "apt-get install ocaml"
>> or "yum install ocaml" to install everything that one gets from installing
>> the source distribution of OCaml.
>>
>> [1]
>> http://software.opensuse.org/download.html?project=home:ocaml&package=opam
>> [2]
>> http://software.opensuse.org/download.html?project=home:ocaml&package=ocaml
>>
>>
>> That's just following upstream packaging practises.  I think it's better
>> to do that and to document what packages are needed, rather than changing
>> it for our local efforts.
>>
>> However, it could be easier.  I'll take a look at making the Travis
>> scripts a bit more automated by sourcing a central copy of the script from
>> somewhere on GitHub.  That'll reduce the rate of cut and pastes..
>>
>> -anil
>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140930/617a033e/attachment-0001.html>

