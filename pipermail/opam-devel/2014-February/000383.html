<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] How to manage a package manager (Was: Re: [opam] Build clarification (#1149))
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20How%20to%20manage%20a%20package%20manager%20%28Was%3A%20Re%3A%20%5Bopam%5D%0A%20Build%20clarification%20%28%231149%29%29&In-Reply-To=%3CCAHvkLrMzpHDNW-_j-tLLz5q71DMoKQSgTX0kB75Ez--0dy5Cmw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000382.html">
   <LINK REL="Next"  HREF="000385.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] How to manage a package manager (Was: Re: [opam] Build clarification (#1149))</H1>
    <B>Fabrice Le Fessant</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20How%20to%20manage%20a%20package%20manager%20%28Was%3A%20Re%3A%20%5Bopam%5D%0A%20Build%20clarification%20%28%231149%29%29&In-Reply-To=%3CCAHvkLrMzpHDNW-_j-tLLz5q71DMoKQSgTX0kB75Ez--0dy5Cmw%40mail.gmail.com%3E"
       TITLE="[opam-devel] How to manage a package manager (Was: Re: [opam] Build clarification (#1149))">Fabrice.Le_fessant at inria.fr
       </A><BR>
    <I>Sat Feb  1 18:27:40 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000382.html">[opam-devel] How to manage a package manager (Was: Re: [opam]	Build clarification (#1149))
</A></li>
        <LI>Next message: <A HREF="000385.html">[opam-devel] How to manage a package manager (Was: Re: [opam] Build clarification (#1149))
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#383">[ date ]</a>
              <a href="thread.html#383">[ thread ]</a>
              <a href="subject.html#383">[ subject ]</a>
              <a href="author.html#383">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

  Anil, I am worried that your workflow is not the typical workflow of
OCaml developers. You are an expert in OPAM, having several OPAM
repositories and so on. The typical user I imagine has little
knowledge of OPAM, and expect upgrades of both the repository and of
OPAM to be as simple as possible. I remember using Cabal to install
some Haskell software: I would do it once per year, at most, and
everytime, I was very annoyed to discover some incompatibility that
would require an update of Cabal itself. Now, I fear to see the same
problem with OPAM.

  Let's dream a little: in my ideal world, there would be an OPAM
_bytecode_ binary in the opam-repository, always the lattest stable
version, and able to upgrade whatever version I have of the
opam-repository to the lattest version. Everytime I would do &quot;opam
update&quot;, OPAM would first check that binary, download it if needed and
run it instead of itself (using the same trick as done by ocp-build
bytecode to be run on any system), upgrading the repo if needed, and
then do the update. The update would be almost completely transparent
(maybe OPAM would ask the user to authorize the update, since the user
has to trust a binary).

  Even if it's not easy to achieve, because of the risk of breaking
other OPAM features, I think &quot;transparent update&quot; is definitively
something the typical user of OPAM would like and find very cool with
OPAM, and worth adding the feature to the roadmap !
--Fabrice









On Sat, Feb 1, 2014 at 3:32 PM, Anil Madhavapeddy &lt;<A HREF="http://lists.ocaml.org/listinfo/opam-devel">anil at recoil.org</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On 1 Feb 2014, at 15:12, Roberto Di Cosmo &lt;<A HREF="http://lists.ocaml.org/listinfo/opam-devel">roberto at dicosmo.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On Sat, Feb 01, 2014 at 02:53:06PM +0100, Anil Madhavapeddy wrote:
</I>&gt;&gt;&gt;<i> On 1 Feb 2014, at 14:40, Roberto Di Cosmo &lt;<A HREF="http://lists.ocaml.org/listinfo/opam-devel">roberto at dicosmo.org</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> This is a very tricky interaction to get right,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Really? I would like to know more about this; please add the factual elements
</I>&gt;&gt;&gt;&gt;<i> to #1150
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I think the overall problem element is obvious: the opam binary within the
</I>&gt;&gt;&gt;<i> opam installation will be picked up very suddenly during package installation
</I>&gt;&gt;&gt;<i> and upgrades.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Rather than me listing why every single feature of OPAM would potentially break
</I>&gt;&gt;&gt;<i> (consider the 'repo upgrade' step that OPAM 1.0 -&gt; 1.1 does), I would again
</I>&gt;&gt;&gt;<i> suggest that you provide a strong motivation for why you want the feature in the
</I>&gt;&gt;&gt;<i> first place.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sorry, I really do not understand what you mean. On my side, I do believe I made
</I>&gt;&gt;<i> my point clear enough, and I see no point in continuing this exchange.
</I>&gt;<i>
</I>&gt;<i> Let me go back to your original point, which I agree with:
</I>&gt;<i>
</I>&gt;&gt;<i> That's why one needs a clear, and simple, mechanism to ensure a smooth
</I>&gt;&gt;<i> transition when incompatibilities arrive (and there will be more, and
</I>&gt;&gt;<i> unexpected ones, you can bet on it).
</I>&gt;<i>
</I>&gt;<i> My point is that the user originally obtains their version of OPAM via their
</I>&gt;<i> OS package manager (Homebrew, apt, BSD ports, Yum, etc).  All of these managers
</I>&gt;<i> provide a mechanism to warn the user of any upgrade steps that need to happen
</I>&gt;<i> when upgrading their distribution, and so is an ideal way to update OPAM
</I>&gt;<i> itself in the event of incompatible future changes.
</I>&gt;<i>
</I>&gt;<i> In contrast, `opam update` is part of a *development* workflow, not a system
</I>&gt;<i> upgrade path.  I do that when I want to recompile some part of my working
</I>&gt;<i> trees to a new package set, and often follow it up with an upgrade (via -u).
</I>&gt;<i>
</I>&gt;<i> If you mix these things up, then it violates a lot of expectations from the
</I>&gt;<i> user side, and can lead to the annoying situation where you are forced to deal
</I>&gt;<i> with a distribution upgrade when you were expecting to just alter some local
</I>&gt;<i> code.  Furthermore, it is quite common to destroy and reinitialize ~/.opam
</I>&gt;<i> or set a new OPAMROOT to test for a clean install, and this would subsequently
</I>&gt;<i> downgrade OPAM (or worse, cause an error if your shell path cache becomes
</I>&gt;<i> invalidated).
</I>&gt;<i>
</I>&gt;<i> We've already seen this problem in action with a number of tools such as
</I>&gt;<i> Merlin or ocp-index that really ought to be installed system-wide and not
</I>&gt;<i> within OPAM (since a code update could result in the editor tool being
</I>&gt;<i> recompiled or downgraded).  Another example is the Mirage command-line tool,
</I>&gt;<i> which uses libraries shared with development code.
</I>&gt;<i>
</I>&gt;<i> To summarise, this feature continues to blur the divide between a system tool
</I>&gt;<i> (OPAM, Merlin, ocp-index) from a development tool, and should not be
</I>&gt;<i> encouraged. I would like to see better support for managing system tools
</I>&gt;<i> within OPAM, but I think prioritising upstream integration of them should
</I>&gt;<i> be encouraged first.  OPAM is a developer supplement to make source-based
</I>&gt;<i> development easier, not a complete replacement for an existing OS package
</I>&gt;<i> manager.
</I>&gt;<i>
</I>&gt;<i> I hope that's clearer.  There are many negative reasons for upgrading OPAM
</I>&gt;<i> using OPAM, and I've still not seen a good reason for not focussing on
</I>&gt;<i> better upstream package manager (and hence external dependency) integration
</I>&gt;<i> before anything else.
</I>&gt;<i>
</I>&gt;<i> -anil
</I>&gt;<i> _______________________________________________
</I>&gt;<i> opam-devel mailing list
</I>&gt;<i> <A HREF="http://lists.ocaml.org/listinfo/opam-devel">opam-devel at lists.ocaml.org</A>
</I>&gt;<i> <A HREF="http://lists.ocaml.org/listinfo/opam-devel">http://lists.ocaml.org/listinfo/opam-devel</A>
</I>


-- 
Fabrice LE FESSANT
Chercheur en Informatique
INRIA Paris Rocquencourt -- OCamlPro
Programming Languages and Distributed Systems
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000382.html">[opam-devel] How to manage a package manager (Was: Re: [opam]	Build clarification (#1149))
</A></li>
	<LI>Next message: <A HREF="000385.html">[opam-devel] How to manage a package manager (Was: Re: [opam] Build clarification (#1149))
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#383">[ date ]</a>
              <a href="thread.html#383">[ thread ]</a>
              <a href="subject.html#383">[ subject ]</a>
              <a href="author.html#383">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
