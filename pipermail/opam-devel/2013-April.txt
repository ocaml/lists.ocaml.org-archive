From agarwal1975 at gmail.com  Mon Apr  1 14:28:21 2013
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Mon, 1 Apr 2013 09:28:21 -0400
Subject: [opam-devel] opam installs package but ocamlfind fails
In-Reply-To: <515841A8.4000009@braud-santoni.eu>
References: <CAMu2m2+RsuNdsJtLvJgu8uhRJ_OiFNXEm3Z0SpXQqqmgEx=THA@mail.gmail.com>
 <515841A8.4000009@braud-santoni.eu>
Message-ID: <CAMu2m2KEf8wpuxn=V2RSvmPgPCam4ckg_Ab-XCsbVm9OpqUzTA@mail.gmail.com>

I've managed to confuse opam.

$ opam switch
utrome3  C 4.00.1                     Official 4.00.1 release
4.00.1   I 4.00.1                     Official 4.00.1 release

So you can see I'm on the "utrome3" switch (an alias to 4.00.1), but:

$ which ocamlfind
~/.opam/4.00.1/bin/ocamlfind

So my environment variable are out of sync with the current switch.

I used to do "eval `opam config eval`" in my login scripts, but I thought
the below meant I should now just source ~/.opam/opam-init/init.sh. This
can't be right though because, after looking into opam-init.sh, I see that
setting environment variables to the 4.00.1 switch (the initial switch I
installed) is hardcoded.

Could we get some clarification on what the init.sh script is supposed to
do exactly. Is calling "eval `opam config eval`" still required in our
login scripts? If so, note that `opam init --auto-setup` doesn't do that.


On Thu, Mar 14, 2013 at 4:28 PM, Thomas Gazagnaire <thomas at ocamlpro.com>
 wrote:

> ...

The most visible new feature, which should be useful for beginners with
> OCaml and OPAM,  is an auto-configuration tool. This tool easily enables
> all the features of OPAM (auto-completion, fix the loading of scripts for
> the toplevel, opam-switch-eval alias, etc). This tool runs interactively on
> each `opam init` invocation. If you don't like OPAM to change your
> configuration files, use `opam init --no-setup`. If you trust the tool
> blindly,  use `opam init --auto-setup`. You can later review the setup by
> doing `opam config setup --list` and call the tool again using `opam config
> setup` (and you can of course manually edit your ~/.profile (or ~/.zshrc
> for zsh users), ~/.ocamlinit and ~/.opam/opam-init/*). ...
>



On Sun, Mar 31, 2013 at 10:01 AM, Nicolas Braud-Santoni <
nicolas at braud-santoni.eu> wrote:

> Did you check, using `which ocamlfind`, that you are indeed using the
> ocamlfind installation from OPAM ?
>
> On 30/03/2013 22:10, Ashish Agarwal wrote:
> > `opam install pxp` succeeds and `opam info pxp` shows that it is
> > installed. However,
> >
> > $ ocamlfind query pxp
> > ocamlfind: Package `pxp' not found
> >
> > This is only happening on one of my computers. On another, ocamlfind
> > does recognize pxp. I'm installing the same versions of all packages.
> > How can I investigate further?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20130401/a8f5535f/attachment.html>

From darioteixeira at yahoo.com  Mon Apr  1 17:27:22 2013
From: darioteixeira at yahoo.com (Dario Teixeira)
Date: Mon, 1 Apr 2013 09:27:22 -0700 (PDT)
Subject: [opam-devel] Error upgrading biniou
Message-ID: <1364833642.45662.YahooMailNeo@web120404.mail.ne1.yahoo.com>

Hi,

Something funky happened during an "opam upgrade": package biniou
is no longer installable.? Below is the log from the failed installation attempt.
Anyone else encountering this problem?

Cheers,
Dario Teixeira

==========================================================


dario at dual:~$ opam install biniou 
The following actions will be performed:
?- install biniou.1.0.5
1 to install | 0 to reinstall | 0 to upgrade | 0 to downgrade | 0 to remove

=-=-= Installing biniou.1.0.5 =-=-=
The archive for biniou.1.0.5 is in the local cache.
Extracting /home/dario/.opam/archives/biniou.1.0.5+opam.tar.gz.
Building biniou.1.0.5:
? make
? make install
The compilation of biniou.1.0.5 failed.
Uninstalling biniou.1.0.5:
? ocamlfind remove biniou


==== ERROR [while installing biniou.1.0.5] ====
# opam-version??? 1.0.0
# os????????????? linux
# command???????? make
# path??????????? /home/dario/.opam/4.00.1/build/biniou.1.0.5
# exit-code?????? 2
# env-file??????? /home/dario/.opam/4.00.1/build/biniou.1.0.5/biniou-5f1023.env
# stdout-file???? /home/dario/.opam/4.00.1/build/biniou.1.0.5/biniou-5f1023.out
# stderr-file???? /home/dario/.opam/4.00.1/build/biniou.1.0.5/biniou-5f1023.err
### stdout ###
ocamlfind ocamlc -a -dtypes -g -o biniou.cma \
??????????????? -package "easy-format" bi_util.mli bi_util.ml bi_share.mli bi_share.ml bi_outbuf.mli bi_outbuf.ml bi_inbuf.mli bi_inbuf.ml bi_vint.mli bi_vint.ml bi_io.mli bi_io.ml bi_dump.ml bi_stream.mli bi_stream.ml
ocamlfind ocamlopt -a -dtypes -g \
??????????????? -o biniou.cmxa -package "easy-format" bi_util.mli bi_util.ml bi_share.mli bi_share.ml bi_outbuf.mli bi_outbuf.ml bi_inbuf.mli bi_inbuf.ml bi_vint.mli bi_vint.ml bi_io.mli bi_io.ml bi_dump.ml bi_stream.mli bi_stream.ml
ocamlfind ocamlopt -o bdump -dtypes -g \
??????????????? -package easy-format -linkpkg \
??????????????? biniou.cmxa bdump.ml
### stderr ###
/usr/bin/ld: cannot find -leasy_format
collect2: ld returned 1 exit status
File "caml_startup", line 1:
Error: Error during linking
make: *** [bdump] Error 2

'opam install biniou' failed.


From monnier.florent at gmail.com  Mon Apr  1 19:34:23 2013
From: monnier.florent at gmail.com (Florent Monnier)
Date: Mon, 1 Apr 2013 20:34:23 +0200
Subject: [opam-devel] lablgl.1.04, split with lablglut?
Message-ID: <CAE1DttC6yvMGRMJFp0fH+KSGheEmEPB4p6uLmArZ66xuZbTHqg@mail.gmail.com>

2013/03/30, Florent Monnier <monnier.florent at gma...>:
[...]
> Well in this environment only lablgl itself compiles out of the box.
> LablGlut does not.
> Togl (Tk) does not either.
> (I think that the devel libs for both glut and tkgl are there)
>
> LablGlut and Togl are for windowing, so if we use OCamlSDL instead
> this is just fine we don't need these. OCamlSDL1 compiles out of the
> box in my win env.
[...]
> # don't build anything else than lablgl itself or we get errors:
> make lib
> make libopt

A solution could be to split the package in 2:
- lablgl
- lablglut

--

From hugo.heuzard at gmail.com  Mon Apr  1 19:38:35 2013
From: hugo.heuzard at gmail.com (hugo)
Date: Mon, 1 Apr 2013 11:38:35 -0700
Subject: [opam-devel] [ANN] imagemagick.0.34
Message-ID: <CAEYcRDEH=iWB0=W7csu4sY1z-FhDc2qS1k90-tPYCOumzTmhqQ@mail.gmail.com>

Hello,

I'm the author of the small fork of imagemagick.
I never took the time to push fixes upstream.
I'm glad it's done now.
Thank you

Hugo


On Sat, Mar 30, 2013 at 6:58 AM, <opam-devel-request at lists.ocaml.org> wrote:

> Send opam-devel mailing list submissions to
>         opam-devel at lists.ocaml.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>         http://lists.ocaml.org/listinfo/opam-devel
> or, via email, send a message with subject or body 'help' to
>         opam-devel-request at lists.ocaml.org
>
> You can reach the person managing the list at
>         opam-devel-owner at lists.ocaml.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of opam-devel digest..."
>
>
> Today's Topics:
>
>    1. [ANN] imagemagick.0.34 (Florent Monnier)
>    2. Re: [ANN] imagemagick.0.34 (Thomas Gazagnaire)
>    3. Re: [ANN] imagemagick.0.34 (Thomas Gazagnaire)
>    4. Re: [ANN] imagemagick.0.34 (Florent Monnier)
>    5. Re: [ANN] imagemagick.0.34 (Florent Monnier)
>    6. Re: [ANN] imagemagick.0.34 (Florent Monnier)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Sat, 30 Mar 2013 13:48:08 +0100
> From: Florent Monnier <monnier.florent at gmail.com>
> To: opam-devel <opam-devel at lists.ocaml.org>
> Subject: [opam-devel] [ANN] imagemagick.0.34
> Message-ID:
>         <
> CAE1DttAPQ1orbU3pf8hwR3Bbu-0pt_oWpSa0R8ayTkVPgjWakQ at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> Hi,
>
> While browsing opam's available packages I've seen imagemagick.0.33.*
> and I've seen that homepage is:
> https://github.com/besport/ocaml-imagemagick/
>
> I am the original upstream for this one, I really don't mind there are
> forks. I'm even happy with it because it means that some poeple seem
> got interested by it, but I really don't know how to handle this kind
> of situation.
>
> I've introduced the 0.33.* fixes in my 0.34 version.
> I've introduced them all almost verbatim, except the findlib install.
> I've kept my manual install, and added the 0.33.2 install renamed as
> find_install.
> (maybe I should do the opposite install for the find one, and the
> other one install_manual?)
>
> There is also a bug fix for the function: Magick.get_magick_version ()
> this was a very beginner error, but this is because this was the first
> thing I wrote in C in 2004. There are still probably other kind of
> similar errors :)
>
> I've also switched from GPL to MIT.
> I also fixed the broken urls given in the README, and added the github
> forker's name in the contributors.
>
> Maybe I should do some fork and pull requests on github, but I've not
> learned how to use git and github yet.
> I've created an account (https://github.com/blue-prawn) but now I need
> to read the man to learn how to use these.
>
> Here are below *untested* opam files.
> I've added an "author" field, so that you may use it later, in a
> similar way than in the Pear community (the wishlist links):
> http://pear.php.net/package/Archive_Tar/
>
> $ cat descr
> Bindings for ImageMagick
>
> $ cat opam
> opam-version: "1"
> maintainer: "contact at ocamlpro.com"
> authors: [
>   ["blue_prawn" "Florent Monnier"]
> ]
> contributors: [
>   ["hhugo" "Hugo Heuzard"]
>   ["?" "Fabrice Le Fessant"]
> ]
> build: [
>   [make]
>   [make "find_install"]
> ]
> remove: [
>   [make "find_uninstall"]
> ]
> depends:["ocamlfind"]
> homepages: [
>   "https://github.com/besport/ocaml-imagemagick"
>   "http://www.linux-nantes.org/%7Efmonnier/OCaml/ImageMagick/"
> ]
>
> $ cat url
> archive: "http://www.linux-nantes.org/%7Efmonnier/OCaml/ImageMagick/\
> downloads/OCaml-ImageMagick-0.34.tgz"
> checksum: "d4e28dce94ccefba878ad31016f05fe4"
>
> --
> Cheers
>
>
> ------------------------------
>
> Message: 2
> Date: Sat, 30 Mar 2013 14:00:35 +0100
> From: Thomas Gazagnaire <thomas at ocamlpro.com>
> To: Florent Monnier <monnier.florent at gmail.com>
> Cc: opam-devel <opam-devel at lists.ocaml.org>
> Subject: Re: [opam-devel] [ANN] imagemagick.0.34
> Message-ID: <30556629-32A7-48F6-83EC-1C7FFCB65117 at ocamlpro.com>
> Content-Type: text/plain; charset=us-ascii
>
> Hi Florent,
>
> Apologies for the confusion, we've recently automatically generated the
> homepage from the archive url for all packages "maintained" by OCamlPro. In
> this case, it was clearly not the right thing to do, and I am very happy to
> give you back the ownership of the package: I'll change the homepage of
> imagemagick to point to your homepage and I'll add you new release. Also,
> if you are fine with this,  I can change the maintainer contact address to
> yours (we've initially imported the package, that's why we were the
> maintainer and we are happy to help if there are some problems with new
> releases, but we really want giving back the credits to the original
> authors / maintainers of packages we've imported).
>
> Best and sorry again for the confusion,
> Thomas
>
> On Mar 30, 2013, at 1:48 PM, Florent Monnier wrote:
>
> > Hi,
> >
> > While browsing opam's available packages I've seen imagemagick.0.33.*
> > and I've seen that homepage is:
> > https://github.com/besport/ocaml-imagemagick/
> >
> > I am the original upstream for this one, I really don't mind there are
> > forks. I'm even happy with it because it means that some poeple seem
> > got interested by it, but I really don't know how to handle this kind
> > of situation.
> >
> > I've introduced the 0.33.* fixes in my 0.34 version.
> > I've introduced them all almost verbatim, except the findlib install.
> > I've kept my manual install, and added the 0.33.2 install renamed as
> > find_install.
> > (maybe I should do the opposite install for the find one, and the
> > other one install_manual?)
> >
> > There is also a bug fix for the function: Magick.get_magick_version ()
> > this was a very beginner error, but this is because this was the first
> > thing I wrote in C in 2004. There are still probably other kind of
> > similar errors :)
> >
> > I've also switched from GPL to MIT.
> > I also fixed the broken urls given in the README, and added the github
> > forker's name in the contributors.
> >
> > Maybe I should do some fork and pull requests on github, but I've not
> > learned how to use git and github yet.
> > I've created an account (https://github.com/blue-prawn) but now I need
> > to read the man to learn how to use these.
> >
> > Here are below *untested* opam files.
> > I've added an "author" field, so that you may use it later, in a
> > similar way than in the Pear community (the wishlist links):
> > http://pear.php.net/package/Archive_Tar/
> >
> > $ cat descr
> > Bindings for ImageMagick
> >
> > $ cat opam
> > opam-version: "1"
> > maintainer: "contact at ocamlpro.com"
> > authors: [
> >  ["blue_prawn" "Florent Monnier"]
> > ]
> > contributors: [
> >  ["hhugo" "Hugo Heuzard"]
> >  ["?" "Fabrice Le Fessant"]
> > ]
> > build: [
> >  [make]
> >  [make "find_install"]
> > ]
> > remove: [
> >  [make "find_uninstall"]
> > ]
> > depends:["ocamlfind"]
> > homepages: [
> >  "https://github.com/besport/ocaml-imagemagick"
> >  "http://www.linux-nantes.org/%7Efmonnier/OCaml/ImageMagick/"
> > ]
> >
> > $ cat url
> > archive: "http://www.linux-nantes.org/%7Efmonnier/OCaml/ImageMagick/\
> > downloads/OCaml-ImageMagick-0.34.tgz"
> > checksum: "d4e28dce94ccefba878ad31016f05fe4"
> >
> > --
> > Cheers
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
>
>
>
> ------------------------------
>
> Message: 3
> Date: Sat, 30 Mar 2013 14:30:26 +0100
> From: Thomas Gazagnaire <thomas at ocamlpro.com>
> To: Florent Monnier <monnier.florent at gmail.com>
> Cc: opam-devel <opam-devel at lists.ocaml.org>
> Subject: Re: [opam-devel] [ANN] imagemagick.0.34
> Message-ID: <C139672E-F5B7-4869-AABD-7BFFD4EE4664 at ocamlpro.com>
> Content-Type: text/plain; charset=us-ascii
>
> > I'll change the homepage of imagemagick to point to your homepage and
> I'll add you new release.
>
> Done [1]
>
> > Also, if you are fine with this,  I can change the maintainer contact
> address to yours
>
> Just waiting for you ack before doing this (or feel free to send me a
> patch).
>
> --
> Thomas
>
> [1] http://opam.ocamlpro.com/pkg/imagemagick.0.34.html
>
>
> > Best and sorry again for the confusion,
> > Thomas
> >
> > On Mar 30, 2013, at 1:48 PM, Florent Monnier wrote:
> >
> >> Hi,
> >>
> >> While browsing opam's available packages I've seen imagemagick.0.33.*
> >> and I've seen that homepage is:
> >> https://github.com/besport/ocaml-imagemagick/
> >>
> >> I am the original upstream for this one, I really don't mind there are
> >> forks. I'm even happy with it because it means that some poeple seem
> >> got interested by it, but I really don't know how to handle this kind
> >> of situation.
> >>
> >> I've introduced the 0.33.* fixes in my 0.34 version.
> >> I've introduced them all almost verbatim, except the findlib install.
> >> I've kept my manual install, and added the 0.33.2 install renamed as
> >> find_install.
> >> (maybe I should do the opposite install for the find one, and the
> >> other one install_manual?)
> >>
> >> There is also a bug fix for the function: Magick.get_magick_version ()
> >> this was a very beginner error, but this is because this was the first
> >> thing I wrote in C in 2004. There are still probably other kind of
> >> similar errors :)
> >>
> >> I've also switched from GPL to MIT.
> >> I also fixed the broken urls given in the README, and added the github
> >> forker's name in the contributors.
> >>
> >> Maybe I should do some fork and pull requests on github, but I've not
> >> learned how to use git and github yet.
> >> I've created an account (https://github.com/blue-prawn) but now I need
> >> to read the man to learn how to use these.
> >>
> >> Here are below *untested* opam files.
> >> I've added an "author" field, so that you may use it later, in a
> >> similar way than in the Pear community (the wishlist links):
> >> http://pear.php.net/package/Archive_Tar/
> >>
> >> $ cat descr
> >> Bindings for ImageMagick
> >>
> >> $ cat opam
> >> opam-version: "1"
> >> maintainer: "contact at ocamlpro.com"
> >> authors: [
> >> ["blue_prawn" "Florent Monnier"]
> >> ]
> >> contributors: [
> >> ["hhugo" "Hugo Heuzard"]
> >> ["?" "Fabrice Le Fessant"]
> >> ]
> >> build: [
> >> [make]
> >> [make "find_install"]
> >> ]
> >> remove: [
> >> [make "find_uninstall"]
> >> ]
> >> depends:["ocamlfind"]
> >> homepages: [
> >> "https://github.com/besport/ocaml-imagemagick"
> >> "http://www.linux-nantes.org/%7Efmonnier/OCaml/ImageMagick/"
> >> ]
> >>
> >> $ cat url
> >> archive: "http://www.linux-nantes.org/%7Efmonnier/OCaml/ImageMagick/\
> >> downloads/OCaml-ImageMagick-0.34.tgz"
> >> checksum: "d4e28dce94ccefba878ad31016f05fe4"
> >>
> >> --
> >> Cheers
> >> _______________________________________________
> >> opam-devel mailing list
> >> opam-devel at lists.ocaml.org
> >> http://lists.ocaml.org/listinfo/opam-devel
> >
>
>
>
> ------------------------------
>
> Message: 4
> Date: Sat, 30 Mar 2013 14:57:38 +0100
> From: Florent Monnier <monnier.florent at gmail.com>
> To: Thomas Gazagnaire <thomas at ocamlpro.com>
> Cc: opam-devel <opam-devel at lists.ocaml.org>
> Subject: Re: [opam-devel] [ANN] imagemagick.0.34
> Message-ID:
>         <CAE1DttAc9PGOt=rFS30AMZwFHtwr3161nPk=
> 9F80izrrE6yw3w at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> 2013/03/30, Thomas Gazagnaire <thomas at ocamlpr...>:
> [...]
> >> Also, if you are fine with this,  I can change the maintainer contact
> >> address to yours
> >
> > Just waiting for you ack before doing this (or feel free to send me a
> > patch).
>
> is it possible to write it in a web-obfuscated way for spammers?
>
> --
>
>
> ------------------------------
>
> Message: 5
> Date: Sat, 30 Mar 2013 15:02:51 +0100
> From: Florent Monnier <monnier.florent at gmail.com>
> To: Thomas Gazagnaire <thomas at ocamlpro.com>
> Cc: opam-devel <opam-devel at lists.ocaml.org>
> Subject: Re: [opam-devel] [ANN] imagemagick.0.34
> Message-ID:
>         <CAE1DttA1msN8FqP0dx3yX_2GUWW=
> j-bBGP0vjc5ryv3Dwj6aoQ at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> 2013/03/30, Thomas Gazagnaire <thomas at ocamlpr...>:
> > Hi Florent,
>
> Hi Thomas,
>
> > Apologies for the confusion, we've recently automatically generated the
> > homepage from the archive url for all packages "maintained" by OCamlPro.
> In
> > this case, it was clearly not the right thing to do, and I am very happy
> to
> > give you back the ownership of the package: I'll change the homepage of
> > imagemagick to point to your homepage and I'll add you new release.
>
> No need to apology, it's normal to take the most recent version available.
> Floss is made to make this possible, and this is great !
>
> --
> Cheers
>
>
> ------------------------------
>
> Message: 6
> Date: Sat, 30 Mar 2013 15:06:29 +0100
> From: Florent Monnier <monnier.florent at gmail.com>
> To: Thomas Gazagnaire <thomas at ocamlpro.com>
> Cc: opam-devel <opam-devel at lists.ocaml.org>
> Subject: Re: [opam-devel] [ANN] imagemagick.0.34
> Message-ID:
>         <
> CAE1DttDrCivdcF4ydKV+AOCXZiKdvSKtJ67aRg4k6ChLSY--Ng at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> >>> Also, if you are fine with this,  I can change the maintainer contact
> >>> address to yours
> >>
> >> Just waiting for you ack before doing this (or feel free to send me a
> >> patch).
> >
> > is it possible to write it in a web-obfuscated way for spammers?
>
> maybe some kind of:
> maintainer: "monnier." ^ "florent at gmail.com"
> ?
>
>
> --
> Cheers
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
>
> ------------------------------
>
> End of opam-devel Digest, Vol 1, Issue 21
> *****************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20130401/b8dc3bc1/attachment-0001.html>

From thomas at ocamlpro.com  Tue Apr  2 08:41:24 2013
From: thomas at ocamlpro.com (Thomas Gazagnaire)
Date: Tue, 2 Apr 2013 09:41:24 +0200
Subject: [opam-devel] lablgl.1.04, split with lablglut?
In-Reply-To: <CAE1DttC6yvMGRMJFp0fH+KSGheEmEPB4p6uLmArZ66xuZbTHqg@mail.gmail.com>
References: <CAE1DttC6yvMGRMJFp0fH+KSGheEmEPB4p6uLmArZ66xuZbTHqg@mail.gmail.com>
Message-ID: <1DA60BB6-8658-496F-BBDD-9F59F5C0A576@ocamlpro.com>

Would it be possible to continue this discussion on https://github.com/OCamlPro/opam-repository/issues/578 ?

Best,
Thomas

On Apr 1, 2013, at 8:34 PM, Florent Monnier wrote:

> 2013/03/30, Florent Monnier <monnier.florent at gma...>:
> [...]
>> Well in this environment only lablgl itself compiles out of the box.
>> LablGlut does not.
>> Togl (Tk) does not either.
>> (I think that the devel libs for both glut and tkgl are there)
>> 
>> LablGlut and Togl are for windowing, so if we use OCamlSDL instead
>> this is just fine we don't need these. OCamlSDL1 compiles out of the
>> box in my win env.
> [...]
>> # don't build anything else than lablgl itself or we get errors:
>> make lib
>> make libopt
> 
> A solution could be to split the package in 2:
> - lablgl
> - lablglut
> 
> --
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From thomas at ocamlpro.com  Tue Apr  2 08:52:44 2013
From: thomas at ocamlpro.com (Thomas Gazagnaire)
Date: Tue, 2 Apr 2013 09:52:44 +0200
Subject: [opam-devel] opam installs package but ocamlfind fails
In-Reply-To: <CAMu2m2KEf8wpuxn=V2RSvmPgPCam4ckg_Ab-XCsbVm9OpqUzTA@mail.gmail.com>
References: <CAMu2m2+RsuNdsJtLvJgu8uhRJ_OiFNXEm3Z0SpXQqqmgEx=THA@mail.gmail.com>
 <515841A8.4000009@braud-santoni.eu>
 <CAMu2m2KEf8wpuxn=V2RSvmPgPCam4ckg_Ab-XCsbVm9OpqUzTA@mail.gmail.com>
Message-ID: <DF1429F4-B9F0-447A-BAE9-E62EC917E2BF@ocamlpro.com>

> So my environment variable are out of sync with the current switch.

This can sometimes happen when $OPAMSWITCH is (usually wrongly) set. Try `unset OPAMSWITCH` before running your eval command, you add `--switch=<your-switch>` to the config command. I am aware this is quite annoying, I'm still trying to find a good solution to this which still enables some useful use-cases. But this particular issue should be fixed in master.

The issue is:
* by default OPAM look at ~/.opam/config to get the value of the current switch
* if OPAMSWITCH is set, OPAM will consider the value of that variable to be the current switch
* this can be overwritten by --switch=<..>

When exporting the environment variables (eg. using `opam config env`) OPAM 1.0 always export OPAMSWITCH with the current compiler switch (this was needed to make `opam config exec` works as expected). In master, OPAMSWITCH is not read when we do `opam config env`, which then export the right *global* variables.

> I used to do "eval `opam config eval`" in my login scripts, but I thought the below meant I should now just source ~/.opam/opam-init/init.sh. This can't be right though because, after looking into opam-init.sh, I see that setting environment variables to the 4.00.1 switch (the initial switch I installed) is hardcoded.

In an init script, you don't need to eval `opam config env`, you can just source ~/.opam/opam-config/init.sh. This will simply export the right global environment variables (corresponding to the value of the switch in ~/.opam/config) and will optionally enable auto-completion. It's still correct to run eval though. And after a switch you still need eval, because you want to dynamically rewrite the contents of some of your variables, for instance:
PATH=~/.opam/foo/bin:XXX
into
PATH=~/.opam/bar/bin:XXX

> Could we get some clarification on what the init.sh script is supposed to do exactly. Is calling "eval `opam config eval`" still required in our login scripts? If so, note that `opam init --auto-setup` doesn't do that.

You can look at the init script itself:

$ cat ~/.opam/opam-init/init.sh
# Load the environment variables
. /Users/tgazagna/.opam/opam-init/variables.sh

# Load the auto-complete scripts
. /Users/tgazagna/.opam/opam-init/complete.sh

# Load the opam-switch-eval script
. /Users/tgazagna/.opam/opam-init/switch_eval.sh

--
Thomas

> 
> 
> On Thu, Mar 14, 2013 at 4:28 PM, Thomas Gazagnaire <thomas at ocamlpro.com> wrote:
> ... 
> The most visible new feature, which should be useful for beginners with OCaml and OPAM,  is an auto-configuration tool. This tool easily enables all the features of OPAM (auto-completion, fix the loading of scripts for the toplevel, opam-switch-eval alias, etc). This tool runs interactively on each `opam init` invocation. If you don't like OPAM to change your configuration files, use `opam init --no-setup`. If you trust the tool blindly,  use `opam init --auto-setup`. You can later review the setup by doing `opam config setup --list` and call the tool again using `opam config setup` (and you can of course manually edit your ~/.profile (or ~/.zshrc for zsh users), ~/.ocamlinit and ~/.opam/opam-init/*). ...
>  
> 
> 
> On Sun, Mar 31, 2013 at 10:01 AM, Nicolas Braud-Santoni <nicolas at braud-santoni.eu> wrote:
> Did you check, using `which ocamlfind`, that you are indeed using the
> ocamlfind installation from OPAM ?
> 
> On 30/03/2013 22:10, Ashish Agarwal wrote:
> > `opam install pxp` succeeds and `opam info pxp` shows that it is
> > installed. However,
> >
> > $ ocamlfind query pxp
> > ocamlfind: Package `pxp' not found
> >
> > This is only happening on one of my computers. On another, ocamlfind
> > does recognize pxp. I'm installing the same versions of all packages.
> > How can I investigate further?
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From monnier.florent at gmail.com  Wed Apr  3 14:51:32 2013
From: monnier.florent at gmail.com (Florent Monnier)
Date: Wed, 3 Apr 2013 15:51:32 +0200
Subject: [opam-devel] license for passwdgen
Message-ID: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>

Hi,
I don't know if I should open an issue for this too.
I don't know what is the licensing policy for Opam.
I found the package "passwdgen" and while searching for its license I
was unable to find it.
Just tried to write to the email given in the README file but the
recipient's e-mail address was not found in the recipient's e-mail
system.
-- 
Cheers

From thomas at ocamlpro.com  Wed Apr  3 15:07:36 2013
From: thomas at ocamlpro.com (Thomas Gazagnaire)
Date: Wed, 3 Apr 2013 16:07:36 +0200
Subject: [opam-devel] license for passwdgen
In-Reply-To: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
References: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
Message-ID: <92AD96B2-38FB-426F-870F-654970AB59DF@ocamlpro.com>

> I don't know if I should open an issue for this too.

Not really, everything related to packages build errors and wrong package metadata aims to be tracked in OCamlPro/opam-repository. This list is intended to be used for discussing about OPAM internals and its evolution only (although specific feature requests are better tracked on OCamlPro/opam -- at least from my point of view, as I can prioritize issues and cross-reference commits/issues).

> I don't know what is the licensing policy for Opam.
> I found the package "passwdgen" and while searching for its license I
> was unable to find it.
> Just tried to write to the email given in the README file but the
> recipient's e-mail address was not found in the recipient's e-mail
> system.

That's a good point. I don't really know how other distro look after lost authors/maintainers.

Thomas

From anil at recoil.org  Wed Apr  3 23:30:15 2013
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 3 Apr 2013 15:30:15 -0700
Subject: [opam-devel] license for passwdgen
In-Reply-To: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
References: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
Message-ID: <B4C3544E-E698-482B-B7B6-D5AC104B5E1F@recoil.org>

If no license is specified anywhere within the package or its distribution
website, then we need to remove the package from the repository as we have
no right to redistribute it.

-anil

On 3 Apr 2013, at 06:51, Florent Monnier <monnier.florent at gmail.com> wrote:

> Hi,
> I don't know if I should open an issue for this too.
> I don't know what is the licensing policy for Opam.
> I found the package "passwdgen" and while searching for its license I
> was unable to find it.
> Just tried to write to the email given in the README file but the
> recipient's e-mail address was not found in the recipient's e-mail
> system.
> -- 
> Cheers
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
> 


From thomas at ocamlpro.com  Thu Apr  4 08:57:13 2013
From: thomas at ocamlpro.com (Thomas Gazagnaire)
Date: Thu, 4 Apr 2013 09:57:13 +0200
Subject: [opam-devel] license for passwdgen
In-Reply-To: <B4C3544E-E698-482B-B7B6-D5AC104B5E1F@recoil.org>
References: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
 <B4C3544E-E698-482B-B7B6-D5AC104B5E1F@recoil.org>
Message-ID: <6B56D57D-82A3-42B4-8319-E37D0621CB73@ocamlpro.com>

> If no license is specified anywhere within the package or its distribution
> website, then we need to remove the package from the repository as we have
> no right to redistribute it.

I've just removed it from OCamlPro/opam-repository.

--
Thomas

> 
> -anil
> 
> On 3 Apr 2013, at 06:51, Florent Monnier <monnier.florent at gmail.com> wrote:
> 
>> Hi,
>> I don't know if I should open an issue for this too.
>> I don't know what is the licensing policy for Opam.
>> I found the package "passwdgen" and while searching for its license I
>> was unable to find it.
>> Just tried to write to the email given in the README file but the
>> recipient's e-mail address was not found in the recipient's e-mail
>> system.
>> -- 
>> Cheers
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
>> 
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From roberto at dicosmo.org  Thu Apr  4 10:15:53 2013
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Thu, 4 Apr 2013 11:15:53 +0200
Subject: [opam-devel] license for passwdgen
In-Reply-To: <B4C3544E-E698-482B-B7B6-D5AC104B5E1F@recoil.org>
References: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
 <B4C3544E-E698-482B-B7B6-D5AC104B5E1F@recoil.org>
Message-ID: <20130404091553.GB7514@voyager>

Florent, Anil, thanks for raising this issue, which is indeed
quite an interesting one, and requires some thought.

Tracking license information is an important issue in general, but the case of
opam is quite special: opam "packages" just provide informations on building
binaries from sources that will be downloaded from somewhere on the net,
like BSD ports; they are not the same as typical binary packages
found on common GNU/Linux distros which need a very strict
licence screening process to accept packages (like Debian does);
as such, providing an opam package for a completely non-free
source is *not* a problem for opam: the possible licence
violation is perpetrated by the person that decides to build
the package on its own machine, not by the packager providing
the instructions on how to build it!
And it may be very well the case that such building instructions
are quite useful for people who have the right to use that software.

To sum up:

 - I do not think that one is *obliged* remove the opam package for 
   passwdgen from opam-repository

 - It is clear that one cannot make a copy of the *source code* of passwdgen
   on ocamlpro, so the opam package for passwdgen should point to the original
   URL for downloading the sources, not to an OCamlPro copy (which must be
   removed)

At the same time, making it easy for developers to incorportate non-free
code in their projects *without knowing it* is an issue, and I believe it
must be taken seriously.

Here is a proposal:

 - extend the metadata for opam packages with a "licenses" key, holding
   a list of the licenses used in the source code (that may include
   "unknown"); for this, we need a standardised list of values, and the
   SPDX standardised list available here https://spdx.org/licenses/ is
   a good starting point (incomplete, though, as they do not list our
   favorite LGPL with OCaml exception :-))

 - provide a simple guide for packagers pointing to the list of
   standard licence identifiers

 - add an option to opam to print licence information on the packages;
   opam list -l might produce something like (the licences are fake here)

    aacplus                       --  LGPL-3.0+,LGPL-2.0 Bindings for the aacplus library which provides functions for decoding AAC audio files
    aifad                         --  LGPL-2.0+          Machine learning library and application written in OCaml which generalizes decision tree learning to algebraic data types
    alberto                       --  LGPL-2.0           OCaml interface to Erlang ports
    ...

 - later on, add "profiles" to opam that allow to specify that one refuses
   to install components with licences not included in a specific list
   that represents the "house policy"; actually, this would have a quite
   high added value for commercial developers

--
Roberto

On Wed, Apr 03, 2013 at 03:30:15PM -0700, Anil Madhavapeddy wrote:
> If no license is specified anywhere within the package or its distribution
> website, then we need to remove the package from the repository as we have
> no right to redistribute it.
> 
> -anil
> 
> On 3 Apr 2013, at 06:51, Florent Monnier <monnier.florent at gmail.com> wrote:
> 
> > Hi,
> > I don't know if I should open an issue for this too.
> > I don't know what is the licensing policy for Opam.
> > I found the package "passwdgen" and while searching for its license I
> > was unable to find it.
> > Just tried to write to the email given in the README file but the
> > recipient's e-mail address was not found in the recipient's e-mail
> > system.
> > -- 
> > Cheers
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
> > 
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-- 
Roberto Di Cosmo
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        

From anil at recoil.org  Thu Apr  4 15:41:59 2013
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 4 Apr 2013 07:41:59 -0700
Subject: [opam-devel] license for passwdgen
In-Reply-To: <20130404091553.GB7514@voyager>
References: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
 <B4C3544E-E698-482B-B7B6-D5AC104B5E1F@recoil.org>
 <20130404091553.GB7514@voyager>
Message-ID: <79FD5B08-ED87-4EC5-BF8B-9534D315C7D4@recoil.org>

On 4 Apr 2013, at 02:15, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

> Florent, Anil, thanks for raising this issue, which is indeed
> quite an interesting one, and requires some thought.
> 
> Tracking license information is an important issue in general, but the case of
> opam is quite special: opam "packages" just provide informations on building
> binaries from sources that will be downloaded from somewhere on the net,
> like BSD ports; they are not the same as typical binary packages
> found on common GNU/Linux distros which need a very strict
> licence screening process to accept packages (like Debian does);
> as such, providing an opam package for a completely non-free
> source is *not* a problem for opam: the possible licence
> violation is perpetrated by the person that decides to build
> the package on its own machine, not by the packager providing
> the instructions on how to build it!
> And it may be very well the case that such building instructions
> are quite useful for people who have the right to use that software.
> 
> To sum up:
> 
> - I do not think that one is *obliged* remove the opam package for 
>   passwdgen from opam-repository
> 
> - It is clear that one cannot make a copy of the *source code* of passwdgen
>   on ocamlpro, so the opam package for passwdgen should point to the original
>   URL for downloading the sources, not to an OCamlPro copy (which must be
>   removed)

Note that these two go together: right now in OPAM we construct the
archive unconditionally, hence the immediate need for removal in the case
of unknown-licensed packages.

We can of course improve this, but it's good to fix licensing violations
as soon as we become aware of them.

> At the same time, making it easy for developers to incorportate non-free
> code in their projects *without knowing it* is an issue, and I believe it
> must be taken seriously.
> 
> Here is a proposal:
> 
> - extend the metadata for opam packages with a "licenses" key, holding
>   a list of the licenses used in the source code (that may include
>   "unknown"); for this, we need a standardised list of values, and the
>   SPDX standardised list available here https://spdx.org/licenses/ is
>   a good starting point (incomplete, though, as they do not list our
>   favorite LGPL with OCaml exception :-))

OASIS has a nice library to handle all this doesn't it?  CCing Sylvain to
see if it can be separately used by OPAM.

> 
> - provide a simple guide for packagers pointing to the list of
>   standard licence identifiers
> 
> - add an option to opam to print licence information on the packages;
>   opam list -l might produce something like (the licences are fake here)
> 
>    aacplus                       --  LGPL-3.0+,LGPL-2.0 Bindings for the aacplus library which provides functions for decoding AAC audio files
>    aifad                         --  LGPL-2.0+          Machine learning library and application written in OCaml which generalizes decision tree learning to algebraic data types
>    alberto                       --  LGPL-2.0           OCaml interface to Erlang ports
>    ...
> 
> - later on, add "profiles" to opam that allow to specify that one refuses
>   to install components with licences not included in a specific list
>   that represents the "house policy"; actually, this would have a quite
>   high added value for commercial developers

Indeed. For example, GPLv3 is banned in many commercial development situations,
so adding a house filter is a useful thing to have.

-anil

From monnier.florent at gmail.com  Thu Apr  4 16:13:31 2013
From: monnier.florent at gmail.com (Florent Monnier)
Date: Thu, 4 Apr 2013 17:13:31 +0200
Subject: [opam-devel] licensing handling for Opam
Message-ID: <CAE1DttCkwC+TQk+g6qSM2coC6UAbrMnWBfLk8Lh8NP=PZ=7DWA@mail.gmail.com>

2013/04/04, Anil Madhavapeddy <anil at recoi...>:
[...]
> OASIS has a nice library to handle all this doesn't it?  CCing Sylvain to
> see if it can be separately used by OPAM.

Be carefull though, such a solution can be for sure a help,
but a human check is still necessary.

This is very rare but sometimes there is a mismatch between the
licensing information provided in the _oasis file and in the headers
of the source code.
There is currently at least one lib like this.

-- 
Cheers

From roberto at dicosmo.org  Thu Apr  4 17:04:02 2013
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Thu, 4 Apr 2013 18:04:02 +0200
Subject: [opam-devel] license for passwdgen
In-Reply-To: <CAOCAUGNxS+okHdW7Dh=AC6nAGzPCpaD2wnVnmN4+2VQ9vQGO_A@mail.gmail.com>
References: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
 <B4C3544E-E698-482B-B7B6-D5AC104B5E1F@recoil.org>
 <20130404091553.GB7514@voyager>
 <79FD5B08-ED87-4EC5-BF8B-9534D315C7D4@recoil.org>
 <CAOCAUGMpdC_dFqZtu3TuTgAw47_H4_C_y532wTKCG5j16Oa7YQ@mail.gmail.com>
 <CAOCAUGNxS+okHdW7Dh=AC6nAGzPCpaD2wnVnmN4+2VQ9vQGO_A@mail.gmail.com>
Message-ID: <20130404160402.GC17519@voyager>

Many thanks Sylvain,
     I had missed this, and it is indeed a quite valuable pointer.
I would love to see a standalone library for handling license info
in a unified manner.

--
Roberto

On Thu, Apr 04, 2013 at 05:54:21PM +0200, Sylvain Le Gall wrote:
> Concerning SPDX vs DEP5:
> http://wiki.debian.org/Proposals/CopyrightFormat#Differences_between_DEP5_and_SPDX
> 
> 2013/4/4 Sylvain Le Gall <sylvain+ocaml at le-gall.net>:
> >>
> >>> Here is a proposal:
> >>>
> >>> - extend the metadata for opam packages with a "licenses" key, holding
> >>>   a list of the licenses used in the source code (that may include
> >>>   "unknown"); for this, we need a standardised list of values, and the
> >>>   SPDX standardised list available here https://spdx.org/licenses/ is
> >>>   a good starting point (incomplete, though, as they do not list our
> >>>   favorite LGPL with OCaml exception :-))
> >>
> >> OASIS has a nice library to handle all this doesn't it?  CCing Sylvain to
> >> see if it can be separately used by OPAM.
> >>
> >
> > OASIS has indeed a nice library (parser + types) to handle this. It
> > will be a shame to not share it with OCamlPro/OPAM people. Although as
> > per JS request I try to prevent having too much deps so that you'll
> > have a single tarball for OASIS, so I am not reluctant to split this
> > part (can be discussed though). Although the API is provided by the
> > OASIS library and OPAM people can use it (at least to see if it fits
> > their need).
> >
> > https://github.com/ocaml/oasis/blob/master/src/oasis/OASISLicense.mli
> > it is based on Debian's DEP5:
> > http://dep.debian.net/deps/dep5/#license-specification
> >
> > If you can talk to Yaron and he thinks it is a good idea to split this
> > part so that we have a common library for OPAM and OASIS, I am all for
> > it.
> >
> > BTW, DEP5 supports LGPL-2.1 with OCaml linking exception and it is
> > coded in OASISLicense...
> >
> > We can have an even more precise licensing scheme, using a bigger part
> > of the DEP5 (include file patterns to attribute license and
> > copyright). That was out of scope for OASIS, but can perfectly be
> > included in a more generic library.
> >
> > Regards
> > Sylvain

-- 
Roberto Di Cosmo
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        

From sylvain+ocaml at le-gall.net  Thu Apr  4 15:58:56 2013
From: sylvain+ocaml at le-gall.net (Sylvain Le Gall)
Date: Thu, 4 Apr 2013 16:58:56 +0200
Subject: [opam-devel] license for passwdgen
In-Reply-To: <79FD5B08-ED87-4EC5-BF8B-9534D315C7D4@recoil.org>
References: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
 <B4C3544E-E698-482B-B7B6-D5AC104B5E1F@recoil.org>
 <20130404091553.GB7514@voyager>
 <79FD5B08-ED87-4EC5-BF8B-9534D315C7D4@recoil.org>
Message-ID: <CAOCAUGMpdC_dFqZtu3TuTgAw47_H4_C_y532wTKCG5j16Oa7YQ@mail.gmail.com>

>
>> Here is a proposal:
>>
>> - extend the metadata for opam packages with a "licenses" key, holding
>>   a list of the licenses used in the source code (that may include
>>   "unknown"); for this, we need a standardised list of values, and the
>>   SPDX standardised list available here https://spdx.org/licenses/ is
>>   a good starting point (incomplete, though, as they do not list our
>>   favorite LGPL with OCaml exception :-))
>
> OASIS has a nice library to handle all this doesn't it?  CCing Sylvain to
> see if it can be separately used by OPAM.
>

OASIS has indeed a nice library (parser + types) to handle this. It
will be a shame to not share it with OCamlPro/OPAM people. Although as
per JS request I try to prevent having too much deps so that you'll
have a single tarball for OASIS, so I am not reluctant to split this
part (can be discussed though). Although the API is provided by the
OASIS library and OPAM people can use it (at least to see if it fits
their need).

https://github.com/ocaml/oasis/blob/master/src/oasis/OASISLicense.mli
it is based on Debian's DEP5:
http://dep.debian.net/deps/dep5/#license-specification

If you can talk to Yaron and he thinks it is a good idea to split this
part so that we have a common library for OPAM and OASIS, I am all for
it.

BTW, DEP5 supports LGPL-2.1 with OCaml linking exception and it is
coded in OASISLicense...

We can have an even more precise licensing scheme, using a bigger part
of the DEP5 (include file patterns to attribute license and
copyright). That was out of scope for OASIS, but can perfectly be
included in a more generic library.

Regards
Sylvain

From sylvain+ocaml at le-gall.net  Thu Apr  4 16:54:21 2013
From: sylvain+ocaml at le-gall.net (Sylvain Le Gall)
Date: Thu, 4 Apr 2013 17:54:21 +0200
Subject: [opam-devel] license for passwdgen
In-Reply-To: <CAOCAUGMpdC_dFqZtu3TuTgAw47_H4_C_y532wTKCG5j16Oa7YQ@mail.gmail.com>
References: <CAE1DttA5ZdaM6-J5qnu8DxvC4tWVyi0bcXtcK2rYS582MT+k8Q@mail.gmail.com>
 <B4C3544E-E698-482B-B7B6-D5AC104B5E1F@recoil.org>
 <20130404091553.GB7514@voyager>
 <79FD5B08-ED87-4EC5-BF8B-9534D315C7D4@recoil.org>
 <CAOCAUGMpdC_dFqZtu3TuTgAw47_H4_C_y532wTKCG5j16Oa7YQ@mail.gmail.com>
Message-ID: <CAOCAUGNxS+okHdW7Dh=AC6nAGzPCpaD2wnVnmN4+2VQ9vQGO_A@mail.gmail.com>

Concerning SPDX vs DEP5:
http://wiki.debian.org/Proposals/CopyrightFormat#Differences_between_DEP5_and_SPDX

2013/4/4 Sylvain Le Gall <sylvain+ocaml at le-gall.net>:
>>
>>> Here is a proposal:
>>>
>>> - extend the metadata for opam packages with a "licenses" key, holding
>>>   a list of the licenses used in the source code (that may include
>>>   "unknown"); for this, we need a standardised list of values, and the
>>>   SPDX standardised list available here https://spdx.org/licenses/ is
>>>   a good starting point (incomplete, though, as they do not list our
>>>   favorite LGPL with OCaml exception :-))
>>
>> OASIS has a nice library to handle all this doesn't it?  CCing Sylvain to
>> see if it can be separately used by OPAM.
>>
>
> OASIS has indeed a nice library (parser + types) to handle this. It
> will be a shame to not share it with OCamlPro/OPAM people. Although as
> per JS request I try to prevent having too much deps so that you'll
> have a single tarball for OASIS, so I am not reluctant to split this
> part (can be discussed though). Although the API is provided by the
> OASIS library and OPAM people can use it (at least to see if it fits
> their need).
>
> https://github.com/ocaml/oasis/blob/master/src/oasis/OASISLicense.mli
> it is based on Debian's DEP5:
> http://dep.debian.net/deps/dep5/#license-specification
>
> If you can talk to Yaron and he thinks it is a good idea to split this
> part so that we have a common library for OPAM and OASIS, I am all for
> it.
>
> BTW, DEP5 supports LGPL-2.1 with OCaml linking exception and it is
> coded in OASISLicense...
>
> We can have an even more precise licensing scheme, using a bigger part
> of the DEP5 (include file patterns to attribute license and
> copyright). That was out of scope for OASIS, but can perfectly be
> included in a more generic library.
>
> Regards
> Sylvain

From anil at recoil.org  Thu Apr  4 18:22:01 2013
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 4 Apr 2013 10:22:01 -0700
Subject: [opam-devel] licensing handling for Opam
In-Reply-To: <CAE1DttCkwC+TQk+g6qSM2coC6UAbrMnWBfLk8Lh8NP=PZ=7DWA@mail.gmail.com>
References: <CAE1DttCkwC+TQk+g6qSM2coC6UAbrMnWBfLk8Lh8NP=PZ=7DWA@mail.gmail.com>
Message-ID: <65B5EB45-4323-49FF-ACA3-B75954EC95AF@recoil.org>

On 4 Apr 2013, at 08:13, Florent Monnier <monnier.florent at gmail.com> wrote:

> 2013/04/04, Anil Madhavapeddy <anil at recoi...>:
> [...]
>> OASIS has a nice library to handle all this doesn't it?  CCing Sylvain to
>> see if it can be separately used by OPAM.
> 
> Be carefull though, such a solution can be for sure a help,
> but a human check is still necessary.
> 
> This is very rare but sometimes there is a mismatch between the
> licensing information provided in the _oasis file and in the headers
> of the source code.
> There is currently at least one lib like this.

You should report these upstream to get them fixed.  OPAM isn't really the place to hold local patches (as this metadata could be used by other package managers too).

-anil

From monnier.florent at gmail.com  Thu Apr  4 19:55:49 2013
From: monnier.florent at gmail.com (Florent Monnier)
Date: Thu, 4 Apr 2013 20:55:49 +0200
Subject: [opam-devel] licensing handling for Opam
In-Reply-To: <65B5EB45-4323-49FF-ACA3-B75954EC95AF@recoil.org>
References: <CAE1DttCkwC+TQk+g6qSM2coC6UAbrMnWBfLk8Lh8NP=PZ=7DWA@mail.gmail.com>
 <65B5EB45-4323-49FF-ACA3-B75954EC95AF@recoil.org>
Message-ID: <CAE1DttDW=DLxBffs98hzbF7os4r_OokxWwbX6yR-rhco2WfwQg@mail.gmail.com>

2013/4/4, Anil Madhavapeddy <anil at recoi...>:
> On 4 Apr 2013, at 08:13, Florent Monnier <monnier.florent at gmai...> wrote:
>> 2013/04/04, Anil Madhavapeddy <anil at recoi...>:
>> [...]
>>> OASIS has a nice library to handle all this doesn't it?  CCing Sylvain
>>> to see if it can be separately used by OPAM.
>>
>> Be carefull though, such a solution can be for sure a help,
>> but a human check is still necessary.
>>
>> This is very rare but sometimes there is a mismatch between the
>> licensing information provided in the _oasis file and in the headers
>> of the source code.
>> There is currently at least one lib like this.
>
> You should report these upstream to get them fixed.  OPAM isn't really the
> place to hold local patches (as this metadata could be used by other package
> managers too).

Yes I know.
It was just a warning against expecting to get things done
automatically without human checking the results.

(if I haven't reported upstream it's because I've seen it at a moment
when I couldn't report immediatly and the days after I didn't remember
which lib it was)

-- 
Cheers

From roberto at dicosmo.org  Thu Apr  4 21:31:23 2013
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Thu, 4 Apr 2013 22:31:23 +0200
Subject: [opam-devel] licensing handling for Opam
In-Reply-To: <CAE1DttDW=DLxBffs98hzbF7os4r_OokxWwbX6yR-rhco2WfwQg@mail.gmail.com>
References: <CAE1DttCkwC+TQk+g6qSM2coC6UAbrMnWBfLk8Lh8NP=PZ=7DWA@mail.gmail.com>
 <65B5EB45-4323-49FF-ACA3-B75954EC95AF@recoil.org>
 <CAE1DttDW=DLxBffs98hzbF7os4r_OokxWwbX6yR-rhco2WfwQg@mail.gmail.com>
Message-ID: <20130404203123.GA23276@voyager>

On Thu, Apr 04, 2013 at 08:55:49PM +0200, Florent Monnier wrote:
<snip>
> It was just a warning against expecting to get things done
> automatically without human checking the results.
> 

Sure, with legal issues at stake, no amount of checking (human
or automatic) is ever enough: you would need to have the full chain
of legal responsibility at hand, and there are many source codes
loose on the internet carrying licences choosen by people who did
not necessarily have the right to do it (and do not even know they
did not have the right to do it).

But we need to start somewhere, and having the metadata onboard
is a necessary first step (notice I even mentioned "unknown" as a possible
licence value, and listed two licences in one of the fake examples);
collecting a software distribution chain is a next step...
one at a time, we might go far :-)

-- 
Roberto
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        

From agarwal1975 at gmail.com  Sun Apr  7 19:51:59 2013
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Sun, 7 Apr 2013 14:51:59 -0400
Subject: [opam-devel] opam installs package but ocamlfind fails
In-Reply-To: <DF1429F4-B9F0-447A-BAE9-E62EC917E2BF@ocamlpro.com>
References: <CAMu2m2+RsuNdsJtLvJgu8uhRJ_OiFNXEm3Z0SpXQqqmgEx=THA@mail.gmail.com>
 <515841A8.4000009@braud-santoni.eu>
 <CAMu2m2KEf8wpuxn=V2RSvmPgPCam4ckg_Ab-XCsbVm9OpqUzTA@mail.gmail.com>
 <DF1429F4-B9F0-447A-BAE9-E62EC917E2BF@ocamlpro.com>
Message-ID: <CAMu2m2J0mG=Y6YDGBuS-ZOVopi1rEexAfCgS2w9PgPkhGz8OhA@mail.gmail.com>

On Tue, Apr 2, 2013 at 3:52 AM, Thomas Gazagnaire <thomas at ocamlpro.com>wrote:


> In an init script, you don't need to eval `opam config env`, you can just
> source ~/.opam/opam-config/init.sh.


I don't see how this is possible. My variables.sh file is:

$ cat variables.sh
CAML_LD_LIBRARY_PATH=/Users/ashish/.opam/4.00.1/lib/stublibs; export
CAML_LD_LIBRARY_PATH;
OCAML_TOPLEVEL_PATH=/Users/ashish/.opam/4.00.1/lib/toplevel; export
OCAML_TOPLEVEL_PATH;
MANPATH=/Users/ashish/.opam/4.00.1/man:$MANPATH; export MANPATH;
PATH=/Users/ashish/.opam/4.00.1/bin:$PATH; export PATH;

All path variables have a specific switch hardcoded in. When I do `opam
switch foo`, these paths will be wrong.



> And after a switch you still need eval, because you want to dynamically
> rewrite the contents of some of your variables


Right, so thus I have to eval `opam config env` in my login scripts too.
Otherwise, my path variables will always be whatever is in the above
variables.sh script.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20130407/1b4dfa70/attachment.html>

From thomas at ocamlpro.com  Sun Apr  7 20:10:08 2013
From: thomas at ocamlpro.com (Thomas Gazagnaire)
Date: Sun, 7 Apr 2013 21:10:08 +0200
Subject: [opam-devel] opam installs package but ocamlfind fails
In-Reply-To: <CAMu2m2J0mG=Y6YDGBuS-ZOVopi1rEexAfCgS2w9PgPkhGz8OhA@mail.gmail.com>
References: <CAMu2m2+RsuNdsJtLvJgu8uhRJ_OiFNXEm3Z0SpXQqqmgEx=THA@mail.gmail.com>
 <515841A8.4000009@braud-santoni.eu>
 <CAMu2m2KEf8wpuxn=V2RSvmPgPCam4ckg_Ab-XCsbVm9OpqUzTA@mail.gmail.com>
 <DF1429F4-B9F0-447A-BAE9-E62EC917E2BF@ocamlpro.com>
 <CAMu2m2J0mG=Y6YDGBuS-ZOVopi1rEexAfCgS2w9PgPkhGz8OhA@mail.gmail.com>
Message-ID: <0356462E-1976-4C7A-AA2C-F61C26F2E431@ocamlpro.com>

> I don't see how this is possible. My variables.sh file is:
> 
> $ cat variables.sh 
> CAML_LD_LIBRARY_PATH=/Users/ashish/.opam/4.00.1/lib/stublibs; export CAML_LD_LIBRARY_PATH;
> OCAML_TOPLEVEL_PATH=/Users/ashish/.opam/4.00.1/lib/toplevel; export OCAML_TOPLEVEL_PATH;
> MANPATH=/Users/ashish/.opam/4.00.1/man:$MANPATH; export MANPATH;
> PATH=/Users/ashish/.opam/4.00.1/bin:$PATH; export PATH;
> 
> All path variables have a specific switch hardcoded in. When I do `opam switch foo`, these paths will be wrong.

This file is under the control of OPAM. Which means that when you do `opam switch foo` it will rewrite its contents to use the new compiler switch (you can try, switch and look at the file contents again).


From agarwal1975 at gmail.com  Sun Apr  7 20:13:24 2013
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Sun, 7 Apr 2013 15:13:24 -0400
Subject: [opam-devel] opam installs package but ocamlfind fails
In-Reply-To: <0356462E-1976-4C7A-AA2C-F61C26F2E431@ocamlpro.com>
References: <CAMu2m2+RsuNdsJtLvJgu8uhRJ_OiFNXEm3Z0SpXQqqmgEx=THA@mail.gmail.com>
 <515841A8.4000009@braud-santoni.eu>
 <CAMu2m2KEf8wpuxn=V2RSvmPgPCam4ckg_Ab-XCsbVm9OpqUzTA@mail.gmail.com>
 <DF1429F4-B9F0-447A-BAE9-E62EC917E2BF@ocamlpro.com>
 <CAMu2m2J0mG=Y6YDGBuS-ZOVopi1rEexAfCgS2w9PgPkhGz8OhA@mail.gmail.com>
 <0356462E-1976-4C7A-AA2C-F61C26F2E431@ocamlpro.com>
Message-ID: <CAMu2m2LC30aSyq01W+akEErcBHvymRzhVsK32ZwU-nNfaOucPg@mail.gmail.com>

Okay, so then something wrong happened because I'm on a different switch
than what is in this file. If I can reproduce the error, I'll submit a bug
report.

On Sun, Apr 7, 2013 at 3:10 PM, Thomas Gazagnaire <thomas at ocamlpro.com>wrote:

> > I don't see how this is possible. My variables.sh file is:
> >
> > $ cat variables.sh
> > CAML_LD_LIBRARY_PATH=/Users/ashish/.opam/4.00.1/lib/stublibs; export
> CAML_LD_LIBRARY_PATH;
> > OCAML_TOPLEVEL_PATH=/Users/ashish/.opam/4.00.1/lib/toplevel; export
> OCAML_TOPLEVEL_PATH;
> > MANPATH=/Users/ashish/.opam/4.00.1/man:$MANPATH; export MANPATH;
> > PATH=/Users/ashish/.opam/4.00.1/bin:$PATH; export PATH;
> >
> > All path variables have a specific switch hardcoded in. When I do `opam
> switch foo`, these paths will be wrong.
>
> This file is under the control of OPAM. Which means that when you do `opam
> switch foo` it will rewrite its contents to use the new compiler switch
> (you can try, switch and look at the file contents again).
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20130407/401564c1/attachment.html>

From thomas at ocamlpro.com  Sun Apr  7 20:15:54 2013
From: thomas at ocamlpro.com (Thomas Gazagnaire)
Date: Sun, 7 Apr 2013 21:15:54 +0200
Subject: [opam-devel] opam installs package but ocamlfind fails
In-Reply-To: <CAMu2m2LC30aSyq01W+akEErcBHvymRzhVsK32ZwU-nNfaOucPg@mail.gmail.com>
References: <CAMu2m2+RsuNdsJtLvJgu8uhRJ_OiFNXEm3Z0SpXQqqmgEx=THA@mail.gmail.com>
 <515841A8.4000009@braud-santoni.eu>
 <CAMu2m2KEf8wpuxn=V2RSvmPgPCam4ckg_Ab-XCsbVm9OpqUzTA@mail.gmail.com>
 <DF1429F4-B9F0-447A-BAE9-E62EC917E2BF@ocamlpro.com>
 <CAMu2m2J0mG=Y6YDGBuS-ZOVopi1rEexAfCgS2w9PgPkhGz8OhA@mail.gmail.com>
 <0356462E-1976-4C7A-AA2C-F61C26F2E431@ocamlpro.com>
 <CAMu2m2LC30aSyq01W+akEErcBHvymRzhVsK32ZwU-nNfaOucPg@mail.gmail.com>
Message-ID: <08458309-FB64-42CF-8C2C-F3A2B5083E6B@ocamlpro.com>

> Okay, so then something wrong happened because I'm on a different switch than what is in this file. If I can reproduce the error, I'll submit a bug report.

The "right" switch is the one stored in ~/.opam/config (which should be the same as the one in the file)

But if you OPAMSWITCH set <FOO>, `opam switch show` and all `opam install` commands will consider the switch to be FOO.

Thomas


> 
> On Sun, Apr 7, 2013 at 3:10 PM, Thomas Gazagnaire <thomas at ocamlpro.com> wrote:
> > I don't see how this is possible. My variables.sh file is:
> >
> > $ cat variables.sh
> > CAML_LD_LIBRARY_PATH=/Users/ashish/.opam/4.00.1/lib/stublibs; export CAML_LD_LIBRARY_PATH;
> > OCAML_TOPLEVEL_PATH=/Users/ashish/.opam/4.00.1/lib/toplevel; export OCAML_TOPLEVEL_PATH;
> > MANPATH=/Users/ashish/.opam/4.00.1/man:$MANPATH; export MANPATH;
> > PATH=/Users/ashish/.opam/4.00.1/bin:$PATH; export PATH;
> >
> > All path variables have a specific switch hardcoded in. When I do `opam switch foo`, these paths will be wrong.
> 
> This file is under the control of OPAM. Which means that when you do `opam switch foo` it will rewrite its contents to use the new compiler switch (you can try, switch and look at the file contents again).
> 
> 


From agarwal1975 at gmail.com  Sun Apr  7 20:48:53 2013
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Sun, 7 Apr 2013 15:48:53 -0400
Subject: [opam-devel] opam installs package but ocamlfind fails
In-Reply-To: <08458309-FB64-42CF-8C2C-F3A2B5083E6B@ocamlpro.com>
References: <CAMu2m2+RsuNdsJtLvJgu8uhRJ_OiFNXEm3Z0SpXQqqmgEx=THA@mail.gmail.com>
 <515841A8.4000009@braud-santoni.eu>
 <CAMu2m2KEf8wpuxn=V2RSvmPgPCam4ckg_Ab-XCsbVm9OpqUzTA@mail.gmail.com>
 <DF1429F4-B9F0-447A-BAE9-E62EC917E2BF@ocamlpro.com>
 <CAMu2m2J0mG=Y6YDGBuS-ZOVopi1rEexAfCgS2w9PgPkhGz8OhA@mail.gmail.com>
 <0356462E-1976-4C7A-AA2C-F61C26F2E431@ocamlpro.com>
 <CAMu2m2LC30aSyq01W+akEErcBHvymRzhVsK32ZwU-nNfaOucPg@mail.gmail.com>
 <08458309-FB64-42CF-8C2C-F3A2B5083E6B@ocamlpro.com>
Message-ID: <CAMu2m2JwvK8yn-F7Pbv_Cxr1VCpddhObB8Qe0MoBXhjMC9q54w@mail.gmail.com>

https://github.com/OCamlPro/opam/issues/582

On Sun, Apr 7, 2013 at 3:15 PM, Thomas Gazagnaire <thomas at ocamlpro.com>wrote:

> > Okay, so then something wrong happened because I'm on a different switch
> than what is in this file. If I can reproduce the error, I'll submit a bug
> report.
>
> The "right" switch is the one stored in ~/.opam/config (which should be
> the same as the one in the file)
>
> But if you OPAMSWITCH set <FOO>, `opam switch show` and all `opam install`
> commands will consider the switch to be FOO.
>
> Thomas
>
>
> >
> > On Sun, Apr 7, 2013 at 3:10 PM, Thomas Gazagnaire <thomas at ocamlpro.com>
> wrote:
> > > I don't see how this is possible. My variables.sh file is:
> > >
> > > $ cat variables.sh
> > > CAML_LD_LIBRARY_PATH=/Users/ashish/.opam/4.00.1/lib/stublibs; export
> CAML_LD_LIBRARY_PATH;
> > > OCAML_TOPLEVEL_PATH=/Users/ashish/.opam/4.00.1/lib/toplevel; export
> OCAML_TOPLEVEL_PATH;
> > > MANPATH=/Users/ashish/.opam/4.00.1/man:$MANPATH; export MANPATH;
> > > PATH=/Users/ashish/.opam/4.00.1/bin:$PATH; export PATH;
> > >
> > > All path variables have a specific switch hardcoded in. When I do
> `opam switch foo`, these paths will be wrong.
> >
> > This file is under the control of OPAM. Which means that when you do
> `opam switch foo` it will rewrite its contents to use the new compiler
> switch (you can try, switch and look at the file contents again).
> >
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20130407/d1949972/attachment-0001.html>

From daniel.buenzli at erratique.ch  Mon Apr  8 10:01:58 2013
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Mon, 8 Apr 2013 10:01:58 +0100
Subject: [opam-devel] Patching packages (was Re: [ocaml-platform] A
 small script for compiler hackers: create short-lived opam switches out of
 any git branch)
In-Reply-To: <0F4674D723B446349AC4809560814966@erratique.ch>
References: <CAPFanBFcpQ8t-_HGiJxzxcsOUo6KLQ3FFoKZhGAxiLqgoaU7VA@mail.gmail.com>
 <wf620psule.fsf@gmail.com>
 <2B25C84C-22EA-4774-879C-3F852929E47C@recoil.org>
 <9669B7CC-E026-4709-9426-6697B697A118@ocamlpro.com>
 <0F4674D723B446349AC4809560814966@erratique.ch>
Message-ID: <6FF2BA5932B64A7797DD88AA2242694D@erratique.ch>

Le mardi, 19 mars 2013 ? 00:56, Daniel B?nzli a ?crit :
> Is there a way to specify patches during install ? That is patching an existing package without redoing a package.
>  
> The use case is that I have this patch [1] on ocp-indent that seems unlikely to be integrated (cf. [2]). Now I would like to be able to benefit from ocp-indent's default package updates but just apply the patch before installing.  
>  
> Is there a simple workflow to achieve that ?
The answer to my own question is yes (if you have a git repo with the patch and the package can be installed directly from the repo) :

    opam pin ocp-indent https://github.com/dbuenzli/ocp-indent.git

Just rebase the repo with the patch when needed.

Best,

Daniel



From anil at recoil.org  Sun Apr 14 10:35:50 2013
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 14 Apr 2013 10:35:50 +0100
Subject: [opam-devel] new: opam-1.0.0
In-Reply-To: <20130317223452.GA20172@soekris.calminferno.net>
References: <20130316014957.GK1709@soekris.calminferno.net>
 <20130317223452.GA20172@soekris.calminferno.net>
Message-ID: <C84E4814-0A14-4EC3-8426-A68F5F9965F0@recoil.org>

On 17 Mar 2013, at 22:34, James Turner <james at calminferno.net> wrote:

> On Fri, Mar 15, 2013 at 09:49:57PM -0400, James Turner wrote:
>> Attached is a new port for opam an OCaml source-based package manager.
>> Tested on amd64 and loongson. On amd64 the binaries produced are native
>> code while on loongson they are OCaml bytecode; so WANTLIB and PLIST
>> vary slightly for these type of platforms. However having the extra
>> WANTLIBs (c & m) and the @bin markers doesn't seem to be a problem on
>> the bytecode using platforms. Is this alright or should special checks
>> be put in place?
>> 
>> I would appreciate if OCaml people give this a go. I did limited testing
>> using opam init and opam installing some packages.
>> 
>> oks?
>> 
>> Information for inst:opam-1.0.0
>> 
>> Comment: OCaml source-based package manager
>> 
>> Description: OPAM is a source-based package manager for OCaml. It
>> supports multiple simultaneous compiler installations, flexible package
>> constraints, and a Git-friendly development workflow.
>> 
>> Maintainer: The OpenBSD ports mailing-list <ports at openbsd.org>
>> 
>> WWW: http://opam.ocamlpro.com/
>> 
> 
> jca@ noticed some issues with opam's build system, ocp-build, when
> building this port with SYSTRACE=Yes. The build system would download a
> few libraries at build time and basically statically compile them into
> the opam binary. jca@ discovered another distfile we can use that
> already contains these files. I've updated the port and it's attached
> here.
> 
> The other option would be to import the additional libraries as separate
> ports and rely on an alternate build target to build opam which would
> utilize the system libraries.
> 
> Preferences, thoughts?

ocp-build is a bit less packaging friendly than ocamlbuild.  There's a
'make with-ocamlbuild' target that will use that in preference to ocp-build
(however, ocp-build is far nicer for day-to-day development and will
eventually be packaging friendly too).

There's an opam-1.0.0-full.tar.gz which contains all the dependencies.
Since the final output is just a binary and has no LIB_DEPENDS on the
OCaml libraries, it may be simpler to package that instead.  It's already
been broken up though, so this is no big deal for the moment.

However, I did notice that the make with-ocamlbuild target seems to be
missing a cudf3 dependency on 1.0.0, so created an issue to look at it
later:
https://github.com/OCamlPro/opam/issues/591

-anil


