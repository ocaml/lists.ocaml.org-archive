<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] On self-upgrade
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20On%20self-upgrade&In-Reply-To=%3C7326DB4F-DE8D-4F68-B6D4-964198B9AB79%40recoil.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000568.html">
   <LINK REL="Next"  HREF="000570.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] On self-upgrade</H1>
    <B>Anil Madhavapeddy</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20On%20self-upgrade&In-Reply-To=%3C7326DB4F-DE8D-4F68-B6D4-964198B9AB79%40recoil.org%3E"
       TITLE="[opam-devel] On self-upgrade">anil at recoil.org
       </A><BR>
    <I>Wed Jun 25 19:25:23 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000568.html">[opam-devel] On self-upgrade
</A></li>
        <LI>Next message: <A HREF="000570.html">[opam-devel] On self-upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#569">[ date ]</a>
              <a href="thread.html#569">[ thread ]</a>
              <a href="subject.html#569">[ subject ]</a>
              <a href="author.html#569">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25 Jun 2014, at 19:07, Louis Gesbert &lt;<A HREF="http://lists.ocaml.org/listinfo/opam-devel">louis.gesbert at ocamlpro.com</A>&gt; wrote:

&gt;<i> I've attempted to make this as fool-proof as possible, and put good grounds first to enable further fixes within the opam package. The worst scenario I can think of is that your opam-self package is removed (failed to build, upgrade interrupted, or whatever reason). We then fallback to the system OPAM, that should still work ; if the repo format changed in the meantime, opam will advertise that it needs a newer version at startup, and you'll need to go through another channel to get it back. Annoying but not a critical failure, and we could mitigate this eg. with a backup advertised in the post_messages.
</I>&gt;<i> 
</I>
We've had all sorts of problems in Mirage with having the tool (opam package 'mirage') invoke OPAM to satisfy package dependencies, resulting in OPAM trying to recompile Mirage itself (due to a depopt showing up), but then resulting in a failure due to the classic 'text file busy' error when trying to move the old binary out of the way.

Is there an RT test that goes through the above sequence to simulate an upgrade and downgrade?  I really fear that this route will cause us to ignore system/OS packaging, which is really important to keep up-to-date for a package manager.  The self-upgrade route from within OPAM should never be the primary way to obtain the latest version of the package manager.

-anil
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000568.html">[opam-devel] On self-upgrade
</A></li>
	<LI>Next message: <A HREF="000570.html">[opam-devel] On self-upgrade
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#569">[ date ]</a>
              <a href="thread.html#569">[ thread ]</a>
              <a href="subject.html#569">[ subject ]</a>
              <a href="author.html#569">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
