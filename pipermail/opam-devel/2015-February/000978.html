<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] OPAM 1.3 roadmap
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20OPAM%201.3%20roadmap&In-Reply-To=%3CEC7E6CB8-0F27-40A6-8DBE-DFE464C60CE4%40recoil.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000977.html">
   <LINK REL="Next"  HREF="000974.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] OPAM 1.3 roadmap</H1>
    <B>Anil Madhavapeddy</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20OPAM%201.3%20roadmap&In-Reply-To=%3CEC7E6CB8-0F27-40A6-8DBE-DFE464C60CE4%40recoil.org%3E"
       TITLE="[opam-devel] OPAM 1.3 roadmap">anil at recoil.org
       </A><BR>
    <I>Thu Feb 26 17:04:05 GMT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="000977.html">[opam-devel] OPAM 1.3 roadmap
</A></li>
        <LI>Next message: <A HREF="000974.html">[opam-devel] OPAM 1.3 roadmap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#978">[ date ]</a>
              <a href="thread.html#978">[ thread ]</a>
              <a href="subject.html#978">[ subject ]</a>
              <a href="author.html#978">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26 Feb 2015, at 16:53, Peter Zotov &lt;<A HREF="http://lists.ocaml.org/listinfo/opam-devel">whitequark at whitequark.org</A>&gt; wrote:
&gt;<i> 
</I>&gt;<i> On 2015-02-26 19:51, Anil Madhavapeddy wrote:
</I>&gt;&gt;<i> On 25 Feb 2015, at 11:23, Peter Zotov &lt;<A HREF="http://lists.ocaml.org/listinfo/opam-devel">whitequark at whitequark.org</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> On 2015-02-25 14:20, Thomas Gazagnaire wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> I'm less sure about the viability of recording installed files
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> strictly -- I view thatas an advisory rather than enforcement-based
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> mechanism.  The reason I like the &quot;make ~/.opam a git store&quot; is that
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> its possible for applications to write directly into the store as they
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> do right now, but still let us track changes precisely.  In fact, if
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> we forbid subshells from writing into `~/.opam/.git`, this would be
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> a production grade solution that also offers instant-rollback in case
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> of compilation errors (no more waiting for a full recompilation of
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> the original dependencies!).
</I>&gt;&gt;&gt;&gt;&gt;<i> Please don't make .opam a git store. Even with one snapshot, it means
</I>&gt;&gt;&gt;&gt;&gt;<i> that my .opam would be 11G instead of 5.5G it currently is. What's worse
</I>&gt;&gt;&gt;&gt;&gt;<i> is that every recompilation or upgrade would balloon the store even more.
</I>&gt;&gt;&gt;&gt;&gt;<i> I can easily anticipate it filling the entirety of my 500GB drive,
</I>&gt;&gt;&gt;&gt;&gt;<i> for example. That's absurd.
</I>&gt;&gt;&gt;&gt;<i> It's not so simple, Git uses implicit hash-consing to share as much
</I>&gt;&gt;&gt;&gt;<i> blobs as possible, so snapshotting is free. This also means that
</I>&gt;&gt;&gt;&gt;<i> switches will be able to share binary blobs (a long-standing request).
</I>&gt;&gt;&gt;&gt;<i> All of this needs to be evaluated properly.
</I>&gt;&gt;&gt;<i> I know. The issue is that reinstalls tend to change large amounts of
</I>&gt;&gt;&gt;<i> files. Imagine upgrading Core, or even worse, the compiler. Even
</I>&gt;&gt;&gt;<i> with delta compression there would be no, or almost no, sharing
</I>&gt;&gt;&gt;<i> among the biggest blobs; without it, less so.
</I>&gt;&gt;<i> In this situation, the git base can be rebased after a successful
</I>&gt;&gt;<i> upgrade to remove the old version of the compiler and save space.
</I>&gt;&gt;<i> In the event of failure, it would allow for a fast switch back
</I>&gt;&gt;<i> to the old working version.
</I>&gt;<i> 
</I>&gt;<i> Do you need git for this? You can do it with hardlinks.
</I>
Sure, but that's a dead end with respect to all the other features
I described wanting a git-controlled OPAM for.  As Thomas noted, it
needs some experimentation and evaluation of space usage, but is
worth doing to see if it ends up being an effective way to do
sharing across switches and even machines.

-anil
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000977.html">[opam-devel] OPAM 1.3 roadmap
</A></li>
	<LI>Next message: <A HREF="000974.html">[opam-devel] OPAM 1.3 roadmap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#978">[ date ]</a>
              <a href="thread.html#978">[ thread ]</a>
              <a href="subject.html#978">[ subject ]</a>
              <a href="author.html#978">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
