<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] OPAM 1.3 roadmap
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20OPAM%201.3%20roadmap&In-Reply-To=%3C54EDEDED.9030402%40claret.me%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000978.html">
   <LINK REL="Next"  HREF="000980.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] OPAM 1.3 roadmap</H1>
    <B>Guillaume Claret</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20OPAM%201.3%20roadmap&In-Reply-To=%3C54EDEDED.9030402%40claret.me%3E"
       TITLE="[opam-devel] OPAM 1.3 roadmap">guillaume at claret.me
       </A><BR>
    <I>Wed Feb 25 15:44:45 GMT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="000978.html">[opam-devel] OPAM 1.3 roadmap
</A></li>
        <LI>Next message: <A HREF="000980.html">[opam-devel] OPAM 1.3 roadmap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#974">[ date ]</a>
              <a href="thread.html#974">[ thread ]</a>
              <a href="subject.html#974">[ subject ]</a>
              <a href="author.html#974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are using Git on an OPAM repository to optimize the Coq benches (not 
recompiling the dependencies). But there is a major limitation: Git does 
not see empty directories, what leads to some bugs sometimes.

Maybe other systems like Mercurial have less problems, else there may be 
the solution of dedicated backup tools, like <A HREF="https://github.com/bup/bup">https://github.com/bup/bup</A>

Guillaume

The 02/25/2015 12:20, Thomas Gazagnaire wrote:
&gt;&gt;&gt;&gt;<i> I'm less sure about the viability of recording installed files
</I>&gt;&gt;&gt;&gt;<i> strictly -- I view thatas an advisory rather than enforcement-based
</I>&gt;&gt;&gt;&gt;<i> mechanism.  The reason I like the &quot;make ~/.opam a git store&quot; is that
</I>&gt;&gt;&gt;&gt;<i> its possible for applications to write directly into the store as they
</I>&gt;&gt;&gt;&gt;<i> do right now, but still let us track changes precisely.  In fact, if
</I>&gt;&gt;&gt;&gt;<i> we forbid subshells from writing into `~/.opam/.git`, this would be
</I>&gt;&gt;&gt;&gt;<i> a production grade solution that also offers instant-rollback in case
</I>&gt;&gt;&gt;&gt;<i> of compilation errors (no more waiting for a full recompilation of
</I>&gt;&gt;&gt;&gt;<i> the original dependencies!).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Please don't make .opam a git store. Even with one snapshot, it means
</I>&gt;&gt;<i> that my .opam would be 11G instead of 5.5G it currently is. What's worse
</I>&gt;&gt;<i> is that every recompilation or upgrade would balloon the store even more.
</I>&gt;&gt;<i> I can easily anticipate it filling the entirety of my 500GB drive,
</I>&gt;&gt;<i> for example. That's absurd.
</I>&gt;<i>
</I>&gt;<i> It's not so simple, Git uses implicit hash-consing to share as much blobs as possible, so snapshotting is free. This also means that switches will be able to share binary blobs (a long-standing request). All of this needs to be evaluated properly.
</I>&gt;<i>
</I>&gt;&gt;<i> Also, git is pretty slow at handling many large binary files (which is
</I>&gt;&gt;<i> the single worst workload you can use it for). Delta compression
</I>&gt;&gt;<i> takes noticeable time on my blog, which has a mere 500MB of photos.
</I>&gt;<i>
</I>&gt;<i> Git is perfectly capable of handling large blobs if the zlib compression level is set to 0:
</I>&gt;<i>
</I>&gt;<i> $ git config --global core.compression 0
</I>&gt;<i>
</I>&gt;<i> But yes, the delta compression algorithm has been designed for code source files, so it might be non-optimal (ie. `git gc` will not be as efficient as expected). Anyway, version controlling .opam is a nice idea, but it definitely needs some eval and more coner-cases thoughs to make it work nicely for end-users.
</I>&gt;<i>
</I>&gt;<i> Thomas
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> opam-devel mailing list
</I>&gt;<i> <A HREF="http://lists.ocaml.org/listinfo/opam-devel">opam-devel at lists.ocaml.org</A>
</I>&gt;<i> <A HREF="http://lists.ocaml.org/listinfo/opam-devel">http://lists.ocaml.org/listinfo/opam-devel</A>
</I>&gt;<i>
</I></PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000978.html">[opam-devel] OPAM 1.3 roadmap
</A></li>
	<LI>Next message: <A HREF="000980.html">[opam-devel] OPAM 1.3 roadmap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#974">[ date ]</a>
              <a href="thread.html#974">[ thread ]</a>
              <a href="subject.html#974">[ subject ]</a>
              <a href="author.html#974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
