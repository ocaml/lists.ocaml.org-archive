<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] Feature request to get correct dependencies: build this pin in a fresh local root
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20Feature%20request%20to%20get%20correct%20dependencies%3A%20build%0A%20this%20pin%20in%20a%20fresh%20local%20root&In-Reply-To=%3CCAPFanBF7e0AqacuHpAvF7Yoahj90o7bb36eD5ZvYojg_UhHi9A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="001536.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] Feature request to get correct dependencies: build this pin in a fresh local root</H1>
    <B>Gabriel Scherer</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20Feature%20request%20to%20get%20correct%20dependencies%3A%20build%0A%20this%20pin%20in%20a%20fresh%20local%20root&In-Reply-To=%3CCAPFanBF7e0AqacuHpAvF7Yoahj90o7bb36eD5ZvYojg_UhHi9A%40mail.gmail.com%3E"
       TITLE="[opam-devel] Feature request to get correct dependencies: build this pin in a fresh local root">gabriel.scherer at gmail.com
       </A><BR>
    <I>Tue Mar  7 15:42:55 GMT 2017</I>
    <P><UL>
        
        <LI>Next message: <A HREF="001536.html">[opam-devel] Deserving for help on opam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1535">[ date ]</a>
              <a href="thread.html#1535">[ thread ]</a>
              <a href="subject.html#1535">[ subject ]</a>
              <a href="author.html#1535">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear opam-devel,

As for previous OCaml releases, I am going through existing OCaml package
to see what breaks in 4.05.0 to understand which parts of the ecosystem
have to be upgraded early to provide a good user-experience at release
time, and to find regressions in the compiler distribution. As I go over
the invaluable opam-builder output (
<A HREF="http://opam.ocamlpro.com/builder/html/report-full.html">http://opam.ocamlpro.com/builder/html/report-full.html</A> ), I often find
packages that have incorrect metadata, independently of 4.05.0, and I try
to fix those when possible. Ideally, I think we should have no broken build
in opam-builder all -- for example, broken packages create more work for me
when triaging the build outputs of a new ocamlbuild version.

I find that *surprisingly many* opam packages have incorrect dependencies
specified: they miss a lot of dependencies in the opam file.

In retrospect, this is not very surprising: programmers test their software
in their working OPAM switches, which already have these dependencies
installed (obviously to work on the software itself, but also because they
tend to work with other projects that already depend on those; so asking a
colleague to install the software on their own machine, for example, will
not catch these missing dependencies as colleagues have correlated
installed package sets).

It would be very nice if it was easy to ask opam to build a given local
package / pin in a fresh, local, empty opam root. This would immediately
catch these missing-dependencies problem, and it could be something we
encourage packager to do after &quot;opam lint&quot; has succeeded.

(This does not necessarily need to be a hardcoded opam feature, a simple
script may do. I suppose that the way to do this also differs on opam 1.x
and opam 2.x).

Relatedly, I think that this phenomenon of correlated-dependencies can
explain why certain kinds of Continuous Integration are more effective than
others at catching those: opam-builder is very good at this, as it always
build packages in an empty environment (this is made by cleverly caching
builds to avoid rebuilding dependencies in that case), while the datakit CI
on the opam-repository is not doing such a good job at detecting this
specific issue, because it tends to test packages changes by update actions
on top of an existing repository -- this difference is good as it means
that datakit will exercise other update paths and scenarios, and catch
other kind of issues.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ocaml.org/pipermail/opam-devel/attachments/20170307/a52feb74/attachment.html">http://lists.ocaml.org/pipermail/opam-devel/attachments/20170307/a52feb74/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="001536.html">[opam-devel] Deserving for help on opam
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1535">[ date ]</a>
              <a href="thread.html#1535">[ thread ]</a>
              <a href="subject.html#1535">[ subject ]</a>
              <a href="author.html#1535">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
