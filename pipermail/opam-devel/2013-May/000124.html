<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] Does pin git:// really make sense ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20Does%20pin%20git%3A//%20really%20make%20sense%20%3F&In-Reply-To=%3CB453B22B585A4C8086BABF63C8DE632D%40erratique.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000123.html">
   <LINK REL="Next"  HREF="000125.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] Does pin git:// really make sense ?</H1>
    <B>Daniel B&#252;nzli</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20Does%20pin%20git%3A//%20really%20make%20sense%20%3F&In-Reply-To=%3CB453B22B585A4C8086BABF63C8DE632D%40erratique.ch%3E"
       TITLE="[opam-devel] Does pin git:// really make sense ?">daniel.buenzli at erratique.ch
       </A><BR>
    <I>Thu May 30 13:01:43 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000123.html">[opam-devel] new branch merged
</A></li>
        <LI>Next message: <A HREF="000125.html">[opam-devel] Does pin git:// really make sense ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#124">[ date ]</a>
              <a href="thread.html#124">[ thread ]</a>
              <a href="subject.html#124">[ subject ]</a>
              <a href="author.html#124">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If I understand correctly if I pin a package on a git url, it uses the last known description of the corresponding package to try to build the package. If that's the correct I think it doesn't make sense in general. Concrete example at the end of this email.

Shouldn't there be some mechanism so that it can get the opam file from the git repo itself ?  

But then at that point the distinction between git repo and package becomes quite small and they could be merged as this could drastically simplify the distribution process (versions would just point to a specific git  commit, and things like ocamlpro's opam repository would reference them). I mean in my world a distribution is just a checkout + transformation applied on the result [1]. I wouldn't mind stopping distributing tarballs and have all the info in the git repository.

Also another issue about pin is that the version mentioned in `opam list` lies it should really try to use `git describe`. In my opam unstable repo which has only git packages and specific build instructions for building directly from the git checkout I use repo for the version name, this implies that `opam list` tells `repo` and I use `git describe` in the build instruction so that `ocamlfind list` tells me precisely which version is installed.  

Note that with the time this two-headed structure opam/ocamlfind seems stranger and stranger and I wonder if the tools should not merge at a certain point.  

Daniel

[1] This could however be a little bit more problematic for distributions that contain generated data that's a little bit painful to generate on each client (like uunf <A HREF="http://erratique.ch/software/uunf">http://erratique.ch/software/uunf</A> who needs to extract data from the unicode character database and substitute it in the source code before making a distribution, though that could be checked in another &quot;derived&quot; repo)


&gt;<i> opam pin ocp-indent <A HREF="git://github.com/OCamlPro/ocp-indent.git">git://github.com/OCamlPro/ocp-indent.git</A>
</I>&gt;<i> opam install ocp-indent
</I>The following actions will be performed:
- install ocp-indent.1.2.0
1 to install | 0 to reinstall | 0 to upgrade | 0 to downgrade | 0 to remove
&#128043; Installing ocp-indent.1.2.0  
Synchronizing ~/.opam/4.00.1/pinned.cache/ocp-indent with <A HREF="git://github.com/OCamlPro/ocp-indent.git.">git://github.com/OCamlPro/ocp-indent.git.</A>
Applying warnings.patch.
The compilation of ocp-indent.1.2.0 failed.
Uninstalling ocp-indent.1.2.0:
./configure --prefix /Users/dbuenzli/.opam/4.00.1
make uninstall
==== ERROR [while installing ocp-indent.1.2.0] ====
Internal error:
Cannot find /Users/dbuenzli/.opam/4.00.1/build/ocp-indent.1.2.0/warnings.patch.
'opam install ocp-indent' failed.



</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000123.html">[opam-devel] new branch merged
</A></li>
	<LI>Next message: <A HREF="000125.html">[opam-devel] Does pin git:// really make sense ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#124">[ date ]</a>
              <a href="thread.html#124">[ thread ]</a>
              <a href="subject.html#124">[ subject ]</a>
              <a href="author.html#124">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
