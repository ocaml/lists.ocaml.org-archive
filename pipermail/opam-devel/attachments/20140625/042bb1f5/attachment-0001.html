<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0//EN&quot;&nbsp;&quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;<br>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;name=&quot;qrichtext&quot;&nbsp;content=&quot;1&quot;&nbsp;/&gt;&lt;style&nbsp;type=&quot;text/css&quot;&gt;<br>
p,&nbsp;li&nbsp;{&nbsp;white-space:&nbsp;pre-wrap;&nbsp;}<br>
&lt;/style&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;&nbsp;font-family:'DejaVu&nbsp;Sans&nbsp;Mono';&nbsp;font-size:8pt;&nbsp;font-weight:400;&nbsp;font-style:normal;&quot;&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;Hi&nbsp;all,&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;The&nbsp;self-upgrade&nbsp;feature&nbsp;was&nbsp;introduced&nbsp;on&nbsp;March&nbsp;20&nbsp;[1],&nbsp;and&nbsp;there&nbsp;has&nbsp;been&nbsp;very&nbsp;little&nbsp;feedback&nbsp;so&nbsp;far,&nbsp;yet&nbsp;I&nbsp;have&nbsp;been&nbsp;told&nbsp;it&nbsp;raises&nbsp;some&nbsp;concerns&nbsp;so&nbsp;let&nbsp;me&nbsp;summarise&nbsp;the&nbsp;(simple)&nbsp;idea&nbsp;behind&nbsp;it&nbsp;and&nbsp;how&nbsp;it's&nbsp;expected&nbsp;to&nbsp;work.&nbsp;Note&nbsp;that&nbsp;it&nbsp;opens&nbsp;the&nbsp;gate&nbsp;for&nbsp;self-upgrades&nbsp;but&nbsp;the&nbsp;feature&nbsp;in&nbsp;itself&nbsp;doesn't&nbsp;trigger&nbsp;any&nbsp;new&nbsp;behaviour.&nbsp;I've&nbsp;more&nbsp;recently&nbsp;been&nbsp;adding&nbsp;version-checks&nbsp;[2]&nbsp;and&nbsp;a&nbsp;companion&nbsp;opam&nbsp;self-upgrade&nbsp;package&nbsp;[3].&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;*&nbsp;At&nbsp;startup,&nbsp;as&nbsp;soon&nbsp;as&nbsp;possible,&nbsp;OPAM&nbsp;checks&nbsp;if&nbsp;there&nbsp;is&nbsp;an&nbsp;'opam'&nbsp;exe&nbsp;and&nbsp;'opam.version'&nbsp;file&nbsp;in&nbsp;OPAMROOT.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;*&nbsp;If&nbsp;the&nbsp;version&nbsp;is&nbsp;newer&nbsp;than&nbsp;current,&nbsp;OPAM&nbsp;exec()s&nbsp;it.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;*&nbsp;We&nbsp;pass&nbsp;information&nbsp;through&nbsp;the&nbsp;environment&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;only&nbsp;happens&nbsp;once.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;*&nbsp;You&nbsp;can&nbsp;bypass&nbsp;it&nbsp;with&nbsp;OPAMNOSELFUPGRADE=1&nbsp;or&nbsp;--no-self-upgrade&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;*&nbsp;Information&nbsp;about&nbsp;what&nbsp;happens&nbsp;is&nbsp;present&nbsp;in&nbsp;several&nbsp;places&nbsp;to&nbsp;avoid&nbsp;surprises:&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&nbsp;&nbsp;-&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;debug&nbsp;log&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&nbsp;&nbsp;-&nbsp;in&nbsp;`opam&nbsp;config&nbsp;report`&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&nbsp;&nbsp;-&nbsp;as&nbsp;a&nbsp;warning&nbsp;if&nbsp;the&nbsp;system&nbsp;version&nbsp;is&nbsp;not&nbsp;a&nbsp;release&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;*&nbsp;This&nbsp;is&nbsp;opt-in:&nbsp;the&nbsp;idea&nbsp;is&nbsp;to&nbsp;provide&nbsp;the&nbsp;opam&nbsp;and&nbsp;opam.version&nbsp;files&nbsp;through&nbsp;an&nbsp;opam&nbsp;package,&nbsp;that&nbsp;the&nbsp;user&nbsp;explicitely&nbsp;installs&nbsp;[3].&nbsp;The&nbsp;package&nbsp;should&nbsp;explain&nbsp;what&nbsp;happens&nbsp;to&nbsp;the&nbsp;user&nbsp;(eg.&nbsp;via&nbsp;descr&nbsp;and&nbsp;post-messages).&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;*&nbsp;It&nbsp;can&nbsp;already&nbsp;be&nbsp;tested&nbsp;with&nbsp;`opam&nbsp;pin&nbsp;opam-bin&nbsp;git://github.com/ocaml/opam`.&nbsp;You&nbsp;need&nbsp;a&nbsp;recent&nbsp;version.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;*&nbsp;It&nbsp;follows&nbsp;that&nbsp;upgrades&nbsp;may&nbsp;come&nbsp;through&nbsp;the&nbsp;opam-repository,&nbsp;or&nbsp;git&nbsp;if&nbsp;pinned.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;I've&nbsp;attempted&nbsp;to&nbsp;make&nbsp;this&nbsp;as&nbsp;fool-proof&nbsp;as&nbsp;possible,&nbsp;and&nbsp;put&nbsp;good&nbsp;grounds&nbsp;first&nbsp;to&nbsp;enable&nbsp;further&nbsp;fixes&nbsp;within&nbsp;the&nbsp;opam&nbsp;package.&nbsp;The&nbsp;worst&nbsp;scenario&nbsp;I&nbsp;can&nbsp;think&nbsp;of&nbsp;is&nbsp;that&nbsp;your&nbsp;opam-self&nbsp;package&nbsp;is&nbsp;removed&nbsp;(failed&nbsp;to&nbsp;build,&nbsp;upgrade&nbsp;interrupted,&nbsp;or&nbsp;whatever&nbsp;reason).&nbsp;We&nbsp;then&nbsp;fallback&nbsp;to&nbsp;the&nbsp;system&nbsp;OPAM,&nbsp;that&nbsp;should&nbsp;still&nbsp;work&nbsp;;&nbsp;if&nbsp;the&nbsp;repo&nbsp;format&nbsp;changed&nbsp;in&nbsp;the&nbsp;meantime,&nbsp;opam&nbsp;will&nbsp;advertise&nbsp;that&nbsp;it&nbsp;needs&nbsp;a&nbsp;newer&nbsp;version&nbsp;at&nbsp;startup,&nbsp;and&nbsp;you'll&nbsp;need&nbsp;to&nbsp;go&nbsp;through&nbsp;another&nbsp;channel&nbsp;to&nbsp;get&nbsp;it&nbsp;back.&nbsp;Annoying&nbsp;but&nbsp;not&nbsp;a&nbsp;critical&nbsp;failure,&nbsp;and&nbsp;we&nbsp;could&nbsp;mitigate&nbsp;this&nbsp;eg.&nbsp;with&nbsp;a&nbsp;backup&nbsp;advertised&nbsp;in&nbsp;the&nbsp;post_messages.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;This&nbsp;feature&nbsp;has&nbsp;long&nbsp;been&nbsp;asked&nbsp;for&nbsp;[4]&nbsp;and&nbsp;I&nbsp;do&nbsp;think&nbsp;it&nbsp;is&nbsp;a&nbsp;useful&nbsp;one,&nbsp;if&nbsp;done&nbsp;right:&nbsp;it&nbsp;makes&nbsp;deployment&nbsp;of&nbsp;new&nbsp;versions&nbsp;faster&nbsp;and&nbsp;easier,&nbsp;helps&nbsp;people&nbsp;try&nbsp;out&nbsp;bleeding-edge&nbsp;versions&nbsp;if&nbsp;they&nbsp;want&nbsp;to,&nbsp;and&nbsp;generally&nbsp;makes&nbsp;upgrading&nbsp;easier&nbsp;for&nbsp;the&nbsp;user.&nbsp;Besides,&nbsp;people&nbsp;are&nbsp;expecting&nbsp;it.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;Cheers,&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;Louis&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;PS:&nbsp;I'm&nbsp;currently&nbsp;going&nbsp;through&nbsp;the&nbsp;bug-tracker&nbsp;and&nbsp;preparing&nbsp;a&nbsp;1.2.0-beta&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;[1]&nbsp;https://github.com/ocaml/opam/pull/1257&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;[2]&nbsp;https://github.com/ocaml/opam/pull/1440&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;[3]&nbsp;https://github.com/ocaml/opam/pull/1467&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;[4]&nbsp;https://github.com/ocaml/opam/issues/528&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;&quot;&gt;&nbsp;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
