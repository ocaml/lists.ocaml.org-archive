<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Dear&nbsp;OPAM-ers,&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;two&nbsp;systems&nbsp;on&nbsp;which&nbsp;opam&nbsp;is&nbsp;installed.&nbsp; System&nbsp;A&nbsp;runs&nbsp;Ubuntu&lt;br&gt;11.10&nbsp;(ancient,&nbsp;I&nbsp;know)&nbsp;and&nbsp;opam&nbsp;1.0.0,&nbsp;with&nbsp;the&nbsp;4.00.1&nbsp;ocaml&nbsp;compiler.&lt;br&gt;&lt;br&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;A&nbsp;$&nbsp;lsb_release&nbsp;-i&nbsp;-c&lt;br&gt;<br>
Distributor&nbsp;ID:&nbsp;Ubuntu&lt;br&gt;Codename:&nbsp; &nbsp; &nbsp; &nbsp;natty&lt;br&gt;A&nbsp;$&nbsp;opam&nbsp;--version&lt;br&gt;1.0.0&lt;/font&gt;&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;a&nbsp;second&nbsp;system,&nbsp;system&nbsp;B,&nbsp;running&nbsp;Ubuntu&nbsp;13.10&nbsp;(less&nbsp;ancient)&lt;br&gt;and&nbsp;opam&nbsp;1.1.1,&nbsp;with&nbsp;the&nbsp;3.12.1&nbsp;and&nbsp;4.01.0&nbsp;compilers&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;B&nbsp;$&nbsp;lsb_release&nbsp;-i&nbsp;-c&lt;br&gt;Distributor&nbsp;ID:&nbsp;Ubuntu&lt;br&gt;Codename:&nbsp; &nbsp; &nbsp; &nbsp;saucy&lt;br&gt;B&nbsp;$&nbsp;opam&nbsp;--version&lt;br&gt;1.1.1&lt;/font&gt;&lt;br&gt;&lt;br&gt;I&nbsp;will&nbsp;try&nbsp;to&nbsp;compile&nbsp;a&nbsp;simple&nbsp;ocaml&nbsp;program&nbsp;into&nbsp;bytecode,&nbsp;on&nbsp;both&lt;br&gt;<br>
systems,&nbsp;and&nbsp;for&nbsp;the&nbsp;heck&nbsp;of&nbsp;it,&nbsp;link&nbsp;against&nbsp;system&nbsp;threads&nbsp;library:&lt;br&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;A&nbsp;$&nbsp;echo&nbsp;&quot;let&nbsp;_&nbsp;=&nbsp;print_endline&nbsp;\&quot;hi\&quot;&quot;&nbsp;&gt;&nbsp;/tmp/&lt;a&nbsp;href=&quot;http://x.ml&quot;&gt;x.ml&lt;/a&gt;&lt;br&gt;A&nbsp;$&nbsp;/home/mika/.opam/4.00.1/bin/ocamlc&nbsp;-thread&nbsp;/home/mika/.opam/4.00.1/lib/ocaml/threads/threads.cma&nbsp;/tmp/&lt;a&nbsp;href=&quot;http://x.ml&quot;&gt;x.ml&lt;/a&gt;&nbsp;-o&nbsp;/tmp/x&lt;br&gt;<br>
A&nbsp;$&nbsp;/home/mika/.opam/4.00.1/bin/ocamlc.opt&nbsp;-thread&nbsp;/home/mika/.opam/4.00.1/lib/ocaml/threads/threads.cma&nbsp;/tmp/&lt;a&nbsp;href=&quot;http://x.ml&quot;&gt;x.ml&lt;/a&gt;&nbsp;-o&nbsp;/tmp/x&lt;br&gt;&lt;/font&gt;&lt;br&gt;No&nbsp;problem&nbsp;so&nbsp;far.&lt;br&gt;&lt;br&gt;Now&nbsp;on&nbsp;system&nbsp;B:&lt;br&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;B&nbsp;$&nbsp;echo&nbsp;&quot;let&nbsp;_&nbsp;=&nbsp;print_endline&nbsp;\&quot;hi\&quot;&quot;&nbsp;&gt;&nbsp;/tmp/&lt;a&nbsp;href=&quot;http://x.ml&quot;&gt;x.ml&lt;/a&gt;&lt;br&gt;<br>
B&nbsp;$&nbsp;/home/mika/.opam/3.12.1/bin/ocamlc&nbsp;-thread&nbsp;/home/mika/.opam/3.12.1/lib/ocaml/threads/threads.cma&nbsp;/tmp/&lt;a&nbsp;href=&quot;http://x.ml&quot;&gt;x.ml&lt;/a&gt;&nbsp;-o&nbsp;/tmp/x&lt;br&gt;B&nbsp;$&nbsp;/home/mika/.opam/3.12.1/bin/ocamlc.opt&nbsp;-thread&nbsp;/home/mika/.opam/3.12.1/lib/ocaml/threads/threads.cma&nbsp;/tmp/&lt;a&nbsp;href=&quot;http://x.ml&quot;&gt;x.ml&lt;/a&gt;&nbsp;-o&nbsp;/tmp/x&lt;br&gt;<br>
File&nbsp;&quot;/tmp/&lt;a&nbsp;href=&quot;http://x.ml&quot;&gt;x.ml&lt;/a&gt;&quot;,&nbsp;line&nbsp;1,&nbsp;characters&nbsp;0-1:&lt;br&gt;Error:&nbsp;Error&nbsp;on&nbsp;dynamically&nbsp;loaded&nbsp;library:&nbsp;/home/mika/.opam/3.12.1/lib/ocaml/stublibs/dllthreads.so:&nbsp;/home/mika/.opam/3.12.1/lib/ocaml/stublibs/dllthreads.so:&nbsp;undefined&nbsp;symbol:&nbsp;pthread_sigmask&lt;br&gt;<br>
&lt;/font&gt;&lt;br&gt;On&nbsp;system&nbsp;B,&nbsp;ocamlc.opt&nbsp;seems&nbsp;to&nbsp;have&nbsp;trouble,&nbsp;whereas&nbsp;ocamlc&nbsp;does&lt;br&gt;not.&nbsp; (4.01.0&nbsp;also&nbsp;has&nbsp;the&nbsp;identical&nbsp;issue).&nbsp; Trying&nbsp;to&nbsp;figure&nbsp;out&lt;br&gt;why,&nbsp;I&nbsp;looked&nbsp;at&nbsp;the&nbsp;DLL&nbsp;dependencies&nbsp;of&nbsp;the&nbsp;ocamlc.opt&#39;s&nbsp;:&lt;br&gt;&lt;br&gt;<br>
&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;A&nbsp;$&nbsp;ldd&nbsp;/home/mika/.opam/4.00.1/bin/ocamlc.opt&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;linux-vdso.so.1&nbsp;=&gt;&nbsp; (0x00007fffa29ff000)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;libm.so.6&nbsp;=&gt;&nbsp;/lib/x86_64-linux-gnu/libm.so.6&nbsp;(0x00007fad8291b000)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;libdl.so.2&nbsp;=&gt;&nbsp;/lib/x86_64-linux-gnu/libdl.so.2&nbsp;(0x00007fad82717000)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;libncurses.so.5&nbsp;=&gt;&nbsp;/lib/libncurses.so.5&nbsp;(0x00007fad824d2000)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;libpthread.so.0&nbsp;=&gt;&nbsp;/lib/x86_64-linux-gnu/libpthread.so.0&nbsp;(0x00007fad822b4000)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;libc.so.6&nbsp;=&gt;&nbsp;/lib/x86_64-linux-gnu/libc.so.6&nbsp;(0x00007fad81f1c000)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;/lib64/ld-linux-x86-64.so.2&nbsp;(0x00007fad82bc7000)&lt;br&gt;&lt;/font&gt;&lt;br&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;B&nbsp;$&nbsp;ldd&nbsp;/home/mika/.opam/3.12.1/bin/ocamlc.opt&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;linux-vdso.so.1&nbsp;=&gt;&nbsp; (0x00007fff8affe000)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;libm.so.6&nbsp;=&gt;&nbsp;/lib/x86_64-linux-gnu/libm.so.6&nbsp;(0x00007f128410c000)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;libdl.so.2&nbsp;=&gt;&nbsp;/lib/x86_64-linux-gnu/libdl.so.2&nbsp;(0x00007f1283f08000)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;libc.so.6&nbsp;=&gt;&nbsp;/lib/x86_64-linux-gnu/libc.so.6&nbsp;(0x00007f1283b3f000)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;/lib64/ld-linux-x86-64.so.2&nbsp;(0x00007f128441c000)&lt;/font&gt;&lt;br&gt;&lt;br&gt;The&nbsp;critical&nbsp;difference&nbsp;seems&nbsp;to&nbsp;be&nbsp;that&nbsp;system&nbsp;A&#39;s&nbsp;ocamlc.opt&nbsp;is&nbsp;linked&lt;br&gt;against&nbsp;libpthread.so&nbsp;(and&nbsp;libncurses.so,&nbsp;for&nbsp;whatever&nbsp;reason),&nbsp;and&lt;br&gt;<br>
system&nbsp;B&#39;s&nbsp;does&nbsp;not.&nbsp; In&nbsp;fact,&nbsp;compilation&nbsp;succeeds&nbsp;on&nbsp;system&nbsp;B&nbsp;if&nbsp;I&lt;br&gt;use&nbsp;LD_PRELOAD:&lt;br&gt;&lt;br&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;B&nbsp;$&nbsp;LD_PRELOAD=/lib/x86_64-linux-gnu/libpthread.so.0&nbsp; /home/mika/.opam/3.12.1/bin/ocamlc&nbsp;-thread&nbsp;/home/mika/.opam/3.12.1/lib/ocaml/threads/threads.cma&nbsp;/tmp/&lt;a&nbsp;href=&quot;http://x.ml&quot;&gt;x.ml&lt;/a&gt;&nbsp;-o&nbsp;/tmp/x&lt;br&gt;<br>
&lt;/font&gt;&lt;br&gt;Incidentally,&nbsp;if&nbsp;I&nbsp;compile&nbsp;ocaml&nbsp;from&nbsp;Inria&#39;s&nbsp;tarball,&nbsp;compilation&lt;br&gt;using&nbsp;ocamlc.opt&nbsp;also&nbsp;fails&nbsp;on&nbsp;system&nbsp;B,&nbsp;unless&nbsp;I&nbsp;configure&nbsp;the&nbsp;the&lt;br&gt;compilation&nbsp;of&nbsp;the&nbsp;compiler&nbsp;with&nbsp;&quot;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;./configure&nbsp;-libs&nbsp;-lpthread&lt;/font&gt;&quot;&nbsp;.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;ocaml&nbsp;installed&nbsp;through&nbsp;opam&nbsp;on&nbsp;system&nbsp;A&nbsp;seems&nbsp;to&nbsp;do&nbsp;the&nbsp;right&lt;br&gt;thing.&nbsp; Does&nbsp;anyone&nbsp;have&nbsp;any&nbsp;idea&nbsp;how&nbsp;I&nbsp;can&nbsp;make&nbsp;system&nbsp;B&#39;s&nbsp;compiler&lt;br&gt;behave&nbsp;similarly?&lt;br&gt;&lt;br&gt;thanks&lt;br&gt;mika&lt;br&gt;&lt;/div&gt;<br>

</tt>
