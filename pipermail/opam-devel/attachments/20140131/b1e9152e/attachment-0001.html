<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Another&nbsp;possible&nbsp;solution&nbsp;is&nbsp;to&nbsp;have&nbsp;the&nbsp;repository&nbsp;format&nbsp;include&nbsp;its&nbsp;version&nbsp;number&nbsp;somewhere.&nbsp;Then&nbsp;make&nbsp;opam&nbsp;always&nbsp;check&nbsp;the&nbsp;version&nbsp;number&nbsp;and&nbsp;give&nbsp;a&nbsp;useful&nbsp;message&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;know&nbsp;how&nbsp;to&nbsp;deal&nbsp;with&nbsp;the&nbsp;repo&nbsp;version.&nbsp;The&nbsp;message&nbsp;is&nbsp;&quot;sorry,&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;&lt;a&nbsp;href=&quot;http://opam.ocaml.org&quot;&gt;opam.ocaml.org&lt;/a&gt;&nbsp;(or&nbsp;whichever&nbsp;repo&nbsp;it&nbsp;is),&nbsp;then&nbsp;you&nbsp;have&nbsp;to&nbsp;upgrade&nbsp;opam&quot;.&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;doesn&#39;t&nbsp;provide&nbsp;as&nbsp;smooth&nbsp;of&nbsp;an&nbsp;upgrade&nbsp;path&nbsp;as&nbsp;your&nbsp;proposal,&nbsp;but&nbsp;it&nbsp;seems&nbsp;easier&nbsp;to&nbsp;implement.&nbsp;Automatically&nbsp;updating&nbsp;opam&nbsp;and&nbsp;updating&nbsp;the&nbsp;repos&nbsp;a&nbsp;user&nbsp;has&nbsp;configured&nbsp;is&nbsp;likely&nbsp;to&nbsp;be&nbsp;buggy.&nbsp;Also,&nbsp;it&nbsp;is&nbsp;possible&nbsp;that&nbsp;a&nbsp;single&nbsp;version&nbsp;of&nbsp;opam&nbsp;can&nbsp;work&nbsp;with&nbsp;multiple&nbsp;repo&nbsp;versions.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;all&nbsp;cases,&nbsp;it&nbsp;should&nbsp;be&nbsp;considered&nbsp;that&nbsp;&lt;a&nbsp;href=&quot;https://opam.ocaml.org&quot;&gt;https://opam.ocaml.org&lt;/a&gt;&nbsp;must&nbsp;remain&nbsp;the&nbsp;main&nbsp;repo&nbsp;URL.&nbsp;It&nbsp;is&nbsp;the&nbsp;nice&nbsp;URL&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;have&nbsp;the&nbsp;next&nbsp;repo&nbsp;be&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;https://opam2.ocaml.org&quot;&gt;https://opam2.ocaml.org&lt;/a&gt;.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Jan&nbsp;31,&nbsp;2014&nbsp;at&nbsp;12:28&nbsp;PM,&nbsp;Roberto&nbsp;Di&nbsp;Cosmo&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:roberto@dicosmo.org&quot;&nbsp;target=&quot;_blank&quot;&gt;roberto@dicosmo.org&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;[I&nbsp;am&nbsp;moving&nbsp;this&nbsp;discussion&nbsp;away&nbsp;from&nbsp;the&nbsp;BTS&nbsp;and&nbsp;into&lt;br&gt;<br>
 the&nbsp;mailing&nbsp;list,&nbsp;as&nbsp;the&nbsp;issues&nbsp;raised&nbsp;here&nbsp;are&nbsp;of&lt;br&gt;<br>
 general&nbsp;relevance&nbsp;for&nbsp;the&nbsp;future&nbsp;of&nbsp;Opam,&nbsp;and&nbsp;must&lt;br&gt;<br>
 not&nbsp;be&nbsp;lost&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;other&nbsp;comments;&nbsp;see&lt;br&gt;<br>
 &lt;a&nbsp;href=&quot;https://github.com/ocaml/opam/pull/1149&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/ocaml/opam/pull/1149&lt;/a&gt;&nbsp;for&nbsp;the&nbsp;original&lt;br&gt;<br>
 discussion&lt;br&gt;<br>
--&lt;br&gt;<br>
Roberto&lt;br&gt;<br>
]&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;original&nbsp;issue:&nbsp;what&nbsp;build&nbsp;system&nbsp;should&nbsp;we&nbsp;use&nbsp;to&nbsp;build&nbsp;opam?&lt;br&gt;<br>
Should&nbsp;we&nbsp;cook&nbsp;up&nbsp;an&nbsp;ad-hoc&nbsp;Makefile,&nbsp;use&nbsp;a&nbsp;patched&nbsp;ocamlbuild,&lt;br&gt;<br>
or&nbsp;use&nbsp;OCamlMakefile,&nbsp;or&nbsp;use&nbsp;ocp-build?&nbsp;Is&nbsp;it&nbsp;evil&nbsp;to&nbsp;embark&lt;br&gt;<br>
a&nbsp;build&nbsp;system&nbsp;in&nbsp;the&nbsp;package&nbsp;manager&nbsp;source&nbsp;code?&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;quick&nbsp;view&nbsp;of&nbsp;these&nbsp;issues:&lt;br&gt;<br>
&lt;br&gt;<br>
 1)&nbsp;choice&nbsp;of&nbsp;the&nbsp;build&nbsp;system&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; we&nbsp;are&nbsp;already&nbsp;plagued&nbsp;with&nbsp;multiple&nbsp;build&nbsp;systems,&nbsp;and&nbsp;one&nbsp;of&nbsp;the&nbsp;reason&lt;br&gt;<br>
 &nbsp; &nbsp; of&nbsp;opam&#39;s&nbsp;success&nbsp;is&nbsp;that&nbsp;it&nbsp;allows&nbsp;every&nbsp;package&nbsp;author&nbsp;the&nbsp;freedom&nbsp;to&nbsp;use&lt;br&gt;<br>
 &nbsp; &nbsp; the&nbsp;one&nbsp;he/she&nbsp;prefers/&nbsp;is&nbsp;more&nbsp;comfortable&nbsp;with.&lt;br&gt;<br>
 &nbsp; &nbsp; Opam&nbsp;is&nbsp;no&nbsp;exception,&nbsp;and&nbsp;opam&nbsp;developers&nbsp;must&nbsp;be&nbsp;able&nbsp;to&nbsp;pick&nbsp;the&nbsp;build&nbsp;system&lt;br&gt;<br>
 &nbsp; &nbsp; they&nbsp;prefer,&nbsp;so&nbsp;I&nbsp;would&nbsp;say,&nbsp;it&#39;s&nbsp;their&nbsp;decision&nbsp;to&nbsp;make&lt;br&gt;<br>
&lt;br&gt;<br>
 2)&nbsp;embarking&nbsp;a&nbsp;full&nbsp;build&nbsp;system&nbsp;into&nbsp;the&nbsp;source&nbsp;tree&nbsp;of&nbsp;a&nbsp;package&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; in&nbsp;general&nbsp;I&nbsp;would&nbsp;find&nbsp;this&nbsp;a&nbsp;very&nbsp;bad&nbsp;idea:&nbsp;one&nbsp;should&nbsp;have&nbsp;a&nbsp;separate&lt;br&gt;<br>
 &nbsp; &nbsp; package&nbsp;for&nbsp;the&nbsp;build&nbsp;system,&nbsp;and&nbsp;have&nbsp;it&nbsp;installed&nbsp;before&nbsp;building&nbsp;anything&nbsp;else.&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; Now,&nbsp;what&nbsp;sets&nbsp;opam&nbsp;apart&nbsp;from&nbsp;other&nbsp;OCaml&nbsp;components&nbsp;is&nbsp;the&nbsp;fact&nbsp;that&nbsp;it&nbsp;is&lt;br&gt;<br>
 &nbsp; &nbsp; the&nbsp;*basic*&nbsp;building&nbsp;block&nbsp;for&nbsp;all&nbsp;the&nbsp;other&nbsp;packages&nbsp;in&nbsp;the&nbsp;repository,&nbsp;and&lt;br&gt;<br>
 &nbsp; &nbsp; without&nbsp;a&nbsp;running&nbsp;opam,&nbsp;there&nbsp;is&nbsp;no&nbsp;way&nbsp;to&nbsp;install&nbsp;any&nbsp;other&nbsp;package;&nbsp;this&lt;br&gt;<br>
 &nbsp; &nbsp; is&nbsp;a&nbsp;bootstrap&nbsp;issue,&nbsp;and&nbsp;that&#39;s&nbsp;why,&nbsp;for&nbsp;example,&nbsp;opam&nbsp;embarks&nbsp;in&nbsp;src_ext&lt;br&gt;<br>
 &nbsp; &nbsp; the&nbsp;full&nbsp;source&nbsp;of&nbsp;the&nbsp;dose&nbsp;and&nbsp;libcudf&nbsp;libraries,&nbsp;instead&nbsp;of&nbsp;linking&nbsp;to&lt;br&gt;<br>
 &nbsp; &nbsp; the&nbsp;packages&nbsp;for&nbsp;dose&nbsp;and&nbsp;libcudf&nbsp;(that&nbsp;do&nbsp;exist&nbsp;in&nbsp;the&nbsp;repository);&nbsp;so&lt;br&gt;<br>
 &nbsp; &nbsp; in&nbsp;this&nbsp;particular&nbsp;case&nbsp;*only*&nbsp;I&nbsp;personally&nbsp;would&nbsp;not&nbsp;be&nbsp;shocked&nbsp;to&nbsp;see&lt;br&gt;<br>
 &nbsp; &nbsp; some&nbsp;extra&nbsp;stuff&nbsp;in&nbsp;the&nbsp;src_ext&nbsp;directory&nbsp;(especially&nbsp;considering&nbsp;that&lt;br&gt;<br>
 &nbsp; &nbsp; all&nbsp;this&nbsp;will&nbsp;need&nbsp;to&nbsp;work&nbsp;on&nbsp;multiple&nbsp;platforms)&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;3)&nbsp;how&nbsp;do&nbsp;we&nbsp;update&nbsp;opam?&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; Now,&nbsp;for&nbsp;another&nbsp;important&nbsp;issue,&nbsp;related&nbsp;to&nbsp;the&nbsp;special&nbsp;status&nbsp;of&nbsp;opam&lt;br&gt;<br>
 &nbsp; &nbsp; as&nbsp;*the*&nbsp;package&nbsp;manager,&nbsp;and&nbsp;how&nbsp;we&nbsp;should&nbsp;manage&nbsp;it&nbsp;(hence&nbsp;the&nbsp;title&lt;br&gt;<br>
 &nbsp; &nbsp; of&nbsp;this&nbsp;message).&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; I&nbsp;am&nbsp;a&nbsp;bit&nbsp;unhappy&nbsp;with&nbsp;the&nbsp;current&nbsp;state&nbsp;of&nbsp;affairs,&nbsp;where&nbsp;new&lt;br&gt;<br>
 &nbsp; &nbsp; versions&nbsp;of&nbsp;opam&nbsp;appear&nbsp;with&nbsp;incompatible&nbsp;changes&nbsp;in&nbsp;the&nbsp;repository&nbsp;format,&lt;br&gt;<br>
 &nbsp; &nbsp; hence&nbsp;different&nbsp;versions&nbsp;of&nbsp;the&nbsp;repositories:&nbsp;people&nbsp;using&nbsp;old&nbsp;versions&lt;br&gt;<br>
 &nbsp; &nbsp; of&nbsp;opam&nbsp;get&nbsp;lost&nbsp;in&nbsp;a&nbsp;limbo-like&nbsp;repository&nbsp;with&nbsp;non&nbsp;updated&nbsp;packages&lt;br&gt;<br>
 &nbsp; &nbsp; until&nbsp;they&nbsp;realise&nbsp;they&nbsp;need&nbsp;to&nbsp;recompile&nbsp;a&nbsp;new&nbsp;version&nbsp;of&nbsp;opam&lt;br&gt;<br>
 &nbsp; &nbsp; to&nbsp;see&nbsp;the&nbsp;light&nbsp;again.&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; We&nbsp;need&nbsp;to&nbsp;find&nbsp;a&nbsp;way&nbsp;to&nbsp;have&nbsp;opam&nbsp;become&nbsp;a&nbsp;package&nbsp;like&nbsp;the&nbsp;others&lt;br&gt;<br>
 &nbsp; &nbsp; (with&nbsp;the&nbsp;exception&nbsp;of&nbsp;the&nbsp;embarked&nbsp;code&nbsp;for&nbsp;bootstrapping&nbsp;reasons),&lt;br&gt;<br>
 &nbsp; &nbsp; and&nbsp;have&nbsp;it&nbsp;become&nbsp;part&nbsp;of&nbsp;opam-repository...&nbsp;the&nbsp;main&nbsp;difficulty&lt;br&gt;<br>
 &nbsp; &nbsp; lies&nbsp;in&nbsp;the&nbsp;fact&nbsp;that&nbsp;its&nbsp;binaries&nbsp;need&nbsp;to&nbsp;go&nbsp;in&nbsp;special&nbsp;places,&lt;br&gt;<br>
 &nbsp; &nbsp; and&nbsp;not&nbsp;in&nbsp;the&nbsp;4.00/3.12&nbsp;etc.&nbsp;dirs&nbsp;(correct&nbsp;if&nbsp;I&#39;m&nbsp;wrong)&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; Once&nbsp;this&nbsp;is&nbsp;done,&nbsp;a&nbsp;sensible&nbsp;upgrade&nbsp;path&nbsp;would&nbsp;be:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; Time&nbsp;T&nbsp;:&nbsp;I&nbsp;have&nbsp;opam&nbsp;version&nbsp;n&nbsp;installed,&nbsp;accessing&nbsp;repo&nbsp;version&nbsp;n&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; Time&nbsp;T+delta:&nbsp;some&nbsp;major&nbsp;changes&nbsp;make&nbsp;the&nbsp;old&nbsp;opam&nbsp;unable&nbsp;to&nbsp;use&nbsp;the&nbsp;new&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;repository&nbsp;format,&nbsp;and&nbsp;the&nbsp;repository&nbsp;migrates&nbsp;to&nbsp;a&nbsp;new&nbsp;place;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;a&nbsp;new&nbsp;version&nbsp;n+1&nbsp;of&nbsp;opam&nbsp;is&nbsp;released,&nbsp;embedding&nbsp;logic&nbsp;to&nbsp;access&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;the&nbsp;new&nbsp;repository;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;opam&nbsp;version&nbsp;n+1&nbsp;is&nbsp;added&nbsp;also&nbsp;to&nbsp;repo&nbsp;version&nbsp;n&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; Sometimes&nbsp;later:&nbsp;the&nbsp;user&nbsp;of&nbsp;opam&nbsp;n&nbsp;runs&nbsp;an&nbsp;update,&nbsp;sees&nbsp;that&nbsp;a&nbsp;new&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;version&nbsp;of&nbsp;opam&nbsp;is&nbsp;available,&nbsp;and&nbsp;upgrades&nbsp;it...&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;he&nbsp;now&nbsp;has&nbsp;the&nbsp;new&nbsp;opam,&nbsp;that&nbsp;updates&nbsp;the&nbsp;references&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to&nbsp;the&nbsp;new&nbsp;repository,&nbsp;and&nbsp;keeps&nbsp;following&nbsp;the&nbsp;evolution&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;of&nbsp;the&nbsp;repository,&nbsp;with&nbsp;no&nbsp;pain&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;I&nbsp;know&nbsp;that&nbsp;maybe&nbsp;at&nbsp;some&nbsp;point&nbsp;the&nbsp;repo&nbsp;format&nbsp;will&nbsp;stabilise,&nbsp;but&nbsp;this&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;simple&nbsp;process&nbsp;will&nbsp;make&nbsp;sure&nbsp;that&nbsp;the&nbsp;lambda-users&nbsp;(private&nbsp;joke:&nbsp;that&#39;s&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;equivalent&nbsp;to&nbsp;&quot;jow&nbsp;of&nbsp;the&nbsp;street&quot;&nbsp;in&nbsp;french,&nbsp;but&nbsp;also&nbsp;hints&nbsp;at&nbsp;functional&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;programmers&nbsp;:-))&nbsp;will&nbsp;not&nbsp;get&nbsp;lost,&nbsp;no&nbsp;matter&nbsp;the&nbsp;changes.&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;Any&nbsp;chances&nbsp;to&nbsp;see&nbsp;this&nbsp;happen&nbsp;soon?&nbsp;A&nbsp;starting&nbsp;point&nbsp;would&nbsp;be&nbsp;to&nbsp;summarize&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;on&nbsp;this&nbsp;list&nbsp;the&nbsp;difficulties&nbsp;that&nbsp;prevent&nbsp;opam&nbsp;from&nbsp;being&nbsp;a&nbsp;&quot;normal&quot;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;package&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
Roberto&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
opam-devel&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:opam-devel@lists.ocaml.org&quot;&gt;opam-devel@lists.ocaml.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ocaml.org/listinfo/opam-devel&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ocaml.org/listinfo/opam-devel&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
