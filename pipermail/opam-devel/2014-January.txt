From anil at recoil.org  Thu Jan  2 21:24:45 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 2 Jan 2014 21:24:45 +0000
Subject: [opam-devel] opam-doc
In-Reply-To: <236E2E6D-B157-46E9-BC5C-0E08ABB69A19@gazagnaire.org>
References: <236E2E6D-B157-46E9-BC5C-0E08ABB69A19@gazagnaire.org>
Message-ID: <D6E70DA5-ADDE-427F-A220-2424EBB15FFA@recoil.org>

I've just released opam-doc.0.9.3 into OPAM, which improves the look-and-feel
to this: http://mirage.github.io

Feedback/patches are welcome -- I've not seen much reaction to the mail below
yet from other OPAM users.  Issues are being queued up at:
https://github.com/ocamllabs/opam-doc/issues

-anil

On 19 Dec 2013, at 13:36, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:

> Hi all,
> 
> I've tried to simplify the use of Leo's opam-doc and I came up with a pretty simple workflow.
> 
> 1. install opam-doc: 
> 
> git clone git at github.com:samoht/opam-doc.git
> cd opam-doc
> opam install cow && make && make install
> 
> This will create a `doc` switch with the right compiler wrappers, and it will install opam-doc-* scripts in your current switch.
> 
> 2. build the documentation
> 
> opam doc PKG1 ... PKGn
> 
> this will install the various packages in the `doc` switch, call the various scripts to install the cmd files at the right place and generate the HTML pages and so on. Finally, it will serve the contents of ~/.opam/doc/doc on http://127.0.0.1:8000 than you can then browse locally (using python -m SimpleHTTPServer).
> 
> This is still a very preliminary work (I'd love to replace the bunch of scripts by a proper OCaml program -- to easily change host port/name for instance) but I'd gladly welcome your feedback.
> 
> Best,
> Thomas
> 
> 
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
> 


From agarwal1975 at gmail.com  Thu Jan  2 21:44:54 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Thu, 2 Jan 2014 16:44:54 -0500
Subject: [opam-devel] opam-doc
In-Reply-To: <D50276C1-2004-405C-93EF-8F0C6EFDCE33@gazagnaire.org>
References: <236E2E6D-B157-46E9-BC5C-0E08ABB69A19@gazagnaire.org>
 <D50276C1-2004-405C-93EF-8F0C6EFDCE33@gazagnaire.org>
Message-ID: <CAMu2m2LGnMNWqQRJBXTYD4bq8uh0sTq+f-Y+=RpbyEhUTcJi2g@mail.gmail.com>

On Thu, Dec 19, 2013 at 11:58 AM, Thomas Gazagnaire
<thomas at gazagnaire.org>wrote:

NB: the package is only available for system compilers (and alias of system
> compilers) with version 4.01.0.
>

Why this restriction? I deleted my system compiler.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140102/a9d518bc/attachment.html>

From anil at recoil.org  Thu Jan  2 21:46:58 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 2 Jan 2014 21:46:58 +0000
Subject: [opam-devel] [ocl-staff]  opam-doc
In-Reply-To: <CAMu2m2LGnMNWqQRJBXTYD4bq8uh0sTq+f-Y+=RpbyEhUTcJi2g@mail.gmail.com>
References: <236E2E6D-B157-46E9-BC5C-0E08ABB69A19@gazagnaire.org>
 <D50276C1-2004-405C-93EF-8F0C6EFDCE33@gazagnaire.org>
 <CAMu2m2LGnMNWqQRJBXTYD4bq8uh0sTq+f-Y+=RpbyEhUTcJi2g@mail.gmail.com>
Message-ID: <D93052C2-90E3-4610-9A6C-35BC2E2C67AF@recoil.org>

On 2 Jan 2014, at 21:44, Ashish Agarwal <agarwal1975 at gmail.com> wrote:

> On Thu, Dec 19, 2013 at 11:58 AM, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
> 
> NB: the package is only available for system compilers (and alias of system compilers) with version 4.01.0.
> 
> Why this restriction? I deleted my system compiler.

For fast clone support (other compilers cant relocate). Its only a limitation of the prototype due to how it's implemented with OPAM switches.

-anil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140102/80580925/attachment.html>

From daniel.buenzli at erratique.ch  Thu Jan  2 22:11:53 2014
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Thu, 2 Jan 2014 23:11:53 +0100
Subject: [opam-devel] [ocl-staff]  opam-doc
In-Reply-To: <D93052C2-90E3-4610-9A6C-35BC2E2C67AF@recoil.org>
References: <236E2E6D-B157-46E9-BC5C-0E08ABB69A19@gazagnaire.org>
 <D50276C1-2004-405C-93EF-8F0C6EFDCE33@gazagnaire.org>
 <CAMu2m2LGnMNWqQRJBXTYD4bq8uh0sTq+f-Y+=RpbyEhUTcJi2g@mail.gmail.com>
 <D93052C2-90E3-4610-9A6C-35BC2E2C67AF@recoil.org>
Message-ID: <7D3EB46D09C6400DBA78377F67053F76@erratique.ch>



Le jeudi, 2 janvier 2014 ? 22:46, Anil Madhavapeddy a ?crit :

> On 2 Jan 2014, at 21:44, Ashish Agarwal <agarwal1975 at gmail.com (mailto:agarwal1975 at gmail.com)> wrote:
> > Why this restriction? I deleted my system compiler.  
>  
> For fast clone support (other compilers cant relocate). Its only a limitation of the prototype due to how it's implemented with OPAM switches.

Same here no system compiler.  

Looking at here: http://mirage.github.io/cmdliner/#Cmdliner

1) It seems a lot of hyperlinks were lost (those to sections, those to types, those to values).   
    See here for reference http://erratique.ch/software/cmdliner/doc/Cmdliner.html
2) The presentation of a module before unfolding should be just the synopsis line.  
3) The synopsis line of a module should be set appart from the first paragraph of a module doc.
4) Lightweight syntax coloring in the code would be nice.
5) Sometimes the code comes directly after the paragraph without space, sometimes not.  
6) The line height is too small for the font. It looks cramped.

Best,

Daniel

From lpw25 at cam.ac.uk  Thu Jan  2 21:56:36 2014
From: lpw25 at cam.ac.uk (Leo White)
Date: Thu, 02 Jan 2014 21:56:36 +0000
Subject: [opam-devel] [ocl-staff]  opam-doc
In-Reply-To: <CAMu2m2LGnMNWqQRJBXTYD4bq8uh0sTq+f-Y+=RpbyEhUTcJi2g@mail.gmail.com>
 (Ashish Agarwal's message of "Thu, 2 Jan 2014 16:44:54 -0500")
References: <236E2E6D-B157-46E9-BC5C-0E08ABB69A19@gazagnaire.org>
 <D50276C1-2004-405C-93EF-8F0C6EFDCE33@gazagnaire.org>
 <CAMu2m2LGnMNWqQRJBXTYD4bq8uh0sTq+f-Y+=RpbyEhUTcJi2g@mail.gmail.com>
Message-ID: <86mwjekpyj.fsf@cam.ac.uk>

I think that if you create a new root (opam init --root=some_dir) then
the "system" compiler will in fact be the compiler installed on your
normal opam root. So then 

    opam install opam-doc --root=some_dir
    opam doc foo --root=some_dir

should create the documentation for the `foo` package.

Regards,

Leo

Ashish Agarwal <agarwal1975 at gmail.com> writes:

> On Thu, Dec 19, 2013 at 11:58 AM, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
>
>     NB: the package is only available for system compilers (and alias of system compilers) with version 4.01.0.
>
> Why this restriction? I deleted my system compiler.

From sheets at alum.mit.edu  Mon Jan  6 10:13:30 2014
From: sheets at alum.mit.edu (David Sheets)
Date: Mon, 6 Jan 2014 10:13:30 +0000
Subject: [opam-devel] Some Rendering Improvements
Message-ID: <CAAWM5TzBE-EQXLf3f=qKMEENbupbEuywDmYmK-ucd+q4ewUzxg@mail.gmail.com>

I've made some improvements to rendering constraint formulae and
calculating reverse dependency constraints. The new rendering takes a
little more space (except for the duplication that has been removed)
but is, imnsho, far easier to read and navigate.

I'm interested in your feedback on this development. You'll need the
master branch of opam-lib and opamfu and my opamfu branch of opam2web.
You can find the relevant PR at
<https://github.com/ocaml/opam2web/pull/81>.

Thanks,

David

From gesbert at antislash.info  Mon Jan  6 13:29:33 2014
From: gesbert at antislash.info (Louis Gesbert)
Date: Mon, 06 Jan 2014 14:29:33 +0100
Subject: [opam-devel] Some Rendering Improvements
In-Reply-To: <CAAWM5TzBE-EQXLf3f=qKMEENbupbEuywDmYmK-ucd+q4ewUzxg@mail.gmail.com>
References: <CAAWM5TzBE-EQXLf3f=qKMEENbupbEuywDmYmK-ucd+q4ewUzxg@mail.gmail.com>
Message-ID: <1979096.C9F6CkJg71@agaric>

Very nice ! I love the new display :)
I am not concerned about the additional space ; my only remark is that the meaning may not be completely obvious for everyone at first sight, given that people may not expect logic formulas at that spot (esp. when you see only a single /\). Wouldn't just 'and' and 'or' be suitable ?

Cheers,
Louis

Le lundi 6 janvier 2014, 10:13:30 David Sheets a ?crit :
> I've made some improvements to rendering constraint formulae and
> calculating reverse dependency constraints. The new rendering takes a
> little more space (except for the duplication that has been removed)
> but is, imnsho, far easier to read and navigate.
> 
> I'm interested in your feedback on this development. You'll need the
> master branch of opam-lib and opamfu and my opamfu branch of opam2web.
> You can find the relevant PR at
> <https://github.com/ocaml/opam2web/pull/81>.
> 
> Thanks,
> 
> David
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140106/821a2e96/attachment.html>

From kosmo.zb at gmail.com  Mon Jan  6 13:45:02 2014
From: kosmo.zb at gmail.com (David Sheets)
Date: Mon, 6 Jan 2014 13:45:02 +0000
Subject: [opam-devel] Some Rendering Improvements
In-Reply-To: <1979096.C9F6CkJg71@agaric>
References: <CAAWM5TzBE-EQXLf3f=qKMEENbupbEuywDmYmK-ucd+q4ewUzxg@mail.gmail.com>
 <1979096.C9F6CkJg71@agaric>
Message-ID: <CAAWM5TxJq_4pzRqAgQtaxiU7aDFmkV_j5H1KwsXKyFihthPQNw@mail.gmail.com>

On Mon, Jan 6, 2014 at 1:29 PM, Louis Gesbert <gesbert at antislash.info> wrote:
> Very nice ! I love the new display :)
>
> I am not concerned about the additional space ; my only remark is that the
> meaning may not be completely obvious for everyone at first sight, given
> that people may not expect logic formulas at that spot (esp. when you see
> only a single /\). Wouldn't just 'and' and 'or' be suitable ?

Perhaps, yes. I chose those symbols to match the use of the
inequalities. We could render the closed set symbols in unicode, as
well (?, ?).

My only issue with changing to 'and' and 'or' is that they are wider
than '?' and '?'. I think it is a 2-line edit to change this.

David

>
> Cheers,
>
> Louis
>
>
>
> Le lundi 6 janvier 2014, 10:13:30 David Sheets a ?crit :
>
>> I've made some improvements to rendering constraint formulae and
>
>> calculating reverse dependency constraints. The new rendering takes a
>
>> little more space (except for the duplication that has been removed)
>
>> but is, imnsho, far easier to read and navigate.
>
>>
>
>> I'm interested in your feedback on this development. You'll need the
>
>> master branch of opam-lib and opamfu and my opamfu branch of opam2web.
>
>> You can find the relevant PR at
>
>> <https://github.com/ocaml/opam2web/pull/81>.
>
>>
>
>> Thanks,
>
>>
>
>> David
>
>> _______________________________________________
>
>> opam-devel mailing list
>
>> opam-devel at lists.ocaml.org
>
>> http://lists.ocaml.org/listinfo/opam-devel
>
>

From anil at recoil.org  Thu Jan  9 23:36:49 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 9 Jan 2014 23:36:49 +0000
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <1398884.DsPVFKPgNf@agaric>
References: <1398884.DsPVFKPgNf@agaric>
Message-ID: <20140109233649.GA2106@dark.recoil.org>

On Thu, Jan 09, 2014 at 07:43:05PM +0100, Louis Gesbert wrote:
> Happy new year everyone !
> 
> I am putting everything together to release 1.1.1 in the next few days,
> which should unlock the release of opam-doc and help package
> opam-in-a-box. I am getting through the last few issues tagged for
> 1.1.1, postponing what is not either trivial or urgent.
> 
> 1.1.1 features mostly bug-fixes and UI/doc improvements, but also
> focuses on improving the API and tools to be a better base for the
> platform (functions for opam-doc, interface with tools like opamfu and
> opam-installer). Once this is released, there will be more room to
> (progressively) merge the stash of deeper changes that I have been
> working on in the meantime.
> 
> Please discuss any requests or blockers for 1.1.1 !  The biggest current
> issue is probably the upgrade problems with the built-in heuristic, but
> there isn't much we can do before the release, and the real solution is
> to have aspcud packaged and working on OSX.

Thanks Louis!  The solver issue is my last remaining big concern as well
before getting 1.1.1 out of the door.  It would be very useful to
characterise the reason for the failure to see if a quick workaround is
possible, since so many users are hitting it.  If it's just due to the
growing number of packages, perhaps we can add some more constraints to
the package descriptions help the solver find a solution more easily?

Aside from that, the only other problem I can think of that confused users
was the inconsistent 'packages added or removed' display after an opam
update.  Was that fixed?  I couldn't find the live issue.

When you have an RC let me know, and I'll run it through it's paces on the
various BSDs to make sure that there haven't been any regressions due to
the `which` vs `type` changes.

-anil

From roberto at dicosmo.org  Fri Jan 10 07:34:23 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Fri, 10 Jan 2014 08:34:23 +0100
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <20140109233649.GA2106@dark.recoil.org>
References: <1398884.DsPVFKPgNf@agaric> <20140109233649.GA2106@dark.recoil.org>
Message-ID: <20140110073423.GA14450@voyager>

On Thu, Jan 09, 2014 at 11:36:49PM +0000, Anil Madhavapeddy wrote:
> > Please discuss any requests or blockers for 1.1.1 !  The biggest current
> > issue is probably the upgrade problems with the built-in heuristic, but
> > there isn't much we can do before the release, and the real solution is
> > to have aspcud packaged and working on OSX.
> 
> Thanks Louis!  The solver issue is my last remaining big concern as well
> before getting 1.1.1 out of the door.  It would be very useful to
> characterise the reason for the failure to see if a quick workaround is
> possible, since so many users are hitting it.  If it's just due to the
> growing number of packages, perhaps we can add some more constraints to
> the package descriptions help the solver find a solution more easily?
> 

Thanks Louis for all this work!

As for the solver, unfortunately it is not a simple piece of code that can be
"fixed" with "workarounds", that's why we have been strongly advocating to use a
modular architecture for package managers, with interchangeable solvers clearly
separated from the rest, see for example
http://dx.doi.org/10.1016/j.infsof.2012.09.002

The only sensible thing to do is to actually package aspcud (and possibly
also packup and mccs) for Mac OSX and Windows, which is a reasonably simple
engineering task; I have contacted the developer team of aspcud to encourage
them to do this, and I do have hope to see this done in the year, but I have
no guarantee.

Considering the time frame, and the fact that this kind of issues is
going to come up more and more over time, I do understand that we need
a quicker solution, and the best thing is to ask for help with this 
among our friends OCamlrs...

I'll write a detailed mail on the list to this end this afternoon (now,
as alway, meeting... meeting... meeting :-( )

-- 
Roberto
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 3020 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        

From anil at recoil.org  Fri Jan 10 09:59:24 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 10 Jan 2014 09:59:24 +0000
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <20140110073423.GA14450@voyager>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <20140110073423.GA14450@voyager>
Message-ID: <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>

On 10 Jan 2014, at 07:34, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

> Considering the time frame, and the fact that this kind of issues is
> going to come up more and more over time, I do understand that we need
> a quicker solution, and the best thing is to ask for help with this 
> among our friends OCamlrs...

If someone could point me to what to port, I'd be happy to take a look
at OpenBSD and Homebrew ports. I'm CCing Vsevolod who has been interested
in a FreeBSD port of aspcud for their new package managers.

What are the differences between the 'paranoid', 'basic' and 'full' user
tracks on their website, and does it affect OPAM?

-anil

From louis.gesbert at ocamlpro.com  Fri Jan 10 13:46:25 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 10 Jan 2014 14:46:25 +0100
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <20140109233649.GA2106@dark.recoil.org>
References: <1398884.DsPVFKPgNf@agaric> <20140109233649.GA2106@dark.recoil.org>
Message-ID: <3311556.qEzEnXgqjl@ocp-dell>

> Aside from that, the only other problem I can think of that confused users
> was the inconsistent 'packages added or removed' display after an opam
> update.  Was that fixed?  I couldn't find the live issue.

No, not fixed yet. I had shifted it to 1.2 already but will have a second look.

> When you have an RC let me know, and I'll run it through it's paces on the
> various BSDs to make sure that there haven't been any regressions due to
> the `which` vs `type` changes.

Ok, will do, thanks a lot !

Louis


From anil at recoil.org  Fri Jan 10 16:26:24 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 10 Jan 2014 16:26:24 +0000
Subject: [opam-devel] Travis backlog is cleared
Message-ID: <6099C28D-2420-4802-992C-4070B17CD7CD@recoil.org>

I've tested and merged the 12 pull requests that were outstanding, so we're all normal with the pull request tests again.  Please do run Travis script patches by me first so I can check over them, as clearing the backlog took about 2 hours of lots of merging...

-anil

From vs374 at cam.ac.uk  Fri Jan 10 16:39:51 2014
From: vs374 at cam.ac.uk (Vsevolod Stakhov)
Date: Fri, 10 Jan 2014 16:39:51 +0000
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <20140110073423.GA14450@voyager>
 <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>
Message-ID: <52D02257.5020007@cam.ac.uk>

JFYI, I have ported aspcud to FreeBSD today (together with gringo and
clasp). It seems to be working with some test cudf files.

The most tricky patch was to enable support of the libc++ from LLVM, but
I hopefully have managed it.

On 10/01/14 09:59, Anil Madhavapeddy wrote:
> On 10 Jan 2014, at 07:34, Roberto Di Cosmo <roberto at dicosmo.org> wrote:
> 
>> Considering the time frame, and the fact that this kind of issues is
>> going to come up more and more over time, I do understand that we need
>> a quicker solution, and the best thing is to ask for help with this 
>> among our friends OCamlrs...
> 
> If someone could point me to what to port, I'd be happy to take a look
> at OpenBSD and Homebrew ports. I'm CCing Vsevolod who has been interested
> in a FreeBSD port of aspcud for their new package managers.
> 
> What are the differences between the 'paranoid', 'basic' and 'full' user
> tracks on their website, and does it affect OPAM?
> 
> -anil
> 

-- 
Vsevolod Stakhov

From roberto at dicosmo.org  Fri Jan 10 17:44:08 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Fri, 10 Jan 2014 18:44:08 +0100
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <52D02257.5020007@cam.ac.uk>
References: <1398884.DsPVFKPgNf@agaric> <20140109233649.GA2106@dark.recoil.org>
 <20140110073423.GA14450@voyager>
 <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>
 <52D02257.5020007@cam.ac.uk>
Message-ID: <20140110174408.GA21382@voyager>

Hi Vsevolod,
   that's great news, a big thank you!!!

I have just sent out a request for help packaging
aspcud, mccs and packup, and now found out that you
almost finished aspcud already :-)

A couple of suggestions :

 - add a comment on https://github.com/ocaml/opam/issues/1074
   mentioning your work on FreeBSD

 - check the patch added by Ralf in the latest version of the
   Debian aspcud package to ensure backwards compatibility of
   the optimization criteria supported by the latest aspcud
   with the legacy criteria supported by the other solvers...
   this basically boils down to adding a few lines to the 
   aspcud bash shell to use a short sed file and convert the
   old criteria in the new language supported by the latest
   aspcud... you'll find attached the modified aspcud and the
   sed file from the Debian package

 - once this is done, you can try to run opam and check whether
   all works fine... it looks for aspcud using "which aspcud"

All the best

--
Roberto
   

On Fri, Jan 10, 2014 at 04:39:51PM +0000, Vsevolod Stakhov wrote:
> JFYI, I have ported aspcud to FreeBSD today (together with gringo and
> clasp). It seems to be working with some test cudf files.
> 
> The most tricky patch was to enable support of the libc++ from LLVM, but
> I hopefully have managed it.
> 
> On 10/01/14 09:59, Anil Madhavapeddy wrote:
> > On 10 Jan 2014, at 07:34, Roberto Di Cosmo <roberto at dicosmo.org> wrote:
> > 
> >> Considering the time frame, and the fact that this kind of issues is
> >> going to come up more and more over time, I do understand that we need
> >> a quicker solution, and the best thing is to ask for help with this 
> >> among our friends OCamlrs...
> > 
> > If someone could point me to what to port, I'd be happy to take a look
> > at OpenBSD and Homebrew ports. I'm CCing Vsevolod who has been interested
> > in a FreeBSD port of aspcud for their new package managers.
> > 
> > What are the differences between the 'paranoid', 'basic' and 'full' user
> > tracks on their website, and does it affect OPAM?
> > 
> > -anil
> > 
> 
> -- 
> Vsevolod Stakhov

-- 
Roberto Di Cosmo
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 3020 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        
-------------- next part --------------
# new -> count(new)
# removed -> count(removed)
# changed -> count(changed)
# notuptodate -> notuptodate(solution)
# unsat_recommends -> unsat_recommends(solution)
# sum(name) -> sum(name,solution)

s/\([+-]\)\(new\|removed\|changed\)/\1count(\2)/g
s/\([+-]\)\(notuptodate\|unsat_recommends\)\([^(]\|$\)/\1\2(solution)\3/g
s/\([+-]\)sum(\([a-z]*\))/\1sum(\2,solution)/g
-------------- next part --------------
#!/bin/bash

clasp_bin=clasp
unclasp_bin=unclasp
gringo_bin=gringo
cudf2lp_bin=/usr/lib/aspcud/bin/cudf2lp
sharedir=/usr/share/aspcud

trendycriterion="-count(removed),-notuptodate(solution),-unsat_recommends(solution),-count(new)"

if [[ $3 == trendy ]]; then
    criterion=$trendycriterion;
else
    criterion=`sed -f /usr/share/aspcud/misc11-to-misc12 <<< $3`
fi

function enc()
{
	for x in "." "$sharedir/encodings"; do
		[[ -e "$x/$1" ]] && { echo "$x/$1"; return 0; }
	done
	echo "$x"
	return 1
}

function cleanup()
{
	[[ -d "$tmp" ]] && rm -rf "$tmp"
}

function die()
{
	echo "error: $1" >&2
	exit 0
}

function usage()
{
	echo "Usage: ${0} [OPTION]... CUDFIN CUDFOUT [CRITERIA]"
	echo "  -h       print this help"
	echo "  -c OPT   append clasp option OPT"
	echo "  -e ENC   append encoding ENC"
	echo "  -p OPT   append cudf2lp option OPT"
	echo "  -s SOL   choose solver {clasp,unclasp}"
	echo
	echo "Default commandline for clasp:"
	echo -n "$(basename "${0}")"
	for x in "${clasp_opts_def[@]}";  do
		echo " \\"
		echo -n "    -c $x"
	done
	for x in "${gringo_opts_def[@]}";  do
		echo " \\"
		echo -n "    -e $x"
	done
	echo
	echo
	echo "Default commandline for unclasp:"
	echo -n "$(basename "${0}")"
	for x in "${unclasp_opts_def[@]}";  do
		echo " \\"
		echo -n "    -c $x"
	done
	for x in "${ungringo_opts_def[@]}";  do
		echo " \\"
		echo -n "    -e $x"
	done
	echo
}

base="$(dirname "$(readlink -f "$0")")"
PATH=".:$base:$base/../build/release/bin:$PATH"

# default options
solver=""
clasp_opts_def=( "--opt-heu=1" "--sat-prepro" "--restarts=L,128" "--heuristic=VSIDS" "--opt-hierarch=1" "--local-restarts" "--del-max=200000,250" )
unclasp_opts_def=( )
gringo_opts_def=( "$(enc misc2012.lp)" )
ungringo_opts_def=( "$(enc misc2012.lp)" )

cudf_opts=( )
clasp_opts=( )
gringo_opts=( )

unset wrapper_out
unset tmp

while getopts "hc:e:p:s:" flag
do
	case "$flag" in
		"e") gringo_opts=( "${gringo_opts[@]}" "$(enc "$OPTARG")" ) ;;
		"c") clasp_opts=( "${clasp_opts[@]}" "$OPTARG" ) ;;
		"p") cudf_opts=( "${cudf_opts[@]}" "$OPTARG" ) ;;
		"s") solver="$OPTARG" ;;
		"h") usage; exit 0 ;;
		"?") exit 1 ;;
	esac
done

shift $((OPTIND-1))

if [[ -z ${solver} ]]; then
	if echo $(basename "$0") | grep -q "aspuncud"; then
		solver="unclasp"
	elif echo $(basename "$0") | grep -q "aspcud"; then
		solver="clasp"
	fi
fi

case "${solver}" in 
	clasp)
		solver_bin="${clasp_bin}"
		clasp_opts_implicit=( "--stats=2" "--quiet=1,2" )
		;;
	unclasp)
		clasp_opts_def=( "${unclasp_opts_def[@]}" )
		gringo_opts_def=( "${ungringo_opts_def[@]}" )
		solver_bin="${unclasp_bin}"
		clasp_opts_implicit=( "--stats" )
		;;
	*)
		die "error: solver clasp or unclasp expected"
		;;
esac

[[ ${#clasp_opts[*]} -eq 0 ]] && clasp_opts=( "${clasp_opts_def[@]}" )
[[ ${#gringo_opts[*]} -eq 0 ]] && gringo_opts=( "${gringo_opts_def[@]}" )
clasp_opts=( "${clasp_opts[@]}" "${clasp_opts_implicit[@]}" )

if [[ $# -eq 3 ]]; then
	cudf_opts=( "${cudf_opts[@]}" "-c" "$criterion" )
elif echo $(basename "$0") | grep -q "paranoid"; then
	[[ $# -ne 2 ]] && { die "error: exactly two arguments expected"; }
	cudf_opts=( "${cudf_opts[@]}" "-c" "paranoid" )
else
	die "error: exactly three arguments expected"
fi

wrapper_out="$2"

trap cleanup EXIT

test -n "${TMPDIR}" && tmpdir="${TMPDIR}/"
tmp="$(mktemp -d "${tmpdir}outXXXXXX")"

# note this is probably unecessary...
function usrtrap() {
:
}
trap usrtrap USR1 TERM INT

cat <<EOF > "$tmp/parse.py"
#!/usr/bin/python
import signal, re, sys

def ignore(x, y): pass

signal.signal(signal.SIGUSR1, ignore)
signal.signal(signal.SIGTERM, ignore)
signal.signal(signal.SIGINT,  ignore)
signal.signal(signal.SIGPIPE, ignore)

out = open("$wrapper_out", "w")

keep = False
solution = None
try:
	for line in sys.stdin:
		sys.stdout.write(line[:-1][:81])
		sys.stdout.write("\n")
		if keep: 
			solution = line
			keep = False
		if line.startswith("Answer"): keep = True
except: pass

if solution == None: out.write("FAIL\n")
else:
        for m in re.finditer(r'in\\("(?P<pkg>[^,]+)",(?P<ver>[^)]+)\\)', solution):
                out.write("package: " + m.group("pkg") + "\\n")
                out.write("version: " + m.group("ver") + "\\n")
                out.write("installed: true\\n\\n")
out.close()

sys.stdout.write(open("$tmp/clasp_err").read())
sys.stdout.write(open("$tmp/gringo_err").read())
sys.stdout.write(open("$tmp/cudf_err").read())
EOF
chmod +x "$tmp/parse.py"

"${cudf2lp_bin}" "${cudf_opts[@]}"   > "$tmp/cudf_out"   2> "$tmp/cudf_err"   < "$1"
"${gringo_bin}"  "${gringo_opts[@]}" > "$tmp/gringo_out" 2> "$tmp/gringo_err" "$tmp/cudf_out"
"${solver_bin}"  "${clasp_opts[@]}"                      2> "$tmp/clasp_err"  "$tmp/gringo_out" | "$tmp/parse.py"


From anil at recoil.org  Sat Jan 11 22:59:46 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sat, 11 Jan 2014 22:59:46 +0000
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <20140110174408.GA21382@voyager>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <20140110073423.GA14450@voyager>
 <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>
 <52D02257.5020007@cam.ac.uk> <20140110174408.GA21382@voyager>
Message-ID: <30229C43-8EDB-44C2-883F-B279DE3BC4BF@recoil.org>

[dropping platform@ from CC]

On 10 Jan 2014, at 17:44, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

> - check the patch added by Ralf in the latest version of the
>   Debian aspcud package to ensure backwards compatibility of
>   the optimization criteria supported by the latest aspcud
>   with the legacy criteria supported by the other solvers...
>   this basically boils down to adding a few lines to the 
>   aspcud bash shell to use a short sed file and convert the
>   old criteria in the new language supported by the latest
>   aspcud... you'll find attached the modified aspcud and the
>   sed file from the Debian package

This makes maintaining the port on other platforms really tough,
since we have to keep looking at both upstream and the Debian
packages.  Are these patches not suitable to be fed upstream into
one patched tarball that could be installed by the various package
managers?

-anil

From anil at recoil.org  Sat Jan 11 23:00:40 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sat, 11 Jan 2014 23:00:40 +0000
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <52D02257.5020007@cam.ac.uk>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <20140110073423.GA14450@voyager>
 <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>
 <52D02257.5020007@cam.ac.uk>
Message-ID: <7C22AD00-2AEE-41B0-A037-76DA73D06093@recoil.org>

Looks good! Minor fix: you missed a dependency on devel/re2c in the
aspcud Makefile.

-anil

On 10 Jan 2014, at 16:39, Vsevolod Stakhov <vs374 at cam.ac.uk> wrote:

> JFYI, I have ported aspcud to FreeBSD today (together with gringo and
> clasp). It seems to be working with some test cudf files.
> 
> The most tricky patch was to enable support of the libc++ from LLVM, but
> I hopefully have managed it.
> 
> On 10/01/14 09:59, Anil Madhavapeddy wrote:
>> On 10 Jan 2014, at 07:34, Roberto Di Cosmo <roberto at dicosmo.org> wrote:
>> 
>>> Considering the time frame, and the fact that this kind of issues is
>>> going to come up more and more over time, I do understand that we need
>>> a quicker solution, and the best thing is to ask for help with this 
>>> among our friends OCamlrs...
>> 
>> If someone could point me to what to port, I'd be happy to take a look
>> at OpenBSD and Homebrew ports. I'm CCing Vsevolod who has been interested
>> in a FreeBSD port of aspcud for their new package managers.
>> 
>> What are the differences between the 'paranoid', 'basic' and 'full' user
>> tracks on their website, and does it affect OPAM?
>> 
>> -anil
>> 
> 
> -- 
> Vsevolod Stakhov


From vs374 at cam.ac.uk  Sat Jan 11 23:12:12 2014
From: vs374 at cam.ac.uk (Vsevolod Stakhov)
Date: Sat, 11 Jan 2014 23:12:12 +0000
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <7C22AD00-2AEE-41B0-A037-76DA73D06093@recoil.org>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <20140110073423.GA14450@voyager>
 <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>
 <52D02257.5020007@cam.ac.uk>
 <7C22AD00-2AEE-41B0-A037-76DA73D06093@recoil.org>
Message-ID: <52D1CFCC.9090706@cam.ac.uk>

Thanks for mention this! I have an implicit dependency on re2c via 
math/gringo dependency. But it won't work in case of binary packages for 
sure, as this a build dependency. I've fixed this issue, thanks!

On 11.01.2014 23:00, Anil Madhavapeddy wrote:
> Looks good! Minor fix: you missed a dependency on devel/re2c in the
> aspcud Makefile.
>
> -anil
>
> On 10 Jan 2014, at 16:39, Vsevolod Stakhov <vs374 at cam.ac.uk> wrote:
>
>> JFYI, I have ported aspcud to FreeBSD today (together with gringo and
>> clasp). It seems to be working with some test cudf files.
>>
>> The most tricky patch was to enable support of the libc++ from LLVM, but
>> I hopefully have managed it.
>>
>> On 10/01/14 09:59, Anil Madhavapeddy wrote:
>>> On 10 Jan 2014, at 07:34, Roberto Di Cosmo <roberto at dicosmo.org> wrote:
>>>
>>>> Considering the time frame, and the fact that this kind of issues is
>>>> going to come up more and more over time, I do understand that we need
>>>> a quicker solution, and the best thing is to ask for help with this
>>>> among our friends OCamlrs...
>>>
>>> If someone could point me to what to port, I'd be happy to take a look
>>> at OpenBSD and Homebrew ports. I'm CCing Vsevolod who has been interested
>>> in a FreeBSD port of aspcud for their new package managers.
>>>
>>> What are the differences between the 'paranoid', 'basic' and 'full' user
>>> tracks on their website, and does it affect OPAM?
>>>
>>> -anil
>>>
>>
>> --
>> Vsevolod Stakhov
>


-- 
Vsevolod Stakhov

From vs374 at cam.ac.uk  Sat Jan 11 23:15:31 2014
From: vs374 at cam.ac.uk (Vsevolod Stakhov)
Date: Sat, 11 Jan 2014 23:15:31 +0000
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <30229C43-8EDB-44C2-883F-B279DE3BC4BF@recoil.org>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <20140110073423.GA14450@voyager>
 <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>
 <52D02257.5020007@cam.ac.uk> <20140110174408.GA21382@voyager>
 <30229C43-8EDB-44C2-883F-B279DE3BC4BF@recoil.org>
Message-ID: <52D1D093.4090307@cam.ac.uk>

On 11.01.2014 22:59, Anil Madhavapeddy wrote:
> [dropping platform@ from CC]
>
> On 10 Jan 2014, at 17:44, Roberto Di Cosmo <roberto at dicosmo.org> wrote:
>
>> - check the patch added by Ralf in the latest version of the
>>    Debian aspcud package to ensure backwards compatibility of
>>    the optimization criteria supported by the latest aspcud
>>    with the legacy criteria supported by the other solvers...
>>    this basically boils down to adding a few lines to the
>>    aspcud bash shell to use a short sed file and convert the
>>    old criteria in the new language supported by the latest
>>    aspcud... you'll find attached the modified aspcud and the
>>    sed file from the Debian package
>
> This makes maintaining the port on other platforms really tough,
> since we have to keep looking at both upstream and the Debian
> packages.  Are these patches not suitable to be fed upstream into
> one patched tarball that could be installed by the various package
> managers?

I agree, as both debian packages and FreeBSD ports are aimed to have OS 
specific patches only in the tree. In a very special cases when upstream 
authors are unresponsive to critical bugs it is worth to enforce generic 
patches to be included, however, it seems that aspcud authors are rather 
active and it is worth to ask them first. Actually, my libc++ specific 
patch is from the same source: aspcud uses non-standard conventions of 
libstdc++ which is definitely not a good decision (for example, OS X 
uses clang as well).

-- 
Vsevolod Stakhov

From anil at recoil.org  Sun Jan 12 00:39:23 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 12 Jan 2014 00:39:23 +0000
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <20140110174408.GA21382@voyager>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <20140110073423.GA14450@voyager>
 <2C983FFF-6E1E-489C-BFDD-1689B20B3B4E@recoil.org>
 <52D02257.5020007@cam.ac.uk> <20140110174408.GA21382@voyager>
Message-ID: <5B0C6757-D209-46BC-8510-294D3FC351AD@recoil.org>

On 10 Jan 2014, at 17:44, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

> - check the patch added by Ralf in the latest version of the
>   Debian aspcud package to ensure backwards compatibility of
>   the optimization criteria supported by the latest aspcud
>   with the legacy criteria supported by the other solvers...
>   this basically boils down to adding a few lines to the 
>   aspcud bash shell to use a short sed file and convert the
>   old criteria in the new language supported by the latest
>   aspcud... you'll find attached the modified aspcud and the
>   sed file from the Debian package

There are several importabilities that are blocking a port to
MacOS X in the various shell scripts (noted on the GitHub
issue).  I've put my candidate MacOS X port up at:

https://github.com/avsm/homebrew/pull/1

However, it still fails due to lacking some of the patches
from the Debian package, and I'd appreciate concrete pointers
to where these files are.  Looking in the Debian binary package
that Roberto pointed to, I find several different patches in
the wheezy and jessie repositories, and the jessie version
has layered ones (for 'trendy' and an external sed script).
Which one are we supposed to be using?

I'd appreciate a unified diff against upstream so that I can
patch the other incompatibilities against a known good base...

-anil

From nicolas at braud-santoni.eu  Mon Jan 13 13:07:23 2014
From: nicolas at braud-santoni.eu (Nicolas Braud-Santoni)
Date: Mon, 13 Jan 2014 14:07:23 +0100
Subject: [opam-devel] OPAM + Docker
In-Reply-To: <CAOCAUGN0sf+e0tWrM-FF1g=trWkbmtuHpA3Dk1Yi+JDckBEj9w@mail.gmail.com>
References: <021DF61F-F680-4EF4-A64D-71823F6AB766@recoil.org>	<20131119120304.3dbc3d83@kiwi.local.tld>	<528B2B74.7060704@braud-santoni.eu>	<CAOCAUGOEr4B=dYrVr2-010546bBGZJ_BwZCy3Phc7Qr1WeVAUg@mail.gmail.com>
 <CAOCAUGN0sf+e0tWrM-FF1g=trWkbmtuHpA3Dk1Yi+JDckBEj9w@mail.gmail.com>
Message-ID: <52D3E50B.2090501@braud-santoni.eu>

First, sorry for the delay; it seems I accidentally saved this mail to
?Drafts? instead of sending it.

On 19/11/2013 11:20, Sylvain Le Gall wrote:
> Hey, just think about an even more "reliable" way to do all that: make
> it fails ! ;-)
> [...]
> On the first try it will not be very efficient, but you can send the
> result for ObscureOS Y to opam and register it for other ObscureOS Y
> users.

By ?register it for other ObscureOS Y users?, do you mean that the user
for whom the package failed should submit a patch adding the correct
depext ?
If so, the ?only? work required would be to present the relevant parts
of the build log to the user, right ?

> 2013/11/19 Sylvain Le Gall <sylvain+ocaml at le-gall.net>:
>> 2013/11/19 Nicolas Braud-Santoni <nicolas at braud-santoni.eu>:
>>> This seems to be the most sane and generic option if we wish to interact
>>> with the system's package manager [0].
>>
>> The problem is that each time you want to extend to a new OS
>> distribution, you may need to do a lot of work. Not to mention that
>> this work will probably need to be done when upgrading as well,
>> although it may be less expensive. On the long term you may need to
>> dedicate a fair amount of time dealing with updating the depext. But
>> that is my rough estimate, and I do prefer to see people try it than
>> not do anything about that (but we should be open and consider
>> dropping this if it turns to be a not that sustainable solution).

I disagree w.r.t. the work required.
Over the 100 packages currently (2014/01/13) in the default OPAM repository:
- 25 are conf-* packages;
- 1 is liquidsoap;
- the others are bindings (I might have misclassified some).

While it is true that I noticed, during this cursory examination, little
opportunity to further factor depexts using conf- packages, I suspect
that these packages will not grow very quickly in number, and will have
stable depexts[0], making this mainly a one-time effort.

[0] By this, I mean ?stable associated package names?; one doesn't need
distro-specific knowledge to change the version number, as far as I can see.

>>> Moreover, it seems unwise to fill in information that ought to belong in
>>> the distribution's packages :
>> [...]
>>
>> Most of the package manager allow you to do file lookup: e.g. "dpkg
>> -S" on Debian, example:
>> [...]
>> You don't even have to do crazy comlpex thing here (a simple grep in
>> the source will already provide you good insight). Although, you may
>> replace dpkg by apt-file, because dpkg only rely on files installed.

It seems we had different objectives regarding depexts:
- you wish to check, before installing a package, whether a dependency
is satisfied;
- I wish to be able to use this dependency information to install
missing dependencies [1].

This makes a difference because not all package management systems offer
an index to match files to not-yet-installed packages.

[1] I have been working on giving Paludis (the package manager used in
Exherbo (and useable in Gentoo)) the ability to read OPAM's repository
format. (Unfortunately, I've been slowed down by some data-loss)

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: OpenPGP digital signature
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140113/cec5684d/attachment.sig>

From louis.gesbert at ocamlpro.com  Tue Jan 14 09:34:39 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 14 Jan 2014 10:34:39 +0100
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <3311556.qEzEnXgqjl@ocp-dell>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <3311556.qEzEnXgqjl@ocp-dell>
Message-ID: <1854196.ShU3pOPAaF@agaric>

I am going to test and do a few last fixes, and should have a RC available today.

Unless they are needed for 1.1.1, I am going to add a bunch of variables just after the release (`system-version`, `build-dir`, `opt-available`, and all those in https://github.com/ocaml/opam/pull/967).

No easy fix yet, but I'll try to improve the reports on what's NEW or UPDATED today (#1030); as for the solver/heuristic issue (#985), the (source) release can be independent from the port of aspcud so I don't think it is a blocker.

Cheers,
Louis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140114/57a2e4ad/attachment.html>

From anil at recoil.org  Tue Jan 14 10:54:55 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 14 Jan 2014 10:54:55 +0000
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <1854196.ShU3pOPAaF@agaric>
References: <1398884.DsPVFKPgNf@agaric>
 <20140109233649.GA2106@dark.recoil.org> <3311556.qEzEnXgqjl@ocp-dell>
 <1854196.ShU3pOPAaF@agaric>
Message-ID: <2D08CF53-03EB-4460-8AE6-9E776C50B620@recoil.org>

Sounds good - could you also merge trunk with the 1.1 branch for the RC and tag it from there instead of trunk?

-anil

On 14 Jan 2014, at 09:34, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> I am going to test and do a few last fixes, and should have a RC available today.
>  
> Unless they are needed for 1.1.1, I am going to add a bunch of variables just after the release (`system-version`, `build-dir`, `opt-available`, and all those in https://github.com/ocaml/opam/pull/967).
>  
> No easy fix yet, but I'll try to improve the reports on what's NEW or UPDATED today (#1030); as for the solver/heuristic issue (#985), the (source) release can be independent from the port of aspcud so I don't think it is a blocker.
>  
> Cheers,
> Louis
> _______________________________________________
> Platform mailing list
> Platform at lists.ocaml.org
> http://lists.ocaml.org/listinfo/platform

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140114/89b1d1e9/attachment.html>

From louis.gesbert at ocamlpro.com  Tue Jan 14 17:11:11 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 14 Jan 2014 18:11:11 +0100
Subject: [opam-devel] OPAM 1.1.1 RC
Message-ID: <7642023.CBU7nb4V1q@agaric>

The first RC for OPAM 1.1.1 has just been tagged. Everyone is welcome to try it out and report any last-minute problems !

Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.

Cheers !
Louis


>From the changelog:
* Fix `opam-admin make <packages> -r` (#990)
* Explicitly prettyprint list of lists, to fix `opam-admin depexts` (#997)
* Tell the user which fields is invalid in a configuration file (#1016)
* Add `OpamSolver.empty_universe` for flexible universe instantiation (#1033)
* Add `OpamFormula.eval_relop` and `OpamFormula.check_relop` (#1042)
* Change `OpamCompiler.compare` to match `Pervasives.compare` (#1042)
* Add `OpamCompiler.eval_relop` (#1042)
* Add `OpamPackage.Name.compare` (#1046)
* Add types `version_constraint` and `version_formula` to `OpamFormula` (#1046)
* Clearer command aliases. Made `info` an alias for `show` and added the alias `uninstall` (#944)
* Fixed `opam init --root=<relative path>` (#1047)
* Display OS constraints in `opam info` (#1052)
* Add a new 'opam-installer' script to make `.install` files usable outside of opam (#1026)
* Add a `--resolve` option to `opam-admin make` that builds just the archives you need
  for a specific installation (#1031)
* Fixed handling of spaces in filenames in internal files (#1014)
* Replace calls to `which` by a more portable call (#1061)
* Fixed generation of the init scripts in some cases (#1011)
* Better reports on package patch errors (#987, #988)
* More accurate warnings for unknown package dependencies (#1079)
* Added `opam config report` to help with bug reports (#1034)
* Do not reinstall dev packages with `opam upgrade <pkg>` (#1001)
* Be more careful with `opam init` to a non-empty root directory (#974)
* Cleanup build-dir after successful compiler installation to save on space (#1006)
* Enable packagers to specify mirrors in url files (#807)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140114/00a0ffc3/attachment.html>

From anil at recoil.org  Tue Jan 14 17:34:55 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 14 Jan 2014 17:34:55 +0000
Subject: [opam-devel] [ocaml-platform] OPAM 1.1.1 RC
In-Reply-To: <7642023.CBU7nb4V1q@agaric>
References: <7642023.CBU7nb4V1q@agaric>
Message-ID: <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>

On 14 Jan 2014, at 17:11, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.

I don't think this should be included in 1.1.1, since it changes the repository format.  For instance, is there a clear backwards compatibility story for 1.1.0 clients that connect to a repository that includes multiple archives?

-anil


From louis.gesbert at ocamlpro.com  Wed Jan 15 09:27:54 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 15 Jan 2014 10:27:54 +0100
Subject: [opam-devel] [ocaml-platform] OPAM 1.1.1 RC
In-Reply-To: <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
References: <7642023.CBU7nb4V1q@agaric>
 <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
Message-ID: <3243493.3NMBiFsKb1@ocp-dell>

On Tuesday 14 January 2014 17:34:55 Anil Madhavapeddy wrote:
> On 14 Jan 2014, at 17:11, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
> > Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.
> 
> I don't think this should be included in 1.1.1, since it changes the repository format.  For instance, is there a clear backwards compatibility story for 1.1.0 clients that connect to a repository that includes multiple archives?

Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.

Any opinions on this ? The problem still exists even if we shift that after release.

Cheers,
Louis

From gabriel.scherer at gmail.com  Wed Jan 15 09:50:49 2014
From: gabriel.scherer at gmail.com (Gabriel Scherer)
Date: Wed, 15 Jan 2014 10:50:49 +0100
Subject: [opam-devel] [ocaml-platform]  OPAM 1.1.1 RC
In-Reply-To: <3243493.3NMBiFsKb1@ocp-dell>
References: <7642023.CBU7nb4V1q@agaric>
 <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
 <3243493.3NMBiFsKb1@ocp-dell>
Message-ID: <CAPFanBF_aa8ccco=ddKadGaYsDzgvcFx_GgfNCKmGtu3ZYrWaw@mail.gmail.com>

In the future it may be worth thinking about format versioning, so
that next-version server can apply an adaptation layer when talking to
previous-version clients.

On Wed, Jan 15, 2014 at 10:27 AM, Louis Gesbert
<louis.gesbert at ocamlpro.com> wrote:
> On Tuesday 14 January 2014 17:34:55 Anil Madhavapeddy wrote:
>> On 14 Jan 2014, at 17:11, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>>
>> > Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.
>>
>> I don't think this should be included in 1.1.1, since it changes the repository format.  For instance, is there a clear backwards compatibility story for 1.1.0 clients that connect to a repository that includes multiple archives?
>
> Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
> If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.
>
> Any opinions on this ? The problem still exists even if we shift that after release.
>
> Cheers,
> Louis
> _______________________________________________
> Platform mailing list
> Platform at lists.ocaml.org
> http://lists.ocaml.org/listinfo/platform

From anil at recoil.org  Wed Jan 15 10:03:29 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 15 Jan 2014 10:03:29 +0000
Subject: [opam-devel] [ocaml-platform] OPAM 1.1.1 RC
In-Reply-To: <3243493.3NMBiFsKb1@ocp-dell>
References: <7642023.CBU7nb4V1q@agaric>
 <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
 <3243493.3NMBiFsKb1@ocp-dell>
Message-ID: <025C47AC-6380-47B5-ACC8-78D1478C33E9@recoil.org>

On 15 Jan 2014, at 09:27, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> On Tuesday 14 January 2014 17:34:55 Anil Madhavapeddy wrote:
>> On 14 Jan 2014, at 17:11, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>> 
>>> Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.
>> 
>> I don't think this should be included in 1.1.1, since it changes the repository format.  For instance, is there a clear backwards compatibility story for 1.1.0 clients that connect to a repository that includes multiple archives?
> 
> Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
> If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.

It's not critical to have it right now.  Unplanned outages happen, and this one might have happened right after the 1.1.1 release and the world won't end.  Let's pull it and implement the feature more thoroughly in 1.2.0 rather than cram it into a point release.

> Any opinions on this ? The problem still exists even if we shift that after release.

Not necessarily.  We could bump the repo version in 1.2.0 and think about a compatibility shim for 1.1.0 (via opam-admin rewrites).

-anil


> 
> Cheers,
> Louis
> 


From Christophe.Troestler at umons.ac.be  Wed Jan 15 10:22:08 2014
From: Christophe.Troestler at umons.ac.be (Christophe Troestler)
Date: Wed, 15 Jan 2014 11:22:08 +0100
Subject: [opam-devel] [ocaml-platform]  OPAM 1.1.1 RC
In-Reply-To: <3243493.3NMBiFsKb1@ocp-dell>
References: <7642023.CBU7nb4V1q@agaric>
 <7DF38E0C-87B9-49D9-94E0-34C258ACF981@recoil.org>
 <3243493.3NMBiFsKb1@ocp-dell>
Message-ID: <20140115.112208.811095868884036097.Christophe.Troestler@umons.ac.be>

On Wed, 15 Jan 2014 10:27:54 +0100, Louis Gesbert wrote:
> 
> Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
> If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.
> 
> Any opinions on this ? The problem still exists even if we shift that after release.

Does it break if we allow several archive fields?

From louis.gesbert at ocamlpro.com  Wed Jan 15 10:33:06 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 15 Jan 2014 11:33:06 +0100
Subject: [opam-devel] [ocaml-platform]  OPAM 1.1.1 RC
In-Reply-To: <20140115.112208.811095868884036097.Christophe.Troestler@umons.ac.be>
References: <7642023.CBU7nb4V1q@agaric> <3243493.3NMBiFsKb1@ocp-dell>
 <20140115.112208.811095868884036097.Christophe.Troestler@umons.ac.be>
Message-ID: <3058383.EPME0THgC5@ocp-dell>

On Wednesday 15 January 2014 11:22:08 Christophe Troestler wrote:
> On Wed, 15 Jan 2014 10:27:54 +0100, Louis Gesbert wrote:
> > 
> > Indeed, that would break (quite badly) -- Thomas thought that the url file already supported (unused) archive lists, but that must have been removed at some point.
> > If it's very important to have this now, I can modify the patch so that it only changes the repo in a 1.1.0-compatible way, by adding a `mirror` field instead of changing the current type of the `archive` and similar fields. I tend to think that the smoothness of upgrade may be worth the slightly less clear resulting file format.
> > 
> > Any opinions on this ? The problem still exists even if we shift that after release.
> 
> Does it break if we allow several archive fields?

The OPAM file formats in general don't allow duplicated fields, so we would need to add a deeper-rooted exception for this. As we are not _that_ hurried, 1.1.1 will be without that patch so that the repo migration can be done properly.

From roberto at dicosmo.org  Wed Jan 15 15:13:40 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Wed, 15 Jan 2014 16:13:40 +0100
Subject: [opam-devel] [ocaml-platform] opam 1.1.1 to be released shortly
In-Reply-To: <1854196.ShU3pOPAaF@agaric>
References: <1398884.DsPVFKPgNf@agaric> <20140109233649.GA2106@dark.recoil.org>
 <3311556.qEzEnXgqjl@ocp-dell> <1854196.ShU3pOPAaF@agaric>
Message-ID: <CAJBwKuWuaF1d7BYOA8r2K+9zUzBGJ65WyJ9no2J6M0xNz2xk+A@mail.gmail.com>

Hi Louis,
   I agree that aspcud is not a blocker, if the patch to aspcud is
properly integrated on Mac OSX,
so we can keep the default value for OPAMCRITERIA.

Once we have a proper external solver on all platforms, we should be
able to clean up all the complex heuristics code present today, but
that can wait.

2014/1/14 Louis Gesbert <louis.gesbert at ocamlpro.com>:
> I am going to test and do a few last fixes, and should have a RC available
> today.
>
>
>
> Unless they are needed for 1.1.1, I am going to add a bunch of variables
> just after the release (`system-version`, `build-dir`, `opt-available`, and
> all those in https://github.com/ocaml/opam/pull/967).
>
>
>
> No easy fix yet, but I'll try to improve the reports on what's NEW or
> UPDATED today (#1030); as for the solver/heuristic issue (#985), the
> (source) release can be independent from the port of aspcud so I don't think
> it is a blocker.
>
>
>
> Cheers,
>
> Louis
>
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>



-- 
Roberto Di Cosmo

------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:

Bureau 320 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3

From louis.gesbert at ocamlpro.com  Mon Jan 20 17:38:51 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Mon, 20 Jan 2014 18:38:51 +0100
Subject: [opam-devel] New release scripts
Message-ID: <5751684.SzBzsS0xBT@agaric>

I've just been simplifying the release process.

There is now a single `shell/release.sh` script that can pack up a source tarball, build binaries on your architecture and upload everything on the github release page (https://github.com/ocaml/opam/releases) to be picked up by the opam-installer script.

So if you've got an architecture for which we don't have binaries yet please run:

curl -OL https://raw.github.com/ocaml/opam/master/shell/release.sh && bash ./release.sh -t 1.1.1-RC2

with 1.1.1-RC2 being the release tag you want to build.

Prerequisites: jq, ocaml 4.01.0 and write access to the repo
(you'll be asked your username and password (or token) for the upload).

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140120/3e0f6448/attachment.html>

From louis.gesbert at ocamlpro.com  Tue Jan 21 17:01:46 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Tue, 21 Jan 2014 18:01:46 +0100
Subject: [opam-devel] OPAM 1.1.1 RC2 => release !
In-Reply-To: <7642023.CBU7nb4V1q@agaric>
References: <7642023.CBU7nb4V1q@agaric>
Message-ID: <2777408.j2OWThft0a@agaric>

There seems to have been no critical bugs noticed on 1.1.1-RC2, so I am going to release it as 1.1.1 tomorrow (wednesday), unless there still is a reason not to ?

Cheers,
Louis


Le mardi 14 janvier 2014, 18:11:11 Louis Gesbert a ?crit :
> The first RC for OPAM 1.1.1 has just been tagged. Everyone is welcome to try it out and report any last-minute problems !
> 
> Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.
> 
> Cheers !
> Louis
> 
> 
> From the changelog:
> * Fix `opam-admin make <packages> -r` (#990)
> * Explicitly prettyprint list of lists, to fix `opam-admin depexts` (#997)
> * Tell the user which fields is invalid in a configuration file (#1016)
> * Add `OpamSolver.empty_universe` for flexible universe instantiation (#1033)
> * Add `OpamFormula.eval_relop` and `OpamFormula.check_relop` (#1042)
> * Change `OpamCompiler.compare` to match `Pervasives.compare` (#1042)
> * Add `OpamCompiler.eval_relop` (#1042)
> * Add `OpamPackage.Name.compare` (#1046)
> * Add types `version_constraint` and `version_formula` to `OpamFormula` (#1046)
> * Clearer command aliases. Made `info` an alias for `show` and added the alias `uninstall` (#944)
> * Fixed `opam init --root=<relative path>` (#1047)
> * Display OS constraints in `opam info` (#1052)
> * Add a new 'opam-installer' script to make `.install` files usable outside of opam (#1026)
> * Add a `--resolve` option to `opam-admin make` that builds just the archives you need
>   for a specific installation (#1031)
> * Fixed handling of spaces in filenames in internal files (#1014)
> * Replace calls to `which` by a more portable call (#1061)
> * Fixed generation of the init scripts in some cases (#1011)
> * Better reports on package patch errors (#987, #988)
> * More accurate warnings for unknown package dependencies (#1079)
> * Added `opam config report` to help with bug reports (#1034)
> * Do not reinstall dev packages with `opam upgrade <pkg>` (#1001)
> * Be more careful with `opam init` to a non-empty root directory (#974)
> * Cleanup build-dir after successful compiler installation to save on space (#1006)
> * Enable packagers to specify mirrors in url files (#807)
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140121/11eef999/attachment.html>

From anil at recoil.org  Tue Jan 21 17:27:45 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 21 Jan 2014 17:27:45 +0000
Subject: [opam-devel] OPAM 1.1.1 RC2 => release !
In-Reply-To: <2777408.j2OWThft0a@agaric>
References: <7642023.CBU7nb4V1q@agaric> <2777408.j2OWThft0a@agaric>
Message-ID: <E7251D8F-7D06-4631-B2B9-4D9CD95EB11D@recoil.org>

I've gotten a bit lost here; RC1 was unsuitable for testing due to the backwards compatibility change, and you only tagged RC2 yesterday, right?

I've still not had a chance to it on *BSD since yesterday.

Do we have a quick checklist somewhere to check that the platforms we care about have been tested?  I.e. a Ubuntu (Precise/Saucy), Debian (Wheezy/Jessie), Fedora FreeBSD 10 and OpenBSD, and perhaps rPi.  That's a more useful way to determine if it's release ready rather than waiting for a period of time.

-anil

On 21 Jan 2014, at 17:01, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> There seems to have been no critical bugs noticed on 1.1.1-RC2, so I am going to release it as 1.1.1 tomorrow (wednesday), unless there still is a reason not to ?
>  
> Cheers,
> Louis
>  
>  
> Le mardi 14 janvier 2014, 18:11:11 Louis Gesbert a ?crit :
> > The first RC for OPAM 1.1.1 has just been tagged. Everyone is welcome to try it out and report any last-minute problems !
> > 
> > Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.
> > 
> > Cheers !
> > Louis
> > 
> > 
> > From the changelog:
> > * Fix `opam-admin make <packages> -r` (#990)
> > * Explicitly prettyprint list of lists, to fix `opam-admin depexts` (#997)
> > * Tell the user which fields is invalid in a configuration file (#1016)
> > * Add `OpamSolver.empty_universe` for flexible universe instantiation (#1033)
> > * Add `OpamFormula.eval_relop` and `OpamFormula.check_relop` (#1042)
> > * Change `OpamCompiler.compare` to match `Pervasives.compare` (#1042)
> > * Add `OpamCompiler.eval_relop` (#1042)
> > * Add `OpamPackage.Name.compare` (#1046)
> > * Add types `version_constraint` and `version_formula` to `OpamFormula` (#1046)
> > * Clearer command aliases. Made `info` an alias for `show` and added the alias `uninstall` (#944)
> > * Fixed `opam init --root=<relative path>` (#1047)
> > * Display OS constraints in `opam info` (#1052)
> > * Add a new 'opam-installer' script to make `.install` files usable outside of opam (#1026)
> > * Add a `--resolve` option to `opam-admin make` that builds just the archives you need
> >   for a specific installation (#1031)
> > * Fixed handling of spaces in filenames in internal files (#1014)
> > * Replace calls to `which` by a more portable call (#1061)
> > * Fixed generation of the init scripts in some cases (#1011)
> > * Better reports on package patch errors (#987, #988)
> > * More accurate warnings for unknown package dependencies (#1079)
> > * Added `opam config report` to help with bug reports (#1034)
> > * Do not reinstall dev packages with `opam upgrade <pkg>` (#1001)
> > * Be more careful with `opam init` to a non-empty root directory (#974)
> > * Cleanup build-dir after successful compiler installation to save on space (#1006)
> > * Enable packagers to specify mirrors in url files (#807)
> > 
>  
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From louis.gesbert at ocamlpro.com  Wed Jan 22 08:57:16 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 22 Jan 2014 09:57:16 +0100
Subject: [opam-devel] OPAM 1.1.1 RC2 => release !
In-Reply-To: <E7251D8F-7D06-4631-B2B9-4D9CD95EB11D@recoil.org>
References: <7642023.CBU7nb4V1q@agaric> <2777408.j2OWThft0a@agaric>
 <E7251D8F-7D06-4631-B2B9-4D9CD95EB11D@recoil.org>
Message-ID: <1597826.V0tcgA5D0H@agaric>

I tagged it on friday, but didn't really advertise it, to be honest ; that only makes your point stronger anyway :)

It would probably be a good idea to start setting up a bunch of test VMs on a box for this purpose. But anybody is still welcome to help checking the release !

An issue has been added here: https://github.com/ocaml/opam/issues/1114
to track this.


Le mardi 21 janvier 2014, 17:27:45 Anil Madhavapeddy a ?crit :
> I've gotten a bit lost here; RC1 was unsuitable for testing due to the backwards compatibility change, and you only tagged RC2 yesterday, right?
> 
> I've still not had a chance to it on *BSD since yesterday.
> 
> Do we have a quick checklist somewhere to check that the platforms we care about have been tested?  I.e. a Ubuntu (Precise/Saucy), Debian (Wheezy/Jessie), Fedora FreeBSD 10 and OpenBSD, and perhaps rPi.  That's a more useful way to determine if it's release ready rather than waiting for a period of time.
> 
> -anil
> 
> On 21 Jan 2014, at 17:01, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
> > There seems to have been no critical bugs noticed on 1.1.1-RC2, so I am going to release it as 1.1.1 tomorrow (wednesday), unless there still is a reason not to ?
> >  
> > Cheers,
> > Louis
> >  
> >  
> > Le mardi 14 janvier 2014, 18:11:11 Louis Gesbert a ?crit :
> > > The first RC for OPAM 1.1.1 has just been tagged. Everyone is welcome to try it out and report any last-minute problems !
> > > 
> > > Last addition was the possibility for packagers to specify `archive: ["upstream-url" "mirror1" "mirror2"]` in the url files, so that we have a way to circumvent downtime of package hosting servers -- like recently happened for camlcity with dire consequences for new OPAM installations (ocamlfind could not be installed). We are working on a more general mirroring solution for the next release.
> > > 
> > > Cheers !
> > > Louis
> > > 
> > > 
> > > From the changelog:
> > > * Fix `opam-admin make <packages> -r` (#990)
> > > * Explicitly prettyprint list of lists, to fix `opam-admin depexts` (#997)
> > > * Tell the user which fields is invalid in a configuration file (#1016)
> > > * Add `OpamSolver.empty_universe` for flexible universe instantiation (#1033)
> > > * Add `OpamFormula.eval_relop` and `OpamFormula.check_relop` (#1042)
> > > * Change `OpamCompiler.compare` to match `Pervasives.compare` (#1042)
> > > * Add `OpamCompiler.eval_relop` (#1042)
> > > * Add `OpamPackage.Name.compare` (#1046)
> > > * Add types `version_constraint` and `version_formula` to `OpamFormula` (#1046)
> > > * Clearer command aliases. Made `info` an alias for `show` and added the alias `uninstall` (#944)
> > > * Fixed `opam init --root=<relative path>` (#1047)
> > > * Display OS constraints in `opam info` (#1052)
> > > * Add a new 'opam-installer' script to make `.install` files usable outside of opam (#1026)
> > > * Add a `--resolve` option to `opam-admin make` that builds just the archives you need
> > >   for a specific installation (#1031)
> > > * Fixed handling of spaces in filenames in internal files (#1014)
> > > * Replace calls to `which` by a more portable call (#1061)
> > > * Fixed generation of the init scripts in some cases (#1011)
> > > * Better reports on package patch errors (#987, #988)
> > > * More accurate warnings for unknown package dependencies (#1079)
> > > * Added `opam config report` to help with bug reports (#1034)
> > > * Do not reinstall dev packages with `opam upgrade <pkg>` (#1001)
> > > * Be more careful with `opam init` to a non-empty root directory (#974)
> > > * Cleanup build-dir after successful compiler installation to save on space (#1006)
> > > * Enable packagers to specify mirrors in url files (#807)
> > > 
> >  
> > _______________________________________________
> > opam-devel mailing list
> > opam-devel at lists.ocaml.org
> > http://lists.ocaml.org/listinfo/opam-devel
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140122/67adc184/attachment-0001.html>

From roberto at dicosmo.org  Wed Jan 22 09:40:15 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Wed, 22 Jan 2014 10:40:15 +0100
Subject: [opam-devel] OPAM 1.1.1 RC2 => release !
In-Reply-To: <1597826.V0tcgA5D0H@agaric>
References: <7642023.CBU7nb4V1q@agaric> <2777408.j2OWThft0a@agaric>
 <E7251D8F-7D06-4631-B2B9-4D9CD95EB11D@recoil.org>
 <1597826.V0tcgA5D0H@agaric>
Message-ID: <20140122094015.GD27093@voyager>


On Wed, Jan 22, 2014 at 09:57:16AM +0100, Louis Gesbert wrote:
> It would probably be a good idea to start setting up a bunch of test VMs on a
> box for this purpose. But anybody is still welcome to help checking the release
> !

Indeed! And one could add also in the same testing environment a target for
aspcud (for Debian, it is mantained, hence for Ubuntu too; for the various
RPM based distros out there we can produce a quick and dirty .rpm package
using alien on Debian)


-- 
Roberto

From anil at recoil.org  Wed Jan 22 11:04:36 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 22 Jan 2014 11:04:36 +0000
Subject: [opam-devel] OPAM 1.1.1 RC2 => release !
In-Reply-To: <20140122094015.GD27093@voyager>
References: <7642023.CBU7nb4V1q@agaric> <2777408.j2OWThft0a@agaric>
 <E7251D8F-7D06-4631-B2B9-4D9CD95EB11D@recoil.org> <1597826.V0tcgA5D0H@agaric>
 <20140122094015.GD27093@voyager>
Message-ID: <32EA0439-CD13-4257-9EDF-F3B5DAC8DDE3@recoil.org>

On 22 Jan 2014, at 09:40, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

> 
> On Wed, Jan 22, 2014 at 09:57:16AM +0100, Louis Gesbert wrote:
>> It would probably be a good idea to start setting up a bunch of test VMs on a
>> box for this purpose. But anybody is still welcome to help checking the release
>> !
> 
> Indeed! And one could add also in the same testing environment a target for
> aspcud (for Debian, it is mantained, hence for Ubuntu too; for the various
> RPM based distros out there we can produce a quick and dirty .rpm package
> using alien on Debian)

I'd recommend using the Open Build Service from SUSE instead -- it does both
Deb and RPMs, and also non-x86 build arches such as ARM and PowerPC.

-anil

From roberto at dicosmo.org  Wed Jan 22 11:39:58 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Wed, 22 Jan 2014 12:39:58 +0100
Subject: [opam-devel] OPAM 1.1.1 RC2 => release !
In-Reply-To: <32EA0439-CD13-4257-9EDF-F3B5DAC8DDE3@recoil.org>
References: <7642023.CBU7nb4V1q@agaric> <2777408.j2OWThft0a@agaric>
 <E7251D8F-7D06-4631-B2B9-4D9CD95EB11D@recoil.org>
 <1597826.V0tcgA5D0H@agaric> <20140122094015.GD27093@voyager>
 <32EA0439-CD13-4257-9EDF-F3B5DAC8DDE3@recoil.org>
Message-ID: <20140122113958.GA32493@voyager>

Thanks Anil,
       I'll have a look at it...

On Wed, Jan 22, 2014 at 11:04:36AM +0000, Anil Madhavapeddy wrote:
> On 22 Jan 2014, at 09:40, Roberto Di Cosmo <roberto at dicosmo.org> wrote:
> 
> > 
> > On Wed, Jan 22, 2014 at 09:57:16AM +0100, Louis Gesbert wrote:
> >> It would probably be a good idea to start setting up a bunch of test VMs on a
> >> box for this purpose. But anybody is still welcome to help checking the release
> >> !
> > 
> > Indeed! And one could add also in the same testing environment a target for
> > aspcud (for Debian, it is mantained, hence for Ubuntu too; for the various
> > RPM based distros out there we can produce a quick and dirty .rpm package
> > using alien on Debian)
> 
> I'd recommend using the Open Build Service from SUSE instead -- it does both
> Deb and RPMs, and also non-x86 build arches such as ARM and PowerPC.
> 
> -anil

-- 
Roberto Di Cosmo
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 3020 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        

From thomas at gazagnaire.org  Thu Jan 23 15:40:46 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Thu, 23 Jan 2014 15:40:46 +0000
Subject: [opam-devel] Call for help
Message-ID: <FB399181-171C-4922-BCAD-FC2EA05CCC64@gazagnaire.org>

Hi all,

I've pass few hours this morning cleaning up the issues in https://github.com/ocaml/opam-repository/issues

If people want to contribute or help making the things work better, I think it's good time to randomly pick an issue and try to fix it!

Cheers,
Thomas





From amc79 at cam.ac.uk  Thu Jan 23 15:56:06 2014
From: amc79 at cam.ac.uk (Amir Chaudhry)
Date: Thu, 23 Jan 2014 15:56:06 +0000
Subject: [opam-devel] Call for help
In-Reply-To: <FB399181-171C-4922-BCAD-FC2EA05CCC64@gazagnaire.org>
References: <FB399181-171C-4922-BCAD-FC2EA05CCC64@gazagnaire.org>
Message-ID: <BE21F8BB-9CE9-4ADF-A74F-2509F63134FA@cam.ac.uk>

I had a quick look and just closed a 5 month old bug related to an older version of core on 4.01.0+beta1.  I'm assuming this is helpful. :)  There may be other old issues that could be easily dealt with.  

https://github.com/ocaml/opam-repository/issues/1040

ac

On 23 Jan 2014, at 15:40, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:

> Hi all,
> 
> I've pass few hours this morning cleaning up the issues in https://github.com/ocaml/opam-repository/issues
> 
> If people want to contribute or help making the things work better, I think it's good time to randomly pick an issue and try to fix it!
> 
> Cheers,
> Thomas
> 
> 
> 
> 
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From agarwal1975 at gmail.com  Thu Jan 23 16:02:50 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Thu, 23 Jan 2014 11:02:50 -0500
Subject: [opam-devel] can a repository URL point to a sub-directory of a
	git repo
In-Reply-To: <E5371CD1-2ED7-4317-8DB7-C954A2637517@gmail.com>
References: <CAMu2m2LL=uSDAJ=y-UQBENQo8+naNnokcr=riDOnu8Mkn8CXpw@mail.gmail.com>
 <28747250-E7E2-47AC-BAF7-4692266881E8@gmail.com>
 <CAMu2m2Kf5CXL+RmG-8DTipnHHtnr_3CPvxZiUs_xQ_GUf-W+-g@mail.gmail.com>
 <E5371CD1-2ED7-4317-8DB7-C954A2637517@gmail.com>
Message-ID: <CAMu2m2JWeARkd6STxboSGoUSKEhByD=1sds6jm6+Deu3nvEs4Q@mail.gmail.com>

On Thu, Jan 23, 2014 at 10:42 AM, Thomas Gazagnaire <
thomas.gazagnaire at gmail.com> wrote:

That's very weird. Where did you find that email address ???
>

Seems I'm wrong. It was decided to use only opam-devel for both user and
devel questions:
https://sympa.inria.fr/sympa/arc/caml-list/2013-03/msg00023.html

Thus, cc'ing opam-devel now. I guess opam-users at inria.fr should be shut
down. That would have given me an undeliverable error (though I got lucky
and you somehow found this message anyway).



> that should be asdf/opam/{opam,url,descr}
>

It still doesn't work:

$ opam repository add asdf-dev git at github.com:agarwal/asdf.git
asdf-dev   Fetching git at github.com:agarwal/asdf.git
Updating ~/.opam/repo/compiler-index ...
Updating ~/.opam/compilers/ ...
Updating ~/.opam/repo/package-index ...
Updating ~/.opam/packages/ ...
Updating the cache of metadata (~/.opam/state.cache) ...

$ opam info asdf
[ERROR] No packages found.
'/Users/ashish/usr/ocaml/4.01.0/bin/opam info asdf' failed.


Also, with this, how does opam know what version to assign the package?



On Wed, Jan 22, 2014 at 2:23 PM, Ashish Agarwal <agarwal1975 at gmail.com>
 wrote:

> During development of a repository foo, I often like to create within that
> repo an opam-repo. I'll have something like this:
>
> foo/opam-repo/packages/foo/foo.master
>
> With a local copy of foo, I can now do:
>
> opam repository add foo-dev foo/opam-repo
>
> which is nice. It let's me keep the opam package description up-to-date
> during rapid development of foo. However, now I'm wondering if I can refer
> to this sub-directory with a git URL, something like the following:
>
> opam repository add foo-dev git at github.com:agarwal/foo/opam-repo
>
> The above URL isn't valid however. Is there a way to accomplish this?
>
> The workaround is easy enough. I can define this package in a dedicated
> git repository, like the main opam-repository. However, it is nice to keep
> the dev version of an opam package within the related repo.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140123/f613fb36/attachment.html>

From thomas at gazagnaire.org  Thu Jan 23 16:46:43 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Thu, 23 Jan 2014 16:46:43 +0000
Subject: [opam-devel] can a repository URL point to a sub-directory of a
	git repo
In-Reply-To: <CAMu2m2JWeARkd6STxboSGoUSKEhByD=1sds6jm6+Deu3nvEs4Q@mail.gmail.com>
References: <CAMu2m2LL=uSDAJ=y-UQBENQo8+naNnokcr=riDOnu8Mkn8CXpw@mail.gmail.com>
 <28747250-E7E2-47AC-BAF7-4692266881E8@gmail.com>
 <CAMu2m2Kf5CXL+RmG-8DTipnHHtnr_3CPvxZiUs_xQ_GUf-W+-g@mail.gmail.com>
 <E5371CD1-2ED7-4317-8DB7-C954A2637517@gmail.com>
 <CAMu2m2JWeARkd6STxboSGoUSKEhByD=1sds6jm6+Deu3nvEs4Q@mail.gmail.com>
Message-ID: <4AE866CE-2A18-4D4E-AB77-3417328E93B0@gazagnaire.org>

 
> that should be asdf/opam/{opam,url,descr}
> 
> It still doesn't work:
> 
> $ opam repository add asdf-dev git at github.com:agarwal/asdf.git
> asdf-dev   Fetching git at github.com:agarwal/asdf.git
> Updating ~/.opam/repo/compiler-index ...
> Updating ~/.opam/compilers/ ...
> Updating ~/.opam/repo/package-index ...
> Updating ~/.opam/packages/ ...
> Updating the cache of metadata (~/.opam/state.cache) ...
> 
> $ opam info asdf
> [ERROR] No packages found.
> '/Users/ashish/usr/ocaml/4.01.0/bin/opam info asdf' failed.

Ha I see, the package does not exist yet. So no, this is not supported. See https://github.com/ocaml/opam/issues/941

Thomas

> 
> 
> Also, with this, how does opam know what version to assign the package?
> 
> 
> 
> On Wed, Jan 22, 2014 at 2:23 PM, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
> During development of a repository foo, I often like to create within that repo an opam-repo. I'll have something like this:
> 
> foo/opam-repo/packages/foo/foo.master
> 
> With a local copy of foo, I can now do:
> 
> opam repository add foo-dev foo/opam-repo
> 
> which is nice. It let's me keep the opam package description up-to-date during rapid development of foo. However, now I'm wondering if I can refer to this sub-directory with a git URL, something like the following:
> 
> opam repository add foo-dev git at github.com:agarwal/foo/opam-repo
> 
> The above URL isn't valid however. Is there a way to accomplish this?
> 
> The workaround is easy enough. I can define this package in a dedicated git repository, like the main opam-repository. However, it is nice to keep the dev version of an opam package within the related repo.
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140123/06821955/attachment.html>

From agarwal1975 at gmail.com  Thu Jan 23 17:24:30 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Thu, 23 Jan 2014 12:24:30 -0500
Subject: [opam-devel] can a repository URL point to a sub-directory of a
	git repo
In-Reply-To: <4AE866CE-2A18-4D4E-AB77-3417328E93B0@gazagnaire.org>
References: <CAMu2m2LL=uSDAJ=y-UQBENQo8+naNnokcr=riDOnu8Mkn8CXpw@mail.gmail.com>
 <28747250-E7E2-47AC-BAF7-4692266881E8@gmail.com>
 <CAMu2m2Kf5CXL+RmG-8DTipnHHtnr_3CPvxZiUs_xQ_GUf-W+-g@mail.gmail.com>
 <E5371CD1-2ED7-4317-8DB7-C954A2637517@gmail.com>
 <CAMu2m2JWeARkd6STxboSGoUSKEhByD=1sds6jm6+Deu3nvEs4Q@mail.gmail.com>
 <4AE866CE-2A18-4D4E-AB77-3417328E93B0@gazagnaire.org>
Message-ID: <CAMu2m2JypPtCgvtG8qSDoLUkxtNx_7V2sCK3g5hmp6iJi2+TVg@mail.gmail.com>

Oh, I see. I was supposed to directly pin the package, but that isn't
supported yet. Got it.


On Thu, Jan 23, 2014 at 11:46 AM, Thomas Gazagnaire
<thomas at gazagnaire.org>wrote:

>
>
>  that should be asdf/opam/{opam,url,descr}
>>
>
> It still doesn't work:
>
> $ opam repository add asdf-dev git at github.com:agarwal/asdf.git
> asdf-dev   Fetching git at github.com:agarwal/asdf.git
> Updating ~/.opam/repo/compiler-index ...
> Updating ~/.opam/compilers/ ...
> Updating ~/.opam/repo/package-index ...
> Updating ~/.opam/packages/ ...
> Updating the cache of metadata (~/.opam/state.cache) ...
>
> $ opam info asdf
> [ERROR] No packages found.
> '/Users/ashish/usr/ocaml/4.01.0/bin/opam info asdf' failed.
>
>
> Ha I see, the package does not exist yet. So no, this is not supported.
> See https://github.com/ocaml/opam/issues/941
>
> Thomas
>
>
>
> Also, with this, how does opam know what version to assign the package?
>
>
>
> On Wed, Jan 22, 2014 at 2:23 PM, Ashish Agarwal <agarwal1975 at gmail.com>
>  wrote:
>
>> During development of a repository foo, I often like to create within
>> that repo an opam-repo. I'll have something like this:
>>
>> foo/opam-repo/packages/foo/foo.master
>>
>> With a local copy of foo, I can now do:
>>
>> opam repository add foo-dev foo/opam-repo
>>
>> which is nice. It let's me keep the opam package description up-to-date
>> during rapid development of foo. However, now I'm wondering if I can refer
>> to this sub-directory with a git URL, something like the following:
>>
>> opam repository add foo-dev git at github.com:agarwal/foo/opam-repo
>>
>> The above URL isn't valid however. Is there a way to accomplish this?
>>
>> The workaround is easy enough. I can define this package in a dedicated
>> git repository, like the main opam-repository. However, it is nice to keep
>> the dev version of an opam package within the related repo.
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140123/0714e3ba/attachment-0001.html>

From thomas at gazagnaire.org  Thu Jan 23 17:36:40 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Thu, 23 Jan 2014 17:36:40 +0000
Subject: [opam-devel] can a repository URL point to a sub-directory of a
	git repo
In-Reply-To: <CAMu2m2JypPtCgvtG8qSDoLUkxtNx_7V2sCK3g5hmp6iJi2+TVg@mail.gmail.com>
References: <CAMu2m2LL=uSDAJ=y-UQBENQo8+naNnokcr=riDOnu8Mkn8CXpw@mail.gmail.com>
 <28747250-E7E2-47AC-BAF7-4692266881E8@gmail.com>
 <CAMu2m2Kf5CXL+RmG-8DTipnHHtnr_3CPvxZiUs_xQ_GUf-W+-g@mail.gmail.com>
 <E5371CD1-2ED7-4317-8DB7-C954A2637517@gmail.com>
 <CAMu2m2JWeARkd6STxboSGoUSKEhByD=1sds6jm6+Deu3nvEs4Q@mail.gmail.com>
 <4AE866CE-2A18-4D4E-AB77-3417328E93B0@gazagnaire.org>
 <CAMu2m2JypPtCgvtG8qSDoLUkxtNx_7V2sCK3g5hmp6iJi2+TVg@mail.gmail.com>
Message-ID: <7B7FAD95-D1B4-4494-A815-22A8503BF77C@gazagnaire.org>

> Oh, I see. I was supposed to directly pin the package, but that isn't supported yet. Got it.

After re-reading your question again, a possible solution is to have this hierarchy:

./packages/<name>.<version>/{opam,descr,url}

inside your git repo and adding it as a remote repo should work.

Thomas


> 
> 
> On Thu, Jan 23, 2014 at 11:46 AM, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
>  
>> that should be asdf/opam/{opam,url,descr}
>> 
>> It still doesn't work:
>> 
>> $ opam repository add asdf-dev git at github.com:agarwal/asdf.git
>> asdf-dev   Fetching git at github.com:agarwal/asdf.git
>> Updating ~/.opam/repo/compiler-index ...
>> Updating ~/.opam/compilers/ ...
>> Updating ~/.opam/repo/package-index ...
>> Updating ~/.opam/packages/ ...
>> Updating the cache of metadata (~/.opam/state.cache) ...
>> 
>> $ opam info asdf
>> [ERROR] No packages found.
>> '/Users/ashish/usr/ocaml/4.01.0/bin/opam info asdf' failed.
> 
> Ha I see, the package does not exist yet. So no, this is not supported. See https://github.com/ocaml/opam/issues/941
> 
> Thomas
> 
>> 
>> 
>> Also, with this, how does opam know what version to assign the package?
>> 
>> 
>> 
>> On Wed, Jan 22, 2014 at 2:23 PM, Ashish Agarwal <agarwal1975 at gmail.com> wrote:
>> During development of a repository foo, I often like to create within that repo an opam-repo. I'll have something like this:
>> 
>> foo/opam-repo/packages/foo/foo.master
>> 
>> With a local copy of foo, I can now do:
>> 
>> opam repository add foo-dev foo/opam-repo
>> 
>> which is nice. It let's me keep the opam package description up-to-date during rapid development of foo. However, now I'm wondering if I can refer to this sub-directory with a git URL, something like the following:
>> 
>> opam repository add foo-dev git at github.com:agarwal/foo/opam-repo
>> 
>> The above URL isn't valid however. Is there a way to accomplish this?
>> 
>> The workaround is easy enough. I can define this package in a dedicated git repository, like the main opam-repository. However, it is nice to keep the dev version of an opam package within the related repo.
>> 
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140123/8887a61d/attachment.html>

From agarwal1975 at gmail.com  Thu Jan 23 17:56:17 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Thu, 23 Jan 2014 12:56:17 -0500
Subject: [opam-devel] can a repository URL point to a sub-directory of a
	git repo
In-Reply-To: <7B7FAD95-D1B4-4494-A815-22A8503BF77C@gazagnaire.org>
References: <CAMu2m2LL=uSDAJ=y-UQBENQo8+naNnokcr=riDOnu8Mkn8CXpw@mail.gmail.com>
 <28747250-E7E2-47AC-BAF7-4692266881E8@gmail.com>
 <CAMu2m2Kf5CXL+RmG-8DTipnHHtnr_3CPvxZiUs_xQ_GUf-W+-g@mail.gmail.com>
 <E5371CD1-2ED7-4317-8DB7-C954A2637517@gmail.com>
 <CAMu2m2JWeARkd6STxboSGoUSKEhByD=1sds6jm6+Deu3nvEs4Q@mail.gmail.com>
 <4AE866CE-2A18-4D4E-AB77-3417328E93B0@gazagnaire.org>
 <CAMu2m2JypPtCgvtG8qSDoLUkxtNx_7V2sCK3g5hmp6iJi2+TVg@mail.gmail.com>
 <7B7FAD95-D1B4-4494-A815-22A8503BF77C@gazagnaire.org>
Message-ID: <CAMu2m2JpfbJgL1z58GJVdeAxJwxXX_9N4G_pZJvugXo8Ck_Yew@mail.gmail.com>

On Thu, Jan 23, 2014 at 12:36 PM, Thomas Gazagnaire
<thomas at gazagnaire.org>wrote:

After re-reading your question again, a possible solution is to have this
> hierarchy:
>
> ./packages/<name>.<version>/{opam,descr,url}
>
> inside your git repo and adding it as a remote repo should work.
>

Of course! That does work, though it's not too nice having a packages/
directory in the top-level. At least opam/ would give some clue what the
directory is about.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140123/152ab264/attachment.html>

From anil at recoil.org  Sun Jan 26 09:58:48 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 26 Jan 2014 09:58:48 +0000
Subject: [opam-devel] New release scripts
In-Reply-To: <5751684.SzBzsS0xBT@agaric>
References: <5751684.SzBzsS0xBT@agaric>
Message-ID: <169FC1F1-75D7-4ABB-8DC6-04FC673AD0F1@recoil.org>

On 20 Jan 2014, at 17:38, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> I've just been simplifying the release process.
>  
> There is now a single `shell/release.sh` script that can pack up a source tarball, build binaries on your architecture and upload everything on the github release page (https://github.com/ocaml/opam/releases) to be picked up by the opam-installer script.
>  
> So if you've got an architecture for which we don't have binaries yet please run:
>  
> curl -OL https://raw.github.com/ocaml/opam/master/shell/release.sh && bash ./release.sh -t 1.1.1-RC2
>  
> with 1.1.1-RC2 being the release tag you want to build.
>  
> Prerequisites: jq, ocaml 4.01.0 and write access to the repo
> (you'll be asked your username and password (or token) for the upload).

I've added a few more binaries, and should have a FreeBSD test done on Monday.

Incidentally, ocaml-github has a 'git-jar' facility to store secrets in, so you could also use that for a release script to avoid the jq dependency (and also test the local OPAM binary that just got built by using it to install the required libraries).

-anil

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140126/a2c65004/attachment.html>

From agarwal1975 at gmail.com  Mon Jan 27 18:33:02 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Mon, 27 Jan 2014 13:33:02 -0500
Subject: [opam-devel] opam install says: Your request cannot be satisfied.
Message-ID: <CAMu2m2Kn8QDgT2=HaCzBSK4=UOxTBg4BLO=NUyHU1weFJJMqOA@mail.gmail.com>

`opam install` says "Your request cannot be satisfied." What exactly does
that mean? Has the solver proven that the constraints definitively cannot
be satisfied or is there still a possible solution?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140127/b0f7fbcd/attachment.html>

From thomas at gazagnaire.org  Tue Jan 28 13:45:59 2014
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Tue, 28 Jan 2014 13:45:59 +0000
Subject: [opam-devel] opam install says: Your request cannot be
	satisfied.
In-Reply-To: <CAMu2m2Kn8QDgT2=HaCzBSK4=UOxTBg4BLO=NUyHU1weFJJMqOA@mail.gmail.com>
References: <CAMu2m2Kn8QDgT2=HaCzBSK4=UOxTBg4BLO=NUyHU1weFJJMqOA@mail.gmail.com>
Message-ID: <D3E6B5F6-995E-4253-B04B-1706BFD1D4E3@gazagnaire.org>

> `opam install` says "Your request cannot be satisfied." What exactly does that mean? Has the solver proven that the constraints definitively cannot be satisfied or is there still a possible solution?

What else does it prints ? A conflict list ? Yes, it ought to means "there is no solution satisfying the request", but it's possible than the wording is not precise enough.

Thomas


From agarwal1975 at gmail.com  Tue Jan 28 13:59:41 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Tue, 28 Jan 2014 08:59:41 -0500
Subject: [opam-devel] opam install says: Your request cannot be
	satisfied.
In-Reply-To: <D3E6B5F6-995E-4253-B04B-1706BFD1D4E3@gazagnaire.org>
References: <CAMu2m2Kn8QDgT2=HaCzBSK4=UOxTBg4BLO=NUyHU1weFJJMqOA@mail.gmail.com>
 <D3E6B5F6-995E-4253-B04B-1706BFD1D4E3@gazagnaire.org>
Message-ID: <CAMu2m2JeMZsjypKgQ+Db1RVJFNmXFDR0-F+tDxdsX8GHe88jaA@mail.gmail.com>

Yes, it prints out a long list of what constraints needed to be satisfied
but couldn't be. Okay, I was just wondering this for a related question on
the Core mailing list, which Anil suggested might be solved by using
aspcud. It's already confirmed that the particular solver didn't help that
issue, which would also have been clear if I knew that "Your request cannot
be satisfied" means "provably cannot be satisfied". I'm not suggesting a
wording change. I think it's fine.


On Tue, Jan 28, 2014 at 8:45 AM, Thomas Gazagnaire <thomas at gazagnaire.org>wrote:

> > `opam install` says "Your request cannot be satisfied." What exactly
> does that mean? Has the solver proven that the constraints definitively
> cannot be satisfied or is there still a possible solution?
>
> What else does it prints ? A conflict list ? Yes, it ought to means "there
> is no solution satisfying the request", but it's possible than the wording
> is not precise enough.
>
> Thomas
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140128/cd10917e/attachment.html>

From roberto at dicosmo.org  Tue Jan 28 15:09:49 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Tue, 28 Jan 2014 16:09:49 +0100
Subject: [opam-devel] opam install says: Your request cannot be
 satisfied.
In-Reply-To: <CAMu2m2JeMZsjypKgQ+Db1RVJFNmXFDR0-F+tDxdsX8GHe88jaA@mail.gmail.com>
References: <CAMu2m2Kn8QDgT2=HaCzBSK4=UOxTBg4BLO=NUyHU1weFJJMqOA@mail.gmail.com>
 <D3E6B5F6-995E-4253-B04B-1706BFD1D4E3@gazagnaire.org>
 <CAMu2m2JeMZsjypKgQ+Db1RVJFNmXFDR0-F+tDxdsX8GHe88jaA@mail.gmail.com>
Message-ID: <20140128150949.GC23700@voyager>

Hi Ashish,
   indeed, when the request is not satisfiable, using the internal solver
or an external one will not change much. The difference only shows up
if the request can be satisfied: in that case, there may be
exponentially many solutions, and the external solvers incorporate
the logic needed to find one that optimises some user criteria.

The long list of constraints that is printed out is actually precious
information that should be helpful in understanding why the request
had no possible solution

--
Roberto

On Tue, Jan 28, 2014 at 08:59:41AM -0500, Ashish Agarwal wrote:
> Yes, it prints out a long list of what constraints needed to be satisfied but
> couldn't be. Okay, I was just wondering this for a related question on the Core
> mailing list, which Anil suggested might be solved by using aspcud. It's
> already confirmed that the particular solver didn't help that issue, which
> would also have been clear if I knew that "Your request cannot be satisfied"
> means "provably cannot be satisfied". I'm not suggesting a wording change. I
> think it's fine.
> 
> 
> On Tue, Jan 28, 2014 at 8:45 AM, Thomas Gazagnaire <thomas at gazagnaire.org>
> wrote:
> 
>     > `opam install` says "Your request cannot be satisfied." What exactly does
>     that mean? Has the solver proven that the constraints definitively cannot
>     be satisfied or is there still a possible solution?
> 
>     What else does it prints ? A conflict list ? Yes, it ought to means "there
>     is no solution satisfying the request", but it's possible than the wording
>     is not precise enough.
>    
>     Thomas
> 
> 
> 

> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


-- 
Roberto Di Cosmo
 
------------------------------------------------------------------
Professeur               En delegation a l'INRIA
PPS                      E-mail: roberto at dicosmo.org
Universite Paris Diderot WWW  : http://www.dicosmo.org
Case 7014                Tel  : ++33-(0)1-57 27 92 20
5, Rue Thomas Mann       
F-75205 Paris Cedex 13   Identica: http://identi.ca/rdicosmo
FRANCE.                  Twitter: http://twitter.com/rdicosmo
------------------------------------------------------------------
Attachments:
MIME accepted, Word deprecated
      http://www.gnu.org/philosophy/no-word-attachments.html
------------------------------------------------------------------
Office location:
 
Bureau 3020 (3rd floor)
Batiment Sophie Germain
Avenue de France
Metro Bibliotheque Francois Mitterrand, ligne 14/RER C
-----------------------------------------------------------------
GPG fingerprint 2931 20CE 3A5A 5390 98EC 8BFC FCCA C3BE 39CB 12D3                        

From louis.gesbert at ocamlpro.com  Wed Jan 29 15:36:52 2014
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 29 Jan 2014 16:36:52 +0100
Subject: [opam-devel] OPAM 1.1.1 Released !
Message-ID: <2402300.iHojb7qSok@agaric>

We are glad to announce that OPAM 1.1.1 has just been released.
https://github.com/ocaml/opam/releases/tag/1.1.1


The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES

Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.

This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.

Thanks to all who contributed to this :)

Louis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140129/dade966f/attachment.html>

From anil at recoil.org  Thu Jan 30 11:03:22 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 30 Jan 2014 11:03:22 +0000
Subject: [opam-devel] [ocaml-platform] OPAM 1.1.1 Released !
In-Reply-To: <2402300.iHojb7qSok@agaric>
References: <2402300.iHojb7qSok@agaric>
Message-ID: <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>

Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
(with aspcud as recommended)

Ubuntu packages building in my unstable PPA:
https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.

CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.

Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture binaries more easily.  It would be great to submit OPAM into Fedora as well.


-anil

On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:

> We are glad to announce that OPAM 1.1.1 has just been released.
> https://github.com/ocaml/opam/releases/tag/1.1.1
>  
>  
> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>  
> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>  
> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>  
> Thanks to all who contributed to this :)
>  
> Louis
> _______________________________________________
> Platform mailing list
> Platform at lists.ocaml.org
> http://lists.ocaml.org/listinfo/platform


From anil at recoil.org  Thu Jan 30 14:45:44 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 30 Jan 2014 14:45:44 +0000
Subject: [opam-devel] [ocaml-platform] OPAM 1.1.1 Released !
In-Reply-To: <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
Message-ID: <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>

There appears to be some regression due to ocp-build. All the builds have failed due to :

cat ocp-build.run ocp-build.boot > ocp-build
chmod +x ocp-build
./ocp-build -help >/dev/null 2>&1
make[1]: *** [ocp-build] Error 2
make: *** [ocp-build/ocp-build] Error 2


See:
http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
(MacOS X)

or 
https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
(ubuntu)

Louis, could you help here? I won't have time to look at this until tomorrow morning probably.

-anil

On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:

> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
> (with aspcud as recommended)
> 
> Ubuntu packages building in my unstable PPA:
> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
> I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.
> 
> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
> 
> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture binaries more easily.  It would be great to submit OPAM into Fedora as well.
> 
> 
> -anil
> 
> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
>> We are glad to announce that OPAM 1.1.1 has just been released.
>> https://github.com/ocaml/opam/releases/tag/1.1.1
>> 
>> 
>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>> 
>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>> 
>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>> 
>> Thanks to all who contributed to this :)
>> 
>> Louis
>> _______________________________________________
>> Platform mailing list
>> Platform at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/platform
> 
> _______________________________________________
> Platform mailing list
> Platform at lists.ocaml.org
> http://lists.ocaml.org/listinfo/platform
> 


From Fabrice.Le_fessant at inria.fr  Thu Jan 30 14:55:30 2014
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Thu, 30 Jan 2014 15:55:30 +0100
Subject: [opam-devel] [ocaml-platform] OPAM 1.1.1 Released !
In-Reply-To: <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
 <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>
Message-ID: <CAHvkLrMVRc=6+LzWHB+VdH28K+yXCJ-OGfXMWopOb8hu5Owo8g@mail.gmail.com>

Weird, I could compile opam-1.1.1 with both OCaml 4.01.0 and OCaml
3.12.1 on my Ubuntu. Any specific patch applied there on OCaml that
could explain this problem ?

By the way, you should also probably change

./ocp-build -help >/dev/null 2>&1

to

./ocp-build -help >log.txt 2>&1

to get some feedback when something gets wrong.

--Fabrice


On Thu, Jan 30, 2014 at 3:45 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
> There appears to be some regression due to ocp-build. All the builds have failed due to :
>
> cat ocp-build.run ocp-build.boot > ocp-build
> chmod +x ocp-build
> ./ocp-build -help >/dev/null 2>&1
> make[1]: *** [ocp-build] Error 2
> make: *** [ocp-build/ocp-build] Error 2
>
>
> See:
> http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
> (MacOS X)
>
> or
> https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
> (ubuntu)
>
> Louis, could you help here? I won't have time to look at this until tomorrow morning probably.
>
> -anil
>
> On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:
>
>> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
>> (with aspcud as recommended)
>>
>> Ubuntu packages building in my unstable PPA:
>> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
>> I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.
>>
>> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
>>
>> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture binaries more easily.  It would be great to submit OPAM into Fedora as well.
>>
>>
>> -anil
>>
>> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>>
>>> We are glad to announce that OPAM 1.1.1 has just been released.
>>> https://github.com/ocaml/opam/releases/tag/1.1.1
>>>
>>>
>>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>>>
>>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>>>
>>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>>>
>>> Thanks to all who contributed to this :)
>>>
>>> Louis
>>> _______________________________________________
>>> Platform mailing list
>>> Platform at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/platform
>>
>> _______________________________________________
>> Platform mailing list
>> Platform at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/platform
>>
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel



-- 
Fabrice LE FESSANT
Chercheur en Informatique
INRIA Paris Rocquencourt -- OCamlPro
Programming Languages and Distributed Systems

From anil at recoil.org  Thu Jan 30 14:57:51 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 30 Jan 2014 14:57:51 +0000
Subject: [opam-devel] [ocaml-platform] OPAM 1.1.1 Released !
In-Reply-To: <CAHvkLrMVRc=6+LzWHB+VdH28K+yXCJ-OGfXMWopOb8hu5Owo8g@mail.gmail.com>
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
 <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>
 <CAHvkLrMVRc=6+LzWHB+VdH28K+yXCJ-OGfXMWopOb8hu5Owo8g@mail.gmail.com>
Message-ID: <90351454-C7E8-420A-97DC-A6D1327878F6@recoil.org>

The Debian/Ubuntu/FreeBSD distribution packages are generally patched with
the ocamlbuild patches to avoid depending on the ocp-build binary blob.

The Homebrew packages use ocp-build, but also exhibit this failure.

I really dislike the use of two build systems in OPAM; it makes maintaining
the distro packages an unnecessary chore.  Mehdi has observed the same in
the past. 

-anil

On 30 Jan 2014, at 14:55, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:

> Weird, I could compile opam-1.1.1 with both OCaml 4.01.0 and OCaml
> 3.12.1 on my Ubuntu. Any specific patch applied there on OCaml that
> could explain this problem ?
> 
> By the way, you should also probably change
> 
> ./ocp-build -help >/dev/null 2>&1
> 
> to
> 
> ./ocp-build -help >log.txt 2>&1
> 
> to get some feedback when something gets wrong.
> 
> --Fabrice
> 
> 
> On Thu, Jan 30, 2014 at 3:45 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>> There appears to be some regression due to ocp-build. All the builds have failed due to :
>> 
>> cat ocp-build.run ocp-build.boot > ocp-build
>> chmod +x ocp-build
>> ./ocp-build -help >/dev/null 2>&1
>> make[1]: *** [ocp-build] Error 2
>> make: *** [ocp-build/ocp-build] Error 2
>> 
>> 
>> See:
>> http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
>> (MacOS X)
>> 
>> or
>> https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
>> (ubuntu)
>> 
>> Louis, could you help here? I won't have time to look at this until tomorrow morning probably.
>> 
>> -anil
>> 
>> On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:
>> 
>>> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
>>> (with aspcud as recommended)
>>> 
>>> Ubuntu packages building in my unstable PPA:
>>> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
>>> I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.
>>> 
>>> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
>>> 
>>> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture binaries more easily.  It would be great to submit OPAM into Fedora as well.
>>> 
>>> 
>>> -anil
>>> 
>>> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>>> 
>>>> We are glad to announce that OPAM 1.1.1 has just been released.
>>>> https://github.com/ocaml/opam/releases/tag/1.1.1
>>>> 
>>>> 
>>>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>>>> 
>>>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>>>> 
>>>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>>>> 
>>>> Thanks to all who contributed to this :)
>>>> 
>>>> Louis
>>>> _______________________________________________
>>>> Platform mailing list
>>>> Platform at lists.ocaml.org
>>>> http://lists.ocaml.org/listinfo/platform
>>> 
>>> _______________________________________________
>>> Platform mailing list
>>> Platform at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/platform
>>> 
>> 
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
> 
> 
> 
> -- 
> Fabrice LE FESSANT
> Chercheur en Informatique
> INRIA Paris Rocquencourt -- OCamlPro
> Programming Languages and Distributed Systems
> 


From mmatalka at gmail.com  Thu Jan 30 16:20:50 2014
From: mmatalka at gmail.com (Malcolm Matalka)
Date: Thu, 30 Jan 2014 16:20:50 +0000
Subject: [opam-devel] [ocaml-platform] OPAM 1.1.1 Released !
In-Reply-To: <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org> (Anil
 Madhavapeddy's message of "Thu, 30 Jan 2014 14:45:44 +0000")
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
 <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org>
Message-ID: <878utxv3tp.fsf@gmail.com>

Probably this:

https://github.com/ocaml/opam/issues/1038

Anil Madhavapeddy <anil at recoil.org> writes:

> There appears to be some regression due to ocp-build. All the builds have failed due to :
>
> cat ocp-build.run ocp-build.boot > ocp-build
> chmod +x ocp-build
> ./ocp-build -help >/dev/null 2>&1
> make[1]: *** [ocp-build] Error 2
> make: *** [ocp-build/ocp-build] Error 2
>
>
> See:
> http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
> (MacOS X)
>
> or 
> https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
> (ubuntu)
>
> Louis, could you help here? I won't have time to look at this until tomorrow morning probably.
>
> -anil
>
> On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:
>
>> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
>> (with aspcud as recommended)
>> 
>> Ubuntu packages building in my unstable PPA:
>> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
>> I've made one change to the packaging here by adding 'aspcud' to the recommended list.  I'll mail the OCaml list when I put these live in the stable PPA.
>> 
>> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
>> 
>> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture
>> binaries more easily.  It would be great to submit OPAM into Fedora as well.
>> 
>> 
>> -anil
>> 
>> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>> 
>>> We are glad to announce that OPAM 1.1.1 has just been released.
>>> https://github.com/ocaml/opam/releases/tag/1.1.1
>>> 
>>> 
>>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>>> 
>>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation
>>> on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>>> 
>>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>>> 
>>> Thanks to all who contributed to this :)
>>> 
>>> Louis
>>> _______________________________________________
>>> Platform mailing list
>>> Platform at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/platform
>> 
>> _______________________________________________
>> Platform mailing list
>> Platform at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/platform
>> 
>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

From anil at recoil.org  Thu Jan 30 16:30:02 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 30 Jan 2014 16:30:02 +0000
Subject: [opam-devel] [ocaml-platform] OPAM 1.1.1 Released !
In-Reply-To: <878utxv3tp.fsf@gmail.com>
References: <2402300.iHojb7qSok@agaric>
 <16AD65D7-9B29-41F2-A6A4-A3F4B7256F9E@recoil.org>
 <44BE132F-4338-4D4D-9455-2CCE1E11A5D1@recoil.org> <878utxv3tp.fsf@gmail.com>
Message-ID: <D6DED056-E8F2-4545-9BD1-FA46F2A5649E@recoil.org>

Spot on! I've pushed a quick fix to Homebrew to test it against the buildbot.

-anil

On 30 Jan 2014, at 16:20, Malcolm Matalka <mmatalka at gmail.com> wrote:

> Probably this:
> 
> https://github.com/ocaml/opam/issues/1038
> 
> Anil Madhavapeddy <anil at recoil.org> writes:
> 
>> There appears to be some regression due to ocp-build. All the builds have failed due to :
>> 
>> cat ocp-build.run ocp-build.boot > ocp-build
>> chmod +x ocp-build
>> ./ocp-build -help >/dev/null 2>&1
>> make[1]: *** [ocp-build] Error 2
>> make: *** [ocp-build/ocp-build] Error 2
>> 
>> 
>> See:
>> http://bot.brew.sh/job/Homebrew%20Pull%20Requests/6880/version=mavericks/testReport/junit/brew-test-bot/mavericks/install_opam/
>> (MacOS X)
>> 
>> or 
>> https://launchpadlibrarian.net/164341246/buildlog_ubuntu-saucy-amd64.opam_1.1.1-3ppa1~saucy_FAILEDTOBUILD.txt.gz
>> (ubuntu)
>> 
>> Louis, could you help here? I won't have time to look at this until tomorrow morning probably.
>> 
>> -anil
>> 
>> On 30 Jan 2014, at 11:03, Anil Madhavapeddy <anil at recoil.org> wrote:
>> 
>>> Homebrew pull: https://github.com/Homebrew/homebrew/pull/26282
>>> (with aspcud as recommended)
>>> 
>>> Ubuntu packages building in my unstable PPA:
>>> https://launchpad.net/~avsm/+archive/ppa-opam-unstable/+packages
>>> I've made one change to the packaging here by adding 'aspcud' to the recommended list. I'll mail the OCaml list when I put these live in the stable PPA.
>>> 
>>> CCing Mehdi so he can upload a proper 1.1.1 to Debian when he gets a chance.
>>> 
>>> Any volunteers to get an RPM version of OPAM building?  We can hook that into the SUSE Open Build service to get a lot of architecture
>>> binaries more easily.  It would be great to submit OPAM into Fedora as well.
>>> 
>>> 
>>> -anil
>>> 
>>> On 29 Jan 2014, at 15:36, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
>>> 
>>>> We are glad to announce that OPAM 1.1.1 has just been released.
>>>> https://github.com/ocaml/opam/releases/tag/1.1.1
>>>> 
>>>> 
>>>> The full changelog is available here: https://raw.github.com/ocaml/opam/1.1.1/CHANGES
>>>> 
>>>> Most notable changes since the first RC include a fix for the weird update-messages bug (#1030), a more accurate trigger of recompilation
>>>> on upstream package changes, and ongoing efforts to have the external solver work across platforms.
>>>> 
>>>> This is going to be announced on the caml-list very shortly, once we get the binaries available for the most common platforms.
>>>> 
>>>> Thanks to all who contributed to this :)
>>>> 
>>>> Louis
>>>> _______________________________________________
>>>> Platform mailing list
>>>> Platform at lists.ocaml.org
>>>> http://lists.ocaml.org/listinfo/platform
>>> 
>>> _______________________________________________
>>> Platform mailing list
>>> Platform at lists.ocaml.org
>>> http://lists.ocaml.org/listinfo/platform
>>> 
>> 
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel


From nicolas at braud-santoni.eu  Thu Jan 30 17:16:47 2014
From: nicolas at braud-santoni.eu (Nicolas Braud-Santoni)
Date: Thu, 30 Jan 2014 18:16:47 +0100
Subject: [opam-devel] OPAM 1.1.1 Released !
In-Reply-To: <2402300.iHojb7qSok@agaric>
References: <2402300.iHojb7qSok@agaric>
Message-ID: <52EA88FF.2010704@braud-santoni.eu>

On 29/01/2014 16:36, Louis Gesbert wrote:
> We are glad to announce that OPAM 1.1.1 has just been released.
> 
> https://github.com/ocaml/opam/releases/tag/1.1.1

Great !

I upgraded the Exherbo package; see [0] for trivial commit.

Regarding external solvers, I have yet to package those.

Another todo is extracting the dependencies (under src_ext/) to allow
building OPAM against the versions installed system-wide.
Is this actually supported by the build-system?
(I might have already asked, but completely forgot)

Regards,
Nicolas


[0]
https://github.com/Exherbo/ocaml-unofficial/commit/9e8f05d198325bf9eecd496d6ab5ceef5ee60d37

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 836 bytes
Desc: OpenPGP digital signature
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140130/5952f080/attachment-0001.sig>

From gesbert at antislash.info  Thu Jan 30 17:46:07 2014
From: gesbert at antislash.info (Louis Gesbert)
Date: Thu, 30 Jan 2014 18:46:07 +0100
Subject: [opam-devel] OPAM 1.1.1 Released !
In-Reply-To: <52EA88FF.2010704@braud-santoni.eu>
References: <2402300.iHojb7qSok@agaric> <52EA88FF.2010704@braud-santoni.eu>
Message-ID: <2191250.eaGaIBeOAZ@agaric>

Le jeudi 30 janvier 2014, 18:16:47 Nicolas Braud-Santoni a ?crit :
> On 29/01/2014 16:36, Louis Gesbert wrote:
> > We are glad to announce that OPAM 1.1.1 has just been released.
> > 
> > https://github.com/ocaml/opam/releases/tag/1.1.1
> 
> Great !
> 
> I upgraded the Exherbo package; see [0] for trivial commit.
> 
> Regarding external solvers, I have yet to package those.
> 
> Another todo is extracting the dependencies (under src_ext/) to allow
> building OPAM against the versions installed system-wide.
> Is this actually supported by the build-system?
> (I might have already asked, but completely forgot)
> 

Yes ! Just run
  make prepare
  make compile


> Regards,
> Nicolas
> 
> 
> [0]
> https://github.com/Exherbo/ocaml-unofficial/commit/9e8f05d198325bf9eecd496d6ab5ceef5ee60d37
> 


From roberto at dicosmo.org  Fri Jan 31 17:28:11 2014
From: roberto at dicosmo.org (Roberto Di Cosmo)
Date: Fri, 31 Jan 2014 18:28:11 +0100
Subject: [opam-devel] How to manage a package manager (Was: Re: [opam] Build
 clarification (#1149))
In-Reply-To: <ocaml/opam/pull/1149/c33806879@github.com>
References: <ocaml/opam/pull/1149@github.com>
 <ocaml/opam/pull/1149/c33806879@github.com>
Message-ID: <20140131172811.GA32459@voyager>

[I am moving this discussion away from the BTS and into
 the mailing list, as the issues raised here are of
 general relevance for the future of Opam, and must
 not be lost in the middle of other comments; see
 https://github.com/ocaml/opam/pull/1149 for the original
 discussion
--
Roberto
]

The original issue: what build system should we use to build opam?
Should we cook up an ad-hoc Makefile, use a patched ocamlbuild,
or use OCamlMakefile, or use ocp-build? Is it evil to embark
a build system in the package manager source code?

My quick view of these issues: 

 1) choice of the build system

     we are already plagued with multiple build systems, and one of the reason
     of opam's success is that it allows every package author the freedom to use
     the one he/she prefers/ is more comfortable with.
     Opam is no exception, and opam developers must be able to pick the build system
     they prefer, so I would say, it's their decision to make

 2) embarking a full build system into the source tree of a package

     in general I would find this a very bad idea: one should have a separate
     package for the build system, and have it installed before building anything else.

     Now, what sets opam apart from other OCaml components is the fact that it is
     the *basic* building block for all the other packages in the repository, and
     without a running opam, there is no way to install any other package; this
     is a bootstrap issue, and that's why, for example, opam embarks in src_ext
     the full source of the dose and libcudf libraries, instead of linking to
     the packages for dose and libcudf (that do exist in the repository); so
     in this particular case *only* I personally would not be shocked to see
     some extra stuff in the src_ext directory (especially considering that
     all this will need to work on multiple platforms)

  3) how do we update opam?

     Now, for another important issue, related to the special status of opam
     as *the* package manager, and how we should manage it (hence the title
     of this message).

     I am a bit unhappy with the current state of affairs, where new
     versions of opam appear with incompatible changes in the repository format,
     hence different versions of the repositories: people using old versions
     of opam get lost in a limbo-like repository with non updated packages
     until they realise they need to recompile a new version of opam
     to see the light again.

     We need to find a way to have opam become a package like the others
     (with the exception of the embarked code for bootstrapping reasons),
     and have it become part of opam-repository... the main difficulty
     lies in the fact that its binaries need to go in special places,
     and not in the 4.00/3.12 etc. dirs (correct if I'm wrong)

     Once this is done, a sensible upgrade path would be:

     Time T : I have opam version n installed, accessing repo version n

     Time T+delta: some major changes make the old opam unable to use the new
                repository format, and the repository migrates to a new place;
                a new version n+1 of opam is released, embedding logic to access
                the new repository;
                opam version n+1 is added also to repo version n

     Sometimes later: the user of opam n runs an update, sees that a new
                      version of opam is available, and upgrades it...
                      he now has the new opam, that updates the references
                      to the new repository, and keeps following the evolution
                      of the repository, with no pain
  
      I know that maybe at some point the repo format will stabilise, but this
      simple process will make sure that the lambda-users (private joke: that's
      equivalent to "jow of the street" in french, but also hints at functional
      programmers :-)) will not get lost, no matter the changes.
  
      Any chances to see this happen soon? A starting point would be to summarize
      on this list the difficulties that prevent opam from being a "normal"
      package

Cheers

--
Roberto

From agarwal1975 at gmail.com  Fri Jan 31 18:14:45 2014
From: agarwal1975 at gmail.com (Ashish Agarwal)
Date: Fri, 31 Jan 2014 13:14:45 -0500
Subject: [opam-devel] How to manage a package manager (Was: Re: [opam]
 Build clarification (#1149))
In-Reply-To: <20140131172811.GA32459@voyager>
References: <ocaml/opam/pull/1149@github.com>
 <ocaml/opam/pull/1149/c33806879@github.com>
 <20140131172811.GA32459@voyager>
Message-ID: <CAMu2m2K0Rg-Hg7afA6rxqKB+MK3T4KS9rW1Wf4HKVq3WKW_0pA@mail.gmail.com>

Another possible solution is to have the repository format include its
version number somewhere. Then make opam always check the version number
and give a useful message if it doesn't know how to deal with the repo
version. The message is "sorry, if you want to use opam.ocaml.org (or
whichever repo it is), then you have to upgrade opam".

This doesn't provide as smooth of an upgrade path as your proposal, but it
seems easier to implement. Automatically updating opam and updating the
repos a user has configured is likely to be buggy. Also, it is possible
that a single version of opam can work with multiple repo versions.

In all cases, it should be considered that https://opam.ocaml.org must
remain the main repo URL. It is the nice URL and we don't want to have the
next repo be at https://opam2.ocaml.org.




On Fri, Jan 31, 2014 at 12:28 PM, Roberto Di Cosmo <roberto at dicosmo.org>wrote:

> [I am moving this discussion away from the BTS and into
>  the mailing list, as the issues raised here are of
>  general relevance for the future of Opam, and must
>  not be lost in the middle of other comments; see
>  https://github.com/ocaml/opam/pull/1149 for the original
>  discussion
> --
> Roberto
> ]
>
> The original issue: what build system should we use to build opam?
> Should we cook up an ad-hoc Makefile, use a patched ocamlbuild,
> or use OCamlMakefile, or use ocp-build? Is it evil to embark
> a build system in the package manager source code?
>
> My quick view of these issues:
>
>  1) choice of the build system
>
>      we are already plagued with multiple build systems, and one of the
> reason
>      of opam's success is that it allows every package author the freedom
> to use
>      the one he/she prefers/ is more comfortable with.
>      Opam is no exception, and opam developers must be able to pick the
> build system
>      they prefer, so I would say, it's their decision to make
>
>  2) embarking a full build system into the source tree of a package
>
>      in general I would find this a very bad idea: one should have a
> separate
>      package for the build system, and have it installed before building
> anything else.
>
>      Now, what sets opam apart from other OCaml components is the fact
> that it is
>      the *basic* building block for all the other packages in the
> repository, and
>      without a running opam, there is no way to install any other package;
> this
>      is a bootstrap issue, and that's why, for example, opam embarks in
> src_ext
>      the full source of the dose and libcudf libraries, instead of linking
> to
>      the packages for dose and libcudf (that do exist in the repository);
> so
>      in this particular case *only* I personally would not be shocked to
> see
>      some extra stuff in the src_ext directory (especially considering that
>      all this will need to work on multiple platforms)
>
>   3) how do we update opam?
>
>      Now, for another important issue, related to the special status of
> opam
>      as *the* package manager, and how we should manage it (hence the title
>      of this message).
>
>      I am a bit unhappy with the current state of affairs, where new
>      versions of opam appear with incompatible changes in the repository
> format,
>      hence different versions of the repositories: people using old
> versions
>      of opam get lost in a limbo-like repository with non updated packages
>      until they realise they need to recompile a new version of opam
>      to see the light again.
>
>      We need to find a way to have opam become a package like the others
>      (with the exception of the embarked code for bootstrapping reasons),
>      and have it become part of opam-repository... the main difficulty
>      lies in the fact that its binaries need to go in special places,
>      and not in the 4.00/3.12 etc. dirs (correct if I'm wrong)
>
>      Once this is done, a sensible upgrade path would be:
>
>      Time T : I have opam version n installed, accessing repo version n
>
>      Time T+delta: some major changes make the old opam unable to use the
> new
>                 repository format, and the repository migrates to a new
> place;
>                 a new version n+1 of opam is released, embedding logic to
> access
>                 the new repository;
>                 opam version n+1 is added also to repo version n
>
>      Sometimes later: the user of opam n runs an update, sees that a new
>                       version of opam is available, and upgrades it...
>                       he now has the new opam, that updates the references
>                       to the new repository, and keeps following the
> evolution
>                       of the repository, with no pain
>
>       I know that maybe at some point the repo format will stabilise, but
> this
>       simple process will make sure that the lambda-users (private joke:
> that's
>       equivalent to "jow of the street" in french, but also hints at
> functional
>       programmers :-)) will not get lost, no matter the changes.
>
>       Any chances to see this happen soon? A starting point would be to
> summarize
>       on this list the difficulties that prevent opam from being a "normal"
>       package
>
> Cheers
>
> --
> Roberto
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20140131/b1e9152e/attachment.html>

From anil at recoil.org  Fri Jan 31 19:54:20 2014
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 31 Jan 2014 19:54:20 +0000
Subject: [opam-devel] How to manage a package manager (Was: Re: [opam]
	Build clarification (#1149))
In-Reply-To: <20140131172811.GA32459@voyager>
References: <ocaml/opam/pull/1149@github.com>
 <ocaml/opam/pull/1149/c33806879@github.com> <20140131172811.GA32459@voyager>
Message-ID: <75F62E44-264B-45E3-B806-58638B6045C1@recoil.org>

On 31 Jan 2014, at 17:28, Roberto Di Cosmo <roberto at dicosmo.org> wrote:

>     I am a bit unhappy with the current state of affairs, where new
>     versions of opam appear with incompatible changes in the repository format,
>     hence different versions of the repositories: people using old versions
>     of opam get lost in a limbo-like repository with non updated packages
>     until they realise they need to recompile a new version of opam
>     to see the light again.

To be clear, the reason for OPAM 1.0 to 1.1 being incompatible was "unplanned".  The original release was too strict with it's parsing, and OPAM 1.1 is now far more lax.

There's also support for the 'repo' file already (in both OPAM 1.0 and 1.1) which allow redirections (as happens with 1.0->1.1).

All-in-all, we're in pretty good shape for upgrades.  Some features such as multiple archive support need some thought, since changing the type of field could be tricky, but it's not impossible to maintain backwards compatibility.

-anil

