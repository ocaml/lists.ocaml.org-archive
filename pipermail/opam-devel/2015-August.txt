From daniel.buenzli at erratique.ch  Sun Aug  2 16:41:16 2015
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Sun, 2 Aug 2015 16:41:16 +0100
Subject: [opam-devel] On the new mixed mode pins
In-Reply-To: <8186A22AEF7E4CEF96ACBE4D5276A4CD@erratique.ch>
References: <8186A22AEF7E4CEF96ACBE4D5276A4CD@erratique.ch>
Message-ID: <9541B826ABFB48EF9C04973F6019290A@erratique.ch>

Le vendredi, 15 mai 2015 ? 22:10, Daniel B?nzli a ?crit :
> Other nightmare scenarios include compilable changes that you would not like to see being picked up ending being catched and installed by opam without you noticing.

FWIW this just happened to me, lost an hour and half banging my head on the table (that may have helped with other things though).

D  



From talex5 at gmail.com  Mon Aug  3 09:37:07 2015
From: talex5 at gmail.com (Thomas Leonard)
Date: Mon, 3 Aug 2015 09:37:07 +0100
Subject: [opam-devel] On the new mixed mode pins
In-Reply-To: <9541B826ABFB48EF9C04973F6019290A@erratique.ch>
References: <8186A22AEF7E4CEF96ACBE4D5276A4CD@erratique.ch>
 <9541B826ABFB48EF9C04973F6019290A@erratique.ch>
Message-ID: <CAG4opy9Ca-sSsDgMmENTtUNvshDEL4KV3DGLv_9a-YU7uaOGBw@mail.gmail.com>

On 2 August 2015 at 16:41, Daniel B?nzli <daniel.buenzli at erratique.ch> wrote:
> Le vendredi, 15 mai 2015 ? 22:10, Daniel B?nzli a ?crit :
>> Other nightmare scenarios include compilable changes that you would not like to see being picked up ending being catched and installed by opam without you noticing.
>
> FWIW this just happened to me, lost an hour and half banging my head on the table (that may have helped with other things though).

How about moving mixed mode to "path" instead of "git" (as I think
someone suggested before)?

i.e.

"git pin -k path ..." (or just "git pin") will use mixed mode if possible
"git pin -k git ..." uses the Git commit, ignoring the working tree


-- 
Dr Thomas Leonard        http://roscidus.com/blog/
GPG: DA98 25AE CAD0 8975 7CDA  BD8E 0713 3F96 CA74 D8BA

From thomas at gazagnaire.org  Mon Aug  3 10:30:07 2015
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Mon, 3 Aug 2015 10:30:07 +0100
Subject: [opam-devel] On the new mixed mode pins
In-Reply-To: <CAG4opy9Ca-sSsDgMmENTtUNvshDEL4KV3DGLv_9a-YU7uaOGBw@mail.gmail.com>
References: <8186A22AEF7E4CEF96ACBE4D5276A4CD@erratique.ch>
 <9541B826ABFB48EF9C04973F6019290A@erratique.ch>
 <CAG4opy9Ca-sSsDgMmENTtUNvshDEL4KV3DGLv_9a-YU7uaOGBw@mail.gmail.com>
Message-ID: <0EC5E6C4-9466-42FD-A340-849E752B804F@gazagnaire.org>

>> FWIW this just happened to me, lost an hour and half banging my head on the table (that may have helped with other things though).
> 
> How about moving mixed mode to "path" instead of "git" (as I think
> someone suggested before)?
> 
> i.e.
> 
> "git pin -k path ..." (or just "git pin") will use mixed mode if possible
> "git pin -k git ..." uses the Git commit, ignoring the working tree

To avoid ambiguity: `git pin -k mixed` maybe? 


From daniel.buenzli at erratique.ch  Mon Aug  3 10:44:35 2015
From: daniel.buenzli at erratique.ch (=?utf-8?Q?Daniel_B=C3=BCnzli?=)
Date: Mon, 3 Aug 2015 10:44:35 +0100
Subject: [opam-devel] On the new mixed mode pins
In-Reply-To: <CAG4opy9Ca-sSsDgMmENTtUNvshDEL4KV3DGLv_9a-YU7uaOGBw@mail.gmail.com>
References: <8186A22AEF7E4CEF96ACBE4D5276A4CD@erratique.ch>
 <9541B826ABFB48EF9C04973F6019290A@erratique.ch>
 <CAG4opy9Ca-sSsDgMmENTtUNvshDEL4KV3DGLv_9a-YU7uaOGBw@mail.gmail.com>
Message-ID: <65BA8DD886EF4BA5B877C1432ACE107F@erratique.ch>

Le lundi, 3 ao?t 2015 ? 09:37, Thomas Leonard a ?crit :
> How about moving mixed mode to "path" instead of "git" (as I think
> someone suggested before)?

How about killing it altogether ? mixed-mode is confusing as is at the moment the semantics of the whole pin-system. I updated https://github.com/ocaml/opam/issues/2156 with a summary of the previous discussion to make it more clear what I think is needed.

Best,

Daniel




From talex5 at gmail.com  Mon Aug  3 10:45:03 2015
From: talex5 at gmail.com (Thomas Leonard)
Date: Mon, 3 Aug 2015 10:45:03 +0100
Subject: [opam-devel] On the new mixed mode pins
In-Reply-To: <0EC5E6C4-9466-42FD-A340-849E752B804F@gazagnaire.org>
References: <8186A22AEF7E4CEF96ACBE4D5276A4CD@erratique.ch>
 <9541B826ABFB48EF9C04973F6019290A@erratique.ch>
 <CAG4opy9Ca-sSsDgMmENTtUNvshDEL4KV3DGLv_9a-YU7uaOGBw@mail.gmail.com>
 <0EC5E6C4-9466-42FD-A340-849E752B804F@gazagnaire.org>
Message-ID: <CAG4opy9GsYQjtye4pm-ucBJDDU9FV+WPUus=8Psam5w4_rVrDA@mail.gmail.com>

On 3 August 2015 at 10:30, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
>>> FWIW this just happened to me, lost an hour and half banging my head on the table (that may have helped with other things though).
>>
>> How about moving mixed mode to "path" instead of "git" (as I think
>> someone suggested before)?
>>
>> i.e.
>>
>> "git pin -k path ..." (or just "git pin") will use mixed mode if possible
>> "git pin -k git ..." uses the Git commit, ignoring the working tree
>
> To avoid ambiguity: `git pin -k mixed` maybe?

I think it should either be the default, or "-k path" should be
required for a non-mixed path pin. Plain path pins are almost never
what you want, due to stale oasis files getting reused (hit this
myself just this morning, where I'd forgotten the "-k git" again).


-- 
Dr Thomas Leonard        http://roscidus.com/blog/
GPG: DA98 25AE CAD0 8975 7CDA  BD8E 0713 3F96 CA74 D8BA

From louis.gesbert at ocamlpro.com  Mon Aug  3 10:45:13 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Mon, 03 Aug 2015 18:45:13 +0900
Subject: [opam-devel] On the new mixed mode pins
In-Reply-To: <0EC5E6C4-9466-42FD-A340-849E752B804F@gazagnaire.org>
References: <8186A22AEF7E4CEF96ACBE4D5276A4CD@erratique.ch>
 <CAG4opy9Ca-sSsDgMmENTtUNvshDEL4KV3DGLv_9a-YU7uaOGBw@mail.gmail.com>
 <0EC5E6C4-9466-42FD-A340-849E752B804F@gazagnaire.org>
Message-ID: <10580858.eCXKnvD6MS@agaric>

I'd prefer to implement Daniel's proposition, when I get the time, if everyone agrees, that do another temporary change that would add more confusion.

> - Thomas Gazagnaire, 03/08/2015 10:30 -
> >> FWIW this just happened to me, lost an hour and half banging my head on the table (that may have helped with other things though).
> > 
> > How about moving mixed mode to "path" instead of "git" (as I think
> > someone suggested before)?
> > 
> > i.e.
> > 
> > "git pin -k path ..." (or just "git pin") will use mixed mode if possible
> > "git pin -k git ..." uses the Git commit, ignoring the working tree

Then it wouldn't be possible to ask for pure path pinning to a version-controlled directory anymore.

> 
> To avoid ambiguity: `git pin -k mixed` maybe? 
> 

we could have a hack: (mixed => auto, and allow mixed mode | git => implicitely add #HEAD | other vcs => ...)

But as I said above, I prefer to focus on a real improvement in the middle term.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: This is a digitally signed message part.
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20150803/a9f7e50c/attachment.sig>

From anil at recoil.org  Mon Aug  3 14:31:34 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Mon, 3 Aug 2015 14:31:34 +0100
Subject: [opam-devel] updating the ocaml ppa to 4.02.3
Message-ID: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>

I've updated the Ubuntu OCaml PPA in the ppa-opam-experimental tree to OCaml 4.02.3, Camlp4 4.02+6 and OPAM 1.2.2 built against this.  I'll be rolling this out to the OCaml 4.02.x branches soon, so Travis will start picking it up by default once that rebuild happens.

This means that we won't have any OCaml 4.02.2 tests, but I think the general plan is to deprecate its use as soon as possible.  Please shout if there are any objections to this.

David, Leo: This build includes the cmt file installation for stdlib, so it should assist automatic building of Codoc.  I notice that the otherlibs/ cmt files aren't installed by default.  Is this intentional?

Anil

From anil at recoil.org  Mon Aug  3 18:58:24 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Mon, 3 Aug 2015 18:58:24 +0100
Subject: [opam-devel] openbsd ocaml 4.02.3 + opam 1.2.2 upgrade
Message-ID: <3597154F-7586-4460-B4C1-155922F6C701@recoil.org>

This rather large ports diff does an update of the OCaml ports to 4.02.3:
http://www.recoil.org/~avsm/openbsd-patches/ocaml-4.02.3.patch.txt

It bumps the REVISION of most of the untouched OCaml ports since binary compat is not preserved across OCaml revisions.

Any tests on non-x86 would be appreciated, especially ARM with native code.

thanks!
Anil

From anil at recoil.org  Wed Aug  5 16:43:27 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 5 Aug 2015 16:43:27 +0100
Subject: [opam-devel] opam publish package name
Message-ID: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>

I notice that "opam publish" doesn't autoinstall the plugin (as occurs with depext).  This is because the OPAM package name is "opam-publish" instead of simply "publish".  Should we rename it, or duplicate the package metadata so that the autoinstallation works?

-anil

From anil at recoil.org  Thu Aug  6 15:52:17 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 6 Aug 2015 15:52:17 +0100
Subject: [opam-devel] freebsd opam port update
Message-ID: <B444C67E-A53F-4EB9-8594-C947BA5B8C51@recoil.org>

Hi Joris,

Would it be possible to modify the FreeBSD OPAM 1.2.2 port's dependencies?

- ocaml-camlp4 should be included by default, since it's necessary for the correct operation of the system compiler.
- aspcud should also be on by default, since it's the recommended solver. The internal one is very buggy.

thanks!
Anil

From anil at recoil.org  Fri Aug  7 11:55:04 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 7 Aug 2015 11:55:04 +0100
Subject: [opam-devel] freebsd opam port update
In-Reply-To: <55C42C2C.903@giovannangeli.fr>
References: <B444C67E-A53F-4EB9-8594-C947BA5B8C51@recoil.org>
 <55C42C2C.903@giovannangeli.fr>
Message-ID: <BA8CD7D5-4F27-4A14-9A98-DA29B6D6509F@recoil.org>

Thanks Joris, much appreciated!  We should be able to hook up FreeBSD
bulk building into the OPAM repository test bots soon.

-anil

> On 7 Aug 2015, at 04:55, Joris Giovannangeli <joris at giovannangeli.fr> wrote:
> 
> Hi Anil,
> 
> thank you for your suggestions, i've submitted a problem report to the
> port tracker :
> https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=202148
> 
> Joris
> 


From mmatalka at gmail.com  Sun Aug  9 12:13:57 2015
From: mmatalka at gmail.com (Malcolm Matalka)
Date: Sun, 09 Aug 2015 11:13:57 +0000
Subject: [opam-devel] opam reinstall behaviour surprisingly different than
	opam remove/install
Message-ID: <86tws8lnnu.fsf@gmail.com>

I did 'opam reinstall package' where 'package' is pinned to a local
checkout.  I made a small change to it then wanted to reinstall to
verify it worked with other libraries.  The behaviour I expected was to
reinstall this package and all of those that depended on it.  Instead I
got the following output:

https://gist.github.com/anonymous/c1ca7d2c2ab2307f66b5

This worked as expected if I did what I assume is the semantic
equivalent and removed/installed.

/Malcolm

From louis.gesbert at ocamlpro.com  Mon Aug 10 07:38:56 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Mon, 10 Aug 2015 15:38:56 +0900
Subject: [opam-devel] opam reinstall behaviour surprisingly different
 than opam remove/install
In-Reply-To: <86tws8lnnu.fsf@gmail.com>
References: <86tws8lnnu.fsf@gmail.com>
Message-ID: <5433735.L62VA8uez1@agaric>

This kind of thing could happen if your original state happened to be inconsistent ; so opam would have tried to "fix" it.

It would help understand if you could give the outputs of:
- opam config report
- opam upgrade --fixup --show
and the cudf files generated by your `reinstall` command with parameter --cudf ?

Best,
Louis


> - Malcolm Matalka, 09/08/2015 11:13 -
> I did 'opam reinstall package' where 'package' is pinned to a local
> checkout.  I made a small change to it then wanted to reinstall to
> verify it worked with other libraries.  The behaviour I expected was to
> reinstall this package and all of those that depended on it.  Instead I
> got the following output:
> 
> https://gist.github.com/anonymous/c1ca7d2c2ab2307f66b5
> 
> This worked as expected if I did what I assume is the semantic
> equivalent and removed/installed.
> 
> /Malcolm
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

From thomas at gazagnaire.org  Mon Aug 10 14:01:51 2015
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Mon, 10 Aug 2015 14:01:51 +0100
Subject: [opam-devel] updating the ocaml ppa to 4.02.3
In-Reply-To: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>
References: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>
Message-ID: <F291B70B-FF63-4531-A179-08753DA9DBF6@gazagnaire.org>

> I've updated the Ubuntu OCaml PPA in the ppa-opam-experimental tree to OCaml 4.02.3, Camlp4 4.02+6 and OPAM 1.2.2 built against this.  I'll be rolling this out to the OCaml 4.02.x branches soon, so Travis will start picking it up by default once that rebuild happens.

I think you forgot to update camlp4 on the ppa, so the Travis CI scripts trying to compile 4.02 are broken:

https://travis-ci.org/mirage/ocaml-git/jobs/74897466

Thomas



> 
> This means that we won't have any OCaml 4.02.2 tests, but I think the general plan is to deprecate its use as soon as possible.  Please shout if there are any objections to this.
> 
> David, Leo: This build includes the cmt file installation for stdlib, so it should assist automatic building of Codoc.  I notice that the otherlibs/ cmt files aren't installed by default.  Is this intentional?
> 
> Anil
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel


From anil at recoil.org  Mon Aug 10 14:06:34 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Mon, 10 Aug 2015 14:06:34 +0100
Subject: [opam-devel] updating the ocaml ppa to 4.02.3
In-Reply-To: <F291B70B-FF63-4531-A179-08753DA9DBF6@gazagnaire.org>
References: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>
 <F291B70B-FF63-4531-A179-08753DA9DBF6@gazagnaire.org>
Message-ID: <014FE076-91F4-4698-928F-C25B7330DC27@recoil.org>

On 10 Aug 2015, at 14:01, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
> 
>> I've updated the Ubuntu OCaml PPA in the ppa-opam-experimental tree to OCaml 4.02.3, Camlp4 4.02+6 and OPAM 1.2.2 built against this.  I'll be rolling this out to the OCaml 4.02.x branches soon, so Travis will start picking it up by default once that rebuild happens.
> 
> I think you forgot to update camlp4 on the ppa, so the Travis CI scripts trying to compile 4.02 are broken:
> 
> https://travis-ci.org/mirage/ocaml-git/jobs/74897466

Not forgotten -- there's no way to do an atomic upgrade of the repositories, and so ocaml, camlp4 and then opam have to be rebuilt in sequence.  Since armhf takes around 2 hours to build, there's some downtime.  I'd been hoping that both versions would be published simultaneously, but apparently not.

OCaml has built, and camlp4 is building now, and OPAM will finish after that, so the OCaml 4.02.x/OPAM 1.2.x PPA should be operational again in a couple of hours.

-anil

From thomas at gazagnaire.org  Mon Aug 10 14:16:48 2015
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Mon, 10 Aug 2015 14:16:48 +0100
Subject: [opam-devel] updating the ocaml ppa to 4.02.3
In-Reply-To: <014FE076-91F4-4698-928F-C25B7330DC27@recoil.org>
References: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>
 <F291B70B-FF63-4531-A179-08753DA9DBF6@gazagnaire.org>
 <014FE076-91F4-4698-928F-C25B7330DC27@recoil.org>
Message-ID: <7C3EC502-AE65-4D39-AE2C-7D8C96282526@gazagnaire.org>

>> 
>> I think you forgot to update camlp4 on the ppa, so the Travis CI scripts trying to compile 4.02 are broken:
>> 
>> https://travis-ci.org/mirage/ocaml-git/jobs/74897466
> 
> Not forgotten -- there's no way to do an atomic upgrade of the repositories, and so ocaml, camlp4 and then opam have to be rebuilt in sequence.  Since armhf takes around 2 hours to build, there's some downtime.  I'd been hoping that both versions would be published simultaneously, but apparently not.
> 
> OCaml has built, and camlp4 is building now, and OPAM will finish after that, so the OCaml 4.02.x/OPAM 1.2.x PPA should be operational again in a couple of hours.

ha ok, thanks for the update. Can you remind me where to look to know when these build will be done?



From anil at recoil.org  Mon Aug 10 15:10:16 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Mon, 10 Aug 2015 15:10:16 +0100
Subject: [opam-devel] updating the ocaml ppa to 4.02.3
In-Reply-To: <7C3EC502-AE65-4D39-AE2C-7D8C96282526@gazagnaire.org>
References: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>
 <F291B70B-FF63-4531-A179-08753DA9DBF6@gazagnaire.org>
 <014FE076-91F4-4698-928F-C25B7330DC27@recoil.org>
 <7C3EC502-AE65-4D39-AE2C-7D8C96282526@gazagnaire.org>
Message-ID: <3358C837-AE93-4A96-980A-38A77FAEDF9B@recoil.org>

On 10 Aug 2015, at 14:16, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
> 
>>> 
>>> I think you forgot to update camlp4 on the ppa, so the Travis CI scripts trying to compile 4.02 are broken:
>>> 
>>> https://travis-ci.org/mirage/ocaml-git/jobs/74897466
>> 
>> Not forgotten -- there's no way to do an atomic upgrade of the repositories, and so ocaml, camlp4 and then opam have to be rebuilt in sequence.  Since armhf takes around 2 hours to build, there's some downtime.  I'd been hoping that both versions would be published simultaneously, but apparently not.
>> 
>> OCaml has built, and camlp4 is building now, and OPAM will finish after that, so the OCaml 4.02.x/OPAM 1.2.x PPA should be operational again in a couple of hours.
> 
> ha ok, thanks for the update. Can you remind me where to look to know when these build will be done?


It's in all the individual repositories in:

https://launchpad.net/~avsm

The one we're specifically waiting for is:

https://launchpad.net/~avsm/+archive/ubuntu/ocaml42+opam12/+packages
(where ARMhf camlp4 is pending publication, at which point we can kick off the OPAM build).

-anil

From thomas at gazagnaire.org  Mon Aug 10 20:53:37 2015
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Mon, 10 Aug 2015 20:53:37 +0100
Subject: [opam-devel] updating the ocaml ppa to 4.02.3
In-Reply-To: <3358C837-AE93-4A96-980A-38A77FAEDF9B@recoil.org>
References: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>
 <F291B70B-FF63-4531-A179-08753DA9DBF6@gazagnaire.org>
 <014FE076-91F4-4698-928F-C25B7330DC27@recoil.org>
 <7C3EC502-AE65-4D39-AE2C-7D8C96282526@gazagnaire.org>
 <3358C837-AE93-4A96-980A-38A77FAEDF9B@recoil.org>
Message-ID: <57327EC2-F905-4A42-8448-2D976CDD9DA0@gazagnaire.org>

So it seems that .travis.yml from ocaml-travisci-skeleton works fine now, but not the scripts in opam-repository:

https://travis-ci.org/ocaml/opam-repository/jobs/74967959


> On 10 Aug 2015, at 15:10, Anil Madhavapeddy <anil at recoil.org> wrote:
> 
> On 10 Aug 2015, at 14:16, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
>> 
>>>> 
>>>> I think you forgot to update camlp4 on the ppa, so the Travis CI scripts trying to compile 4.02 are broken:
>>>> 
>>>> https://travis-ci.org/mirage/ocaml-git/jobs/74897466
>>> 
>>> Not forgotten -- there's no way to do an atomic upgrade of the repositories, and so ocaml, camlp4 and then opam have to be rebuilt in sequence.  Since armhf takes around 2 hours to build, there's some downtime.  I'd been hoping that both versions would be published simultaneously, but apparently not.
>>> 
>>> OCaml has built, and camlp4 is building now, and OPAM will finish after that, so the OCaml 4.02.x/OPAM 1.2.x PPA should be operational again in a couple of hours.
>> 
>> ha ok, thanks for the update. Can you remind me where to look to know when these build will be done?
> 
> 
> It's in all the individual repositories in:
> 
> https://launchpad.net/~avsm
> 
> The one we're specifically waiting for is:
> 
> https://launchpad.net/~avsm/+archive/ubuntu/ocaml42+opam12/+packages
> (where ARMhf camlp4 is pending publication, at which point we can kick off the OPAM build).
> 
> -anil


From thomas at gazagnaire.org  Mon Aug 10 22:07:10 2015
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Mon, 10 Aug 2015 22:07:10 +0100
Subject: [opam-devel] updating the ocaml ppa to 4.02.3
In-Reply-To: <57327EC2-F905-4A42-8448-2D976CDD9DA0@gazagnaire.org>
References: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>
 <F291B70B-FF63-4531-A179-08753DA9DBF6@gazagnaire.org>
 <014FE076-91F4-4698-928F-C25B7330DC27@recoil.org>
 <7C3EC502-AE65-4D39-AE2C-7D8C96282526@gazagnaire.org>
 <3358C837-AE93-4A96-980A-38A77FAEDF9B@recoil.org>
 <57327EC2-F905-4A42-8448-2D976CDD9DA0@gazagnaire.org>
Message-ID: <76255F86-91E7-42C7-A8A3-D9625A9AD200@gazagnaire.org>

> So it seems that .travis.yml from ocaml-travisci-skeleton works fine now, but not the scripts in opam-repository:
> 
> https://travis-ci.org/ocaml/opam-repository/jobs/74967959

In order to properly fix this, I've started to merge the scripts we use in opam-repository and the ones in ocaml-travisci-skeleton. See https://github.com/ocaml/ocaml-travisci-skeleton/pull/61

Comments are welcome. 

> 
> 
>> On 10 Aug 2015, at 15:10, Anil Madhavapeddy <anil at recoil.org> wrote:
>> 
>> On 10 Aug 2015, at 14:16, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
>>> 
>>>>> 
>>>>> I think you forgot to update camlp4 on the ppa, so the Travis CI scripts trying to compile 4.02 are broken:
>>>>> 
>>>>> https://travis-ci.org/mirage/ocaml-git/jobs/74897466
>>>> 
>>>> Not forgotten -- there's no way to do an atomic upgrade of the repositories, and so ocaml, camlp4 and then opam have to be rebuilt in sequence.  Since armhf takes around 2 hours to build, there's some downtime.  I'd been hoping that both versions would be published simultaneously, but apparently not.
>>>> 
>>>> OCaml has built, and camlp4 is building now, and OPAM will finish after that, so the OCaml 4.02.x/OPAM 1.2.x PPA should be operational again in a couple of hours.
>>> 
>>> ha ok, thanks for the update. Can you remind me where to look to know when these build will be done?
>> 
>> 
>> It's in all the individual repositories in:
>> 
>> https://launchpad.net/~avsm
>> 
>> The one we're specifically waiting for is:
>> 
>> https://launchpad.net/~avsm/+archive/ubuntu/ocaml42+opam12/+packages
>> (where ARMhf camlp4 is pending publication, at which point we can kick off the OPAM build).
>> 
>> -anil
> 


From thomas at gazagnaire.org  Tue Aug 11 09:40:05 2015
From: thomas at gazagnaire.org (Thomas Gazagnaire)
Date: Tue, 11 Aug 2015 09:40:05 +0100
Subject: [opam-devel] updating the ocaml ppa to 4.02.3
In-Reply-To: <76255F86-91E7-42C7-A8A3-D9625A9AD200@gazagnaire.org>
References: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>
 <F291B70B-FF63-4531-A179-08753DA9DBF6@gazagnaire.org>
 <014FE076-91F4-4698-928F-C25B7330DC27@recoil.org>
 <7C3EC502-AE65-4D39-AE2C-7D8C96282526@gazagnaire.org>
 <3358C837-AE93-4A96-980A-38A77FAEDF9B@recoil.org>
 <57327EC2-F905-4A42-8448-2D976CDD9DA0@gazagnaire.org>
 <76255F86-91E7-42C7-A8A3-D9625A9AD200@gazagnaire.org>
Message-ID: <DFB1A74D-2A6A-4B74-B452-D7FFBD672183@gazagnaire.org>

> 
> In order to properly fix this, I've started to merge the scripts we use in opam-repository and the ones in ocaml-travisci-skeleton. See https://github.com/ocaml/ocaml-travisci-skeleton/pull/61
> 
> Comments are welcome. 

The PR is now merged in ocaml-travisci-skeleton and https://github.com/ocaml/opam-repository/pull/4639 uses it and is all green (including the 4.02.3 runs which were failing before).

Any objection to merge this later today?

Thomas

> 
>> 
>> 
>>> On 10 Aug 2015, at 15:10, Anil Madhavapeddy <anil at recoil.org> wrote:
>>> 
>>> On 10 Aug 2015, at 14:16, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
>>>> 
>>>>>> 
>>>>>> I think you forgot to update camlp4 on the ppa, so the Travis CI scripts trying to compile 4.02 are broken:
>>>>>> 
>>>>>> https://travis-ci.org/mirage/ocaml-git/jobs/74897466
>>>>> 
>>>>> Not forgotten -- there's no way to do an atomic upgrade of the repositories, and so ocaml, camlp4 and then opam have to be rebuilt in sequence.  Since armhf takes around 2 hours to build, there's some downtime.  I'd been hoping that both versions would be published simultaneously, but apparently not.
>>>>> 
>>>>> OCaml has built, and camlp4 is building now, and OPAM will finish after that, so the OCaml 4.02.x/OPAM 1.2.x PPA should be operational again in a couple of hours.
>>>> 
>>>> ha ok, thanks for the update. Can you remind me where to look to know when these build will be done?
>>> 
>>> 
>>> It's in all the individual repositories in:
>>> 
>>> https://launchpad.net/~avsm
>>> 
>>> The one we're specifically waiting for is:
>>> 
>>> https://launchpad.net/~avsm/+archive/ubuntu/ocaml42+opam12/+packages
>>> (where ARMhf camlp4 is pending publication, at which point we can kick off the OPAM build).
>>> 
>>> -anil
>> 
> 


From anil at recoil.org  Tue Aug 11 11:52:22 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 11 Aug 2015 11:52:22 +0100
Subject: [opam-devel] updating the ocaml ppa to 4.02.3
In-Reply-To: <DFB1A74D-2A6A-4B74-B452-D7FFBD672183@gazagnaire.org>
References: <57D124B5-7BAD-4708-80F3-89822834B307@recoil.org>
 <F291B70B-FF63-4531-A179-08753DA9DBF6@gazagnaire.org>
 <014FE076-91F4-4698-928F-C25B7330DC27@recoil.org>
 <7C3EC502-AE65-4D39-AE2C-7D8C96282526@gazagnaire.org>
 <3358C837-AE93-4A96-980A-38A77FAEDF9B@recoil.org>
 <57327EC2-F905-4A42-8448-2D976CDD9DA0@gazagnaire.org>
 <76255F86-91E7-42C7-A8A3-D9625A9AD200@gazagnaire.org>
 <DFB1A74D-2A6A-4B74-B452-D7FFBD672183@gazagnaire.org>
Message-ID: <3AA65EC3-29F5-4806-AF76-355C09A4DF84@recoil.org>

On 11 Aug 2015, at 09:40, Thomas Gazagnaire <thomas at gazagnaire.org> wrote:
> 
>> 
>> In order to properly fix this, I've started to merge the scripts we use in opam-repository and the ones in ocaml-travisci-skeleton. See https://github.com/ocaml/ocaml-travisci-skeleton/pull/61
>> 
>> Comments are welcome. 
> 
> The PR is now merged in ocaml-travisci-skeleton and https://github.com/ocaml/opam-repository/pull/4639 uses it and is all green (including the 4.02.3 runs which were failing before).
> 
> Any objection to merge this later today?

None! I merged it and submitted a consolidated pull request with the outstanding pull requests.

-a


From anil at recoil.org  Fri Aug 14 15:40:57 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Fri, 14 Aug 2015 15:40:57 +0100
Subject: [opam-devel] openbsd ocaml 4.02.3 + opam 1.2.2 upgrade
In-Reply-To: <3597154F-7586-4460-B4C1-155922F6C701@recoil.org>
References: <3597154F-7586-4460-B4C1-155922F6C701@recoil.org>
Message-ID: <EDD6E86D-C09F-49F3-979E-8D46EEBE4153@recoil.org>

On 3 Aug 2015, at 18:58, Anil Madhavapeddy <anil at recoil.org> wrote:
> 
> This rather large ports diff does an update of the OCaml ports to 4.02.3:
> http://www.recoil.org/~avsm/openbsd-patches/ocaml-4.02.3.patch.txt
> 
> It bumps the REVISION of most of the untouched OCaml ports since binary compat is not preserved across OCaml revisions.
> 
> Any tests on non-x86 would be appreciated, especially ARM with native code.

Here's a followup OCaml 4.02.3 patch that is now suitable for wider testing.
I've run it on amd64 and sparc64 and am doing a complete bulk rebuild that isn't
complete yet.

Full patch: http://www.recoil.org/~avsm/openbsd-patches/ocaml-4.02.3-2.patch.txt

Diffstat is fairly large as I took the opportunity to do version upgrade on 
most of the small library ports.  The biggest upgrade is to OPAM 1.2.2, and
using the online solver by default rather than the now-broken internal solver.
Unfortunately, porting Aspcud requires Bison 2.25 or higher in our ports tree;
is anyone working on that for OpenBSD?

This mail should be CCed to all the MAINTAINER folk listed in the various
ports.  Testing on ARM would be appreciated in particular, and i386.

$ diffstat ocaml-4.02.3-2.patch.txt 
 b/databases/ocaml-postgresql/Makefile                             |    4 
 b/databases/ocaml-postgresql/distinfo                             |    4 
 b/databases/ocaml-postgresql/pkg/PFRAG.native                     |    1 
 b/databases/ocaml-postgresql/pkg/PLIST                            |    5 
 b/databases/ocaml-sqlite3/Makefile                                |    5 
 b/databases/ocaml-sqlite3/distinfo                                |    4 
 b/databases/ocaml-sqlite3/pkg/PLIST                               |    4 
 b/devel/coccinelle/Makefile                                       |    2 
 b/devel/cudf/Makefile                                             |    1 
 b/devel/frama-c/Makefile                                          |    5 
 b/devel/frama-c/distinfo                                          |    4 
 b/devel/frama-c/pkg/PFRAG.native                                  |   53 
 b/devel/frama-c/pkg/PLIST                                         |  118 -
 b/devel/ocaml-batteries/Makefile                                  |    3 
 b/devel/ocaml-batteries/distinfo                                  |    4 
 b/devel/ocaml-batteries/pkg/PFRAG.native                          |    1 
 b/devel/ocaml-batteries/pkg/PLIST                                 |   49 
 b/devel/ocaml-bitstring/Makefile                                  |    2 
 b/devel/ocaml-calendar/Makefile                                   |    2 
 b/devel/ocaml-camomile/Makefile                                   |    1 
 b/devel/ocaml-cmdliner/Makefile                                   |    2 
 b/devel/ocaml-cmdliner/distinfo                                   |    4 
 b/devel/ocaml-curses/Makefile                                     |    2 
 b/devel/ocaml-dose/Makefile                                       |    4 
 b/devel/ocaml-dose/distinfo                                       |    4 
 b/devel/ocaml-dose/patches/patch-Makefile                         |   33 
 b/devel/ocaml-dose/patches/patch-algo_defaultgraphs_ml            |   12 
 b/devel/ocaml-dose/patches/patch-algo_depsolver_int_ml            |   12 
 b/devel/ocaml-dose/patches/patch-algo_depsolver_ml                |   69 
 b/devel/ocaml-dose/patches/patch-algo_diagnostic_ml               |   12 
 b/devel/ocaml-dose/patches/patch-algo_dominators_ml               |   12 
 b/devel/ocaml-dose/patches/patch-algo_flatten_ml                  |   12 
 b/devel/ocaml-dose/patches/patch-algo_statistics_ml               |   12 
 b/devel/ocaml-dose/patches/patch-algo_strongconflicts_int_ml      |   12 
 b/devel/ocaml-dose/patches/patch-algo_strongconflicts_ml          |   12 
 b/devel/ocaml-dose/patches/patch-algo_strongdeps_int_ml           |   12 
 b/devel/ocaml-dose/patches/patch-algo_strongdeps_ml               |   12 
 b/devel/ocaml-dose/patches/patch-applications_ceve_ml             |   72 
 b/devel/ocaml-dose/patches/patch-applications_challenged_ml       |   48 
 b/devel/ocaml-dose/patches/patch-applications_deb-buildcheck_ml   |   19 
 b/devel/ocaml-dose/patches/patch-applications_deb-coinstall_ml    |   19 
 b/devel/ocaml-dose/patches/patch-applications_distcheck_ml        |   80 
 b/devel/ocaml-dose/patches/patch-applications_dominators-graph_ml |   12 
 b/devel/ocaml-dose/patches/patch-applications_outdated_ml         |   19 
 b/devel/ocaml-dose/patches/patch-applications_smallworld_ml       |   12 
 b/devel/ocaml-dose/patches/patch-applications_strong-deps_ml      |   12 
 b/devel/ocaml-dose/patches/patch-common_cudfAdd_ml                |   12 
 b/devel/ocaml-dose/patches/patch-common_cudfSolver_ml             |   12 
 b/devel/ocaml-dose/patches/patch-common_edosSolver_ml             |   12 
 b/devel/ocaml-dose/patches/patch-common_input_ml                  |   53 
 b/devel/ocaml-dose/patches/patch-common_input_mli                 |   25 
 b/devel/ocaml-dose/patches/patch-common_url_ml                    |   12 
 b/devel/ocaml-dose/patches/patch-common_util_ml                   |   22 
 b/devel/ocaml-dose/patches/patch-common_util_mli                  |   12 
 b/devel/ocaml-dose/patches/patch-cv_cvcudf_ml                     |   12 
 b/devel/ocaml-dose/patches/patch-deb_apt_ml                       |   12 
 b/devel/ocaml-dose/patches/patch-deb_architecture_ml              |   12 
 b/devel/ocaml-dose/patches/patch-deb_debcudf_ml                   |   12 
 b/devel/ocaml-dose/patches/patch-deb_debutil_ml                   |   12 
 b/devel/ocaml-dose/patches/patch-deb_edsp_ml                      |   12 
 b/devel/ocaml-dose/patches/patch-deb_format822_ml                 |   12 
 b/devel/ocaml-dose/patches/patch-deb_packages_ml                  |   12 
 b/devel/ocaml-dose/patches/patch-deb_sources_ml                   |   12 
 b/devel/ocaml-dose/patches/patch-doseparse_stdDebug_ml            |   12 
 b/devel/ocaml-dose/patches/patch-doseparse_stdLoaders_ml          |   85 
 b/devel/ocaml-dose/patches/patch-doseparse_stdOptions_ml          |   12 
 b/devel/ocaml-dose/patches/patch-doseparse_stdUtils_ml            |   12 
 b/devel/ocaml-dose/patches/patch-eclipse_packages_ml              |   12 
 b/devel/ocaml-dose/patches/patch-eclipse_version_ml               |   12 
 b/devel/ocaml-dose/patches/patch-opencsw_packages_ml              |   21 
 b/devel/ocaml-dose/patches/patch-opencsw_version_ml               |   12 
 b/devel/ocaml-dose/patches/patch-rpm_hdlists_ml                   |   12 
 b/devel/ocaml-dose/patches/patch-rpm_packages_ml                  |   12 
 b/devel/ocaml-dose/patches/patch-rpm_rpmcudf_ml                   |   12 
 b/devel/ocaml-dose/pkg/PFRAG.dynlink-native                       |    6 
 b/devel/ocaml-dose/pkg/PFRAG.native                               |   12 
 b/devel/ocaml-dose/pkg/PLIST                                      |   12 
 b/devel/ocaml-extlib/Makefile                                     |    1 
 b/devel/ocaml-graph/Makefile                                      |    2 
 b/devel/ocaml-graph/pkg/PLIST                                     |    4 
 b/devel/ocaml-jsonm/Makefile                                      |    3 
 b/devel/ocaml-lambda-term/Makefile                                |    4 
 b/devel/ocaml-lambda-term/distinfo                                |    4 
 b/devel/ocaml-lambda-term/pkg/PFRAG.native                        |    6 
 b/devel/ocaml-lambda-term/pkg/PLIST                               |   70 
 b/devel/ocaml-lwt/Makefile                                        |    8 
 b/devel/ocaml-lwt/distinfo                                        |    4 
 b/devel/ocaml-lwt/pkg/PFRAG.dynlink-native                        |    2 
 b/devel/ocaml-lwt/pkg/PFRAG.native                                |   12 
 b/devel/ocaml-lwt/pkg/PLIST                                       |  112 
 b/devel/ocaml-net/Makefile                                        |    3 
 b/devel/ocaml-net/distinfo                                        |    4 
 b/devel/ocaml-net/pkg/PFRAG.native                                |   69 
 b/devel/ocaml-net/pkg/PLIST                                       | 1174 ++++++----
 b/devel/ocaml-pcre/Makefile                                       |    9 
 b/devel/ocaml-pcre/distinfo                                       |    4 
 b/devel/ocaml-pcre/pkg/PFRAG.native                               |    1 
 b/devel/ocaml-pcre/pkg/PLIST                                      |    4 
 b/devel/ocaml-ppx-tools/Makefile                                  |   30 
 b/devel/ocaml-ppx-tools/distinfo                                  |    2 
 b/devel/ocaml-ppx-tools/patches/patch-Makefile                    |   27 
 b/devel/ocaml-ppx-tools/pkg/DESCR                                 |    9 
 b/devel/ocaml-ppx-tools/pkg/PFRAG.dynlink-native                  |    2 
 b/devel/ocaml-ppx-tools/pkg/PFRAG.native                          |    6 
 b/devel/ocaml-ppx-tools/pkg/PLIST                                 |   11 
 b/devel/ocaml-re/Makefile                                         |    3 
 b/devel/ocaml-re/distinfo                                         |    4 
 b/devel/ocaml-re/pkg/PFRAG.native                                 |    4 
 b/devel/ocaml-re/pkg/PLIST                                        |   25 
 b/devel/ocaml-react/Makefile                                      |    1 
 b/devel/ocaml-uutf/Makefile                                       |    2 
 b/devel/ocaml-uutf/distinfo                                       |    4 
 b/devel/ocaml-zed/Makefile                                        |    2 
 b/devel/ocaml-zed/distinfo                                        |    4 
 b/devel/ocaml-zed/pkg/PLIST                                       |   25 
 b/devel/omake/Makefile                                            |    2 
 b/devel/ounit/Makefile                                            |    2 
 b/devel/utop/Makefile                                             |    2 
 b/graphics/ocaml-camlimages/Makefile                              |    7 
 b/graphics/ocaml-camlimages/distinfo                              |    4 
 b/graphics/ocaml-camlimages/pkg/PFRAG.native                      |   63 
 b/graphics/ocaml-camlimages/pkg/PFRAG.shared                      |    3 
 b/graphics/ocaml-camlimages/pkg/PLIST                             |  114 
 b/lang/ocaml-camlp4/Makefile                                      |    8 
 b/lang/ocaml-camlp4/distinfo                                      |    4 
 b/lang/ocaml/Makefile                                             |    5 
 b/lang/ocaml/distinfo                                             |    4 
 b/lang/ocaml/pkg/PFRAG.native-main                                |  147 +
 b/lang/ocaml/pkg/PLIST-main                                       |  290 ++
 b/math/coq/Makefile                                               |    1 
 b/security/ocaml-cryptokit/Makefile                               |    5 
 b/security/ocaml-cryptokit/distinfo                               |    4 
 b/security/ocaml-cryptokit/pkg/PLIST                              |    3 
 b/security/ocaml-ssl/Makefile                                     |    2 
 b/sysutils/findlib/Makefile                                       |    6 
 b/sysutils/findlib/distinfo                                       |    4 
 b/sysutils/findlib/pkg/PLIST                                      |    1 
 b/sysutils/opam/Makefile                                          |   13 
 b/sysutils/opam/distinfo                                          |    4 
 b/sysutils/opam/files/aspcud                                      |    8 
 b/sysutils/opam/pkg/DESCR-main                                    |    6 
 b/sysutils/opam/pkg/PFRAG.native-lib                              |   42 
 b/sysutils/opam/pkg/PLIST-lib                                     |   85 
 b/sysutils/opam/pkg/PLIST-main                                    |   15 
 b/textproc/ocaml-csv/Makefile                                     |    5 
 b/textproc/ocaml-csv/distinfo                                     |    4 
 b/textproc/ocaml-csv/pkg/PLIST                                    |    9 
 b/textproc/ocaml-rss/Makefile                                     |    2 
 b/textproc/ocaml-xml-light/Makefile                               |    2 
 b/textproc/ocaml-xmlm/Makefile                                    |   46 
 b/textproc/ocaml-xmlm/distinfo                                    |    4 
 b/textproc/ocaml-xmlm/pkg/PFRAG.native                            |    1 
 b/textproc/ocaml-xmlm/pkg/PLIST                                   |   54 
 b/x11/lablgtk2/Makefile                                           |    1 
 devel/frama-c/patches/patch-configure                             |  125 -
 devel/ocaml-batteries/patches/patch-Makefile                      |   16 
 devel/ocaml-batteries/patches/patch-build_prefilter_ml            |   39 
 devel/ocaml-batteries/patches/patch-src_batPrintf_mliv            |  406 ---
 devel/ocaml-batteries/patches/patch-src_batPrintf_mlv             |  531 ----
 devel/ocaml-dose/patches/patch-algo_depsolver_mli                 |   19 
 devel/ocaml-dose/patches/patch-myocamlbuild_ml                    |   20 
 devel/ocaml-lwt/patches/patch-setup_ml                            |   33 
 graphics/ocaml-camlimages/patches/patch-OMakefile                 |   46 
 graphics/ocaml-camlimages/patches/patch-src_gifread_c             |   33 
 graphics/ocaml-camlimages/patches/patch-src_gifwrite_c            |   42 
 graphics/ocaml-camlimages/patches/patch-src_pngread_c             |   64 
 graphics/ocaml-camlimages/patches/patch-src_pngwrite_c            |   24 
 graphics/ocaml-camlimages/patches/patch-src_tiffread_c            |   17 
 graphics/ocaml-camlimages/patches/patch-src_tiffwrite_c           |   21 
 sysutils/findlib/patches/patch-src_findlib_Makefile               |   12 
 textproc/ocaml-xmlm/pkg/PFRAG.no-native                           |    2 


From anil at recoil.org  Sun Aug 16 15:02:37 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Sun, 16 Aug 2015 15:02:37 +0100
Subject: [opam-devel] openbsd ocaml 4.02.3 + opam 1.2.2 upgrade
In-Reply-To: <EDD6E86D-C09F-49F3-979E-8D46EEBE4153@recoil.org>
References: <3597154F-7586-4460-B4C1-155922F6C701@recoil.org>
 <EDD6E86D-C09F-49F3-979E-8D46EEBE4153@recoil.org>
Message-ID: <9E397218-21CA-4F08-9BED-80CAC938969E@recoil.org>

On 14 Aug 2015, at 15:40, Anil Madhavapeddy <anil at recoil.org> wrote:
> 
> On 3 Aug 2015, at 18:58, Anil Madhavapeddy <anil at recoil.org> wrote:
>> 
>> This rather large ports diff does an update of the OCaml ports to 4.02.3:
>> http://www.recoil.org/~avsm/openbsd-patches/ocaml-4.02.3.patch.txt
>> 
>> It bumps the REVISION of most of the untouched OCaml ports since binary compat is not preserved across OCaml revisions.
>> 
>> Any tests on non-x86 would be appreciated, especially ARM with native code.
> 
> Here's a followup OCaml 4.02.3 patch that is now suitable for wider testing.
> I've run it on amd64 and sparc64 and am doing a complete bulk rebuild that isn't
> complete yet.
> 
> Full patch: http://www.recoil.org/~avsm/openbsd-patches/ocaml-4.02.3-2.patch.txt
> 

And here's a third patchset with some fixes thanks to a bulk build by krw
http://recoil.org/~avsm/openbsd-patches/ocaml-4.02.3-3.patch.txt

There's only one known failure now in ocaml-camlimages, and the rest all
builds on sparc64 as well.

-a


From kwesterback at gmail.com  Sun Aug 16 22:48:22 2015
From: kwesterback at gmail.com (Kenneth Westerback)
Date: Sun, 16 Aug 2015 17:48:22 -0400
Subject: [opam-devel] openbsd ocaml 4.02.3 + opam 1.2.2 upgrade
In-Reply-To: <9E397218-21CA-4F08-9BED-80CAC938969E@recoil.org>
References: <3597154F-7586-4460-B4C1-155922F6C701@recoil.org>
 <EDD6E86D-C09F-49F3-979E-8D46EEBE4153@recoil.org>
 <9E397218-21CA-4F08-9BED-80CAC938969E@recoil.org>
Message-ID: <CAM8PUPzCmphZOUHv-WUrF4KVWA17SRp1OH4B_-3R4VKYaZdTQg@mail.gmail.com>

On 16 August 2015 at 10:02, Anil Madhavapeddy <anil at recoil.org> wrote:
> On 14 Aug 2015, at 15:40, Anil Madhavapeddy <anil at recoil.org> wrote:
>>
>> On 3 Aug 2015, at 18:58, Anil Madhavapeddy <anil at recoil.org> wrote:
>>>
>>> This rather large ports diff does an update of the OCaml ports to 4.02.3:
>>> http://www.recoil.org/~avsm/openbsd-patches/ocaml-4.02.3.patch.txt
>>>
>>> It bumps the REVISION of most of the untouched OCaml ports since binary compat is not preserved across OCaml revisions.
>>>
>>> Any tests on non-x86 would be appreciated, especially ARM with native code.
>>
>> Here's a followup OCaml 4.02.3 patch that is now suitable for wider testing.
>> I've run it on amd64 and sparc64 and am doing a complete bulk rebuild that isn't
>> complete yet.
>>
>> Full patch: http://www.recoil.org/~avsm/openbsd-patches/ocaml-4.02.3-2.patch.txt
>>
>
> And here's a third patchset with some fixes thanks to a bulk build by krw
> http://recoil.org/~avsm/openbsd-patches/ocaml-4.02.3-3.patch.txt
>
> There's only one known failure now in ocaml-camlimages, and the rest all
> builds on sparc64 as well.
>
> -a
>

Using this -3 version, the i386 build works except for
ocaml-camlimages, as expected.

.... Ken

From louis.gesbert at ocamlpro.com  Mon Aug 17 02:18:14 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Mon, 17 Aug 2015 10:18:14 +0900
Subject: [opam-devel] opam publish package name
In-Reply-To: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
Message-ID: <3053503.f53RW77G4q@agaric>

Indeed. just 'publish' sounds a bit funny but why not.

opam doesn't support renaming very well. A workflow to have it done transparently to users could be:

- create a new package publish.0.3.1
- create a new empty package opam-publish.0.3.1 that depends on publish.0.3.1
- make publish conflict with earlier opam-publish versions

This way an `opam upgrade` can pick up the name change.

We can also, of course, keep an alias.

> - Anil Madhavapeddy, 05/08/2015 16:43 -
> I notice that "opam publish" doesn't autoinstall the plugin (as occurs with depext).  This is because the OPAM package name is "opam-publish" instead of simply "publish".  Should we rename it, or duplicate the package metadata so that the autoinstallation works?
> 
> -anil
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

From anil at recoil.org  Mon Aug 17 17:34:05 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Mon, 17 Aug 2015 09:34:05 -0700
Subject: [opam-devel] opam publish package name
In-Reply-To: <3053503.f53RW77G4q@agaric>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <3053503.f53RW77G4q@agaric>
Message-ID: <7C6CD674-F1F8-4F2F-A6E9-D5AA2D699247@recoil.org>

Sounds fine to me.  It's too late to enforce the "opam-" prefix in the package name unfortunately.

Do you want to go ahead and make the change for publish so that it works with the plugin mechanism?

-a

> On 16 Aug 2015, at 18:18, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
> Indeed. just 'publish' sounds a bit funny but why not.
> 
> opam doesn't support renaming very well. A workflow to have it done transparently to users could be:
> 
> - create a new package publish.0.3.1
> - create a new empty package opam-publish.0.3.1 that depends on publish.0.3.1
> - make publish conflict with earlier opam-publish versions
> 
> This way an `opam upgrade` can pick up the name change.
> 
> We can also, of course, keep an alias.
> 
>> - Anil Madhavapeddy, 05/08/2015 16:43 -
>> I notice that "opam publish" doesn't autoinstall the plugin (as occurs with depext).  This is because the OPAM package name is "opam-publish" instead of simply "publish".  Should we rename it, or duplicate the package metadata so that the autoinstallation works?
>> 
>> -anil
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
> 


From Fabrice.Le_fessant at inria.fr  Tue Aug 18 14:09:32 2015
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Tue, 18 Aug 2015 15:09:32 +0200
Subject: [opam-devel] opam publish package name
In-Reply-To: <7C6CD674-F1F8-4F2F-A6E9-D5AA2D699247@recoil.org>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <3053503.f53RW77G4q@agaric> <7C6CD674-F1F8-4F2F-A6E9-D5AA2D699247@recoil.org>
Message-ID: <CAHvkLrOjQTQx=iD3yaXrv-yN8BahsM3fW=wSUx9ZEwS=hcBQPg@mail.gmail.com>

On Mon, Aug 17, 2015 at 6:34 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
> Sounds fine to me.  It's too late to enforce the "opam-" prefix in the package name unfortunately.

Why is it too late ? If I understand correctly, when you type "opam
xxx", opam tries to install the "xxx" package if it does not match an
existing command ? We could have a transition period where depext
exists as both opam-depext and depext packages, no ?

From anil at recoil.org  Tue Aug 18 16:50:07 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Tue, 18 Aug 2015 08:50:07 -0700
Subject: [opam-devel] opam publish package name
In-Reply-To: <CAHvkLrOjQTQx=iD3yaXrv-yN8BahsM3fW=wSUx9ZEwS=hcBQPg@mail.gmail.com>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <3053503.f53RW77G4q@agaric> <7C6CD674-F1F8-4F2F-A6E9-D5AA2D699247@recoil.org>
 <CAHvkLrOjQTQx=iD3yaXrv-yN8BahsM3fW=wSUx9ZEwS=hcBQPg@mail.gmail.com>
Message-ID: <98D30DDF-36A8-444E-8F48-19D277E8E829@recoil.org>


> On 18 Aug 2015, at 06:09, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:
> 
> On Mon, Aug 17, 2015 at 6:34 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>> Sounds fine to me.  It's too late to enforce the "opam-" prefix in the package name unfortunately.
> 
> Why is it too late ? If I understand correctly, when you type "opam
> xxx", opam tries to install the "xxx" package if it does not match an
> existing command ? We could have a transition period where depext
> exists as both opam-depext and depext packages, no ?

I meant that it would be cleaner if OPAM's plugin logic had searched for
"opam-foo" rather than "foo" in the first place.  It's odd to have OPAM
packages called "publish" and "depext" instead of "opam-publish" and
"opam-depext", but not the end of the world.  It's too late to change the
logic now since OPAM 1.2.x will be in Ubuntu LTS for some years, and so
the transition period would be several years even if we push OPAM 1.3.0
out of the door in the next month...

-anil


From Fabrice.Le_fessant at inria.fr  Wed Aug 19 10:49:26 2015
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Wed, 19 Aug 2015 11:49:26 +0200
Subject: [opam-devel] opam publish package name
In-Reply-To: <98D30DDF-36A8-444E-8F48-19D277E8E829@recoil.org>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <3053503.f53RW77G4q@agaric> <7C6CD674-F1F8-4F2F-A6E9-D5AA2D699247@recoil.org>
 <CAHvkLrOjQTQx=iD3yaXrv-yN8BahsM3fW=wSUx9ZEwS=hcBQPg@mail.gmail.com>
 <98D30DDF-36A8-444E-8F48-19D277E8E829@recoil.org>
Message-ID: <CAHvkLrOvBAidS07F37eAbE=PSFiga3=K=FOHDfBR+YSv0cmQ+Q@mail.gmail.com>

I think it's worth doing it, even if we also keep the old logic for
compatilibility for a few years from now, until Ubuntu LTS is dead.
Otherwise, we will either have to limit opam plugin names to avoid
conflicts with existing packages (for example, "cache" is already a
package, preventing "opam-cache", etc.), either to reserve names for
possible plugins ("search", "file", "git", etc).

--Fabrice

On Tue, Aug 18, 2015 at 5:50 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>
>> On 18 Aug 2015, at 06:09, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:
>>
>> On Mon, Aug 17, 2015 at 6:34 PM, Anil Madhavapeddy <anil at recoil.org> wrote:
>>> Sounds fine to me.  It's too late to enforce the "opam-" prefix in the package name unfortunately.
>>
>> Why is it too late ? If I understand correctly, when you type "opam
>> xxx", opam tries to install the "xxx" package if it does not match an
>> existing command ? We could have a transition period where depext
>> exists as both opam-depext and depext packages, no ?
>
> I meant that it would be cleaner if OPAM's plugin logic had searched for
> "opam-foo" rather than "foo" in the first place.  It's odd to have OPAM
> packages called "publish" and "depext" instead of "opam-publish" and
> "opam-depext", but not the end of the world.  It's too late to change the
> logic now since OPAM 1.2.x will be in Ubuntu LTS for some years, and so
> the transition period would be several years even if we push OPAM 1.3.0
> out of the door in the next month...
>
> -anil
>



-- 
Fabrice LE FESSANT
Chercheur en Informatique
INRIA Paris Rocquencourt -- OCamlPro
Programming Languages and Distributed Systems

From louis.gesbert at ocamlpro.com  Wed Aug 19 10:56:03 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 19 Aug 2015 18:56:03 +0900
Subject: [opam-devel] opam publish package name
In-Reply-To: <CAHvkLrOvBAidS07F37eAbE=PSFiga3=K=FOHDfBR+YSv0cmQ+Q@mail.gmail.com>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <98D30DDF-36A8-444E-8F48-19D277E8E829@recoil.org>
 <CAHvkLrOvBAidS07F37eAbE=PSFiga3=K=FOHDfBR+YSv0cmQ+Q@mail.gmail.com>
Message-ID: <4559940.SS3L9NlE8l@agaric>

Allowing plugins with packages named `opam-xxx` in opam 1.3 sure won't cost much. I don't see a good reason not to add it now even if it can't be used in a while.

> - Fabrice Le Fessant, 19/08/2015 11:49 -
> I think it's worth doing it, even if we also keep the old logic for
> compatilibility for a few years from now, until Ubuntu LTS is dead.
> Otherwise, we will either have to limit opam plugin names to avoid
> conflicts with existing packages (for example, "cache" is already a
> package, preventing "opam-cache", etc.), either to reserve names for
> possible plugins ("search", "file", "git", etc).

"search" is already an opam command :)

From Fabrice.Le_fessant at inria.fr  Wed Aug 19 11:04:38 2015
From: Fabrice.Le_fessant at inria.fr (Fabrice Le Fessant)
Date: Wed, 19 Aug 2015 12:04:38 +0200
Subject: [opam-devel] opam publish package name
In-Reply-To: <4559940.SS3L9NlE8l@agaric>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <98D30DDF-36A8-444E-8F48-19D277E8E829@recoil.org>
 <CAHvkLrOvBAidS07F37eAbE=PSFiga3=K=FOHDfBR+YSv0cmQ+Q@mail.gmail.com>
 <4559940.SS3L9NlE8l@agaric>
Message-ID: <CAHvkLrM2KhTucQRGhcCtg-RaS-t6jEngF7NfNVmHBrxBpzpXGA@mail.gmail.com>

On Wed, Aug 19, 2015 at 11:56 AM, Louis Gesbert
<louis.gesbert at ocamlpro.com> wrote:
>> package, preventing "opam-cache", etc.), either to reserve names for
>> possible plugins ("search", "file", "git", etc).
>
> "search" is already an opam command :)

Is it planned to have a dynlink mechanism for plugins ? Then, it would
be possible to override existing builtin commands from inside.
Another possibility would be to have aliases for builtins, and allow
to override their default names: for example, if I type "opam search
XXX", opam would first call "opam-search", and only if it does not
exist, call the builtin. Then "opam-search" would be able to call
"opam builtins search XXX" to access the builtin command with enhanced
parameters...

--Fabrice
-- 
Fabrice LE FESSANT
Chercheur en Informatique
INRIA Paris Rocquencourt -- OCamlPro
Programming Languages and Distributed Systems

From louis.gesbert at ocamlpro.com  Wed Aug 19 11:18:25 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Wed, 19 Aug 2015 19:18:25 +0900
Subject: [opam-devel] opam publish package name
In-Reply-To: <CAHvkLrM2KhTucQRGhcCtg-RaS-t6jEngF7NfNVmHBrxBpzpXGA@mail.gmail.com>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <4559940.SS3L9NlE8l@agaric>
 <CAHvkLrM2KhTucQRGhcCtg-RaS-t6jEngF7NfNVmHBrxBpzpXGA@mail.gmail.com>
Message-ID: <16554536.kDfU30sAfB@agaric>



> - Fabrice Le Fessant, 19/08/2015 12:04 -
> On Wed, Aug 19, 2015 at 11:56 AM, Louis Gesbert
> <louis.gesbert at ocamlpro.com> wrote:
> >> package, preventing "opam-cache", etc.), either to reserve names for
> >> possible plugins ("search", "file", "git", etc).
> >
> > "search" is already an opam command :)
> 
> Is it planned to have a dynlink mechanism for plugins ? Then, it would
> be possible to override existing builtin commands from inside.

I don't think there is a clear need right now, but we may want one one day.
An idea was to use plugins for specialising for different system (e.g. ocaml), but I don't think that's actually even needed (the most important need was for specific variables, and we are going towards defining them in the configuration, and from packages).

> Another possibility would be to have aliases for builtins, and allow
> to override their default names: for example, if I type "opam search
> XXX", opam would first call "opam-search", and only if it does not
> exist, call the builtin. Then "opam-search" would be able to call
> "opam builtins search XXX" to access the builtin command with enhanced
> parameters...

That sounds dangerous ;)
There is at the moment a check that specifically disables plugins named like a known command. The above could be quite straight-forward to implement, but I don't clearly see a use-case.

From amc79 at cam.ac.uk  Wed Aug 19 13:58:52 2015
From: amc79 at cam.ac.uk (Amir Chaudhry)
Date: Wed, 19 Aug 2015 13:58:52 +0100
Subject: [opam-devel] opam publish package name
In-Reply-To: <16554536.kDfU30sAfB@agaric>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <4559940.SS3L9NlE8l@agaric>
 <CAHvkLrM2KhTucQRGhcCtg-RaS-t6jEngF7NfNVmHBrxBpzpXGA@mail.gmail.com>
 <16554536.kDfU30sAfB@agaric>
Message-ID: <52493286-AE0D-4AFB-A320-01EAE83ADC1C@cam.ac.uk>


> On 19 Aug 2015, at 11:18, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
>> Another possibility would be to have aliases for builtins, and allow
>> to override their default names: for example, if I type "opam search
>> XXX", opam would first call "opam-search", and only if it does not
>> exist, call the builtin. Then "opam-search" would be able to call
>> "opam builtins search XXX" to access the builtin command with enhanced
>> parameters...
> 
> That sounds dangerous ;)
> There is at the moment a check that specifically disables plugins named like a known command. The above could be quite straight-forward to implement, but I don't clearly see a use-case.

I think this kind of ?shadowing? can be confusing for users and end up making bug reports more complex to handle.


From yminsky at janestreet.com  Sun Aug 23 16:51:35 2015
From: yminsky at janestreet.com (Yaron Minsky)
Date: Sun, 23 Aug 2015 11:51:35 -0400
Subject: [opam-devel] user-setup
Message-ID: <CACLX4jSw8p4A7oV9TZkOVqHQkp1GBGhH3jjgDOgdNNQqs1dPOA@mail.gmail.com>

Have you thought much about user-setup of late?  I tried to use it in
an up-to-date mac, and the emacs setup failed.  I think it was relying
on some missing package.  Do you have any thoughts as to how we can
get this to the point where it works reliably enough to be usable to
newbies?

Another thing about user-setup is that its operations are only
implicit, i.e., it only does things on install, which means if you
want to do something like set up a clean .emacs file, or even just get
a list of the things it's doing, there's no obvious way.  I think it
would be ideal if user-setup came with a command-line tool, and
actually if it only modified files after you called that command-line
tool, which would warn you about what it was going to do, and maybe
even give you a way of immediately unrolling.

y

From louis.gesbert at ocamlpro.com  Mon Aug 24 05:44:03 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Mon, 24 Aug 2015 13:44:03 +0900
Subject: [opam-devel] user-setup
In-Reply-To: <CACLX4jSw8p4A7oV9TZkOVqHQkp1GBGhH3jjgDOgdNNQqs1dPOA@mail.gmail.com>
References: <CACLX4jSw8p4A7oV9TZkOVqHQkp1GBGhH3jjgDOgdNNQqs1dPOA@mail.gmail.com>
Message-ID: <90027481.VJ5NWl0Xnf@agaric>

> - Yaron Minsky, 23/08/2015 11:51 -
> Have you thought much about user-setup of late?  I tried to use it in
> an up-to-date mac, and the emacs setup failed.  I think it was relying
> on some missing package.  Do you have any thoughts as to how we can
> get this to the point where it works reliably enough to be usable to
> newbies?

I'll look into it; there have been changes to the installation of emacs files for e.g. ocp-indent, and the according update of user-setup may not have made it yet into opam, so that might be the cause of your trouble.

I don't think we are far from there, and we have had a few successful reports, but it's quite difficult to test reliably. There are also quite a few improvements pending, which I'll get into opam-repo ASAP. One of them moves the bulk of ocaml-specific emacs configuration into ~/.emacs.d/opam-user-setup.el.

> Another thing about user-setup is that its operations are only
> implicit, i.e., it only does things on install, which means if you
> want to do something like set up a clean .emacs file, or even just get
> a list of the things it's doing, there's no obvious way.

Indeed, as of now its only "interface" is with opam. The new version should display some information about what files it is updating, at least on newer opam, but that's a bare minimum.

> I think it
> would be ideal if user-setup came with a command-line tool, and
> actually if it only modified files after you called that command-line
> tool, which would warn you about what it was going to do, and maybe
> even give you a way of immediately unrolling.

Indeed; the command-line tool is currently very limited in terms of interaction, as it's designed to be run from opam, but that would be well worth improving. At least having it list its current status when run without arguments would be quite helpful.

I'll look into this.

Best,
Louis Gesbert -- OCamlPro
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: This is a digitally signed message part.
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20150824/c751d0fe/attachment.sig>

From yminsky at gmail.com  Mon Aug 24 16:25:29 2015
From: yminsky at gmail.com (Yaron Minsky)
Date: Mon, 24 Aug 2015 15:25:29 +0000
Subject: [opam-devel] user-setup
In-Reply-To: <90027481.VJ5NWl0Xnf@agaric>
References: <CACLX4jSw8p4A7oV9TZkOVqHQkp1GBGhH3jjgDOgdNNQqs1dPOA@mail.gmail.com>
 <90027481.VJ5NWl0Xnf@agaric>
Message-ID: <CADKNfhK6Sa1iAxRpvFnk7ro1sLFMk+6Q7Kn2E1krRMLO2Mm5Og@mail.gmail.com>

Great.

In addition, I wonder if we can try to do some testing of the setup as part
of the testing of updates to the opam metadata.  Right now, for example,
emacs just errors out on startup in some cases.  Having a test of
user-setup that verified some basic functionality would be really nice.

y

On Mon, Aug 24, 2015 at 12:44 AM Louis Gesbert <louis.gesbert at ocamlpro.com>
wrote:

> > - Yaron Minsky, 23/08/2015 11:51 -
> > Have you thought much about user-setup of late?  I tried to use it in
> > an up-to-date mac, and the emacs setup failed.  I think it was relying
> > on some missing package.  Do you have any thoughts as to how we can
> > get this to the point where it works reliably enough to be usable to
> > newbies?
>
> I'll look into it; there have been changes to the installation of emacs
> files for e.g. ocp-indent, and the according update of user-setup may not
> have made it yet into opam, so that might be the cause of your trouble.
>
> I don't think we are far from there, and we have had a few successful
> reports, but it's quite difficult to test reliably. There are also quite a
> few improvements pending, which I'll get into opam-repo ASAP. One of them
> moves the bulk of ocaml-specific emacs configuration into
> ~/.emacs.d/opam-user-setup.el.
>
> > Another thing about user-setup is that its operations are only
> > implicit, i.e., it only does things on install, which means if you
> > want to do something like set up a clean .emacs file, or even just get
> > a list of the things it's doing, there's no obvious way.
>
> Indeed, as of now its only "interface" is with opam. The new version
> should display some information about what files it is updating, at least
> on newer opam, but that's a bare minimum.
>
> > I think it
> > would be ideal if user-setup came with a command-line tool, and
> > actually if it only modified files after you called that command-line
> > tool, which would warn you about what it was going to do, and maybe
> > even give you a way of immediately unrolling.
>
> Indeed; the command-line tool is currently very limited in terms of
> interaction, as it's designed to be run from opam, but that would be well
> worth improving. At least having it list its current status when run
> without arguments would be quite helpful.
>
> I'll look into this.
>
> Best,
> Louis Gesbert -- OCamlPro_______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20150824/419c2221/attachment.html>

From anil at recoil.org  Wed Aug 26 17:49:56 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 26 Aug 2015 17:49:56 +0100
Subject: [opam-devel] user-setup
In-Reply-To: <CADKNfhK6Sa1iAxRpvFnk7ro1sLFMk+6Q7Kn2E1krRMLO2Mm5Og@mail.gmail.com>
References: <CACLX4jSw8p4A7oV9TZkOVqHQkp1GBGhH3jjgDOgdNNQqs1dPOA@mail.gmail.com>
 <90027481.VJ5NWl0Xnf@agaric>
 <CADKNfhK6Sa1iAxRpvFnk7ro1sLFMk+6Q7Kn2E1krRMLO2Mm5Og@mail.gmail.com>
Message-ID: <2055BAA9-91C3-4873-B83F-290925C39BE4@recoil.org>

I didn't quite understand this last point, as a non-Emacser.  What sort of breakage to existing packages cause these Emacs errors?  What tests would make sense as part of a pull request to detect these?

-anil

> On 24 Aug 2015, at 16:25, Yaron Minsky <yminsky at gmail.com> wrote:
> 
> Great.
> 
> In addition, I wonder if we can try to do some testing of the setup as part of the testing of updates to the opam metadata.  Right now, for example, emacs just errors out on startup in some cases.  Having a test of user-setup that verified some basic functionality would be really nice.
> 
> y
> 
> On Mon, Aug 24, 2015 at 12:44 AM Louis Gesbert <louis.gesbert at ocamlpro.com <mailto:louis.gesbert at ocamlpro.com>> wrote:
> > - Yaron Minsky, 23/08/2015 11:51 -
> > Have you thought much about user-setup of late?  I tried to use it in
> > an up-to-date mac, and the emacs setup failed.  I think it was relying
> > on some missing package.  Do you have any thoughts as to how we can
> > get this to the point where it works reliably enough to be usable to
> > newbies?
> 
> I'll look into it; there have been changes to the installation of emacs files for e.g. ocp-indent, and the according update of user-setup may not have made it yet into opam, so that might be the cause of your trouble.
> 
> I don't think we are far from there, and we have had a few successful reports, but it's quite difficult to test reliably. There are also quite a few improvements pending, which I'll get into opam-repo ASAP. One of them moves the bulk of ocaml-specific emacs configuration into ~/.emacs.d/opam-user-setup.el.
> 
> > Another thing about user-setup is that its operations are only
> > implicit, i.e., it only does things on install, which means if you
> > want to do something like set up a clean .emacs file, or even just get
> > a list of the things it's doing, there's no obvious way.
> 
> Indeed, as of now its only "interface" is with opam. The new version should display some information about what files it is updating, at least on newer opam, but that's a bare minimum.
> 
> > I think it
> > would be ideal if user-setup came with a command-line tool, and
> > actually if it only modified files after you called that command-line
> > tool, which would warn you about what it was going to do, and maybe
> > even give you a way of immediately unrolling.
> 
> Indeed; the command-line tool is currently very limited in terms of interaction, as it's designed to be run from opam, but that would be well worth improving. At least having it list its current status when run without arguments would be quite helpful.
> 
> I'll look into this.
> 
> Best,
> Louis Gesbert -- OCamlPro_______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org <mailto:opam-devel at lists.ocaml.org>
> http://lists.ocaml.org/listinfo/opam-devel <http://lists.ocaml.org/listinfo/opam-devel>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20150826/817535c4/attachment.html>

From yminsky at gmail.com  Wed Aug 26 17:57:42 2015
From: yminsky at gmail.com (Yaron Minsky)
Date: Wed, 26 Aug 2015 16:57:42 +0000
Subject: [opam-devel] user-setup
In-Reply-To: <2055BAA9-91C3-4873-B83F-290925C39BE4@recoil.org>
References: <CACLX4jSw8p4A7oV9TZkOVqHQkp1GBGhH3jjgDOgdNNQqs1dPOA@mail.gmail.com>
 <90027481.VJ5NWl0Xnf@agaric>
 <CADKNfhK6Sa1iAxRpvFnk7ro1sLFMk+6Q7Kn2E1krRMLO2Mm5Og@mail.gmail.com>
 <2055BAA9-91C3-4873-B83F-290925C39BE4@recoil.org>
Message-ID: <CADKNfhKtJMY=_rtHfBQph9RHgXyh75U_mVxy4XHUjAFgx0yNgQ@mail.gmail.com>

I think running emacs on an init script created by the tool would be a
useful test, and would catch most errors either in the scripts themselves,
or incompatibilities between other tools (opam, Merlin, ocp-indent) and the
emacs init scripts.

y

On Wed, Aug 26, 2015, 10:49 AM Anil Madhavapeddy <anil at recoil.org> wrote:

> I didn't quite understand this last point, as a non-Emacser.  What sort of
> breakage to existing packages cause these Emacs errors?  What tests would
> make sense as part of a pull request to detect these?
>
> -anil
>
> On 24 Aug 2015, at 16:25, Yaron Minsky <yminsky at gmail.com> wrote:
>
> Great.
>
> In addition, I wonder if we can try to do some testing of the setup as
> part of the testing of updates to the opam metadata.  Right now, for
> example, emacs just errors out on startup in some cases.  Having a test of
> user-setup that verified some basic functionality would be really nice.
>
> y
>
> On Mon, Aug 24, 2015 at 12:44 AM Louis Gesbert <louis.gesbert at ocamlpro.com>
> wrote:
>
>> > - Yaron Minsky, 23/08/2015 11:51 -
>> > Have you thought much about user-setup of late?  I tried to use it in
>> > an up-to-date mac, and the emacs setup failed.  I think it was relying
>> > on some missing package.  Do you have any thoughts as to how we can
>> > get this to the point where it works reliably enough to be usable to
>> > newbies?
>>
>> I'll look into it; there have been changes to the installation of emacs
>> files for e.g. ocp-indent, and the according update of user-setup may not
>> have made it yet into opam, so that might be the cause of your trouble.
>>
>> I don't think we are far from there, and we have had a few successful
>> reports, but it's quite difficult to test reliably. There are also quite a
>> few improvements pending, which I'll get into opam-repo ASAP. One of them
>> moves the bulk of ocaml-specific emacs configuration into
>> ~/.emacs.d/opam-user-setup.el.
>>
>> > Another thing about user-setup is that its operations are only
>> > implicit, i.e., it only does things on install, which means if you
>> > want to do something like set up a clean .emacs file, or even just get
>> > a list of the things it's doing, there's no obvious way.
>>
>> Indeed, as of now its only "interface" is with opam. The new version
>> should display some information about what files it is updating, at least
>> on newer opam, but that's a bare minimum.
>>
>> > I think it
>> > would be ideal if user-setup came with a command-line tool, and
>> > actually if it only modified files after you called that command-line
>> > tool, which would warn you about what it was going to do, and maybe
>> > even give you a way of immediately unrolling.
>>
>> Indeed; the command-line tool is currently very limited in terms of
>> interaction, as it's designed to be run from opam, but that would be well
>> worth improving. At least having it list its current status when run
>> without arguments would be quite helpful.
>>
>> I'll look into this.
>>
>> Best,
>> Louis Gesbert -- OCamlPro_______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org
>> http://lists.ocaml.org/listinfo/opam-devel
>>
> _______________________________________________
> opam-devel mailing list
> opam-devel at lists.ocaml.org
> http://lists.ocaml.org/listinfo/opam-devel
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20150826/32130ec1/attachment.html>

From anil at recoil.org  Wed Aug 26 17:59:20 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 26 Aug 2015 17:59:20 +0100
Subject: [opam-devel] user-setup
In-Reply-To: <CADKNfhKtJMY=_rtHfBQph9RHgXyh75U_mVxy4XHUjAFgx0yNgQ@mail.gmail.com>
References: <CACLX4jSw8p4A7oV9TZkOVqHQkp1GBGhH3jjgDOgdNNQqs1dPOA@mail.gmail.com>
 <90027481.VJ5NWl0Xnf@agaric>
 <CADKNfhK6Sa1iAxRpvFnk7ro1sLFMk+6Q7Kn2E1krRMLO2Mm5Og@mail.gmail.com>
 <2055BAA9-91C3-4873-B83F-290925C39BE4@recoil.org>
 <CADKNfhKtJMY=_rtHfBQph9RHgXyh75U_mVxy4XHUjAFgx0yNgQ@mail.gmail.com>
Message-ID: <52481B48-D287-4BEC-9DE1-A0E4EE6BE24C@recoil.org>

This sounds like something that the ocaml-travisci-skeleton scripts can do immediately after the OPAM init and after package installation has completed.  Installing Emacs isn't too much overhead if the default packaged Ubuntu one will work.

-anil

> On 26 Aug 2015, at 17:57, Yaron Minsky <yminsky at gmail.com> wrote:
> 
> I think running emacs on an init script created by the tool would be a useful test, and would catch most errors either in the scripts themselves, or incompatibilities between other tools (opam, Merlin, ocp-indent) and the emacs init scripts.
> 
> y
> 
> 
> On Wed, Aug 26, 2015, 10:49 AM Anil Madhavapeddy <anil at recoil.org <mailto:anil at recoil.org>> wrote:
> I didn't quite understand this last point, as a non-Emacser.  What sort of breakage to existing packages cause these Emacs errors?  What tests would make sense as part of a pull request to detect these?
> 
> -anil
> 
>> On 24 Aug 2015, at 16:25, Yaron Minsky <yminsky at gmail.com <mailto:yminsky at gmail.com>> wrote:
>> 
>> Great.
>> 
>> In addition, I wonder if we can try to do some testing of the setup as part of the testing of updates to the opam metadata.  Right now, for example, emacs just errors out on startup in some cases.  Having a test of user-setup that verified some basic functionality would be really nice.
>> 
>> y
>> 
>> On Mon, Aug 24, 2015 at 12:44 AM Louis Gesbert <louis.gesbert at ocamlpro.com <mailto:louis.gesbert at ocamlpro.com>> wrote:
>> > - Yaron Minsky, 23/08/2015 11:51 -
>> > Have you thought much about user-setup of late?  I tried to use it in
>> > an up-to-date mac, and the emacs setup failed.  I think it was relying
>> > on some missing package.  Do you have any thoughts as to how we can
>> > get this to the point where it works reliably enough to be usable to
>> > newbies?
>> 
>> I'll look into it; there have been changes to the installation of emacs files for e.g. ocp-indent, and the according update of user-setup may not have made it yet into opam, so that might be the cause of your trouble.
>> 
>> I don't think we are far from there, and we have had a few successful reports, but it's quite difficult to test reliably. There are also quite a few improvements pending, which I'll get into opam-repo ASAP. One of them moves the bulk of ocaml-specific emacs configuration into ~/.emacs.d/opam-user-setup.el.
>> 
>> > Another thing about user-setup is that its operations are only
>> > implicit, i.e., it only does things on install, which means if you
>> > want to do something like set up a clean .emacs file, or even just get
>> > a list of the things it's doing, there's no obvious way.
>> 
>> Indeed, as of now its only "interface" is with opam. The new version should display some information about what files it is updating, at least on newer opam, but that's a bare minimum.
>> 
>> > I think it
>> > would be ideal if user-setup came with a command-line tool, and
>> > actually if it only modified files after you called that command-line
>> > tool, which would warn you about what it was going to do, and maybe
>> > even give you a way of immediately unrolling.
>> 
>> Indeed; the command-line tool is currently very limited in terms of interaction, as it's designed to be run from opam, but that would be well worth improving. At least having it list its current status when run without arguments would be quite helpful.
>> 
>> I'll look into this.
>> 
>> Best,
>> Louis Gesbert -- OCamlPro_______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org <mailto:opam-devel at lists.ocaml.org>
>> http://lists.ocaml.org/listinfo/opam-devel <http://lists.ocaml.org/listinfo/opam-devel>
>> _______________________________________________
>> opam-devel mailing list
>> opam-devel at lists.ocaml.org <mailto:opam-devel at lists.ocaml.org>
>> http://lists.ocaml.org/listinfo/opam-devel <http://lists.ocaml.org/listinfo/opam-devel>
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20150826/f96edb7a/attachment-0001.html>

From anil at recoil.org  Wed Aug 26 18:49:23 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 26 Aug 2015 18:49:23 +0100
Subject: [opam-devel] opam publish package name
In-Reply-To: <4559940.SS3L9NlE8l@agaric>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <98D30DDF-36A8-444E-8F48-19D277E8E829@recoil.org>
 <CAHvkLrOvBAidS07F37eAbE=PSFiga3=K=FOHDfBR+YSv0cmQ+Q@mail.gmail.com>
 <4559940.SS3L9NlE8l@agaric>
Message-ID: <9A51C92A-A38F-4057-BC09-2EC727312DF6@recoil.org>

Yeah, after some thought I agree with you and Fabrice.  Even though it'll
take a few years to percolate through, having the right semantics in the
core tool is more important than a transitionary period.  It wont cost much
to maintain two copies of important plugins.

One thing I noticed is that the automatic plugin installation doesn't
play well with non-interactivity (e.g. -y), btw.

-anil

> On 19 Aug 2015, at 10:56, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
> Allowing plugins with packages named `opam-xxx` in opam 1.3 sure won't cost much. I don't see a good reason not to add it now even if it can't be used in a while.
> 
>> - Fabrice Le Fessant, 19/08/2015 11:49 -
>> I think it's worth doing it, even if we also keep the old logic for
>> compatilibility for a few years from now, until Ubuntu LTS is dead.
>> Otherwise, we will either have to limit opam plugin names to avoid
>> conflicts with existing packages (for example, "cache" is already a
>> package, preventing "opam-cache", etc.), either to reserve names for
>> possible plugins ("search", "file", "git", etc).
> 
> "search" is already an opam command :)
> 


From anil at recoil.org  Wed Aug 26 18:50:11 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Wed, 26 Aug 2015 18:50:11 +0100
Subject: [opam-devel] opam publish package name
In-Reply-To: <CAHvkLrM2KhTucQRGhcCtg-RaS-t6jEngF7NfNVmHBrxBpzpXGA@mail.gmail.com>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <98D30DDF-36A8-444E-8F48-19D277E8E829@recoil.org>
 <CAHvkLrOvBAidS07F37eAbE=PSFiga3=K=FOHDfBR+YSv0cmQ+Q@mail.gmail.com>
 <4559940.SS3L9NlE8l@agaric>
 <CAHvkLrM2KhTucQRGhcCtg-RaS-t6jEngF7NfNVmHBrxBpzpXGA@mail.gmail.com>
Message-ID: <202D1C4E-6D6D-47D7-B201-F8EEA52EB78C@recoil.org>

On 19 Aug 2015, at 11:04, Fabrice Le Fessant <Fabrice.Le_fessant at inria.fr> wrote:
> 
> On Wed, Aug 19, 2015 at 11:56 AM, Louis Gesbert
> <louis.gesbert at ocamlpro.com> wrote:
>>> package, preventing "opam-cache", etc.), either to reserve names for
>>> possible plugins ("search", "file", "git", etc).
>> 
>> "search" is already an opam command :)
> 
> Is it planned to have a dynlink mechanism for plugins ? Then, it would
> be possible to override existing builtin commands from inside.
> Another possibility would be to have aliases for builtins, and allow
> to override their default names: for example, if I type "opam search
> XXX", opam would first call "opam-search", and only if it does not
> exist, call the builtin. Then "opam-search" would be able to call
> "opam builtins search XXX" to access the builtin command with enhanced
> parameters...
> 

Do you have a use-case in mind for this?

-anil

From louis.gesbert at ocamlpro.com  Thu Aug 27 05:57:56 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Thu, 27 Aug 2015 13:57:56 +0900
Subject: [opam-devel] opam publish package name
In-Reply-To: <9A51C92A-A38F-4057-BC09-2EC727312DF6@recoil.org>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <4559940.SS3L9NlE8l@agaric> <9A51C92A-A38F-4057-BC09-2EC727312DF6@recoil.org>
Message-ID: <9607394.Ul11Am31MZ@agaric>

> - Anil Madhavapeddy, 26/08/2015 18:49 -
> One thing I noticed is that the automatic plugin installation doesn't
> play well with non-interactivity (e.g. -y), btw.

It should work with `OPAMYES=1` ; it's otherwise a bit difficult to parse the command-line arguments that are normally directed towards a different program.

Or should we allow something like `opam -y publish` ? Or normalise the arguments a plugin is supposed to accept ?

I don't see a very nice solution to this...


> 
> -anil
> 
> > On 19 Aug 2015, at 10:56, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> > 
> > Allowing plugins with packages named `opam-xxx` in opam 1.3 sure won't cost much. I don't see a good reason not to add it now even if it can't be used in a while.
> > 
> >> - Fabrice Le Fessant, 19/08/2015 11:49 -
> >> I think it's worth doing it, even if we also keep the old logic for
> >> compatilibility for a few years from now, until Ubuntu LTS is dead.
> >> Otherwise, we will either have to limit opam plugin names to avoid
> >> conflicts with existing packages (for example, "cache" is already a
> >> package, preventing "opam-cache", etc.), either to reserve names for
> >> possible plugins ("search", "file", "git", etc).
> > 
> > "search" is already an opam command :)
> > 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: This is a digitally signed message part.
URL: <http://lists.ocaml.org/pipermail/opam-devel/attachments/20150827/6c451ff1/attachment.sig>

From anil at recoil.org  Thu Aug 27 14:10:32 2015
From: anil at recoil.org (Anil Madhavapeddy)
Date: Thu, 27 Aug 2015 14:10:32 +0100
Subject: [opam-devel] opam publish package name
In-Reply-To: <9607394.Ul11Am31MZ@agaric>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <4559940.SS3L9NlE8l@agaric> <9A51C92A-A38F-4057-BC09-2EC727312DF6@recoil.org>
 <9607394.Ul11Am31MZ@agaric>
Message-ID: <DBE1AC77-3471-423A-A777-8A097E0B3A23@recoil.org>

On 27 Aug 2015, at 05:57, Louis Gesbert <louis.gesbert at ocamlpro.com> wrote:
> 
>> - Anil Madhavapeddy, 26/08/2015 18:49 -
>> One thing I noticed is that the automatic plugin installation doesn't
>> play well with non-interactivity (e.g. -y), btw.
> 
> It should work with `OPAMYES=1` ; it's otherwise a bit difficult to parse the command-line arguments that are normally directed towards a different program.
> 
> Or should we allow something like `opam -y publish` ? Or normalise the arguments a plugin is supposed to accept ?

This does bite me quite often, since (for example) "opam depext -i -j 4 -y foo" doesn't work -- i.e. `opam depext -i` is no longer a dropin replacement for `opam install` even though semantically it's meant to just augment the installation process with an external dependency check.

One way to get around this would be to make the cmdliner structures available for plugins to link against in opam-lib.  The global ones especially could be used by every plugin and passed through to OPAM subcommands by setting the right environment variables (perhas https://github.com/dbuenzli/cmdliner/issues/23 would be of use for that).

-anil


From louis.gesbert at ocamlpro.com  Fri Aug 28 01:33:36 2015
From: louis.gesbert at ocamlpro.com (Louis Gesbert)
Date: Fri, 28 Aug 2015 09:33:36 +0900
Subject: [opam-devel] opam publish package name
In-Reply-To: <DBE1AC77-3471-423A-A777-8A097E0B3A23@recoil.org>
References: <CCA43BB5-0D1E-4412-8EB2-A7F6054F5C74@recoil.org>
 <9607394.Ul11Am31MZ@agaric> <DBE1AC77-3471-423A-A777-8A097E0B3A23@recoil.org>
Message-ID: <2075971.dvRHYMC7xz@agaric>



> - Anil Madhavapeddy, 27/08/2015 14:10 -
> [...]
> One way to get around this would be to make the cmdliner structures available for plugins to link against in opam-lib.  The global ones especially could be used by every plugin and passed through to OPAM subcommands by setting the right environment variables (perhas https://github.com/dbuenzli/cmdliner/issues/23 would be of use for that).

This has been cleaned up and done just last week! So indeed for tools relying on the full opam-lib (i.e. opam-lib.client), you have either:

* a single function that does all the initialisation for you in the right way, with possible overrides through optional arguments (`OpamClientConfig.init`). In particular, it locates opamroot, loads the config file, initialises all opam libs reading from the env, in the right order and with the right priorities.
* a cmdliner term `OpamArg.global_options`, and a function `OpamArg.apply_global_options`, that contain all the options common to all opam commands, and does the above initialisation taking those into account respectively.

These should indeed make the lives of plugins easier (although not all rely on opam-lib, e.g. opam-depext which shouldn't rely on any external dependency).

This doesn't pass to sub-processes through the env at the moment, but that could be a good idea indeed.

From amc79 at cam.ac.uk  Fri Aug 28 15:14:37 2015
From: amc79 at cam.ac.uk (Amir Chaudhry)
Date: Fri, 28 Aug 2015 15:14:37 +0100
Subject: [opam-devel] Fwd: Adopting a Governance framework for OCaml.org
References: <A6EC58B0-4D10-4572-9FC7-26186DE58BEF@cam.ac.uk>
Message-ID: <54B5A8EF-12F4-4D16-BB36-C80937F515D5@cam.ac.uk>

Dear opam-devel,

I?ve just posted the following to infrastructure at lists.ocaml.org regarding a governance framework for OCaml.org.
If you have thoughts, please do share them on that list. 

http://lists.ocaml.org/pipermail/infrastructure/2015-August/000518.html

Best wishes,
Amir


> Begin forwarded message:
> 
> From: Amir Chaudhry <amc79 at cam.ac.uk>
> Subject: Adopting a Governance framework for OCaml.org
> Date: 28 August 2015 15:12:06 BST
> To: infrastructure <infrastructure at lists.ocaml.org>
> 
> Dear all,
> 
> Earlier this year, I began working towards a governance framework for the OCaml.org domain and the projects that make use of it. I wrote about my approach to this and mentioned that such a framework should:
> - demonstrate a commitment to a stable decision-making process.
> - be clear about scope (i.e. OCaml.org).
> - document current reality, rather than being aspirational.
> - be a living document, meaning that it can and should evolve.
> 
> Please read the original post for detail on the above points.
> http://amirchaudhry.com/towards-governance-framework-for-ocamlorg/
> 
> Since that time, I've drafted a governance document and discussed it with those who already run projects under OCaml.org.  We've reached a point where we're ready to discuss this more widely and more formally adopt the model.
> 
> Starting from today, we're sharing the document publicly and inviting any discussion on this mailing list (infrastructure at lists.ocaml.org).  During this time, I'll also be asking the existing maintainers to ratify the document.
> 
> By the 14th of September we'll wrap things up (for this time around) and publish version 1.0 of the agreed document on OCaml.org
> 
> You can find a draft linked below and the step-by-step process we're following.  Please do share your thoughts on this thread.
> 
> Document: https://gist.github.com/amirmc/fe8a931c246bb13d9b32
> 
> -- The process for adopting the governance framework --
> 
> 0. I draft and discuss a governance document with existing project maintainers and reach agreement. (DONE).
> 1.  I send an email update to the infra list and caml-list, with a link to a public version of the doc.
> 2.  We allow a period of public discussion on the infra list.
> 3.  During this, I explicitly ask Maintainers and Owner to confirm they will adopt the doc.
> 4.  In parallel, I create an issue on the ocaml.org repo with a list of people to check off as agreements come in -- important that the responses happen on the mailing list as that's properly archived.
> 5.  Once all the affirmations are in, I push the doc to the ocaml.org site.
> 
> Best wishes,
> Amir


From michipili at gmail.com  Wed Aug 19 15:25:37 2015
From: michipili at gmail.com (=?utf-8?Q?Michael_Gr=C3=BCnewald?=)
Date: Wed, 19 Aug 2015 16:25:37 +0200
Subject: [opam-devel] Container based Travis CI service
Message-ID: <8AC34ECC-FAF6-4F46-B97D-FE3E8B0A9C6A@gmail.com>

Dear opam-devel?lers,

for a few days I moved my OCaml repositories to the new container-based
continuous integration service from Travis.  I had a brief off-list
exchange with Anil, who meant this topic would be interesting to
list members, especially for depexts.

In my setting I can use Travis's cache to store several switches and
run my test-suite for each of these switches.  I wrote a blog article
describing the setup, if you did not read it already, it is here:

  http://unix-workstation.blogspot.de/2015/08/opam-and-bsd-owl-support-for-travis-ci.html


As an appetiser, here is the script running the test suite, as you
can expect it, the TRAVIS_OCAML_VERSION is defined in .travis.yml
as part of the test matrix environment.

  INSTALL_PREFIX="${HOME}/.local"
  eval $(opam config env --switch ${TRAVIS_OCAML_VERSION})
  autoconf
  ./configure --prefix="${INSTALL_PREFIX}"
  bmake -I "${INSTALL_PREFIX}/share/bsdowl? all

The setup introduces a special .travis.opam file enumerating the
switches that need to be installed and the dependencies of the opam
package being tested.  Packages can be installed using their definition
in the repository or by pinning a git repository.

Behind the scenes, a script from the Anvil package is at work:

  https://github.com/michipili/anvil/blob/master/subr/anvil_travisci_autoinstall.sh


Besides the blog link above, here are a list of repositories using
this new setup:

  https://github.com/michipili/broken
  https://github.com/michipili/mixture
  https://github.com/michipili/lemonade
  https://github.com/michipili/getopts
  https://github.com/michipili/configuration

@Anil ? Am I right understanding it would be interesting to move
depext CI setup to the container-based version?  If so, I could
probably take a look at before the end of the week.


Best,
Michael


