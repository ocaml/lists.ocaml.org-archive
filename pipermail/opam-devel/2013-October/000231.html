<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [opam-devel] broken stats on opam.ocaml.org
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20broken%20stats%20on%20opam.ocaml.org&In-Reply-To=%3C4096298.R09DoZETao%40agaric%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000230.html">
   <LINK REL="Next"  HREF="000232.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[opam-devel] broken stats on opam.ocaml.org</H1>
    <B>Louis Gesbert</B> 
    <A HREF="mailto:opam-devel%40lists.ocaml.org?Subject=Re%3A%20%5Bopam-devel%5D%20broken%20stats%20on%20opam.ocaml.org&In-Reply-To=%3C4096298.R09DoZETao%40agaric%3E"
       TITLE="[opam-devel] broken stats on opam.ocaml.org">louis.gesbert at ocamlpro.com
       </A><BR>
    <I>Fri Oct 18 18:10:21 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000230.html">[opam-devel] broken stats on opam.ocaml.org
</A></li>
        <LI>Next message: <A HREF="000232.html">[opam-devel] broken stats on opam.ocaml.org
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#231">[ date ]</a>
              <a href="thread.html#231">[ thread ]</a>
              <a href="subject.html#231">[ subject ]</a>
              <a href="author.html#231">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, I've turned nginx https on, and disabled stud. The logs look ok now, and the stats should be good.

I also noticed that some client weren't redirected to the new repo yet, because the opam-admin on ocamlpro.com wasn'nt up to date (it wouldn't know about the repo file, and not notify to download it). That's fixed and everyone using 1.1 should be redirected now.

Le vendredi 18 octobre 2013 12:57:48 Anil Madhavapeddy a &#233;crit :
&gt;<i> On Fri, Oct 18, 2013 at 01:50:28PM +0200, Louis Gesbert wrote:
</I>&gt;<i> &gt; the stats are generated from the http log. Since monday, the hits are
</I>&gt;<i> &gt; all logged by nginx as coming from 127.0.0.1, which obviously breaks the
</I>&gt;<i> &gt; stats :/ Any idea on how the configuration (proxying etc.) may cause
</I>&gt;<i> &gt; this and possible solutions ?
</I>&gt;<i> 
</I>&gt;<i> Good point -- we're using Stud:
</I>&gt;<i> <A HREF="https://github.com/bumptech/stud">https://github.com/bumptech/stud</A>
</I>&gt;<i> 
</I>&gt;<i> It has support for something that solves our problem:
</I>&gt;<i> &gt; stud will optionally write the client IP address as the first few octets
</I>&gt;<i> &gt; (depending on IPv4 or IPv6) to the backend--or provide that information
</I>&gt;<i> &gt; using HAProxy's PROXY protocol. When used with the PROXY protocol, stud
</I>&gt;<i> &gt; can also transparently pass an existing PROXY header to the cleartext
</I>&gt;<i> &gt; stream. This is especially useful if a TCP proxy is used in front of stud.
</I>&gt;<i> &gt; Using either of these techniques, backends who care about the client IP
</I>&gt;<i> &gt; can still access it even though stud itself appears to be the connected
</I>&gt;<i> &gt; client.
</I>&gt;<i> 
</I>&gt;<i> But...what static web server is opam.ocaml.org using?  If it's nginx, then
</I>&gt;<i> it should already have support for this, or we could configure it to serve
</I>&gt;<i> SSL traffic directly...
</I>&gt;<i> 
</I>&gt;<i> 
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.ocaml.org/pipermail/opam-devel/attachments/20131018/2e0fe41a/attachment.html">http://lists.ocaml.org/pipermail/opam-devel/attachments/20131018/2e0fe41a/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000230.html">[opam-devel] broken stats on opam.ocaml.org
</A></li>
	<LI>Next message: <A HREF="000232.html">[opam-devel] broken stats on opam.ocaml.org
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#231">[ date ]</a>
              <a href="thread.html#231">[ thread ]</a>
              <a href="subject.html#231">[ subject ]</a>
              <a href="author.html#231">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/opam-devel">More information about the opam-devel
mailing list</a><br>
</body></html>
