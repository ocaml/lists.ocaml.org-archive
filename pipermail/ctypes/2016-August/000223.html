<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [ocaml-ctypes] Build help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:ctypes%40lists.ocaml.org?Subject=Re%3A%20%5Bocaml-ctypes%5D%20Build%20help&In-Reply-To=%3Cded331f4-a9bb-931d-db8f-54908d3caa75%40digirati.com.br%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000222.html">
   <LINK REL="Next"  HREF="000224.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[ocaml-ctypes] Build help</H1>
    <B>Andre Nathan</B> 
    <A HREF="mailto:ctypes%40lists.ocaml.org?Subject=Re%3A%20%5Bocaml-ctypes%5D%20Build%20help&In-Reply-To=%3Cded331f4-a9bb-931d-db8f-54908d3caa75%40digirati.com.br%3E"
       TITLE="[ocaml-ctypes] Build help">andre at digirati.com.br
       </A><BR>
    <I>Wed Aug 10 21:20:17 BST 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="000222.html">[ocaml-ctypes] Removing ctypes.foreign.{threaded,unthreaded}
</A></li>
        <LI>Next message: <A HREF="000224.html">[ocaml-ctypes] Build help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#223">[ date ]</a>
              <a href="thread.html#223">[ thread ]</a>
              <a href="subject.html#223">[ subject ]</a>
              <a href="author.html#223">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

I have working ctypes bindings for MariaDB's libmysqlclient at

  <A HREF="https://github.com/andrenth/ocaml-mariadb">https://github.com/andrenth/ocaml-mariadb</A>

I basically copied and adapted the project structure from

  <A HREF="https://github.com/simonjbeaumont/ocaml-flock">https://github.com/simonjbeaumont/ocaml-flock</A>

to get stub generation working. Currently I'm doing

  let foreign name typ = foreign name typ
    ~from:Dl.(dlopen ~filename:&quot;libmysqlclient.so&quot; ~flags:[RTLD_NOW])

to avoid getting a build error:

  Fatal error: exception
Dl.DL_error(&quot;/home/andre/.opam/4.03.0/lib/stublibs/dllctypes-foreign-base_stubs.so:
undefined symbol: mysql_server_init&quot;)

I'd like to get rid of that, and from googling I found the suggestion of
adding &quot;CCOpt: -Wl,-no-as-needed&quot; (I'm on Ubuntu) to the _oasis file,
but that didn't seem to make a difference.

I'm also not sure if that suggestion if still current, and the
repositories I found on github with a similar structure don't seem to be
using that option. They don't seem to be using the dlopen trick either,
so I'm guessing there's some other way to fix this.

Any help would be greatly appreciated.

Best regards,
Andre

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.ocaml.org/pipermail/ctypes/attachments/20160810/3ba52049/attachment.sig">http://lists.ocaml.org/pipermail/ctypes/attachments/20160810/3ba52049/attachment.sig</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000222.html">[ocaml-ctypes] Removing ctypes.foreign.{threaded,unthreaded}
</A></li>
	<LI>Next message: <A HREF="000224.html">[ocaml-ctypes] Build help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#223">[ date ]</a>
              <a href="thread.html#223">[ thread ]</a>
              <a href="subject.html#223">[ subject ]</a>
              <a href="author.html#223">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/ctypes">More information about the Ctypes
mailing list</a><br>
</body></html>
