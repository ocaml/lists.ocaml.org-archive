<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;style&gt;&lt;!--<br>
.hmmessage&nbsp;P<br>
{<br>
margin:0px;<br>
padding:0px<br>
}<br>
body.hmmessage<br>
{<br>
font-size:&nbsp;12pt;<br>
font-family:Calibri<br>
}<br>
--&gt;&lt;/style&gt;&lt;/head&gt;<br>
&lt;body&nbsp;class='hmmessage'&gt;&lt;div&nbsp;dir='ltr'&gt;Hello,&lt;br&gt;&lt;br&gt;I've&nbsp;been&nbsp;trying&nbsp;to&nbsp;get&nbsp;enums/constant&nbsp;working&nbsp;and&nbsp;have&nbsp;been&nbsp;having&nbsp;a&nbsp;problem&nbsp;in&nbsp;matching&nbsp;types:&lt;br&gt;&lt;br&gt;Error:&nbsp;This&nbsp;expression&nbsp;has&nbsp;type&nbsp;channel_states&nbsp;S.typ&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;an&nbsp;expression&nbsp;was&nbsp;expected&nbsp;of&nbsp;type&nbsp;'a&nbsp;Ctypes.typ&nbsp;=&nbsp;'a&nbsp;Static.typ&lt;br&gt;&lt;br&gt;I&nbsp;get&nbsp;the&nbsp;same&nbsp;error&nbsp;when&nbsp;I&nbsp;try&nbsp;the&nbsp;fruit&nbsp;example&nbsp;from&nbsp;ocaml-ctypes/tests/test-enums,&nbsp;although&nbsp;the&nbsp;issue&nbsp;may&nbsp;be&nbsp;due&nbsp;to&nbsp;a)&nbsp;my&nbsp;inexperience&nbsp;with&nbsp;ocaml&nbsp;and&nbsp;b)&nbsp;the&nbsp;way&nbsp;I&nbsp;generate&nbsp;the&nbsp;stubs.&nbsp;However,&nbsp;all&nbsp;of&nbsp;the&nbsp;c&nbsp;functions&nbsp;I'm&nbsp;mapping&nbsp;to&nbsp;compile&nbsp;without&nbsp;problems.&nbsp;This&nbsp;is&nbsp;essentially&nbsp;what&nbsp;I&nbsp;have:&lt;br&gt;&lt;br&gt;bindings:&lt;br&gt;------------&lt;br&gt;&lt;br&gt;open&nbsp;Ctypes&lt;br&gt;&lt;br&gt;module&nbsp;Bindings&lt;br&gt;&nbsp;&nbsp;(F&nbsp;:&nbsp;sig&nbsp;type&nbsp;_&nbsp;fn&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;foreign&nbsp;:&nbsp;string&nbsp;-&gt;&nbsp;('a&nbsp;-&gt;&nbsp;'b)&nbsp;Ctypes.fn&nbsp;-&gt;&nbsp;('a&nbsp;-&gt;&nbsp;'b)&nbsp;fn&nbsp;end)&nbsp;(S&nbsp;:&nbsp;Cstubs.Types.TYPE)&nbsp;=&nbsp;struct&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;open&nbsp;F&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;type&nbsp;channel_states&nbsp;=&nbsp;ENDED&nbsp;|&nbsp;OPENING&nbsp;|&nbsp;OPEN&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;let&nbsp;ended&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S.constant&nbsp;&quot;ENDED&quot;&nbsp;&nbsp;&nbsp;S.int64_t&lt;br&gt;&nbsp;&nbsp;let&nbsp;opening&nbsp;&nbsp;=&nbsp;S.constant&nbsp;&quot;OPENING&quot;&nbsp;S.int64_t&lt;br&gt;&nbsp;&nbsp;let&nbsp;open_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;S.constant&nbsp;&quot;OPEN&quot;&nbsp;&nbsp;&nbsp;&nbsp;S.int64_t&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;let&nbsp;&nbsp;channel_states&nbsp;=&nbsp;S.enum&nbsp;&quot;&nbsp;channel_states&quot;&nbsp;[&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDED,&nbsp;ended;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPENING,&nbsp;opening;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPEN,&nbsp;open_;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;]&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;&nbsp;channel_struct&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;&nbsp;channel_struct&nbsp;=&nbsp;structure&nbsp;&quot;&nbsp;channel_struct&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;(-:)&nbsp;ty&nbsp;label&nbsp;=&nbsp;field&nbsp;&nbsp;channel_struct&nbsp;label&nbsp;ty&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;state&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;channel_states&nbsp;-:&nbsp;&quot;state&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;capacity&nbsp;=&nbsp;uint32_t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-:&nbsp;&quot;capacity&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;()&nbsp;=&nbsp;seal&nbsp;(channel_struct&nbsp;:&nbsp;channel_struct&nbsp;structure&nbsp;typ)&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;channel_t&nbsp;=&nbsp;channel_struct&nbsp;structure&nbsp;ptr&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;channel_t&nbsp;=&nbsp;ptr&nbsp;channel_struct&lt;br&gt;&lt;br&gt;...&nbsp;the&nbsp;error&nbsp;occurs&nbsp;at&nbsp;the&nbsp;state&nbsp;field&nbsp;at&nbsp;channel_states&lt;br&gt;&lt;br&gt;&lt;br&gt;the&nbsp;generator:&lt;br&gt;-------------------&lt;br&gt;&lt;br&gt;open&nbsp;Channel_bindings&lt;br&gt;&lt;br&gt;let&nbsp;c_headers&nbsp;=&nbsp;&quot;#include&nbsp;\&quot;/home/nick/channel/include/channel.h\&quot;&quot;&lt;br&gt;&lt;br&gt;let&nbsp;main&nbsp;()&nbsp;=&lt;br&gt;&nbsp;&nbsp;let&nbsp;ml_out&nbsp;=&nbsp;open_out&nbsp;&quot;lib/channel_generated.ml&quot;&nbsp;in&lt;br&gt;&nbsp;&nbsp;let&nbsp;c_out&nbsp;=&nbsp;open_out&nbsp;&quot;lib/channel_stubs.c&quot;&nbsp;in&lt;br&gt;&nbsp;&nbsp;let&nbsp;ml_fmt&nbsp;=&nbsp;Format.formatter_of_out_channel&nbsp;ml_out&nbsp;in&lt;br&gt;&nbsp;&nbsp;let&nbsp;c_fmt&nbsp;=&nbsp;Format.formatter_of_out_channel&nbsp;c_out&nbsp;in&lt;br&gt;&nbsp;&nbsp;Cstubs.write_ml&nbsp;ml_fmt&nbsp;~prefix:&quot;libchannel_&quot;&nbsp;(module&nbsp;Bindings);&lt;br&gt;&nbsp;&nbsp;Format.fprintf&nbsp;c_fmt&nbsp;&quot;%s@\n&quot;&nbsp;c_headers;&lt;br&gt;&nbsp;&nbsp;Cstubs.write_c&nbsp;c_fmt&nbsp;~prefix:&quot;libchannel_&quot;&nbsp;(module&nbsp;Bindings);&lt;br&gt;&nbsp;&nbsp;Format.pp_print_flush&nbsp;ml_fmt&nbsp;();&lt;br&gt;&nbsp;&nbsp;Format.pp_print_flush&nbsp;c_fmt&nbsp;();&lt;br&gt;&nbsp;&nbsp;close_out&nbsp;ml_out;&lt;br&gt;&nbsp;&nbsp;close_out&nbsp;c_out&lt;br&gt;&lt;br&gt;let&nbsp;()&nbsp;=&lt;br&gt;&nbsp;&nbsp;main&nbsp;()&lt;br&gt;&lt;br&gt;and&nbsp;the&nbsp;oasis&nbsp;BuildDepends&nbsp;is&nbsp;:&nbsp;ctypes,&nbsp;ctypes.foreign,&nbsp;ctypes.stubs,&nbsp;ctypes.foreign.base,&nbsp;ctypes.foreign.unthreaded&lt;br&gt;&lt;br&gt;I've&nbsp;been&nbsp;trying&nbsp;to&nbsp;work&nbsp;this&nbsp;out&nbsp;since&nbsp;early&nbsp;wednesday&nbsp;(&nbsp;and&nbsp;learnt&nbsp;alot!)&nbsp;but&nbsp;I&nbsp;can't&nbsp;think&nbsp;of&nbsp;anything&nbsp;else&nbsp;to&nbsp;try.&nbsp;I've&nbsp;locally&nbsp;pinned&nbsp;ocaml-ctypes&nbsp;from&nbsp;github&nbsp;head.&lt;br&gt;&lt;br&gt;Cheers&lt;br&gt;Nick&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;<br>
&lt;/html&gt;
</tt>
