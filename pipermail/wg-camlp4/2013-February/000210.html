<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [wg-camlp4] Structured comments,	shallow embeddings and deep quasiquotations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:wg-camlp4%40lists.ocaml.org?Subject=Re%3A%20%5Bwg-camlp4%5D%20Structured%20comments%2C%0A%09shallow%20embeddings%20and%20deep%20quasiquotations&In-Reply-To=%3CPrayer.1.3.5.1302051722550.14752%40hermes-1.csi.cam.ac.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000209.html">
   <LINK REL="Next"  HREF="000211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[wg-camlp4] Structured comments,	shallow embeddings and deep quasiquotations</H1>
    <B>Leo White</B> 
    <A HREF="mailto:wg-camlp4%40lists.ocaml.org?Subject=Re%3A%20%5Bwg-camlp4%5D%20Structured%20comments%2C%0A%09shallow%20embeddings%20and%20deep%20quasiquotations&In-Reply-To=%3CPrayer.1.3.5.1302051722550.14752%40hermes-1.csi.cam.ac.uk%3E"
       TITLE="[wg-camlp4] Structured comments,	shallow embeddings and deep quasiquotations">lpw25 at cam.ac.uk
       </A><BR>
    <I>Tue Feb  5 17:22:55 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000209.html">[wg-camlp4] Structured comments, shallow embeddings and deep quasiquotations
</A></li>
        <LI>Next message: <A HREF="000211.html">[wg-camlp4] Structured comments, shallow embeddings and deep quasiquotations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#210">[ date ]</a>
              <a href="thread.html#210">[ thread ]</a>
              <a href="subject.html#210">[ subject ]</a>
              <a href="author.html#210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Feb 5 2013, Alain Frisch wrote:

&gt;<i>On 02/05/2013 05:35 PM, Leo White wrote:
</I>&gt;&gt;<i> If the extension is part of a module then using it requires you to
</I>&gt;&gt;<i> initialise that whole module at compile-time. This includes initialising
</I>&gt;&gt;<i> (and so potentially executing) code in the module that is intended for
</I>&gt;&gt;<i> run-time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To prevent this from happening we can simply not allow extensions to be
</I>&gt;&gt;<i> part of modules. However, we then have no means of referring to that
</I>&gt;&gt;<i> extension. So in order to refer to these extensions we allow them to be
</I>&gt;&gt;<i> members of namespaces.
</I>&gt;<i>
</I>&gt;<i>I don't follow.  The problem, as I see it, is not that code for the 
</I>&gt;<i>extension is in *some* module, but that it is in the *same* module as 
</I>&gt;<i>the unit on which it needs to apply.
</I>
While obviously using an extension from the same module is a problem, it is 
not the problem I am talking about.

The problem is that the quotation is in a module that is part of the 
program. This module will be initialised at both compile-time and run-time. 
Any effects of initialising the module will occur both times. Since an 
OCaml program's run-time behaviour is basically defined as the effects of 
initialising its modules this will cause confusion and bugs.

By separating the extensions from modules we prevent this almost certainly 
undesired behaviour because only modules can be linked into a program.

One of the strong points of the camlp4/ppx model of creating preprocessors 
for implementing extensions is that it is very clear what is executed at 
compile-time and what is executed at run-time. The &quot;.mlq&quot; files provide 
similar clarity to extensions implemented within the language itself.

&gt;<i>Would the code for .mlq would be compiled manually 
</I>&gt;<i>before its expanders can be used, or would this compilation happen 
</I>&gt;<i>automatically?  
</I>
They would need to be compiled, just like &quot;.mli&quot; files.

&gt;<i> Which technology would then be used to run this code 
</I>&gt;<i>(Dynlink, static linking, toplevel-like technology for in-process 
</I>&gt;<i>compilation/execution)?
</I>
Probably the same technology as the top-level.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000209.html">[wg-camlp4] Structured comments, shallow embeddings and deep quasiquotations
</A></li>
	<LI>Next message: <A HREF="000211.html">[wg-camlp4] Structured comments, shallow embeddings and deep quasiquotations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#210">[ date ]</a>
              <a href="thread.html#210">[ thread ]</a>
              <a href="subject.html#210">[ subject ]</a>
              <a href="author.html#210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/wg-camlp4">More information about the wg-camlp4
mailing list</a><br>
</body></html>
