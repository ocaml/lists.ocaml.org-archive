<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Another&nbsp;option&nbsp;you&nbsp;have&nbsp;is&nbsp;to&nbsp;only&nbsp;replace&nbsp;the&nbsp;part&nbsp;that&nbsp;cannot&nbsp;be&nbsp;patterns&nbsp;by&nbsp;extensions:&lt;br&gt;&lt;br&gt;match%bitstring&nbsp;bits&nbsp;with&lt;br&gt;<br>
|&nbsp;{&nbsp;len&nbsp;=&nbsp;[%p&nbsp;&lt;expr&gt;];&nbsp;bind&nbsp;=&nbsp;[%p&nbsp;&lt;expr&gt;]&nbsp;}&nbsp;-&gt;&nbsp;...&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Apr&nbsp;22,&nbsp;2015&nbsp;at&nbsp;6:36&nbsp;PM,&nbsp;Nicolas&nbsp;Ojeda&nbsp;Bar&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:no263@dpmms.cam.ac.uk&quot;&nbsp;target=&quot;_blank&quot;&gt;no263@dpmms.cam.ac.uk&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;currently&nbsp;working&nbsp;on&nbsp;porting&nbsp;ocaml-bitstring&nbsp;to&nbsp;ppx.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;https://code.google.com/p/bitstring/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://code.google.com/p/bitstring/&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;camlp4&nbsp;version&nbsp;of&nbsp;this&nbsp;syntax&nbsp;extension&nbsp;extends&nbsp;the&nbsp;syntax&nbsp;to&nbsp;allow&lt;br&gt;<br>
expressions&nbsp;in&nbsp;&quot;pattern&quot;&nbsp;positions. &nbsp;For&nbsp;example:&lt;br&gt;<br>
&lt;br&gt;<br>
bitmatch&nbsp;bits&nbsp;with&lt;br&gt;<br>
|&nbsp;{&nbsp;&lt;patt&gt;&nbsp;:&nbsp;&lt;expr&gt;&nbsp;:&nbsp;bind&nbsp;&lt;expr&gt;&nbsp;}&nbsp;-&gt;&nbsp;...&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;considering&nbsp;the&nbsp;following&nbsp;concrete&nbsp;ppx&nbsp;syntax&nbsp;to&nbsp;emulate&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;<br>
match%bitstring&nbsp;bits&nbsp;with&lt;br&gt;<br>
|&nbsp;x,&nbsp;[%len&nbsp;&lt;expr&gt;],&nbsp;[%bind&nbsp;&lt;expr&gt;]&nbsp;-&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
(the&nbsp;[%len]&nbsp;annotation&nbsp;can&nbsp;be&nbsp;skipped&nbsp;if&nbsp;the&nbsp;payload&nbsp;is&nbsp;a&nbsp;literal&nbsp;constant).&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;find&nbsp;this&nbsp;syntax&nbsp;a&nbsp;little&nbsp;too&nbsp;heavy&nbsp;and&nbsp;am&nbsp;thinking&nbsp;about&nbsp;ways&nbsp;to&nbsp;improve&nbsp;it.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;seem&nbsp;to&nbsp;remember&nbsp;some&nbsp;time&nbsp;ago&nbsp;there&nbsp;was&nbsp;a&nbsp;discussion&nbsp;about&nbsp;having&nbsp;the&nbsp;parser&lt;br&gt;<br>
allow&nbsp;expression&nbsp;in&nbsp;pattern&nbsp;positions&nbsp;and&nbsp;reject&nbsp;those&nbsp;which&nbsp;are&nbsp;not&lt;br&gt;<br>
patterns&nbsp;during&lt;br&gt;<br>
typechecking. &nbsp;I&nbsp;don&#39;t&nbsp;actually&nbsp;like&nbsp;this&nbsp;option,&nbsp;but&nbsp;was&nbsp;wondering&nbsp;if&lt;br&gt;<br>
there&nbsp;had&nbsp;been&nbsp;any&lt;br&gt;<br>
conclusions&nbsp;on&nbsp;the&nbsp;issue.&lt;br&gt;<br>
&lt;br&gt;<br>
Another&nbsp;possibility&nbsp;would&nbsp;be&nbsp;to&nbsp;use&nbsp;the&nbsp;{|&nbsp;...&nbsp;|}&nbsp;annotation,&nbsp;as&nbsp;in:&lt;br&gt;<br>
&lt;br&gt;<br>
match%bitstring&nbsp;bits&nbsp;with&lt;br&gt;<br>
|&nbsp;{|&nbsp;x&nbsp;:&nbsp;&lt;expr&gt;&nbsp;:&nbsp;bind&nbsp;&lt;expr&gt;&nbsp;|}&nbsp;-&gt;&nbsp;...&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;problem&nbsp;then&nbsp;is&nbsp;that&nbsp;one&nbsp;needs&nbsp;to&nbsp;write&nbsp;a&nbsp;parser&nbsp;for&nbsp;the&nbsp;thing&lt;br&gt;<br>
inside&nbsp;{|&nbsp;...&nbsp;|}. &nbsp;I&nbsp;thought&lt;br&gt;<br>
about&nbsp;splitting&nbsp;the&nbsp;payload&nbsp;on&nbsp;the&nbsp;delimiter&nbsp;&#39;:&#39;&nbsp;and&nbsp;then&nbsp;calling&nbsp;the&lt;br&gt;<br>
OCaml&nbsp;parser&nbsp;to&nbsp;parse&lt;br&gt;<br>
the&nbsp;individual&nbsp;subparts&nbsp;(here:&nbsp;&quot;x&quot;,&nbsp;&quot;&lt;expr&gt;&quot;,&nbsp;and&nbsp;&quot;bind&nbsp;&lt;expr&gt;&quot;).&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;do&nbsp;you&nbsp;think&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks!&lt;br&gt;<br>
&lt;br&gt;<br>
Best&nbsp;wishes,&lt;br&gt;<br>
Nicolas&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
wg-camlp4&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:wg-camlp4@lists.ocaml.org&quot;&gt;wg-camlp4@lists.ocaml.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.ocaml.org/listinfo/wg-camlp4&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.ocaml.org/listinfo/wg-camlp4&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
