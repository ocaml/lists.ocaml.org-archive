<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:wg-camlp4%40lists.ocaml.org?Subject=Re%3A%20%5Bwg-camlp4%5D%20%5BCaml-devel%5D%20Keeping%20attributes%20in%20.cmi%20files%3F&In-Reply-To=%3C993DE9A5-E774-4F3D-8DB3-BA4F2CE72F08%40math.nagoya-u.ac.jp%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000456.html">
   <LINK REL="Next"  HREF="000458.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?</H1>
    <B>Jacques Garrigue</B> 
    <A HREF="mailto:wg-camlp4%40lists.ocaml.org?Subject=Re%3A%20%5Bwg-camlp4%5D%20%5BCaml-devel%5D%20Keeping%20attributes%20in%20.cmi%20files%3F&In-Reply-To=%3C993DE9A5-E774-4F3D-8DB3-BA4F2CE72F08%40math.nagoya-u.ac.jp%3E"
       TITLE="[wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?">garrigue at math.nagoya-u.ac.jp
       </A><BR>
    <I>Thu Sep 19 01:25:46 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000456.html">[wg-camlp4] Keeping attributes in .cmi files?
</A></li>
        <LI>Next message: <A HREF="000458.html">[wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#457">[ date ]</a>
              <a href="thread.html#457">[ thread ]</a>
              <a href="subject.html#457">[ subject ]</a>
              <a href="author.html#457">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2013/09/18, at 18:34, Alain Frisch &lt;<A HREF="http://lists.ocaml.org/listinfo/wg-camlp4">alain.frisch at lexifi.com</A>&gt; wrote:

&gt;<i> Dear all,
</I>&gt;<i> 
</I>&gt;<i> Attributes are currently kept in .cmt and .cmti files, which are dumps of the Typedtree counterparts of .ml and .mli files.  This allows external tools to access those attributes together with the output of the type-checker.  But this does not easily allow the compiler itself (which doesn't parse the .cmti file) to see attributes from external units.
</I>&gt;<i> 
</I>&gt;<i> If we keep attributes also in the internal structure of the type-checker, which is dumped in the .cmi file, we can make the compiler aware, for instance, of attributes put on value declarations.
</I>&gt;<i> 
</I>&gt;<i> As an example, see the following discussion about having the compiler report a warning when a value marked as deprecated is being used:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://caml.inria.fr/mantis/view.php?id=5854">http://caml.inria.fr/mantis/view.php?id=5854</A>
</I>&gt;<i> 
</I>&gt;<i> Attributes give a natural way to mark values as deprecated, and as I suggest in the discussion, the simplest way to use this information is to keep it in the Types.value_description record (and thus in .cmi files).
</I>&gt;<i> 
</I>&gt;<i> If we start having the compiler understand some specific attributes, it makes sense, in my opinion, to keep them even in .cmi files (at least for attributes on &quot;declarations&quot;, not necessarily on type expressions).  Do you agree?  Would anyone object to the patch I proposed on the ticket above?
</I>&gt;<i> 
</I>
On the principle, I have nothing against keeping attribute in .cmi files, since they are not supposed to change.
But to be honest I have not followed the discussion on attributes, and the inclusion in trunk was kind of sudden.
It might have been better to wait for the upcoming meeting.

I am a bit concerned by the fact the syntax tree is now completely mutually recursive:
an attribute appearing in a type may contain a structure.
What is the rationale behind that ?
And for pattern attributes in types ?
Does it mean that you want to include whole structures in .cmi files ?
Wouldn't it be better to restrict attributes to type expressions, constants, and identifiers/paths ?
Should all nodes allow all attributes ?

	Jacques
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000456.html">[wg-camlp4] Keeping attributes in .cmi files?
</A></li>
	<LI>Next message: <A HREF="000458.html">[wg-camlp4] [Caml-devel] Keeping attributes in .cmi files?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#457">[ date ]</a>
              <a href="thread.html#457">[ thread ]</a>
              <a href="subject.html#457">[ subject ]</a>
              <a href="author.html#457">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.ocaml.org/listinfo/wg-camlp4">More information about the wg-camlp4
mailing list</a><br>
</body></html>
